{"version":3,"sources":["../src/dom/Forms.ts","../src/dom/ResolveEl.ts"],"sourcesContent":["import { resolveEl } from './ResolveEl.js';\n\n/**\n * Adds tab and shift+tab to TEXTAREA\n * @param el\n */\n//eslint-disable-next-line functional/prefer-immutable-types\nexport const textAreaKeyboard = (el: HTMLTextAreaElement) => {\n  el.addEventListener(`keydown`, (event) => {\n    const elementValue = el.value;\n    const start = el.selectionStart;\n    const end = el.selectionEnd;\n\n    if (event.key === `Tab` && event.shiftKey) {\n      // eslint-disable-next-line unicorn/prefer-string-slice\n      if (el.value.substring(start - 2, start) === `  `) {\n        //eslint-disable-next-line functional/immutable-data\n        el.value = elementValue.slice(0, Math.max(0, start - 2)) + elementValue.slice(Math.max(0, end));\n      }\n      //eslint-disable-next-line functional/immutable-data\n      el.selectionStart = el.selectionEnd = start - 2;\n      event.preventDefault();\n      return false;\n    } else if (event.key === `Tab`) {\n      //eslint-disable-next-line functional/immutable-data\n      el.value = elementValue.slice(0, Math.max(0, start)) + `  ` + elementValue.slice(Math.max(0, end));\n      //eslint-disable-next-line functional/immutable-data\n      el.selectionStart = el.selectionEnd = start + 2;\n      event.preventDefault();\n      return false;\n    }\n  });\n};\n\n/**\n * Quick access to <input type=\"checkbox\"> value.\n * Provide a checkbox by string id or object reference. If a callback is\n * supplied, it will be called when the checkbox changes value.\n *\n * ```\n * const opt = checkbox(`#chkMate`);\n * opt.checked; // Gets/sets\n *\n * const opt = checkbox(document.getElementById(`#chkMate`), newVal => {\n *  if (newVal) ...\n * });\n * ```\n * @param {(string | HTMLInputElement)} domIdOrEl\n * @param {(currentVal:boolean) => void} [onChanged]\n * @returns\n */\nexport const checkbox = (\n  //eslint-disable-next-line functional/prefer-immutable-types\n  domIdOrEl: string | HTMLInputElement,\n  onChanged?: (currentValue: boolean) => void\n) => {\n  const el = resolveEl<HTMLInputElement>(domIdOrEl);\n\n  if (onChanged) {\n    el.addEventListener(`change`, () => {\n      onChanged(el.checked);\n    });\n  }\n  return {\n    get checked(): boolean {\n      return el.checked;\n    },\n    set checked(value: boolean) {\n      // eslint-disable-next-line functional/immutable-data\n      el.checked = value;\n    },\n  };\n};\n\n/**\n * Numeric INPUT\n *\n * ```\n * const el = numeric(`#num`, (currentValue) => {\n *  // Called when input changes\n * })\n * ```\n *\n * Get/set value\n * ```\n * el.value = 10;\n * ```\n * @param domIdOrEl\n * @param onChanged\n * @param live If true, event handler fires based on `input` event, rather than `change`\n * @returns\n */\nexport const numeric = (\n  //eslint-disable-next-line functional/prefer-immutable-types\n  domIdOrEl: string | HTMLInputElement,\n  onChanged?: (currentValue: number) => void,\n  live?: boolean\n) => {\n  const el = resolveEl<HTMLInputElement>(domIdOrEl);\n  const eventName = live ? `change` : `input`;\n  if (onChanged) {\n    el.addEventListener(eventName, () => {\n      onChanged(Number.parseInt(el.value));\n    });\n  }\n  return {\n    get value(): number {\n      return Number.parseInt(el.value);\n    },\n    set value(value: number) {\n      // eslint-disable-next-line functional/immutable-data\n      el.value = value.toString();\n    },\n  };\n};\n\n/**\n * SELECT options\n */\nexport type SelectOpts = {\n  /**\n   * Placeholder item\n   */\n  readonly placeholderOpt?: string;\n  /**\n   * If true, a placeholder option 'Choose' is added to the list\n   */\n  readonly shouldAddChoosePlaceholder?: boolean;\n  /**\n   * Item to choose after a selection is made\n   */\n  readonly autoSelectAfterChoice?: number;\n};\n\n/**\n * Button\n *\n * ```\n * const b = button(`#myButton`, () => {\n *  console.log(`Button clicked`);\n * });\n * ```\n *\n * ```\n * b.click(); // Call the click handler\n * b.disabled = true / false;\n * ```\n * @param domQueryOrEl Query string or element instance\n * @param onClick Callback when button is clicked\n * @returns\n */\nexport const button = (\n  domQueryOrEl: string | HTMLButtonElement,\n  onClickHandler?: () => void\n) => {\n  const el = resolveEl(domQueryOrEl);\n\n  const addEvent = () => {\n    if (onClickHandler) {\n      el.addEventListener(`click`, onClickHandler);\n    }\n  }\n\n  const removeEvent = () => {\n    if (onClickHandler) {\n      el.removeEventListener(`click`, onClickHandler)\n    }\n  }\n\n  addEvent();\n\n  return {\n    /**\n     * Gets text content of button\n     */\n    get title(): string | null {\n      return el.textContent;\n    },\n    /**\n     * Sets text content of button\n     */\n    set title(value: string) {\n      el.textContent = value;\n    },\n    /**\n     * Disposes the button.\n     * Removes event handler and optionally removes from document\n     * @param deleteElement \n     */\n    dispose(deleteElement = false) {\n      removeEvent();\n      if (deleteElement) el.remove();\n    },\n    /**\n     * Sets the click handler, overwriting existing.\n     * @param handler \n     */\n    onClick(handler?: () => void) {\n      removeEvent();\n      onClickHandler = handler;\n      addEvent();\n    },\n    /**\n     * Trigger onClick handler\n     */\n    click() {\n      if (onClickHandler) onClickHandler();\n    },\n    /**\n     * Sets disabled state of button\n     */\n    set disabled(value: boolean) {\n      el.disabled = value;\n    },\n    /**\n     * Gets the button element\n     */\n    get el(): HTMLButtonElement {\n      return el\n    }\n  };\n};\n\n/**\n * Creates a BUTTON element, wrapping it via {@link button} and returning it.\n * ```js\n * const b = buttonCreate(`Stop`, () => console.log(`Stop`));\n * someParent.addNode(b.el);\n * ```\n * @param title \n * @param onClick \n * @returns \n */\nexport const buttonCreate = (title: string, onClick?: () => void) => {\n  const el = document.createElement(`button`);\n  const w = button(el, onClick);\n  w.title = title;\n  return w;\n}\n\n/**\n * SELECT handler\n */\nexport type SelectHandler = {\n  /**\n   * Gets/Sets disabled\n   */\n  set disabled(value: boolean);\n\n  get disabled(): boolean;\n  /**\n   * Gets value\n   */\n  get value(): string;\n  /**\n   * Sets selected index\n   */\n  get index(): number;\n  /**\n   * _True_ if currently selected item is the placeholder\n   */\n  get isSelectedPlaceholder(): boolean;\n  /**\n   * Set options\n   * @param opts Options\n   * @param preSelect Item to preselect\n   */\n  setOpts(opts: ReadonlyArray<string>, preSelect?: string): void;\n  /**\n   * Select item by index\n   * @param index Index\n   * @param trigger If true, triggers change event\n   */\n  select(index?: number, trigger?: boolean): void;\n}\n\n/**\n * SELECT element.\n *\n * Handle changes in value:\n * ```\n * const mySelect = select(`#mySelect`, (newValue) => {\n *  console.log(`Value is now ${newValue}`);\n * });\n * ```\n *\n * Enable/disable:\n * ```\n * mySelect.disabled = true / false;\n * ```\n *\n * Get currently selected index or value:\n * ```\n * mySelect.value / mySelect.index\n * ```\n *\n * Is the currently selected value a placeholder?\n * ```\n * mySelect.isSelectedPlaceholder\n * ```\n *\n * Set list of options\n * ```\n * // Adds options, preselecting `opt2`.\n * mySelect.setOpts([`opt1`, `opt2 ...], `opt2`);\n * ```\n *\n * Select an element\n * ```\n * mySelect.select(1); // Select second item\n * mySelect.select(1, true); // If true is added, change handler fires as well\n * ```\n * @param domQueryOrEl Query (eg `#id`) or element\n * @param onChanged Callback when a selection is made\n * @param opts Options\n * @return\n */\nexport const select = (\n  //eslint-disable-next-line functional/prefer-immutable-types\n  domQueryOrEl: string | HTMLSelectElement,\n  onChanged?: (currentValue: string) => void,\n  opts: SelectOpts = {}\n): SelectHandler => {\n  const el = resolveEl(domQueryOrEl);\n  const {\n    placeholderOpt,\n    shouldAddChoosePlaceholder = false,\n    autoSelectAfterChoice = -1,\n  } = opts;\n\n  const change = () => {\n    if (onChanged !== undefined) onChanged(el.value);\n    // eslint-disable-next-line functional/immutable-data\n    if (autoSelectAfterChoice >= 0) el.selectedIndex = autoSelectAfterChoice;\n  };\n\n  if (onChanged) {\n    el.addEventListener(`change`, (_event) => {\n      change();\n    });\n  }\n  return {\n    set disabled(value: boolean) {\n      // eslint-disable-next-line functional/immutable-data\n      el.disabled = value;\n    },\n    get value(): string {\n      return el.value;\n    },\n    get index(): number {\n      return el.selectedIndex;\n    },\n    get isSelectedPlaceholder(): boolean {\n      return (\n        (shouldAddChoosePlaceholder || opts.placeholderOpt !== undefined) &&\n        el.selectedIndex === 0\n      );\n    },\n    //eslint-disable-next-line functional/prefer-immutable-types\n    setOpts(opts: Array<string>, preSelect?: string): void {\n      // eslint-disable-next-line functional/immutable-data\n      el.options.length = 0;\n\n      if (shouldAddChoosePlaceholder) opts = [ `-- Choose --`, ...opts ];\n      else if (placeholderOpt !== undefined) opts = [ placeholderOpt, ...opts ];\n      // eslint-disable-next-line functional/no-let\n      let toSelect = 0;\n\n      for (const [ index, o ] of opts.entries()) {\n        const optEl = document.createElement(`option`);\n        // eslint-disable-next-line functional/immutable-data\n        optEl.value = o;\n        // eslint-disable-next-line functional/immutable-data\n        optEl.innerHTML = o;\n        if (preSelect !== undefined && o === preSelect) toSelect = index;\n        el.options.add(optEl);\n      }\n      // eslint-disable-next-line functional/immutable-data\n      el.selectedIndex = toSelect;\n    },\n    select(index = 0, trigger = false): void {\n      // eslint-disable-next-line functional/immutable-data\n      el.selectedIndex = index;\n      if (trigger && onChanged) {\n        change();\n      }\n    },\n  };\n};\n","\n/**\n * Resolves either a string or HTML element to an element.\n * Useful when an argument is either an HTML element or query.\n *\n * ```js\n * resolveEl(`#someId`);\n * resolveEl(someElement);\n * ```\n * @param domQueryOrEl\n * @returns\n */\nexport const resolveEl = <V extends Element>(domQueryOrEl: string | V | null | undefined): V => {\n  if (typeof domQueryOrEl === `string`) {\n    const d = document.querySelector(domQueryOrEl);\n    if (d === null) {\n      const error = domQueryOrEl.startsWith(`#`) ? new Error(\n        `Query '${ domQueryOrEl }' did not match anything. Try '#id', 'div', or '.class'`\n      ) : new Error(\n        `Query '${ domQueryOrEl }' did not match anything. Did you mean '#${ domQueryOrEl }?`\n      );\n      throw error;\n    }\n    domQueryOrEl = d as V;\n  } else if (domQueryOrEl === null) {\n    throw new Error(`Param 'domQueryOrEl' is null`);\n  } else if (domQueryOrEl === undefined) {\n    throw new Error(`Param 'domQueryOrEl' is undefined`);\n  }\n  const el = domQueryOrEl;\n  return el;\n};\n\nexport type QueryOrElements = string | Array<Element> | Array<HTMLElement> | HTMLElement | Element\n\nexport const resolveEls = (selectors: QueryOrElements): Array<HTMLElement> => {\n  if (selectors === undefined) return [];\n  if (selectors === null) return [];\n  if (Array.isArray(selectors)) return selectors as Array<HTMLElement>;\n  if (typeof selectors === `string`) {\n    const elements = [ ...document.querySelectorAll(selectors) ]\n    return elements as Array<HTMLElement>\n  }\n  return [ selectors as HTMLElement ];\n}"],"mappings":"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","names":["opts"]}