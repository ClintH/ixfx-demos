{"version":3,"sources":["../src/collections/queue/index.ts","../src/collections/queue/QueueImmutable.ts","../src/collections/queue/Responsive.ts"],"sourcesContent":["export type * from './IPriorityQueueMutable.js';\nexport type * from './IQueueImmutable.js';\nexport type * from './IQueueMutable.js';\nexport * from './PriorityMutable.js';\nexport { immutable } from './QueueImmutable.js';\nexport { mutable } from './QueueMutable.js';\nexport type * from './QueueTypes.js';\nexport * from './Responsive.js';","import type { IQueueImmutable } from './IQueueImmutable.js';\nimport { peek, isFull, isEmpty, enqueue, dequeue } from './QueueFns.js';\nimport { type QueueOpts } from './QueueTypes.js';\n\n// -------------------------------\n// Immutable\n// -------------------------------\nexport class QueueImmutable<V> implements IQueueImmutable<V> {\n  readonly opts: QueueOpts<V>;\n  #data: ReadonlyArray<V>;\n\n  /**\n   * Creates an instance of Queue.\n   * @param {QueueOpts} opts Options foor queue\n   * @param {V[]} data Initial data. Index 0 is front of queue\n   */\n  constructor(opts: QueueOpts<V> = {}, data: ReadonlyArray<V> = []) {\n    if (opts === undefined) throw new Error(`opts parameter undefined`);\n\n    this.opts = opts;\n    this.#data = data;\n  }\n\n  forEach(fn: (v: V) => void) {\n    //eslint-disable-next-line functional/no-let\n    for (let index = this.#data.length - 1; index >= 0; index--) {\n      fn(this.#data[ index ]);\n    }\n  }\n\n  forEachFromFront(fn: (v: V) => void) {\n    // From front of queue\n    // eslint-disable-next-line unicorn/no-array-for-each\n    this.#data.forEach(item => { fn(item) }); //(vv) => fn(vv));\n  }\n\n  enqueue(...toAdd: ReadonlyArray<V> | Array<V>): QueueImmutable<V> {\n    return new QueueImmutable<V>(\n      this.opts,\n      enqueue(this.opts, this.#data, ...toAdd)\n    );\n  }\n\n  dequeue(): QueueImmutable<V> {\n    return new QueueImmutable<V>(this.opts, dequeue(this.opts, this.#data));\n  }\n\n  get isEmpty(): boolean {\n    return isEmpty(this.opts, this.#data);\n  }\n\n  get isFull(): boolean {\n    return isFull(this.opts, this.#data);\n  }\n\n  get length(): number {\n    return this.#data.length;\n  }\n\n  get peek(): V | undefined {\n    return peek(this.opts, this.#data);\n  }\n\n  toArray() {\n    return [ ...this.#data ];\n  }\n}\n\n/**\n * Returns an immutable queue. Queues are useful if you want to treat 'older' or 'newer'\n * items differently. _Enqueing_ adds items at the back of the queue, while\n * _dequeing_ removes items from the front (ie. the oldest).\n *\n * ```js\n * import { Queues } from \"https://unpkg.com/ixfx/dist/collections.js\"\n * let q = Queues.immutable();           // Create\n * q = q.enqueue(`a`, `b`);   // Add two strings\n * const front = q.peek();    // `a` is at the front of queue (oldest)\n * q = q.dequeue();           // q now just consists of `b`\n * ```\n * @example Cap size to 5 items, throwing away newest items already in queue.\n * ```js\n * const q = Queues.immutable({capacity: 5, discardPolicy: `newer`});\n * ```\n *\n * @typeParam V - Type of values stored\n * @param options\n * @param startingItems Index 0 is the front of the queue\n * @returns A new queue\n */\nexport const immutable = <V>(\n  options: QueueOpts<V> = {},\n  ...startingItems: ReadonlyArray<V>\n): IQueueImmutable<V> => {\n  options = { ...options }; // Make a copy of options\n  return new QueueImmutable(options, [ ...startingItems ]); // Make a copy of array so it can't be modified\n};\n","import type { IQueueMutableWithEvents, QueueMutableEvents } from \"./IQueueMutable.js\";\nimport * as Rx from '../../rx/index.js';\n\n/**\n * Changes to `queue` are output as a responsive stream.\n * The stream emits the full data of the queue (first item being the head of the queue)\n * whenever there is an enqueue, remove or clear operation.\n * \n * ```js\n * const queue = new QueueMutable();\n * const r = asResponsive(queue);\n * r.onValue(v => {\n *  // v is an array of values\n * });\n * \n * \n * Calling `set()` on the stream enqueues data to the wrapped queue.\n * ```js\n * r.set([ `1, `2` ]); // Enqueues 1, 2\n * ```\n * @param queue \n * @returns \n */\nexport function asResponsive<T>(queue: IQueueMutableWithEvents<T>) {\n  const events = Rx.manual<ReadonlyArray<T>>({\n    onNoSubscribers() {\n      queue.removeEventListener(`removed`, onRemoved);\n      queue.removeEventListener(`enqueue`, onEnqueue);\n    },\n    onFirstSubscribe() {\n      queue.addEventListener(`removed`, onRemoved);\n      queue.addEventListener(`enqueue`, onEnqueue);\n      events.set(queue.toArray());\n    },\n  });\n\n  const onRemoved = (event: QueueMutableEvents<T>[ `removed` ]) => {\n    events.set(event.finalData);\n  }\n  const onEnqueue = (event: QueueMutableEvents<T>[ `enqueue` ]) => {\n    events.set(event.finalData);\n  }\n\n  const set = (data: Array<T>) => {\n    queue.enqueue(...data);\n  }\n\n  return {\n    ...events,\n    set\n  }\n}"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACOO,IAAM,iBAAN,MAAM,gBAAgD;AAAA,EAE3D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,YAAY,OAAqB,CAAC,GAAG,OAAyB,CAAC,GAAG;AAChE,QAAI,SAAS,OAAW,OAAM,IAAI,MAAM,0BAA0B;AAElE,SAAK,OAAO;AACZ,SAAK,QAAQ;AAAA,EACf;AAAA,EAEA,QAAQ,IAAoB;AAE1B,aAAS,QAAQ,KAAK,MAAM,SAAS,GAAG,SAAS,GAAG,SAAS;AAC3D,SAAG,KAAK,MAAO,KAAM,CAAC;AAAA,IACxB;AAAA,EACF;AAAA,EAEA,iBAAiB,IAAoB;AAGnC,SAAK,MAAM,QAAQ,UAAQ;AAAE,SAAG,IAAI;AAAA,IAAE,CAAC;AAAA,EACzC;AAAA,EAEA,WAAW,OAAuD;AAChE,WAAO,IAAI;AAAA,MACT,KAAK;AAAA,MACL,QAAQ,KAAK,MAAM,KAAK,OAAO,GAAG,KAAK;AAAA,IACzC;AAAA,EACF;AAAA,EAEA,UAA6B;AAC3B,WAAO,IAAI,gBAAkB,KAAK,MAAM,QAAQ,KAAK,MAAM,KAAK,KAAK,CAAC;AAAA,EACxE;AAAA,EAEA,IAAI,UAAmB;AACrB,WAAO,QAAQ,KAAK,MAAM,KAAK,KAAK;AAAA,EACtC;AAAA,EAEA,IAAI,SAAkB;AACpB,WAAO,OAAO,KAAK,MAAM,KAAK,KAAK;AAAA,EACrC;AAAA,EAEA,IAAI,SAAiB;AACnB,WAAO,KAAK,MAAM;AAAA,EACpB;AAAA,EAEA,IAAI,OAAsB;AACxB,WAAO,KAAK,KAAK,MAAM,KAAK,KAAK;AAAA,EACnC;AAAA,EAEA,UAAU;AACR,WAAO,CAAE,GAAG,KAAK,KAAM;AAAA,EACzB;AACF;AAwBO,IAAM,YAAY,CACvB,UAAwB,CAAC,MACtB,kBACoB;AACvB,YAAU,EAAE,GAAG,QAAQ;AACvB,SAAO,IAAI,eAAe,SAAS,CAAE,GAAG,aAAc,CAAC;AACzD;;;ACzEO,SAAS,aAAgB,OAAmC;AACjE,QAAM,SAAY,OAAyB;AAAA,IACzC,kBAAkB;AAChB,YAAM,oBAAoB,WAAW,SAAS;AAC9C,YAAM,oBAAoB,WAAW,SAAS;AAAA,IAChD;AAAA,IACA,mBAAmB;AACjB,YAAM,iBAAiB,WAAW,SAAS;AAC3C,YAAM,iBAAiB,WAAW,SAAS;AAC3C,aAAO,IAAI,MAAM,QAAQ,CAAC;AAAA,IAC5B;AAAA,EACF,CAAC;AAED,QAAM,YAAY,CAAC,UAA8C;AAC/D,WAAO,IAAI,MAAM,SAAS;AAAA,EAC5B;AACA,QAAM,YAAY,CAAC,UAA8C;AAC/D,WAAO,IAAI,MAAM,SAAS;AAAA,EAC5B;AAEA,QAAM,MAAM,CAAC,SAAmB;AAC9B,UAAM,QAAQ,GAAG,IAAI;AAAA,EACvB;AAEA,SAAO;AAAA,IACL,GAAG;AAAA,IACH;AAAA,EACF;AACF;","names":[]}