{"version":3,"sources":["../src/data/Scale.ts","../src/visual/Colour.ts","../node_modules/colorjs.io/src/multiply-matrices.js","../node_modules/colorjs.io/src/util.js","../node_modules/colorjs.io/src/hooks.js","../node_modules/colorjs.io/src/defaults.js","../node_modules/colorjs.io/src/adapt.js","../node_modules/colorjs.io/src/parse.js","../node_modules/colorjs.io/src/getColor.js","../node_modules/colorjs.io/src/space.js","../node_modules/colorjs.io/src/spaces/xyz-d65.js","../node_modules/colorjs.io/src/rgbspace.js","../node_modules/colorjs.io/src/getAll.js","../node_modules/colorjs.io/src/get.js","../node_modules/colorjs.io/src/setAll.js","../node_modules/colorjs.io/src/set.js","../node_modules/colorjs.io/src/spaces/xyz-d50.js","../node_modules/colorjs.io/src/spaces/lab.js","../node_modules/colorjs.io/src/angles.js","../node_modules/colorjs.io/src/spaces/lch.js","../node_modules/colorjs.io/src/deltaE/deltaE2000.js","../node_modules/colorjs.io/src/spaces/oklab.js","../node_modules/colorjs.io/src/deltaE/deltaEOK.js","../node_modules/colorjs.io/src/inGamut.js","../node_modules/colorjs.io/src/clone.js","../node_modules/colorjs.io/src/distance.js","../node_modules/colorjs.io/src/deltaE/deltaE76.js","../node_modules/colorjs.io/src/deltaE/deltaECMC.js","../node_modules/colorjs.io/src/spaces/xyz-abs-d65.js","../node_modules/colorjs.io/src/spaces/jzazbz.js","../node_modules/colorjs.io/src/spaces/jzczhz.js","../node_modules/colorjs.io/src/deltaE/deltaEJz.js","../node_modules/colorjs.io/src/spaces/ictcp.js","../node_modules/colorjs.io/src/deltaE/deltaEITP.js","../node_modules/colorjs.io/src/spaces/cam16.js","../node_modules/colorjs.io/src/spaces/hct.js","../node_modules/colorjs.io/src/deltaE/deltaEHCT.js","../node_modules/colorjs.io/src/deltaE/index.js","../node_modules/colorjs.io/src/toGamut.js","../node_modules/colorjs.io/src/to.js","../node_modules/colorjs.io/src/serialize.js","../node_modules/colorjs.io/src/spaces/rec2020-linear.js","../node_modules/colorjs.io/src/spaces/rec2020.js","../node_modules/colorjs.io/src/spaces/p3-linear.js","../node_modules/colorjs.io/src/spaces/srgb-linear.js","../node_modules/colorjs.io/src/keywords.js","../node_modules/colorjs.io/src/spaces/srgb.js","../node_modules/colorjs.io/src/spaces/p3.js","../node_modules/colorjs.io/src/display.js","../node_modules/colorjs.io/src/equals.js","../node_modules/colorjs.io/src/luminance.js","../node_modules/colorjs.io/src/contrast/WCAG21.js","../node_modules/colorjs.io/src/contrast/APCA.js","../node_modules/colorjs.io/src/contrast/Michelson.js","../node_modules/colorjs.io/src/contrast/Weber.js","../node_modules/colorjs.io/src/contrast/Lstar.js","../node_modules/colorjs.io/src/spaces/lab-d65.js","../node_modules/colorjs.io/src/contrast/deltaPhi.js","../node_modules/colorjs.io/src/contrast.js","../node_modules/colorjs.io/src/chromaticity.js","../node_modules/colorjs.io/src/deltaE.js","../node_modules/colorjs.io/src/variations.js","../node_modules/colorjs.io/src/interpolation.js","../node_modules/colorjs.io/src/spaces/hsl.js","../node_modules/colorjs.io/src/spaces/hsv.js","../node_modules/colorjs.io/src/spaces/hwb.js","../node_modules/colorjs.io/src/spaces/a98rgb-linear.js","../node_modules/colorjs.io/src/spaces/a98rgb.js","../node_modules/colorjs.io/src/spaces/prophoto-linear.js","../node_modules/colorjs.io/src/spaces/prophoto.js","../node_modules/colorjs.io/src/spaces/oklch.js","../node_modules/colorjs.io/src/spaces/luv.js","../node_modules/colorjs.io/src/spaces/lchuv.js","../node_modules/colorjs.io/src/spaces/hsluv.js","../node_modules/colorjs.io/src/spaces/hpluv.js","../node_modules/colorjs.io/src/spaces/rec2100-pq.js","../node_modules/colorjs.io/src/spaces/rec2100-hlg.js","../node_modules/colorjs.io/src/CATs.js","../node_modules/colorjs.io/src/spaces/acescg.js","../node_modules/colorjs.io/src/spaces/acescc.js","../node_modules/colorjs.io/src/color.js","../node_modules/colorjs.io/src/spaces/index.js","../node_modules/colorjs.io/src/space-accessors.js","../node_modules/colorjs.io/src/index.js"],"sourcesContent":["import { clamp } from './Clamp.js';\nimport { throwNumberTest } from '../util/GuardNumbers.js';\n\n/**\n * Scales `v` from an input range to an output range (aka `map`)\n *\n * For example, if a sensor's useful range is 100-500, scale it to a percentage:\n *\n * ```js\n * import { scale } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * scale(sensorReading, 100, 500, 0, 1);\n * ```\n *\n * `scale` defaults to a percentage-range output, so you can get away with:\n * ```js\n * scale(sensorReading, 100, 500);\n * ```\n *\n * If `v` is outside of the input range, it will likewise be outside of the output range.\n * Use {@link scaleClamped} to clip value to range.\n *\n * If inMin and inMax are equal, outMax will be returned.\n *\n * An easing function can be provided for non-linear scaling. In this case\n * the input value is 'pre scaled' using the function before it is applied to the\n * output range.\n *\n * ```js\n * scale(sensorReading, 100, 500, 0, 1, Easings.gaussian());\n * ```\n * @param v Value to scale\n * @param inMin Input minimum\n * @param inMax Input maximum\n * @param outMin Output minimum. If not specified, 0\n * @param outMax Output maximum. If not specified, 1\n * @param easing Easing function\n * @returns Scaled value\n */\nexport const scale = (\n  v: number,\n  inMin: number,\n  inMax: number,\n  outMin?: number,\n  outMax?: number,\n  easing?: (v: number) => number\n): number => scaler(inMin, inMax, outMin, outMax, easing)(v);\n\n/**\n * Returns a scaling function\n * @param inMin Input minimum\n * @param inMax Input maximum\n * @param outMin Output minimum. If not specified, 0\n * @param outMax Output maximum. If not specified, 1\n * @param easing Easing function\n * @returns\n */\nexport const scaler = (\n  inMin: number,\n  inMax: number,\n  outMin?: number,\n  outMax?: number,\n  easing?: (v: number) => number\n): ((v: number) => number) => {\n\n  const oMax = outMax ?? 1;\n  const oMin = outMin ?? 0;\n\n  return (v: number): number => {\n    if (inMin === inMax) return oMax;\n\n    //eslint-disable-next-line functional/no-let\n    let a = (v - inMin) / (inMax - inMin);\n    if (easing !== undefined) a = easing(a);\n    return a * (oMax - oMin) + oMin;\n  };\n};\n\n/**\n * As {@link scale}, but result is clamped to be\n * within `outMin` and `outMax`.\n *\n * @param v\n * @param inMin\n * @param inMax\n * @param outMin 1 by default\n * @param outMax 0 by default d\n * @param easing\n * @returns\n */\nexport const scaleClamped = (\n  v: number,\n  inMin: number,\n  inMax: number,\n  outMin?: number,\n  outMax?: number,\n  easing?: (v: number) => number\n): number => {\n  if (outMax === undefined) outMax = 1;\n  if (outMin === undefined) outMin = 0;\n  if (inMin === inMax) return outMax;\n\n  const x = scale(v, inMin, inMax, outMin, outMax, easing);\n  return clamp(x, outMin, outMax);\n};\n\n/**\n * Scales an input percentage to a new percentage range.\n *\n * If you have an input percentage (0-1), `scalePercentageOutput` maps it to an\n * _output_ percentage of `outMin`-`outMax`.\n *\n * ```js\n * import { scalePercentages } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * // Scales 50% to a range of 0-10%\n * scalePercentages(0.5, 0, 0.10); // 0.05 - 5%\n * ```\n *\n * An error is thrown if any parameter is outside of percentage range. This added\n * safety is useful for catching bugs. Otherwise, you could just as well call\n * `scale(percentage, 0, 1, outMin, outMax)`.\n *\n * If you want to scale some input range to percentage output range, just use `scale`:\n * ```js\n * import { scale } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * // Yields 0.5\n * scale(2.5, 0, 5);\n * ```\n * @param percentage Input value, within percentage range\n * @param outMin Output minimum, between 0-1\n * @param outMax Output maximum, between 0-1\n * @returns Scaled value between outMin-outMax.\n */\nexport const scalePercentages = (\n  percentage: number,\n  outMin: number,\n  outMax = 1\n): number => {\n  throwNumberTest(percentage, `percentage`, `v`);\n  throwNumberTest(outMin, `percentage`, `outMin`);\n  throwNumberTest(outMax, `percentage`, `outMax`);\n  return scale(percentage, 0, 1, outMin, outMax);\n};\n\n/**\n * Scales an input percentage value to an output range\n * If you have an input percentage (0-1), `scalePercent` maps it to an output range of `outMin`-`outMax`.\n * ```js\n * import { scalePercent } from 'https://unpkg.com/ixfx/dist/data.js';\n * scalePercent(0.5, 10, 20); // 15\n * ```\n *\n * @see {@link scalerPercent} Returns a function\n * @param v Value to scale\n * @param outMin Minimum for output\n * @param outMax Maximum for output\n * @returns\n */\nexport const scalePercent = (\n  v: number,\n  outMin: number,\n  outMax: number\n): number => scalerPercent(outMin, outMax)(v);\n\n/**\n * Returns a function that scales an input percentage value to an output range\n * @see {@link scalePercent} Calculates value\n * @param outMin\n * @param outMax\n * @returns Function that takes a single argument\n */\nexport const scalerPercent = (outMin: number, outMax: number) => {\n  return (v: number) => {\n    throwNumberTest(v, `percentage`, `v`);\n    return scale(v, 0, 1, outMin, outMax);\n  };\n};\n","import Color, { type Range } from 'colorjs.io';\n\nimport { defaultRandom, type RandomSource } from '../random/Types.js';\nimport { throwNumberTest } from '../util/GuardNumbers.js';\nimport { pairwise } from '../data/arrays/Pairwise.js';\nimport { scale as scaleNumber } from '../data/Scale.js';\nimport { clamp } from '../data/Clamp.js';\n\nexport type Hsl = { h: number; s: number; l: number; opacity: number, space?: `hsl` };\nexport type Rgb = { r: number; g: number; b: number; opacity: number, space?: `srgb` };\nexport type Spaces = `hsl` | `hsluv` | `rgb` | `srgb` | `lch` | `oklch` | `oklab` | `okhsl` | `p3` | `lab` | `hcl` | `cubehelix`;\n\nexport type OkLch = { l: number, c: number, h: number, opacity: number, space: `oklch` }\n\n/**\n * A representation of colour. Eg: `blue`, `rgb(255,0,0)`, `hsl(20,100%,50%)`\n */\nexport type Colourish = Color | Hsl | OkLch | Rgb | string;\n\n// export type ColourRgb = {\n//   space:`rgb`\n//   coords: Rgba\n// }\n// export type ColourHsl = {\n//   space:`hsl`;\n//   coords: Hsla;\n// }\n\n// export type Colour = ColourHsl|ColourRgb;\n\n/**\n * Options for interpolation\n */\nexport type InterpolationOpts = {\n  space: Spaces,\n  hue: `longer` | `shorter` | `increasing` | `decreasing` | `raw`\n};\n\n// export const toHsl = (colour: Colourish): Hsla => {\n//   const hsl = toHsl(colour);\n//   if (`opacity` in hsl) return hsl as Hsla;\n//   else return {\n//     ...hsl,\n//     opacity: 1\n//   }\n// }\n\n/**\n * Parses colour to `{ h, s, l }`, each field being on 0..1 scale.\n * \n * Note that some colours will return NaN for h,s or l. This is because they have\n * indeterminate hue. For example white, black and transparent. Use 'safe = true'\n * to ensure a safe colour is returned.\n * @param colour\n * @param safe When true, returned colour will not include NaN. Default: false\n * @returns\n */\nexport const toHsl = (colour: Colourish, safe = false): Hsl => {\n  if (typeof colour === `string` && colour === `transparent`) return { h: 0, s: 0, l: 0, opacity: 0, space: `hsl` };\n  const c = resolve(colour);\n  const hsl = c.hsl;\n  //console.log(hsl);\n  let hue = hsl[ 0 ];\n  if (Number.isNaN(hue) && safe) hue = 0;\n\n  let sat = hsl[ 1 ];\n  if (Number.isNaN(sat) && safe) sat = 0;\n  const parsedHsl = {\n    h: hue / 360,\n    s: sat / 100,\n    l: hsl[ 2 ] / 100,\n    opacity: 1,\n    space: `hsl`\n  } as const\n  if (c.alpha !== 1) {\n    if (`type` in (c.alpha as any)) {\n      //const alphaType = (c.alpha as any).type;\n      const alphaRaw = Number.parseFloat((c.alpha as any).raw);\n      return { ...parsedHsl, opacity: alphaRaw }\n    }\n    return { ...parsedHsl, opacity: c.alpha / 100 };\n  }\n  return parsedHsl;\n\n  // if (isHsl(colour)) return colour;\n  // const c = resolveColour(colour);\n  // // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n  // if (c === null) throw new Error(`Could not resolve colour ${ colour }`);\n\n  // if (isHsl(c)) {\n  //   if (Number.isNaN(c.h) && Number.isNaN(c.s)) {\n  //     return { h: Number.NaN, s: Number.NaN, l: c.l, opacity: c.opacity }\n  //   }\n  //   return c;\n  // }\n  // if (isRgb(c)) {\n  //   const asHsl = d3Colour.hsl(c);\n  //   if (c.opacity) return { ...asHsl, opacity: c.opacity };\n  //   return asHsl;\n  // }\n  // // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n  // throw new Error(`Could not resolve colour ${ colour }`);\n};\n\nconst hslToColorJs = (hsl: Hsl): Color => {\n  throwNumberTest(hsl.h, `percentage`, `hsl.h`);\n  throwNumberTest(hsl.s, `percentage`, `hsl.s`);\n  throwNumberTest(hsl.l, `percentage`, `hsl.l`);\n  throwNumberTest(hsl.opacity, `percentage`, `hsl.opacity`);\n\n  const coords: [ number, number, number ] = [\n    hsl.h * 360,\n    hsl.s * 100,\n    hsl.l * 100\n  ];\n  return new Color(`hsl`, coords, hsl.opacity);\n}\n\nconst oklchToColorJs = (oklch: OkLch) => {\n  throwNumberTest(oklch.l, `percentage`, `oklch.l`);\n  throwNumberTest(oklch.c, `percentage`, `oklch.c`);\n  throwNumberTest(oklch.h, `percentage`, `oklch.h`);\n  throwNumberTest(oklch.opacity, `percentage`, `oklch.opacity`);\n  const coords: [ number, number, number ] = [\n    oklch.l,\n    oklch.c * 0.4,\n    oklch.h * 360\n  ]\n  return new Color(`oklch`, coords, oklch.opacity);\n}\n\nconst rgbToColorJs = (rgb: Rgb): Color => {\n  const coords: [ number, number, number ] = [\n    rgb.r,\n    rgb.g,\n    rgb.b\n  ];\n  return `opacity` in rgb ?\n    new Color(`srgb`, coords, rgb.opacity) :\n    new Color(`srgb`, coords);\n}\n\n/**\n * Returns a colour in the best-possible CSS colour form.\n * The return value can be used setting colours in the canvas or DOM manipulations.\n * @param colour \n */\nexport const toString = (colour: Colourish): string => {\n  const c = resolve(colour);\n  return c.display();\n}\n\n\n/**\n * Returns a full HSL colour string (eg `hsl(20,50%,75%)`) based on a index.\n * It's useful for generating perceptually different shades as the index increments.\n *\n * ```\n * el.style.backgroundColor = goldenAgeColour(10);\n * ```\n *\n * Saturation and lightness can be specified, as numeric ranges of 0-1.\n *\n * @param saturation Saturation (0-1), defaults to 0.5\n * @param lightness Lightness (0-1), defaults to 0.75\n * @param alpha Opacity (0-1), defaults to 1.0\n * @returns HSL colour string eg `hsl(20,50%,75%)`\n */\nexport const goldenAngleColour = (\n  index: number,\n  saturation = 0.5,\n  lightness = 0.75,\n  alpha = 1\n) => {\n  throwNumberTest(index, `positive`, `index`);\n  throwNumberTest(saturation, `percentage`, `saturation`);\n  throwNumberTest(lightness, `percentage`, `lightness`);\n  throwNumberTest(alpha, `percentage`, `alpha`);\n\n  // Via Stackoverflow\n  const hue = index * 137.508; // use golden angle approximation\n  return alpha === 1 ? `hsl(${ hue },${ saturation * 100 }%,${ lightness * 100 }%)` : `hsl(${ hue },${ saturation * 100 }%,${ lightness * 100 }%,${ alpha * 100 }%)`;\n};\n\n/**\n * Returns a random hue component (0..359)\n * ```\n * // Generate hue\n * const h =randomHue(); // 0-359\n *\n * // Generate hue and assign as part of a HSL string\n * el.style.backgroundColor = `hsl(${randomHue(), 50%, 75%})`;\n * ```\n * @param rand\n * @returns\n */\nexport const randomHue = (rand: RandomSource = defaultRandom): number => {\n  const r = rand();\n  return r * 360;\n};\n\n/**\n * Returns a Colorjs 'Color' object based on relative hue, saturation, lightness\n * and opacity.\n * @param h Hue (0..1)\n * @param s Saturation (0..1) Default: 1\n * @param l Lightness (0..1) Default: 0.5\n * @param opacity Opacity (0..1) Default: 1\n * @returns \n */\nexport const fromHsl = (h: number, s = 1, l = 0.5, opacity = 1): Color => {\n  throwNumberTest(h, `percentage`, `h`);\n  throwNumberTest(s, `percentage`, `s`);\n  throwNumberTest(l, `percentage`, `l`);\n\n  return resolve({ h, s, l, opacity, space: `hsl` });\n}\n\n/**\n * Parses colour to `{ r, g, b }` where each field is on 0..1 scale.\n * `opacity` field is added if opacity is not 1.\n * [Named colours](https://html-color-codes.info/color-names/)\n * @param colour\n * @returns\n */\nexport const toRgb = (colour: Colourish): Rgb => {\n  const c = resolve(colour);\n  const rgb = c.srgb;\n  return c.alpha < 1 ?\n    { r: rgb.r, g: rgb.g, b: rgb.b, opacity: c.alpha, space: `srgb` } :\n    { r: rgb.r, g: rgb.g, b: rgb.b, opacity: 1, space: `srgb` };\n};\n\n/**\n * Parses a string representation of colour, or a Rgb/Hsl object.\n * If the string starts with '--' it's assumed to be a CSS variable\n * \n * See also {@link resolveToString} to resolve to a CSS colour string.\n * @param colour Colour to resolve\n * @returns Color.js Color object\n */\nexport const resolve = (colour: Colourish): Color => {\n  if (typeof colour === `string`) {\n    if (colour.startsWith(`--`)) {\n      // Resolve CSS variable\n      colour = getComputedStyle(document.body).getPropertyValue(colour);\n    }\n    return new Color(colour);\n  } else {\n    if (isHsl(colour)) return new Color(hslToColorJs(colour));\n    if (isRgb(colour)) return new Color(rgbToColorJs(colour));\n    if (isOklch(colour)) return new Color(oklchToColorJs(colour));\n  }\n\n  return colour;\n};\n\n/**\n * Like {@link resolve}, but returns a CSS-ready string\n * representation.\n * ```js\n * element.style.backgroundColor = resolveToString(`red`);\n * ```\n * \n * Tries each parameter in turn, returning the value\n * for the first that resolves. This can be useful for\n * having fallback values.\n * \n * ```js\n * // Try a CSS variable, a object property or finally fallback to red.\n * element.style.backgroundColor = resolveToString('--some-var', opts.background, `red`);\n * ```\n * @param colours Array of colours to resolve\n * @returns \n */\nexport const resolveToString = (...colours: Array<Colourish | undefined>): string => {\n  for (const colour of colours) {\n    if (colour === undefined) continue;\n    if (colour === null) continue;\n    const c = resolve(colour);\n    return c.display();\n  }\n  return `rebeccapurple`;\n}\n\n/**\n * Returns a colour in hex format `#000000`. \n * ```js\n * canvas.fillStyle = Colour.toHex(`blue`);\n * canvas.fillStyle = Colour.toHex({ h:0.5, s:0.1, l:1 });\n * canvas.fillStyle = Colour.toHex({ r: 1, g: 0.3, b: 0 });\n * ```\n * \n * Input colour can be a human-friendly colour name (\"blue\"), a HSL\n * colour (eg. \"hsl(0, 50%, 50%)\")\", an object {h,s,l} or {r,g,b}.\n * '#' is included in the return string.\n * \n * Transparent colour is returned as #00000000\n * @param colour\n * @returns Hex format, including #\n */\nexport const toHex = (colour: Colourish): string => {\n  if (typeof colour === `string` && colour === `transparent`) return `#00000000`;\n  return resolve(colour).to(`srgb`).toString({ format: `hex`, collapse: false });\n};\n\n/**\n * Returns a variation of colour with its opacity multiplied by `amt`.\n *\n * ```js\n * // Return a colour string for blue that is 50% opaque\n * opacity(`blue`, 0.5);\n * // eg: `rgba(0,0,255,0.5)`\n *\n * // Returns a colour string that is 50% more opaque\n * opacity(`hsla(200,100%,50%,50%`, 0.5);\n * // eg: `hsla(200,100%,50%,25%)`\n * ```\n *\n * [Named colours](https://html-color-codes.info/color-names/)\n * @param colour A valid CSS colour\n * @param amt Amount to multiply opacity by\n * @returns String representation of colour\n */\nexport const opacity = (colour: Colourish, amt: number): string => {\n  const c = resolve(colour);\n  c.alpha *= amt;\n  return c.toString();\n};\n\n/**\n * Gets a CSS variable.\n * ```\n * // Fetch --accent variable, or use `yellow` if not found.\n * getCssVariable(`accent`, `yellow`);\n * ```\n * @param name Name of variable. Leading '--' is unnecessary\n * @param fallbackColour Fallback colour if not found\n * @param root  Element to search variable from\n * @returns Colour or fallback.\n */\nexport const getCssVariable = (\n  name: string,\n  fallbackColour = `black`,\n  root?: HTMLElement\n): string => {\n  if (root === undefined) root = document.body;\n  if (name.startsWith(`--`)) name = name.substring(2);\n  const fromCss = getComputedStyle(root).getPropertyValue(`--${ name }`).trim();\n  if (fromCss === undefined || fromCss.length === 0) return fallbackColour;\n  return fromCss;\n};\n\n\n// export const interpolate = (\n//   amount: number,\n//   from: Colourish,\n//   to: Colourish,\n//   optsOrSpace?: string | InterpolationOpts\n// ): string => {\n//   throwNumberTest(amount, `percentage`, `amount`);\n//   if (typeof from !== `string`)\n//     throw new Error(`Expected string for 'from' param`);\n//   if (typeof to !== `string`) throw new Error(`Expected string for 'to' param`);\n\n//   let opts: InterpolationOpts;\n//   if (typeof optsOrSpace === `undefined`) opts = {};\n//   else if (typeof optsOrSpace === `string`)\n//     opts = { space: optsOrSpace as Spaces };\n//   else opts = optsOrSpace;\n\n//   const inter = getInterpolator(opts, [ from, to ]);\n//   if (inter === undefined) throw new Error(`Could not handle colour/space`);\n//   return inter(amount);\n// };\n\n\nexport const interpolator = (colours: Array<Colourish>, opts: Partial<InterpolationOpts> = {}) => {\n  const space = opts.space ?? `lch`;\n  const hue = opts.hue ?? `shorter`;\n  const pieces = interpolatorInit(colours);\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return, @typescript-eslint/no-unsafe-call\n  const ranges = pieces.map(piece => (piece[ 0 ] as any).range(piece[ 1 ], { space, hue })) as Array<Range>;\n\n  return (amt: number) => {\n    amt = clamp(amt);\n\n    // Scale to 0..1 to 0...ranges.length\n    const s = scaleNumber(amt, 0, 1, 0, ranges.length);\n    const index = Math.floor(s);\n    const amtAdjusted = s - index;\n    return ranges[ index ](amtAdjusted);\n  }\n}\n\nconst interpolatorInit = (colours: Array<Colourish>) => {\n  if (!Array.isArray(colours)) throw new Error(`Param 'colours' is not an array as expected. Got: ${ typeof colours }`);\n  if (colours.length < 2) throw new Error(`Param 'colours' should be at least two in length. Got: ${ colours.length }`);\n  const c = colours.map(colour => resolve(colour));\n  return [ ...pairwise(c) ];\n}\n\n/**\n * Produces a stepped scale of colours.\n * \n * Return result is an array of Color.js 'Colour' objects.\n * ```js\n * import { Colour } from 'ixfx/visual'\n * const steps = Colour.scale(['red','green'], 10);\n * for (const step of steps) {\n *  // Get a 'hsla(...)' string representation of colour\n *  // This can be used with the canvas, setting DOM properties etc.\n *  const css = Colour.toString(step);\n * }\n * ```\n * \n * {@link cssLinearGradient} can produce a smooth gradient in CSS on the basis\n * of the stepped colours.\n * @param colours \n * @param numberOfSteps \n * @param opts \n * @returns \n */\nexport const scale = (colours: Array<Colourish>, numberOfSteps: number, opts: Partial<InterpolationOpts> = {}) => {\n  const space = opts.space ?? `lch`;\n  const hue = opts.hue ?? `shorter`;\n  const pieces = interpolatorInit(colours);\n  const stepsPerPair = Math.floor(numberOfSteps / pieces.length);\n\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return, @typescript-eslint/no-unsafe-call\n  const steps = pieces.map(piece => (piece[ 0 ] as any).steps(piece[ 1 ],\n    { space, hue, steps: stepsPerPair, outputSpace: `srgb` }\n  )) as Array<Color>;\n\n  return steps.flat();\n}\n\n/**\n * Returns a CSS `linear-gradient` with stops corresponding to the given list of `colours`.\n * ```js\n * element.style.background = Colour.cssLinearGradient(['red','green','blue']);\n * ```\n * \n *\n * @param colours \n * @returns \n */\nexport const cssLinearGradient = (colours: Array<Colourish>) => {\n  const c = colours.map(c => resolve(c));\n  return `linear-gradient(to right, ${ c.map(v => v.display()).join(`, `) })`;\n}\n\nconst isHsl = (p: Colourish): p is Hsl => {\n  if (p === undefined || p === null) return false;\n  if (typeof p !== `object`) return false;\n\n  // Check if Colourjs\n  if ((p as Color).spaceId !== undefined) return false;\n  if ((p as Color).coords !== undefined) return false;\n\n  const space = p.space;\n  if (space !== `hsl` && space !== undefined) return false;\n  const pp = p as Hsl;\n  if (pp.h === undefined) return false;\n  if (pp.s === undefined) return false;\n  if (pp.l === undefined) return false;\n  return true;\n};\n\nconst isOklch = (p: Colourish): p is OkLch => {\n  if (p === undefined || p === null) return false;\n  if (typeof p !== `object`) return false;\n\n  // Check if Colourjs\n  if ((p as Color).spaceId !== undefined) return false;\n  if ((p as Color).coords !== undefined) return false;\n  if (p.space !== `oklch`) return false;\n  if (p.l === undefined) return false;\n  if (p.c === undefined) return false;\n  if (p.h === undefined) return false;\n  return true;\n}\n\nconst isRgb = (p: Colourish): p is Rgb => {\n  if (p === undefined || p === null) return false;\n  if (typeof p !== `object`) return false;\n  if (p.space !== `srgb` && p.space !== undefined) return false;\n  if ((p as Rgb).r === undefined) return false;\n  if ((p as Rgb).g === undefined) return false;\n  if ((p as Rgb).b === undefined) return false;\n  return true;\n};\n","// A is m x n. B is n x p. product is m x p.\nexport default function multiplyMatrices (A, B) {\n\tlet m = A.length;\n\n\tif (!Array.isArray(A[0])) {\n\t\t// A is vector, convert to [[a, b, c, ...]]\n\t\tA = [A];\n\t}\n\n\tif (!Array.isArray(B[0])) {\n\t\t// B is vector, convert to [[a], [b], [c], ...]]\n\t\tB = B.map(x => [x]);\n\t}\n\n\tlet p = B[0].length;\n\tlet B_cols = B[0].map((_, i) => B.map(x => x[i])); // transpose B\n\tlet product = A.map(row => B_cols.map(col => {\n\t\tlet ret = 0;\n\n\t\tif (!Array.isArray(row)) {\n\t\t\tfor (let c of col) {\n\t\t\t\tret += row * c;\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\n\t\tfor (let i = 0; i < row.length; i++) {\n\t\t\tret += row[i] * (col[i] || 0);\n\t\t}\n\n\t\treturn ret;\n\t}));\n\n\tif (m === 1) {\n\t\tproduct = product[0]; // Avoid [[a, b, c, ...]]\n\t}\n\n\tif (p === 1) {\n\t\treturn product.map(x => x[0]); // Avoid [[a], [b], [c], ...]]\n\t}\n\n\treturn product;\n}\n","/**\n * Various utility functions\n */\n\nexport {default as multiplyMatrices} from \"./multiply-matrices.js\";\n\n/**\n * Check if a value is a string (including a String object)\n * @param {*} str - Value to check\n * @returns {boolean}\n */\nexport function isString (str) {\n\treturn type(str) === \"string\";\n}\n\n/**\n * Determine the internal JavaScript [[Class]] of an object.\n * @param {*} o - Value to check\n * @returns {string}\n */\nexport function type (o) {\n\tlet str = Object.prototype.toString.call(o);\n\n\treturn (str.match(/^\\[object\\s+(.*?)\\]$/)[1] || \"\").toLowerCase();\n}\n\nexport function serializeNumber (n, {precision, unit }) {\n\tif (isNone(n)) {\n\t\treturn \"none\";\n\t}\n\n\treturn toPrecision(n, precision) + (unit ?? \"\");\n}\n\n/**\n * Check if a value corresponds to a none argument\n * @param {*} n - Value to check\n * @returns {boolean}\n */\nexport function isNone (n) {\n\treturn Number.isNaN(n) || (n instanceof Number && n?.none);\n}\n\n/**\n * Replace none values with 0\n */\nexport function skipNone (n) {\n\treturn isNone(n) ? 0 : n;\n}\n\n/**\n * Round a number to a certain number of significant digits\n * @param {number} n - The number to round\n * @param {number} precision - Number of significant digits\n */\nexport function toPrecision (n, precision) {\n\tif (n === 0) {\n\t\treturn 0;\n\t}\n\tlet integer = ~~n;\n\tlet digits = 0;\n\tif (integer && precision) {\n\t\tdigits = ~~Math.log10(Math.abs(integer)) + 1;\n\t}\n\tconst multiplier = 10.0 ** (precision - digits);\n\treturn Math.floor(n * multiplier + 0.5) / multiplier;\n}\n\nconst angleFactor = {\n\tdeg: 1,\n\tgrad: 0.9,\n\trad: 180 / Math.PI,\n\tturn: 360,\n};\n\n/**\n* Parse a CSS function, regardless of its name and arguments\n* @param String str String to parse\n* @return {{name, args, rawArgs}}\n*/\nexport function parseFunction (str) {\n\tif (!str) {\n\t\treturn;\n\t}\n\n\tstr = str.trim();\n\n\tconst isFunctionRegex = /^([a-z]+)\\((.+?)\\)$/i;\n\tconst isNumberRegex = /^-?[\\d.]+$/;\n\tconst unitValueRegex = /%|deg|g?rad|turn$/;\n\tconst singleArgument = /\\/?\\s*(none|[-\\w.]+(?:%|deg|g?rad|turn)?)/g;\n\tlet parts = str.match(isFunctionRegex);\n\n\tif (parts) {\n\t\t// It is a function, parse args\n\t\tlet args = [];\n\t\tparts[2].replace(singleArgument, ($0, rawArg) => {\n\t\t\tlet match = rawArg.match(unitValueRegex);\n\t\t\tlet arg = rawArg;\n\n\t\t\tif (match) {\n\t\t\t\tlet unit = match[0];\n\t\t\t\t// Drop unit from value\n\t\t\t\tlet unitlessArg = arg.slice(0, -unit.length);\n\n\t\t\t\tif (unit === \"%\") {\n\t\t\t\t\t// Convert percentages to 0-1 numbers\n\t\t\t\t\targ = new Number(unitlessArg / 100);\n\t\t\t\t\targ.type = \"<percentage>\";\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Multiply angle by appropriate factor for its unit\n\t\t\t\t\targ = new Number(unitlessArg * angleFactor[unit]);\n\t\t\t\t\targ.type = \"<angle>\";\n\t\t\t\t\targ.unit = unit;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (isNumberRegex.test(arg)) {\n\t\t\t\t// Convert numerical args to numbers\n\t\t\t\targ = new Number(arg);\n\t\t\t\targ.type = \"<number>\";\n\t\t\t}\n\t\t\telse if (arg === \"none\") {\n\t\t\t\targ = new Number(NaN);\n\t\t\t\targ.none = true;\n\t\t\t}\n\n\t\t\tif ($0.startsWith(\"/\")) {\n\t\t\t\t// It's alpha\n\t\t\t\targ = arg instanceof Number ? arg : new Number(arg);\n\t\t\t\targ.alpha = true;\n\t\t\t}\n\n\t\t\tif (typeof arg === \"object\" && arg instanceof Number) {\n\t\t\t\targ.raw = rawArg;\n\t\t\t}\n\n\t\t\targs.push(arg);\n\t\t});\n\n\t\treturn {\n\t\t\tname: parts[1].toLowerCase(),\n\t\t\trawName: parts[1],\n\t\t\trawArgs: parts[2],\n\t\t\t// An argument could be (as of css-color-4):\n\t\t\t// a number, percentage, degrees (hue), ident (in color())\n\t\t\targs,\n\t\t};\n\t}\n}\n\nexport function last (arr) {\n\treturn arr[arr.length - 1];\n}\n\nexport function interpolate (start, end, p) {\n\tif (isNaN(start)) {\n\t\treturn end;\n\t}\n\n\tif (isNaN(end)) {\n\t\treturn start;\n\t}\n\n\treturn start + (end - start) * p;\n}\n\nexport function interpolateInv (start, end, value) {\n\treturn (value - start) / (end - start);\n}\n\nexport function mapRange (from, to, value) {\n\treturn interpolate(to[0], to[1], interpolateInv(from[0], from[1], value));\n}\n\nexport function parseCoordGrammar (coordGrammars) {\n\treturn coordGrammars.map(coordGrammar => {\n\t\treturn coordGrammar.split(\"|\").map(type => {\n\t\t\ttype = type.trim();\n\t\t\tlet range = type.match(/^(<[a-z]+>)\\[(-?[.\\d]+),\\s*(-?[.\\d]+)\\]?$/);\n\n\t\t\tif (range) {\n\t\t\t\tlet ret = new String(range[1]);\n\t\t\t\tret.range = [+range[2], +range[3]];\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\treturn type;\n\t\t});\n\t});\n}\n\n/**\n * Clamp value between the minimum and maximum\n * @param {number} min minimum value to return\n * @param {number} val the value to return if it is between min and max\n * @param {number} max maximum value to return\n * @returns number\n */\nexport function clamp (min, val, max) {\n\treturn Math.max(Math.min(max, val), min);\n}\n\n/**\n * Copy sign of one value to another.\n * @param {number} - to number to copy sign to\n * @param {number} - from number to copy sign from\n * @returns number\n */\nexport function copySign (to, from) {\n\treturn Math.sign(to) === Math.sign(from) ? to : -to;\n}\n\n/**\n * Perform pow on a signed number and copy sign to result\n * @param {number} - base the base number\n * @param {number} - exp the exponent\n * @returns number\n */\nexport function spow (base, exp) {\n\treturn copySign(Math.abs(base) ** exp, base);\n}\n\n/**\n * Perform a divide, but return zero if the numerator is zero\n * @param {number} n - the numerator\n * @param {number} d - the denominator\n * @returns number\n */\nexport function zdiv (n, d) {\n\treturn (d === 0) ? 0 : n / d;\n}\n\n/**\n * Perform a bisect on a sorted list and locate the insertion point for\n * a value in arr to maintain sorted order.\n * @param {number[]} arr - array of sorted numbers\n * @param {number} value - value to find insertion point for\n * @param {number} lo - used to specify a the low end of a subset of the list\n * @param {number} hi - used to specify a the high end of a subset of the list\n * @returns number\n */\nexport function bisectLeft (arr, value, lo = 0, hi = arr.length) {\n\twhile (lo < hi) {\n\t\tconst mid = (lo + hi) >> 1;\n\t\tif (arr[mid] < value) {\n\t\t\tlo = mid + 1;\n\t\t}\n\t\telse {\n\t\t\thi = mid;\n\t\t}\n\t}\n\treturn lo;\n}\n","/**\n * A class for adding deep extensibility to any piece of JS code\n */\nexport class Hooks {\n\tadd (name, callback, first) {\n\t\tif (typeof arguments[0] != \"string\") {\n\t\t\t// Multiple hooks\n\t\t\tfor (var name in arguments[0]) {\n\t\t\t\tthis.add(name, arguments[0][name], arguments[1]);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\t(Array.isArray(name) ? name : [name]).forEach(function (name) {\n\t\t\tthis[name] = this[name] || [];\n\n\t\t\tif (callback) {\n\t\t\t\tthis[name][first ? \"unshift\" : \"push\"](callback);\n\t\t\t}\n\t\t}, this);\n\t}\n\n\trun (name, env) {\n\t\tthis[name] = this[name] || [];\n\t\tthis[name].forEach(function (callback) {\n\t\t\tcallback.call(env && env.context ? env.context : env, env);\n\t\t});\n\t}\n}\n\n/**\n * The instance of {@link Hooks} used throughout Color.js\n */\nconst hooks = new Hooks();\n\nexport default hooks;\n","// Global defaults one may want to configure\nexport default {\n\tgamut_mapping: \"css\",\n\tprecision: 5,\n\tdeltaE: \"76\", // Default deltaE method\n\tverbose: globalThis?.process?.env?.NODE_ENV?.toLowerCase() !== \"test\",\n\twarn: function warn (msg) {\n\t\tif (this.verbose) {\n\t\t\tglobalThis?.console?.warn?.(msg);\n\t\t}\n\t},\n};\n","import hooks from \"./hooks.js\";\nimport {multiplyMatrices} from \"./util.js\";\n\nexport const WHITES = {\n\t// for compatibility, the four-digit chromaticity-derived ones everyone else uses\n\tD50: [0.3457 / 0.3585, 1.00000, (1.0 - 0.3457 - 0.3585) / 0.3585],\n\tD65: [0.3127 / 0.3290, 1.00000, (1.0 - 0.3127 - 0.3290) / 0.3290],\n};\n\nexport function getWhite (name) {\n\tif (Array.isArray(name)) {\n\t\treturn name;\n\t}\n\n\treturn WHITES[name];\n}\n\n// Adapt XYZ from white point W1 to W2\nexport default function adapt (W1, W2, XYZ, options = {}) {\n\tW1 = getWhite(W1);\n\tW2 = getWhite(W2);\n\n\tif (!W1 || !W2) {\n\t\tthrow new TypeError(`Missing white point to convert ${!W1 ? \"from\" : \"\"}${!W1 && !W2 ? \"/\" : \"\"}${!W2 ? \"to\" : \"\"}`);\n\t}\n\n\tif (W1 === W2) {\n\t\t// Same whitepoints, no conversion needed\n\t\treturn XYZ;\n\t}\n\n\tlet env = {W1, W2, XYZ, options};\n\n\thooks.run(\"chromatic-adaptation-start\", env);\n\n\tif (!env.M) {\n\t\tif (env.W1 === WHITES.D65 && env.W2 === WHITES.D50) {\n\t\t\tenv.M = [\n\t\t\t\t[ 1.0479297925449969, 0.022946870601609652, -0.05019226628920524 ],\n\t\t\t\t[ 0.02962780877005599, 0.9904344267538799, -0.017073799063418826 ],\n\t\t\t\t[ -0.009243040646204504, 0.015055191490298152, 0.7518742814281371 ],\n\t\t\t];\n\t\t}\n\t\telse if (env.W1 === WHITES.D50 && env.W2 === WHITES.D65) {\n\n\t\t\tenv.M = [\n\t\t\t\t[ 0.955473421488075, -0.02309845494876471, 0.06325924320057072 ],\n\t\t\t\t[ -0.0283697093338637, 1.0099953980813041, 0.021041441191917323 ],\n\t\t\t\t[ 0.012314014864481998, -0.020507649298898964, 1.330365926242124 ],\n\t\t\t];\n\t\t}\n\t}\n\n\thooks.run(\"chromatic-adaptation-end\", env);\n\n\tif (env.M) {\n\t\treturn multiplyMatrices(env.M, env.XYZ);\n\t}\n\telse {\n\t\tthrow new TypeError(\"Only Bradford CAT with white points D50 and D65 supported for now.\");\n\t}\n}\n","import * as util from \"./util.js\";\nimport hooks from \"./hooks.js\";\nimport ColorSpace from \"./space.js\";\nimport defaults from \"./defaults.js\";\n\nconst noneTypes = new Set([\"<number>\", \"<percentage>\", \"<angle>\"]);\n\n/**\n * Validates the coordinates of a color against a format's coord grammar and\n * maps the coordinates to the range or refRange of the coordinates.\n * @param {ColorSpace} space - Colorspace the coords are in\n * @param {object} format - the format object to validate against\n * @param {string} name - the name of the color function. e.g. \"oklab\" or \"color\"\n * @returns {object[]} - an array of type metadata for each coordinate\n */\nfunction coerceCoords (space, format, name, coords) {\n\tlet types = Object.entries(space.coords).map(([id, coordMeta], i) => {\n\t\tlet coordGrammar = format.coordGrammar[i];\n\t\tlet arg = coords[i];\n\t\tlet providedType = arg?.type;\n\n\t\t// Find grammar alternative that matches the provided type\n\t\t// Non-strict equals is intentional because we are comparing w/ string objects\n\t\tlet type;\n\t\tif (arg.none) {\n\t\t\ttype = coordGrammar.find(c => noneTypes.has(c));\n\t\t}\n\t\telse {\n\t\t\ttype = coordGrammar.find(c => c == providedType);\n\t\t}\n\n\t\t// Check that each coord conforms to its grammar\n\t\tif (!type) {\n\t\t\t// Type does not exist in the grammar, throw\n\t\t\tlet coordName = coordMeta.name || id;\n\t\t\tthrow new TypeError(`${providedType ?? arg.raw} not allowed for ${coordName} in ${name}()`);\n\t\t}\n\n\t\tlet fromRange = type.range;\n\n\t\tif (providedType === \"<percentage>\") {\n\t\t\tfromRange ||= [0, 1];\n\t\t}\n\n\t\tlet toRange = coordMeta.range || coordMeta.refRange;\n\n\t\tif (fromRange && toRange) {\n\t\t\tcoords[i] = util.mapRange(fromRange, toRange, coords[i]);\n\t\t}\n\n\t\treturn type;\n\t});\n\n\treturn types;\n}\n\n\n/**\n * Convert a CSS Color string to a color object\n * @param {string} str\n * @param {object} [options]\n * @param {object} [options.meta] - Object for additional information about the parsing\n * @returns {Color}\n */\nexport default function parse (str, {meta} = {}) {\n\tlet env = {\"str\": String(str)?.trim()};\n\thooks.run(\"parse-start\", env);\n\n\tif (env.color) {\n\t\treturn env.color;\n\t}\n\n\tenv.parsed = util.parseFunction(env.str);\n\n\tif (env.parsed) {\n\t\t// Is a functional syntax\n\t\tlet name = env.parsed.name;\n\n\t\tif (name === \"color\") {\n\t\t\t// color() function\n\t\t\tlet id = env.parsed.args.shift();\n\t\t\t// Check against both <dashed-ident> and <ident> versions\n\t\t\tlet alternateId = id.startsWith(\"--\") ? id.substring(2) : `--${id}`;\n\t\t\tlet ids = [id, alternateId];\n\t\t\tlet alpha = env.parsed.rawArgs.indexOf(\"/\") > 0 ? env.parsed.args.pop() : 1;\n\n\t\t\tfor (let space of ColorSpace.all) {\n\t\t\t\tlet colorSpec = space.getFormat(\"color\");\n\n\t\t\t\tif (colorSpec) {\n\t\t\t\t\tif (ids.includes(colorSpec.id) || colorSpec.ids?.filter((specId) => ids.includes(specId)).length) {\n\t\t\t\t\t\t// From https://drafts.csswg.org/css-color-4/#color-function\n\t\t\t\t\t\t// If more <number>s or <percentage>s are provided than parameters that the colorspace takes, the excess <number>s at the end are ignored.\n\t\t\t\t\t\t// If less <number>s or <percentage>s are provided than parameters that the colorspace takes, the missing parameters default to 0. (This is particularly convenient for multichannel printers where the additional inks are spot colors or varnishes that most colors on the page won’t use.)\n\t\t\t\t\t\tconst coords = Object.keys(space.coords).map((_, i) => env.parsed.args[i] || 0);\n\n\t\t\t\t\t\tlet types;\n\n\t\t\t\t\t\tif (colorSpec.coordGrammar) {\n\t\t\t\t\t\t\ttypes = coerceCoords(space, colorSpec, \"color\", coords);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (meta) {\n\t\t\t\t\t\t\tObject.assign(meta, {formatId: \"color\", types});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (colorSpec.id.startsWith(\"--\") && !id.startsWith(\"--\")) {\n\t\t\t\t\t\t\tdefaults.warn(`${space.name} is a non-standard space and not currently supported in the CSS spec. ` +\n\t\t\t\t\t\t\t              `Use prefixed color(${colorSpec.id}) instead of color(${id}).`);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (id.startsWith(\"--\") && !colorSpec.id.startsWith(\"--\")) {\n\t\t\t\t\t\t\tdefaults.warn(`${space.name} is a standard space and supported in the CSS spec. ` +\n\t\t\t\t\t\t\t              `Use color(${colorSpec.id}) instead of prefixed color(${id}).`);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn {spaceId: space.id, coords, alpha};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Not found\n\t\t\tlet didYouMean = \"\";\n\t\t\tlet registryId = id in ColorSpace.registry ? id : alternateId;\n\t\t\tif (registryId in ColorSpace.registry) {\n\t\t\t\t// Used color space id instead of color() id, these are often different\n\t\t\t\tlet cssId = ColorSpace.registry[registryId].formats?.color?.id;\n\n\t\t\t\tif (cssId) {\n\t\t\t\t\tdidYouMean = `Did you mean color(${cssId})?`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthrow new TypeError(`Cannot parse color(${id}). ` + (didYouMean || \"Missing a plugin?\"));\n\t\t}\n\t\telse {\n\t\t\tfor (let space of ColorSpace.all) {\n\t\t\t\t// color space specific function\n\t\t\t\tlet format = space.getFormat(name);\n\t\t\t\tif (format && format.type === \"function\") {\n\t\t\t\t\tlet alpha = 1;\n\n\t\t\t\t\tif (format.lastAlpha || util.last(env.parsed.args).alpha) {\n\t\t\t\t\t\talpha = env.parsed.args.pop();\n\t\t\t\t\t}\n\n\t\t\t\t\tlet coords = env.parsed.args;\n\n\t\t\t\t\tlet types;\n\n\t\t\t\t\tif (format.coordGrammar) {\n\t\t\t\t\t\ttypes = coerceCoords(space, format, name, coords);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (meta) {\n\t\t\t\t\t\tObject.assign(meta, {formatId: format.name, types});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tspaceId: space.id,\n\t\t\t\t\t\tcoords, alpha,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\telse {\n\t\t// Custom, colorspace-specific format\n\t\tfor (let space of ColorSpace.all) {\n\t\t\tfor (let formatId in space.formats) {\n\t\t\t\tlet format = space.formats[formatId];\n\n\t\t\t\tif (format.type !== \"custom\") {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (format.test && !format.test(env.str)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tlet color = format.parse(env.str);\n\n\t\t\t\tif (color) {\n\t\t\t\t\tcolor.alpha ??= 1;\n\n\t\t\t\t\tif (meta) {\n\t\t\t\t\t\tmeta.formatId = formatId;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn color;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\n\t// If we're here, we couldn't parse\n\tthrow new TypeError(`Could not parse ${str} as a color. Missing a plugin?`);\n}\n","import ColorSpace from \"./space.js\";\nimport {isString} from \"./util.js\";\nimport parse from \"./parse.js\";\n\n/**\n * Resolves a color reference (object or string) to a plain color object\n * @param {Color | {space, coords, alpha} | string | Array<Color | {space, coords, alpha} | string> } color\n * @returns {{space, coords, alpha} | Array<{space, coords, alpha}}>\n */\nexport default function getColor (color) {\n\tif (Array.isArray(color)) {\n\t\treturn color.map(getColor);\n\t}\n\n\tif (!color) {\n\t\tthrow new TypeError(\"Empty color reference\");\n\t}\n\n\tif (isString(color)) {\n\t\tcolor = parse(color);\n\t}\n\n\t// Object fixup\n\tlet space = color.space || color.spaceId;\n\n\tif (!(space instanceof ColorSpace)) {\n\t\t// Convert string id to color space object\n\t\tcolor.space = ColorSpace.get(space);\n\t}\n\n\tif (color.alpha === undefined) {\n\t\tcolor.alpha = 1;\n\t}\n\n\treturn color;\n}\n","import {type, parseCoordGrammar, serializeNumber, mapRange} from \"./util.js\";\nimport {getWhite} from \"./adapt.js\";\nimport hooks from \"./hooks.js\";\nimport getColor from \"./getColor.js\";\n\nconst ε = .000075;\n\n/**\n * Class to represent a color space\n */\nexport default class ColorSpace {\n\tconstructor (options) {\n\t\tthis.id = options.id;\n\t\tthis.name = options.name;\n\t\tthis.base = options.base ? ColorSpace.get(options.base) : null;\n\t\tthis.aliases = options.aliases;\n\n\t\tif (this.base) {\n\t\t\tthis.fromBase = options.fromBase;\n\t\t\tthis.toBase = options.toBase;\n\t\t}\n\n\t\t// Coordinate metadata\n\n\t\tlet coords = options.coords ?? this.base.coords;\n\n\t\tfor (let name in coords) {\n\t\t\tif (!(\"name\" in coords[name])) {\n\t\t\t\tcoords[name].name = name;\n\t\t\t}\n\t\t}\n\t\tthis.coords = coords;\n\n\t\t// White point\n\n\t\tlet white = options.white ?? this.base.white ?? \"D65\";\n\t\tthis.white = getWhite(white);\n\n\t\t// Sort out formats\n\n\t\tthis.formats = options.formats ?? {};\n\n\t\tfor (let name in this.formats) {\n\t\t\tlet format = this.formats[name];\n\t\t\tformat.type ||= \"function\";\n\t\t\tformat.name ||= name;\n\t\t}\n\n\t\tif (!this.formats.color?.id) {\n\t\t\tthis.formats.color = {\n\t\t\t\t...this.formats.color ?? {},\n\t\t\t\tid: options.cssId || this.id,\n\t\t\t};\n\t\t}\n\n\t\t// Gamut space\n\n\t\tif (options.gamutSpace) {\n\t\t\t// Gamut space explicitly specified\n\t\t\tthis.gamutSpace = options.gamutSpace === \"self\" ? this : ColorSpace.get(options.gamutSpace);\n\t\t}\n\t\telse {\n\t\t\t// No gamut space specified, calculate a sensible default\n\t\t\tif (this.isPolar) {\n\t\t\t\t// Do not check gamut through polar coordinates\n\t\t\t\tthis.gamutSpace = this.base;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.gamutSpace =  this;\n\t\t\t}\n\t\t}\n\n\t\t// Optimize inGamut for unbounded spaces\n\t\tif (this.gamutSpace.isUnbounded) {\n\t\t\tthis.inGamut = (coords, options) => {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\t// Other stuff\n\t\tthis.referred = options.referred;\n\n\t\t// Compute ancestors and store them, since they will never change\n\t\tObject.defineProperty(this, \"path\", {\n\t\t\tvalue: getPath(this).reverse(),\n\t\t\twritable: false,\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true,\n\t\t});\n\n\t\thooks.run(\"colorspace-init-end\", this);\n\t}\n\n\tinGamut (coords, {epsilon = ε} = {}) {\n\t\tif (!this.equals(this.gamutSpace)) {\n\t\t\tcoords = this.to(this.gamutSpace, coords);\n\t\t\treturn this.gamutSpace.inGamut(coords, {epsilon});\n\t\t}\n\n\t\tlet coordMeta = Object.values(this.coords);\n\n\t\treturn coords.every((c, i) => {\n\t\t\tlet meta = coordMeta[i];\n\n\t\t\tif (meta.type !== \"angle\" && meta.range) {\n\t\t\t\tif (Number.isNaN(c)) {\n\t\t\t\t\t// NaN is always in gamut\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\tlet [min, max] = meta.range;\n\t\t\t\treturn (min === undefined || c >= min - epsilon)\n\t\t\t\t    && (max === undefined || c <= max + epsilon);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t});\n\t}\n\n\tget isUnbounded () {\n\t\treturn Object.values(this.coords).every(coord => !(\"range\" in coord));\n\t}\n\n\tget cssId () {\n\t\treturn this.formats?.color?.id || this.id;\n\t}\n\n\tget isPolar () {\n\t\tfor (let id in this.coords) {\n\t\t\tif (this.coords[id].type === \"angle\") {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tgetFormat (format) {\n\t\tif (typeof format === \"object\") {\n\t\t\tformat = processFormat(format, this);\n\t\t\treturn format;\n\t\t}\n\n\t\tlet ret;\n\t\tif (format === \"default\") {\n\t\t\t// Get first format\n\t\t\tret = Object.values(this.formats)[0];\n\t\t}\n\t\telse {\n\t\t\tret = this.formats[format];\n\t\t}\n\n\t\tif (ret) {\n\t\t\tret = processFormat(ret, this);\n\t\t\treturn ret;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Check if this color space is the same as another color space reference.\n\t * Allows proxying color space objects and comparing color spaces with ids.\n\t * @param {string | ColorSpace} space ColorSpace object or id to compare to\n\t * @returns {boolean}\n\t */\n\tequals (space) {\n\t\tif (!space) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn this === space || this.id === space || this.id === space.id;\n\t}\n\n\tto (space, coords) {\n\t\tif (arguments.length === 1) {\n\t\t\tconst color = getColor(space);\n\t\t\t[space, coords] = [color.space, color.coords];\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\tif (this.equals(space)) {\n\t\t\t// Same space, no change needed\n\t\t\treturn coords;\n\t\t}\n\n\t\t// Convert NaN to 0, which seems to be valid in every coordinate of every color space\n\t\tcoords = coords.map(c => Number.isNaN(c) ? 0 : c);\n\n\t\t// Find connection space = lowest common ancestor in the base tree\n\t\tlet myPath = this.path;\n\t\tlet otherPath = space.path;\n\n\t\tlet connectionSpace, connectionSpaceIndex;\n\n\t\tfor (let i = 0; i < myPath.length; i++) {\n\t\t\tif (myPath[i].equals(otherPath[i])) {\n\t\t\t\tconnectionSpace = myPath[i];\n\t\t\t\tconnectionSpaceIndex = i;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (!connectionSpace) {\n\t\t\t// This should never happen\n\t\t\tthrow new Error(`Cannot convert between color spaces ${this} and ${space}: no connection space was found`);\n\t\t}\n\n\t\t// Go up from current space to connection space\n\t\tfor (let i = myPath.length - 1; i > connectionSpaceIndex; i--) {\n\t\t\tcoords = myPath[i].toBase(coords);\n\t\t}\n\n\t\t// Go down from connection space to target space\n\t\tfor (let i = connectionSpaceIndex + 1; i < otherPath.length; i++) {\n\t\t\tcoords = otherPath[i].fromBase(coords);\n\t\t}\n\n\t\treturn coords;\n\t}\n\n\tfrom (space, coords) {\n\t\tif (arguments.length === 1) {\n\t\t\tconst color = getColor(space);\n\t\t\t[space, coords] = [color.space, color.coords];\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\treturn space.to(this, coords);\n\t}\n\n\ttoString () {\n\t\treturn `${this.name} (${this.id})`;\n\t}\n\n\tgetMinCoords () {\n\t\tlet ret = [];\n\n\t\tfor (let id in this.coords) {\n\t\t\tlet meta = this.coords[id];\n\t\t\tlet range = meta.range || meta.refRange;\n\t\t\tret.push(range?.min ?? 0);\n\t\t}\n\n\t\treturn ret;\n\t}\n\n\tstatic registry = {};\n\n\t// Returns array of unique color spaces\n\tstatic get all () {\n\t\treturn [...new Set(Object.values(ColorSpace.registry))];\n\t}\n\n\tstatic register (id, space) {\n\t\tif (arguments.length === 1) {\n\t\t\tspace = arguments[0];\n\t\t\tid = space.id;\n\t\t}\n\n\t\tspace = this.get(space);\n\n\t\tif (this.registry[id] && this.registry[id] !== space) {\n\t\t\tthrow new Error(`Duplicate color space registration: '${id}'`);\n\t\t}\n\t\tthis.registry[id] = space;\n\n\t\t// Register aliases when called without an explicit ID.\n\t\tif (arguments.length === 1 && space.aliases) {\n\t\t\tfor (let alias of space.aliases) {\n\t\t\t\tthis.register(alias, space);\n\t\t\t}\n\t\t}\n\n\t\treturn space;\n\t}\n\n\t/**\n\t * Lookup ColorSpace object by name\n\t * @param {ColorSpace | string} name\n\t */\n\tstatic get (space, ...alternatives) {\n\t\tif (!space || space instanceof ColorSpace) {\n\t\t\treturn space;\n\t\t}\n\n\t\tlet argType = type(space);\n\n\t\tif (argType === \"string\") {\n\t\t\t// It's a color space id\n\t\t\tlet ret = ColorSpace.registry[space.toLowerCase()];\n\n\t\t\tif (!ret) {\n\t\t\t\tthrow new TypeError(`No color space found with id = \"${space}\"`);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\n\t\tif (alternatives.length) {\n\t\t\treturn ColorSpace.get(...alternatives);\n\t\t}\n\n\t\tthrow new TypeError(`${space} is not a valid color space`);\n\t}\n\n\t/**\n\t * Get metadata about a coordinate of a color space\n\t *\n\t * @static\n\t * @param {Array | string} ref\n\t * @param {ColorSpace | string} [workingSpace]\n\t * @return {Object}\n\t */\n\tstatic resolveCoord (ref, workingSpace) {\n\t\tlet coordType = type(ref);\n\t\tlet space, coord;\n\n\t\tif (coordType === \"string\") {\n\t\t\tif (ref.includes(\".\")) {\n\t\t\t\t// Absolute coordinate\n\t\t\t\t[space, coord] = ref.split(\".\");\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Relative coordinate\n\t\t\t\t[space, coord] = [, ref];\n\t\t\t}\n\t\t}\n\t\telse if (Array.isArray(ref)) {\n\t\t\t[space, coord] = ref;\n\t\t}\n\t\telse {\n\t\t\t// Object\n\t\t\tspace = ref.space;\n\t\t\tcoord = ref.coordId;\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\tif (!space) {\n\t\t\tspace = workingSpace;\n\t\t}\n\n\t\tif (!space) {\n\t\t\tthrow new TypeError(`Cannot resolve coordinate reference ${ref}: No color space specified and relative references are not allowed here`);\n\t\t}\n\n\t\tcoordType = type(coord);\n\n\t\tif (coordType === \"number\" || coordType === \"string\" && coord >= 0) {\n\t\t\t// Resolve numerical coord\n\t\t\tlet meta = Object.entries(space.coords)[coord];\n\n\t\t\tif (meta) {\n\t\t\t\treturn {space, id: meta[0], index: coord, ...meta[1]};\n\t\t\t}\n\t\t}\n\n\t\tspace = ColorSpace.get(space);\n\n\t\tlet normalizedCoord = coord.toLowerCase();\n\n\t\tlet i = 0;\n\t\tfor (let id in space.coords) {\n\t\t\tlet meta = space.coords[id];\n\n\t\t\tif (id.toLowerCase() === normalizedCoord || meta.name?.toLowerCase() === normalizedCoord) {\n\t\t\t\treturn {space, id, index: i, ...meta};\n\t\t\t}\n\n\t\t\ti++;\n\t\t}\n\n\t\tthrow new TypeError(`No \"${coord}\" coordinate found in ${space.name}. Its coordinates are: ${Object.keys(space.coords).join(\", \")}`);\n\t}\n\n\tstatic DEFAULT_FORMAT = {\n\t\ttype: \"functions\",\n\t\tname: \"color\",\n\t};\n}\n\nfunction getPath (space) {\n\tlet ret = [space];\n\n\tfor (let s = space; s = s.base;) {\n\t\tret.push(s);\n\t}\n\n\treturn ret;\n}\n\nfunction processFormat (format, {coords} = {}) {\n\tif (format.coords && !format.coordGrammar) {\n\t\tformat.type ||= \"function\";\n\t\tformat.name ||= \"color\";\n\n\t\t// Format has not been processed\n\t\tformat.coordGrammar = parseCoordGrammar(format.coords);\n\n\t\tlet coordFormats = Object.entries(coords).map(([id, coordMeta], i) => {\n\t\t\t// Preferred format for each coord is the first one\n\t\t\tlet outputType = format.coordGrammar[i][0];\n\n\t\t\tlet fromRange = coordMeta.range || coordMeta.refRange;\n\t\t\tlet toRange = outputType.range, suffix = \"\";\n\n\t\t\t// Non-strict equals intentional since outputType could be a string object\n\t\t\tif (outputType == \"<percentage>\") {\n\t\t\t\ttoRange = [0, 100];\n\t\t\t\tsuffix = \"%\";\n\t\t\t}\n\t\t\telse if (outputType == \"<angle>\") {\n\t\t\t\tsuffix = \"deg\";\n\t\t\t}\n\n\t\t\treturn  {fromRange, toRange, suffix};\n\t\t});\n\n\t\tformat.serializeCoords = (coords, precision) => {\n\t\t\treturn coords.map((c, i) => {\n\t\t\t\tlet {fromRange, toRange, suffix} = coordFormats[i];\n\n\t\t\t\tif (fromRange && toRange) {\n\t\t\t\t\tc = mapRange(fromRange, toRange, c);\n\t\t\t\t}\n\n\t\t\t\tc = serializeNumber(c, {precision, unit: suffix});\n\n\t\t\t\treturn c;\n\t\t\t});\n\t\t};\n\t}\n\n\treturn format;\n}\n","import ColorSpace from \"../space.js\";\n\nexport default new ColorSpace({\n\tid: \"xyz-d65\",\n\tname: \"XYZ D65\",\n\tcoords: {\n\t\tx: {name: \"X\"},\n\t\ty: {name: \"Y\"},\n\t\tz: {name: \"Z\"},\n\t},\n\twhite: \"D65\",\n\tformats: {\n\t\tcolor: {\n\t\t\tids: [\"xyz-d65\", \"xyz\"],\n\t\t},\n\t},\n\taliases: [\"xyz\"],\n});\n","import ColorSpace from \"./space.js\";\nimport {multiplyMatrices} from \"./util.js\";\nimport adapt from \"./adapt.js\";\nimport XYZ_D65 from \"./spaces/xyz-d65.js\";\n\n/**\n * Convenience class for RGB color spaces\n * @extends {ColorSpace}\n */\nexport default class RGBColorSpace extends ColorSpace {\n\t/**\n\t * Creates a new RGB ColorSpace.\n\t * If coords are not specified, they will use the default RGB coords.\n\t * Instead of `fromBase()` and `toBase()` functions,\n\t * you can specify to/from XYZ matrices and have `toBase()` and `fromBase()` automatically generated.\n\t * @param {*} options - Same options as {@link ColorSpace} plus:\n\t * @param {number[][]} options.toXYZ_M - Matrix to convert to XYZ\n\t * @param {number[][]} options.fromXYZ_M - Matrix to convert from XYZ\n\t */\n\tconstructor (options) {\n\t\tif (!options.coords) {\n\t\t\toptions.coords = {\n\t\t\t\tr: {\n\t\t\t\t\trange: [0, 1],\n\t\t\t\t\tname: \"Red\",\n\t\t\t\t},\n\t\t\t\tg: {\n\t\t\t\t\trange: [0, 1],\n\t\t\t\t\tname: \"Green\",\n\t\t\t\t},\n\t\t\t\tb: {\n\t\t\t\t\trange: [0, 1],\n\t\t\t\t\tname: \"Blue\",\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tif (!options.base) {\n\t\t\toptions.base = XYZ_D65;\n\t\t}\n\n\t\tif (options.toXYZ_M && options.fromXYZ_M) {\n\t\t\toptions.toBase ??= rgb => {\n\t\t\t\tlet xyz = multiplyMatrices(options.toXYZ_M, rgb);\n\n\t\t\t\tif (this.white !== this.base.white) {\n\t\t\t\t\t// Perform chromatic adaptation\n\t\t\t\t\txyz = adapt(this.white, this.base.white, xyz);\n\t\t\t\t}\n\n\t\t\t\treturn xyz;\n\t\t\t};\n\n\t\t\toptions.fromBase ??= xyz => {\n\t\t\t\txyz = adapt(this.base.white, this.white, xyz);\n\t\t\t\treturn multiplyMatrices(options.fromXYZ_M, xyz);\n\t\t\t};\n\t\t}\n\n\t\toptions.referred ??= \"display\";\n\n\t\tsuper(options);\n\t}\n}\n","import ColorSpace from \"./space.js\";\nimport getColor from \"./getColor.js\";\n\n/**\n * Get the coordinates of a color in any color space\n * @param {Color} color\n * @param {string | ColorSpace} [space = color.space] The color space to convert to. Defaults to the color's current space\n * @returns {number[]} The color coordinates in the given color space\n */\nexport default function getAll (color, space) {\n\tcolor = getColor(color);\n\n\tif (!space || color.space.equals(space)) {\n\t\t// No conversion needed\n\t\treturn color.coords.slice();\n\t}\n\n\tspace = ColorSpace.get(space);\n\treturn space.from(color);\n}\n","import ColorSpace from \"./space.js\";\nimport getAll from \"./getAll.js\";\nimport getColor from \"./getColor.js\";\n\nexport default function get (color, prop) {\n\tcolor = getColor(color);\n\n\tlet {space, index} = ColorSpace.resolveCoord(prop, color.space);\n\tlet coords = getAll(color, space);\n\treturn coords[index];\n}\n","import ColorSpace from \"./space.js\";\nimport getColor from \"./getColor.js\";\n\nexport default function setAll (color, space, coords) {\n\tcolor = getColor(color);\n\n\tspace = ColorSpace.get(space);\n\tcolor.coords = space.to(color.space, coords);\n\treturn color;\n}\n\nsetAll.returns = \"color\";\n","import ColorSpace from \"./space.js\";\nimport getColor from \"./getColor.js\";\nimport get from \"./get.js\";\nimport getAll from \"./getAll.js\";\nimport setAll from \"./setAll.js\";\nimport {type} from \"./util.js\";\n\n// Set properties and return current instance\nexport default function set (color, prop, value) {\n\tcolor = getColor(color);\n\n\tif (arguments.length === 2 && type(arguments[1]) === \"object\") {\n\t\t// Argument is an object literal\n\t\tlet object = arguments[1];\n\t\tfor (let p in object) {\n\t\t\tset(color, p, object[p]);\n\t\t}\n\t}\n\telse {\n\t\tif (typeof value === \"function\") {\n\t\t\tvalue = value(get(color, prop));\n\t\t}\n\n\t\tlet {space, index} = ColorSpace.resolveCoord(prop, color.space);\n\t\tlet coords = getAll(color, space);\n\t\tcoords[index] = value;\n\t\tsetAll(color, space, coords);\n\t}\n\n\treturn color;\n}\n\nset.returns = \"color\";\n","import ColorSpace from \"../space.js\";\nimport adapt from \"../adapt.js\";\nimport XYZ_D65 from \"./xyz-d65.js\";\n\nexport default new ColorSpace({\n\tid: \"xyz-d50\",\n\tname: \"XYZ D50\",\n\twhite: \"D50\",\n\tbase: XYZ_D65,\n\tfromBase: coords => adapt(XYZ_D65.white, \"D50\", coords),\n\ttoBase: coords => adapt(\"D50\", XYZ_D65.white, coords),\n});\n","import ColorSpace from \"../space.js\";\nimport {WHITES} from \"../adapt.js\";\nimport xyz_d50 from \"./xyz-d50.js\";\n\n// κ * ε  = 2^3 = 8\nconst ε = 216 / 24389;  // 6^3/29^3 == (24/116)^3\nconst ε3 = 24 / 116;\nconst κ = 24389 / 27;   // 29^3/3^3\n\nlet white = WHITES.D50;\n\nexport default new ColorSpace({\n\tid: \"lab\",\n\tname: \"Lab\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\ta: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t\tb: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t},\n\n\t// Assuming XYZ is relative to D50, convert to CIE Lab\n\t// from CIE standard, which now defines these as a rational fraction\n\twhite,\n\n\tbase: xyz_d50,\n\t// Convert D50-adapted XYX to Lab\n\t//  CIE 15.3:2004 section 8.2.1.1\n\tfromBase (XYZ) {\n\t\t// compute xyz, which is XYZ scaled relative to reference white\n\t\tlet xyz = XYZ.map((value, i) => value / white[i]);\n\n\t\t// now compute f\n\t\tlet f = xyz.map(value => value > ε ? Math.cbrt(value) : (κ * value + 16) / 116);\n\n\t\treturn [\n\t\t\t(116 * f[1]) - 16,   // L\n\t\t\t500 * (f[0] - f[1]), // a\n\t\t\t200 * (f[1] - f[2]),  // b\n\t\t];\n\t},\n\t// Convert Lab to D50-adapted XYZ\n\t// Same result as CIE 15.3:2004 Appendix D although the derivation is different\n\t// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n\ttoBase (Lab) {\n\t\t// compute f, starting with the luminance-related term\n\t\tlet f = [];\n\t\tf[1] = (Lab[0] + 16) / 116;\n\t\tf[0] = Lab[1] / 500 + f[1];\n\t\tf[2] = f[1] - Lab[2] / 200;\n\n\t\t// compute xyz\n\t\tlet xyz = [\n\t\t\tf[0]   > ε3 ? Math.pow(f[0], 3)                : (116 * f[0] - 16) / κ,\n\t\t\tLab[0] > 8  ? Math.pow((Lab[0] + 16) / 116, 3) : Lab[0] / κ,\n\t\t\tf[2]   > ε3 ? Math.pow(f[2], 3)                : (116 * f[2] - 16) / κ,\n\t\t];\n\n\t\t// Compute XYZ by scaling xyz by reference white\n\t\treturn xyz.map((value, i) => value * white[i]);\n\t},\n\n\tformats: {\n\t\t\"lab\": {\n\t\t\tcoords: [\"<number> | <percentage>\", \"<number> | <percentage>[-1,1]\", \"<number> | <percentage>[-1,1]\"],\n\t\t},\n\t},\n});\n","export function constrain (angle) {\n\treturn ((angle % 360) + 360) % 360;\n}\n\nexport function adjust (arc, angles) {\n\tif (arc === \"raw\") {\n\t\treturn angles;\n\t}\n\n\tlet [a1, a2] = angles.map(constrain);\n\n\tlet angleDiff = a2 - a1;\n\n\tif (arc === \"increasing\") {\n\t\tif (angleDiff < 0) {\n\t\t\ta2 += 360;\n\t\t}\n\t}\n\telse if (arc === \"decreasing\") {\n\t\tif (angleDiff > 0) {\n\t\t\ta1 += 360;\n\t\t}\n\t}\n\telse if (arc === \"longer\") {\n\t\tif (-180 < angleDiff && angleDiff < 180) {\n\t\t\tif (angleDiff > 0) {\n\t\t\t\ta1 += 360;\n\t\t\t}\n\t\t\telse {\n\t\t\t\ta2 += 360;\n\t\t\t}\n\t\t}\n\t}\n\telse if (arc === \"shorter\") {\n\t\tif (angleDiff > 180) {\n\t\t\ta1 += 360;\n\t\t}\n\t\telse if (angleDiff < -180) {\n\t\t\ta2 += 360;\n\t\t}\n\t}\n\n\treturn [a1, a2];\n}\n","import ColorSpace from \"../space.js\";\nimport Lab from \"./lab.js\";\nimport {constrain as constrainAngle} from \"../angles.js\";\n\nexport default new ColorSpace({\n\tid: \"lch\",\n\tname: \"LCH\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 150],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: Lab,\n\tfromBase (Lab) {\n\t\t// Convert to polar form\n\t\tlet [L, a, b] = Lab;\n\t\tlet hue;\n\t\tconst ε = 0.02;\n\n\t\tif (Math.abs(a) < ε && Math.abs(b) < ε) {\n\t\t\thue = NaN;\n\t\t}\n\t\telse {\n\t\t\thue = Math.atan2(b, a) * 180 / Math.PI;\n\t\t}\n\n\t\treturn [\n\t\t\tL, // L is still L\n\t\t\tMath.sqrt(a ** 2 + b ** 2), // Chroma\n\t\t\tconstrainAngle(hue), // Hue, in degrees [0 to 360)\n\t\t];\n\t},\n\ttoBase (LCH) {\n\t\t// Convert from polar form\n\t\tlet [Lightness, Chroma, Hue] = LCH;\n\t\t// Clamp any negative Chroma\n\t\tif (Chroma < 0) {\n\t\t\tChroma = 0;\n\t\t}\n\t\t// Deal with NaN Hue\n\t\tif (isNaN(Hue)) {\n\t\t\tHue = 0;\n\t\t}\n\t\treturn [\n\t\t\tLightness, // L is still L\n\t\t\tChroma * Math.cos(Hue * Math.PI / 180), // a\n\t\t\tChroma * Math.sin(Hue * Math.PI / 180),  // b\n\t\t];\n\t},\n\n\tformats: {\n\t\t\"lch\": {\n\t\t\tcoords: [\"<number> | <percentage>\", \"<number> | <percentage>\", \"<number> | <angle>\"],\n\t\t},\n\t},\n});\n","import defaults from \"../defaults.js\";\nimport lab from \"../spaces/lab.js\";\nimport lch from \"../spaces/lch.js\";\nimport getColor from \"../getColor.js\";\n\n// deltaE2000 is a statistically significant improvement\n// and is recommended by the CIE and Idealliance\n// especially for color differences less than 10 deltaE76\n// but is wicked complicated\n// and many implementations have small errors!\n// DeltaE2000 is also discontinuous; in case this\n// matters to you, use deltaECMC instead.\n\nconst Gfactor = 25 ** 7;\nconst π = Math.PI;\nconst r2d = 180 / π;\nconst d2r = π / 180;\n\nfunction pow7 (x) {\n\t// Faster than x ** 7 or Math.pow(x, 7)\n\n\tconst x2 = x * x;\n\tconst x7 = x2 * x2 * x2 * x;\n\n\treturn x7;\n}\n\nexport default function (color, sample, {kL = 1, kC = 1, kH = 1} = {}) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and the function parameter as the sample,\n\t// calculate deltaE 2000.\n\n\t// This implementation assumes the parametric\n\t// weighting factors kL, kC and kH\n\t// for the influence of viewing conditions\n\t// are all 1, as sadly seems typical.\n\t// kL should be increased for lightness texture or noise\n\t// and kC increased for chroma noise\n\n\tlet [L1, a1, b1] = lab.from(color);\n\tlet C1 = lch.from(lab, [L1, a1, b1])[1];\n\tlet [L2, a2, b2] = lab.from(sample);\n\tlet C2 = lch.from(lab, [L2, a2, b2])[1];\n\n\t// Check for negative Chroma,\n\t// which might happen through\n\t// direct user input of LCH values\n\n\tif (C1 < 0) {\n\t\tC1 = 0;\n\t}\n\tif (C2 < 0) {\n\t\tC2 = 0;\n\t}\n\n\tlet Cbar = (C1 + C2) / 2; // mean Chroma\n\n\t// calculate a-axis asymmetry factor from mean Chroma\n\t// this turns JND ellipses for near-neutral colors back into circles\n\tlet C7 = pow7(Cbar);\n\n\tlet G = 0.5 * (1 - Math.sqrt(C7 / (C7 + Gfactor)));\n\n\t// scale a axes by asymmetry factor\n\t// this by the way is why there is no Lab2000 colorspace\n\tlet adash1 = (1 + G) * a1;\n\tlet adash2 = (1 + G) * a2;\n\n\t// calculate new Chroma from scaled a and original b axes\n\tlet Cdash1 = Math.sqrt(adash1 ** 2 + b1 ** 2);\n\tlet Cdash2 = Math.sqrt(adash2 ** 2 + b2 ** 2);\n\n\t// calculate new hues, with zero hue for true neutrals\n\t// and in degrees, not radians\n\n\tlet h1 = (adash1 === 0 && b1 === 0) ? 0 : Math.atan2(b1, adash1);\n\tlet h2 = (adash2 === 0 && b2 === 0) ? 0 : Math.atan2(b2, adash2);\n\n\tif (h1 < 0) {\n\t\th1 += 2 * π;\n\t}\n\tif (h2 < 0) {\n\t\th2 += 2 * π;\n\t}\n\n\th1 *= r2d;\n\th2 *= r2d;\n\n\t// Lightness and Chroma differences; sign matters\n\tlet ΔL = L2 - L1;\n\tlet ΔC = Cdash2 - Cdash1;\n\n\t// Hue difference, getting the sign correct\n\tlet hdiff = h2 - h1;\n\tlet hsum = h1 + h2;\n\tlet habs = Math.abs(hdiff);\n\tlet Δh;\n\n\tif (Cdash1 * Cdash2 === 0) {\n\t\tΔh = 0;\n\t}\n\telse if (habs <= 180) {\n\t\tΔh = hdiff;\n\t}\n\telse if (hdiff > 180) {\n\t\tΔh = hdiff - 360;\n\t}\n\telse if (hdiff < -180) {\n\t\tΔh = hdiff + 360;\n\t}\n\telse {\n\t\tdefaults.warn(\"the unthinkable has happened\");\n\t}\n\n\t// weighted Hue difference, more for larger Chroma\n\tlet ΔH = 2 * Math.sqrt(Cdash2 * Cdash1) * Math.sin(Δh * d2r / 2);\n\n\t// calculate mean Lightness and Chroma\n\tlet Ldash = (L1 + L2) / 2;\n\tlet Cdash = (Cdash1 + Cdash2) / 2;\n\tlet Cdash7 = pow7(Cdash);\n\n\t// Compensate for non-linearity in the blue region of Lab.\n\t// Four possibilities for hue weighting factor,\n\t// depending on the angles, to get the correct sign\n\tlet hdash;\n\tif (Cdash1 * Cdash2 === 0) {\n\t\thdash = hsum;   // which should be zero\n\t}\n\telse if (habs <= 180) {\n\t\thdash = hsum / 2;\n\t}\n\telse if (hsum < 360) {\n\t\thdash = (hsum + 360) / 2;\n\t}\n\telse {\n\t\thdash = (hsum - 360) / 2;\n\t}\n\n\t// positional corrections to the lack of uniformity of CIELAB\n\t// These are all trying to make JND ellipsoids more like spheres\n\n\t// SL Lightness crispening factor\n\t// a background with L=50 is assumed\n\tlet lsq = (Ldash - 50) ** 2;\n\tlet SL = 1 + ((0.015 * lsq) / Math.sqrt(20 + lsq));\n\n\t// SC Chroma factor, similar to those in CMC and deltaE 94 formulae\n\tlet SC = 1 + 0.045 * Cdash;\n\n\t// Cross term T for blue non-linearity\n\tlet T = 1;\n\tT -= (0.17 * Math.cos((     hdash - 30)  * d2r));\n\tT += (0.24 * Math.cos(  2 * hdash        * d2r));\n\tT += (0.32 * Math.cos(((3 * hdash) + 6)  * d2r));\n\tT -= (0.20 * Math.cos(((4 * hdash) - 63) * d2r));\n\n\t// SH Hue factor depends on Chroma,\n\t// as well as adjusted hue angle like deltaE94.\n\tlet SH = 1 + 0.015 * Cdash * T;\n\n\t// RT Hue rotation term compensates for rotation of JND ellipses\n\t// and Munsell constant hue lines\n\t// in the medium-high Chroma blue region\n\t// (Hue 225 to 315)\n\tlet Δθ = 30 * Math.exp(-1 * (((hdash - 275) / 25) ** 2));\n\tlet RC = 2 * Math.sqrt(Cdash7 / (Cdash7 + Gfactor));\n\tlet RT = -1 * Math.sin(2 * Δθ * d2r) * RC;\n\n\t// Finally calculate the deltaE, term by term as root sume of squares\n\tlet dE = (ΔL / (kL * SL)) ** 2;\n\tdE += (ΔC / (kC * SC)) ** 2;\n\tdE += (ΔH / (kH * SH)) ** 2;\n\tdE += RT * (ΔC / (kC * SC)) * (ΔH / (kH * SH));\n\treturn Math.sqrt(dE);\n\t// Yay!!!\n}\n","import ColorSpace from \"../space.js\";\nimport {multiplyMatrices} from \"../util.js\";\nimport XYZ_D65 from \"./xyz-d65.js\";\n\n// Recalculated for consistent reference white\n// see https://github.com/w3c/csswg-drafts/issues/6642#issuecomment-943521484\nconst XYZtoLMS_M = [\n\t[ 0.8190224379967030, 0.3619062600528904, -0.1288737815209879 ],\n\t[ 0.0329836539323885, 0.9292868615863434,  0.0361446663506424 ],\n\t[ 0.0481771893596242, 0.2642395317527308,  0.6335478284694309 ],\n];\n// inverse of XYZtoLMS_M\nconst LMStoXYZ_M = [\n\t[  1.2268798758459243, -0.5578149944602171,  0.2813910456659647 ],\n\t[ -0.0405757452148008,  1.1122868032803170, -0.0717110580655164 ],\n\t[ -0.0763729366746601, -0.4214933324022432,  1.5869240198367816 ],\n];\nconst LMStoLab_M = [\n\t[ 0.2104542683093140,  0.7936177747023054, -0.0040720430116193 ],\n\t[ 1.9779985324311684, -2.4285922420485799,  0.4505937096174110 ],\n\t[ 0.0259040424655478,  0.7827717124575296, -0.8086757549230774 ],\n];\n// LMStoIab_M inverted\nconst LabtoLMS_M = [\n\t[ 1.0000000000000000,  0.3963377773761749,  0.2158037573099136 ],\n\t[ 1.0000000000000000, -0.1055613458156586, -0.0638541728258133 ],\n\t[ 1.0000000000000000, -0.0894841775298119, -1.2914855480194092 ],\n];\n\nexport default new ColorSpace({\n\tid: \"oklab\",\n\tname: \"Oklab\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\ta: {\n\t\t\trefRange: [-0.4, 0.4],\n\t\t},\n\t\tb: {\n\t\t\trefRange: [-0.4, 0.4],\n\t\t},\n\t},\n\n\t// Note that XYZ is relative to D65\n\twhite: \"D65\",\n\tbase: XYZ_D65,\n\tfromBase (XYZ) {\n\t\t// move to LMS cone domain\n\t\tlet LMS = multiplyMatrices(XYZtoLMS_M, XYZ);\n\n\t\t// non-linearity\n\t\tlet LMSg = LMS.map(val => Math.cbrt(val));\n\n\t\treturn multiplyMatrices(LMStoLab_M, LMSg);\n\n\t},\n\ttoBase (OKLab) {\n\t\t// move to LMS cone domain\n\t\tlet LMSg = multiplyMatrices(LabtoLMS_M, OKLab);\n\n\t\t// restore linearity\n\t\tlet LMS = LMSg.map(val => val ** 3);\n\n\t\treturn multiplyMatrices(LMStoXYZ_M, LMS);\n\t},\n\n\tformats: {\n\t\t\"oklab\": {\n\t\t\tcoords: [\"<percentage> | <number>\", \"<number> | <percentage>[-1,1]\", \"<number> | <percentage>[-1,1]\"],\n\t\t},\n\t},\n});\n","// More accurate color-difference formulae\n// than the simple 1976 Euclidean distance in CIE Lab\n\nimport oklab from \"../spaces/oklab.js\";\nimport getColor from \"../getColor.js\";\n\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaEOK, term by term as root sum of squares\n\tlet [L1, a1, b1] = oklab.from(color);\n\tlet [L2, a2, b2] = oklab.from(sample);\n\tlet ΔL = L1 - L2;\n\tlet Δa = a1 - a2;\n\tlet Δb = b1 - b2;\n\treturn Math.sqrt(ΔL ** 2 + Δa ** 2 + Δb ** 2);\n}\n","import ColorSpace from \"./space.js\";\nimport getColor from \"./getColor.js\";\n\nconst ε = .000075;\n\n/**\n * Check if a color is in gamut of either its own or another color space\n * @return {Boolean} Is the color in gamut?\n */\nexport default function inGamut (color, space, {epsilon = ε} = {}) {\n\tcolor = getColor(color);\n\n\tif (!space) {\n\t\tspace = color.space;\n\t}\n\n\tspace = ColorSpace.get(space);\n\tlet coords = color.coords;\n\n\tif (space !== color.space) {\n\t\tcoords = space.from(color);\n\t}\n\n\treturn space.inGamut(coords, {epsilon});\n}\n","export default function clone (color) {\n\treturn {\n\t\tspace: color.space,\n\t\tcoords: color.coords.slice(),\n\t\talpha: color.alpha,\n\t};\n}\n","import ColorSpace from \"./space.js\";\n\n/**\n * Euclidean distance of colors in an arbitrary color space\n */\nexport default function distance (color1, color2, space = \"lab\") {\n\tspace = ColorSpace.get(space);\n\n\t// Assume getColor() is called on color in space.from()\n\tlet coords1 = space.from(color1);\n\tlet coords2 = space.from(color2);\n\n\treturn Math.sqrt(coords1.reduce((acc, c1, i) => {\n\t\tlet c2 = coords2[i];\n\t\tif (isNaN(c1) || isNaN(c2)) {\n\t\t\treturn acc;\n\t\t}\n\n\t\treturn acc + (c2 - c1) ** 2;\n\t}, 0));\n}\n","import distance from \"../distance.js\";\nimport getColor from \"../getColor.js\";\n\nexport default function deltaE76 (color, sample) {\n\t// Assume getColor() is called in the distance function\n\treturn distance(color, sample, \"lab\");\n}\n","import lab from \"../spaces/lab.js\";\nimport lch from \"../spaces/lch.js\";\nimport getColor from \"../getColor.js\";\n\n// More accurate color-difference formulae\n// than the simple 1976 Euclidean distance in Lab\n\n// CMC by the Color Measurement Committee of the\n// Bradford Society of Dyeists and Colorsts, 1994.\n// Uses LCH rather than Lab,\n// with different weights for L, C and H differences\n// A nice increase in accuracy for modest increase in complexity\nconst π = Math.PI;\nconst d2r = π / 180;\n\nexport default function (color, sample, {l = 2, c = 1} = {}) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaE CMC.\n\n\t// This implementation assumes the parametric\n\t// weighting factors l:c are 2:1\n\t// which is typical for non-textile uses.\n\n\tlet [L1, a1, b1] = lab.from(color);\n\tlet [, C1, H1] = lch.from(lab, [L1, a1, b1]);\n\tlet [L2, a2, b2] = lab.from(sample);\n\tlet C2 = lch.from(lab, [L2, a2, b2])[1];\n\n\t// let [L1, a1, b1] = color.getAll(lab);\n\t// let C1 = color.get(\"lch.c\");\n\t// let H1 = color.get(\"lch.h\");\n\t// let [L2, a2, b2] = sample.getAll(lab);\n\t// let C2 = sample.get(\"lch.c\");\n\n\t// Check for negative Chroma,\n\t// which might happen through\n\t// direct user input of LCH values\n\n\tif (C1 < 0) {\n\t\tC1 = 0;\n\t}\n\tif (C2 < 0) {\n\t\tC2 = 0;\n\t}\n\n\t// we don't need H2 as ΔH is calculated from Δa, Δb and ΔC\n\n\t// Lightness and Chroma differences\n\t// These are (color - sample), unlike deltaE2000\n\tlet ΔL = L1 - L2;\n\tlet ΔC = C1 - C2;\n\n\tlet Δa = a1 - a2;\n\tlet Δb = b1 - b2;\n\n\t// weighted Hue difference, less for larger Chroma difference\n\n\tlet H2 = (Δa ** 2) + (Δb ** 2) - (ΔC ** 2);\n\t// due to roundoff error it is possible that, for zero a and b,\n\t// ΔC > Δa + Δb is 0, resulting in attempting\n\t// to take the square root of a negative number\n\n\t// trying instead the equation from Industrial Color Physics\n\t// By Georg A. Klein\n\n\t// let ΔH = ((a1 * b2) - (a2 * b1)) / Math.sqrt(0.5 * ((C2 * C1) + (a2 * a1) + (b2 * b1)));\n\t// console.log({ΔH});\n\t// This gives the same result to 12 decimal places\n\t// except it sometimes NaNs when trying to root a negative number\n\n\t// let ΔH = Math.sqrt(H2); we never actually use the root, it gets squared again!!\n\n\t// positional corrections to the lack of uniformity of CIELAB\n\t// These are all trying to make JND ellipsoids more like spheres\n\n\t// SL Lightness crispening factor, depends entirely on L1 not L2\n\tlet SL = 0.511;\t// linear portion of the Y to L transfer function\n\tif (L1 >= 16) {\t// cubic portion\n\t\tSL = (0.040975 * L1) / (1 + 0.01765 * L1);\n\t}\n\n\t// SC Chroma factor\n\tlet SC = ((0.0638 * C1) / (1 + 0.0131 * C1)) + 0.638;\n\n\t// Cross term T for blue non-linearity\n\tlet T;\n\tif (Number.isNaN(H1)) {\n\t\tH1 = 0;\n\t}\n\n\tif (H1 >= 164 && H1 <= 345) {\n\t\tT = 0.56 + Math.abs(0.2 * Math.cos((H1 + 168) * d2r));\n\t}\n\telse {\n\t\tT = 0.36 + Math.abs(0.4 * Math.cos((H1 + 35) * d2r));\n\t}\n\t// console.log({T});\n\n\t// SH Hue factor also depends on C1,\n\tlet C4 = Math.pow(C1, 4);\n\tlet F = Math.sqrt(C4 / (C4 + 1900));\n\tlet SH = SC * ((F * T) + 1 - F);\n\n\t// Finally calculate the deltaE, term by term as root sume of squares\n\tlet dE = (ΔL / (l * SL)) ** 2;\n\tdE += (ΔC / (c * SC)) ** 2;\n\tdE += (H2 / (SH ** 2));\n\t// dE += (ΔH / SH)  ** 2;\n\treturn Math.sqrt(dE);\n\t// Yay!!!\n}\n","import ColorSpace from \"../space.js\";\nimport XYZ_D65 from \"./xyz-d65.js\";\n\nconst Yw = 203;\t// absolute luminance of media white\n\nexport default new ColorSpace({\n// Absolute CIE XYZ, with a D65 whitepoint,\n// as used in most HDR colorspaces as a starting point.\n// SDR spaces are converted per BT.2048\n// so that diffuse, media white is 203 cd/m²\n\tid: \"xyz-abs-d65\",\n\tcssId: \"--xyz-abs-d65\",\n\tname: \"Absolute XYZ D65\",\n\tcoords: {\n\t\tx: {\n\t\t\trefRange: [0, 9504.7],\n\t\t\tname: \"Xa\",\n\t\t},\n\t\ty: {\n\t\t\trefRange: [0, 10000],\n\t\t\tname: \"Ya\",\n\t\t},\n\t\tz: {\n\t\t\trefRange: [0, 10888.3],\n\t\t\tname: \"Za\",\n\t\t},\n\t},\n\n\tbase: XYZ_D65,\n\tfromBase (XYZ) {\n\t\t// Make XYZ absolute, not relative to media white\n\t\t// Maximum luminance in PQ is 10,000 cd/m²\n\t\t// Relative XYZ has Y=1 for media white\n\t\treturn XYZ.map (v => Math.max(v * Yw, 0));\n\t},\n\ttoBase (AbsXYZ) {\n\t\t// Convert to media-white relative XYZ\n\t\treturn AbsXYZ.map(v => Math.max(v / Yw, 0));\n\t},\n});\n","import ColorSpace from \"../space.js\";\nimport {multiplyMatrices} from \"../util.js\";\nimport XYZ_Abs_D65 from \"./xyz-abs-d65.js\";\n\nconst b = 1.15;\nconst g = 0.66;\nconst n = 2610 / (2 ** 14);\nconst ninv = (2 ** 14) / 2610;\nconst c1 = 3424 / (2 ** 12);\nconst c2 = 2413 / (2 ** 7);\nconst c3 = 2392 / (2 ** 7);\nconst p = 1.7 * 2523 / (2 ** 5);\nconst pinv = (2 ** 5) / (1.7 * 2523);\nconst d = -0.56;\nconst d0 = 1.6295499532821566E-11;\n\nconst XYZtoCone_M = [\n\t[  0.41478972, 0.579999,  0.0146480 ],\n\t[ -0.2015100,  1.120649,  0.0531008 ],\n\t[ -0.0166008,  0.264800,  0.6684799 ],\n];\n// XYZtoCone_M inverted\nconst ConetoXYZ_M = [\n\t[  1.9242264357876067,  -1.0047923125953657,  0.037651404030618   ],\n\t[  0.35031676209499907,  0.7264811939316552, -0.06538442294808501 ],\n\t[ -0.09098281098284752, -0.3127282905230739,  1.5227665613052603  ],\n];\nconst ConetoIab_M = [\n\t[  0.5,       0.5,       0        ],\n\t[  3.524000, -4.066708,  0.542708 ],\n\t[  0.199076,  1.096799, -1.295875 ],\n];\n// ConetoIab_M inverted\nconst IabtoCone_M = [\n\t[ 1,                   0.1386050432715393,   0.05804731615611886 ],\n\t[ 0.9999999999999999, -0.1386050432715393,  -0.05804731615611886 ],\n\t[ 0.9999999999999998, -0.09601924202631895, -0.8118918960560388  ],\n];\n\nexport default new ColorSpace({\n\tid: \"jzazbz\",\n\tname: \"Jzazbz\",\n\tcoords: {\n\t\tjz: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Jz\",\n\t\t},\n\t\taz: {\n\t\t\trefRange: [-0.5, 0.5],\n\t\t},\n\t\tbz: {\n\t\t\trefRange: [-0.5, 0.5],\n\t\t},\n\t},\n\n\tbase: XYZ_Abs_D65,\n\tfromBase (XYZ) {\n\t\t// First make XYZ absolute, not relative to media white\n\t\t// Maximum luminance in PQ is 10,000 cd/m²\n\t\t// Relative XYZ has Y=1 for media white\n\t\t// BT.2048 says media white Y=203 at PQ 58\n\n\t\tlet [ Xa, Ya, Za ] = XYZ;\n\n\t\t// modify X and Y\n\t\tlet Xm = (b * Xa) - ((b - 1) * Za);\n\t\tlet Ym = (g * Ya) - ((g - 1) * Xa);\n\n\t\t// move to LMS cone domain\n\t\tlet LMS = multiplyMatrices(XYZtoCone_M, [ Xm, Ym, Za ]);\n\n\t\t// PQ-encode LMS\n\t\tlet PQLMS = LMS.map (function (val) {\n\t\t\tlet num = c1 + (c2 * ((val / 10000) ** n));\n\t\t\tlet denom = 1 + (c3 * ((val / 10000) ** n));\n\n\t\t\treturn (num / denom)  ** p;\n\t\t});\n\n\t\t// almost there, calculate Iz az bz\n\t\tlet [ Iz, az, bz] = multiplyMatrices(ConetoIab_M, PQLMS);\n\t\t// console.log({Iz, az, bz});\n\n\t\tlet Jz = ((1 + d) * Iz) / (1 + (d * Iz)) - d0;\n\t\treturn [Jz, az, bz];\n\t},\n\ttoBase (Jzazbz) {\n\t\tlet [Jz, az, bz] = Jzazbz;\n\t\tlet Iz = (Jz + d0) / (1 + d - d * (Jz + d0));\n\n\t\t// bring into LMS cone domain\n\t\tlet PQLMS = multiplyMatrices(IabtoCone_M, [ Iz, az, bz ]);\n\n\t\t// convert from PQ-coded to linear-light\n\t\tlet LMS = PQLMS.map(function (val) {\n\t\t\tlet num = (c1 - (val ** pinv));\n\t\t\tlet denom = (c3 * (val ** pinv)) - c2;\n\t\t\tlet x = 10000 * ((num / denom) ** ninv);\n\n\t\t\treturn (x); \t// luminance relative to diffuse white, [0, 70 or so].\n\t\t});\n\n\t\t// modified abs XYZ\n\t\tlet [ Xm, Ym, Za ] = multiplyMatrices(ConetoXYZ_M, LMS);\n\n\t\t// restore standard D50 relative XYZ, relative to media white\n\t\tlet Xa = (Xm + ((b - 1) * Za)) / b;\n\t\tlet Ya = (Ym + ((g - 1) * Xa)) / g;\n\t\treturn [ Xa, Ya, Za ];\n\t},\n\n\tformats: {\n\t\t// https://drafts.csswg.org/css-color-hdr/#Jzazbz\n\t\t\"color\": {\n\t\t\tcoords: [\"<number> | <percentage>\", \"<number> | <percentage>[-1,1]\", \"<number> | <percentage>[-1,1]\"],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../space.js\";\nimport Jzazbz from \"./jzazbz.js\";\nimport {constrain as constrainAngle} from \"../angles.js\";\n\nexport default new ColorSpace({\n\tid: \"jzczhz\",\n\tname: \"JzCzHz\",\n\tcoords: {\n\t\tjz: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Jz\",\n\t\t},\n\t\tcz: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\thz: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: Jzazbz,\n\tfromBase (jzazbz) {\n\t\t// Convert to polar form\n\t\tlet [Jz, az, bz] = jzazbz;\n\t\tlet hue;\n\t\tconst ε = 0.0002; // chromatic components much smaller than a,b\n\n\t\tif (Math.abs(az) < ε && Math.abs(bz) < ε) {\n\t\t\thue = NaN;\n\t\t}\n\t\telse {\n\t\t\thue = Math.atan2(bz, az) * 180 / Math.PI;\n\t\t}\n\n\t\treturn [\n\t\t\tJz, // Jz is still Jz\n\t\t\tMath.sqrt(az ** 2 + bz ** 2), // Chroma\n\t\t\tconstrainAngle(hue), // Hue, in degrees [0 to 360)\n\t\t];\n\t},\n\ttoBase (jzczhz) {\n\t\t// Convert from polar form\n\t\t// debugger;\n\t\treturn [\n\t\t\tjzczhz[0], // Jz is still Jz\n\t\t\tjzczhz[1] * Math.cos(jzczhz[2] * Math.PI / 180), // az\n\t\t\tjzczhz[1] * Math.sin(jzczhz[2] * Math.PI / 180),  // bz\n\t\t];\n\t},\n});\n","import jzczhz from \"../spaces/jzczhz.js\";\nimport getColor from \"../getColor.js\";\n\n// More accurate color-difference formulae\n// than the simple 1976 Euclidean distance in Lab\n\n// Uses JzCzHz, which has improved perceptual uniformity\n// and thus a simple Euclidean root-sum of ΔL² ΔC² ΔH²\n// gives good results.\n\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaE in JzCzHz.\n\tlet [Jz1, Cz1, Hz1] = jzczhz.from(color);\n\tlet [Jz2, Cz2, Hz2] = jzczhz.from(sample);\n\n\t// Lightness and Chroma differences\n\t// sign does not matter as they are squared.\n\tlet ΔJ = Jz1 - Jz2;\n\tlet ΔC = Cz1 - Cz2;\n\n\t// length of chord for ΔH\n\tif ((Number.isNaN(Hz1)) && (Number.isNaN(Hz2))) {\n\t\t// both undefined hues\n\t\tHz1 = 0;\n\t\tHz2 = 0;\n\t}\n\telse if (Number.isNaN(Hz1)) {\n\t\t// one undefined, set to the defined hue\n\t\tHz1 = Hz2;\n\t}\n\telse if (Number.isNaN(Hz2)) {\n\t\tHz2 = Hz1;\n\t}\n\n\tlet Δh = Hz1 - Hz2;\n\tlet ΔH = 2 * Math.sqrt(Cz1 * Cz2) * Math.sin((Δh / 2) * (Math.PI / 180));\n\n\treturn Math.sqrt(ΔJ ** 2 + ΔC ** 2 + ΔH ** 2);\n}\n","import ColorSpace from \"../space.js\";\nimport {multiplyMatrices} from \"../util.js\";\nimport XYZ_Abs_D65 from \"./xyz-abs-d65.js\";\n\nconst c1 = 3424 / 4096;\nconst c2 = 2413 / 128;\nconst c3 = 2392 / 128;\nconst m1 = 2610 / 16384;\nconst m2 = 2523 / 32;\nconst im1 = 16384 / 2610;\nconst im2 = 32 / 2523;\n\n// The matrix below includes the 4% crosstalk components\n// and is from the Dolby \"What is ICtCp\" paper\"\nconst XYZtoLMS_M = [\n\t[  0.3592832590121217,  0.6976051147779502, -0.0358915932320290 ],\n\t[ -0.1920808463704993,  1.1004767970374321,  0.0753748658519118 ],\n\t[  0.0070797844607479,  0.0748396662186362,  0.8433265453898765 ],\n];\n// linear-light Rec.2020 to LMS, again with crosstalk\n// rational terms from Jan Fröhlich,\n// Encoding High Dynamic Range andWide Color Gamut Imagery, p.97\n// and ITU-R BT.2124-0 p.2\n/*\nconst Rec2020toLMS_M = [\n\t[ 1688 / 4096,  2146 / 4096,   262 / 4096 ],\n\t[  683 / 4096,  2951 / 4096,   462 / 4096 ],\n\t[   99 / 4096,   309 / 4096,  3688 / 4096 ]\n];\n*/\n// this includes the Ebner LMS coefficients,\n// the rotation, and the scaling to [-0.5,0.5] range\n// rational terms from Fröhlich p.97\n// and ITU-R BT.2124-0 pp.2-3\nconst LMStoIPT_M = [\n\t[  2048 / 4096,   2048 / 4096,       0      ],\n\t[  6610 / 4096, -13613 / 4096,  7003 / 4096 ],\n\t[ 17933 / 4096, -17390 / 4096,  -543 / 4096 ],\n];\n\n// inverted matrices, calculated from the above\nconst IPTtoLMS_M = [\n\t[ 0.9999999999999998,  0.0086090370379328,  0.1110296250030260 ],\n\t[ 0.9999999999999998, -0.0086090370379328, -0.1110296250030259 ],\n\t[ 0.9999999999999998,  0.5600313357106791, -0.3206271749873188 ],\n];\n/*\nconst LMStoRec2020_M = [\n\t[ 3.4375568932814012112,   -2.5072112125095058195,   0.069654319228104608382],\n\t[-0.79142868665644156125,   1.9838372198740089874,  -0.19240853321756742626 ],\n\t[-0.025646662911506476363, -0.099240248643945566751, 1.1248869115554520431  ]\n];\n*/\nconst LMStoXYZ_M = [\n\t[  2.0701522183894223, -1.3263473389671563,  0.2066510476294053 ],\n\t[  0.3647385209748072,  0.6805660249472273, -0.0453045459220347 ],\n\t[ -0.0497472075358123, -0.0492609666966131,  1.1880659249923042 ],\n];\n\n// Only the PQ form of ICtCp is implemented here. There is also an HLG form.\n// from Dolby, \"WHAT IS ICTCP?\"\n// https://professional.dolby.com/siteassets/pdfs/ictcp_dolbywhitepaper_v071.pdf\n// and\n// Dolby, \"Perceptual Color Volume\n// Measuring the Distinguishable Colors of HDR and WCG Displays\"\n// https://professional.dolby.com/siteassets/pdfs/dolby-vision-measuring-perceptual-color-volume-v7.1.pdf\nexport default new ColorSpace({\n\tid: \"ictcp\",\n\tname: \"ICTCP\",\n\t// From BT.2100-2 page 7:\n\t// During production, signal values are expected to exceed the\n\t// range E′ = [0.0 : 1.0]. This provides processing headroom and avoids\n\t// signal degradation during cascaded processing. Such values of E′,\n\t// below 0.0 or exceeding 1.0, should not be clipped during production\n\t// and exchange.\n\t// Values below 0.0 should not be clipped in reference displays (even\n\t// though they represent “negative” light) to allow the black level of\n\t// the signal (LB) to be properly set using test signals known as “PLUGE”\n\tcoords: {\n\t\ti: {\n\t\t\trefRange: [0, 1],\t// Constant luminance,\n\t\t\tname: \"I\",\n\t\t},\n\t\tct: {\n\t\t\trefRange: [-0.5, 0.5],\t// Full BT.2020 gamut in range [-0.5, 0.5]\n\t\t\tname: \"CT\",\n\t\t},\n\t\tcp: {\n\t\t\trefRange: [-0.5, 0.5],\n\t\t\tname: \"CP\",\n\t\t},\n\t},\n\n\tbase: XYZ_Abs_D65,\n\tfromBase (XYZ) {\n\t\t// move to LMS cone domain\n\t\tlet LMS = multiplyMatrices(XYZtoLMS_M, XYZ);\n\n\t\treturn LMStoICtCp(LMS);\n\t},\n\ttoBase (ICtCp) {\n\t\tlet LMS = ICtCptoLMS(ICtCp);\n\n\t\treturn multiplyMatrices(LMStoXYZ_M, LMS);\n\t},\n});\n\nfunction LMStoICtCp (LMS) {\n\t// apply the PQ EOTF\n\t// we can't ever be dividing by zero because of the \"1 +\" in the denominator\n\tlet PQLMS = LMS.map (function (val) {\n\t\tlet num = c1 + (c2 * ((val / 10000) ** m1));\n\t\tlet denom = 1 + (c3 * ((val / 10000) ** m1));\n\n\t\treturn (num / denom)  ** m2;\n\t});\n\n\t// LMS to IPT, with rotation for Y'C'bC'r compatibility\n\treturn multiplyMatrices(LMStoIPT_M, PQLMS);\n}\n\nfunction ICtCptoLMS (ICtCp) {\n\tlet PQLMS = multiplyMatrices(IPTtoLMS_M, ICtCp);\n\n\t// From BT.2124-0 Annex 2 Conversion 3\n\tlet LMS = PQLMS.map (function (val) {\n\t\tlet num  = Math.max((val ** im2) - c1, 0);\n\t\tlet denom = (c2 - (c3 * (val ** im2)));\n\t\treturn 10000 * ((num / denom) ** im1);\n\t});\n\n\treturn LMS;\n}\n","import ictcp from \"../spaces/ictcp.js\";\nimport getColor from \"../getColor.js\";\n\n// Delta E in ICtCp space,\n// which the ITU calls Delta E ITP, which is shorter\n// formulae from ITU Rec. ITU-R BT.2124-0\n\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\t// Given this color as the reference\n\t// and a sample,\n\t// calculate deltaE in ICtCp\n\t// which is simply the Euclidean distance\n\n\tlet [ I1, T1, P1 ] = ictcp.from(color);\n\tlet [ I2, T2, P2 ] = ictcp.from(sample);\n\n\t// the 0.25 factor is to undo the encoding scaling in Ct\n\t// the 720 is so that 1 deltaE = 1 JND\n\t// per  ITU-R BT.2124-0 p.3\n\n\treturn 720 * Math.sqrt((I1 - I2) ** 2 + (0.25 * (T1 - T2) ** 2) + (P1 - P2) ** 2);\n}\n","import ColorSpace from \"../space.js\";\nimport {multiplyMatrices, interpolate, copySign, spow, zdiv, bisectLeft} from \"../util.js\";\nimport {constrain} from \"../angles.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\nimport {WHITES} from \"../adapt.js\";\n\nconst white = WHITES.D65;\nconst adaptedCoef = 0.42;\nconst adaptedCoefInv = 1 / adaptedCoef;\nconst tau = 2 * Math.PI;\n\nconst cat16 = [\n\t[  0.401288,  0.650173, -0.051461 ],\n\t[ -0.250268,  1.204414,  0.045854 ],\n\t[ -0.002079,  0.048952,  0.953127 ],\n];\n\nconst cat16Inv = [\n\t[1.8620678550872327, -1.0112546305316843, 0.14918677544445175],\n\t[0.38752654323613717, 0.6214474419314753, -0.008973985167612518],\n\t[-0.015841498849333856, -0.03412293802851557, 1.0499644368778496],\n];\n\nconst m1 = [\n\t[460.0, 451.0, 288.0],\n\t[460.0, -891.0, -261.0],\n\t[460.0, -220.0, -6300.0],\n];\n\nconst surroundMap = {\n\tdark: [0.8, 0.525, 0.8],\n\tdim: [0.9, 0.59, 0.9],\n\taverage: [1, 0.69, 1],\n};\n\nconst hueQuadMap = {\n\t// Red, Yellow, Green, Blue, Red\n\th: [20.14, 90.00, 164.25, 237.53, 380.14],\n\te: [0.8, 0.7, 1.0, 1.2, 0.8],\n\tH: [0.0, 100.0, 200.0, 300.0, 400.0],\n};\n\nconst rad2deg = 180 / Math.PI;\nconst deg2rad = Math.PI / 180;\n\nexport function adapt (coords, fl) {\n\tconst temp = coords.map(c => {\n\t\tconst x = spow(fl * Math.abs(c) * 0.01, adaptedCoef);\n\t\treturn 400 * copySign(x, c) / (x + 27.13);\n\t});\n\treturn temp;\n}\n\nexport function unadapt (adapted, fl) {\n\tconst constant = 100 / fl * (27.13 ** adaptedCoefInv);\n\treturn adapted.map(c => {\n\t\tconst cabs = Math.abs(c);\n\t\treturn copySign(constant * spow(cabs / (400 - cabs), adaptedCoefInv), c);\n\t});\n}\n\nexport function hueQuadrature (h) {\n\tlet hp = constrain(h);\n\tif (hp <= hueQuadMap.h[0]) {\n\t\thp += 360;\n\t}\n\n\tconst i = bisectLeft(hueQuadMap.h, hp) - 1;\n\tconst [hi, hii] = hueQuadMap.h.slice(i, i + 2);\n\tconst [ei, eii] = hueQuadMap.e.slice(i, i + 2);\n\tconst Hi = hueQuadMap.H[i];\n\n\tconst t = (hp - hi) / ei;\n\treturn Hi + (100 * t) / (t + (hii - hp) / eii);\n}\n\nexport function invHueQuadrature (H) {\n\tlet Hp = ((H % 400 + 400) % 400);\n\tconst i = Math.floor(0.01 * Hp);\n\tHp = Hp % 100;\n\tconst [hi, hii] = hueQuadMap.h.slice(i, i + 2);\n\tconst [ei, eii] = hueQuadMap.e.slice(i, i + 2);\n\n\treturn constrain(\n\t\t(Hp * (eii * hi - ei * hii) - 100 * hi * eii) /\n\t\t(Hp * (eii - ei) - 100 * eii),\n\t);\n}\n\nexport function environment (\n\trefWhite,\n\tadaptingLuminance,\n\tbackgroundLuminance,\n\tsurround,\n\tdiscounting,\n) {\n\n\tconst env = {};\n\n\tenv.discounting = discounting;\n\tenv.refWhite = refWhite;\n\tenv.surround = surround;\n\tconst xyzW = refWhite.map(c => {\n\t\treturn c * 100;\n\t});\n\n\t// The average luminance of the environment in `cd/m^2cd/m` (a.k.a. nits)\n\tenv.la = adaptingLuminance;\n\t// The relative luminance of the nearby background\n\tenv.yb = backgroundLuminance;\n\t// Absolute luminance of the reference white.\n\tconst yw = xyzW[1];\n\n\t// Cone response for reference white\n\tconst rgbW = multiplyMatrices(cat16, xyzW);\n\n\t// Surround: dark, dim, and average\n\tsurround = surroundMap[env.surround];\n\tconst f = surround[0];\n\tenv.c = surround[1];\n\tenv.nc = surround[2];\n\n\tconst k = 1 / (5 * env.la + 1);\n\tconst k4 = k ** 4;\n\n\t// Factor of luminance level adaptation\n\tenv.fl = (k4 * env.la + 0.1 * (1 - k4) * (1 - k4) * Math.cbrt(5 * env.la));\n\tenv.flRoot = env.fl ** 0.25;\n\n\tenv.n = env.yb / yw;\n\tenv.z = 1.48 + Math.sqrt(env.n);\n\tenv.nbb = 0.725 * (env.n ** -0.2);\n\tenv.ncb = env.nbb;\n\n\t// Degree of adaptation calculating if not discounting\n\t// illuminant (assumed eye is fully adapted)\n\tconst d = (discounting) ?\n\t\t1 :\n\t\tMath.max(\n\t\t\tMath.min(f * (1 - 1 / 3.6 * Math.exp((-env.la - 42) / 92)), 1),\n\t\t\t0,\n\t\t);\n\tenv.dRgb = rgbW.map(c => {\n\t\treturn interpolate(1, yw / c, d);\n\t});\n\tenv.dRgbInv = env.dRgb.map(c => {\n\t\treturn 1 / c;\n\t});\n\n\t// Achromatic response\n\tconst rgbCW = rgbW.map((c, i) => {\n\t\treturn c * env.dRgb[i];\n\t});\n\tconst rgbAW = adapt(rgbCW, env.fl);\n\tenv.aW = env.nbb * (2 * rgbAW[0] + rgbAW[1] + 0.05 * rgbAW[2]);\n\n\t// console.log(env);\n\n\treturn env;\n}\n\n// Pre-calculate everything we can with the viewing conditions\nconst viewingConditions = environment(\n\twhite,\n\t64 / Math.PI * 0.2, 20,\n\t\"average\",\n\tfalse,\n);\n\nexport function fromCam16 (cam16, env) {\n\n\t// These check ensure one, and only one attribute for a\n\t// given category is provided.\n\tif (!((cam16.J !== undefined) ^ (cam16.Q !== undefined))) {\n\t\tthrow new Error(\"Conversion requires one and only one: 'J' or 'Q'\");\n\t}\n\n\tif (!((cam16.C !== undefined) ^ (cam16.M !== undefined) ^ (cam16.s !== undefined))) {\n\t\tthrow new Error(\"Conversion requires one and only one: 'C', 'M' or 's'\");\n\t}\n\n\t// Hue is absolutely required\n\tif (!((cam16.h !== undefined) ^ (cam16.H !== undefined))) {\n\t\tthrow new Error(\"Conversion requires one and only one: 'h' or 'H'\");\n\t}\n\n\t// Black\n\tif (cam16.J === 0.0 || cam16.Q === 0.0) {\n\t\treturn [0.0, 0.0, 0.0];\n\t}\n\n\t// Break hue into Cartesian components\n\tlet hRad = 0.0;\n\tif (cam16.h !== undefined) {\n\t\thRad = constrain(cam16.h) * deg2rad;\n\t}\n\telse {\n\t\thRad = invHueQuadrature(cam16.H) * deg2rad;\n\t}\n\n\tconst cosh = Math.cos(hRad);\n\tconst sinh = Math.sin(hRad);\n\n\t// Calculate `Jroot` from one of the lightness derived coordinates.\n\tlet Jroot = 0.0;\n\tif (cam16.J !== undefined) {\n\t\tJroot = spow(cam16.J, 1 / 2) * 0.1;\n\t}\n\telse if (cam16.Q !== undefined) {\n\t\tJroot = 0.25 * env.c * cam16.Q / ((env.aW + 4) * env.flRoot);\n\t}\n\n\t// Calculate the `t` value from one of the chroma derived coordinates\n\tlet alpha = 0.0;\n\tif (cam16.C !== undefined) {\n\t\talpha = cam16.C / Jroot;\n\t}\n\telse if (cam16.M !== undefined) {\n\t\talpha = (cam16.M / env.flRoot) / Jroot;\n\t}\n\telse if (cam16.s !== undefined) {\n\t\talpha = 0.0004 * (cam16.s ** 2) * (env.aW + 4) / env.c;\n\t}\n\tconst t = spow(\n\t\talpha * Math.pow(1.64 - Math.pow(0.29, env.n), -0.73),\n\t\t10 / 9,\n\t);\n\n\t// Eccentricity\n\tconst et = 0.25 * (Math.cos(hRad + 2) + 3.8);\n\n\t// Achromatic response\n\tconst A = env.aW * spow(Jroot, 2 / env.c / env.z);\n\n\t// Calculate red-green and yellow-blue components\n\tconst p1 = 5e4 / 13 * env.nc * env.ncb * et;\n\tconst p2 = A / env.nbb;\n\tconst r = (\n\t\t23 * (p2 + 0.305) *\n\t\tzdiv(t, 23 * p1 + t * (11 * cosh + 108 * sinh))\n\t);\n\tconst a = r * cosh;\n\tconst b = r * sinh;\n\n\t// Calculate back from cone response to XYZ\n\tconst rgb_c = unadapt(\n\t\tmultiplyMatrices(m1, [p2, a, b]).map(c => {\n\t\t\treturn c * 1 / 1403;\n\t\t}),\n\t\tenv.fl,\n\t);\n\treturn multiplyMatrices(\n\t\tcat16Inv,\n\t\trgb_c.map((c, i) => {\n\t\t\treturn c * env.dRgbInv[i];\n\t\t}),\n\t).map(c => {\n\t\treturn c / 100;\n\t});\n}\n\n\nexport function toCam16 (xyzd65, env) {\n\t// Cone response\n\tconst xyz100 = xyzd65.map(c => {\n\t\treturn c * 100;\n\t});\n\tconst rgbA = adapt(\n\t\tmultiplyMatrices(cat16, xyz100).map((c, i) => {\n\t\t\treturn c * env.dRgb[i];\n\t\t}),\n\t\tenv.fl,\n\t);\n\n\t// Calculate hue from red-green and yellow-blue components\n\tconst a = rgbA[0] + (-12 * rgbA[1] + rgbA[2]) / 11;\n\tconst b = (rgbA[0] + rgbA[1] - 2 * rgbA[2]) / 9;\n\tconst hRad = ((Math.atan2(b, a) % tau) + tau) % tau;\n\n\t// Eccentricity\n\tconst et = 0.25 * (Math.cos(hRad + 2) + 3.8);\n\n\tconst t = (\n\t\t5e4 / 13 * env.nc * env.ncb *\n\t\tzdiv(\n\t\t\tet * Math.sqrt(a ** 2 + b ** 2),\n\t\t\trgbA[0] + rgbA[1] + 1.05 * rgbA[2] + 0.305,\n\t\t)\n\t);\n\tconst alpha = spow(t, 0.9) * Math.pow(1.64 - Math.pow(0.29, env.n), 0.73);\n\n\t// Achromatic response\n\tconst A = env.nbb * (2 * rgbA[0] + rgbA[1] + 0.05 * rgbA[2]);\n\n\tconst Jroot = spow(A / env.aW, 0.5 * env.c * env.z);\n\n\t// Lightness\n\tconst J = 100 * spow(Jroot, 2);\n\n\t// Brightness\n\tconst Q = (4 / env.c * Jroot * (env.aW + 4) * env.flRoot);\n\n\t// Chroma\n\tconst C = alpha * Jroot;\n\n\t// Colorfulness\n\tconst M = C * env.flRoot;\n\n\t// Hue\n\tconst h = constrain(hRad * rad2deg);\n\n\t// Hue quadrature\n\tconst H = hueQuadrature(h);\n\n\t// Saturation\n\tconst s = 50 * spow(env.c * alpha / (env.aW + 4), 1 / 2);\n\n\t// console.log({J: J, C: C, h: h, s: s, Q: Q, M: M, H: H});\n\n\treturn {J: J, C: C, h: h, s: s, Q: Q, M: M, H: H};\n}\n\n\n// Provided as a way to directly evaluate the CAM16 model\n// https://observablehq.com/@jrus/cam16: reference implementation\n// https://arxiv.org/pdf/1802.06067.pdf: Nico Schlömer\n// https://onlinelibrary.wiley.com/doi/pdf/10.1002/col.22324: hue quadrature\n// https://www.researchgate.net/publication/318152296_Comprehensive_color_solutions_CAM16_CAT16_and_CAM16-UCS\n// Results compared against: https://github.com/colour-science/colour\nexport default new ColorSpace({\n\tid: \"cam16-jmh\",\n\tcssId: \"--cam16-jmh\",\n\tname: \"CAM16-JMh\",\n\tcoords: {\n\t\tj: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"J\",\n\t\t},\n\t\tm: {\n\t\t\trefRange: [0, 105.0],\n\t\t\tname: \"Colorfulness\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: xyz_d65,\n\n\tfromBase (xyz) {\n\t\tconst cam16 = toCam16(xyz, viewingConditions);\n\t\treturn [cam16.J, cam16.M, cam16.h];\n\t},\n\ttoBase (cam16) {\n\t\treturn fromCam16(\n\t\t\t{J: cam16[0], M: cam16[1], h: cam16[2]},\n\t\t\tviewingConditions,\n\t\t);\n\t},\n});\n","import ColorSpace from \"../space.js\";\nimport {constrain} from \"../angles.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\nimport {fromCam16, toCam16, environment} from \"./cam16.js\";\nimport {WHITES} from \"../adapt.js\";\n\nconst white = WHITES.D65;\nconst ε = 216 / 24389;  // 6^3/29^3 == (24/116)^3\nconst κ = 24389 / 27;   // 29^3/3^3\n\nfunction toLstar (y) {\n\t// Convert XYZ Y to L*\n\n\tconst fy = (y > ε) ? Math.cbrt(y) : (κ * y + 16) / 116;\n\treturn (116.0 * fy) - 16.0;\n}\n\nfunction fromLstar (lstar) {\n\t// Convert L* back to XYZ Y\n\n\treturn (lstar > 8) ?  Math.pow((lstar + 16) / 116, 3) : lstar / κ;\n}\n\nfunction fromHct (coords, env) {\n\t// Use Newton's method to try and converge as quick as possible or\n\t// converge as close as we can. While the requested precision is achieved\n\t// most of the time, it may not always be achievable. Especially past the\n\t// visible spectrum, the algorithm will likely struggle to get the same\n\t// precision. If, for whatever reason, we cannot achieve the accuracy we\n\t// seek in the allotted iterations, just return the closest we were able to\n\t// get.\n\n\tlet [h, c, t] = coords;\n\tlet xyz = [];\n\tlet j = 0;\n\n\t// Shortcut out for black\n\tif (t === 0) {\n\t\treturn [0.0, 0.0, 0.0];\n\t}\n\n\t// Calculate the Y we need to target\n\tlet y = fromLstar(t);\n\n\t// A better initial guess yields better results. Polynomials come from\n\t// curve fitting the T vs J response.\n\tif (t > 0) {\n\t\tj = 0.00379058511492914 * t ** 2 + 0.608983189401032 * t + 0.9155088574762233;\n\t}\n\telse {\n\t\tj = 9.514440756550361e-06 * t ** 2 + 0.08693057439788597 * t - 21.928975842194614;\n\t}\n\n\t// Threshold of how close is close enough, and max number of attempts.\n\t// More precision and more attempts means more time spent iterating. Higher\n\t// required precision gives more accuracy but also increases the chance of\n\t// not hitting the goal. 2e-12 allows us to convert round trip with\n\t// reasonable accuracy of six decimal places or more.\n\tconst threshold = 2e-12;\n\tconst max_attempts = 15;\n\n\tlet attempt = 0;\n\tlet last = Infinity;\n\tlet best = j;\n\n\t// Try to find a J such that the returned y matches the returned y of the L*\n\twhile (attempt <= max_attempts) {\n\t\txyz = fromCam16({J: j, C: c, h: h}, env);\n\n\t\t// If we are within range, return XYZ\n\t\t// If we are closer than last time, save the values\n\t\tconst delta = Math.abs(xyz[1] - y);\n\t\tif (delta < last) {\n\t\t\tif (delta <= threshold) {\n\t\t\t\treturn xyz;\n\t\t\t}\n\t\t\tbest = j;\n\t\t\tlast = delta;\n\t\t}\n\n\t\t// f(j_root) = (j ** (1 / 2)) * 0.1\n\t\t// f(j) = ((f(j_root) * 100) ** 2) / j - 1 = 0\n\t\t// f(j_root) = Y = y / 100\n\t\t// f(j) = (y ** 2) / j - 1\n\t\t// f'(j) = (2 * y) / j\n\t\tj = j - (xyz[1] - y) * j / (2 * xyz[1]);\n\n\t\tattempt += 1;\n\t}\n\n\t// We could not acquire the precision we desired,\n\t// return our closest attempt.\n\treturn fromCam16({J: j, C: c, h: h}, env);\n}\n\nfunction toHct (xyz, env) {\n\t// Calculate HCT by taking the L* of CIE LCh D65 and CAM16 chroma and hue.\n\n\tconst t = toLstar(xyz[1]);\n\tif (t === 0.0) {\n\t\treturn [0.0, 0.0, 0.0];\n\t}\n\tconst cam16 = toCam16(xyz, viewingConditions);\n\treturn [constrain(cam16.h), cam16.C, t];\n}\n\n// Pre-calculate everything we can with the viewing conditions\nexport const viewingConditions = environment(\n\twhite, 200 / Math.PI * fromLstar(50.0),\n\tfromLstar(50.0) * 100,\n\t\"average\",\n\tfalse,\n);\n\n// https://material.io/blog/science-of-color-design\n// This is not a port of the material-color-utilities,\n// but instead implements the full color space as described,\n// combining CAM16 JCh and Lab D65. This does not clamp conversion\n// to HCT to specific chroma bands and provides support for wider\n// gamuts than Google currently supports and does so at a greater\n// precision (> 8 bits back to sRGB).\n// This implementation comes from https://github.com/facelessuser/coloraide\n// which is licensed under MIT.\nexport default new ColorSpace({\n\tid: \"hct\",\n\tname: \"HCT\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 145],\n\t\t\tname: \"Colorfulness\",\n\t\t},\n\t\tt: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Tone\",\n\t\t},\n\t},\n\n\tbase: xyz_d65,\n\n\tfromBase (xyz) {\n\t\treturn toHct(xyz, viewingConditions);\n\t},\n\ttoBase (hct) {\n\t\treturn fromHct(hct, viewingConditions);\n\t},\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--hct\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import hct from \"../spaces/hct.js\";\nimport {viewingConditions} from \"../spaces/hct.js\";\nimport getColor from \"../getColor.js\";\n\nconst rad2deg = 180 / Math.PI;\nconst deg2rad = Math.PI / 180;\nconst ucsCoeff = [1.00, 0.007, 0.0228];\n\n/**\n* Convert HCT chroma and hue (CAM16 JMh colorfulness and hue) using UCS logic for a and b.\n* @param {number[]} coords - HCT coordinates.\n* @return {number[]}\n*/\nfunction convertUcsAb (coords) {\n\t// We want the distance between the actual color.\n\t// If chroma is negative, it will throw off our calculations.\n\t// Normally, converting back to the base and forward will correct it.\n\t// If we have a negative chroma after this, then we have a color that\n\t// cannot resolve to positive chroma.\n\tif (coords[1] < 0) {\n\t\tcoords = hct.fromBase(hct.toBase(coords));\n\t}\n\n\t// Only in extreme cases (usually outside the visible spectrum)\n\t// can the input value for log become negative.\n\t// Avoid domain error by forcing a zero result via \"max\" if necessary.\n\tconst M = Math.log(Math.max(1 + ucsCoeff[2] * coords[1] * viewingConditions.flRoot, 1.0)) / ucsCoeff[2];\n\tconst hrad = coords[0] * deg2rad;\n\tconst a = M * Math.cos(hrad);\n\tconst b = M * Math.sin(hrad);\n\n\treturn [coords[2], a, b];\n}\n\n\n/**\n* Color distance using HCT.\n* @param {Color} color - Color to compare.\n* @param {Color} sample - Color to compare.\n* @return {number[]}\n*/\nexport default function (color, sample) {\n\t[color, sample] = getColor([color, sample]);\n\n\tlet [ t1, a1, b1 ] = convertUcsAb(hct.from(color));\n\tlet [ t2, a2, b2 ] = convertUcsAb(hct.from(sample));\n\n\t// Use simple euclidean distance with a and b using UCS conversion\n\t// and LCh lightness (HCT tone).\n\treturn Math.sqrt((t1 - t2) ** 2 + (a1 - a2) ** 2 + (b1 - b2) ** 2);\n}\n","import deltaE76 from \"./deltaE76.js\";\nimport deltaECMC from \"./deltaECMC.js\";\nimport deltaE2000 from \"./deltaE2000.js\";\nimport deltaEJz from \"./deltaEJz.js\";\nimport deltaEITP from \"./deltaEITP.js\";\nimport deltaEOK from \"./deltaEOK.js\";\nimport deltaEHCT from \"./deltaEHCT.js\";\n\nexport {\n\tdeltaE76,\n\tdeltaECMC,\n\tdeltaE2000,\n\tdeltaEJz,\n\tdeltaEITP,\n\tdeltaEOK,\n\tdeltaEHCT,\n};\n\nexport default {\n\tdeltaE76,\n\tdeltaECMC,\n\tdeltaE2000,\n\tdeltaEJz,\n\tdeltaEITP,\n\tdeltaEOK,\n\tdeltaEHCT,\n};\n","import * as util from \"./util.js\";\nimport ColorSpace from \"./space.js\";\nimport defaults from \"./defaults.js\";\nimport deltaE2000 from \"./deltaE/deltaE2000.js\";\nimport deltaEOK from \"./deltaE/deltaEOK.js\";\nimport inGamut from \"./inGamut.js\";\nimport to from \"./to.js\";\nimport get from \"./get.js\";\nimport oklab from \"./spaces/oklab.js\";\nimport set from \"./set.js\";\nimport clone from \"./clone.js\";\nimport getColor from \"./getColor.js\";\nimport deltaEMethods from \"./deltaE/index.js\";\nimport {WHITES} from \"./adapt.js\";\n\n/**\n * Calculate the epsilon to 2 degrees smaller than the specified JND.\n * @param {Number} jnd - The target \"just noticeable difference\".\n * @returns {Number}\n */\nfunction calcEpsilon (jnd) {\n\t// Calculate the epsilon to 2 degrees smaller than the specified JND.\n\n\tconst order = (!jnd) ? 0 : Math.floor(Math.log10(Math.abs(jnd)));\n\t// Limit to an arbitrary value to ensure value is never too small and causes infinite loops.\n\treturn Math.max(parseFloat(`1e${order - 2}`), 1e-6);\n}\n\nconst GMAPPRESET = {\n\t\"hct\": {\n\t\tmethod: \"hct.c\",\n\t\tjnd: 2,\n\t\tdeltaEMethod: \"hct\",\n\t\tblackWhiteClamp: {},\n\t},\n\t\"hct-tonal\": {\n\t\tmethod: \"hct.c\",\n\t\tjnd: 0,\n\t\tdeltaEMethod: \"hct\",\n\t\tblackWhiteClamp: { channel: \"hct.t\", min: 0, max: 100 },\n\t},\n};\n\n/**\n * Force coordinates to be in gamut of a certain color space.\n * Mutates the color it is passed.\n * @param {Object|string} options object or spaceId string\n * @param {string} options.method - How to force into gamut.\n *        If \"clip\", coordinates are just clipped to their reference range.\n *        If \"css\", coordinates are reduced according to the CSS 4 Gamut Mapping Algorithm.\n *        If in the form [colorSpaceId].[coordName], that coordinate is reduced\n *        until the color is in gamut. Please note that this may produce nonsensical\n *        results for certain coordinates (e.g. hue) or infinite loops if reducing the coordinate never brings the color in gamut.\n * @param {ColorSpace|string} options.space - The space whose gamut we want to map to\n * @param {string} options.deltaEMethod - The delta E method to use while performing gamut mapping.\n *        If no method is specified, delta E 2000 is used.\n * @param {Number} options.jnd - The \"just noticeable difference\" to target.\n * @param {Object} options.blackWhiteClamp - Used to configure SDR black and clamping.\n *        \"channel\" indicates the \"space.channel\" to use for determining when to clamp.\n *        \"min\" indicates the lower limit for black clamping and \"max\" indicates the upper\n *        limit for white clamping.\n */\n\nexport default function toGamut (\n\tcolor,\n\t{\n\t\tmethod = defaults.gamut_mapping,\n\t\tspace = undefined,\n\t\tdeltaEMethod = \"\",\n\t\tjnd = 2,\n\t\tblackWhiteClamp = {},\n\t} = {},\n) {\n\tcolor = getColor(color);\n\n\tif (util.isString(arguments[1])) {\n\t\tspace = arguments[1];\n\t}\n\telse if (!space) {\n\t\tspace = color.space;\n\t}\n\n\tspace = ColorSpace.get(space);\n\n\t// 3 spaces:\n\t// color.space: current color space\n\t// space: space whose gamut we are mapping to\n\t// mapSpace: space with the coord we're reducing\n\n\tif (inGamut(color, space, { epsilon: 0 })) {\n\t\treturn color;\n\t}\n\n\tlet spaceColor;\n\tif (method === \"css\") {\n\t\tspaceColor = toGamutCSS(color, { space });\n\t}\n\telse {\n\t\tif (method !== \"clip\" && !inGamut(color, space)) {\n\n\t\t\tif (Object.prototype.hasOwnProperty.call(GMAPPRESET, method)) {\n\t\t\t\t({method, jnd, deltaEMethod, blackWhiteClamp} = GMAPPRESET[method]);\n\t\t\t}\n\n\t\t\t// Get the correct delta E method\n\t\t\tlet de = deltaE2000;\n\t\t\tif (deltaEMethod !== \"\") {\n\t\t\t\tfor (let m in deltaEMethods) {\n\t\t\t\t\tif (\"deltae\" + deltaEMethod.toLowerCase() === m.toLowerCase()) {\n\t\t\t\t\t\tde = deltaEMethods[m];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet clipped = toGamut(to(color, space), { method: \"clip\", space });\n\t\t\tif (de(color, clipped) > jnd) {\n\n\t\t\t\t// Clamp to SDR white and black if required\n\t\t\t\tif (Object.keys(blackWhiteClamp).length === 3) {\n\t\t\t\t\tlet channelMeta = ColorSpace.resolveCoord(blackWhiteClamp.channel);\n\t\t\t\t\tlet channel = get(to(color, channelMeta.space), channelMeta.id);\n\t\t\t\t\tif (util.isNone(channel)) {\n\t\t\t\t\t\tchannel = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (channel >= blackWhiteClamp.max) {\n\t\t\t\t\t\treturn to({ space: \"xyz-d65\", coords: WHITES[\"D65\"] }, color.space);\n\t\t\t\t\t}\n\t\t\t\t\telse if (channel <= blackWhiteClamp.min) {\n\t\t\t\t\t\treturn to({ space: \"xyz-d65\", coords: [0, 0, 0] }, color.space);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Reduce a coordinate of a certain color space until the color is in gamut\n\t\t\t\tlet coordMeta = ColorSpace.resolveCoord(method);\n\t\t\t\tlet mapSpace = coordMeta.space;\n\t\t\t\tlet coordId = coordMeta.id;\n\n\t\t\t\tlet mappedColor = to(color, mapSpace);\n\t\t\t\t// If we were already in the mapped color space, we need to resolve undefined channels\n\t\t\t\tmappedColor.coords.forEach((c, i) => {\n\t\t\t\t\tif (util.isNone(c)) {\n\t\t\t\t\t\tmappedColor.coords[i] = 0;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tlet bounds = coordMeta.range || coordMeta.refRange;\n\t\t\t\tlet min = bounds[0];\n\t\t\t\tlet ε = calcEpsilon(jnd);\n\t\t\t\tlet low = min;\n\t\t\t\tlet high = get(mappedColor, coordId);\n\n\t\t\t\twhile (high - low > ε) {\n\t\t\t\t\tlet clipped = clone(mappedColor);\n\t\t\t\t\tclipped = toGamut(clipped, { space, method: \"clip\" });\n\t\t\t\t\tlet deltaE = de(mappedColor, clipped);\n\n\t\t\t\t\tif (deltaE - jnd < ε) {\n\t\t\t\t\t\tlow = get(mappedColor, coordId);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\thigh = get(mappedColor, coordId);\n\t\t\t\t\t}\n\n\t\t\t\t\tset(mappedColor, coordId, (low + high) / 2);\n\t\t\t\t}\n\n\t\t\t\tspaceColor = to(mappedColor, space);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tspaceColor = clipped;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tspaceColor = to(color, space);\n\t\t}\n\n\t\tif (method === \"clip\" // Dumb coord clipping\n\t\t\t// finish off smarter gamut mapping with clip to get rid of ε, see #17\n\t\t\t|| !inGamut(spaceColor, space, { epsilon: 0 })\n\t\t) {\n\t\t\tlet bounds = Object.values(space.coords).map(c => c.range || []);\n\n\t\t\tspaceColor.coords = spaceColor.coords.map((c, i) => {\n\t\t\t\tlet [min, max] = bounds[i];\n\n\t\t\t\tif (min !== undefined) {\n\t\t\t\t\tc = Math.max(min, c);\n\t\t\t\t}\n\n\t\t\t\tif (max !== undefined) {\n\t\t\t\t\tc = Math.min(c, max);\n\t\t\t\t}\n\n\t\t\t\treturn c;\n\t\t\t});\n\t\t}\n\t}\n\n\tif (space !== color.space) {\n\t\tspaceColor = to(spaceColor, color.space);\n\t}\n\n\tcolor.coords = spaceColor.coords;\n\treturn color;\n}\n\ntoGamut.returns = \"color\";\n\n// The reference colors to be used if lightness is out of the range 0-1 in the\n// `Oklch` space. These are created in the `Oklab` space, as it is used by the\n// DeltaEOK calculation, so it is guaranteed to be imported.\nconst COLORS = {\n\tWHITE: { space: oklab, coords: [1, 0, 0] },\n\tBLACK: { space: oklab, coords: [0, 0, 0] },\n};\n\n/**\n * Given a color `origin`, returns a new color that is in gamut using\n * the CSS Gamut Mapping Algorithm. If `space` is specified, it will be in gamut\n * in `space`, and returned in `space`. Otherwise, it will be in gamut and\n * returned in the color space of `origin`.\n * @param {Object} origin\n * @param {Object} options\n * @param {ColorSpace|string} options.space\n * @returns {Color}\n */\nexport function toGamutCSS (origin, {space} = {}) {\n\tconst JND = 0.02;\n\tconst ε = 0.0001;\n\n\torigin = getColor(origin);\n\n\tif (!space) {\n\t\tspace = origin.space;\n\t}\n\n\tspace = ColorSpace.get(space);\n\tconst oklchSpace = ColorSpace.get(\"oklch\");\n\n\tif (space.isUnbounded) {\n\t\treturn to(origin, space);\n\t}\n\n\tconst origin_OKLCH = to(origin, oklchSpace);\n\tlet L = origin_OKLCH.coords[0];\n\n\t// return media white or black, if lightness is out of range\n\tif (L >= 1) {\n\t\tconst white = to(COLORS.WHITE, space);\n\t\twhite.alpha = origin.alpha;\n\t\treturn to(white, space);\n\t}\n\tif (L <= 0) {\n\t\tconst black = to(COLORS.BLACK, space);\n\t\tblack.alpha = origin.alpha;\n\t\treturn to(black, space);\n\t}\n\n\tif (inGamut(origin_OKLCH, space, {epsilon: 0})) {\n\t\treturn to(origin_OKLCH, space);\n\t}\n\n\tfunction clip (_color) {\n\t\tconst destColor = to(_color, space);\n\t\tconst spaceCoords = Object.values(space.coords);\n\t\tdestColor.coords = destColor.coords.map((coord, index) => {\n\t\t\tif (\"range\" in spaceCoords[index]) {\n\t\t\t\tconst [min, max] =  spaceCoords[index].range;\n\t\t\t\treturn util.clamp(min, coord, max);\n\t\t\t}\n\t\t\treturn coord;\n\t\t});\n\t\treturn destColor;\n\t}\n\tlet min = 0;\n\tlet max = origin_OKLCH.coords[1];\n\tlet min_inGamut = true;\n\tlet current = clone(origin_OKLCH);\n\tlet clipped = clip(current);\n\n\tlet E = deltaEOK(clipped, current);\n\tif (E < JND) {\n\t\treturn clipped;\n\t}\n\n\twhile ((max - min) > ε) {\n\t\tconst chroma = (min + max) / 2;\n\t\tcurrent.coords[1] = chroma;\n\t\tif (min_inGamut && inGamut(current, space, {epsilon: 0})) {\n\t\t\tmin = chroma;\n\t\t}\n\t\telse {\n\t\t\tclipped = clip(current);\n\t\t\tE = deltaEOK(clipped, current);\n\t\t\tif (E < JND) {\n\t\t\t\tif ((JND - E < ε)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tmin_inGamut = false;\n\t\t\t\t\tmin = chroma;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmax = chroma;\n\t\t\t}\n\t\t}\n\t}\n\treturn clipped;\n}\n","import getColor from \"./getColor.js\";\nimport ColorSpace from \"./space.js\";\nimport toGamut from \"./toGamut.js\";\n\n/**\n * Convert to color space and return a new color\n * @param {Object|string} space - Color space object or id\n * @param {Object} options\n * @param {boolean} options.inGamut - Whether to force resulting color in gamut\n * @returns {Color}\n */\nexport default function to (color, space, {inGamut} = {}) {\n\tcolor = getColor(color);\n\tspace = ColorSpace.get(space);\n\n\tlet coords = space.from(color);\n\tlet ret = {space, coords, alpha: color.alpha};\n\n\tif (inGamut) {\n\t\tret = toGamut(ret, inGamut === true ? undefined : inGamut);\n\t}\n\n\treturn ret;\n}\n\nto.returns = \"color\";\n","import * as util from \"./util.js\";\nimport ColorSpace from \"./space.js\";\nimport defaults from \"./defaults.js\";\nimport getColor from \"./getColor.js\";\nimport checkInGamut from \"./inGamut.js\";\nimport toGamut from \"./toGamut.js\";\nimport clone from \"./clone.js\";\n\n/**\n * Generic toString() method, outputs a color(spaceId ...coords) function, a functional syntax, or custom formats defined by the color space\n * @param {Object} options\n * @param {number} options.precision - Significant digits\n * @param {boolean} options.inGamut - Adjust coordinates to fit in gamut first? [default: false]\n */\nexport default function serialize (color, {\n\tprecision = defaults.precision,\n\tformat = \"default\",\n\tinGamut = true,\n\t...customOptions\n} = {}) {\n\tlet ret;\n\n\tcolor = getColor(color);\n\n\tlet formatId = format;\n\tformat = color.space.getFormat(format)\n\t       ?? color.space.getFormat(\"default\")\n\t       ?? ColorSpace.DEFAULT_FORMAT;\n\n\t// The assignment to coords and inGamut needs to stay in the order they are now\n\t// The order of the assignment was changed as a workaround for a bug in Next.js\n\t// See this issue for details: https://github.com/color-js/color.js/issues/260\n\n\tlet coords = color.coords.slice(); // clone so we can manipulate it\n\n\tinGamut ||= format.toGamut;\n\n\tif (inGamut && !checkInGamut(color)) {\n\t\t// FIXME what happens if the color contains NaNs?\n\t\tcoords = toGamut(clone(color), inGamut === true ? undefined : inGamut).coords;\n\t}\n\n\tif (format.type === \"custom\") {\n\t\tcustomOptions.precision = precision;\n\n\t\tif (format.serialize) {\n\t\t\tret = format.serialize(coords, color.alpha, customOptions);\n\t\t}\n\t\telse {\n\t\t\tthrow new TypeError(`format ${formatId} can only be used to parse colors, not for serialization`);\n\t\t}\n\t}\n\telse {\n\t\t// Functional syntax\n\t\tlet name = format.name || \"color\";\n\n\t\tif (format.serializeCoords) {\n\t\t\tcoords = format.serializeCoords(coords, precision);\n\t\t}\n\t\telse {\n\t\t\tif (precision !== null) {\n\t\t\t\tcoords = coords.map(c => {\n\t\t\t\t\treturn util.serializeNumber(c, {precision});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tlet args = [...coords];\n\n\t\tif (name === \"color\") {\n\t\t\t// If output is a color() function, add colorspace id as first argument\n\t\t\tlet cssId = format.id || format.ids?.[0] || color.space.id;\n\t\t\targs.unshift(cssId);\n\t\t}\n\n\t\tlet alpha = color.alpha;\n\t\tif (precision !== null) {\n\t\t\talpha = util.serializeNumber(alpha, {precision});\n\t\t}\n\n\t\tlet strAlpha = color.alpha >= 1 || format.noAlpha ? \"\" : `${format.commas ? \",\" : \" /\"} ${alpha}`;\n\t\tret = `${name}(${args.join(format.commas ? \", \" : \" \")}${strAlpha})`;\n\t}\n\n\treturn ret;\n}\n","import RGBColorSpace from \"../rgbspace.js\";\n\n// convert an array of linear-light rec2020 values to CIE XYZ\n// using  D65 (no chromatic adaptation)\n// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n// 0 is actually calculated as  4.994106574466076e-17\nconst toXYZ_M = [\n\t[ 0.6369580483012914, 0.14461690358620832,  0.1688809751641721  ],\n\t[ 0.2627002120112671, 0.6779980715188708,   0.05930171646986196 ],\n\t[ 0.000000000000000,  0.028072693049087428, 1.060985057710791   ],\n];\n\n// from ITU-R BT.2124-0 Annex 2 p.3\nconst fromXYZ_M = [\n\t[  1.716651187971268,  -0.355670783776392, -0.253366281373660  ],\n\t[ -0.666684351832489,   1.616481236634939,  0.0157685458139111 ],\n\t[  0.017639857445311,  -0.042770613257809,  0.942103121235474  ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"rec2020-linear\",\n\tcssId: \"--rec2020-linear\",\n\tname: \"Linear REC.2020\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../rgbspace.js\";\nimport REC2020Linear from \"./rec2020-linear.js\";\n// import sRGB from \"./srgb.js\";\n\nconst α = 1.09929682680944;\nconst β = 0.018053968510807;\n\nexport default new RGBColorSpace({\n\tid: \"rec2020\",\n\tname: \"REC.2020\",\n\tbase: REC2020Linear,\n\t// Non-linear transfer function from Rec. ITU-R BT.2020-2 table 4\n\ttoBase (RGB) {\n\t\treturn RGB.map(function (val) {\n\t\t\tif (val < β * 4.5) {\n\t\t\t\treturn val / 4.5;\n\t\t\t}\n\n\t\t\treturn Math.pow((val + α - 1) / α, 1 / 0.45);\n\t\t});\n\t},\n\tfromBase (RGB) {\n\t\treturn RGB.map(function (val) {\n\t\t\tif (val >= β) {\n\t\t\t\treturn α * Math.pow(val, 0.45) - (α - 1);\n\t\t\t}\n\n\t\t\treturn 4.5 * val;\n\t\t});\n\t},\n});\n","import RGBColorSpace from \"../rgbspace.js\";\n\nconst toXYZ_M = [\n\t[0.4865709486482162, 0.26566769316909306, 0.1982172852343625],\n\t[0.2289745640697488, 0.6917385218365064,  0.079286914093745],\n\t[0.0000000000000000, 0.04511338185890264, 1.043944368900976],\n];\n\nconst fromXYZ_M = [\n\t[ 2.493496911941425,   -0.9313836179191239, -0.40271078445071684],\n\t[-0.8294889695615747,   1.7626640603183463,  0.023624685841943577],\n\t[ 0.03584583024378447, -0.07617238926804182, 0.9568845240076872],\n];\n\nexport default new RGBColorSpace({\n\tid: \"p3-linear\",\n\tcssId: \"--display-p3-linear\",\n\tname: \"Linear P3\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../rgbspace.js\";\n\n// This is the linear-light version of sRGB\n// as used for example in SVG filters\n// or in Canvas\n\n// This matrix was calculated directly from the RGB and white chromaticities\n// when rounded to 8 decimal places, it agrees completely with the official matrix\n// see https://github.com/w3c/csswg-drafts/issues/5922\nconst toXYZ_M = [\n\t[ 0.41239079926595934, 0.357584339383878,   0.1804807884018343  ],\n\t[ 0.21263900587151027, 0.715168678767756,   0.07219231536073371 ],\n\t[ 0.01933081871559182, 0.11919477979462598, 0.9505321522496607  ],\n];\n\n// This matrix is the inverse of the above;\n// again it agrees with the official definition when rounded to 8 decimal places\nexport const fromXYZ_M = [\n\t[  3.2409699419045226,  -1.537383177570094,   -0.4986107602930034  ],\n\t[ -0.9692436362808796,   1.8759675015077202,   0.04155505740717559 ],\n\t[  0.05563007969699366, -0.20397695888897652,  1.0569715142428786  ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"srgb-linear\",\n\tname: \"Linear sRGB\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","/* List of CSS color keywords\n * Note that this does not include currentColor, transparent,\n * or system colors\n */\n\n// To produce: Visit https://www.w3.org/TR/css-color-4/#named-colors\n// and run in the console:\n// copy($$(\"tr\", $(\".named-color-table tbody\")).map(tr => `\"${tr.cells[2].textContent.trim()}\": [${tr.cells[4].textContent.trim().split(/\\s+/).map(c => c === \"0\"? \"0\" : c === \"255\"? \"1\" : c + \" / 255\").join(\", \")}]`).join(\",\\n\"))\nexport default {\n\t\"aliceblue\": [240 / 255, 248 / 255, 1],\n\t\"antiquewhite\": [250 / 255, 235 / 255, 215 / 255],\n\t\"aqua\": [0, 1, 1],\n\t\"aquamarine\": [127 / 255, 1, 212 / 255],\n\t\"azure\": [240 / 255, 1, 1],\n\t\"beige\": [245 / 255, 245 / 255, 220 / 255],\n\t\"bisque\": [1, 228 / 255, 196 / 255],\n\t\"black\": [0, 0, 0],\n\t\"blanchedalmond\": [1, 235 / 255, 205 / 255],\n\t\"blue\": [0, 0, 1],\n\t\"blueviolet\": [138 / 255, 43 / 255, 226 / 255],\n\t\"brown\": [165 / 255, 42 / 255, 42 / 255],\n\t\"burlywood\": [222 / 255, 184 / 255, 135 / 255],\n\t\"cadetblue\": [95 / 255, 158 / 255, 160 / 255],\n\t\"chartreuse\": [127 / 255, 1, 0],\n\t\"chocolate\": [210 / 255, 105 / 255, 30 / 255],\n\t\"coral\": [1, 127 / 255, 80 / 255],\n\t\"cornflowerblue\": [100 / 255, 149 / 255, 237 / 255],\n\t\"cornsilk\": [1, 248 / 255, 220 / 255],\n\t\"crimson\": [220 / 255, 20 / 255, 60 / 255],\n\t\"cyan\": [0, 1, 1],\n\t\"darkblue\": [0, 0, 139 / 255],\n\t\"darkcyan\": [0, 139 / 255, 139 / 255],\n\t\"darkgoldenrod\": [184 / 255, 134 / 255, 11 / 255],\n\t\"darkgray\": [169 / 255, 169 / 255, 169 / 255],\n\t\"darkgreen\": [0, 100 / 255, 0],\n\t\"darkgrey\": [169 / 255, 169 / 255, 169 / 255],\n\t\"darkkhaki\": [189 / 255, 183 / 255, 107 / 255],\n\t\"darkmagenta\": [139 / 255, 0, 139 / 255],\n\t\"darkolivegreen\": [85 / 255, 107 / 255, 47 / 255],\n\t\"darkorange\": [1, 140 / 255, 0],\n\t\"darkorchid\": [153 / 255, 50 / 255, 204 / 255],\n\t\"darkred\": [139 / 255, 0, 0],\n\t\"darksalmon\": [233 / 255, 150 / 255, 122 / 255],\n\t\"darkseagreen\": [143 / 255, 188 / 255, 143 / 255],\n\t\"darkslateblue\": [72 / 255, 61 / 255, 139 / 255],\n\t\"darkslategray\": [47 / 255, 79 / 255, 79 / 255],\n\t\"darkslategrey\": [47 / 255, 79 / 255, 79 / 255],\n\t\"darkturquoise\": [0, 206 / 255, 209 / 255],\n\t\"darkviolet\": [148 / 255, 0, 211 / 255],\n\t\"deeppink\": [1, 20 / 255, 147 / 255],\n\t\"deepskyblue\": [0, 191 / 255, 1],\n\t\"dimgray\": [105 / 255, 105 / 255, 105 / 255],\n\t\"dimgrey\": [105 / 255, 105 / 255, 105 / 255],\n\t\"dodgerblue\": [30 / 255, 144 / 255, 1],\n\t\"firebrick\": [178 / 255, 34 / 255, 34 / 255],\n\t\"floralwhite\": [1, 250 / 255, 240 / 255],\n\t\"forestgreen\": [34 / 255, 139 / 255, 34 / 255],\n\t\"fuchsia\": [1, 0, 1],\n\t\"gainsboro\": [220 / 255, 220 / 255, 220 / 255],\n\t\"ghostwhite\": [248 / 255, 248 / 255, 1],\n\t\"gold\": [1, 215 / 255, 0],\n\t\"goldenrod\": [218 / 255, 165 / 255, 32 / 255],\n\t\"gray\": [128 / 255, 128 / 255, 128 / 255],\n\t\"green\": [0, 128 / 255, 0],\n\t\"greenyellow\": [173 / 255, 1, 47 / 255],\n\t\"grey\": [128 / 255, 128 / 255, 128 / 255],\n\t\"honeydew\": [240 / 255, 1, 240 / 255],\n\t\"hotpink\": [1, 105 / 255, 180 / 255],\n\t\"indianred\": [205 / 255, 92 / 255, 92 / 255],\n\t\"indigo\": [75 / 255, 0, 130 / 255],\n\t\"ivory\": [1, 1, 240 / 255],\n\t\"khaki\": [240 / 255, 230 / 255, 140 / 255],\n\t\"lavender\": [230 / 255, 230 / 255, 250 / 255],\n\t\"lavenderblush\": [1, 240 / 255, 245 / 255],\n\t\"lawngreen\": [124 / 255, 252 / 255, 0],\n\t\"lemonchiffon\": [1, 250 / 255, 205 / 255],\n\t\"lightblue\": [173 / 255, 216 / 255, 230 / 255],\n\t\"lightcoral\": [240 / 255, 128 / 255, 128 / 255],\n\t\"lightcyan\": [224 / 255, 1, 1],\n\t\"lightgoldenrodyellow\": [250 / 255, 250 / 255, 210 / 255],\n\t\"lightgray\": [211 / 255, 211 / 255, 211 / 255],\n\t\"lightgreen\": [144 / 255, 238 / 255, 144 / 255],\n\t\"lightgrey\": [211 / 255, 211 / 255, 211 / 255],\n\t\"lightpink\": [1, 182 / 255, 193 / 255],\n\t\"lightsalmon\": [1, 160 / 255, 122 / 255],\n\t\"lightseagreen\": [32 / 255, 178 / 255, 170 / 255],\n\t\"lightskyblue\": [135 / 255, 206 / 255, 250 / 255],\n\t\"lightslategray\": [119 / 255, 136 / 255, 153 / 255],\n\t\"lightslategrey\": [119 / 255, 136 / 255, 153 / 255],\n\t\"lightsteelblue\": [176 / 255, 196 / 255, 222 / 255],\n\t\"lightyellow\": [1, 1, 224 / 255],\n\t\"lime\": [0, 1, 0],\n\t\"limegreen\": [50 / 255, 205 / 255, 50 / 255],\n\t\"linen\": [250 / 255, 240 / 255, 230 / 255],\n\t\"magenta\": [1, 0, 1],\n\t\"maroon\": [128 / 255, 0, 0],\n\t\"mediumaquamarine\": [102 / 255, 205 / 255, 170 / 255],\n\t\"mediumblue\": [0, 0, 205 / 255],\n\t\"mediumorchid\": [186 / 255, 85 / 255, 211 / 255],\n\t\"mediumpurple\": [147 / 255, 112 / 255, 219 / 255],\n\t\"mediumseagreen\": [60 / 255, 179 / 255, 113 / 255],\n\t\"mediumslateblue\": [123 / 255, 104 / 255, 238 / 255],\n\t\"mediumspringgreen\": [0, 250 / 255, 154 / 255],\n\t\"mediumturquoise\": [72 / 255, 209 / 255, 204 / 255],\n\t\"mediumvioletred\": [199 / 255, 21 / 255, 133 / 255],\n\t\"midnightblue\": [25 / 255, 25 / 255, 112 / 255],\n\t\"mintcream\": [245 / 255, 1, 250 / 255],\n\t\"mistyrose\": [1, 228 / 255, 225 / 255],\n\t\"moccasin\": [1, 228 / 255, 181 / 255],\n\t\"navajowhite\": [1, 222 / 255, 173 / 255],\n\t\"navy\": [0, 0, 128 / 255],\n\t\"oldlace\": [253 / 255, 245 / 255, 230 / 255],\n\t\"olive\": [128 / 255, 128 / 255, 0],\n\t\"olivedrab\": [107 / 255, 142 / 255, 35 / 255],\n\t\"orange\": [1, 165 / 255, 0],\n\t\"orangered\": [1, 69 / 255, 0],\n\t\"orchid\": [218 / 255, 112 / 255, 214 / 255],\n\t\"palegoldenrod\": [238 / 255, 232 / 255, 170 / 255],\n\t\"palegreen\": [152 / 255, 251 / 255, 152 / 255],\n\t\"paleturquoise\": [175 / 255, 238 / 255, 238 / 255],\n\t\"palevioletred\": [219 / 255, 112 / 255, 147 / 255],\n\t\"papayawhip\": [1, 239 / 255, 213 / 255],\n\t\"peachpuff\": [1, 218 / 255, 185 / 255],\n\t\"peru\": [205 / 255, 133 / 255, 63 / 255],\n\t\"pink\": [1, 192 / 255, 203 / 255],\n\t\"plum\": [221 / 255, 160 / 255, 221 / 255],\n\t\"powderblue\": [176 / 255, 224 / 255, 230 / 255],\n\t\"purple\": [128 / 255, 0, 128 / 255],\n\t\"rebeccapurple\": [102 / 255, 51 / 255, 153 / 255],\n\t\"red\": [1, 0, 0],\n\t\"rosybrown\": [188 / 255, 143 / 255, 143 / 255],\n\t\"royalblue\": [65 / 255, 105 / 255, 225 / 255],\n\t\"saddlebrown\": [139 / 255, 69 / 255, 19 / 255],\n\t\"salmon\": [250 / 255, 128 / 255, 114 / 255],\n\t\"sandybrown\": [244 / 255, 164 / 255, 96 / 255],\n\t\"seagreen\": [46 / 255, 139 / 255, 87 / 255],\n\t\"seashell\": [1, 245 / 255, 238 / 255],\n\t\"sienna\": [160 / 255, 82 / 255, 45 / 255],\n\t\"silver\": [192 / 255, 192 / 255, 192 / 255],\n\t\"skyblue\": [135 / 255, 206 / 255, 235 / 255],\n\t\"slateblue\": [106 / 255, 90 / 255, 205 / 255],\n\t\"slategray\": [112 / 255, 128 / 255, 144 / 255],\n\t\"slategrey\": [112 / 255, 128 / 255, 144 / 255],\n\t\"snow\": [1, 250 / 255, 250 / 255],\n\t\"springgreen\": [0, 1, 127 / 255],\n\t\"steelblue\": [70 / 255, 130 / 255, 180 / 255],\n\t\"tan\": [210 / 255, 180 / 255, 140 / 255],\n\t\"teal\": [0, 128 / 255, 128 / 255],\n\t\"thistle\": [216 / 255, 191 / 255, 216 / 255],\n\t\"tomato\": [1, 99 / 255, 71 / 255],\n\t\"turquoise\": [64 / 255, 224 / 255, 208 / 255],\n\t\"violet\": [238 / 255, 130 / 255, 238 / 255],\n\t\"wheat\": [245 / 255, 222 / 255, 179 / 255],\n\t\"white\": [1, 1, 1],\n\t\"whitesmoke\": [245 / 255, 245 / 255, 245 / 255],\n\t\"yellow\": [1, 1, 0],\n\t\"yellowgreen\": [154 / 255, 205 / 255, 50 / 255],\n};\n","import RGBColorSpace from \"../rgbspace.js\";\nimport sRGBLinear from \"./srgb-linear.js\";\nimport KEYWORDS from \"../keywords.js\";\n\nlet coordGrammar = Array(3).fill(\"<percentage> | <number>[0, 255]\");\nlet coordGrammarNumber = Array(3).fill(\"<number>[0, 255]\");\n\nexport default new RGBColorSpace({\n\tid: \"srgb\",\n\tname: \"sRGB\",\n\tbase: sRGBLinear,\n\tfromBase: rgb => {\n\t\t// convert an array of linear-light sRGB values in the range 0.0-1.0\n\t\t// to gamma corrected form\n\t\t// https://en.wikipedia.org/wiki/SRGB\n\t\treturn rgb.map(val => {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\n\t\t\tif (abs > 0.0031308) {\n\t\t\t\treturn sign * (1.055 * (abs ** (1 / 2.4)) - 0.055);\n\t\t\t}\n\n\t\t\treturn 12.92 * val;\n\t\t});\n\t},\n\ttoBase: rgb => {\n\t\t// convert an array of sRGB values in the range 0.0 - 1.0\n\t\t// to linear light (un-companded) form.\n\t\t// https://en.wikipedia.org/wiki/SRGB\n\t\treturn rgb.map(val => {\n\t\t\tlet sign = val < 0 ? -1 : 1;\n\t\t\tlet abs = val * sign;\n\n\t\t\tif (abs <= 0.04045) {\n\t\t\t\treturn val / 12.92;\n\t\t\t}\n\n\t\t\treturn sign * (((abs + 0.055) / 1.055) ** 2.4);\n\t\t});\n\t},\n\tformats: {\n\t\t\"rgb\": {\n\t\t\tcoords: coordGrammar,\n\t\t},\n\t\t\"rgb_number\": {\n\t\t\tname: \"rgb\",\n\t\t\tcommas: true,\n\t\t\tcoords: coordGrammarNumber,\n\t\t\tnoAlpha: true,\n\t\t},\n\t\t\"color\": { /* use defaults */ },\n\t\t\"rgba\": {\n\t\t\tcoords: coordGrammar,\n\t\t\tcommas: true,\n\t\t\tlastAlpha: true,\n\t\t},\n\t\t\"rgba_number\": {\n\t\t\tname: \"rgba\",\n\t\t\tcommas: true,\n\t\t\tcoords: coordGrammarNumber,\n\t\t},\n\t\t\"hex\": {\n\t\t\ttype: \"custom\",\n\t\t\ttoGamut: true,\n\t\t\ttest: str => /^#([a-f0-9]{3,4}){1,2}$/i.test(str),\n\t\t\tparse (str) {\n\t\t\t\tif (str.length <= 5) {\n\t\t\t\t\t// #rgb or #rgba, duplicate digits\n\t\t\t\t\tstr = str.replace(/[a-f0-9]/gi, \"$&$&\");\n\t\t\t\t}\n\n\t\t\t\tlet rgba = [];\n\t\t\t\tstr.replace(/[a-f0-9]{2}/gi, component => {\n\t\t\t\t\trgba.push(parseInt(component, 16) / 255);\n\t\t\t\t});\n\n\t\t\t\treturn {\n\t\t\t\t\tspaceId: \"srgb\",\n\t\t\t\t\tcoords: rgba.slice(0, 3),\n\t\t\t\t\talpha: rgba.slice(3)[0],\n\t\t\t\t};\n\t\t\t},\n\t\t\tserialize: (coords, alpha, {\n\t\t\t\tcollapse = true, // collapse to 3-4 digit hex when possible?\n\t\t\t} = {}) => {\n\t\t\t\tif (alpha < 1) {\n\t\t\t\t\tcoords.push(alpha);\n\t\t\t\t}\n\n\t\t\t\tcoords = coords.map(c => Math.round(c * 255));\n\n\t\t\t\tlet collapsible = collapse && coords.every(c => c % 17 === 0);\n\n\t\t\t\tlet hex = coords.map(c => {\n\t\t\t\t\tif (collapsible) {\n\t\t\t\t\t\treturn (c / 17).toString(16);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn c.toString(16).padStart(2, \"0\");\n\t\t\t\t}).join(\"\");\n\n\t\t\t\treturn \"#\" + hex;\n\t\t\t},\n\t\t},\n\t\t\"keyword\": {\n\t\t\ttype: \"custom\",\n\t\t\ttest: str => /^[a-z]+$/i.test(str),\n\t\t\tparse (str) {\n\t\t\t\tstr = str.toLowerCase();\n\t\t\t\tlet ret = {spaceId: \"srgb\", coords: null, alpha: 1};\n\n\t\t\t\tif (str === \"transparent\") {\n\t\t\t\t\tret.coords = KEYWORDS.black;\n\t\t\t\t\tret.alpha = 0;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tret.coords = KEYWORDS[str];\n\t\t\t\t}\n\n\t\t\t\tif (ret.coords) {\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t},\n});\n","import RGBColorSpace from \"../rgbspace.js\";\nimport P3Linear from \"./p3-linear.js\";\nimport sRGB from \"./srgb.js\";\n\nexport default new RGBColorSpace({\n\tid: \"p3\",\n\tcssId: \"display-p3\",\n\tname: \"P3\",\n\tbase: P3Linear,\n\t// Gamma encoding/decoding is the same as sRGB\n\tfromBase: sRGB.fromBase,\n\ttoBase: sRGB.toBase,\n});\n","import { isNone, skipNone } from \"./util.js\";\nimport defaults from \"./defaults.js\";\nimport to from \"./to.js\";\nimport serialize from \"./serialize.js\";\nimport clone from \"./clone.js\";\nimport REC2020 from \"./spaces/rec2020.js\";\nimport P3 from \"./spaces/p3.js\";\nimport Lab from \"./spaces/lab.js\";\nimport sRGB from \"./spaces/srgb.js\";\n\n// Default space for CSS output. Code in Color.js makes this wider if there's a DOM available\ndefaults.display_space = sRGB;\n\nlet supportsNone;\n\nif (typeof CSS !== \"undefined\" && CSS.supports) {\n\t// Find widest supported color space for CSS\n\tfor (let space of [Lab, REC2020, P3]) {\n\t\tlet coords = space.getMinCoords();\n\t\tlet color = {space, coords, alpha: 1};\n\t\tlet str = serialize(color);\n\n\t\tif (CSS.supports(\"color\", str)) {\n\t\t\tdefaults.display_space = space;\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\n/**\n * Returns a serialization of the color that can actually be displayed in the browser.\n * If the default serialization can be displayed, it is returned.\n * Otherwise, the color is converted to Lab, REC2020, or P3, whichever is the widest supported.\n * In Node.js, this is basically equivalent to `serialize()` but returns a `String` object instead.\n *\n * @export\n * @param {{space, coords} | Color | string} color\n * @param {*} [options={}] Options to be passed to serialize()\n * @param {ColorSpace | string} [options.space = defaults.display_space] Color space to use for serialization if default is not supported\n * @returns {String} String object containing the serialized color with a color property containing the converted color (or the original, if no conversion was necessary)\n */\nexport default function display (color, {space = defaults.display_space, ...options} = {}) {\n\tlet ret = serialize(color, options);\n\n\tif (typeof CSS === \"undefined\" || CSS.supports(\"color\", ret) || !defaults.display_space) {\n\t\tret = new String(ret);\n\t\tret.color = color;\n\t}\n\telse {\n\t\t// If we're here, what we were about to output is not supported\n\t\tlet fallbackColor = color;\n\n\t\t// First, check if the culprit is none values\n\t\tlet hasNone = color.coords.some(isNone) || isNone(color.alpha);\n\n\t\tif (hasNone) {\n\t\t\t// Does the browser support none values?\n\t\t\tif (!(supportsNone ??= CSS.supports(\"color\", \"hsl(none 50% 50%)\"))) {\n\t\t\t\t// Nope, try again without none\n\t\t\t\tfallbackColor = clone(color);\n\t\t\t\tfallbackColor.coords = fallbackColor.coords.map(skipNone);\n\t\t\t\tfallbackColor.alpha = skipNone(fallbackColor.alpha);\n\n\t\t\t\tret = serialize(fallbackColor, options);\n\n\t\t\t\tif (CSS.supports(\"color\", ret)) {\n\t\t\t\t\t// We're done, now it's supported\n\t\t\t\t\tret = new String(ret);\n\t\t\t\t\tret.color = fallbackColor;\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// If we're here, the color function is not supported\n\t\t// Fall back to fallback space\n\t\tfallbackColor = to(fallbackColor, space);\n\t\tret = new String(serialize(fallbackColor, options));\n\t\tret.color = fallbackColor;\n\t}\n\n\treturn ret;\n}\n","import getColor from \"./getColor.js\";\n\nexport default function equals (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\treturn color1.space === color2.space\n\t       && color1.alpha === color2.alpha\n\t       && color1.coords.every((c, i) => c === color2.coords[i]);\n}\n","/**\n * Relative luminance\n */\nimport get from \"./get.js\";\nimport set from \"./set.js\";\nimport xyz_d65 from \"./spaces/xyz-d65.js\";\n\nexport function getLuminance (color) {\n\t// Assume getColor() is called on color in get()\n\treturn get(color, [xyz_d65, \"y\"]);\n}\n\nexport function setLuminance (color, value) {\n\t// Assume getColor() is called on color in set()\n\tset(color, [xyz_d65, \"y\"], value);\n}\n\nexport function register (Color) {\n\tObject.defineProperty(Color.prototype, \"luminance\", {\n\t\tget () {\n\t\t\treturn getLuminance(this);\n\t\t},\n\t\tset (value) {\n\t\t\tsetLuminance(this, value);\n\t\t},\n\t});\n}\n","// WCAG 2.0 contrast https://www.w3.org/TR/WCAG20-TECHS/G18.html\n// Simple contrast, with fixed 5% viewing flare contribution\n// Symmetric, does not matter which is foreground and which is background\n\nimport getColor from \"../getColor.js\";\nimport {getLuminance} from \"../luminance.js\";\n\nexport default function contrastWCAG21 (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Y1 = Math.max(getLuminance(color1), 0);\n\tlet Y2 = Math.max(getLuminance(color2), 0);\n\n\tif (Y2 > Y1) {\n\t\t[Y1, Y2] = [Y2, Y1];\n\t}\n\n\treturn (Y1 + .05) / (Y2 + .05);\n}\n","// APCA 0.0.98G\n// https://github.com/Myndex/apca-w3\n// see also https://github.com/w3c/silver/issues/643\n\nimport getColor from \"../getColor.js\";\nimport to from \"../to.js\";\n\n// exponents\nconst normBG = 0.56;\nconst normTXT = 0.57;\nconst revTXT = 0.62;\nconst revBG = 0.65;\n\n// clamps\nconst blkThrs = 0.022;\nconst blkClmp = 1.414;\nconst loClip = 0.1;\nconst deltaYmin = 0.0005;\n\n// scalers\n// see https://github.com/w3c/silver/issues/645\nconst scaleBoW = 1.14;\nconst loBoWoffset = 0.027;\nconst scaleWoB = 1.14;\nconst loWoBoffset = 0.027;\n\nfunction fclamp (Y) {\n\tif (Y >= blkThrs) {\n\t\treturn Y;\n\t}\n\treturn Y + (blkThrs - Y) ** blkClmp;\n}\n\nfunction linearize (val) {\n\tlet sign = val < 0 ? -1 : 1;\n\tlet abs = Math.abs(val);\n\treturn sign * Math.pow(abs, 2.4);\n}\n\n// Not symmetric, requires a foreground (text) color, and a background color\nexport default function contrastAPCA (background, foreground) {\n\tforeground = getColor(foreground);\n\tbackground = getColor(background);\n\n\tlet S;\n\tlet C;\n\tlet Sapc;\n\n\t// Myndex as-published, assumes sRGB inputs\n\tlet R, G, B;\n\n\tforeground = to(foreground, \"srgb\");\n\t// Should these be clamped to in-gamut values?\n\n\t// Calculates \"screen luminance\" with non-standard simple gamma EOTF\n\t// weights should be from CSS Color 4, not the ones here which are via Myndex and copied from Lindbloom\n\t[R, G, B] = foreground.coords;\n\tlet lumTxt = linearize(R) * 0.2126729 + linearize(G) * 0.7151522 + linearize(B) * 0.0721750;\n\n\tbackground = to(background, \"srgb\");\n\t[R, G, B] = background.coords;\n\tlet lumBg = linearize(R) * 0.2126729 + linearize(G) * 0.7151522 + linearize(B) * 0.0721750;\n\n\t// toe clamping of very dark values to account for flare\n\tlet Ytxt = fclamp(lumTxt);\n\tlet Ybg = fclamp(lumBg);\n\n\t// are we \"Black on White\" (dark on light), or light on dark?\n\tlet BoW = Ybg > Ytxt;\n\n\t// why is this a delta, when Y is not perceptually uniform?\n\t// Answer: it is a noise gate, see\n\t// https://github.com/LeaVerou/color.js/issues/208\n\tif (Math.abs(Ybg - Ytxt) < deltaYmin) {\n\t\tC = 0;\n\t}\n\telse {\n\t\tif (BoW) {\n\t\t\t// dark text on light background\n\t\t\tS = Ybg ** normBG - Ytxt ** normTXT;\n\t\t\tC = S * scaleBoW;\n\t\t}\n\t\telse {\n\t\t\t// light text on dark background\n\t\t\tS = Ybg ** revBG - Ytxt ** revTXT;\n\t\t\tC = S * scaleWoB;\n\t\t}\n\t}\n\tif (Math.abs(C) < loClip) {\n\t\tSapc = 0;\n\t}\n\telse if (C > 0) {\n\t\t// not clear whether Woffset is loBoWoffset or loWoBoffset\n\t\t// but they have the same value\n\t\tSapc = C - loBoWoffset;\n\t}\n\telse {\n\t\tSapc = C + loBoWoffset;\n\t}\n\n\treturn Sapc * 100;\n}\n","// Michelson  luminance contrast\n// the relation between the spread and the sum of the two luminances\n// Symmetric, does not matter which is foreground and which is background\n// No black level compensation for flare.\n\nimport getColor from \"../getColor.js\";\nimport {getLuminance} from \"../luminance.js\";\n\nexport default function contrastMichelson (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Y1 = Math.max(getLuminance(color1), 0);\n\tlet Y2 = Math.max(getLuminance(color2), 0);\n\n\tif (Y2 > Y1) {\n\t\t[Y1, Y2] = [Y2, Y1];\n\t}\n\n\tlet denom = (Y1 + Y2);\n\treturn denom === 0 ? 0 : (Y1 - Y2) / denom;\n}\n","// Weber luminance contrast\n// The difference between the two luminances divided by the lower luminance\n// Symmetric, does not matter which is foreground and which is background\n// No black level compensation for flare.\n\nimport getColor from \"../getColor.js\";\nimport {getLuminance} from \"../luminance.js\";\n\n// the darkest sRGB color above black is #000001 and this produces\n// a plain Weber contrast of ~45647.\n// So, setting the divide-by-zero result at 50000 is a reasonable\n// max clamp for the plain Weber\nconst max = 50000;\n\nexport default function contrastWeber (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Y1 = Math.max(getLuminance(color1), 0);\n\tlet Y2 = Math.max(getLuminance(color2), 0);\n\n\tif (Y2 > Y1) {\n\t\t[Y1, Y2] = [Y2, Y1];\n\t}\n\n\treturn Y2 === 0 ? max : (Y1 - Y2) / Y2;\n}\n","// CIE Lightness difference, as used by Google Material Design\n// Google HCT Tone is the same as CIE Lightness\n// https://material.io/blog/science-of-color-design\n\nimport getColor from \"../getColor.js\";\nimport get from \"../get.js\";\nimport lab from \"../spaces/lab.js\";\n\nexport default function contrastLstar (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet L1 = get(color1, [lab, \"l\"]);\n\tlet L2 = get(color2, [lab, \"l\"]);\n\n\treturn Math.abs(L1 - L2);\n}\n","import ColorSpace from \"../space.js\";\nimport {WHITES} from \"../adapt.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\n\n// κ * ε  = 2^3 = 8\nconst ε = 216 / 24389;  // 6^3/29^3 == (24/116)^3\nconst ε3 = 24 / 116;\nconst κ = 24389 / 27;   // 29^3/3^3\n\nlet white = WHITES.D65;\n\nexport default new ColorSpace({\n\tid: \"lab-d65\",\n\tname: \"Lab D65\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\ta: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t\tb: {\n\t\t\trefRange: [-125, 125],\n\t\t},\n\t},\n\n\t// Assuming XYZ is relative to D65, convert to CIE Lab\n\t// from CIE standard, which now defines these as a rational fraction\n\twhite,\n\n\tbase: xyz_d65,\n\t// Convert D65-adapted XYZ to Lab\n\t//  CIE 15.3:2004 section 8.2.1.1\n\tfromBase (XYZ) {\n\t\t// compute xyz, which is XYZ scaled relative to reference white\n\t\tlet xyz = XYZ.map((value, i) => value / white[i]);\n\n\t\t// now compute f\n\t\tlet f = xyz.map(value => value > ε ? Math.cbrt(value) : (κ * value + 16) / 116);\n\n\t\treturn [\n\t\t\t(116 * f[1]) - 16,   // L\n\t\t\t500 * (f[0] - f[1]), // a\n\t\t\t200 * (f[1] - f[2]),  // b\n\t\t];\n\t},\n\t// Convert Lab to D65-adapted XYZ\n\t// Same result as CIE 15.3:2004 Appendix D although the derivation is different\n\t// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n\ttoBase (Lab) {\n\t\t// compute f, starting with the luminance-related term\n\t\tlet f = [];\n\t\tf[1] = (Lab[0] + 16) / 116;\n\t\tf[0] = Lab[1] / 500 + f[1];\n\t\tf[2] = f[1] - Lab[2] / 200;\n\n\t\t// compute xyz\n\t\tlet xyz = [\n\t\t\tf[0]   > ε3 ? Math.pow(f[0], 3)                : (116 * f[0] - 16) / κ,\n\t\t\tLab[0] > 8  ? Math.pow((Lab[0] + 16) / 116, 3) : Lab[0] / κ,\n\t\t\tf[2]   > ε3 ? Math.pow(f[2], 3)                : (116 * f[2] - 16) / κ,\n\t\t];\n\n\t\t// Compute XYZ by scaling xyz by reference white\n\t\treturn xyz.map((value, i) => value * white[i]);\n\t},\n\n\tformats: {\n\t\t\"lab-d65\": {\n\t\t\tcoords: [\"<number> | <percentage>\", \"<number> | <percentage>[-1,1]\", \"<number> | <percentage>[-1,1]\"],\n\t\t},\n\t},\n});\n","// Delta Phi Star perceptual lightness contrast\n// See https://github.com/Myndex/deltaphistar\n// The (difference between two Lstars each raised to phi) raised to (1/phi)\n// Symmetric, does not matter which is foreground and which is background\n\n\nimport getColor from \"../getColor.js\";\nimport get from \"../get.js\";\nimport lab_d65 from \"../spaces/lab-d65.js\";\n\nconst phi = Math.pow(5, 0.5) * 0.5 + 0.5; // Math.phi can be used if Math.js\n\nexport default function contrastDeltaPhi (color1, color2) {\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\tlet Lstr1 = get(color1, [lab_d65, \"l\"]);\n\tlet Lstr2 = get(color2, [lab_d65, \"l\"]);\n\n\tlet deltaPhiStar = Math.abs(Math.pow(Lstr1, phi) - Math.pow(Lstr2, phi));\n\n\tlet contrast = Math.pow(deltaPhiStar, (1 / phi)) * Math.SQRT2 - 40;\n\n\treturn (contrast < 7.5) ? 0.0 : contrast ;\n}\n","import getColor from \"./getColor.js\";\n// import defaults from \"./defaults.js\";\nimport {isString} from \"./util.js\";\nimport * as contrastAlgorithms from \"./contrast/index.js\";\n\nexport default function contrast (background, foreground, o = {}) {\n\tif (isString(o)) {\n\t\to = {algorithm: o};\n\t}\n\n\tlet {algorithm, ...rest} = o;\n\n\tif (!algorithm) {\n\t\tlet algorithms = Object.keys(contrastAlgorithms).map(a => a.replace(/^contrast/, \"\")).join(\", \");\n\t\tthrow new TypeError(`contrast() function needs a contrast algorithm. Please specify one of: ${algorithms}`);\n\t}\n\n\tbackground = getColor(background);\n\tforeground = getColor(foreground);\n\n\tfor (let a in contrastAlgorithms) {\n\t\tif (\"contrast\" + algorithm.toLowerCase() === a.toLowerCase()) {\n\t\t\treturn contrastAlgorithms[a](background, foreground, rest);\n\t\t}\n\t}\n\n\tthrow new TypeError(`Unknown contrast algorithm: ${algorithm}`);\n}\n","import xyz_d65 from \"./spaces/xyz-d65.js\";\nimport getAll from \"./getAll.js\";\n\n// Chromaticity coordinates\nexport function uv (color) {\n\t// Assumes getAll() calls getColor() on color\n\tlet [X, Y, Z] = getAll(color, xyz_d65);\n\tlet denom = X + 15 * Y + 3 * Z;\n\treturn [4 * X / denom, 9 * Y / denom];\n}\n\nexport function xy (color) {\n\t// Assumes getAll() calls getColor() on color\n\tlet [X, Y, Z] = getAll(color, xyz_d65);\n\tlet  sum = X + Y + Z;\n\treturn [X / sum, Y / sum];\n}\n\nexport function register (Color) {\n\t// no setters, as lightness information is lost\n\t// when converting color to chromaticity\n\tObject.defineProperty(Color.prototype, \"uv\", {\n\t\tget () {\n\t\t\treturn uv(this);\n\t\t},\n\t});\n\n\tObject.defineProperty(Color.prototype, \"xy\", {\n\t\tget () {\n\t\t\treturn xy(this);\n\t\t},\n\t});\n}\n","import defaults from \"./defaults.js\";\nimport {isString} from \"./util.js\";\nimport deltaEMethods from \"./deltaE/index.js\";\n\nexport default function deltaE (c1, c2, o = {}) {\n\tif (isString(o)) {\n\t\to = {method: o};\n\t}\n\n\tlet {method = defaults.deltaE, ...rest} = o;\n\n\tfor (let m in deltaEMethods) {\n\t\tif (\"deltae\" + method.toLowerCase() === m.toLowerCase()) {\n\t\t\treturn deltaEMethods[m](c1, c2, rest);\n\t\t}\n\t}\n\n\tthrow new TypeError(`Unknown deltaE method: ${method}`);\n}\n","import ColorSpace from \"./space.js\";\nimport set from \"./set.js\";\n\nexport function lighten (color, amount = .25) {\n\tlet space = ColorSpace.get(\"oklch\", \"lch\");\n\tlet lightness = [space, \"l\"];\n\treturn set(color, lightness, l => l * (1 + amount));\n}\n\nexport function darken (color, amount = .25) {\n\tlet space = ColorSpace.get(\"oklch\", \"lch\");\n\tlet lightness = [space, \"l\"];\n\treturn set(color, lightness, l => l * (1 - amount));\n}\n","/**\n * Functions related to color interpolation\n */\nimport ColorSpace from \"./space.js\";\nimport {type, interpolate} from \"./util.js\";\nimport getColor from \"./getColor.js\";\nimport clone from \"./clone.js\";\nimport to from \"./to.js\";\nimport toGamut from \"./toGamut.js\";\nimport get from \"./get.js\";\nimport set from \"./set.js\";\nimport defaults from \"./defaults.js\";\nimport * as angles from \"./angles.js\";\nimport deltaE from \"./deltaE.js\";\n\n/**\n * Return an intermediate color between two colors\n * Signatures: mix(c1, c2, p, options)\n *             mix(c1, c2, options)\n *             mix(color)\n * @param {Color | string} c1 The first color\n * @param {Color | string} [c2] The second color\n * @param {number} [p=.5] A 0-1 percentage where 0 is c1 and 1 is c2\n * @param {Object} [o={}]\n * @return {Color}\n */\nexport function mix (c1, c2, p = .5, o = {}) {\n\t[c1, c2] = [getColor(c1), getColor(c2)];\n\n\tif (type(p) === \"object\") {\n\t\t[p, o] = [.5, p];\n\t}\n\n\tlet r = range(c1, c2, o);\n\treturn r(p);\n}\n\n/**\n *\n * @param {Color | string | Function} c1 The first color or a range\n * @param {Color | string} [c2] The second color if c1 is not a range\n * @param {Object} [options={}]\n * @return {Color[]}\n */\nexport function steps (c1, c2, options = {}) {\n\tlet colorRange;\n\n\tif (isRange(c1)) {\n\t\t// Tweaking existing range\n\t\t[colorRange, options] = [c1, c2];\n\t\t[c1, c2] = colorRange.rangeArgs.colors;\n\t}\n\n\tlet {\n\t\tmaxDeltaE, deltaEMethod,\n\t\tsteps = 2, maxSteps = 1000,\n\t\t...rangeOptions\n\t} = options;\n\n\tif (!colorRange) {\n\t\t[c1, c2] = [getColor(c1), getColor(c2)];\n\t\tcolorRange = range(c1, c2, rangeOptions);\n\t}\n\n\tlet totalDelta = deltaE(c1, c2);\n\tlet actualSteps = maxDeltaE > 0 ? Math.max(steps, Math.ceil(totalDelta / maxDeltaE) + 1) : steps;\n\tlet ret = [];\n\n\tif (maxSteps !== undefined) {\n\t\tactualSteps = Math.min(actualSteps, maxSteps);\n\t}\n\n\tif (actualSteps === 1) {\n\t\tret = [{p: .5, color: colorRange(.5)}];\n\t}\n\telse {\n\t\tlet step = 1 / (actualSteps - 1);\n\t\tret = Array.from({length: actualSteps}, (_, i) => {\n\t\t\tlet p = i * step;\n\t\t\treturn {p, color: colorRange(p)};\n\t\t});\n\t}\n\n\tif (maxDeltaE > 0) {\n\t\t// Iterate over all stops and find max deltaE\n\t\tlet maxDelta = ret.reduce((acc, cur, i) => {\n\t\t\tif (i === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tlet ΔΕ = deltaE(cur.color, ret[i - 1].color, deltaEMethod);\n\t\t\treturn Math.max(acc, ΔΕ);\n\t\t}, 0);\n\n\t\twhile (maxDelta > maxDeltaE) {\n\t\t\t// Insert intermediate stops and measure maxDelta again\n\t\t\t// We need to do this for all pairs, otherwise the midpoint shifts\n\t\t\tmaxDelta = 0;\n\n\t\t\tfor (let i = 1; (i < ret.length) && (ret.length < maxSteps); i++) {\n\t\t\t\tlet prev = ret[i - 1];\n\t\t\t\tlet cur = ret[i];\n\n\t\t\t\tlet p = (cur.p + prev.p) / 2;\n\t\t\t\tlet color = colorRange(p);\n\t\t\t\tmaxDelta = Math.max(maxDelta, deltaE(color, prev.color), deltaE(color, cur.color));\n\t\t\t\tret.splice(i, 0, {p, color: colorRange(p)});\n\t\t\t\ti++;\n\t\t\t}\n\t\t}\n\t}\n\n\tret = ret.map(a => a.color);\n\n\treturn ret;\n}\n\n/**\n * Interpolate to color2 and return a function that takes a 0-1 percentage\n * @param {Color | string | Function} color1 The first color or an existing range\n * @param {Color | string} [color2] If color1 is a color, this is the second color\n * @param {Object} [options={}]\n * @returns {Function} A function that takes a 0-1 percentage and returns a color\n */\nexport function range (color1, color2, options = {}) {\n\tif (isRange(color1)) {\n\t\t// Tweaking existing range\n\t\tlet [r, options] = [color1, color2];\n\n\t\treturn range(...r.rangeArgs.colors, {...r.rangeArgs.options, ...options});\n\t}\n\n\tlet {space, outputSpace, progression, premultiplied} = options;\n\n\tcolor1 = getColor(color1);\n\tcolor2 = getColor(color2);\n\n\t// Make sure we're working on copies of these colors\n\tcolor1 = clone(color1);\n\tcolor2 = clone(color2);\n\n\tlet rangeArgs = {colors: [color1, color2], options};\n\n\tif (space) {\n\t\tspace = ColorSpace.get(space);\n\t}\n\telse {\n\t\tspace = ColorSpace.registry[defaults.interpolationSpace] || color1.space;\n\t}\n\n\toutputSpace = outputSpace ? ColorSpace.get(outputSpace) : space;\n\n\tcolor1 = to(color1, space);\n\tcolor2 = to(color2, space);\n\n\t// Gamut map to avoid areas of flat color\n\tcolor1 = toGamut(color1);\n\tcolor2 = toGamut(color2);\n\n\t// Handle hue interpolation\n\t// See https://github.com/w3c/csswg-drafts/issues/4735#issuecomment-635741840\n\tif (space.coords.h && space.coords.h.type === \"angle\") {\n\t\tlet arc = options.hue = options.hue || \"shorter\";\n\n\t\tlet hue = [space, \"h\"];\n\t\tlet [θ1, θ2] = [get(color1, hue), get(color2, hue)];\n\t\t// Undefined hues must be evaluated before hue fix-up to properly\n\t\t// calculate hue arcs between undefined and defined hues.\n\t\t// See https://github.com/w3c/csswg-drafts/issues/9436#issuecomment-1746957545\n\t\tif (isNaN(θ1) && !isNaN(θ2)) {\n\t\t\tθ1 = θ2;\n\t\t}\n\t\telse if (isNaN(θ2) && !isNaN(θ1)) {\n\t\t\tθ2 = θ1;\n\t\t}\n\t\t[θ1, θ2] = angles.adjust(arc, [θ1, θ2]);\n\t\tset(color1, hue, θ1);\n\t\tset(color2, hue, θ2);\n\t}\n\n\tif (premultiplied) {\n\t\t// not coping with polar spaces yet\n\t\tcolor1.coords = color1.coords.map(c => c * color1.alpha);\n\t\tcolor2.coords = color2.coords.map(c => c * color2.alpha);\n\t}\n\n\treturn Object.assign(p => {\n\t\tp = progression ? progression(p) : p;\n\t\tlet coords = color1.coords.map((start, i) => {\n\t\t\tlet end = color2.coords[i];\n\t\t\treturn interpolate(start, end, p);\n\t\t});\n\n\t\tlet alpha = interpolate(color1.alpha, color2.alpha, p);\n\t\tlet ret = {space, coords, alpha};\n\n\t\tif (premultiplied) {\n\t\t\t// undo premultiplication\n\t\t\tret.coords = ret.coords.map(c => c / alpha);\n\t\t}\n\n\t\tif (outputSpace !== space) {\n\t\t\tret = to(ret, outputSpace);\n\t\t}\n\n\t\treturn ret;\n\t}, {\n\t\trangeArgs,\n\t});\n}\n\nexport function isRange (val) {\n\treturn type(val) === \"function\" && !!val.rangeArgs;\n}\n\ndefaults.interpolationSpace = \"lab\";\n\nexport function register (Color) {\n\tColor.defineFunction(\"mix\", mix, {returns: \"color\"});\n\tColor.defineFunction(\"range\", range, {returns: \"function<color>\"});\n\tColor.defineFunction(\"steps\", steps, {returns: \"array<color>\"});\n}\n","import ColorSpace from \"../space.js\";\nimport sRGB from \"./srgb.js\";\n\nexport default new ColorSpace({\n\tid: \"hsl\",\n\tname: \"HSL\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tl: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t},\n\n\tbase: sRGB,\n\n\t// Adapted from https://drafts.csswg.org/css-color-4/better-rgbToHsl.js\n\tfromBase: rgb => {\n\t\tlet max = Math.max(...rgb);\n\t\tlet min = Math.min(...rgb);\n\t\tlet [r, g, b] = rgb;\n\t\tlet [h, s, l] = [NaN, 0, (min + max) / 2];\n\t\tlet d = max - min;\n\n\t\tif (d !== 0) {\n\t\t\ts = (l === 0 || l === 1) ? 0 : (max - l) / Math.min(l, 1 - l);\n\n\t\t\tswitch (max) {\n\t\t\t\tcase r: h = (g - b) / d + (g < b ? 6 : 0); break;\n\t\t\t\tcase g: h = (b - r) / d + 2; break;\n\t\t\t\tcase b: h = (r - g) / d + 4;\n\t\t\t}\n\n\t\t\th = h * 60;\n\t\t}\n\n\t\t// Very out of gamut colors can produce negative saturation\n\t\t// If so, just rotate the hue by 180 and use a positive saturation\n\t\t// see https://github.com/w3c/csswg-drafts/issues/9222\n\t\tif (s < 0) {\n\t\t\th += 180;\n\t\t\ts = Math.abs(s);\n\t\t}\n\n\t\tif (h >= 360) {\n\t\t\th -= 360;\n\t\t}\n\n\t\treturn [h, s * 100, l * 100];\n\t},\n\n\t// Adapted from https://en.wikipedia.org/wiki/HSL_and_HSV#HSL_to_RGB_alternative\n\ttoBase: hsl => {\n\t\tlet [h, s, l] = hsl;\n\t\th = h % 360;\n\n\t\tif (h < 0) {\n\t\t\th += 360;\n\t\t}\n\n\t\ts /= 100;\n\t\tl /= 100;\n\n\t\tfunction f (n) {\n\t\t\tlet k = (n + h / 30) % 12;\n\t\t\tlet a = s * Math.min(l, 1 - l);\n\t\t\treturn l - a * Math.max(-1, Math.min(k - 3, 9 - k, 1));\n\t\t}\n\n\t\treturn [f(0), f(8), f(4)];\n\t},\n\n\tformats: {\n\t\t\"hsl\": {\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage>\", \"<percentage>\"],\n\t\t},\n\t\t\"hsla\": {\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage>\", \"<percentage>\"],\n\t\t\tcommas: true,\n\t\t\tlastAlpha: true,\n\t\t},\n\t},\n});\n","import ColorSpace from \"../space.js\";\nimport HSL from \"./hsl.js\";\n\n// The Hue, Whiteness Blackness (HWB) colorspace\n// See https://drafts.csswg.org/css-color-4/#the-hwb-notation\n// Note that, like HSL, calculations are done directly on\n// gamma-corrected sRGB values rather than linearising them first.\n\nexport default new ColorSpace({\n\tid: \"hsv\",\n\tname: \"HSV\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tv: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Value\",\n\t\t},\n\t},\n\n\tbase: HSL,\n\t// https://en.wikipedia.org/wiki/HSL_and_HSV#Interconversion\n\tfromBase (hsl) {\n\t\tlet [h, s, l] = hsl;\n\t\ts /= 100;\n\t\tl /= 100;\n\n\t\tlet v = l + s * Math.min(l, 1 - l);\n\n\t\treturn [\n\t\t\th, // h is the same\n\t\t\tv === 0 ? 0 : 200 * (1 - l / v), // s\n\t\t\t100 * v,\n\t\t];\n\t},\n\t// https://en.wikipedia.org/wiki/HSL_and_HSV#Interconversion\n\ttoBase (hsv) {\n\t\tlet [h, s, v] = hsv;\n\n\t\ts /= 100;\n\t\tv /= 100;\n\n\t\tlet l = v * (1 - s / 2);\n\n\t\treturn [\n\t\t\th, // h is the same\n\t\t\t(l === 0 || l === 1) ? 0 : ((v - l) / Math.min(l, 1 - l)) * 100,\n\t\t\tl * 100,\n\t\t];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--hsv\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../space.js\";\nimport HSV from \"./hsv.js\";\n\n// The Hue, Whiteness Blackness (HWB) colorspace\n// See https://drafts.csswg.org/css-color-4/#the-hwb-notation\n// Note that, like HSL, calculations are done directly on\n// gamma-corrected sRGB values rather than linearising them first.\n\nexport default new ColorSpace({\n\tid: \"hwb\",\n\tname: \"HWB\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\tw: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Whiteness\",\n\t\t},\n\t\tb: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Blackness\",\n\t\t},\n\t},\n\n\tbase: HSV,\n\tfromBase (hsv) {\n\t\tlet [h, s, v] = hsv;\n\n\t\treturn [h, v * (100 - s) / 100, 100 - v];\n\t},\n\ttoBase (hwb) {\n\t\tlet [h, w, b] = hwb;\n\n\t\t// Now convert percentages to [0..1]\n\t\tw /= 100;\n\t\tb /= 100;\n\n\t\t// Achromatic check (white plus black >= 1)\n\t\tlet sum = w + b;\n\t\tif (sum >= 1) {\n\t\t\tlet gray = w / sum;\n\t\t\treturn [h, 0, gray * 100];\n\t\t}\n\n\t\tlet v = (1 - b);\n\t\tlet s = (v === 0) ? 0 : 1 - w / v;\n\t\treturn [h, s * 100, v * 100];\n\t},\n\n\tformats: {\n\t\t\"hwb\": {\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import RGBColorSpace from \"../rgbspace.js\";\n\n// convert an array of linear-light a98-rgb values to CIE XYZ\n// http://www.brucelindbloom.com/index.html?Eqn_RGB_XYZ_Matrix.html\n// has greater numerical precision than section 4.3.5.3 of\n// https://www.adobe.com/digitalimag/pdfs/AdobeRGB1998.pdf\n// but the values below were calculated from first principles\n// from the chromaticity coordinates of R G B W\nconst toXYZ_M = [\n\t[ 0.5766690429101305,   0.1855582379065463,   0.1882286462349947  ],\n\t[ 0.29734497525053605,  0.6273635662554661,   0.07529145849399788 ],\n\t[ 0.02703136138641234,  0.07068885253582723,  0.9913375368376388  ],\n];\n\nconst fromXYZ_M = [\n\t[  2.0415879038107465,    -0.5650069742788596,   -0.34473135077832956 ],\n\t[ -0.9692436362808795,     1.8759675015077202,    0.04155505740717557 ],\n\t[  0.013444280632031142,  -0.11836239223101838,   1.0151749943912054  ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"a98rgb-linear\",\n\tcssId: \"--a98-rgb-linear\",\n\tname: \"Linear Adobe® 98 RGB compatible\",\n\twhite: \"D65\",\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../rgbspace.js\";\nimport A98Linear from \"./a98rgb-linear.js\";\n\nexport default new RGBColorSpace({\n\tid: \"a98rgb\",\n\tcssId: \"a98-rgb\",\n\tname: \"Adobe® 98 RGB compatible\",\n\tbase: A98Linear,\n\ttoBase: RGB => RGB.map(val => Math.pow(Math.abs(val), 563 / 256) * Math.sign(val)),\n\tfromBase: RGB => RGB.map(val => Math.pow(Math.abs(val), 256 / 563) * Math.sign(val)),\n});\n","import RGBColorSpace from \"../rgbspace.js\";\nimport XYZ_D50 from \"./xyz-d50.js\";\n\n// convert an array of  prophoto-rgb values to CIE XYZ\n// using  D50 (so no chromatic adaptation needed afterwards)\n// matrix cannot be expressed in rational form, but is calculated to 64 bit accuracy\n// see https://github.com/w3c/csswg-drafts/issues/7675\nconst toXYZ_M = [\n\t[ 0.79776664490064230,  0.13518129740053308,  0.03134773412839220 ],\n\t[ 0.28807482881940130,  0.71183523424187300,  0.00008993693872564 ],\n\t[ 0.00000000000000000,  0.00000000000000000,  0.82510460251046020 ],\n];\n\nconst fromXYZ_M = [\n\t[  1.34578688164715830, -0.25557208737979464, -0.05110186497554526 ],\n\t[ -0.54463070512490190,  1.50824774284514680,  0.02052744743642139 ],\n\t[  0.00000000000000000,  0.00000000000000000,  1.21196754563894520 ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"prophoto-linear\",\n\tcssId: \"--prophoto-rgb-linear\",\n\tname: \"Linear ProPhoto\",\n\twhite: \"D50\",\n\tbase: XYZ_D50,\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n","import RGBColorSpace from \"../rgbspace.js\";\nimport ProPhotoLinear from \"./prophoto-linear.js\";\n\nconst Et = 1 / 512;\nconst Et2 = 16 / 512;\n\nexport default new RGBColorSpace({\n\tid: \"prophoto\",\n\tcssId: \"prophoto-rgb\",\n\tname: \"ProPhoto\",\n\tbase: ProPhotoLinear,\n\ttoBase (RGB) {\n\t\t// Transfer curve is gamma 1.8 with a small linear portion\n\t\treturn RGB.map(v => v < Et2 ? v / 16 : v ** 1.8);\n\t},\n\tfromBase (RGB) {\n\t\treturn RGB.map(v => v >= Et ? v ** (1 / 1.8) : 16 * v);\n\t},\n});\n","import ColorSpace from \"../space.js\";\nimport OKLab from \"./oklab.js\";\nimport {constrain as constrainAngle} from \"../angles.js\";\n\nexport default new ColorSpace({\n\tid: \"oklch\",\n\tname: \"Oklch\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 1],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 0.4],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\twhite: \"D65\",\n\n\tbase: OKLab,\n\tfromBase (oklab) {\n\t\t// Convert to polar form\n\t\tlet [L, a, b] = oklab;\n\t\tlet h;\n\t\tconst ε = 0.0002; // chromatic components much smaller than a,b\n\n\t\tif (Math.abs(a) < ε && Math.abs(b) < ε) {\n\t\t\th = NaN;\n\t\t}\n\t\telse {\n\t\t\th = Math.atan2(b, a) * 180 / Math.PI;\n\t\t}\n\n\t\treturn [\n\t\t\tL, // OKLab L is still L\n\t\t\tMath.sqrt(a ** 2 + b ** 2), // Chroma\n\t\t\tconstrainAngle(h), // Hue, in degrees [0 to 360)\n\t\t];\n\t},\n\t// Convert from polar form\n\ttoBase (oklch) {\n\t\tlet [L, C, h] = oklch;\n\t\tlet a, b;\n\n\t\t// check for NaN hue\n\t\tif (isNaN(h)) {\n\t\t\ta = 0;\n\t\t\tb = 0;\n\t\t}\n\t\telse {\n\t\t\ta = C * Math.cos(h * Math.PI / 180);\n\t\t\tb = C * Math.sin(h * Math.PI / 180);\n\t\t}\n\n\t\treturn [ L, a, b ];\n\t},\n\n\tformats: {\n\t\t\"oklch\": {\n\t\t\tcoords: [\"<percentage> | <number>\", \"<number> | <percentage>[0,1]\", \"<number> | <angle>\"],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../space.js\";\nimport {WHITES} from \"../adapt.js\";\nimport xyz_d65 from \"./xyz-d65.js\";\nimport {uv} from \"../chromaticity.js\";\nimport {isNone, skipNone} from \"../util.js\";\n\nlet white = WHITES.D65;\n\nconst ε = 216 / 24389;  // 6^3/29^3 == (24/116)^3\nconst κ = 24389 / 27;   // 29^3/3^3\nconst [U_PRIME_WHITE, V_PRIME_WHITE] = uv({space: xyz_d65, coords: white});\n\nexport default new ColorSpace({\n\tid: \"luv\",\n\tname: \"Luv\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\t// Reference ranges from https://facelessuser.github.io/coloraide/colors/luv/\n\t\tu: {\n\t\t\trefRange: [-215, 215],\n\t\t},\n\t\tv: {\n\t\t\trefRange: [-215, 215],\n\t\t},\n\t},\n\n\twhite: white,\n\tbase: xyz_d65,\n\n\t// Convert D65-adapted XYZ to Luv\n\t// https://en.wikipedia.org/wiki/CIELUV#The_forward_transformation\n\tfromBase (XYZ) {\n\t\tlet xyz = [skipNone(XYZ[0]), skipNone(XYZ[1]), skipNone(XYZ[2])];\n\t\tlet y = xyz[1];\n\n\t\tlet [up, vp] = uv({space: xyz_d65, coords: xyz});\n\n\t\t// Protect against XYZ of [0, 0, 0]\n\t\tif (!Number.isFinite(up) || !Number.isFinite(vp)) {\n\t\t\treturn [0, 0, 0];\n\t\t}\n\n\t\tlet L = y <= ε ? κ * y : 116 * Math.cbrt(y) - 16;\n\t\treturn [\n\t\t\tL,\n\t\t\t13 * L * (up - U_PRIME_WHITE),\n\t\t\t13 * L * (vp - V_PRIME_WHITE),\n\t\t ];\n\t},\n\n\t// Convert Luv to D65-adapted XYZ\n\t// https://en.wikipedia.org/wiki/CIELUV#The_reverse_transformation\n\ttoBase (Luv) {\n\t\tlet [L, u, v] = Luv;\n\n\t\t// Protect against division by zero and NaN Lightness\n\t\tif (L === 0 || isNone(L)) {\n\t\t\treturn [0, 0, 0];\n\t\t}\n\n\t\tu = skipNone(u);\n\t\tv = skipNone(v);\n\n\t\tlet up = (u / (13 * L)) + U_PRIME_WHITE;\n\t\tlet vp = (v / (13 * L)) + V_PRIME_WHITE;\n\n\t\tlet y = L <= 8 ? L / κ : Math.pow((L + 16) / 116, 3);\n\n\t\treturn [\n\t\t\ty * ((9 * up) / (4 * vp)),\n\t\t\ty,\n\t\t\ty * ((12 - 3 * up - 20 * vp) / (4 * vp)),\n\t\t];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--luv\",\n\t\t\tcoords: [\"<number> | <percentage>\", \"<number> | <percentage>[-1,1]\", \"<number> | <percentage>[-1,1]\"],\n\t\t},\n\t},\n});\n","import ColorSpace from \"../space.js\";\nimport Luv from \"./luv.js\";\nimport {constrain as constrainAngle} from \"../angles.js\";\n\nexport default new ColorSpace({\n\tid: \"lchuv\",\n\tname: \"LChuv\",\n\tcoords: {\n\t\tl: {\n\t\t\trefRange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t\tc: {\n\t\t\trefRange: [0, 220],\n\t\t\tname: \"Chroma\",\n\t\t},\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t},\n\n\tbase: Luv,\n\tfromBase (Luv) {\n\t\t// Convert to polar form\n\t\tlet [L, u, v] = Luv;\n\t\tlet hue;\n\t\tconst ε = 0.02;\n\n\t\tif (Math.abs(u) < ε && Math.abs(v) < ε) {\n\t\t\thue = NaN;\n\t\t}\n\t\telse {\n\t\t\thue = Math.atan2(v, u) * 180 / Math.PI;\n\t\t}\n\n\t\treturn [\n\t\t\tL, // L is still L\n\t\t\tMath.sqrt(u ** 2 + v ** 2), // Chroma\n\t\t\tconstrainAngle(hue), // Hue, in degrees [0 to 360)\n\t\t];\n\t},\n\ttoBase (LCH) {\n\t\t// Convert from polar form\n\t\tlet [Lightness, Chroma, Hue] = LCH;\n\t\t// Clamp any negative Chroma\n\t\tif (Chroma < 0) {\n\t\t\tChroma = 0;\n\t\t}\n\t\t// Deal with NaN Hue\n\t\tif (isNaN(Hue)) {\n\t\t\tHue = 0;\n\t\t}\n\t\treturn [\n\t\t\tLightness, // L is still L\n\t\t\tChroma * Math.cos(Hue * Math.PI / 180), // u\n\t\t\tChroma * Math.sin(Hue * Math.PI / 180),  // v\n\t\t];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--lchuv\",\n\t\t\tcoords: [\"<number> | <percentage>\", \"<number> | <percentage>\", \"<number> | <angle>\"],\n\t\t},\n\t},\n});\n","/*\nAdapted from: https://github.com/hsluv/hsluv-javascript/blob/14b49e6cf9a9137916096b8487a5372626b57ba4/src/hsluv.ts\n\nCopyright (c) 2012-2022 Alexei Boronine\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nimport ColorSpace from \"../space.js\";\nimport LCHuv from \"./lchuv.js\";\nimport sRGB from \"./srgb.js\";\nimport {fromXYZ_M} from \"./srgb-linear.js\";\nimport {skipNone} from \"../util.js\";\n\nconst ε = 216 / 24389;  // 6^3/29^3 == (24/116)^3\nconst κ = 24389 / 27;   // 29^3/3^3\n\nconst m_r0 = fromXYZ_M[0][0];\nconst m_r1 = fromXYZ_M[0][1];\nconst m_r2 = fromXYZ_M[0][2];\nconst m_g0 = fromXYZ_M[1][0];\nconst m_g1 = fromXYZ_M[1][1];\nconst m_g2 = fromXYZ_M[1][2];\nconst m_b0 = fromXYZ_M[2][0];\nconst m_b1 = fromXYZ_M[2][1];\nconst m_b2 = fromXYZ_M[2][2];\n\nfunction distanceFromOriginAngle (slope, intercept, angle) {\n\tconst d = intercept / (Math.sin(angle) - slope * Math.cos(angle));\n\treturn d < 0 ? Infinity : d;\n}\n\nexport function calculateBoundingLines (l) {\n\tconst sub1 = Math.pow(l + 16, 3) / 1560896;\n\tconst sub2 = sub1 > ε ? sub1 : l / κ;\n\tconst s1r = sub2 * (284517 * m_r0 - 94839 * m_r2);\n\tconst s2r = sub2 * (838422 * m_r2 + 769860 * m_r1 + 731718 * m_r0);\n\tconst s3r = sub2 * (632260 * m_r2 - 126452 * m_r1);\n\tconst s1g = sub2 * (284517 * m_g0 - 94839 * m_g2);\n\tconst s2g = sub2 * (838422 * m_g2 + 769860 * m_g1 + 731718 * m_g0);\n\tconst s3g = sub2 * (632260 * m_g2 - 126452 * m_g1);\n\tconst s1b = sub2 * (284517 * m_b0 - 94839 * m_b2);\n\tconst s2b = sub2 * (838422 * m_b2 + 769860 * m_b1 + 731718 * m_b0);\n\tconst s3b = sub2 * (632260 * m_b2 - 126452 * m_b1);\n\n\treturn {\n\t\tr0s: s1r / s3r,\n\t\tr0i: s2r * l / s3r,\n\t\tr1s: s1r / (s3r + 126452),\n\t\tr1i: (s2r - 769860) * l / (s3r + 126452),\n\t\tg0s: s1g / s3g,\n\t\tg0i: s2g * l / s3g,\n\t\tg1s: s1g / (s3g + 126452),\n\t\tg1i: (s2g - 769860) * l / (s3g + 126452),\n\t\tb0s: s1b / s3b,\n\t\tb0i: s2b * l / s3b,\n\t\tb1s: s1b / (s3b + 126452),\n\t\tb1i: (s2b - 769860) * l / (s3b + 126452),\n\t};\n}\n\nfunction calcMaxChromaHsluv (lines, h) {\n\tconst hueRad = h / 360 * Math.PI * 2;\n\tconst r0 = distanceFromOriginAngle(lines.r0s, lines.r0i, hueRad);\n\tconst r1 = distanceFromOriginAngle(lines.r1s, lines.r1i, hueRad);\n\tconst g0 = distanceFromOriginAngle(lines.g0s, lines.g0i, hueRad);\n\tconst g1 = distanceFromOriginAngle(lines.g1s, lines.g1i, hueRad);\n\tconst b0 = distanceFromOriginAngle(lines.b0s, lines.b0i, hueRad);\n\tconst b1 = distanceFromOriginAngle(lines.b1s, lines.b1i, hueRad);\n\n\treturn Math.min(r0, r1, g0, g1, b0, b1);\n}\n\nexport default new ColorSpace({\n\tid: \"hsluv\",\n\tname: \"HSLuv\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tl: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t},\n\n\tbase: LCHuv,\n\tgamutSpace: sRGB,\n\n\t// Convert LCHuv to HSLuv\n\tfromBase (lch) {\n\t\tlet [l, c, h] = [skipNone(lch[0]), skipNone(lch[1]), skipNone(lch[2])];\n\t\tlet s;\n\n\t\tif (l > 99.9999999) {\n\t\t\ts = 0;\n\t\t\tl = 100;\n\t\t}\n\t\telse if (l < 0.00000001) {\n\t\t\ts = 0;\n\t\t\tl = 0;\n\t\t}\n\t\telse {\n\t\t\tlet lines = calculateBoundingLines(l);\n\t\t\tlet max = calcMaxChromaHsluv(lines, h);\n\t\t\ts = c / max * 100;\n\t\t}\n\n\t\treturn [h, s, l];\n\t},\n\n\t// Convert HSLuv to LCHuv\n\ttoBase (hsl) {\n\t\tlet [h, s, l] = [skipNone(hsl[0]), skipNone(hsl[1]), skipNone(hsl[2])];\n\t\tlet c;\n\n\t\tif (l > 99.9999999) {\n\t\t\tl = 100;\n\t\t\tc = 0;\n\t\t}\n\t\telse if (l < 0.00000001) {\n\t\t\tl = 0;\n\t\t\tc = 0;\n\t\t}\n\t\telse {\n\t\t\tlet lines = calculateBoundingLines(l);\n\t\t\tlet max = calcMaxChromaHsluv(lines, h);\n\t\t\tc = max / 100 * s;\n\t\t}\n\n\t\treturn [l, c, h];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--hsluv\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","/*\nAdapted from: https://github.com/hsluv/hsluv-javascript/blob/14b49e6cf9a9137916096b8487a5372626b57ba4/src/hsluv.ts\n\nCopyright (c) 2012-2022 Alexei Boronine\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nimport ColorSpace from \"../space.js\";\nimport LCHuv from \"./lchuv.js\";\nimport {fromXYZ_M} from \"./srgb-linear.js\";\nimport {skipNone} from \"../util.js\";\nimport {calculateBoundingLines} from \"./hsluv.js\";\n\nconst ε = 216 / 24389;  // 6^3/29^3 == (24/116)^3\nconst κ = 24389 / 27;   // 29^3/3^3\n\nconst m_r0 = fromXYZ_M[0][0];\nconst m_r1 = fromXYZ_M[0][1];\nconst m_r2 = fromXYZ_M[0][2];\nconst m_g0 = fromXYZ_M[1][0];\nconst m_g1 = fromXYZ_M[1][1];\nconst m_g2 = fromXYZ_M[1][2];\nconst m_b0 = fromXYZ_M[2][0];\nconst m_b1 = fromXYZ_M[2][1];\nconst m_b2 = fromXYZ_M[2][2];\n\nfunction distanceFromOrigin (slope, intercept) {\n\treturn Math.abs(intercept) / Math.sqrt(Math.pow(slope, 2) + 1);\n}\n\nfunction calcMaxChromaHpluv (lines) {\n\tlet r0 = distanceFromOrigin(lines.r0s, lines.r0i);\n\tlet r1 = distanceFromOrigin(lines.r1s, lines.r1i);\n\tlet g0 = distanceFromOrigin(lines.g0s, lines.g0i);\n\tlet g1 = distanceFromOrigin(lines.g1s, lines.g1i);\n\tlet b0 = distanceFromOrigin(lines.b0s, lines.b0i);\n\tlet b1 = distanceFromOrigin(lines.b1s, lines.b1i);\n\n\treturn Math.min(r0, r1, g0, g1, b0, b1);\n}\n\nexport default new ColorSpace({\n\tid: \"hpluv\",\n\tname: \"HPLuv\",\n\tcoords: {\n\t\th: {\n\t\t\trefRange: [0, 360],\n\t\t\ttype: \"angle\",\n\t\t\tname: \"Hue\",\n\t\t},\n\t\ts: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Saturation\",\n\t\t},\n\t\tl: {\n\t\t\trange: [0, 100],\n\t\t\tname: \"Lightness\",\n\t\t},\n\t},\n\n\tbase: LCHuv,\n\tgamutSpace: \"self\",\n\n\t// Convert LCHuv to HPLuv\n\tfromBase (lch) {\n\t\tlet [l, c, h] = [skipNone(lch[0]), skipNone(lch[1]), skipNone(lch[2])];\n\t\tlet s;\n\n\t\tif (l > 99.9999999) {\n\t\t\ts = 0;\n\t\t\tl = 100;\n\t\t}\n\t\telse if (l < 0.00000001) {\n\t\t\ts = 0;\n\t\t\tl = 0;\n\t\t}\n\t\telse {\n\t\t\tlet lines = calculateBoundingLines(l);\n\t\t\tlet max = calcMaxChromaHpluv(lines);\n\t\t\ts = c / max * 100;\n\t\t}\n\t\treturn [h, s, l];\n\t},\n\n\t// Convert HPLuv to LCHuv\n\ttoBase (hsl) {\n\t\tlet [h, s, l] = [skipNone(hsl[0]), skipNone(hsl[1]), skipNone(hsl[2])];\n\t\tlet c;\n\n\t\tif (l > 99.9999999) {\n\t\t\tl = 100;\n\t\t\tc = 0;\n\t\t}\n\t\telse if (l < 0.00000001) {\n\t\t\tl = 0;\n\t\t\tc = 0;\n\t\t}\n\t\telse {\n\t\t\tlet lines = calculateBoundingLines(l);\n\t\t\tlet max = calcMaxChromaHpluv(lines, h);\n\t\t\tc = max / 100 * s;\n\t\t}\n\n\t\treturn [l, c, h];\n\t},\n\n\tformats: {\n\t\tcolor: {\n\t\t\tid: \"--hpluv\",\n\t\t\tcoords: [\"<number> | <angle>\", \"<percentage> | <number>\", \"<percentage> | <number>\"],\n\t\t},\n\t},\n});\n","import RGBColorSpace from \"../rgbspace.js\";\nimport REC2020Linear from \"./rec2020-linear.js\";\n\nconst Yw = 203;\t// absolute luminance of media white, cd/m²\nconst n = 2610 / (2 ** 14);\nconst ninv = (2 ** 14) / 2610;\nconst m = 2523 / (2 ** 5);\nconst minv = (2 ** 5) / 2523;\nconst c1 = 3424 / (2 ** 12);\nconst c2 = 2413 / (2 ** 7);\nconst c3 = 2392 / (2 ** 7);\n\nexport default new RGBColorSpace({\n\tid: \"rec2100pq\",\n\tcssId: \"rec2100-pq\",\n\tname: \"REC.2100-PQ\",\n\tbase: REC2020Linear,\n\ttoBase (RGB) {\n\t\t// given PQ encoded component in range [0, 1]\n\t\t// return media-white relative linear-light\n\t\treturn RGB.map(function (val) {\n\t\t\tlet x = ((Math.max(((val ** minv) - c1), 0) / (c2 - (c3 * (val ** minv)))) ** ninv);\n\t\t\treturn (x * 10000 / Yw); \t// luminance relative to diffuse white, [0, 70 or so].\n\t\t});\n\t},\n\tfromBase (RGB) {\n\t\t// given media-white relative linear-light\n\t\t// returnPQ encoded component in range [0, 1]\n\t\treturn RGB.map(function (val) {\n\t\t\tlet x = Math.max(val * Yw / 10000, 0); \t// absolute luminance of peak white is 10,000 cd/m².\n\t\t\tlet num = (c1 + (c2 * (x ** n)));\n\t\t\tlet denom = (1 + (c3 * (x ** n)));\n\n\t\t\treturn ((num / denom)  ** m);\n\t\t});\n\t},\n});\n","import RGBColorSpace from \"../rgbspace.js\";\nimport REC2020Linear from \"./rec2020-linear.js\";\n\n// FIXME see https://github.com/LeaVerou/color.js/issues/190\n\nconst a = 0.17883277;\nconst b = 0.28466892; // 1 - (4 * a)\nconst c = 0.55991073; // 0.5 - a * Math.log(4 *a)\n\nconst scale = 3.7743;\t// Place 18% grey at HLG 0.38, so media white at 0.75\n\nexport default new RGBColorSpace({\n\tid: \"rec2100hlg\",\n\tcssId: \"rec2100-hlg\",\n\tname: \"REC.2100-HLG\",\n\treferred: \"scene\",\n\n\tbase: REC2020Linear,\n\ttoBase (RGB) {\n\t\t// given HLG encoded component in range [0, 1]\n\t\t// return media-white relative linear-light\n\t\treturn RGB.map(function (val) {\n\t\t\t// first the HLG EOTF\n\t\t\t// ITU-R BT.2390-10 p.30 section\n\t\t\t// 6.3 The hybrid log-gamma electro-optical transfer function (EOTF)\n\t\t\t// Then scale by 3 so media white is 1.0\n\t\t\tif (val <= 0.5) {\n\t\t\t\treturn (val ** 2) / 3 * scale;\n\t\t\t}\n\t\t\treturn ((Math.exp((val - c) / a) + b) / 12) * scale;\n\t\t});\n\t},\n\tfromBase (RGB) {\n\t\t// given media-white relative linear-light\n\t\t// where diffuse white is 1.0,\n\t\t// return HLG encoded component in range [0, 1]\n\t\treturn RGB.map(function (val) {\n\t\t\t// first scale to put linear-light media white at 1/3\n\t\t\tval /= scale;\n\t\t\t// now the HLG OETF\n\t\t\t// ITU-R BT.2390-10 p.23\n\t\t\t// 6.1 The hybrid log-gamma opto-electronic transfer function (OETF)\n\t\t\tif (val <= 1 / 12) {\n\t\t\t\treturn Math.sqrt(3 * val);\n\t\t\t}\n\t\t\treturn a * Math.log(12 * val - b) + c;\n\t\t});\n\t},\n});\n","import hooks from \"./hooks.js\";\nimport {multiplyMatrices} from \"./util.js\";\nimport {WHITES} from \"./adapt.js\";\n\nexport const CATs = {};\n\nhooks.add(\"chromatic-adaptation-start\", env => {\n\tif (env.options.method) {\n\t\tenv.M = adapt(env.W1, env.W2, env.options.method);\n\t}\n});\n\nhooks.add(\"chromatic-adaptation-end\", env => {\n\tif (!env.M) {\n\t\tenv.M = adapt(env.W1, env.W2, env.options.method);\n\t}\n});\n\nexport function defineCAT ({id, toCone_M, fromCone_M}) {\n\t// Use id, toCone_M, fromCone_M like variables\n\tCATs[id] = arguments[0];\n}\n\nexport function adapt (W1, W2, id = \"Bradford\") {\n\t// adapt from a source whitepoint or illuminant W1\n\t// to a destination whitepoint or illuminant W2,\n\t// using the given chromatic adaptation transform (CAT)\n\t// debugger;\n\tlet method = CATs[id];\n\n\tlet [ρs, γs, βs] = multiplyMatrices(method.toCone_M, W1);\n\tlet [ρd, γd, βd] = multiplyMatrices(method.toCone_M, W2);\n\n\t// all practical illuminants have non-zero XYZ so no division by zero can occur below\n\tlet scale = [\n\t\t[ρd / ρs,  0,        0      ],\n\t\t[0,        γd / γs,  0      ],\n\t\t[0,        0,        βd / βs],\n\t];\n\t// console.log({scale});\n\n\tlet scaled_cone_M = multiplyMatrices(scale, method.toCone_M);\n\tlet adapt_M\t= multiplyMatrices(method.fromCone_M, scaled_cone_M);\n\t// console.log({scaled_cone_M, adapt_M});\n\treturn adapt_M;\n}\n\ndefineCAT({\n\tid: \"von Kries\",\n\ttoCone_M: [\n\t\t[  0.4002400,  0.7076000, -0.0808100 ],\n\t\t[ -0.2263000,  1.1653200,  0.0457000 ],\n\t\t[  0.0000000,  0.0000000,  0.9182200 ],\n\t],\n\tfromCone_M: [\n\t\t[ 1.8599363874558397, -1.1293816185800916,   0.21989740959619328     ],\n\t\t[ 0.3611914362417676,  0.6388124632850422,  -0.000006370596838649899 ],\n\t\t[ 0,                   0,                    1.0890636230968613      ],\n\t],\n});\n\ndefineCAT({\n\tid: \"Bradford\",\n\t// Convert an array of XYZ values in the range 0.0 - 1.0\n\t// to cone fundamentals\n\ttoCone_M: [\n\t\t[  0.8951000,  0.2664000, -0.1614000 ],\n\t\t[ -0.7502000,  1.7135000,  0.0367000 ],\n\t\t[  0.0389000, -0.0685000,  1.0296000 ],\n\t],\n\t// and back\n\tfromCone_M: [\n\t\t[  0.9869929054667121, -0.14705425642099013, 0.15996265166373122  ],\n\t\t[  0.4323052697233945,  0.5183602715367774,  0.049291228212855594 ],\n\t\t[ -0.00852866457517732, 0.04004282165408486, 0.96848669578755     ],\n\t],\n});\n\ndefineCAT({\n\tid: \"CAT02\",\n\t// with complete chromatic adaptation to W2, so D = 1.0\n\ttoCone_M: [\n\t\t[  0.7328000,  0.4296000, -0.1624000 ],\n\t\t[ -0.7036000,  1.6975000,  0.0061000 ],\n\t\t[  0.0030000,  0.0136000,  0.9834000 ],\n\t],\n\tfromCone_M: [\n\t\t[  1.0961238208355142,   -0.27886900021828726, 0.18274517938277307 ],\n\t\t[  0.4543690419753592,    0.4735331543074117,  0.07209780371722911 ],\n\t\t[ -0.009627608738429355, -0.00569803121611342, 1.0153256399545427  ],\n\t],\n});\n\ndefineCAT({\n\tid: \"CAT16\",\n\ttoCone_M: [\n\t\t[  0.401288,  0.650173, -0.051461 ],\n\t\t[ -0.250268,  1.204414,  0.045854 ],\n\t\t[ -0.002079,  0.048952,  0.953127 ],\n\t],\n\t// the extra precision is needed to avoid roundtripping errors\n\tfromCone_M: [\n\t\t[  1.862067855087233,   -1.0112546305316845,  0.14918677544445172  ],\n\t\t[  0.3875265432361372,   0.6214474419314753, -0.008973985167612521 ],\n\t\t[ -0.01584149884933386, -0.03412293802851557, 1.0499644368778496   ],\n\t],\n});\n\nObject.assign(WHITES, {\n\t// whitepoint values from ASTM E308-01 with 10nm spacing, 1931 2 degree observer\n\t// all normalized to Y (luminance) = 1.00000\n\t// Illuminant A is a tungsten electric light, giving a very warm, orange light.\n\tA:   [1.09850, 1.00000, 0.35585],\n\n\t// Illuminant C was an early approximation to daylight: illuminant A with a blue filter.\n\tC:   [0.98074, 1.000000, 1.18232],\n\n\t// The daylight series of illuminants simulate natural daylight.\n\t// The color temperature (in degrees Kelvin/100) ranges from\n\t// cool, overcast daylight (D50) to bright, direct sunlight (D65).\n\tD55: [0.95682, 1.00000, 0.92149],\n\tD75: [0.94972, 1.00000, 1.22638],\n\n\t// Equal-energy illuminant, used in two-stage CAT16\n\tE:   [1.00000, 1.00000, 1.00000],\n\n\t// The F series of illuminants represent fluorescent lights\n\tF2:  [0.99186, 1.00000, 0.67393],\n\tF7:  [0.95041, 1.00000, 1.08747],\n\tF11: [1.00962, 1.00000, 0.64350],\n});\n","import RGBColorSpace from \"../rgbspace.js\";\nimport {WHITES} from \"../adapt.js\";\nimport \"../CATs.js\"; // because of the funky whitepoint\n\n// The ACES whitepoint\n// see TB-2018-001 Derivation of the ACES White Point CIE Chromaticity Coordinates\n// also https://github.com/ampas/aces-dev/blob/master/documents/python/TB-2018-001/aces_wp.py\n// Similar to D60\nWHITES.ACES = [0.32168 / 0.33767, 1.00000, (1.00000 - 0.32168 - 0.33767) / 0.33767];\n\n// convert an array of linear-light ACEScc values to CIE XYZ\nconst toXYZ_M = [\n\t[  0.6624541811085053,   0.13400420645643313,  0.1561876870049078  ],\n\t[  0.27222871678091454,  0.6740817658111484,   0.05368951740793705 ],\n\t[ -0.005574649490394108, 0.004060733528982826, 1.0103391003129971  ],\n];\nconst fromXYZ_M = [\n\t[  1.6410233796943257,   -0.32480329418479,    -0.23642469523761225  ],\n\t[ -0.6636628587229829,    1.6153315916573379,   0.016756347685530137 ],\n\t[  0.011721894328375376, -0.008284441996237409, 0.9883948585390215   ],\n];\n\nexport default new RGBColorSpace({\n\tid: \"acescg\",\n\tcssId: \"--acescg\",\n\tname: \"ACEScg\",\n\n\t// ACEScg – A scene-referred, linear-light encoding of ACES Data\n\t// https://docs.acescentral.com/specifications/acescg/\n\t// uses the AP1 primaries, see section 4.3.1 Color primaries\n\tcoords: {\n\t\tr: {\n\t\t\trange: [0, 65504],\n\t\t\tname: \"Red\",\n\t\t},\n\t\tg: {\n\t\t\trange: [0, 65504],\n\t\t\tname: \"Green\",\n\t\t},\n\t\tb: {\n\t\t\trange: [0, 65504],\n\t\t\tname: \"Blue\",\n\t\t},\n\t},\n\n\treferred: \"scene\",\n\n\twhite: WHITES.ACES,\n\n\ttoXYZ_M,\n\tfromXYZ_M,\n});\n\n// export default Color;\n","import RGBColorSpace from \"../rgbspace.js\";\nimport \"../CATs.js\"; // because of the funky whitepoint\nimport ACEScg from \"./acescg.js\";\n\nconst ε = 2 ** -16;\n\n// the smallest value which, in the 32bit IEEE 754 float encoding,\n// decodes as a non-negative value\nconst ACES_min_nonzero = -0.35828683;\n\n// brightest encoded value, decodes to 65504\nconst ACES_cc_max = (Math.log2(65504) + 9.72) / 17.52; // 1.468\n\nexport default new RGBColorSpace({\n\tid: \"acescc\",\n\tcssId: \"--acescc\",\n\tname: \"ACEScc\",\n\t// see S-2014-003 ACEScc – A Logarithmic Encoding of ACES Data\n\t// https://docs.acescentral.com/specifications/acescc/\n\t// uses the AP1 primaries, see section 4.3.1 Color primaries\n\n\t// Appendix A: \"Very small ACES scene referred values below 7 1/4 stops\n\t// below 18% middle gray are encoded as negative ACEScc values.\n\t// These values should be preserved per the encoding in Section 4.4\n\t// so that all positive ACES values are maintained.\"\n\tcoords: {\n\t\tr: {\n\t\t\trange: [ACES_min_nonzero, ACES_cc_max],\n\t\t\tname: \"Red\",\n\t\t},\n\t\tg: {\n\t\t\trange: [ACES_min_nonzero, ACES_cc_max],\n\t\t\tname: \"Green\",\n\t\t},\n\t\tb: {\n\t\t\trange: [ACES_min_nonzero, ACES_cc_max],\n\t\t\tname: \"Blue\",\n\t\t},\n\t},\n\treferred: \"scene\",\n\n\tbase: ACEScg,\n\t// from section 4.4.2 Decoding Function\n\ttoBase (RGB) {\n\t\tconst low = (9.72 - 15) / 17.52; // -0.3014\n\n\t\treturn RGB.map(function (val) {\n\t\t\tif (val <= low) {\n\t\t\t\treturn (2 ** ((val * 17.52) - 9.72) - ε) * 2; // very low values, below -0.3014\n\t\t\t}\n\t\t\telse if (val < ACES_cc_max) {\n\t\t\t\treturn 2 ** ((val * 17.52) - 9.72);\n\t\t\t}\n\t\t\telse { // val >= ACES_cc_max\n\t\t\t\treturn 65504;\n\t\t\t}\n\t\t});\n\t},\n\n\t// Non-linear encoding function from S-2014-003, section 4.4.1 Encoding Function\n\tfromBase (RGB) {\n\t\treturn RGB.map(function (val) {\n\t\t\tif (val <= 0) {\n\t\t\t\treturn (Math.log2(ε) + 9.72) / 17.52; // -0.3584\n\t\t\t}\n\t\t\telse if (val < ε) {\n\t\t\t\treturn  (Math.log2(ε + val * 0.5) + 9.72) / 17.52;\n\t\t\t}\n\t\t\telse { // val >= ε\n\t\t\t\treturn  (Math.log2(val) + 9.72) / 17.52;\n\t\t\t}\n\t\t});\n\t},\n\t// encoded media white (rgb 1,1,1) => linear  [ 222.861, 222.861, 222.861 ]\n\t// encoded media black (rgb 0,0,0) => linear [ 0.0011857, 0.0011857, 0.0011857]\n});\n","import * as util from \"./util.js\";\nimport hooks from \"./hooks.js\";\nimport defaults from \"./defaults.js\";\nimport ColorSpace from \"./space.js\";\nimport {WHITES} from \"./adapt.js\";\nimport {\n\tgetColor,\n\tparse,\n\tto,\n\tserialize,\n\tinGamut,\n\ttoGamut,\n\tdistance,\n\tequals,\n\tget,\n\tgetAll,\n\tset,\n\tsetAll,\n\tdisplay,\n} from \"./index-fn.js\";\n\n\nimport \"./spaces/xyz-d50.js\";\nimport \"./spaces/srgb.js\";\n\n/**\n * Class that represents a color\n */\nexport default class Color {\n\t/**\n\t * Creates an instance of Color.\n\t * Signatures:\n\t * - `new Color(stringToParse)`\n\t * - `new Color(otherColor)`\n\t * - `new Color({space, coords, alpha})`\n\t * - `new Color(space, coords, alpha)`\n\t * - `new Color(spaceId, coords, alpha)`\n\t */\n\tconstructor (...args) {\n\t\tlet color;\n\n\t\tif (args.length === 1) {\n\t\t\tcolor = getColor(args[0]);\n\t\t}\n\n\t\tlet space, coords, alpha;\n\n\t\tif (color) {\n\t\t\tspace = color.space || color.spaceId;\n\t\t\tcoords = color.coords;\n\t\t\talpha = color.alpha;\n\t\t}\n\t\telse {\n\t\t\t// default signature new Color(ColorSpace, array [, alpha])\n\t\t\t[space, coords, alpha] = args;\n\t\t}\n\n\t\tObject.defineProperty(this, \"space\", {\n\t\t\tvalue: ColorSpace.get(space),\n\t\t\twritable: false,\n\t\t\tenumerable: true,\n\t\t\tconfigurable: true, // see note in https://262.ecma-international.org/8.0/#sec-proxy-object-internal-methods-and-internal-slots-get-p-receiver\n\t\t});\n\n\t\tthis.coords = coords ? coords.slice() : [0, 0, 0];\n\n\t\t// Clamp alpha to [0, 1]\n\t\tthis.alpha = alpha > 1 || alpha === undefined ? 1 : (alpha < 0 ? 0 : alpha);\n\n\t\t// Convert \"NaN\" to NaN\n\t\tfor (let i = 0; i < this.coords.length; i++) {\n\t\t\tif (this.coords[i] === \"NaN\") {\n\t\t\t\tthis.coords[i] = NaN;\n\t\t\t}\n\t\t}\n\n\t\t// Define getters and setters for each coordinate\n\t\tfor (let id in this.space.coords) {\n\t\t\tObject.defineProperty(this, id, {\n\t\t\t\tget: () => this.get(id),\n\t\t\t\tset: value => this.set(id, value),\n\t\t\t});\n\t\t}\n\t}\n\n\tget spaceId () {\n\t\treturn this.space.id;\n\t}\n\n\tclone () {\n\t\treturn new Color(this.space, this.coords, this.alpha);\n\t}\n\n\ttoJSON () {\n\t\treturn {\n\t\t\tspaceId: this.spaceId,\n\t\t\tcoords: this.coords,\n\t\t\talpha: this.alpha,\n\t\t};\n\t}\n\n\tdisplay (...args) {\n\t\tlet ret = display(this, ...args);\n\n\t\t// Convert color object to Color instance\n\t\tret.color = new Color(ret.color);\n\n\t\treturn ret;\n\t}\n\n\t/**\n\t * Get a color from the argument passed\n\t * Basically gets us the same result as new Color(color) but doesn't clone an existing color object\n\t */\n\tstatic get (color, ...args) {\n\t\tif (color instanceof Color) {\n\t\t\treturn color;\n\t\t}\n\n\t\treturn new Color(color, ...args);\n\t}\n\n\tstatic defineFunction (name, code, o = code) {\n\t\tlet {instance = true, returns} = o;\n\n\t\tlet func = function (...args) {\n\t\t\tlet ret = code(...args);\n\n\t\t\tif (returns === \"color\") {\n\t\t\t\tret = Color.get(ret);\n\t\t\t}\n\t\t\telse if (returns === \"function<color>\") {\n\t\t\t\tlet f = ret;\n\t\t\t\tret = function (...args) {\n\t\t\t\t\tlet ret = f(...args);\n\t\t\t\t\treturn Color.get(ret);\n\t\t\t\t};\n\t\t\t\t// Copy any function metadata\n\t\t\t\tObject.assign(ret, f);\n\t\t\t}\n\t\t\telse if (returns === \"array<color>\") {\n\t\t\t\tret = ret.map(c => Color.get(c));\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t};\n\n\t\tif (!(name in Color)) {\n\t\t\tColor[name] = func;\n\t\t}\n\n\t\tif (instance) {\n\t\t\tColor.prototype[name] = function (...args) {\n\t\t\t\treturn func(this, ...args);\n\t\t\t};\n\t\t}\n\t}\n\n\tstatic defineFunctions (o) {\n\t\tfor (let name in o) {\n\t\t\tColor.defineFunction(name, o[name], o[name]);\n\t\t}\n\t}\n\n\tstatic extend (exports) {\n\t\tif (exports.register) {\n\t\t\texports.register(Color);\n\t\t}\n\t\telse {\n\t\t\t// No register method, just add the module's functions\n\t\t\tfor (let name in exports) {\n\t\t\t\tColor.defineFunction(name, exports[name]);\n\t\t\t}\n\t\t}\n\t}\n}\n\nColor.defineFunctions({\n\tget,\n\tgetAll,\n\tset,\n\tsetAll,\n\tto,\n\tequals,\n\tinGamut,\n\ttoGamut,\n\tdistance,\n\ttoString: serialize,\n});\n\nObject.assign(Color, {\n\tutil,\n\thooks,\n\tWHITES,\n\tSpace: ColorSpace,\n\tspaces: ColorSpace.registry,\n\tparse,\n\n\t// Global defaults one may want to configure\n\tdefaults,\n});\n","import ColorSpace from \"../space.js\";\nimport * as spaces from \"./index-fn.js\";\n\nexport * as spaces from \"./index-fn.js\";\n\nfor (let key of Object.keys(spaces)) {\n\tColorSpace.register(spaces[key]);\n}\n","/**\n * This plugin defines getters and setters for color[spaceId]\n * e.g. color.lch on *any* color gives us the lch coords\n */\nimport ColorSpace from \"./space.js\";\nimport Color from \"./color.js\";\nimport hooks from \"./hooks.js\";\n\n// Add space accessors to existing color spaces\nfor (let id in ColorSpace.registry) {\n\taddSpaceAccessors(id, ColorSpace.registry[id]);\n}\n\n// Add space accessors to color spaces not yet created\nhooks.add(\"colorspace-init-end\", space => {\n\taddSpaceAccessors(space.id, space);\n\tspace.aliases?.forEach(alias => {\n\t\taddSpaceAccessors(alias, space);\n\t});\n});\n\nfunction addSpaceAccessors (id, space) {\n\tlet propId = id.replace(/-/g, \"_\");\n\n\tObject.defineProperty(Color.prototype, propId, {\n\t\t// Convert coords to coords in another colorspace and return them\n\t\t// Source colorspace: this.spaceId\n\t\t// Target colorspace: id\n\t\tget () {\n\t\t\tlet ret = this.getAll(id);\n\n\t\t\tif (typeof Proxy === \"undefined\") {\n\t\t\t\t// If proxies are not supported, just return a static array\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\t// Enable color.spaceId.coordName syntax\n\t\t\treturn new Proxy(ret, {\n\t\t\t\thas: (obj, property) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tColorSpace.resolveCoord([space, property]);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {}\n\n\t\t\t\t\treturn Reflect.has(obj, property);\n\t\t\t\t},\n\t\t\t\tget: (obj, property, receiver) => {\n\t\t\t\t\tif (property && typeof property !== \"symbol\" && !(property in obj)) {\n\t\t\t\t\t\tlet {index} = ColorSpace.resolveCoord([space, property]);\n\n\t\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\t\treturn obj[index];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Reflect.get(obj, property, receiver);\n\t\t\t\t},\n\t\t\t\tset: (obj, property, value, receiver) => {\n\t\t\t\t\tif (property && typeof property !== \"symbol\" && !(property in obj) || property >= 0) {\n\t\t\t\t\t\tlet {index} = ColorSpace.resolveCoord([space, property]);\n\n\t\t\t\t\t\tif (index >= 0) {\n\t\t\t\t\t\t\tobj[index] = value;\n\n\t\t\t\t\t\t\t// Update color.coords\n\t\t\t\t\t\t\tthis.setAll(id, obj);\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Reflect.set(obj, property, value, receiver);\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\t// Convert coords in another colorspace to internal coords and set them\n\t\t// Target colorspace: this.spaceId\n\t\t// Source colorspace: id\n\t\tset (coords) {\n\t\t\tthis.setAll(id, coords);\n\t\t},\n\t\tconfigurable: true,\n\t\tenumerable: true,\n\t});\n}\n","// Import all modules of Color.js\nimport Color from \"./color.js\";\n\n// Import all color spaces\nimport \"./spaces/index.js\";\n\n// Import all DeltaE methods\nimport deltaE from \"./deltaE.js\";\nimport deltaEMethods from \"./deltaE/index.js\";\n\nColor.extend(deltaEMethods);\nColor.extend({deltaE});\nObject.assign(Color, {deltaEMethods});\n\n// Import optional modules\nimport * as variations from \"./variations.js\";\nColor.extend(variations);\n\nimport contrast from \"./contrast.js\";\nColor.extend({contrast});\n\nimport * as chromaticity from \"./chromaticity.js\";\nColor.extend(chromaticity);\n\nimport * as luminance from \"./luminance.js\";\nColor.extend(luminance);\n\nimport * as interpolation from \"./interpolation.js\";\nColor.extend(interpolation);\n\nimport * as contrastMethods from \"./contrast/index.js\";\nColor.extend(contrastMethods);\n\nimport \"./CATs.js\";\nimport \"./space-accessors.js\";\n\n// Re-export everything\nexport default Color;\n"],"mappings":"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","names":["a","scale","m","p","c","n","to","coordGrammar","type","range","clamp","max","d","name","adapt","util.mapRange","util.parseFunction","util.last","ε","white","coords","options","XYZ_D65","ε3","κ","xyz_d50","Lab","a","b","constrainAngle","π","d2r","XYZtoLMS_M","LMStoXYZ_M","OKLab","oklab","c1","c2","Yw","ninv","c3","Jzazbz","jzczhz","m1","deg2rad","viewingConditions","cam16","last","hct","util.isString","util.isNone","clipped","deltaE","min","util.clamp","inGamut","checkInGamut","util.serializeNumber","toXYZ_M","fromXYZ_M","register","Color","contrast","contrastAlgorithms","steps","angles.adjust","g","hwb","oklch","Luv","lch","scale","args","ret","c","oklch","opacity","scale","steps","p"]}