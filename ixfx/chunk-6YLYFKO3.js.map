{"version":3,"sources":["../node_modules/fp-ts/lib/function.js","../node_modules/fp-ts/lib/internal.js","../node_modules/fp-ts/lib/Apply.js","../node_modules/fp-ts/lib/Chain.js","../node_modules/fp-ts/lib/FromEither.js","../node_modules/fp-ts/lib/Functor.js","../node_modules/fp-ts/lib/Eq.js","../node_modules/fp-ts/lib/Ord.js","../node_modules/fp-ts/lib/Magma.js","../node_modules/fp-ts/lib/Semigroup.js","../node_modules/fp-ts/lib/ReadonlyNonEmptyArray.js","../node_modules/fp-ts/lib/NonEmptyArray.js","../node_modules/fp-ts/lib/number.js","../node_modules/fp-ts/lib/Separated.js","../node_modules/fp-ts/lib/Witherable.js","../node_modules/fp-ts/lib/Zero.js","../node_modules/fp-ts/lib/ReadonlyArray.js","../node_modules/fp-ts/lib/Array.js","../node_modules/fp-ts/lib/string.js","../node_modules/json5/dist/index.js","../src/Text.ts","../src/Random.ts","../src/collections/Arrays.ts","../src/collections/Map/MapFns.ts","../src/modulation/Easing.ts","../src/data/Wrap.ts","../src/data/Interpolate.ts","../src/flow/index.ts","../src/flow/Elapsed.ts","../src/Numbers.ts","../src/data/TrackedValue.ts","../src/data/TrackerBase.ts","../src/data/PrimitiveTracker.ts","../src/data/NumberTracker.ts","../src/modulation/index.ts","../src/modulation/Envelope.ts","../src/flow/Timer.ts","../src/data/Clamp.ts","../src/geometry/Path.ts","../src/geometry/index.ts","../src/geometry/Arc.ts","../src/geometry/Point.ts","../src/geometry/Line.ts","../src/collections/index.ts","../src/collections/CircularArray.ts","../src/collections/Trees.ts","../src/collections/queue/QueueFns.ts","../src/collections/queue/QueueMutable.ts","../src/collections/stack/StackFns.ts","../src/collections/stack/StackMutable.ts","../src/IterableSync.ts","../src/geometry/QuadTree.ts","../src/geometry/Shape.ts","../src/geometry/Polar.ts","../src/collections/TreeNodeMutable.ts","../src/collections/Iterables.ts","../src/collections/stack/index.ts","../src/collections/stack/StackImmutable.ts","../src/collections/queue/index.ts","../src/collections/queue/QueueImmutable.ts","../src/collections/queue/PriorityMutable.ts","../src/collections/Map/index.ts","../src/collections/Map/ExpiringMap.ts","../src/collections/Map/MapImmutableFns.ts","../src/collections/Map/Map.ts","../src/collections/Map/MapMutable.ts","../src/collections/Map/MapOfMultiImpl.ts","../src/collections/Map/MapOfSetMutable.ts","../src/collections/Map/MapOfCircularMutable.ts","../src/collections/Map/NumberMap.ts","../src/collections/Map/MapOfArrayMutable.ts","../src/data/index.ts","../src/data/Normalise.ts","../src/data/Scale.ts","../src/KeyValue.ts","../src/io/index.ts","../src/flow/StateMachine.ts","../src/flow/Execute.ts","../src/flow/StateMachineDriver.ts","../src/flow/StateMachineWithEvents.ts","../src/io/NordicBleDevice.ts","../src/io/Codec.ts","../src/io/StringReceiveBuffer.ts","../src/io/StringWriteBuffer.ts","../src/flow/Retry.ts","../src/io/BleDevice.ts","../src/io/AudioAnalyser.ts","../src/io/AudioVisualiser.ts","../src/io/Espruino.ts","../src/io/EspruinoBleDevice.ts","../src/flow/WaitFor.ts","../src/io/Serial.ts","../src/io/JsonDevice.ts","../src/io/EspruinoSerialDevice.ts","../src/io/Camera.ts","../src/geometry/Rect.ts","../src/geometry/Circle.ts","../src/geometry/Intersects.ts","../src/io/VideoFile.ts","../src/visual/Video.ts","../src/io/FrameProcessor.ts","../src/Generators.ts","../src/modulation/PingPong.ts","../src/flow/Interval.ts","../src/flow/Delay.ts","../src/visual/index.ts","../src/visual/Drawing.ts","../src/geometry/Triangle.ts","../src/geometry/TriangleEquilateral.ts","../src/geometry/TriangleRight.ts","../src/geometry/TriangleIsosceles.ts","../src/geometry/Bezier.ts","../node_modules/bezier-js/src/utils.js","../node_modules/bezier-js/src/poly-bezier.js","../node_modules/bezier-js/src/bezier.js","../src/geometry/Ellipse.ts","../src/visual/Colour.ts","../node_modules/d3-color/src/define.js","../node_modules/d3-color/src/color.js","../node_modules/d3-color/src/math.js","../node_modules/d3-color/src/lab.js","../node_modules/d3-color/src/cubehelix.js","../node_modules/d3-interpolate/src/basis.js","../node_modules/d3-interpolate/src/basisClosed.js","../node_modules/d3-interpolate/src/constant.js","../node_modules/d3-interpolate/src/color.js","../node_modules/d3-interpolate/src/rgb.js","../node_modules/d3-interpolate/src/numberArray.js","../node_modules/d3-interpolate/src/array.js","../node_modules/d3-interpolate/src/date.js","../node_modules/d3-interpolate/src/number.js","../node_modules/d3-interpolate/src/object.js","../node_modules/d3-interpolate/src/string.js","../node_modules/d3-interpolate/src/value.js","../node_modules/d3-interpolate/src/hsl.js","../node_modules/d3-interpolate/src/lab.js","../node_modules/d3-interpolate/src/hcl.js","../node_modules/d3-interpolate/src/cubehelix.js","../node_modules/d3-interpolate/src/piecewise.js","../node_modules/rxjs/node_modules/tslib/tslib.es6.js","../node_modules/rxjs/src/internal/util/isFunction.ts","../node_modules/rxjs/src/internal/util/createErrorClass.ts","../node_modules/rxjs/src/internal/util/UnsubscriptionError.ts","../node_modules/rxjs/src/internal/util/arrRemove.ts","../node_modules/rxjs/src/internal/Subscription.ts","../node_modules/rxjs/src/internal/config.ts","../node_modules/rxjs/src/internal/scheduler/timeoutProvider.ts","../node_modules/rxjs/src/internal/util/reportUnhandledError.ts","../node_modules/rxjs/src/internal/util/noop.ts","../node_modules/rxjs/src/internal/NotificationFactories.ts","../node_modules/rxjs/src/internal/util/errorContext.ts","../node_modules/rxjs/src/internal/Subscriber.ts","../node_modules/rxjs/src/internal/symbol/observable.ts","../node_modules/rxjs/src/internal/util/identity.ts","../node_modules/rxjs/src/internal/util/pipe.ts","../node_modules/rxjs/src/internal/Observable.ts","../node_modules/rxjs/src/internal/util/lift.ts","../node_modules/rxjs/src/internal/operators/OperatorSubscriber.ts","../node_modules/rxjs/src/internal/scheduler/dateTimestampProvider.ts","../node_modules/rxjs/src/internal/scheduler/Action.ts","../node_modules/rxjs/src/internal/scheduler/intervalProvider.ts","../node_modules/rxjs/src/internal/scheduler/AsyncAction.ts","../node_modules/rxjs/src/internal/Scheduler.ts","../node_modules/rxjs/src/internal/scheduler/AsyncScheduler.ts","../node_modules/rxjs/src/internal/scheduler/async.ts","../node_modules/rxjs/src/internal/util/isArrayLike.ts","../node_modules/rxjs/src/internal/util/isPromise.ts","../node_modules/rxjs/src/internal/util/isInteropObservable.ts","../node_modules/rxjs/src/internal/util/isAsyncIterable.ts","../node_modules/rxjs/src/internal/util/throwUnobservableError.ts","../node_modules/rxjs/src/internal/symbol/iterator.ts","../node_modules/rxjs/src/internal/util/isIterable.ts","../node_modules/rxjs/src/internal/util/isReadableStreamLike.ts","../node_modules/rxjs/src/internal/observable/innerFrom.ts","../node_modules/rxjs/src/internal/util/executeSchedule.ts","../node_modules/rxjs/src/internal/operators/map.ts","../node_modules/rxjs/src/internal/util/mapOneOrManyArgs.ts","../node_modules/rxjs/src/internal/operators/mergeInternals.ts","../node_modules/rxjs/src/internal/operators/mergeMap.ts","../node_modules/rxjs/src/internal/observable/fromEvent.ts","../node_modules/rxjs/src/internal/operators/debounceTime.ts","../src/dom/Util.ts","../src/visual/Svg.ts","../src/visual/SvgMarkers.ts","../src/visual/SvgElements.ts","../src/visual/Plot2.ts","../src/visual/SceneGraph.ts","../src/Immutable.ts","../src/visual/Palette.ts","../src/visual/ImageDataGrid.ts","../src/geometry/Grid.ts","../src/visual/BipolarView.ts","../src/data/Bipolar.ts","../src/visual/PlotOld.ts","../src/dom/index.ts","../src/dom/ShadowDom.ts","../src/dom/Log.ts","../src/dom/DomRx.ts","../src/dom/DataTable.ts","../src/dom/DataDisplay.ts","../src/dom/Forms.ts","../src/data/ObjectTracker.ts","../src/data/PointTracker.ts","../src/dom/PointerVisualise.ts","../src/dom/ErrorHandler.ts","../src/dom/DragDrop.ts","../src/dom/InlineConsole.ts","../src/data/FrequencyMutable.ts","../src/data/MovingAverage.ts","../src/data/IntervalTracker.ts","../src/data/Flip.ts","../src/data/Reactive.ts","../src/flow/DispatchList.ts","../src/data/graphs/DirectedGraph.ts","../src/data/Table.ts","../src/data/Chain.ts","../src/Iterable.ts","../src/data/graphs/index.ts","../src/data/graphs/UndirectedGraph.ts","../src/data/Correlate.ts","../src/data/Pool.ts","../src/geometry/CompoundPath.ts","../src/geometry/Vector.ts","../src/geometry/Waypoint.ts","../src/geometry/Sphere.ts","../src/geometry/Layout.ts","../src/geometry/CirclePacking.ts","../src/geometry/Scaler.ts","../src/geometry/Convolve2d.ts","../src/geometry/SurfacePoints.ts","../src/modulation/Forces.ts","../src/modulation/Oscillator.ts","../src/modulation/PerSecond.ts","../src/modulation/Jitter.ts","../src/flow/Timeout.ts","../src/flow/UpdateOutdated.ts","../src/flow/Continuously.ts","../src/flow/Debounce.ts","../src/flow/Throttle.ts","../src/flow/Every.ts","../src/flow/RunOnce.ts","../src/flow/TaskQueue.ts","../src/collections/MinMaxAvg.ts","../src/collections/NumericArrays.ts"],"sourcesContent":["\"use strict\";\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.dual = exports.getEndomorphismMonoid = exports.not = exports.SK = exports.hole = exports.pipe = exports.untupled = exports.tupled = exports.absurd = exports.decrement = exports.increment = exports.tuple = exports.flow = exports.flip = exports.constVoid = exports.constUndefined = exports.constNull = exports.constFalse = exports.constTrue = exports.constant = exports.unsafeCoerce = exports.identity = exports.apply = exports.getRing = exports.getSemiring = exports.getMonoid = exports.getSemigroup = exports.getBooleanAlgebra = void 0;\n// -------------------------------------------------------------------------------------\n// instances\n// -------------------------------------------------------------------------------------\n/**\n * @category instances\n * @since 2.10.0\n */\nvar getBooleanAlgebra = function (B) {\n    return function () { return ({\n        meet: function (x, y) { return function (a) { return B.meet(x(a), y(a)); }; },\n        join: function (x, y) { return function (a) { return B.join(x(a), y(a)); }; },\n        zero: function () { return B.zero; },\n        one: function () { return B.one; },\n        implies: function (x, y) { return function (a) { return B.implies(x(a), y(a)); }; },\n        not: function (x) { return function (a) { return B.not(x(a)); }; }\n    }); };\n};\nexports.getBooleanAlgebra = getBooleanAlgebra;\n/**\n * Unary functions form a semigroup as long as you can provide a semigroup for the codomain.\n *\n * @example\n * import { Predicate, getSemigroup } from 'fp-ts/function'\n * import * as B from 'fp-ts/boolean'\n *\n * const f: Predicate<number> = (n) => n <= 2\n * const g: Predicate<number> = (n) => n >= 0\n *\n * const S1 = getSemigroup(B.SemigroupAll)<number>()\n *\n * assert.deepStrictEqual(S1.concat(f, g)(1), true)\n * assert.deepStrictEqual(S1.concat(f, g)(3), false)\n *\n * const S2 = getSemigroup(B.SemigroupAny)<number>()\n *\n * assert.deepStrictEqual(S2.concat(f, g)(1), true)\n * assert.deepStrictEqual(S2.concat(f, g)(3), true)\n *\n * @category instances\n * @since 2.10.0\n */\nvar getSemigroup = function (S) {\n    return function () { return ({\n        concat: function (f, g) { return function (a) { return S.concat(f(a), g(a)); }; }\n    }); };\n};\nexports.getSemigroup = getSemigroup;\n/**\n * Unary functions form a monoid as long as you can provide a monoid for the codomain.\n *\n * @example\n * import { Predicate } from 'fp-ts/Predicate'\n * import { getMonoid } from 'fp-ts/function'\n * import * as B from 'fp-ts/boolean'\n *\n * const f: Predicate<number> = (n) => n <= 2\n * const g: Predicate<number> = (n) => n >= 0\n *\n * const M1 = getMonoid(B.MonoidAll)<number>()\n *\n * assert.deepStrictEqual(M1.concat(f, g)(1), true)\n * assert.deepStrictEqual(M1.concat(f, g)(3), false)\n *\n * const M2 = getMonoid(B.MonoidAny)<number>()\n *\n * assert.deepStrictEqual(M2.concat(f, g)(1), true)\n * assert.deepStrictEqual(M2.concat(f, g)(3), true)\n *\n * @category instances\n * @since 2.10.0\n */\nvar getMonoid = function (M) {\n    var getSemigroupM = (0, exports.getSemigroup)(M);\n    return function () { return ({\n        concat: getSemigroupM().concat,\n        empty: function () { return M.empty; }\n    }); };\n};\nexports.getMonoid = getMonoid;\n/**\n * @category instances\n * @since 2.10.0\n */\nvar getSemiring = function (S) { return ({\n    add: function (f, g) { return function (x) { return S.add(f(x), g(x)); }; },\n    zero: function () { return S.zero; },\n    mul: function (f, g) { return function (x) { return S.mul(f(x), g(x)); }; },\n    one: function () { return S.one; }\n}); };\nexports.getSemiring = getSemiring;\n/**\n * @category instances\n * @since 2.10.0\n */\nvar getRing = function (R) {\n    var S = (0, exports.getSemiring)(R);\n    return {\n        add: S.add,\n        mul: S.mul,\n        one: S.one,\n        zero: S.zero,\n        sub: function (f, g) { return function (x) { return R.sub(f(x), g(x)); }; }\n    };\n};\nexports.getRing = getRing;\n// -------------------------------------------------------------------------------------\n// utils\n// -------------------------------------------------------------------------------------\n/**\n * @since 2.11.0\n */\nvar apply = function (a) {\n    return function (f) {\n        return f(a);\n    };\n};\nexports.apply = apply;\n/**\n * @since 2.0.0\n */\nfunction identity(a) {\n    return a;\n}\nexports.identity = identity;\n/**\n * @since 2.0.0\n */\nexports.unsafeCoerce = identity;\n/**\n * @since 2.0.0\n */\nfunction constant(a) {\n    return function () { return a; };\n}\nexports.constant = constant;\n/**\n * A thunk that returns always `true`.\n *\n * @since 2.0.0\n */\nexports.constTrue = constant(true);\n/**\n * A thunk that returns always `false`.\n *\n * @since 2.0.0\n */\nexports.constFalse = constant(false);\n/**\n * A thunk that returns always `null`.\n *\n * @since 2.0.0\n */\nexports.constNull = constant(null);\n/**\n * A thunk that returns always `undefined`.\n *\n * @since 2.0.0\n */\nexports.constUndefined = constant(undefined);\n/**\n * A thunk that returns always `void`.\n *\n * @since 2.0.0\n */\nexports.constVoid = exports.constUndefined;\nfunction flip(f) {\n    return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (args.length > 1) {\n            return f(args[1], args[0]);\n        }\n        return function (a) { return f(a)(args[0]); };\n    };\n}\nexports.flip = flip;\nfunction flow(ab, bc, cd, de, ef, fg, gh, hi, ij) {\n    switch (arguments.length) {\n        case 1:\n            return ab;\n        case 2:\n            return function () {\n                return bc(ab.apply(this, arguments));\n            };\n        case 3:\n            return function () {\n                return cd(bc(ab.apply(this, arguments)));\n            };\n        case 4:\n            return function () {\n                return de(cd(bc(ab.apply(this, arguments))));\n            };\n        case 5:\n            return function () {\n                return ef(de(cd(bc(ab.apply(this, arguments)))));\n            };\n        case 6:\n            return function () {\n                return fg(ef(de(cd(bc(ab.apply(this, arguments))))));\n            };\n        case 7:\n            return function () {\n                return gh(fg(ef(de(cd(bc(ab.apply(this, arguments)))))));\n            };\n        case 8:\n            return function () {\n                return hi(gh(fg(ef(de(cd(bc(ab.apply(this, arguments))))))));\n            };\n        case 9:\n            return function () {\n                return ij(hi(gh(fg(ef(de(cd(bc(ab.apply(this, arguments)))))))));\n            };\n    }\n    return;\n}\nexports.flow = flow;\n/**\n * @since 2.0.0\n */\nfunction tuple() {\n    var t = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        t[_i] = arguments[_i];\n    }\n    return t;\n}\nexports.tuple = tuple;\n/**\n * @since 2.0.0\n */\nfunction increment(n) {\n    return n + 1;\n}\nexports.increment = increment;\n/**\n * @since 2.0.0\n */\nfunction decrement(n) {\n    return n - 1;\n}\nexports.decrement = decrement;\n/**\n * @since 2.0.0\n */\nfunction absurd(_) {\n    throw new Error('Called `absurd` function which should be uncallable');\n}\nexports.absurd = absurd;\n/**\n * Creates a tupled version of this function: instead of `n` arguments, it accepts a single tuple argument.\n *\n * @example\n * import { tupled } from 'fp-ts/function'\n *\n * const add = tupled((x: number, y: number): number => x + y)\n *\n * assert.strictEqual(add([1, 2]), 3)\n *\n * @since 2.4.0\n */\nfunction tupled(f) {\n    return function (a) { return f.apply(void 0, a); };\n}\nexports.tupled = tupled;\n/**\n * Inverse function of `tupled`\n *\n * @since 2.4.0\n */\nfunction untupled(f) {\n    return function () {\n        var a = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            a[_i] = arguments[_i];\n        }\n        return f(a);\n    };\n}\nexports.untupled = untupled;\nfunction pipe(a, ab, bc, cd, de, ef, fg, gh, hi) {\n    switch (arguments.length) {\n        case 1:\n            return a;\n        case 2:\n            return ab(a);\n        case 3:\n            return bc(ab(a));\n        case 4:\n            return cd(bc(ab(a)));\n        case 5:\n            return de(cd(bc(ab(a))));\n        case 6:\n            return ef(de(cd(bc(ab(a)))));\n        case 7:\n            return fg(ef(de(cd(bc(ab(a))))));\n        case 8:\n            return gh(fg(ef(de(cd(bc(ab(a)))))));\n        case 9:\n            return hi(gh(fg(ef(de(cd(bc(ab(a))))))));\n        default: {\n            var ret = arguments[0];\n            for (var i = 1; i < arguments.length; i++) {\n                ret = arguments[i](ret);\n            }\n            return ret;\n        }\n    }\n}\nexports.pipe = pipe;\n/**\n * Type hole simulation\n *\n * @since 2.7.0\n */\nexports.hole = absurd;\n/**\n * @since 2.11.0\n */\nvar SK = function (_, b) { return b; };\nexports.SK = SK;\n/**\n * Use `Predicate` module instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nfunction not(predicate) {\n    return function (a) { return !predicate(a); };\n}\nexports.not = not;\n/**\n * Use `Endomorphism` module instead.\n *\n * @category zone of death\n * @since 2.10.0\n * @deprecated\n */\nvar getEndomorphismMonoid = function () { return ({\n    concat: function (first, second) { return flow(first, second); },\n    empty: identity\n}); };\nexports.getEndomorphismMonoid = getEndomorphismMonoid;\n/** @internal */\nvar dual = function (arity, body) {\n    var isDataFirst = typeof arity === 'number' ? function (args) { return args.length >= arity; } : arity;\n    return function () {\n        var args = Array.from(arguments);\n        if (isDataFirst(arguments)) {\n            return body.apply(this, args);\n        }\n        return function (self) { return body.apply(void 0, __spreadArray([self], args, false)); };\n    };\n};\nexports.dual = dual;\n","\"use strict\";\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.flatMapReader = exports.flatMapTask = exports.flatMapIO = exports.flatMapEither = exports.flatMapOption = exports.flatMapNullable = exports.liftOption = exports.liftNullable = exports.fromReadonlyNonEmptyArray = exports.has = exports.emptyRecord = exports.emptyReadonlyArray = exports.tail = exports.head = exports.isNonEmpty = exports.singleton = exports.right = exports.left = exports.isRight = exports.isLeft = exports.some = exports.none = exports.isSome = exports.isNone = void 0;\nvar function_1 = require(\"./function\");\n// -------------------------------------------------------------------------------------\n// Option\n// -------------------------------------------------------------------------------------\n/** @internal */\nvar isNone = function (fa) { return fa._tag === 'None'; };\nexports.isNone = isNone;\n/** @internal */\nvar isSome = function (fa) { return fa._tag === 'Some'; };\nexports.isSome = isSome;\n/** @internal */\nexports.none = { _tag: 'None' };\n/** @internal */\nvar some = function (a) { return ({ _tag: 'Some', value: a }); };\nexports.some = some;\n// -------------------------------------------------------------------------------------\n// Either\n// -------------------------------------------------------------------------------------\n/** @internal */\nvar isLeft = function (ma) { return ma._tag === 'Left'; };\nexports.isLeft = isLeft;\n/** @internal */\nvar isRight = function (ma) { return ma._tag === 'Right'; };\nexports.isRight = isRight;\n/** @internal */\nvar left = function (e) { return ({ _tag: 'Left', left: e }); };\nexports.left = left;\n/** @internal */\nvar right = function (a) { return ({ _tag: 'Right', right: a }); };\nexports.right = right;\n// -------------------------------------------------------------------------------------\n// ReadonlyNonEmptyArray\n// -------------------------------------------------------------------------------------\n/** @internal */\nvar singleton = function (a) { return [a]; };\nexports.singleton = singleton;\n/** @internal */\nvar isNonEmpty = function (as) { return as.length > 0; };\nexports.isNonEmpty = isNonEmpty;\n/** @internal */\nvar head = function (as) { return as[0]; };\nexports.head = head;\n/** @internal */\nvar tail = function (as) { return as.slice(1); };\nexports.tail = tail;\n// -------------------------------------------------------------------------------------\n// empty\n// -------------------------------------------------------------------------------------\n/** @internal */\nexports.emptyReadonlyArray = [];\n/** @internal */\nexports.emptyRecord = {};\n// -------------------------------------------------------------------------------------\n// Record\n// -------------------------------------------------------------------------------------\n/** @internal */\nexports.has = Object.prototype.hasOwnProperty;\n// -------------------------------------------------------------------------------------\n// NonEmptyArray\n// -------------------------------------------------------------------------------------\n/** @internal */\nvar fromReadonlyNonEmptyArray = function (as) { return __spreadArray([as[0]], as.slice(1), true); };\nexports.fromReadonlyNonEmptyArray = fromReadonlyNonEmptyArray;\n/** @internal */\nvar liftNullable = function (F) {\n    return function (f, onNullable) {\n        return function () {\n            var a = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                a[_i] = arguments[_i];\n            }\n            var o = f.apply(void 0, a);\n            return F.fromEither(o == null ? (0, exports.left)(onNullable.apply(void 0, a)) : (0, exports.right)(o));\n        };\n    };\n};\nexports.liftNullable = liftNullable;\n/** @internal */\nvar liftOption = function (F) {\n    return function (f, onNone) {\n        return function () {\n            var a = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                a[_i] = arguments[_i];\n            }\n            var o = f.apply(void 0, a);\n            return F.fromEither((0, exports.isNone)(o) ? (0, exports.left)(onNone.apply(void 0, a)) : (0, exports.right)(o.value));\n        };\n    };\n};\nexports.liftOption = liftOption;\n/** @internal */\nvar flatMapNullable = function (F, M) {\n    /*#__PURE__*/ return (0, function_1.dual)(3, function (self, f, onNullable) {\n        return M.flatMap(self, (0, exports.liftNullable)(F)(f, onNullable));\n    });\n};\nexports.flatMapNullable = flatMapNullable;\n/** @internal */\nvar flatMapOption = function (F, M) {\n    /*#__PURE__*/ return (0, function_1.dual)(3, function (self, f, onNone) { return M.flatMap(self, (0, exports.liftOption)(F)(f, onNone)); });\n};\nexports.flatMapOption = flatMapOption;\n/** @internal */\nvar flatMapEither = function (F, M) {\n    /*#__PURE__*/ return (0, function_1.dual)(2, function (self, f) {\n        return M.flatMap(self, function (a) { return F.fromEither(f(a)); });\n    });\n};\nexports.flatMapEither = flatMapEither;\n/** @internal */\nvar flatMapIO = function (F, M) {\n    /*#__PURE__*/ return (0, function_1.dual)(2, function (self, f) {\n        return M.flatMap(self, function (a) { return F.fromIO(f(a)); });\n    });\n};\nexports.flatMapIO = flatMapIO;\n/** @internal */\nvar flatMapTask = function (F, M) {\n    /*#__PURE__*/ return (0, function_1.dual)(2, function (self, f) {\n        return M.flatMap(self, function (a) { return F.fromTask(f(a)); });\n    });\n};\nexports.flatMapTask = flatMapTask;\n/** @internal */\nvar flatMapReader = function (F, M) {\n    /*#__PURE__*/ return (0, function_1.dual)(2, function (self, f) {\n        return M.flatMap(self, function (a) { return F.fromReader(f(a)); });\n    });\n};\nexports.flatMapReader = flatMapReader;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.sequenceS = exports.sequenceT = exports.getApplySemigroup = exports.apS = exports.apSecond = exports.apFirst = exports.ap = void 0;\n/**\n * The `Apply` class provides the `ap` which is used to apply a function to an argument under a type constructor.\n *\n * `Apply` can be used to lift functions of two or more arguments to work on values wrapped with the type constructor\n * `f`.\n *\n * Instances must satisfy the following law in addition to the `Functor` laws:\n *\n * 1. Associative composition: `F.ap(F.ap(F.map(fbc, bc => ab => a => bc(ab(a))), fab), fa) <-> F.ap(fbc, F.ap(fab, fa))`\n *\n * Formally, `Apply` represents a strong lax semi-monoidal endofunctor.\n *\n * @example\n * import * as O from 'fp-ts/Option'\n * import { pipe } from 'fp-ts/function'\n *\n * const f = (a: string) => (b: number) => (c: boolean) => a + String(b) + String(c)\n * const fa: O.Option<string> = O.some('s')\n * const fb: O.Option<number> = O.some(1)\n * const fc: O.Option<boolean> = O.some(true)\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     // lift a function\n *     O.some(f),\n *     // apply the first argument\n *     O.ap(fa),\n *     // apply the second argument\n *     O.ap(fb),\n *     // apply the third argument\n *     O.ap(fc)\n *   ),\n *   O.some('s1true')\n * )\n *\n * @since 2.0.0\n */\nvar function_1 = require(\"./function\");\nvar _ = __importStar(require(\"./internal\"));\nfunction ap(F, G) {\n    return function (fa) {\n        return function (fab) {\n            return F.ap(F.map(fab, function (gab) { return function (ga) { return G.ap(gab, ga); }; }), fa);\n        };\n    };\n}\nexports.ap = ap;\nfunction apFirst(A) {\n    return function (second) { return function (first) {\n        return A.ap(A.map(first, function (a) { return function () { return a; }; }), second);\n    }; };\n}\nexports.apFirst = apFirst;\nfunction apSecond(A) {\n    return function (second) {\n        return function (first) {\n            return A.ap(A.map(first, function () { return function (b) { return b; }; }), second);\n        };\n    };\n}\nexports.apSecond = apSecond;\nfunction apS(F) {\n    return function (name, fb) {\n        return function (fa) {\n            return F.ap(F.map(fa, function (a) { return function (b) {\n                var _a;\n                return Object.assign({}, a, (_a = {}, _a[name] = b, _a));\n            }; }), fb);\n        };\n    };\n}\nexports.apS = apS;\nfunction getApplySemigroup(F) {\n    return function (S) { return ({\n        concat: function (first, second) {\n            return F.ap(F.map(first, function (x) { return function (y) { return S.concat(x, y); }; }), second);\n        }\n    }); };\n}\nexports.getApplySemigroup = getApplySemigroup;\nfunction curried(f, n, acc) {\n    return function (x) {\n        var combined = Array(acc.length + 1);\n        for (var i = 0; i < acc.length; i++) {\n            combined[i] = acc[i];\n        }\n        combined[acc.length] = x;\n        return n === 0 ? f.apply(null, combined) : curried(f, n - 1, combined);\n    };\n}\nvar tupleConstructors = {\n    1: function (a) { return [a]; },\n    2: function (a) { return function (b) { return [a, b]; }; },\n    3: function (a) { return function (b) { return function (c) { return [a, b, c]; }; }; },\n    4: function (a) { return function (b) { return function (c) { return function (d) { return [a, b, c, d]; }; }; }; },\n    5: function (a) { return function (b) { return function (c) { return function (d) { return function (e) { return [a, b, c, d, e]; }; }; }; }; }\n};\nfunction getTupleConstructor(len) {\n    if (!_.has.call(tupleConstructors, len)) {\n        tupleConstructors[len] = curried(function_1.tuple, len - 1, []);\n    }\n    return tupleConstructors[len];\n}\nfunction sequenceT(F) {\n    return function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        var len = args.length;\n        var f = getTupleConstructor(len);\n        var fas = F.map(args[0], f);\n        for (var i = 1; i < len; i++) {\n            fas = F.ap(fas, args[i]);\n        }\n        return fas;\n    };\n}\nexports.sequenceT = sequenceT;\nfunction getRecordConstructor(keys) {\n    var len = keys.length;\n    switch (len) {\n        case 1:\n            return function (a) {\n                var _a;\n                return (_a = {}, _a[keys[0]] = a, _a);\n            };\n        case 2:\n            return function (a) { return function (b) {\n                var _a;\n                return (_a = {}, _a[keys[0]] = a, _a[keys[1]] = b, _a);\n            }; };\n        case 3:\n            return function (a) { return function (b) { return function (c) {\n                var _a;\n                return (_a = {}, _a[keys[0]] = a, _a[keys[1]] = b, _a[keys[2]] = c, _a);\n            }; }; };\n        case 4:\n            return function (a) { return function (b) { return function (c) { return function (d) {\n                var _a;\n                return (_a = {},\n                    _a[keys[0]] = a,\n                    _a[keys[1]] = b,\n                    _a[keys[2]] = c,\n                    _a[keys[3]] = d,\n                    _a);\n            }; }; }; };\n        case 5:\n            return function (a) { return function (b) { return function (c) { return function (d) { return function (e) {\n                var _a;\n                return (_a = {},\n                    _a[keys[0]] = a,\n                    _a[keys[1]] = b,\n                    _a[keys[2]] = c,\n                    _a[keys[3]] = d,\n                    _a[keys[4]] = e,\n                    _a);\n            }; }; }; }; };\n        default:\n            return curried(function () {\n                var args = [];\n                for (var _i = 0; _i < arguments.length; _i++) {\n                    args[_i] = arguments[_i];\n                }\n                var r = {};\n                for (var i = 0; i < len; i++) {\n                    r[keys[i]] = args[i];\n                }\n                return r;\n            }, len - 1, []);\n    }\n}\nfunction sequenceS(F) {\n    return function (r) {\n        var keys = Object.keys(r);\n        var len = keys.length;\n        var f = getRecordConstructor(keys);\n        var fr = F.map(r[keys[0]], f);\n        for (var i = 1; i < len; i++) {\n            fr = F.ap(fr, r[keys[i]]);\n        }\n        return fr;\n    };\n}\nexports.sequenceS = sequenceS;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.bind = exports.tap = exports.chainFirst = void 0;\nfunction chainFirst(M) {\n    var tapM = tap(M);\n    return function (f) { return function (first) { return tapM(first, f); }; };\n}\nexports.chainFirst = chainFirst;\n/** @internal */\nfunction tap(M) {\n    return function (first, f) { return M.chain(first, function (a) { return M.map(f(a), function () { return a; }); }); };\n}\nexports.tap = tap;\nfunction bind(M) {\n    return function (name, f) { return function (ma) { return M.chain(ma, function (a) { return M.map(f(a), function (b) {\n        var _a;\n        return Object.assign({}, a, (_a = {}, _a[name] = b, _a));\n    }); }); }; };\n}\nexports.bind = bind;\n","\"use strict\";\n/**\n * The `FromEither` type class represents those data types which support errors.\n *\n * @since 2.10.0\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.tapEither = exports.filterOrElse = exports.chainFirstEitherK = exports.chainEitherK = exports.fromEitherK = exports.chainOptionK = exports.fromOptionK = exports.fromPredicate = exports.fromOption = void 0;\nvar Chain_1 = require(\"./Chain\");\nvar function_1 = require(\"./function\");\nvar _ = __importStar(require(\"./internal\"));\nfunction fromOption(F) {\n    return function (onNone) { return function (ma) { return F.fromEither(_.isNone(ma) ? _.left(onNone()) : _.right(ma.value)); }; };\n}\nexports.fromOption = fromOption;\nfunction fromPredicate(F) {\n    return function (predicate, onFalse) {\n        return function (a) {\n            return F.fromEither(predicate(a) ? _.right(a) : _.left(onFalse(a)));\n        };\n    };\n}\nexports.fromPredicate = fromPredicate;\nfunction fromOptionK(F) {\n    var fromOptionF = fromOption(F);\n    return function (onNone) {\n        var from = fromOptionF(onNone);\n        return function (f) { return (0, function_1.flow)(f, from); };\n    };\n}\nexports.fromOptionK = fromOptionK;\nfunction chainOptionK(F, M) {\n    var fromOptionKF = fromOptionK(F);\n    return function (onNone) {\n        var from = fromOptionKF(onNone);\n        return function (f) { return function (ma) { return M.chain(ma, from(f)); }; };\n    };\n}\nexports.chainOptionK = chainOptionK;\nfunction fromEitherK(F) {\n    return function (f) { return (0, function_1.flow)(f, F.fromEither); };\n}\nexports.fromEitherK = fromEitherK;\nfunction chainEitherK(F, M) {\n    var fromEitherKF = fromEitherK(F);\n    return function (f) { return function (ma) { return M.chain(ma, fromEitherKF(f)); }; };\n}\nexports.chainEitherK = chainEitherK;\nfunction chainFirstEitherK(F, M) {\n    var tapEitherM = tapEither(F, M);\n    return function (f) { return function (ma) { return tapEitherM(ma, f); }; };\n}\nexports.chainFirstEitherK = chainFirstEitherK;\nfunction filterOrElse(F, M) {\n    return function (predicate, onFalse) {\n        return function (ma) {\n            return M.chain(ma, function (a) { return F.fromEither(predicate(a) ? _.right(a) : _.left(onFalse(a))); });\n        };\n    };\n}\nexports.filterOrElse = filterOrElse;\n/** @internal */\nfunction tapEither(F, M) {\n    var fromEither = fromEitherK(F);\n    var tapM = (0, Chain_1.tap)(M);\n    return function (self, f) { return tapM(self, fromEither(f)); };\n}\nexports.tapEither = tapEither;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.asUnit = exports.as = exports.getFunctorComposition = exports.let = exports.bindTo = exports.flap = exports.map = void 0;\n/**\n * A `Functor` is a type constructor which supports a mapping operation `map`.\n *\n * `map` can be used to turn functions `a -> b` into functions `f a -> f b` whose argument and return types use the type\n * constructor `f` to represent some computational context.\n *\n * Instances must satisfy the following laws:\n *\n * 1. Identity: `F.map(fa, a => a) <-> fa`\n * 2. Composition: `F.map(fa, a => bc(ab(a))) <-> F.map(F.map(fa, ab), bc)`\n *\n * @since 2.0.0\n */\nvar function_1 = require(\"./function\");\nfunction map(F, G) {\n    return function (f) { return function (fa) { return F.map(fa, function (ga) { return G.map(ga, f); }); }; };\n}\nexports.map = map;\nfunction flap(F) {\n    return function (a) { return function (fab) { return F.map(fab, function (f) { return f(a); }); }; };\n}\nexports.flap = flap;\nfunction bindTo(F) {\n    return function (name) { return function (fa) { return F.map(fa, function (a) {\n        var _a;\n        return (_a = {}, _a[name] = a, _a);\n    }); }; };\n}\nexports.bindTo = bindTo;\nfunction let_(F) {\n    return function (name, f) { return function (fa) { return F.map(fa, function (a) {\n        var _a;\n        return Object.assign({}, a, (_a = {}, _a[name] = f(a), _a));\n    }); }; };\n}\nexports.let = let_;\n/** @deprecated */\nfunction getFunctorComposition(F, G) {\n    var _map = map(F, G);\n    return {\n        map: function (fga, f) { return (0, function_1.pipe)(fga, _map(f)); }\n    };\n}\nexports.getFunctorComposition = getFunctorComposition;\n/** @internal */\nfunction as(F) {\n    return function (self, b) { return F.map(self, function () { return b; }); };\n}\nexports.as = as;\n/** @internal */\nfunction asUnit(F) {\n    var asM = as(F);\n    return function (self) { return asM(self, undefined); };\n}\nexports.asUnit = asUnit;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.eqDate = exports.eqNumber = exports.eqString = exports.eqBoolean = exports.eq = exports.strictEqual = exports.getStructEq = exports.getTupleEq = exports.Contravariant = exports.getMonoid = exports.getSemigroup = exports.eqStrict = exports.URI = exports.contramap = exports.tuple = exports.struct = exports.fromEquals = void 0;\nvar function_1 = require(\"./function\");\n// -------------------------------------------------------------------------------------\n// constructors\n// -------------------------------------------------------------------------------------\n/**\n * @category constructors\n * @since 2.0.0\n */\nvar fromEquals = function (equals) { return ({\n    equals: function (x, y) { return x === y || equals(x, y); }\n}); };\nexports.fromEquals = fromEquals;\n// -------------------------------------------------------------------------------------\n// combinators\n// -------------------------------------------------------------------------------------\n/**\n * @since 2.10.0\n */\nvar struct = function (eqs) {\n    return (0, exports.fromEquals)(function (first, second) {\n        for (var key in eqs) {\n            if (!eqs[key].equals(first[key], second[key])) {\n                return false;\n            }\n        }\n        return true;\n    });\n};\nexports.struct = struct;\n/**\n * Given a tuple of `Eq`s returns a `Eq` for the tuple\n *\n * @example\n * import { tuple } from 'fp-ts/Eq'\n * import * as S from 'fp-ts/string'\n * import * as N from 'fp-ts/number'\n * import * as B from 'fp-ts/boolean'\n *\n * const E = tuple(S.Eq, N.Eq, B.Eq)\n * assert.strictEqual(E.equals(['a', 1, true], ['a', 1, true]), true)\n * assert.strictEqual(E.equals(['a', 1, true], ['b', 1, true]), false)\n * assert.strictEqual(E.equals(['a', 1, true], ['a', 2, true]), false)\n * assert.strictEqual(E.equals(['a', 1, true], ['a', 1, false]), false)\n *\n * @since 2.10.0\n */\nvar tuple = function () {\n    var eqs = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        eqs[_i] = arguments[_i];\n    }\n    return (0, exports.fromEquals)(function (first, second) { return eqs.every(function (E, i) { return E.equals(first[i], second[i]); }); });\n};\nexports.tuple = tuple;\n/* istanbul ignore next */\nvar contramap_ = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.contramap)(f)); };\n/**\n * A typical use case for `contramap` would be like, given some `User` type, to construct an `Eq<User>`.\n *\n * We can do so with a function from `User -> X` where `X` is some value that we know how to compare\n * for equality (meaning we have an `Eq<X>`)\n *\n * For example, given the following `User` type, we want to construct an `Eq<User>` that just looks at the `key` field\n * for each user (since it's known to be unique).\n *\n * If we have a way of comparing `UUID`s for equality (`eqUUID: Eq<UUID>`) and we know how to go from `User -> UUID`,\n * using `contramap` we can do this\n *\n * @example\n * import { contramap, Eq } from 'fp-ts/Eq'\n * import { pipe } from 'fp-ts/function'\n * import * as S from 'fp-ts/string'\n *\n * type UUID = string\n *\n * interface User {\n *   readonly key: UUID\n *   readonly firstName: string\n *   readonly lastName: string\n * }\n *\n * const eqUUID: Eq<UUID> = S.Eq\n *\n * const eqUserByKey: Eq<User> = pipe(\n *   eqUUID,\n *   contramap((user) => user.key)\n * )\n *\n * assert.deepStrictEqual(\n *   eqUserByKey.equals(\n *     { key: 'k1', firstName: 'a1', lastName: 'b1' },\n *     { key: 'k2', firstName: 'a1', lastName: 'b1' }\n *   ),\n *   false\n * )\n * assert.deepStrictEqual(\n *   eqUserByKey.equals(\n *     { key: 'k1', firstName: 'a1', lastName: 'b1' },\n *     { key: 'k1', firstName: 'a2', lastName: 'b1' }\n *   ),\n *   true\n * )\n *\n * @since 2.0.0\n */\nvar contramap = function (f) { return function (fa) {\n    return (0, exports.fromEquals)(function (x, y) { return fa.equals(f(x), f(y)); });\n}; };\nexports.contramap = contramap;\n/**\n * @category type lambdas\n * @since 2.0.0\n */\nexports.URI = 'Eq';\n/**\n * @category instances\n * @since 2.5.0\n */\nexports.eqStrict = {\n    equals: function (a, b) { return a === b; }\n};\nvar empty = {\n    equals: function () { return true; }\n};\n/**\n * @category instances\n * @since 2.10.0\n */\nvar getSemigroup = function () { return ({\n    concat: function (x, y) { return (0, exports.fromEquals)(function (a, b) { return x.equals(a, b) && y.equals(a, b); }); }\n}); };\nexports.getSemigroup = getSemigroup;\n/**\n * @category instances\n * @since 2.6.0\n */\nvar getMonoid = function () { return ({\n    concat: (0, exports.getSemigroup)().concat,\n    empty: empty\n}); };\nexports.getMonoid = getMonoid;\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Contravariant = {\n    URI: exports.URI,\n    contramap: contramap_\n};\n// -------------------------------------------------------------------------------------\n// deprecated\n// -------------------------------------------------------------------------------------\n/**\n * Use [`tuple`](#tuple) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.getTupleEq = exports.tuple;\n/**\n * Use [`struct`](#struct) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.getStructEq = exports.struct;\n/**\n * Use [`eqStrict`](#eqstrict) instead\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.strictEqual = exports.eqStrict.equals;\n/**\n * This instance is deprecated, use small, specific instances instead.\n * For example if a function needs a `Contravariant` instance, pass `E.Contravariant` instead of `E.eq`\n * (where `E` is from `import E from 'fp-ts/Eq'`)\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.eq = exports.Contravariant;\n/**\n * Use [`Eq`](./boolean.ts.html#eq) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.eqBoolean = exports.eqStrict;\n/**\n * Use [`Eq`](./string.ts.html#eq) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.eqString = exports.eqStrict;\n/**\n * Use [`Eq`](./number.ts.html#eq) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.eqNumber = exports.eqStrict;\n/**\n * Use [`Eq`](./Date.ts.html#eq) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.eqDate = {\n    equals: function (first, second) { return first.valueOf() === second.valueOf(); }\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ordDate = exports.ordNumber = exports.ordString = exports.ordBoolean = exports.ord = exports.getDualOrd = exports.getTupleOrd = exports.between = exports.clamp = exports.max = exports.min = exports.geq = exports.leq = exports.gt = exports.lt = exports.equals = exports.trivial = exports.Contravariant = exports.getMonoid = exports.getSemigroup = exports.URI = exports.contramap = exports.reverse = exports.tuple = exports.fromCompare = exports.equalsDefault = void 0;\nvar Eq_1 = require(\"./Eq\");\nvar function_1 = require(\"./function\");\n// -------------------------------------------------------------------------------------\n// defaults\n// -------------------------------------------------------------------------------------\n/**\n * @category defaults\n * @since 2.10.0\n */\nvar equalsDefault = function (compare) {\n    return function (first, second) {\n        return first === second || compare(first, second) === 0;\n    };\n};\nexports.equalsDefault = equalsDefault;\n// -------------------------------------------------------------------------------------\n// constructors\n// -------------------------------------------------------------------------------------\n/**\n * @category constructors\n * @since 2.0.0\n */\nvar fromCompare = function (compare) { return ({\n    equals: (0, exports.equalsDefault)(compare),\n    compare: function (first, second) { return (first === second ? 0 : compare(first, second)); }\n}); };\nexports.fromCompare = fromCompare;\n// -------------------------------------------------------------------------------------\n// combinators\n// -------------------------------------------------------------------------------------\n/**\n * Given a tuple of `Ord`s returns an `Ord` for the tuple.\n *\n * @example\n * import { tuple } from 'fp-ts/Ord'\n * import * as B from 'fp-ts/boolean'\n * import * as S from 'fp-ts/string'\n * import * as N from 'fp-ts/number'\n *\n * const O = tuple(S.Ord, N.Ord, B.Ord)\n * assert.strictEqual(O.compare(['a', 1, true], ['b', 2, true]), -1)\n * assert.strictEqual(O.compare(['a', 1, true], ['a', 2, true]), -1)\n * assert.strictEqual(O.compare(['a', 1, true], ['a', 1, false]), 1)\n *\n * @since 2.10.0\n */\nvar tuple = function () {\n    var ords = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        ords[_i] = arguments[_i];\n    }\n    return (0, exports.fromCompare)(function (first, second) {\n        var i = 0;\n        for (; i < ords.length - 1; i++) {\n            var r = ords[i].compare(first[i], second[i]);\n            if (r !== 0) {\n                return r;\n            }\n        }\n        return ords[i].compare(first[i], second[i]);\n    });\n};\nexports.tuple = tuple;\n/**\n * @since 2.10.0\n */\nvar reverse = function (O) { return (0, exports.fromCompare)(function (first, second) { return O.compare(second, first); }); };\nexports.reverse = reverse;\n/* istanbul ignore next */\nvar contramap_ = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.contramap)(f)); };\n/**\n * A typical use case for `contramap` would be like, given some `User` type, to construct an `Ord<User>`.\n *\n * We can do so with a function from `User -> X` where `X` is some value that we know how to compare\n * for ordering (meaning we have an `Ord<X>`)\n *\n * For example, given the following `User` type, there are lots of possible choices for `X`,\n * but let's say we want to sort a list of users by `lastName`.\n *\n * If we have a way of comparing `lastName`s for ordering (`ordLastName: Ord<string>`) and we know how to go from `User -> string`,\n * using `contramap` we can do this\n *\n * @example\n * import { pipe } from 'fp-ts/function'\n * import { contramap, Ord } from 'fp-ts/Ord'\n * import * as RA from 'fp-ts/ReadonlyArray'\n * import * as S from 'fp-ts/string'\n *\n * interface User {\n *   readonly firstName: string\n *   readonly lastName: string\n * }\n *\n * const ordLastName: Ord<string> = S.Ord\n *\n * const ordByLastName: Ord<User> = pipe(\n *   ordLastName,\n *   contramap((user) => user.lastName)\n * )\n *\n * assert.deepStrictEqual(\n *   RA.sort(ordByLastName)([\n *     { firstName: 'a', lastName: 'd' },\n *     { firstName: 'c', lastName: 'b' }\n *   ]),\n *   [\n *     { firstName: 'c', lastName: 'b' },\n *     { firstName: 'a', lastName: 'd' }\n *   ]\n * )\n *\n * @since 2.0.0\n */\nvar contramap = function (f) { return function (fa) {\n    return (0, exports.fromCompare)(function (first, second) { return fa.compare(f(first), f(second)); });\n}; };\nexports.contramap = contramap;\n/**\n * @category type lambdas\n * @since 2.0.0\n */\nexports.URI = 'Ord';\n/**\n * A typical use case for the `Semigroup` instance of `Ord` is merging two or more orderings.\n *\n * For example the following snippet builds an `Ord` for a type `User` which\n * sorts by `created` date descending, and **then** `lastName`\n *\n * @example\n * import * as D from 'fp-ts/Date'\n * import { pipe } from 'fp-ts/function'\n * import { contramap, getSemigroup, Ord, reverse } from 'fp-ts/Ord'\n * import * as RA from 'fp-ts/ReadonlyArray'\n * import * as S from 'fp-ts/string'\n *\n * interface User {\n *   readonly id: string\n *   readonly lastName: string\n *   readonly created: Date\n * }\n *\n * const ordByLastName: Ord<User> = pipe(\n *   S.Ord,\n *   contramap((user) => user.lastName)\n * )\n *\n * const ordByCreated: Ord<User> = pipe(\n *   D.Ord,\n *   contramap((user) => user.created)\n * )\n *\n * const ordUserByCreatedDescThenLastName = getSemigroup<User>().concat(\n *   reverse(ordByCreated),\n *   ordByLastName\n * )\n *\n * assert.deepStrictEqual(\n *   RA.sort(ordUserByCreatedDescThenLastName)([\n *     { id: 'c', lastName: 'd', created: new Date(1973, 10, 30) },\n *     { id: 'a', lastName: 'b', created: new Date(1973, 10, 30) },\n *     { id: 'e', lastName: 'f', created: new Date(1980, 10, 30) }\n *   ]),\n *   [\n *     { id: 'e', lastName: 'f', created: new Date(1980, 10, 30) },\n *     { id: 'a', lastName: 'b', created: new Date(1973, 10, 30) },\n *     { id: 'c', lastName: 'd', created: new Date(1973, 10, 30) }\n *   ]\n * )\n *\n * @category instances\n * @since 2.0.0\n */\nvar getSemigroup = function () { return ({\n    concat: function (first, second) {\n        return (0, exports.fromCompare)(function (a, b) {\n            var ox = first.compare(a, b);\n            return ox !== 0 ? ox : second.compare(a, b);\n        });\n    }\n}); };\nexports.getSemigroup = getSemigroup;\n/**\n * Returns a `Monoid` such that:\n *\n * - its `concat(ord1, ord2)` operation will order first by `ord1`, and then by `ord2`\n * - its `empty` value is an `Ord` that always considers compared elements equal\n *\n * @example\n * import { sort } from 'fp-ts/Array'\n * import { contramap, reverse, getMonoid } from 'fp-ts/Ord'\n * import * as S from 'fp-ts/string'\n * import * as B from 'fp-ts/boolean'\n * import { pipe } from 'fp-ts/function'\n * import { concatAll } from 'fp-ts/Monoid'\n * import * as N from 'fp-ts/number'\n *\n * interface User {\n *   readonly id: number\n *   readonly name: string\n *   readonly age: number\n *   readonly rememberMe: boolean\n * }\n *\n * const byName = pipe(\n *   S.Ord,\n *   contramap((p: User) => p.name)\n * )\n *\n * const byAge = pipe(\n *   N.Ord,\n *   contramap((p: User) => p.age)\n * )\n *\n * const byRememberMe = pipe(\n *   B.Ord,\n *   contramap((p: User) => p.rememberMe)\n * )\n *\n * const M = getMonoid<User>()\n *\n * const users: Array<User> = [\n *   { id: 1, name: 'Guido', age: 47, rememberMe: false },\n *   { id: 2, name: 'Guido', age: 46, rememberMe: true },\n *   { id: 3, name: 'Giulio', age: 44, rememberMe: false },\n *   { id: 4, name: 'Giulio', age: 44, rememberMe: true }\n * ]\n *\n * // sort by name, then by age, then by `rememberMe`\n * const O1 = concatAll(M)([byName, byAge, byRememberMe])\n * assert.deepStrictEqual(sort(O1)(users), [\n *   { id: 3, name: 'Giulio', age: 44, rememberMe: false },\n *   { id: 4, name: 'Giulio', age: 44, rememberMe: true },\n *   { id: 2, name: 'Guido', age: 46, rememberMe: true },\n *   { id: 1, name: 'Guido', age: 47, rememberMe: false }\n * ])\n *\n * // now `rememberMe = true` first, then by name, then by age\n * const O2 = concatAll(M)([reverse(byRememberMe), byName, byAge])\n * assert.deepStrictEqual(sort(O2)(users), [\n *   { id: 4, name: 'Giulio', age: 44, rememberMe: true },\n *   { id: 2, name: 'Guido', age: 46, rememberMe: true },\n *   { id: 3, name: 'Giulio', age: 44, rememberMe: false },\n *   { id: 1, name: 'Guido', age: 47, rememberMe: false }\n * ])\n *\n * @category instances\n * @since 2.4.0\n */\nvar getMonoid = function () { return ({\n    concat: (0, exports.getSemigroup)().concat,\n    empty: (0, exports.fromCompare)(function () { return 0; })\n}); };\nexports.getMonoid = getMonoid;\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Contravariant = {\n    URI: exports.URI,\n    contramap: contramap_\n};\n// -------------------------------------------------------------------------------------\n// utils\n// -------------------------------------------------------------------------------------\n/**\n * @since 2.11.0\n */\nexports.trivial = {\n    equals: function_1.constTrue,\n    compare: /*#__PURE__*/ (0, function_1.constant)(0)\n};\n/**\n * @since 2.11.0\n */\nvar equals = function (O) {\n    return function (second) {\n        return function (first) {\n            return first === second || O.compare(first, second) === 0;\n        };\n    };\n};\nexports.equals = equals;\n// TODO: curry in v3\n/**\n * Test whether one value is _strictly less than_ another\n *\n * @since 2.0.0\n */\nvar lt = function (O) {\n    return function (first, second) {\n        return O.compare(first, second) === -1;\n    };\n};\nexports.lt = lt;\n// TODO: curry in v3\n/**\n * Test whether one value is _strictly greater than_ another\n *\n * @since 2.0.0\n */\nvar gt = function (O) {\n    return function (first, second) {\n        return O.compare(first, second) === 1;\n    };\n};\nexports.gt = gt;\n// TODO: curry in v3\n/**\n * Test whether one value is _non-strictly less than_ another\n *\n * @since 2.0.0\n */\nvar leq = function (O) {\n    return function (first, second) {\n        return O.compare(first, second) !== 1;\n    };\n};\nexports.leq = leq;\n// TODO: curry in v3\n/**\n * Test whether one value is _non-strictly greater than_ another\n *\n * @since 2.0.0\n */\nvar geq = function (O) {\n    return function (first, second) {\n        return O.compare(first, second) !== -1;\n    };\n};\nexports.geq = geq;\n// TODO: curry in v3\n/**\n * Take the minimum of two values. If they are considered equal, the first argument is chosen\n *\n * @since 2.0.0\n */\nvar min = function (O) {\n    return function (first, second) {\n        return first === second || O.compare(first, second) < 1 ? first : second;\n    };\n};\nexports.min = min;\n// TODO: curry in v3\n/**\n * Take the maximum of two values. If they are considered equal, the first argument is chosen\n *\n * @since 2.0.0\n */\nvar max = function (O) {\n    return function (first, second) {\n        return first === second || O.compare(first, second) > -1 ? first : second;\n    };\n};\nexports.max = max;\n/**\n * Clamp a value between a minimum and a maximum\n *\n * @since 2.0.0\n */\nvar clamp = function (O) {\n    var minO = (0, exports.min)(O);\n    var maxO = (0, exports.max)(O);\n    return function (low, hi) { return function (a) { return maxO(minO(a, hi), low); }; };\n};\nexports.clamp = clamp;\n/**\n * Test whether a value is between a minimum and a maximum (inclusive)\n *\n * @since 2.0.0\n */\nvar between = function (O) {\n    var ltO = (0, exports.lt)(O);\n    var gtO = (0, exports.gt)(O);\n    return function (low, hi) { return function (a) { return ltO(a, low) || gtO(a, hi) ? false : true; }; };\n};\nexports.between = between;\n// -------------------------------------------------------------------------------------\n// deprecated\n// -------------------------------------------------------------------------------------\n/**\n * Use [`tuple`](#tuple) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.getTupleOrd = exports.tuple;\n/**\n * Use [`reverse`](#reverse) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.getDualOrd = exports.reverse;\n/**\n * Use [`Contravariant`](#contravariant) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.ord = exports.Contravariant;\n// default compare for primitive types\nfunction compare(first, second) {\n    return first < second ? -1 : first > second ? 1 : 0;\n}\nvar strictOrd = {\n    equals: Eq_1.eqStrict.equals,\n    compare: compare\n};\n/**\n * Use [`Ord`](./boolean.ts.html#ord) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.ordBoolean = strictOrd;\n/**\n * Use [`Ord`](./string.ts.html#ord) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.ordString = strictOrd;\n/**\n * Use [`Ord`](./number.ts.html#ord) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.ordNumber = strictOrd;\n/**\n * Use [`Ord`](./Date.ts.html#ord) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.ordDate = (0, function_1.pipe)(exports.ordNumber, \n/*#__PURE__*/\n(0, exports.contramap)(function (date) { return date.valueOf(); }));\n","\"use strict\";\n/**\n * A `Magma` is a pair `(A, concat)` in which `A` is a non-empty set and `concat` is a binary operation on `A`\n *\n * See [Semigroup](https://gcanti.github.io/fp-ts/modules/Semigroup.ts.html) for some instances.\n *\n * @since 2.0.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.concatAll = exports.endo = exports.filterSecond = exports.filterFirst = exports.reverse = void 0;\n// -------------------------------------------------------------------------------------\n// combinators\n// -------------------------------------------------------------------------------------\n/**\n * The dual of a `Magma`, obtained by swapping the arguments of `concat`.\n *\n * @example\n * import { reverse, concatAll } from 'fp-ts/Magma'\n * import * as N from 'fp-ts/number'\n *\n * const subAll = concatAll(reverse(N.MagmaSub))(0)\n *\n * assert.deepStrictEqual(subAll([1, 2, 3]), 2)\n *\n * @since 2.11.0\n */\nvar reverse = function (M) { return ({\n    concat: function (first, second) { return M.concat(second, first); }\n}); };\nexports.reverse = reverse;\n/**\n * @since 2.11.0\n */\nvar filterFirst = function (predicate) {\n    return function (M) { return ({\n        concat: function (first, second) { return (predicate(first) ? M.concat(first, second) : second); }\n    }); };\n};\nexports.filterFirst = filterFirst;\n/**\n * @since 2.11.0\n */\nvar filterSecond = function (predicate) {\n    return function (M) { return ({\n        concat: function (first, second) { return (predicate(second) ? M.concat(first, second) : first); }\n    }); };\n};\nexports.filterSecond = filterSecond;\n/**\n * @since 2.11.0\n */\nvar endo = function (f) {\n    return function (M) { return ({\n        concat: function (first, second) { return M.concat(f(first), f(second)); }\n    }); };\n};\nexports.endo = endo;\n// -------------------------------------------------------------------------------------\n// utils\n// -------------------------------------------------------------------------------------\n/**\n * Given a sequence of `as`, concat them and return the total.\n *\n * If `as` is empty, return the provided `startWith` value.\n *\n * @example\n * import { concatAll } from 'fp-ts/Magma'\n * import * as N from 'fp-ts/number'\n *\n * const subAll = concatAll(N.MagmaSub)(0)\n *\n * assert.deepStrictEqual(subAll([1, 2, 3]), -6)\n *\n * @since 2.11.0\n */\nvar concatAll = function (M) {\n    return function (startWith) {\n        return function (as) {\n            return as.reduce(function (a, acc) { return M.concat(a, acc); }, startWith);\n        };\n    };\n};\nexports.concatAll = concatAll;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.semigroupProduct = exports.semigroupSum = exports.semigroupString = exports.getFunctionSemigroup = exports.semigroupAny = exports.semigroupAll = exports.fold = exports.getIntercalateSemigroup = exports.getMeetSemigroup = exports.getJoinSemigroup = exports.getDualSemigroup = exports.getStructSemigroup = exports.getTupleSemigroup = exports.getFirstSemigroup = exports.getLastSemigroup = exports.getObjectSemigroup = exports.semigroupVoid = exports.concatAll = exports.last = exports.first = exports.intercalate = exports.tuple = exports.struct = exports.reverse = exports.constant = exports.max = exports.min = void 0;\n/**\n * If a type `A` can form a `Semigroup` it has an **associative** binary operation.\n *\n * ```ts\n * interface Semigroup<A> {\n *   readonly concat: (x: A, y: A) => A\n * }\n * ```\n *\n * Associativity means the following equality must hold for any choice of `x`, `y`, and `z`.\n *\n * ```ts\n * concat(x, concat(y, z)) = concat(concat(x, y), z)\n * ```\n *\n * A common example of a semigroup is the type `string` with the operation `+`.\n *\n * ```ts\n * import { Semigroup } from 'fp-ts/Semigroup'\n *\n * const semigroupString: Semigroup<string> = {\n *   concat: (x, y) => x + y\n * }\n *\n * const x = 'x'\n * const y = 'y'\n * const z = 'z'\n *\n * semigroupString.concat(x, y) // 'xy'\n *\n * semigroupString.concat(x, semigroupString.concat(y, z)) // 'xyz'\n *\n * semigroupString.concat(semigroupString.concat(x, y), z) // 'xyz'\n * ```\n *\n * *Adapted from https://typelevel.org/cats*\n *\n * @since 2.0.0\n */\nvar function_1 = require(\"./function\");\nvar _ = __importStar(require(\"./internal\"));\nvar M = __importStar(require(\"./Magma\"));\nvar Or = __importStar(require(\"./Ord\"));\n// -------------------------------------------------------------------------------------\n// constructors\n// -------------------------------------------------------------------------------------\n/**\n * Get a semigroup where `concat` will return the minimum, based on the provided order.\n *\n * @example\n * import * as N from 'fp-ts/number'\n * import * as S from 'fp-ts/Semigroup'\n *\n * const S1 = S.min(N.Ord)\n *\n * assert.deepStrictEqual(S1.concat(1, 2), 1)\n *\n * @category constructors\n * @since 2.10.0\n */\nvar min = function (O) { return ({\n    concat: Or.min(O)\n}); };\nexports.min = min;\n/**\n * Get a semigroup where `concat` will return the maximum, based on the provided order.\n *\n * @example\n * import * as N from 'fp-ts/number'\n * import * as S from 'fp-ts/Semigroup'\n *\n * const S1 = S.max(N.Ord)\n *\n * assert.deepStrictEqual(S1.concat(1, 2), 2)\n *\n * @category constructors\n * @since 2.10.0\n */\nvar max = function (O) { return ({\n    concat: Or.max(O)\n}); };\nexports.max = max;\n/**\n * @category constructors\n * @since 2.10.0\n */\nvar constant = function (a) { return ({\n    concat: function () { return a; }\n}); };\nexports.constant = constant;\n// -------------------------------------------------------------------------------------\n// combinators\n// -------------------------------------------------------------------------------------\n/**\n * The dual of a `Semigroup`, obtained by swapping the arguments of `concat`.\n *\n * @example\n * import { reverse } from 'fp-ts/Semigroup'\n * import * as S from 'fp-ts/string'\n *\n * assert.deepStrictEqual(reverse(S.Semigroup).concat('a', 'b'), 'ba')\n *\n * @since 2.10.0\n */\nexports.reverse = M.reverse;\n/**\n * Given a struct of semigroups returns a semigroup for the struct.\n *\n * @example\n * import { struct } from 'fp-ts/Semigroup'\n * import * as N from 'fp-ts/number'\n *\n * interface Point {\n *   readonly x: number\n *   readonly y: number\n * }\n *\n * const S = struct<Point>({\n *   x: N.SemigroupSum,\n *   y: N.SemigroupSum\n * })\n *\n * assert.deepStrictEqual(S.concat({ x: 1, y: 2 }, { x: 3, y: 4 }), { x: 4, y: 6 })\n *\n * @since 2.10.0\n */\nvar struct = function (semigroups) { return ({\n    concat: function (first, second) {\n        var r = {};\n        for (var k in semigroups) {\n            if (_.has.call(semigroups, k)) {\n                r[k] = semigroups[k].concat(first[k], second[k]);\n            }\n        }\n        return r;\n    }\n}); };\nexports.struct = struct;\n/**\n * Given a tuple of semigroups returns a semigroup for the tuple.\n *\n * @example\n * import { tuple } from 'fp-ts/Semigroup'\n * import * as B from 'fp-ts/boolean'\n * import * as N from 'fp-ts/number'\n * import * as S from 'fp-ts/string'\n *\n * const S1 = tuple(S.Semigroup, N.SemigroupSum)\n * assert.deepStrictEqual(S1.concat(['a', 1], ['b', 2]), ['ab', 3])\n *\n * const S2 = tuple(S.Semigroup, N.SemigroupSum, B.SemigroupAll)\n * assert.deepStrictEqual(S2.concat(['a', 1, true], ['b', 2, false]), ['ab', 3, false])\n *\n * @since 2.10.0\n */\nvar tuple = function () {\n    var semigroups = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        semigroups[_i] = arguments[_i];\n    }\n    return ({\n        concat: function (first, second) { return semigroups.map(function (s, i) { return s.concat(first[i], second[i]); }); }\n    });\n};\nexports.tuple = tuple;\n/**\n * Between each pair of elements insert `middle`.\n *\n * @example\n * import { intercalate } from 'fp-ts/Semigroup'\n * import * as S from 'fp-ts/string'\n * import { pipe } from 'fp-ts/function'\n *\n * const S1 = pipe(S.Semigroup, intercalate(' + '))\n *\n * assert.strictEqual(S1.concat('a', 'b'), 'a + b')\n *\n * @since 2.10.0\n */\nvar intercalate = function (middle) {\n    return function (S) { return ({\n        concat: function (x, y) { return S.concat(x, S.concat(middle, y)); }\n    }); };\n};\nexports.intercalate = intercalate;\n// -------------------------------------------------------------------------------------\n// instances\n// -------------------------------------------------------------------------------------\n/**\n * Always return the first argument.\n *\n * @example\n * import * as S from 'fp-ts/Semigroup'\n *\n * assert.deepStrictEqual(S.first<number>().concat(1, 2), 1)\n *\n * @category instances\n * @since 2.10.0\n */\nvar first = function () { return ({ concat: function_1.identity }); };\nexports.first = first;\n/**\n * Always return the last argument.\n *\n * @example\n * import * as S from 'fp-ts/Semigroup'\n *\n * assert.deepStrictEqual(S.last<number>().concat(1, 2), 2)\n *\n * @category instances\n * @since 2.10.0\n */\nvar last = function () { return ({ concat: function (_, y) { return y; } }); };\nexports.last = last;\n// -------------------------------------------------------------------------------------\n// utils\n// -------------------------------------------------------------------------------------\n/**\n * Given a sequence of `as`, concat them and return the total.\n *\n * If `as` is empty, return the provided `startWith` value.\n *\n * @example\n * import { concatAll } from 'fp-ts/Semigroup'\n * import * as N from 'fp-ts/number'\n *\n * const sum = concatAll(N.SemigroupSum)(0)\n *\n * assert.deepStrictEqual(sum([1, 2, 3]), 6)\n * assert.deepStrictEqual(sum([]), 0)\n *\n * @since 2.10.0\n */\nexports.concatAll = M.concatAll;\n// -------------------------------------------------------------------------------------\n// deprecated\n// -------------------------------------------------------------------------------------\n/**\n * Use `void` module instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.semigroupVoid = (0, exports.constant)(undefined);\n/**\n * Use [`getAssignSemigroup`](./struct.ts.html#getAssignSemigroup) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nvar getObjectSemigroup = function () { return ({\n    concat: function (first, second) { return Object.assign({}, first, second); }\n}); };\nexports.getObjectSemigroup = getObjectSemigroup;\n/**\n * Use [`last`](#last) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.getLastSemigroup = exports.last;\n/**\n * Use [`first`](#first) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.getFirstSemigroup = exports.first;\n/**\n * Use [`tuple`](#tuple) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.getTupleSemigroup = exports.tuple;\n/**\n * Use [`struct`](#struct) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.getStructSemigroup = exports.struct;\n/**\n * Use [`reverse`](#reverse) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.getDualSemigroup = exports.reverse;\n/**\n * Use [`max`](#max) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.getJoinSemigroup = exports.max;\n/**\n * Use [`min`](#min) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.getMeetSemigroup = exports.min;\n/**\n * Use [`intercalate`](#intercalate) instead.\n *\n * @category zone of death\n * @since 2.5.0\n * @deprecated\n */\nexports.getIntercalateSemigroup = exports.intercalate;\nfunction fold(S) {\n    var concatAllS = (0, exports.concatAll)(S);\n    return function (startWith, as) { return (as === undefined ? concatAllS(startWith) : concatAllS(startWith)(as)); };\n}\nexports.fold = fold;\n/**\n * Use [`SemigroupAll`](./boolean.ts.html#SemigroupAll) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.semigroupAll = {\n    concat: function (x, y) { return x && y; }\n};\n/**\n * Use [`SemigroupAny`](./boolean.ts.html#SemigroupAny) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.semigroupAny = {\n    concat: function (x, y) { return x || y; }\n};\n/**\n * Use [`getSemigroup`](./function.ts.html#getSemigroup) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.getFunctionSemigroup = function_1.getSemigroup;\n/**\n * Use [`Semigroup`](./string.ts.html#Semigroup) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.semigroupString = {\n    concat: function (x, y) { return x + y; }\n};\n/**\n * Use [`SemigroupSum`](./number.ts.html#SemigroupSum) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.semigroupSum = {\n    concat: function (x, y) { return x + y; }\n};\n/**\n * Use [`SemigroupProduct`](./number.ts.html#SemigroupProduct) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.semigroupProduct = {\n    concat: function (x, y) { return x * y; }\n};\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.reduceRight = exports.foldMap = exports.reduce = exports.mapWithIndex = exports.map = exports.flatten = exports.duplicate = exports.extend = exports.flatMap = exports.ap = exports.alt = exports.altW = exports.of = exports.chunksOf = exports.splitAt = exports.chop = exports.chainWithIndex = exports.intersperse = exports.prependAll = exports.unzip = exports.zip = exports.zipWith = exports.modifyAt = exports.updateAt = exports.sort = exports.groupBy = exports.group = exports.reverse = exports.concat = exports.concatW = exports.fromArray = exports.unappend = exports.unprepend = exports.range = exports.replicate = exports.makeBy = exports.fromReadonlyArray = exports.rotate = exports.union = exports.sortBy = exports.uniq = exports.unsafeUpdateAt = exports.unsafeInsertAt = exports.append = exports.appendW = exports.prepend = exports.prependW = exports.isOutOfBound = exports.isNonEmpty = exports.empty = void 0;\nexports.groupSort = exports.chain = exports.intercalate = exports.updateLast = exports.modifyLast = exports.updateHead = exports.modifyHead = exports.matchRight = exports.matchLeft = exports.concatAll = exports.max = exports.min = exports.init = exports.last = exports.tail = exports.head = exports.apS = exports.bind = exports.let = exports.bindTo = exports.Do = exports.Comonad = exports.Alt = exports.TraversableWithIndex = exports.Traversable = exports.FoldableWithIndex = exports.Foldable = exports.Monad = exports.chainFirst = exports.Chain = exports.Applicative = exports.apSecond = exports.apFirst = exports.Apply = exports.FunctorWithIndex = exports.Pointed = exports.flap = exports.Functor = exports.getUnionSemigroup = exports.getEq = exports.getSemigroup = exports.getShow = exports.URI = exports.extract = exports.traverseWithIndex = exports.sequence = exports.traverse = exports.reduceRightWithIndex = exports.foldMapWithIndex = exports.reduceWithIndex = void 0;\nexports.readonlyNonEmptyArray = exports.fold = exports.prependToAll = exports.insertAt = exports.snoc = exports.cons = exports.unsnoc = exports.uncons = exports.filterWithIndex = exports.filter = void 0;\nvar Apply_1 = require(\"./Apply\");\nvar Chain_1 = require(\"./Chain\");\nvar Eq_1 = require(\"./Eq\");\nvar function_1 = require(\"./function\");\nvar Functor_1 = require(\"./Functor\");\nvar _ = __importStar(require(\"./internal\"));\nvar Ord_1 = require(\"./Ord\");\nvar Se = __importStar(require(\"./Semigroup\"));\n// -------------------------------------------------------------------------------------\n// internal\n// -------------------------------------------------------------------------------------\n/**\n * @internal\n */\nexports.empty = _.emptyReadonlyArray;\n/**\n * @internal\n */\nexports.isNonEmpty = _.isNonEmpty;\n/**\n * @internal\n */\nvar isOutOfBound = function (i, as) { return i < 0 || i >= as.length; };\nexports.isOutOfBound = isOutOfBound;\n/**\n * @internal\n */\nvar prependW = function (head) {\n    return function (tail) {\n        return __spreadArray([head], tail, true);\n    };\n};\nexports.prependW = prependW;\n/**\n * @internal\n */\nexports.prepend = exports.prependW;\n/**\n * @internal\n */\nvar appendW = function (end) {\n    return function (init) {\n        return __spreadArray(__spreadArray([], init, true), [end], false);\n    };\n};\nexports.appendW = appendW;\n/**\n * @internal\n */\nexports.append = exports.appendW;\n/**\n * @internal\n */\nvar unsafeInsertAt = function (i, a, as) {\n    if ((0, exports.isNonEmpty)(as)) {\n        var xs = _.fromReadonlyNonEmptyArray(as);\n        xs.splice(i, 0, a);\n        return xs;\n    }\n    return [a];\n};\nexports.unsafeInsertAt = unsafeInsertAt;\n/**\n * @internal\n */\nvar unsafeUpdateAt = function (i, a, as) {\n    if (as[i] === a) {\n        return as;\n    }\n    else {\n        var xs = _.fromReadonlyNonEmptyArray(as);\n        xs[i] = a;\n        return xs;\n    }\n};\nexports.unsafeUpdateAt = unsafeUpdateAt;\n/**\n * Remove duplicates from a `ReadonlyNonEmptyArray`, keeping the first occurrence of an element.\n *\n * @example\n * import { uniq } from 'fp-ts/ReadonlyNonEmptyArray'\n * import * as N from 'fp-ts/number'\n *\n * assert.deepStrictEqual(uniq(N.Eq)([1, 2, 1]), [1, 2])\n *\n * @since 2.11.0\n */\nvar uniq = function (E) {\n    return function (as) {\n        if (as.length === 1) {\n            return as;\n        }\n        var out = [(0, exports.head)(as)];\n        var rest = (0, exports.tail)(as);\n        var _loop_1 = function (a) {\n            if (out.every(function (o) { return !E.equals(o, a); })) {\n                out.push(a);\n            }\n        };\n        for (var _i = 0, rest_1 = rest; _i < rest_1.length; _i++) {\n            var a = rest_1[_i];\n            _loop_1(a);\n        }\n        return out;\n    };\n};\nexports.uniq = uniq;\n/**\n * Sort the elements of a `ReadonlyNonEmptyArray` in increasing order, where elements are compared using first `ords[0]`, then `ords[1]`,\n * etc...\n *\n * @example\n * import * as RNEA from 'fp-ts/ReadonlyNonEmptyArray'\n * import { contramap } from 'fp-ts/Ord'\n * import * as S from 'fp-ts/string'\n * import * as N from 'fp-ts/number'\n * import { pipe } from 'fp-ts/function'\n *\n * interface Person {\n *   name: string\n *   age: number\n * }\n *\n * const byName = pipe(S.Ord, contramap((p: Person) => p.name))\n *\n * const byAge = pipe(N.Ord, contramap((p: Person) => p.age))\n *\n * const sortByNameByAge = RNEA.sortBy([byName, byAge])\n *\n * const persons: RNEA.ReadonlyNonEmptyArray<Person> = [\n *   { name: 'a', age: 1 },\n *   { name: 'b', age: 3 },\n *   { name: 'c', age: 2 },\n *   { name: 'b', age: 2 }\n * ]\n *\n * assert.deepStrictEqual(sortByNameByAge(persons), [\n *   { name: 'a', age: 1 },\n *   { name: 'b', age: 2 },\n *   { name: 'b', age: 3 },\n *   { name: 'c', age: 2 }\n * ])\n *\n * @since 2.11.0\n */\nvar sortBy = function (ords) {\n    if ((0, exports.isNonEmpty)(ords)) {\n        var M = (0, Ord_1.getMonoid)();\n        return (0, exports.sort)(ords.reduce(M.concat, M.empty));\n    }\n    return function_1.identity;\n};\nexports.sortBy = sortBy;\n/**\n * @since 2.11.0\n */\nvar union = function (E) {\n    var uniqE = (0, exports.uniq)(E);\n    return function (second) { return function (first) { return uniqE((0, function_1.pipe)(first, concat(second))); }; };\n};\nexports.union = union;\n/**\n * Rotate a `ReadonlyNonEmptyArray` by `n` steps.\n *\n * @example\n * import { rotate } from 'fp-ts/ReadonlyNonEmptyArray'\n *\n * assert.deepStrictEqual(rotate(2)([1, 2, 3, 4, 5]), [4, 5, 1, 2, 3])\n * assert.deepStrictEqual(rotate(-2)([1, 2, 3, 4, 5]), [3, 4, 5, 1, 2])\n *\n * @since 2.11.0\n */\nvar rotate = function (n) {\n    return function (as) {\n        var len = as.length;\n        var m = Math.round(n) % len;\n        if ((0, exports.isOutOfBound)(Math.abs(m), as) || m === 0) {\n            return as;\n        }\n        if (m < 0) {\n            var _a = (0, exports.splitAt)(-m)(as), f = _a[0], s = _a[1];\n            return (0, function_1.pipe)(s, concat(f));\n        }\n        else {\n            return (0, exports.rotate)(m - len)(as);\n        }\n    };\n};\nexports.rotate = rotate;\n// -------------------------------------------------------------------------------------\n// constructors\n// -------------------------------------------------------------------------------------\n/**\n * Return a `ReadonlyNonEmptyArray` from a `ReadonlyArray` returning `none` if the input is empty.\n *\n * @category conversions\n * @since 2.5.0\n */\nvar fromReadonlyArray = function (as) {\n    return (0, exports.isNonEmpty)(as) ? _.some(as) : _.none;\n};\nexports.fromReadonlyArray = fromReadonlyArray;\n/**\n * Return a `ReadonlyNonEmptyArray` of length `n` with element `i` initialized with `f(i)`.\n *\n * **Note**. `n` is normalized to a natural number.\n *\n * @example\n * import { makeBy } from 'fp-ts/ReadonlyNonEmptyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * const double = (n: number): number => n * 2\n * assert.deepStrictEqual(pipe(5, makeBy(double)), [0, 2, 4, 6, 8])\n *\n * @category constructors\n * @since 2.11.0\n */\nvar makeBy = function (f) {\n    return function (n) {\n        var j = Math.max(0, Math.floor(n));\n        var out = [f(0)];\n        for (var i = 1; i < j; i++) {\n            out.push(f(i));\n        }\n        return out;\n    };\n};\nexports.makeBy = makeBy;\n/**\n * Create a `ReadonlyNonEmptyArray` containing a value repeated the specified number of times.\n *\n * **Note**. `n` is normalized to a natural number.\n *\n * @example\n * import { replicate } from 'fp-ts/ReadonlyNonEmptyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe(3, replicate('a')), ['a', 'a', 'a'])\n *\n * @category constructors\n * @since 2.11.0\n */\nvar replicate = function (a) { return (0, exports.makeBy)(function () { return a; }); };\nexports.replicate = replicate;\n/**\n * Create a `ReadonlyNonEmptyArray` containing a range of integers, including both endpoints.\n *\n * @example\n * import { range } from 'fp-ts/ReadonlyNonEmptyArray'\n *\n * assert.deepStrictEqual(range(1, 5), [1, 2, 3, 4, 5])\n *\n * @category constructors\n * @since 2.11.0\n */\nvar range = function (start, end) {\n    return start <= end ? (0, exports.makeBy)(function (i) { return start + i; })(end - start + 1) : [start];\n};\nexports.range = range;\n/**\n * Return the tuple of the `head` and the `tail`.\n *\n * @example\n * import { unprepend } from 'fp-ts/ReadonlyNonEmptyArray'\n *\n * assert.deepStrictEqual(unprepend([1, 2, 3, 4]), [1, [2, 3, 4]])\n *\n * @since 2.9.0\n */\nvar unprepend = function (as) { return [(0, exports.head)(as), (0, exports.tail)(as)]; };\nexports.unprepend = unprepend;\n/**\n * Return the tuple of the `init` and the `last`.\n *\n * @example\n * import { unappend } from 'fp-ts/ReadonlyNonEmptyArray'\n *\n * assert.deepStrictEqual(unappend([1, 2, 3, 4]), [[1, 2, 3], 4])\n *\n * @since 2.9.0\n */\nvar unappend = function (as) { return [(0, exports.init)(as), (0, exports.last)(as)]; };\nexports.unappend = unappend;\n/**\n * @category conversions\n * @since 2.5.0\n */\nvar fromArray = function (as) { return (0, exports.fromReadonlyArray)(as.slice()); };\nexports.fromArray = fromArray;\nfunction concatW(second) {\n    return function (first) { return first.concat(second); };\n}\nexports.concatW = concatW;\nfunction concat(x, y) {\n    return y ? x.concat(y) : function (y) { return y.concat(x); };\n}\nexports.concat = concat;\n/**\n * @since 2.5.0\n */\nvar reverse = function (as) {\n    return as.length === 1 ? as : __spreadArray([(0, exports.last)(as)], as.slice(0, -1).reverse(), true);\n};\nexports.reverse = reverse;\nfunction group(E) {\n    return function (as) {\n        var len = as.length;\n        if (len === 0) {\n            return exports.empty;\n        }\n        var out = [];\n        var head = as[0];\n        var nea = [head];\n        for (var i = 1; i < len; i++) {\n            var a = as[i];\n            if (E.equals(a, head)) {\n                nea.push(a);\n            }\n            else {\n                out.push(nea);\n                head = a;\n                nea = [head];\n            }\n        }\n        out.push(nea);\n        return out;\n    };\n}\nexports.group = group;\n/**\n * Splits an array into sub-non-empty-arrays stored in an object, based on the result of calling a `string`-returning\n * function on each element, and grouping the results according to values returned\n *\n * @example\n * import { groupBy } from 'fp-ts/ReadonlyNonEmptyArray'\n *\n * assert.deepStrictEqual(groupBy((s: string) => String(s.length))(['a', 'b', 'ab']), {\n *   '1': ['a', 'b'],\n *   '2': ['ab']\n * })\n *\n * @since 2.5.0\n */\nvar groupBy = function (f) {\n    return function (as) {\n        var out = {};\n        for (var _i = 0, as_1 = as; _i < as_1.length; _i++) {\n            var a = as_1[_i];\n            var k = f(a);\n            if (_.has.call(out, k)) {\n                out[k].push(a);\n            }\n            else {\n                out[k] = [a];\n            }\n        }\n        return out;\n    };\n};\nexports.groupBy = groupBy;\n/**\n * @since 2.5.0\n */\nvar sort = function (O) {\n    return function (as) {\n        return as.length === 1 ? as : as.slice().sort(O.compare);\n    };\n};\nexports.sort = sort;\n/**\n * @since 2.5.0\n */\nvar updateAt = function (i, a) {\n    return (0, exports.modifyAt)(i, function () { return a; });\n};\nexports.updateAt = updateAt;\n/**\n * @since 2.5.0\n */\nvar modifyAt = function (i, f) {\n    return function (as) {\n        return (0, exports.isOutOfBound)(i, as) ? _.none : _.some((0, exports.unsafeUpdateAt)(i, f(as[i]), as));\n    };\n};\nexports.modifyAt = modifyAt;\n/**\n * @since 2.5.1\n */\nvar zipWith = function (as, bs, f) {\n    var cs = [f(as[0], bs[0])];\n    var len = Math.min(as.length, bs.length);\n    for (var i = 1; i < len; i++) {\n        cs[i] = f(as[i], bs[i]);\n    }\n    return cs;\n};\nexports.zipWith = zipWith;\nfunction zip(as, bs) {\n    if (bs === undefined) {\n        return function (bs) { return zip(bs, as); };\n    }\n    return (0, exports.zipWith)(as, bs, function (a, b) { return [a, b]; });\n}\nexports.zip = zip;\n/**\n * @since 2.5.1\n */\nvar unzip = function (abs) {\n    var fa = [abs[0][0]];\n    var fb = [abs[0][1]];\n    for (var i = 1; i < abs.length; i++) {\n        fa[i] = abs[i][0];\n        fb[i] = abs[i][1];\n    }\n    return [fa, fb];\n};\nexports.unzip = unzip;\n/**\n * Prepend an element to every member of a `ReadonlyNonEmptyArray`.\n *\n * @example\n * import { prependAll } from 'fp-ts/ReadonlyNonEmptyArray'\n *\n * assert.deepStrictEqual(prependAll(9)([1, 2, 3, 4]), [9, 1, 9, 2, 9, 3, 9, 4])\n *\n * @since 2.10.0\n */\nvar prependAll = function (middle) {\n    return function (as) {\n        var out = [middle, as[0]];\n        for (var i = 1; i < as.length; i++) {\n            out.push(middle, as[i]);\n        }\n        return out;\n    };\n};\nexports.prependAll = prependAll;\n/**\n * Places an element in between members of a `ReadonlyNonEmptyArray`.\n *\n * @example\n * import { intersperse } from 'fp-ts/ReadonlyNonEmptyArray'\n *\n * assert.deepStrictEqual(intersperse(9)([1, 2, 3, 4]), [1, 9, 2, 9, 3, 9, 4])\n *\n * @since 2.9.0\n */\nvar intersperse = function (middle) {\n    return function (as) {\n        var rest = (0, exports.tail)(as);\n        return (0, exports.isNonEmpty)(rest) ? (0, function_1.pipe)(rest, (0, exports.prependAll)(middle), (0, exports.prepend)((0, exports.head)(as))) : as;\n    };\n};\nexports.intersperse = intersperse;\n/**\n * @category sequencing\n * @since 2.10.0\n */\nvar chainWithIndex = function (f) {\n    return function (as) {\n        var out = _.fromReadonlyNonEmptyArray(f(0, (0, exports.head)(as)));\n        for (var i = 1; i < as.length; i++) {\n            out.push.apply(out, f(i, as[i]));\n        }\n        return out;\n    };\n};\nexports.chainWithIndex = chainWithIndex;\n/**\n * A useful recursion pattern for processing a `ReadonlyNonEmptyArray` to produce a new `ReadonlyNonEmptyArray`, often used for \"chopping\" up the input\n * `ReadonlyNonEmptyArray`. Typically `chop` is called with some function that will consume an initial prefix of the `ReadonlyNonEmptyArray` and produce a\n * value and the tail of the `ReadonlyNonEmptyArray`.\n *\n * @since 2.10.0\n */\nvar chop = function (f) {\n    return function (as) {\n        var _a = f(as), b = _a[0], rest = _a[1];\n        var out = [b];\n        var next = rest;\n        while ((0, exports.isNonEmpty)(next)) {\n            var _b = f(next), b_1 = _b[0], rest_2 = _b[1];\n            out.push(b_1);\n            next = rest_2;\n        }\n        return out;\n    };\n};\nexports.chop = chop;\n/**\n * Splits a `ReadonlyNonEmptyArray` into two pieces, the first piece has max `n` elements.\n *\n * @since 2.10.0\n */\nvar splitAt = function (n) {\n    return function (as) {\n        var m = Math.max(1, n);\n        return m >= as.length ? [as, exports.empty] : [(0, function_1.pipe)(as.slice(1, m), (0, exports.prepend)((0, exports.head)(as))), as.slice(m)];\n    };\n};\nexports.splitAt = splitAt;\n/**\n * Splits a `ReadonlyNonEmptyArray` into length-`n` pieces. The last piece will be shorter if `n` does not evenly divide the length of\n * the `ReadonlyNonEmptyArray`.\n *\n * @since 2.10.0\n */\nvar chunksOf = function (n) { return (0, exports.chop)((0, exports.splitAt)(n)); };\nexports.chunksOf = chunksOf;\nvar _map = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.map)(f)); };\n/* istanbul ignore next */\nvar _mapWithIndex = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.mapWithIndex)(f)); };\nvar _ap = function (fab, fa) { return (0, function_1.pipe)(fab, (0, exports.ap)(fa)); };\n/* istanbul ignore next */\nvar _extend = function (wa, f) { return (0, function_1.pipe)(wa, (0, exports.extend)(f)); };\n/* istanbul ignore next */\nvar _reduce = function (fa, b, f) { return (0, function_1.pipe)(fa, (0, exports.reduce)(b, f)); };\n/* istanbul ignore next */\nvar _foldMap = function (M) {\n    var foldMapM = (0, exports.foldMap)(M);\n    return function (fa, f) { return (0, function_1.pipe)(fa, foldMapM(f)); };\n};\n/* istanbul ignore next */\nvar _reduceRight = function (fa, b, f) { return (0, function_1.pipe)(fa, (0, exports.reduceRight)(b, f)); };\n/* istanbul ignore next */\nvar _traverse = function (F) {\n    var traverseF = (0, exports.traverse)(F);\n    return function (ta, f) { return (0, function_1.pipe)(ta, traverseF(f)); };\n};\n/* istanbul ignore next */\nvar _alt = function (fa, that) { return (0, function_1.pipe)(fa, (0, exports.alt)(that)); };\n/* istanbul ignore next */\nvar _reduceWithIndex = function (fa, b, f) {\n    return (0, function_1.pipe)(fa, (0, exports.reduceWithIndex)(b, f));\n};\n/* istanbul ignore next */\nvar _foldMapWithIndex = function (M) {\n    var foldMapWithIndexM = (0, exports.foldMapWithIndex)(M);\n    return function (fa, f) { return (0, function_1.pipe)(fa, foldMapWithIndexM(f)); };\n};\n/* istanbul ignore next */\nvar _reduceRightWithIndex = function (fa, b, f) {\n    return (0, function_1.pipe)(fa, (0, exports.reduceRightWithIndex)(b, f));\n};\n/* istanbul ignore next */\nvar _traverseWithIndex = function (F) {\n    var traverseWithIndexF = (0, exports.traverseWithIndex)(F);\n    return function (ta, f) { return (0, function_1.pipe)(ta, traverseWithIndexF(f)); };\n};\n/**\n * @category constructors\n * @since 2.5.0\n */\nexports.of = _.singleton;\n/**\n * Less strict version of [`alt`](#alt).\n *\n * The `W` suffix (short for **W**idening) means that the return types will be merged.\n *\n * @example\n * import * as RNEA from 'fp-ts/ReadonlyNonEmptyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3] as RNEA.ReadonlyNonEmptyArray<number>,\n *     RNEA.altW(() => ['a', 'b'])\n *   ),\n *   [1, 2, 3, 'a', 'b']\n * )\n *\n * @category error handling\n * @since 2.9.0\n */\nvar altW = function (that) {\n    return function (as) {\n        return (0, function_1.pipe)(as, concatW(that()));\n    };\n};\nexports.altW = altW;\n/**\n * Identifies an associative operation on a type constructor. It is similar to `Semigroup`, except that it applies to\n * types of kind `* -> *`.\n *\n * In case of `ReadonlyNonEmptyArray` concatenates the inputs into a single array.\n *\n * @example\n * import * as RNEA from 'fp-ts/ReadonlyNonEmptyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3],\n *     RNEA.alt(() => [4, 5])\n *   ),\n *   [1, 2, 3, 4, 5]\n * )\n *\n * @category error handling\n * @since 2.6.2\n */\nexports.alt = exports.altW;\n/**\n * @since 2.5.0\n */\nvar ap = function (as) { return (0, exports.flatMap)(function (f) { return (0, function_1.pipe)(as, (0, exports.map)(f)); }); };\nexports.ap = ap;\n/**\n * @example\n * import * as RNEA from 'fp-ts/ReadonlyNonEmptyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3],\n *     RNEA.flatMap((n) => [`a${n}`, `b${n}`])\n *   ),\n *   ['a1', 'b1', 'a2', 'b2', 'a3', 'b3']\n * )\n *\n * @category sequencing\n * @since 2.14.0\n */\nexports.flatMap = (0, function_1.dual)(2, function (ma, f) {\n    return (0, function_1.pipe)(ma, (0, exports.chainWithIndex)(function (i, a) { return f(a, i); }));\n});\n/**\n * @since 2.5.0\n */\nvar extend = function (f) {\n    return function (as) {\n        var next = (0, exports.tail)(as);\n        var out = [f(as)];\n        while ((0, exports.isNonEmpty)(next)) {\n            out.push(f(next));\n            next = (0, exports.tail)(next);\n        }\n        return out;\n    };\n};\nexports.extend = extend;\n/**\n * @since 2.5.0\n */\nexports.duplicate = \n/*#__PURE__*/ (0, exports.extend)(function_1.identity);\n/**\n * @category sequencing\n * @since 2.5.0\n */\nexports.flatten = \n/*#__PURE__*/ (0, exports.flatMap)(function_1.identity);\n/**\n * `map` can be used to turn functions `(a: A) => B` into functions `(fa: F<A>) => F<B>` whose argument and return types\n * use the type constructor `F` to represent some computational context.\n *\n * @category mapping\n * @since 2.5.0\n */\nvar map = function (f) {\n    return (0, exports.mapWithIndex)(function (_, a) { return f(a); });\n};\nexports.map = map;\n/**\n * @category mapping\n * @since 2.5.0\n */\nvar mapWithIndex = function (f) {\n    return function (as) {\n        var out = [f(0, (0, exports.head)(as))];\n        for (var i = 1; i < as.length; i++) {\n            out.push(f(i, as[i]));\n        }\n        return out;\n    };\n};\nexports.mapWithIndex = mapWithIndex;\n/**\n * @category folding\n * @since 2.5.0\n */\nvar reduce = function (b, f) {\n    return (0, exports.reduceWithIndex)(b, function (_, b, a) { return f(b, a); });\n};\nexports.reduce = reduce;\n/**\n * **Note**. The constraint is relaxed: a `Semigroup` instead of a `Monoid`.\n *\n * @category folding\n * @since 2.5.0\n */\nvar foldMap = function (S) {\n    return function (f) {\n        return function (as) {\n            return as.slice(1).reduce(function (s, a) { return S.concat(s, f(a)); }, f(as[0]));\n        };\n    };\n};\nexports.foldMap = foldMap;\n/**\n * @category folding\n * @since 2.5.0\n */\nvar reduceRight = function (b, f) {\n    return (0, exports.reduceRightWithIndex)(b, function (_, b, a) { return f(b, a); });\n};\nexports.reduceRight = reduceRight;\n/**\n * @category folding\n * @since 2.5.0\n */\nvar reduceWithIndex = function (b, f) {\n    return function (as) {\n        return as.reduce(function (b, a, i) { return f(i, b, a); }, b);\n    };\n};\nexports.reduceWithIndex = reduceWithIndex;\n/**\n * **Note**. The constraint is relaxed: a `Semigroup` instead of a `Monoid`.\n *\n * @category folding\n * @since 2.5.0\n */\nvar foldMapWithIndex = function (S) {\n    return function (f) {\n        return function (as) {\n            return as.slice(1).reduce(function (s, a, i) { return S.concat(s, f(i + 1, a)); }, f(0, as[0]));\n        };\n    };\n};\nexports.foldMapWithIndex = foldMapWithIndex;\n/**\n * @category folding\n * @since 2.5.0\n */\nvar reduceRightWithIndex = function (b, f) {\n    return function (as) {\n        return as.reduceRight(function (b, a, i) { return f(i, a, b); }, b);\n    };\n};\nexports.reduceRightWithIndex = reduceRightWithIndex;\n/**\n * @category traversing\n * @since 2.6.3\n */\nvar traverse = function (F) {\n    var traverseWithIndexF = (0, exports.traverseWithIndex)(F);\n    return function (f) { return traverseWithIndexF(function (_, a) { return f(a); }); };\n};\nexports.traverse = traverse;\n/**\n * @category traversing\n * @since 2.6.3\n */\nvar sequence = function (F) { return (0, exports.traverseWithIndex)(F)(function_1.SK); };\nexports.sequence = sequence;\n/**\n * @category sequencing\n * @since 2.6.3\n */\nvar traverseWithIndex = function (F) {\n    return function (f) {\n        return function (as) {\n            var out = F.map(f(0, (0, exports.head)(as)), exports.of);\n            for (var i = 1; i < as.length; i++) {\n                out = F.ap(F.map(out, function (bs) { return function (b) { return (0, function_1.pipe)(bs, (0, exports.append)(b)); }; }), f(i, as[i]));\n            }\n            return out;\n        };\n    };\n};\nexports.traverseWithIndex = traverseWithIndex;\n/**\n * @category Comonad\n * @since 2.6.3\n */\nexports.extract = _.head;\n/**\n * @category type lambdas\n * @since 2.5.0\n */\nexports.URI = 'ReadonlyNonEmptyArray';\n/**\n * @category instances\n * @since 2.5.0\n */\nvar getShow = function (S) { return ({\n    show: function (as) { return \"[\".concat(as.map(S.show).join(', '), \"]\"); }\n}); };\nexports.getShow = getShow;\n/**\n * Builds a `Semigroup` instance for `ReadonlyNonEmptyArray`\n *\n * @category instances\n * @since 2.5.0\n */\nvar getSemigroup = function () { return ({\n    concat: concat\n}); };\nexports.getSemigroup = getSemigroup;\n/**\n * @example\n * import { getEq } from 'fp-ts/ReadonlyNonEmptyArray'\n * import * as N from 'fp-ts/number'\n *\n * const E = getEq(N.Eq)\n * assert.strictEqual(E.equals([1, 2], [1, 2]), true)\n * assert.strictEqual(E.equals([1, 2], [1, 3]), false)\n *\n * @category instances\n * @since 2.5.0\n */\nvar getEq = function (E) {\n    return (0, Eq_1.fromEquals)(function (xs, ys) { return xs.length === ys.length && xs.every(function (x, i) { return E.equals(x, ys[i]); }); });\n};\nexports.getEq = getEq;\n/**\n * @since 2.11.0\n */\nvar getUnionSemigroup = function (E) {\n    var unionE = (0, exports.union)(E);\n    return {\n        concat: function (first, second) { return unionE(second)(first); }\n    };\n};\nexports.getUnionSemigroup = getUnionSemigroup;\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Functor = {\n    URI: exports.URI,\n    map: _map\n};\n/**\n * @category mapping\n * @since 2.10.0\n */\nexports.flap = (0, Functor_1.flap)(exports.Functor);\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Pointed = {\n    URI: exports.URI,\n    of: exports.of\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.FunctorWithIndex = {\n    URI: exports.URI,\n    map: _map,\n    mapWithIndex: _mapWithIndex\n};\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Apply = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap\n};\n/**\n * Combine two effectful actions, keeping only the result of the first.\n *\n * @since 2.5.0\n */\nexports.apFirst = (0, Apply_1.apFirst)(exports.Apply);\n/**\n * Combine two effectful actions, keeping only the result of the second.\n *\n * @since 2.5.0\n */\nexports.apSecond = (0, Apply_1.apSecond)(exports.Apply);\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Applicative = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    of: exports.of\n};\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Chain = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    chain: exports.flatMap\n};\n/**\n * Composes computations in sequence, using the return value of one computation to determine the next computation and\n * keeping only the result of the first.\n *\n * @example\n * import * as RA from 'fp-ts/ReadonlyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3],\n *     RA.chainFirst(() => ['a', 'b'])\n *   ),\n *   [1, 1, 2, 2, 3, 3]\n * )\n *\n * @category sequencing\n * @since 2.5.0\n */\nexports.chainFirst = (0, Chain_1.chainFirst)(exports.Chain);\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Monad = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    of: exports.of,\n    chain: exports.flatMap\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Foldable = {\n    URI: exports.URI,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.FoldableWithIndex = {\n    URI: exports.URI,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    reduceWithIndex: _reduceWithIndex,\n    foldMapWithIndex: _foldMapWithIndex,\n    reduceRightWithIndex: _reduceRightWithIndex\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Traversable = {\n    URI: exports.URI,\n    map: _map,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    traverse: _traverse,\n    sequence: exports.sequence\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.TraversableWithIndex = {\n    URI: exports.URI,\n    map: _map,\n    mapWithIndex: _mapWithIndex,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    traverse: _traverse,\n    sequence: exports.sequence,\n    reduceWithIndex: _reduceWithIndex,\n    foldMapWithIndex: _foldMapWithIndex,\n    reduceRightWithIndex: _reduceRightWithIndex,\n    traverseWithIndex: _traverseWithIndex\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Alt = {\n    URI: exports.URI,\n    map: _map,\n    alt: _alt\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Comonad = {\n    URI: exports.URI,\n    map: _map,\n    extend: _extend,\n    extract: exports.extract\n};\n// -------------------------------------------------------------------------------------\n// do notation\n// -------------------------------------------------------------------------------------\n/**\n * @category do notation\n * @since 2.9.0\n */\nexports.Do = (0, exports.of)(_.emptyRecord);\n/**\n * @category do notation\n * @since 2.8.0\n */\nexports.bindTo = (0, Functor_1.bindTo)(exports.Functor);\nvar let_ = /*#__PURE__*/ (0, Functor_1.let)(exports.Functor);\nexports.let = let_;\n/**\n * @category do notation\n * @since 2.8.0\n */\nexports.bind = (0, Chain_1.bind)(exports.Chain);\n/**\n * @category do notation\n * @since 2.8.0\n */\nexports.apS = (0, Apply_1.apS)(exports.Apply);\n// -------------------------------------------------------------------------------------\n// utils\n// -------------------------------------------------------------------------------------\n/**\n * @since 2.5.0\n */\nexports.head = exports.extract;\n/**\n * @since 2.5.0\n */\nexports.tail = _.tail;\n/**\n * @since 2.5.0\n */\nvar last = function (as) { return as[as.length - 1]; };\nexports.last = last;\n/**\n * Get all but the last element of a non empty array, creating a new array.\n *\n * @example\n * import { init } from 'fp-ts/ReadonlyNonEmptyArray'\n *\n * assert.deepStrictEqual(init([1, 2, 3]), [1, 2])\n * assert.deepStrictEqual(init([1]), [])\n *\n * @since 2.5.0\n */\nvar init = function (as) { return as.slice(0, -1); };\nexports.init = init;\n/**\n * @since 2.5.0\n */\nvar min = function (O) {\n    var S = Se.min(O);\n    return function (as) { return as.reduce(S.concat); };\n};\nexports.min = min;\n/**\n * @since 2.5.0\n */\nvar max = function (O) {\n    var S = Se.max(O);\n    return function (as) { return as.reduce(S.concat); };\n};\nexports.max = max;\n/**\n * @since 2.10.0\n */\nvar concatAll = function (S) {\n    return function (as) {\n        return as.reduce(S.concat);\n    };\n};\nexports.concatAll = concatAll;\n/**\n * Break a `ReadonlyArray` into its first element and remaining elements.\n *\n * @category pattern matching\n * @since 2.11.0\n */\nvar matchLeft = function (f) {\n    return function (as) {\n        return f((0, exports.head)(as), (0, exports.tail)(as));\n    };\n};\nexports.matchLeft = matchLeft;\n/**\n * Break a `ReadonlyArray` into its initial elements and the last element.\n *\n * @category pattern matching\n * @since 2.11.0\n */\nvar matchRight = function (f) {\n    return function (as) {\n        return f((0, exports.init)(as), (0, exports.last)(as));\n    };\n};\nexports.matchRight = matchRight;\n/**\n * Apply a function to the head, creating a new `ReadonlyNonEmptyArray`.\n *\n * @since 2.11.0\n */\nvar modifyHead = function (f) {\n    return function (as) {\n        return __spreadArray([f((0, exports.head)(as))], (0, exports.tail)(as), true);\n    };\n};\nexports.modifyHead = modifyHead;\n/**\n * Change the head, creating a new `ReadonlyNonEmptyArray`.\n *\n * @since 2.11.0\n */\nvar updateHead = function (a) { return (0, exports.modifyHead)(function () { return a; }); };\nexports.updateHead = updateHead;\n/**\n * Apply a function to the last element, creating a new `ReadonlyNonEmptyArray`.\n *\n * @since 2.11.0\n */\nvar modifyLast = function (f) {\n    return function (as) {\n        return (0, function_1.pipe)((0, exports.init)(as), (0, exports.append)(f((0, exports.last)(as))));\n    };\n};\nexports.modifyLast = modifyLast;\n/**\n * Change the last element, creating a new `ReadonlyNonEmptyArray`.\n *\n * @since 2.11.0\n */\nvar updateLast = function (a) { return (0, exports.modifyLast)(function () { return a; }); };\nexports.updateLast = updateLast;\n/**\n * Places an element in between members of a `ReadonlyNonEmptyArray`, then folds the results using the provided `Semigroup`.\n *\n * @example\n * import * as S from 'fp-ts/string'\n * import { intercalate } from 'fp-ts/ReadonlyNonEmptyArray'\n *\n * assert.deepStrictEqual(intercalate(S.Semigroup)('-')(['a', 'b', 'c']), 'a-b-c')\n *\n * @since 2.12.0\n */\nvar intercalate = function (S) {\n    var concatAllS = (0, exports.concatAll)(S);\n    return function (middle) { return (0, function_1.flow)((0, exports.intersperse)(middle), concatAllS); };\n};\nexports.intercalate = intercalate;\n// -------------------------------------------------------------------------------------\n// legacy\n// -------------------------------------------------------------------------------------\n/**\n * Alias of `flatMap`.\n *\n * @category legacy\n * @since 2.5.0\n */\nexports.chain = exports.flatMap;\nfunction groupSort(O) {\n    var sortO = (0, exports.sort)(O);\n    var groupO = group(O);\n    return function (as) { return ((0, exports.isNonEmpty)(as) ? groupO(sortO(as)) : exports.empty); };\n}\nexports.groupSort = groupSort;\nfunction filter(predicate) {\n    return (0, exports.filterWithIndex)(function (_, a) { return predicate(a); });\n}\nexports.filter = filter;\n/**\n * Use [`filterWithIndex`](./ReadonlyArray.ts.html#filterwithindex) instead.\n *\n * @category zone of death\n * @since 2.5.0\n * @deprecated\n */\nvar filterWithIndex = function (predicate) {\n    return function (as) {\n        return (0, exports.fromReadonlyArray)(as.filter(function (a, i) { return predicate(i, a); }));\n    };\n};\nexports.filterWithIndex = filterWithIndex;\n/**\n * Use [`unprepend`](#unprepend) instead.\n *\n * @category zone of death\n * @since 2.10.0\n * @deprecated\n */\nexports.uncons = exports.unprepend;\n/**\n * Use [`unappend`](#unappend) instead.\n *\n * @category zone of death\n * @since 2.10.0\n * @deprecated\n */\nexports.unsnoc = exports.unappend;\nfunction cons(head, tail) {\n    return tail === undefined ? (0, exports.prepend)(head) : (0, function_1.pipe)(tail, (0, exports.prepend)(head));\n}\nexports.cons = cons;\n/**\n * Use [`append`](./ReadonlyArray.ts.html#append) instead.\n *\n * @category zone of death\n * @since 2.5.0\n * @deprecated\n */\nvar snoc = function (init, end) { return (0, function_1.pipe)(init, concat([end])); };\nexports.snoc = snoc;\n/**\n * Use [`insertAt`](./ReadonlyArray.ts.html#insertat) instead.\n *\n * @category zone of death\n * @since 2.5.0\n * @deprecated\n */\nvar insertAt = function (i, a) {\n    return function (as) {\n        return i < 0 || i > as.length ? _.none : _.some((0, exports.unsafeInsertAt)(i, a, as));\n    };\n};\nexports.insertAt = insertAt;\n/**\n * Use [`prependAll`](#prependall) instead.\n *\n * @category zone of death\n * @since 2.9.0\n * @deprecated\n */\nexports.prependToAll = exports.prependAll;\n/**\n * Use [`concatAll`](#concatall) instead.\n *\n * @category zone of death\n * @since 2.5.0\n * @deprecated\n */\nexports.fold = exports.concatAll;\n/**\n * This instance is deprecated, use small, specific instances instead.\n * For example if a function needs a `Functor` instance, pass `RNEA.Functor` instead of `RNEA.readonlyNonEmptyArray`\n * (where `RNEA` is from `import RNEA from 'fp-ts/ReadonlyNonEmptyArray'`)\n *\n * @category zone of death\n * @since 2.5.0\n * @deprecated\n */\nexports.readonlyNonEmptyArray = {\n    URI: exports.URI,\n    of: exports.of,\n    map: _map,\n    mapWithIndex: _mapWithIndex,\n    ap: _ap,\n    chain: exports.flatMap,\n    extend: _extend,\n    extract: exports.extract,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    traverse: _traverse,\n    sequence: exports.sequence,\n    reduceWithIndex: _reduceWithIndex,\n    foldMapWithIndex: _foldMapWithIndex,\n    reduceRightWithIndex: _reduceRightWithIndex,\n    traverseWithIndex: _traverseWithIndex,\n    alt: _alt\n};\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.mapWithIndex = exports.map = exports.flatten = exports.duplicate = exports.extend = exports.flatMap = exports.ap = exports.alt = exports.altW = exports.chunksOf = exports.splitAt = exports.chop = exports.chainWithIndex = exports.foldMap = exports.foldMapWithIndex = exports.intersperse = exports.prependAll = exports.unzip = exports.zip = exports.zipWith = exports.of = exports.copy = exports.modifyAt = exports.updateAt = exports.insertAt = exports.sort = exports.groupBy = exports.group = exports.reverse = exports.concat = exports.concatW = exports.unappend = exports.unprepend = exports.range = exports.replicate = exports.makeBy = exports.fromArray = exports.fromReadonlyNonEmptyArray = exports.rotate = exports.union = exports.sortBy = exports.uniq = exports.unsafeUpdateAt = exports.unsafeInsertAt = exports.append = exports.appendW = exports.prepend = exports.prependW = exports.isOutOfBound = exports.isNonEmpty = void 0;\nexports.chain = exports.intercalate = exports.updateLast = exports.modifyLast = exports.updateHead = exports.modifyHead = exports.matchRight = exports.matchLeft = exports.concatAll = exports.max = exports.min = exports.init = exports.last = exports.tail = exports.head = exports.apS = exports.bind = exports.let = exports.bindTo = exports.Do = exports.Comonad = exports.Alt = exports.TraversableWithIndex = exports.Traversable = exports.FoldableWithIndex = exports.Foldable = exports.Monad = exports.chainFirst = exports.Chain = exports.Applicative = exports.apSecond = exports.apFirst = exports.Apply = exports.FunctorWithIndex = exports.Pointed = exports.flap = exports.Functor = exports.getUnionSemigroup = exports.getEq = exports.getSemigroup = exports.getShow = exports.URI = exports.extract = exports.traverseWithIndex = exports.sequence = exports.traverse = exports.reduceRightWithIndex = exports.reduceRight = exports.reduceWithIndex = exports.reduce = void 0;\nexports.nonEmptyArray = exports.fold = exports.prependToAll = exports.snoc = exports.cons = exports.unsnoc = exports.uncons = exports.filterWithIndex = exports.filter = exports.groupSort = void 0;\nvar Apply_1 = require(\"./Apply\");\nvar Chain_1 = require(\"./Chain\");\nvar function_1 = require(\"./function\");\nvar Functor_1 = require(\"./Functor\");\nvar _ = __importStar(require(\"./internal\"));\nvar Ord_1 = require(\"./Ord\");\nvar RNEA = __importStar(require(\"./ReadonlyNonEmptyArray\"));\n// -------------------------------------------------------------------------------------\n// internal\n// -------------------------------------------------------------------------------------\n/**\n * @internal\n */\nvar isNonEmpty = function (as) { return as.length > 0; };\nexports.isNonEmpty = isNonEmpty;\n/**\n * @internal\n */\nvar isOutOfBound = function (i, as) { return i < 0 || i >= as.length; };\nexports.isOutOfBound = isOutOfBound;\n/**\n * @internal\n */\nvar prependW = function (head) {\n    return function (tail) {\n        return __spreadArray([head], tail, true);\n    };\n};\nexports.prependW = prependW;\n/**\n * @internal\n */\nexports.prepend = exports.prependW;\n/**\n * @internal\n */\nvar appendW = function (end) {\n    return function (init) {\n        return __spreadArray(__spreadArray([], init, true), [end], false);\n    };\n};\nexports.appendW = appendW;\n/**\n * @internal\n */\nexports.append = exports.appendW;\n/**\n * @internal\n */\nvar unsafeInsertAt = function (i, a, as) {\n    if ((0, exports.isNonEmpty)(as)) {\n        var xs = (0, exports.fromReadonlyNonEmptyArray)(as);\n        xs.splice(i, 0, a);\n        return xs;\n    }\n    return [a];\n};\nexports.unsafeInsertAt = unsafeInsertAt;\n/**\n * @internal\n */\nvar unsafeUpdateAt = function (i, a, as) {\n    var xs = (0, exports.fromReadonlyNonEmptyArray)(as);\n    xs[i] = a;\n    return xs;\n};\nexports.unsafeUpdateAt = unsafeUpdateAt;\n/**\n * Remove duplicates from a `NonEmptyArray`, keeping the first occurrence of an element.\n *\n * @example\n * import { uniq } from 'fp-ts/NonEmptyArray'\n * import * as N from 'fp-ts/number'\n *\n * assert.deepStrictEqual(uniq(N.Eq)([1, 2, 1]), [1, 2])\n *\n * @since 2.11.0\n */\nvar uniq = function (E) {\n    return function (as) {\n        if (as.length === 1) {\n            return (0, exports.copy)(as);\n        }\n        var out = [(0, exports.head)(as)];\n        var rest = (0, exports.tail)(as);\n        var _loop_1 = function (a) {\n            if (out.every(function (o) { return !E.equals(o, a); })) {\n                out.push(a);\n            }\n        };\n        for (var _i = 0, rest_1 = rest; _i < rest_1.length; _i++) {\n            var a = rest_1[_i];\n            _loop_1(a);\n        }\n        return out;\n    };\n};\nexports.uniq = uniq;\n/**\n * Sort the elements of a `NonEmptyArray` in increasing order, where elements are compared using first `ords[0]`, then `ords[1]`,\n * etc...\n *\n * @example\n * import * as NEA from 'fp-ts/NonEmptyArray'\n * import { contramap } from 'fp-ts/Ord'\n * import * as S from 'fp-ts/string'\n * import * as N from 'fp-ts/number'\n * import { pipe } from 'fp-ts/function'\n *\n * interface Person {\n *   name: string\n *   age: number\n * }\n *\n * const byName = pipe(S.Ord, contramap((p: Person) => p.name))\n *\n * const byAge = pipe(N.Ord, contramap((p: Person) => p.age))\n *\n * const sortByNameByAge = NEA.sortBy([byName, byAge])\n *\n * const persons: NEA.NonEmptyArray<Person> = [\n *   { name: 'a', age: 1 },\n *   { name: 'b', age: 3 },\n *   { name: 'c', age: 2 },\n *   { name: 'b', age: 2 }\n * ]\n *\n * assert.deepStrictEqual(sortByNameByAge(persons), [\n *   { name: 'a', age: 1 },\n *   { name: 'b', age: 2 },\n *   { name: 'b', age: 3 },\n *   { name: 'c', age: 2 }\n * ])\n *\n * @since 2.11.0\n */\nvar sortBy = function (ords) {\n    if ((0, exports.isNonEmpty)(ords)) {\n        var M = (0, Ord_1.getMonoid)();\n        return (0, exports.sort)(ords.reduce(M.concat, M.empty));\n    }\n    return exports.copy;\n};\nexports.sortBy = sortBy;\n/**\n * @since 2.11.0\n */\nvar union = function (E) {\n    var uniqE = (0, exports.uniq)(E);\n    return function (second) { return function (first) { return uniqE((0, function_1.pipe)(first, concat(second))); }; };\n};\nexports.union = union;\n/**\n * Rotate a `NonEmptyArray` by `n` steps.\n *\n * @example\n * import { rotate } from 'fp-ts/NonEmptyArray'\n *\n * assert.deepStrictEqual(rotate(2)([1, 2, 3, 4, 5]), [4, 5, 1, 2, 3])\n * assert.deepStrictEqual(rotate(-2)([1, 2, 3, 4, 5]), [3, 4, 5, 1, 2])\n *\n * @since 2.11.0\n */\nvar rotate = function (n) {\n    return function (as) {\n        var len = as.length;\n        var m = Math.round(n) % len;\n        if ((0, exports.isOutOfBound)(Math.abs(m), as) || m === 0) {\n            return (0, exports.copy)(as);\n        }\n        if (m < 0) {\n            var _a = (0, exports.splitAt)(-m)(as), f = _a[0], s = _a[1];\n            return (0, function_1.pipe)(s, concat(f));\n        }\n        else {\n            return (0, exports.rotate)(m - len)(as);\n        }\n    };\n};\nexports.rotate = rotate;\n// -------------------------------------------------------------------------------------\n// constructors\n// -------------------------------------------------------------------------------------\n/**\n * @category conversions\n * @since 2.10.0\n */\nexports.fromReadonlyNonEmptyArray = _.fromReadonlyNonEmptyArray;\n/**\n * Builds a `NonEmptyArray` from an `Array` returning `none` if `as` is an empty array\n *\n * @category conversions\n * @since 2.0.0\n */\nvar fromArray = function (as) { return ((0, exports.isNonEmpty)(as) ? _.some(as) : _.none); };\nexports.fromArray = fromArray;\n/**\n * Return a `NonEmptyArray` of length `n` with element `i` initialized with `f(i)`.\n *\n * **Note**. `n` is normalized to a natural number.\n *\n * @example\n * import { makeBy } from 'fp-ts/NonEmptyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * const double = (n: number): number => n * 2\n * assert.deepStrictEqual(pipe(5, makeBy(double)), [0, 2, 4, 6, 8])\n *\n * @category constructors\n * @since 2.11.0\n */\nvar makeBy = function (f) {\n    return function (n) {\n        var j = Math.max(0, Math.floor(n));\n        var out = [f(0)];\n        for (var i = 1; i < j; i++) {\n            out.push(f(i));\n        }\n        return out;\n    };\n};\nexports.makeBy = makeBy;\n/**\n * Create a `NonEmptyArray` containing a value repeated the specified number of times.\n *\n * **Note**. `n` is normalized to a natural number.\n *\n * @example\n * import { replicate } from 'fp-ts/NonEmptyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe(3, replicate('a')), ['a', 'a', 'a'])\n *\n * @category constructors\n * @since 2.11.0\n */\nvar replicate = function (a) { return (0, exports.makeBy)(function () { return a; }); };\nexports.replicate = replicate;\n/**\n * Create a `NonEmptyArray` containing a range of integers, including both endpoints.\n *\n * @example\n * import { range } from 'fp-ts/NonEmptyArray'\n *\n * assert.deepStrictEqual(range(1, 5), [1, 2, 3, 4, 5])\n *\n * @category constructors\n * @since 2.11.0\n */\nvar range = function (start, end) {\n    return start <= end ? (0, exports.makeBy)(function (i) { return start + i; })(end - start + 1) : [start];\n};\nexports.range = range;\n/**\n * Return the tuple of the `head` and the `tail`.\n *\n * @example\n * import { unprepend } from 'fp-ts/NonEmptyArray'\n *\n * assert.deepStrictEqual(unprepend([1, 2, 3]), [1, [2, 3]])\n *\n * @since 2.9.0\n */\nvar unprepend = function (as) { return [(0, exports.head)(as), (0, exports.tail)(as)]; };\nexports.unprepend = unprepend;\n/**\n * Return the tuple of the `init` and the `last`.\n *\n * @example\n * import { unappend } from 'fp-ts/NonEmptyArray'\n *\n * assert.deepStrictEqual(unappend([1, 2, 3, 4]), [[1, 2, 3], 4])\n *\n * @since 2.9.0\n */\nvar unappend = function (as) { return [(0, exports.init)(as), (0, exports.last)(as)]; };\nexports.unappend = unappend;\nfunction concatW(second) {\n    return function (first) { return first.concat(second); };\n}\nexports.concatW = concatW;\nfunction concat(x, y) {\n    return y ? x.concat(y) : function (y) { return y.concat(x); };\n}\nexports.concat = concat;\n/**\n * @since 2.0.0\n */\nvar reverse = function (as) { return __spreadArray([(0, exports.last)(as)], as.slice(0, -1).reverse(), true); };\nexports.reverse = reverse;\nfunction group(E) {\n    return function (as) {\n        var len = as.length;\n        if (len === 0) {\n            return [];\n        }\n        var out = [];\n        var head = as[0];\n        var nea = [head];\n        for (var i = 1; i < len; i++) {\n            var a = as[i];\n            if (E.equals(a, head)) {\n                nea.push(a);\n            }\n            else {\n                out.push(nea);\n                head = a;\n                nea = [head];\n            }\n        }\n        out.push(nea);\n        return out;\n    };\n}\nexports.group = group;\n/**\n * Splits an array into sub-non-empty-arrays stored in an object, based on the result of calling a `string`-returning\n * function on each element, and grouping the results according to values returned\n *\n * @example\n * import { groupBy } from 'fp-ts/NonEmptyArray'\n *\n * assert.deepStrictEqual(groupBy((s: string) => String(s.length))(['a', 'b', 'ab']), {\n *   '1': ['a', 'b'],\n *   '2': ['ab']\n * })\n *\n * @since 2.0.0\n */\nvar groupBy = function (f) {\n    return function (as) {\n        var out = {};\n        for (var _i = 0, as_1 = as; _i < as_1.length; _i++) {\n            var a = as_1[_i];\n            var k = f(a);\n            if (_.has.call(out, k)) {\n                out[k].push(a);\n            }\n            else {\n                out[k] = [a];\n            }\n        }\n        return out;\n    };\n};\nexports.groupBy = groupBy;\n/**\n * @since 2.0.0\n */\nvar sort = function (O) {\n    return function (as) {\n        return as.slice().sort(O.compare);\n    };\n};\nexports.sort = sort;\n/**\n * @since 2.0.0\n */\nvar insertAt = function (i, a) {\n    return function (as) {\n        return i < 0 || i > as.length ? _.none : _.some((0, exports.unsafeInsertAt)(i, a, as));\n    };\n};\nexports.insertAt = insertAt;\n/**\n * @since 2.0.0\n */\nvar updateAt = function (i, a) {\n    return (0, exports.modifyAt)(i, function () { return a; });\n};\nexports.updateAt = updateAt;\n/**\n * @since 2.0.0\n */\nvar modifyAt = function (i, f) {\n    return function (as) {\n        return (0, exports.isOutOfBound)(i, as) ? _.none : _.some((0, exports.unsafeUpdateAt)(i, f(as[i]), as));\n    };\n};\nexports.modifyAt = modifyAt;\n/**\n * @since 2.0.0\n */\nexports.copy = exports.fromReadonlyNonEmptyArray;\n/**\n * @category constructors\n * @since 2.0.0\n */\nvar of = function (a) { return [a]; };\nexports.of = of;\n/**\n * @since 2.5.1\n */\nvar zipWith = function (as, bs, f) {\n    var cs = [f(as[0], bs[0])];\n    var len = Math.min(as.length, bs.length);\n    for (var i = 1; i < len; i++) {\n        cs[i] = f(as[i], bs[i]);\n    }\n    return cs;\n};\nexports.zipWith = zipWith;\nfunction zip(as, bs) {\n    if (bs === undefined) {\n        return function (bs) { return zip(bs, as); };\n    }\n    return (0, exports.zipWith)(as, bs, function (a, b) { return [a, b]; });\n}\nexports.zip = zip;\n/**\n * @since 2.5.1\n */\nvar unzip = function (abs) {\n    var fa = [abs[0][0]];\n    var fb = [abs[0][1]];\n    for (var i = 1; i < abs.length; i++) {\n        fa[i] = abs[i][0];\n        fb[i] = abs[i][1];\n    }\n    return [fa, fb];\n};\nexports.unzip = unzip;\n/**\n * Prepend an element to every member of an array\n *\n * @example\n * import { prependAll } from 'fp-ts/NonEmptyArray'\n *\n * assert.deepStrictEqual(prependAll(9)([1, 2, 3, 4]), [9, 1, 9, 2, 9, 3, 9, 4])\n *\n * @since 2.10.0\n */\nvar prependAll = function (middle) {\n    return function (as) {\n        var out = [middle, as[0]];\n        for (var i = 1; i < as.length; i++) {\n            out.push(middle, as[i]);\n        }\n        return out;\n    };\n};\nexports.prependAll = prependAll;\n/**\n * Places an element in between members of an array\n *\n * @example\n * import { intersperse } from 'fp-ts/NonEmptyArray'\n *\n * assert.deepStrictEqual(intersperse(9)([1, 2, 3, 4]), [1, 9, 2, 9, 3, 9, 4])\n *\n * @since 2.9.0\n */\nvar intersperse = function (middle) {\n    return function (as) {\n        var rest = (0, exports.tail)(as);\n        return (0, exports.isNonEmpty)(rest) ? (0, function_1.pipe)(rest, (0, exports.prependAll)(middle), (0, exports.prepend)((0, exports.head)(as))) : (0, exports.copy)(as);\n    };\n};\nexports.intersperse = intersperse;\n/**\n * @category folding\n * @since 2.0.0\n */\nexports.foldMapWithIndex = RNEA.foldMapWithIndex;\n/**\n * @category folding\n * @since 2.0.0\n */\nexports.foldMap = RNEA.foldMap;\n/**\n * @category sequencing\n * @since 2.10.0\n */\nvar chainWithIndex = function (f) {\n    return function (as) {\n        var out = (0, exports.fromReadonlyNonEmptyArray)(f(0, (0, exports.head)(as)));\n        for (var i = 1; i < as.length; i++) {\n            out.push.apply(out, f(i, as[i]));\n        }\n        return out;\n    };\n};\nexports.chainWithIndex = chainWithIndex;\n/**\n * @since 2.10.0\n */\nvar chop = function (f) {\n    return function (as) {\n        var _a = f(as), b = _a[0], rest = _a[1];\n        var out = [b];\n        var next = rest;\n        while ((0, exports.isNonEmpty)(next)) {\n            var _b = f(next), b_1 = _b[0], rest_2 = _b[1];\n            out.push(b_1);\n            next = rest_2;\n        }\n        return out;\n    };\n};\nexports.chop = chop;\n/**\n * Splits a `NonEmptyArray` into two pieces, the first piece has max `n` elements.\n *\n * @since 2.10.0\n */\nvar splitAt = function (n) {\n    return function (as) {\n        var m = Math.max(1, n);\n        return m >= as.length ? [(0, exports.copy)(as), []] : [(0, function_1.pipe)(as.slice(1, m), (0, exports.prepend)((0, exports.head)(as))), as.slice(m)];\n    };\n};\nexports.splitAt = splitAt;\n/**\n * @since 2.10.0\n */\nvar chunksOf = function (n) { return (0, exports.chop)((0, exports.splitAt)(n)); };\nexports.chunksOf = chunksOf;\n/* istanbul ignore next */\nvar _map = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.map)(f)); };\n/* istanbul ignore next */\nvar _mapWithIndex = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.mapWithIndex)(f)); };\n/* istanbul ignore next */\nvar _ap = function (fab, fa) { return (0, function_1.pipe)(fab, (0, exports.ap)(fa)); };\n/* istanbul ignore next */\nvar _extend = function (wa, f) { return (0, function_1.pipe)(wa, (0, exports.extend)(f)); };\n/* istanbul ignore next */\nvar _reduce = function (fa, b, f) { return (0, function_1.pipe)(fa, (0, exports.reduce)(b, f)); };\n/* istanbul ignore next */\nvar _foldMap = function (M) {\n    var foldMapM = (0, exports.foldMap)(M);\n    return function (fa, f) { return (0, function_1.pipe)(fa, foldMapM(f)); };\n};\n/* istanbul ignore next */\nvar _reduceRight = function (fa, b, f) { return (0, function_1.pipe)(fa, (0, exports.reduceRight)(b, f)); };\n/* istanbul ignore next */\nvar _traverse = function (F) {\n    var traverseF = (0, exports.traverse)(F);\n    return function (ta, f) { return (0, function_1.pipe)(ta, traverseF(f)); };\n};\n/* istanbul ignore next */\nvar _alt = function (fa, that) { return (0, function_1.pipe)(fa, (0, exports.alt)(that)); };\n/* istanbul ignore next */\nvar _reduceWithIndex = function (fa, b, f) {\n    return (0, function_1.pipe)(fa, (0, exports.reduceWithIndex)(b, f));\n};\n/* istanbul ignore next */\nvar _foldMapWithIndex = function (M) {\n    var foldMapWithIndexM = (0, exports.foldMapWithIndex)(M);\n    return function (fa, f) { return (0, function_1.pipe)(fa, foldMapWithIndexM(f)); };\n};\n/* istanbul ignore next */\nvar _reduceRightWithIndex = function (fa, b, f) {\n    return (0, function_1.pipe)(fa, (0, exports.reduceRightWithIndex)(b, f));\n};\n/* istanbul ignore next */\nvar _traverseWithIndex = function (F) {\n    var traverseWithIndexF = (0, exports.traverseWithIndex)(F);\n    return function (ta, f) { return (0, function_1.pipe)(ta, traverseWithIndexF(f)); };\n};\n/**\n * Less strict version of [`alt`](#alt).\n *\n * The `W` suffix (short for **W**idening) means that the return types will be merged.\n *\n * @example\n * import * as NEA from 'fp-ts/NonEmptyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3] as NEA.NonEmptyArray<number>,\n *     NEA.altW(() => ['a', 'b'])\n *   ),\n *   [1, 2, 3, 'a', 'b']\n * )\n *\n * @category error handling\n * @since 2.9.0\n */\nvar altW = function (that) {\n    return function (as) {\n        return (0, function_1.pipe)(as, concatW(that()));\n    };\n};\nexports.altW = altW;\n/**\n * Identifies an associative operation on a type constructor. It is similar to `Semigroup`, except that it applies to\n * types of kind `* -> *`.\n *\n * In case of `NonEmptyArray` concatenates the inputs into a single array.\n *\n * @example\n * import * as NEA from 'fp-ts/NonEmptyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3],\n *     NEA.alt(() => [4, 5])\n *   ),\n *   [1, 2, 3, 4, 5]\n * )\n *\n * @category error handling\n * @since 2.6.2\n */\nexports.alt = exports.altW;\n/**\n * Apply a function to an argument under a type constructor.\n *\n * @since 2.0.0\n */\nvar ap = function (as) {\n    return (0, exports.flatMap)(function (f) { return (0, function_1.pipe)(as, (0, exports.map)(f)); });\n};\nexports.ap = ap;\n/**\n * @example\n * import * as NEA from 'fp-ts/NonEmptyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3],\n *     NEA.flatMap((n) => [`a${n}`, `b${n}`])\n *   ),\n *   ['a1', 'b1', 'a2', 'b2', 'a3', 'b3']\n * )\n *\n * @category sequencing\n * @since 2.14.0\n */\nexports.flatMap = (0, function_1.dual)(2, function (ma, f) {\n    return (0, function_1.pipe)(ma, (0, exports.chainWithIndex)(function (i, a) { return f(a, i); }));\n});\n/**\n * @since 2.0.0\n */\nvar extend = function (f) {\n    return function (as) {\n        var next = (0, exports.tail)(as);\n        var out = [f(as)];\n        while ((0, exports.isNonEmpty)(next)) {\n            out.push(f(next));\n            next = (0, exports.tail)(next);\n        }\n        return out;\n    };\n};\nexports.extend = extend;\n/**\n * @since 2.5.0\n */\nexports.duplicate = (0, exports.extend)(function_1.identity);\n/**\n * @category sequencing\n * @since 2.5.0\n */\nexports.flatten = (0, exports.flatMap)(function_1.identity);\n/**\n * `map` can be used to turn functions `(a: A) => B` into functions `(fa: F<A>) => F<B>` whose argument and return types\n * use the type constructor `F` to represent some computational context.\n *\n * @category mapping\n * @since 2.0.0\n */\nvar map = function (f) { return (0, exports.mapWithIndex)(function (_, a) { return f(a); }); };\nexports.map = map;\n/**\n * @category mapping\n * @since 2.0.0\n */\nvar mapWithIndex = function (f) {\n    return function (as) {\n        var out = [f(0, (0, exports.head)(as))];\n        for (var i = 1; i < as.length; i++) {\n            out.push(f(i, as[i]));\n        }\n        return out;\n    };\n};\nexports.mapWithIndex = mapWithIndex;\n/**\n * @category folding\n * @since 2.0.0\n */\nexports.reduce = RNEA.reduce;\n/**\n * @category folding\n * @since 2.0.0\n */\nexports.reduceWithIndex = RNEA.reduceWithIndex;\n/**\n * @category folding\n * @since 2.0.0\n */\nexports.reduceRight = RNEA.reduceRight;\n/**\n * @category folding\n * @since 2.0.0\n */\nexports.reduceRightWithIndex = RNEA.reduceRightWithIndex;\n/**\n * @category traversing\n * @since 2.6.3\n */\nvar traverse = function (F) {\n    var traverseWithIndexF = (0, exports.traverseWithIndex)(F);\n    return function (f) { return traverseWithIndexF(function (_, a) { return f(a); }); };\n};\nexports.traverse = traverse;\n/**\n * @category traversing\n * @since 2.6.3\n */\nvar sequence = function (F) { return (0, exports.traverseWithIndex)(F)(function (_, a) { return a; }); };\nexports.sequence = sequence;\n/**\n * @category sequencing\n * @since 2.6.3\n */\nvar traverseWithIndex = function (F) {\n    return function (f) {\n        return function (as) {\n            var out = F.map(f(0, (0, exports.head)(as)), exports.of);\n            for (var i = 1; i < as.length; i++) {\n                out = F.ap(F.map(out, function (bs) { return function (b) { return (0, function_1.pipe)(bs, (0, exports.append)(b)); }; }), f(i, as[i]));\n            }\n            return out;\n        };\n    };\n};\nexports.traverseWithIndex = traverseWithIndex;\n/**\n * @since 2.7.0\n */\nexports.extract = RNEA.head;\n/**\n * @category type lambdas\n * @since 2.0.0\n */\nexports.URI = 'NonEmptyArray';\n/**\n * @category instances\n * @since 2.0.0\n */\nexports.getShow = RNEA.getShow;\n/**\n * Builds a `Semigroup` instance for `NonEmptyArray`\n *\n * @category instances\n * @since 2.0.0\n */\nvar getSemigroup = function () { return ({\n    concat: concat\n}); };\nexports.getSemigroup = getSemigroup;\n/**\n * @example\n * import { getEq } from 'fp-ts/NonEmptyArray'\n * import * as N from 'fp-ts/number'\n *\n * const E = getEq(N.Eq)\n * assert.strictEqual(E.equals([1, 2], [1, 2]), true)\n * assert.strictEqual(E.equals([1, 2], [1, 3]), false)\n *\n * @category instances\n * @since 2.0.0\n */\nexports.getEq = RNEA.getEq;\n/**\n * @since 2.11.0\n */\nvar getUnionSemigroup = function (E) {\n    var unionE = (0, exports.union)(E);\n    return {\n        concat: function (first, second) { return unionE(second)(first); }\n    };\n};\nexports.getUnionSemigroup = getUnionSemigroup;\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Functor = {\n    URI: exports.URI,\n    map: _map\n};\n/**\n * @category mapping\n * @since 2.10.0\n */\nexports.flap = (0, Functor_1.flap)(exports.Functor);\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Pointed = {\n    URI: exports.URI,\n    of: exports.of\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.FunctorWithIndex = {\n    URI: exports.URI,\n    map: _map,\n    mapWithIndex: _mapWithIndex\n};\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Apply = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap\n};\n/**\n * Combine two effectful actions, keeping only the result of the first.\n *\n * @since 2.5.0\n */\nexports.apFirst = (0, Apply_1.apFirst)(exports.Apply);\n/**\n * Combine two effectful actions, keeping only the result of the second.\n *\n * @since 2.5.0\n */\nexports.apSecond = (0, Apply_1.apSecond)(exports.Apply);\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Applicative = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    of: exports.of\n};\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Chain = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    chain: exports.flatMap\n};\n/**\n * Composes computations in sequence, using the return value of one computation to determine the next computation and\n * keeping only the result of the first.\n *\n * @category sequencing\n * @since 2.5.0\n */\nexports.chainFirst = \n/*#__PURE__*/ (0, Chain_1.chainFirst)(exports.Chain);\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Monad = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    of: exports.of,\n    chain: exports.flatMap\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Foldable = {\n    URI: exports.URI,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.FoldableWithIndex = {\n    URI: exports.URI,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    reduceWithIndex: _reduceWithIndex,\n    foldMapWithIndex: _foldMapWithIndex,\n    reduceRightWithIndex: _reduceRightWithIndex\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Traversable = {\n    URI: exports.URI,\n    map: _map,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    traverse: _traverse,\n    sequence: exports.sequence\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.TraversableWithIndex = {\n    URI: exports.URI,\n    map: _map,\n    mapWithIndex: _mapWithIndex,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    traverse: _traverse,\n    sequence: exports.sequence,\n    reduceWithIndex: _reduceWithIndex,\n    foldMapWithIndex: _foldMapWithIndex,\n    reduceRightWithIndex: _reduceRightWithIndex,\n    traverseWithIndex: _traverseWithIndex\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Alt = {\n    URI: exports.URI,\n    map: _map,\n    alt: _alt\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Comonad = {\n    URI: exports.URI,\n    map: _map,\n    extend: _extend,\n    extract: exports.extract\n};\n// -------------------------------------------------------------------------------------\n// do notation\n// -------------------------------------------------------------------------------------\n/**\n * @category do notation\n * @since 2.9.0\n */\nexports.Do = (0, exports.of)(_.emptyRecord);\n/**\n * @category do notation\n * @since 2.8.0\n */\nexports.bindTo = (0, Functor_1.bindTo)(exports.Functor);\nvar let_ = /*#__PURE__*/ (0, Functor_1.let)(exports.Functor);\nexports.let = let_;\n/**\n * @category do notation\n * @since 2.8.0\n */\nexports.bind = (0, Chain_1.bind)(exports.Chain);\n/**\n * @category do notation\n * @since 2.8.0\n */\nexports.apS = (0, Apply_1.apS)(exports.Apply);\n// -------------------------------------------------------------------------------------\n// utils\n// -------------------------------------------------------------------------------------\n/**\n * @since 2.0.0\n */\nexports.head = RNEA.head;\n/**\n * @since 2.0.0\n */\nvar tail = function (as) { return as.slice(1); };\nexports.tail = tail;\n/**\n * @since 2.0.0\n */\nexports.last = RNEA.last;\n/**\n * Get all but the last element of a non empty array, creating a new array.\n *\n * @example\n * import { init } from 'fp-ts/NonEmptyArray'\n *\n * assert.deepStrictEqual(init([1, 2, 3]), [1, 2])\n * assert.deepStrictEqual(init([1]), [])\n *\n * @since 2.2.0\n */\nvar init = function (as) { return as.slice(0, -1); };\nexports.init = init;\n/**\n * @since 2.0.0\n */\nexports.min = RNEA.min;\n/**\n * @since 2.0.0\n */\nexports.max = RNEA.max;\n/**\n * @since 2.10.0\n */\nvar concatAll = function (S) {\n    return function (as) {\n        return as.reduce(S.concat);\n    };\n};\nexports.concatAll = concatAll;\n/**\n * Break an `Array` into its first element and remaining elements.\n *\n * @category pattern matching\n * @since 2.11.0\n */\nvar matchLeft = function (f) {\n    return function (as) {\n        return f((0, exports.head)(as), (0, exports.tail)(as));\n    };\n};\nexports.matchLeft = matchLeft;\n/**\n * Break an `Array` into its initial elements and the last element.\n *\n * @category pattern matching\n * @since 2.11.0\n */\nvar matchRight = function (f) {\n    return function (as) {\n        return f((0, exports.init)(as), (0, exports.last)(as));\n    };\n};\nexports.matchRight = matchRight;\n/**\n * Apply a function to the head, creating a new `NonEmptyArray`.\n *\n * @since 2.11.0\n */\nvar modifyHead = function (f) {\n    return function (as) {\n        return __spreadArray([f((0, exports.head)(as))], (0, exports.tail)(as), true);\n    };\n};\nexports.modifyHead = modifyHead;\n/**\n * Change the head, creating a new `NonEmptyArray`.\n *\n * @since 2.11.0\n */\nvar updateHead = function (a) { return (0, exports.modifyHead)(function () { return a; }); };\nexports.updateHead = updateHead;\n/**\n * Apply a function to the last element, creating a new `NonEmptyArray`.\n *\n * @since 2.11.0\n */\nvar modifyLast = function (f) {\n    return function (as) {\n        return (0, function_1.pipe)((0, exports.init)(as), (0, exports.append)(f((0, exports.last)(as))));\n    };\n};\nexports.modifyLast = modifyLast;\n/**\n * Change the last element, creating a new `NonEmptyArray`.\n *\n * @since 2.11.0\n */\nvar updateLast = function (a) { return (0, exports.modifyLast)(function () { return a; }); };\nexports.updateLast = updateLast;\n/**\n * Places an element in between members of a `NonEmptyArray`, then folds the results using the provided `Semigroup`.\n *\n * @example\n * import * as S from 'fp-ts/string'\n * import { intercalate } from 'fp-ts/NonEmptyArray'\n *\n * assert.deepStrictEqual(intercalate(S.Semigroup)('-')(['a', 'b', 'c']), 'a-b-c')\n *\n * @since 2.12.0\n */\nexports.intercalate = RNEA.intercalate;\n// -------------------------------------------------------------------------------------\n// legacy\n// -------------------------------------------------------------------------------------\n/**\n * Alias of `flatMap`.\n *\n * @category legacy\n * @since 2.0.0\n */\nexports.chain = exports.flatMap;\nfunction groupSort(O) {\n    var sortO = (0, exports.sort)(O);\n    var groupO = group(O);\n    return function (as) { return ((0, exports.isNonEmpty)(as) ? groupO(sortO(as)) : []); };\n}\nexports.groupSort = groupSort;\nfunction filter(predicate) {\n    return (0, exports.filterWithIndex)(function (_, a) { return predicate(a); });\n}\nexports.filter = filter;\n/**\n * Use [`filterWithIndex`](./Array.ts.html#filterwithindex) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nvar filterWithIndex = function (predicate) {\n    return function (as) {\n        return (0, exports.fromArray)(as.filter(function (a, i) { return predicate(i, a); }));\n    };\n};\nexports.filterWithIndex = filterWithIndex;\n/**\n * Use [`unprepend`](#unprepend) instead.\n *\n * @category zone of death\n * @since 2.9.0\n * @deprecated\n */\nexports.uncons = exports.unprepend;\n/**\n * Use [`unappend`](#unappend) instead.\n *\n * @category zone of death\n * @since 2.9.0\n * @deprecated\n */\nexports.unsnoc = exports.unappend;\nfunction cons(head, tail) {\n    return tail === undefined ? (0, exports.prepend)(head) : (0, function_1.pipe)(tail, (0, exports.prepend)(head));\n}\nexports.cons = cons;\n/**\n * Use [`append`](./Array.ts.html#append) instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nvar snoc = function (init, end) { return (0, function_1.pipe)(init, (0, exports.append)(end)); };\nexports.snoc = snoc;\n/**\n * Use [`prependAll`](#prependall) instead.\n *\n * @category zone of death\n * @since 2.9.0\n * @deprecated\n */\nexports.prependToAll = exports.prependAll;\n/**\n * Use [`concatAll`](#concatall) instead.\n *\n * @category zone of death\n * @since 2.5.0\n * @deprecated\n */\nexports.fold = RNEA.concatAll;\n/**\n * This instance is deprecated, use small, specific instances instead.\n * For example if a function needs a `Functor` instance, pass `NEA.Functor` instead of `NEA.nonEmptyArray`\n * (where `NEA` is from `import NEA from 'fp-ts/NonEmptyArray'`)\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.nonEmptyArray = {\n    URI: exports.URI,\n    of: exports.of,\n    map: _map,\n    mapWithIndex: _mapWithIndex,\n    ap: _ap,\n    chain: exports.flatMap,\n    extend: _extend,\n    extract: exports.extract,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    traverse: _traverse,\n    sequence: exports.sequence,\n    reduceWithIndex: _reduceWithIndex,\n    foldMapWithIndex: _foldMapWithIndex,\n    reduceRightWithIndex: _reduceRightWithIndex,\n    traverseWithIndex: _traverseWithIndex,\n    alt: _alt\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Field = exports.MonoidProduct = exports.MonoidSum = exports.SemigroupProduct = exports.SemigroupSum = exports.MagmaSub = exports.Show = exports.Bounded = exports.Ord = exports.Eq = exports.isNumber = void 0;\n// -------------------------------------------------------------------------------------\n// refinements\n// -------------------------------------------------------------------------------------\n/**\n * @category refinements\n * @since 2.11.0\n */\nvar isNumber = function (u) { return typeof u === 'number'; };\nexports.isNumber = isNumber;\n// -------------------------------------------------------------------------------------\n// instances\n// -------------------------------------------------------------------------------------\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Eq = {\n    equals: function (first, second) { return first === second; }\n};\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Ord = {\n    equals: exports.Eq.equals,\n    compare: function (first, second) { return (first < second ? -1 : first > second ? 1 : 0); }\n};\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Bounded = {\n    equals: exports.Eq.equals,\n    compare: exports.Ord.compare,\n    top: Infinity,\n    bottom: -Infinity\n};\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Show = {\n    show: function (n) { return JSON.stringify(n); }\n};\n/**\n * @category instances\n * @since 2.11.0\n */\nexports.MagmaSub = {\n    concat: function (first, second) { return first - second; }\n};\n/**\n * `number` semigroup under addition.\n *\n * @example\n * import { SemigroupSum } from 'fp-ts/number'\n *\n * assert.deepStrictEqual(SemigroupSum.concat(2, 3), 5)\n *\n * @category instances\n * @since 2.10.0\n */\nexports.SemigroupSum = {\n    concat: function (first, second) { return first + second; }\n};\n/**\n * `number` semigroup under multiplication.\n *\n * @example\n * import { SemigroupProduct } from 'fp-ts/number'\n *\n * assert.deepStrictEqual(SemigroupProduct.concat(2, 3), 6)\n *\n * @category instances\n * @since 2.10.0\n */\nexports.SemigroupProduct = {\n    concat: function (first, second) { return first * second; }\n};\n/**\n * `number` monoid under addition.\n *\n * The `empty` value is `0`.\n *\n * @example\n * import { MonoidSum } from 'fp-ts/number'\n *\n * assert.deepStrictEqual(MonoidSum.concat(2, MonoidSum.empty), 2)\n *\n * @category instances\n * @since 2.10.0\n */\nexports.MonoidSum = {\n    concat: exports.SemigroupSum.concat,\n    empty: 0\n};\n/**\n * `number` monoid under multiplication.\n *\n * The `empty` value is `1`.\n *\n * @example\n * import { MonoidProduct } from 'fp-ts/number'\n *\n * assert.deepStrictEqual(MonoidProduct.concat(2, MonoidProduct.empty), 2)\n *\n * @category instances\n * @since 2.10.0\n */\nexports.MonoidProduct = {\n    concat: exports.SemigroupProduct.concat,\n    empty: 1\n};\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Field = {\n    add: exports.SemigroupSum.concat,\n    zero: 0,\n    mul: exports.SemigroupProduct.concat,\n    one: 1,\n    sub: exports.MagmaSub.concat,\n    degree: function (_) { return 1; },\n    div: function (first, second) { return first / second; },\n    mod: function (first, second) { return first % second; }\n};\n","\"use strict\";\n/**\n * ```ts\n * interface Separated<E, A> {\n *    readonly left: E\n *    readonly right: A\n * }\n * ```\n *\n * Represents a result of separating a whole into two parts.\n *\n * @since 2.10.0\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.right = exports.left = exports.flap = exports.Functor = exports.Bifunctor = exports.URI = exports.bimap = exports.mapLeft = exports.map = exports.separated = void 0;\nvar function_1 = require(\"./function\");\nvar Functor_1 = require(\"./Functor\");\n// -------------------------------------------------------------------------------------\n// constructors\n// -------------------------------------------------------------------------------------\n/**\n * @category constructors\n * @since 2.10.0\n */\nvar separated = function (left, right) { return ({ left: left, right: right }); };\nexports.separated = separated;\nvar _map = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.map)(f)); };\nvar _mapLeft = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.mapLeft)(f)); };\nvar _bimap = function (fa, g, f) { return (0, function_1.pipe)(fa, (0, exports.bimap)(g, f)); };\n/**\n * `map` can be used to turn functions `(a: A) => B` into functions `(fa: F<A>) => F<B>` whose argument and return types\n * use the type constructor `F` to represent some computational context.\n *\n * @category mapping\n * @since 2.10.0\n */\nvar map = function (f) {\n    return function (fa) {\n        return (0, exports.separated)((0, exports.left)(fa), f((0, exports.right)(fa)));\n    };\n};\nexports.map = map;\n/**\n * Map a function over the first type argument of a bifunctor.\n *\n * @category error handling\n * @since 2.10.0\n */\nvar mapLeft = function (f) {\n    return function (fa) {\n        return (0, exports.separated)(f((0, exports.left)(fa)), (0, exports.right)(fa));\n    };\n};\nexports.mapLeft = mapLeft;\n/**\n * Map a pair of functions over the two type arguments of the bifunctor.\n *\n * @category mapping\n * @since 2.10.0\n */\nvar bimap = function (f, g) {\n    return function (fa) {\n        return (0, exports.separated)(f((0, exports.left)(fa)), g((0, exports.right)(fa)));\n    };\n};\nexports.bimap = bimap;\n/**\n * @category type lambdas\n * @since 2.10.0\n */\nexports.URI = 'Separated';\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Bifunctor = {\n    URI: exports.URI,\n    mapLeft: _mapLeft,\n    bimap: _bimap\n};\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Functor = {\n    URI: exports.URI,\n    map: _map\n};\n/**\n * @category mapping\n * @since 2.10.0\n */\nexports.flap = (0, Functor_1.flap)(exports.Functor);\n// -------------------------------------------------------------------------------------\n// utils\n// -------------------------------------------------------------------------------------\n/**\n * @since 2.10.0\n */\nvar left = function (s) { return s.left; };\nexports.left = left;\n/**\n * @since 2.10.0\n */\nvar right = function (s) { return s.right; };\nexports.right = right;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.filterE = exports.witherDefault = exports.wiltDefault = void 0;\nvar _ = __importStar(require(\"./internal\"));\nfunction wiltDefault(T, C) {\n    return function (F) {\n        var traverseF = T.traverse(F);\n        return function (wa, f) { return F.map(traverseF(wa, f), C.separate); };\n    };\n}\nexports.wiltDefault = wiltDefault;\nfunction witherDefault(T, C) {\n    return function (F) {\n        var traverseF = T.traverse(F);\n        return function (wa, f) { return F.map(traverseF(wa, f), C.compact); };\n    };\n}\nexports.witherDefault = witherDefault;\nfunction filterE(W) {\n    return function (F) {\n        var witherF = W.wither(F);\n        return function (predicate) { return function (ga) { return witherF(ga, function (a) { return F.map(predicate(a), function (b) { return (b ? _.some(a) : _.none); }); }); }; };\n    };\n}\nexports.filterE = filterE;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.guard = void 0;\nfunction guard(F, P) {\n    return function (b) { return (b ? P.of(undefined) : F.zero()); };\n}\nexports.guard = guard;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.sort = exports.lefts = exports.rights = exports.reverse = exports.modifyAt = exports.deleteAt = exports.updateAt = exports.insertAt = exports.findLastIndex = exports.findLastMap = exports.findLast = exports.findFirstMap = exports.findFirst = exports.findIndex = exports.dropLeftWhile = exports.dropRight = exports.dropLeft = exports.spanLeft = exports.takeLeftWhile = exports.takeRight = exports.takeLeft = exports.init = exports.tail = exports.last = exports.head = exports.lookup = exports.isOutOfBound = exports.size = exports.scanRight = exports.scanLeft = exports.chainWithIndex = exports.foldRight = exports.matchRight = exports.matchRightW = exports.foldLeft = exports.matchLeft = exports.matchLeftW = exports.match = exports.matchW = exports.fromEither = exports.fromOption = exports.fromPredicate = exports.replicate = exports.makeBy = exports.appendW = exports.append = exports.prependW = exports.prepend = exports.isNonEmpty = exports.isEmpty = void 0;\nexports.sequence = exports.traverse = exports.reduceRightWithIndex = exports.reduceRight = exports.reduceWithIndex = exports.foldMap = exports.reduce = exports.foldMapWithIndex = exports.duplicate = exports.extend = exports.filterWithIndex = exports.partitionMapWithIndex = exports.partitionMap = exports.partitionWithIndex = exports.partition = exports.compact = exports.filterMap = exports.filterMapWithIndex = exports.filter = exports.separate = exports.mapWithIndex = exports.map = exports.flatten = exports.flatMap = exports.ap = exports.alt = exports.altW = exports.zero = exports.of = exports._chainRecBreadthFirst = exports._chainRecDepthFirst = exports.difference = exports.intersection = exports.union = exports.concat = exports.concatW = exports.comprehension = exports.fromOptionK = exports.chunksOf = exports.splitAt = exports.chop = exports.sortBy = exports.uniq = exports.elem = exports.rotate = exports.intersperse = exports.prependAll = exports.unzip = exports.zip = exports.zipWith = void 0;\nexports.toArray = exports.unsafeDeleteAt = exports.unsafeUpdateAt = exports.unsafeInsertAt = exports.fromEitherK = exports.FromEither = exports.filterE = exports.Witherable = exports.ChainRecBreadthFirst = exports.chainRecBreadthFirst = exports.ChainRecDepthFirst = exports.chainRecDepthFirst = exports.TraversableWithIndex = exports.Traversable = exports.FoldableWithIndex = exports.Foldable = exports.FilterableWithIndex = exports.Filterable = exports.Compactable = exports.Extend = exports.Alternative = exports.guard = exports.Zero = exports.Alt = exports.Unfoldable = exports.chainFirst = exports.Monad = exports.Chain = exports.Applicative = exports.apSecond = exports.apFirst = exports.Apply = exports.FunctorWithIndex = exports.Pointed = exports.flap = exports.Functor = exports.getDifferenceMagma = exports.getIntersectionSemigroup = exports.getUnionMonoid = exports.getUnionSemigroup = exports.getOrd = exports.getEq = exports.getMonoid = exports.getSemigroup = exports.getShow = exports.URI = exports.unfold = exports.wilt = exports.wither = exports.traverseWithIndex = void 0;\nexports.readonlyArray = exports.prependToAll = exports.snoc = exports.cons = exports.range = exports.chain = exports.apS = exports.bind = exports.let = exports.bindTo = exports.Do = exports.intercalate = exports.exists = exports.some = exports.every = exports.empty = exports.fromArray = void 0;\nvar Apply_1 = require(\"./Apply\");\nvar Chain_1 = require(\"./Chain\");\nvar Eq_1 = require(\"./Eq\");\nvar FromEither_1 = require(\"./FromEither\");\nvar function_1 = require(\"./function\");\nvar Functor_1 = require(\"./Functor\");\nvar _ = __importStar(require(\"./internal\"));\nvar N = __importStar(require(\"./number\"));\nvar Ord_1 = require(\"./Ord\");\nvar RNEA = __importStar(require(\"./ReadonlyNonEmptyArray\"));\nvar Separated_1 = require(\"./Separated\");\nvar Witherable_1 = require(\"./Witherable\");\nvar Zero_1 = require(\"./Zero\");\n// -------------------------------------------------------------------------------------\n// refinements\n// -------------------------------------------------------------------------------------\n/**\n * Test whether a `ReadonlyArray` is empty.\n *\n * @example\n * import { isEmpty } from 'fp-ts/ReadonlyArray'\n *\n * assert.strictEqual(isEmpty([]), true)\n *\n * @category refinements\n * @since 2.5.0\n */\nvar isEmpty = function (as) { return as.length === 0; };\nexports.isEmpty = isEmpty;\n/**\n * Test whether a `ReadonlyArray` is non empty.\n *\n * @category refinements\n * @since 2.5.0\n */\nexports.isNonEmpty = RNEA.isNonEmpty;\n// -------------------------------------------------------------------------------------\n// constructors\n// -------------------------------------------------------------------------------------\n/**\n * Prepend an element to the front of a `ReadonlyArray`, creating a new `ReadonlyNonEmptyArray`.\n *\n * @example\n * import { prepend } from 'fp-ts/ReadonlyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe([2, 3, 4], prepend(1)), [1, 2, 3, 4])\n *\n * @since 2.10.0\n */\nexports.prepend = RNEA.prepend;\n/**\n * Less strict version of [`prepend`](#prepend).\n *\n * @since 2.11.0\n */\nexports.prependW = RNEA.prependW;\n/**\n * Append an element to the end of a `ReadonlyArray`, creating a new `ReadonlyNonEmptyArray`.\n *\n * @example\n * import { append } from 'fp-ts/ReadonlyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe([1, 2, 3], append(4)), [1, 2, 3, 4])\n *\n * @since 2.10.0\n */\nexports.append = RNEA.append;\n/**\n * Less strict version of [`append`](#append).\n *\n * @since 2.11.0\n */\nexports.appendW = RNEA.appendW;\n/**\n * Return a `ReadonlyArray` of length `n` with element `i` initialized with `f(i)`.\n *\n * **Note**. `n` is normalized to a non negative integer.\n *\n * @example\n * import { makeBy } from 'fp-ts/ReadonlyArray'\n *\n * const double = (n: number): number => n * 2\n * assert.deepStrictEqual(makeBy(5, double), [0, 2, 4, 6, 8])\n *\n * @category constructors\n * @since 2.5.0\n */\nvar makeBy = function (n, f) { return (n <= 0 ? exports.empty : RNEA.makeBy(f)(n)); };\nexports.makeBy = makeBy;\n/**\n * Create a `ReadonlyArray` containing a value repeated the specified number of times.\n *\n * **Note**. `n` is normalized to a non negative integer.\n *\n * @example\n * import { replicate } from 'fp-ts/ReadonlyArray'\n *\n * assert.deepStrictEqual(replicate(3, 'a'), ['a', 'a', 'a'])\n *\n * @category constructors\n * @since 2.5.0\n */\nvar replicate = function (n, a) { return (0, exports.makeBy)(n, function () { return a; }); };\nexports.replicate = replicate;\nfunction fromPredicate(predicate) {\n    return function (a) { return (predicate(a) ? [a] : exports.empty); };\n}\nexports.fromPredicate = fromPredicate;\n// -------------------------------------------------------------------------------------\n// conversions\n// -------------------------------------------------------------------------------------\n/**\n * @category conversions\n * @since 2.11.0\n */\nvar fromOption = function (ma) { return (_.isNone(ma) ? exports.empty : [ma.value]); };\nexports.fromOption = fromOption;\n/**\n * Transforms an `Either` to a `ReadonlyArray`.\n *\n * @category conversions\n * @since 2.11.0\n */\nvar fromEither = function (e) { return (_.isLeft(e) ? exports.empty : [e.right]); };\nexports.fromEither = fromEither;\n/**\n * Less strict version of [`match`](#match).\n *\n * The `W` suffix (short for **W**idening) means that the handler return types will be merged.\n *\n * @category pattern matching\n * @since 2.11.0\n */\nvar matchW = function (onEmpty, onNonEmpty) {\n    return function (as) {\n        return (0, exports.isNonEmpty)(as) ? onNonEmpty(as) : onEmpty();\n    };\n};\nexports.matchW = matchW;\n/**\n * @category pattern matching\n * @since 2.11.0\n */\nexports.match = exports.matchW;\n/**\n * Less strict version of [`matchLeft`](#matchleft).\n *\n * @category pattern matching\n * @since 2.11.0\n */\nvar matchLeftW = function (onEmpty, onNonEmpty) {\n    return function (as) {\n        return (0, exports.isNonEmpty)(as) ? onNonEmpty(RNEA.head(as), RNEA.tail(as)) : onEmpty();\n    };\n};\nexports.matchLeftW = matchLeftW;\n/**\n * Break a `ReadonlyArray` into its first element and remaining elements.\n *\n * @example\n * import { matchLeft } from 'fp-ts/ReadonlyArray'\n *\n * const len: <A>(as: ReadonlyArray<A>) => number = matchLeft(() => 0, (_, tail) => 1 + len(tail))\n * assert.strictEqual(len([1, 2, 3]), 3)\n *\n * @category pattern matching\n * @since 2.10.0\n */\nexports.matchLeft = exports.matchLeftW;\n/**\n * Alias of [`matchLeft`](#matchleft).\n *\n * @category pattern matching\n * @since 2.5.0\n */\nexports.foldLeft = exports.matchLeft;\n/**\n * Less strict version of [`matchRight`](#matchright).\n *\n * @category pattern matching\n * @since 2.11.0\n */\nvar matchRightW = function (onEmpty, onNonEmpty) {\n    return function (as) {\n        return (0, exports.isNonEmpty)(as) ? onNonEmpty(RNEA.init(as), RNEA.last(as)) : onEmpty();\n    };\n};\nexports.matchRightW = matchRightW;\n/**\n * Break a `ReadonlyArray` into its initial elements and the last element.\n *\n * @category pattern matching\n * @since 2.10.0\n */\nexports.matchRight = exports.matchRightW;\n/**\n * Alias of [`matchRight`](#matchright).\n *\n * @category pattern matching\n * @since 2.5.0\n */\nexports.foldRight = exports.matchRight;\n// -------------------------------------------------------------------------------------\n// combinators\n// -------------------------------------------------------------------------------------\n/**\n * @category sequencing\n * @since 2.7.0\n */\nvar chainWithIndex = function (f) {\n    return function (as) {\n        if ((0, exports.isEmpty)(as)) {\n            return exports.empty;\n        }\n        var out = [];\n        for (var i = 0; i < as.length; i++) {\n            out.push.apply(out, f(i, as[i]));\n        }\n        return out;\n    };\n};\nexports.chainWithIndex = chainWithIndex;\n/**\n * Same as `reduce` but it carries over the intermediate steps.\n *\n * @example\n * import { scanLeft } from 'fp-ts/ReadonlyArray'\n *\n * assert.deepStrictEqual(scanLeft(10, (b, a: number) => b - a)([1, 2, 3]), [10, 9, 7, 4])\n *\n * @since 2.5.0\n */\nvar scanLeft = function (b, f) {\n    return function (as) {\n        var len = as.length;\n        var out = new Array(len + 1);\n        out[0] = b;\n        for (var i = 0; i < len; i++) {\n            out[i + 1] = f(out[i], as[i]);\n        }\n        return out;\n    };\n};\nexports.scanLeft = scanLeft;\n/**\n * Fold an array from the right, keeping all intermediate results instead of only the final result\n *\n * @example\n * import { scanRight } from 'fp-ts/ReadonlyArray'\n *\n * assert.deepStrictEqual(scanRight(10, (a: number, b) => b - a)([1, 2, 3]), [4, 5, 7, 10])\n *\n * @since 2.5.0\n */\nvar scanRight = function (b, f) {\n    return function (as) {\n        var len = as.length;\n        var out = new Array(len + 1);\n        out[len] = b;\n        for (var i = len - 1; i >= 0; i--) {\n            out[i] = f(as[i], out[i + 1]);\n        }\n        return out;\n    };\n};\nexports.scanRight = scanRight;\n/**\n * Calculate the number of elements in a `ReadonlyArray`.\n *\n * @since 2.10.0\n */\nvar size = function (as) { return as.length; };\nexports.size = size;\n/**\n * Test whether an array contains a particular index\n *\n * @since 2.5.0\n */\nexports.isOutOfBound = RNEA.isOutOfBound;\nfunction lookup(i, as) {\n    return as === undefined ? function (as) { return lookup(i, as); } : (0, exports.isOutOfBound)(i, as) ? _.none : _.some(as[i]);\n}\nexports.lookup = lookup;\n/**\n * Get the first element in an array, or `None` if the array is empty\n *\n * @example\n * import { head } from 'fp-ts/ReadonlyArray'\n * import { some, none } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(head([1, 2, 3]), some(1))\n * assert.deepStrictEqual(head([]), none)\n *\n * @since 2.5.0\n */\nvar head = function (as) { return ((0, exports.isNonEmpty)(as) ? _.some(RNEA.head(as)) : _.none); };\nexports.head = head;\n/**\n * Get the last element in an array, or `None` if the array is empty\n *\n * @example\n * import { last } from 'fp-ts/ReadonlyArray'\n * import { some, none } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(last([1, 2, 3]), some(3))\n * assert.deepStrictEqual(last([]), none)\n *\n * @since 2.5.0\n */\nvar last = function (as) { return ((0, exports.isNonEmpty)(as) ? _.some(RNEA.last(as)) : _.none); };\nexports.last = last;\n/**\n * Get all but the first element of an array, creating a new array, or `None` if the array is empty\n *\n * @example\n * import { tail } from 'fp-ts/ReadonlyArray'\n * import { some, none } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(tail([1, 2, 3]), some([2, 3]))\n * assert.deepStrictEqual(tail([]), none)\n *\n * @since 2.5.0\n */\nvar tail = function (as) {\n    return (0, exports.isNonEmpty)(as) ? _.some(RNEA.tail(as)) : _.none;\n};\nexports.tail = tail;\n/**\n * Get all but the last element of an array, creating a new array, or `None` if the array is empty\n *\n * @example\n * import { init } from 'fp-ts/ReadonlyArray'\n * import { some, none } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(init([1, 2, 3]), some([1, 2]))\n * assert.deepStrictEqual(init([]), none)\n *\n * @since 2.5.0\n */\nvar init = function (as) {\n    return (0, exports.isNonEmpty)(as) ? _.some(RNEA.init(as)) : _.none;\n};\nexports.init = init;\n/**\n * Keep only a max number of elements from the start of an `ReadonlyArray`, creating a new `ReadonlyArray`.\n *\n * **Note**. `n` is normalized to a non negative integer.\n *\n * @example\n * import * as RA from 'fp-ts/ReadonlyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * const input: ReadonlyArray<number> = [1, 2, 3]\n * assert.deepStrictEqual(pipe(input, RA.takeLeft(2)), [1, 2])\n *\n * // out of bounds\n * assert.strictEqual(pipe(input, RA.takeLeft(4)), input)\n * assert.strictEqual(pipe(input, RA.takeLeft(-1)), input)\n *\n * @since 2.5.0\n */\nvar takeLeft = function (n) {\n    return function (as) {\n        return (0, exports.isOutOfBound)(n, as) ? as : n === 0 ? exports.empty : as.slice(0, n);\n    };\n};\nexports.takeLeft = takeLeft;\n/**\n * Keep only a max number of elements from the end of an `ReadonlyArray`, creating a new `ReadonlyArray`.\n *\n * **Note**. `n` is normalized to a non negative integer.\n *\n * @example\n * import * as RA from 'fp-ts/ReadonlyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * const input: ReadonlyArray<number> = [1, 2, 3]\n * assert.deepStrictEqual(pipe(input, RA.takeRight(2)), [2, 3])\n *\n * // out of bounds\n * assert.strictEqual(pipe(input, RA.takeRight(4)), input)\n * assert.strictEqual(pipe(input, RA.takeRight(-1)), input)\n *\n * @since 2.5.0\n */\nvar takeRight = function (n) {\n    return function (as) {\n        return (0, exports.isOutOfBound)(n, as) ? as : n === 0 ? exports.empty : as.slice(-n);\n    };\n};\nexports.takeRight = takeRight;\nfunction takeLeftWhile(predicate) {\n    return function (as) {\n        var out = [];\n        for (var _i = 0, as_1 = as; _i < as_1.length; _i++) {\n            var a = as_1[_i];\n            if (!predicate(a)) {\n                break;\n            }\n            out.push(a);\n        }\n        var len = out.length;\n        return len === as.length ? as : len === 0 ? exports.empty : out;\n    };\n}\nexports.takeLeftWhile = takeLeftWhile;\nvar spanLeftIndex = function (as, predicate) {\n    var l = as.length;\n    var i = 0;\n    for (; i < l; i++) {\n        if (!predicate(as[i])) {\n            break;\n        }\n    }\n    return i;\n};\nfunction spanLeft(predicate) {\n    return function (as) {\n        var _a = (0, exports.splitAt)(spanLeftIndex(as, predicate))(as), init = _a[0], rest = _a[1];\n        return { init: init, rest: rest };\n    };\n}\nexports.spanLeft = spanLeft;\n/**\n * Drop a max number of elements from the start of an `ReadonlyArray`, creating a new `ReadonlyArray`.\n *\n * **Note**. `n` is normalized to a non negative integer.\n *\n * @example\n * import * as RA from 'fp-ts/ReadonlyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * const input: ReadonlyArray<number> = [1, 2, 3]\n * assert.deepStrictEqual(pipe(input, RA.dropLeft(2)), [3])\n * assert.strictEqual(pipe(input, RA.dropLeft(0)), input)\n * assert.strictEqual(pipe(input, RA.dropLeft(-1)), input)\n *\n * @since 2.5.0\n */\nvar dropLeft = function (n) {\n    return function (as) {\n        return n <= 0 || (0, exports.isEmpty)(as) ? as : n >= as.length ? exports.empty : as.slice(n, as.length);\n    };\n};\nexports.dropLeft = dropLeft;\n/**\n * Drop a max number of elements from the end of an `ReadonlyArray`, creating a new `ReadonlyArray`.\n *\n * **Note**. `n` is normalized to a non negative integer.\n *\n * @example\n * import * as RA from 'fp-ts/ReadonlyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * const input: ReadonlyArray<number> = [1, 2, 3]\n * assert.deepStrictEqual(pipe(input, RA.dropRight(2)), [1])\n * assert.strictEqual(pipe(input, RA.dropRight(0)), input)\n * assert.strictEqual(pipe(input, RA.dropRight(-1)), input)\n *\n * @since 2.5.0\n */\nvar dropRight = function (n) {\n    return function (as) {\n        return n <= 0 || (0, exports.isEmpty)(as) ? as : n >= as.length ? exports.empty : as.slice(0, as.length - n);\n    };\n};\nexports.dropRight = dropRight;\nfunction dropLeftWhile(predicate) {\n    return function (as) {\n        var i = spanLeftIndex(as, predicate);\n        return i === 0 ? as : i === as.length ? exports.empty : as.slice(i);\n    };\n}\nexports.dropLeftWhile = dropLeftWhile;\n/**\n * Find the first index for which a predicate holds\n *\n * @example\n * import { findIndex } from 'fp-ts/ReadonlyArray'\n * import { some, none } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(findIndex((n: number) => n === 2)([1, 2, 3]), some(1))\n * assert.deepStrictEqual(findIndex((n: number) => n === 2)([]), none)\n *\n * @since 2.5.0\n */\nvar findIndex = function (predicate) {\n    return function (as) {\n        for (var i = 0; i < as.length; i++) {\n            if (predicate(as[i])) {\n                return _.some(i);\n            }\n        }\n        return _.none;\n    };\n};\nexports.findIndex = findIndex;\nfunction findFirst(predicate) {\n    return function (as) {\n        for (var i = 0; i < as.length; i++) {\n            if (predicate(as[i])) {\n                return _.some(as[i]);\n            }\n        }\n        return _.none;\n    };\n}\nexports.findFirst = findFirst;\n/**\n * Find the first element returned by an option based selector function\n *\n * @example\n * import { findFirstMap } from 'fp-ts/ReadonlyArray'\n * import { some, none } from 'fp-ts/Option'\n *\n * interface Person {\n *   readonly name: string\n *   readonly age?: number\n * }\n *\n * const persons: ReadonlyArray<Person> = [{ name: 'John' }, { name: 'Mary', age: 45 }, { name: 'Joey', age: 28 }]\n *\n * // returns the name of the first person that has an age\n * assert.deepStrictEqual(findFirstMap((p: Person) => (p.age === undefined ? none : some(p.name)))(persons), some('Mary'))\n *\n * @since 2.5.0\n */\nvar findFirstMap = function (f) {\n    return function (as) {\n        for (var i = 0; i < as.length; i++) {\n            var out = f(as[i]);\n            if (_.isSome(out)) {\n                return out;\n            }\n        }\n        return _.none;\n    };\n};\nexports.findFirstMap = findFirstMap;\nfunction findLast(predicate) {\n    return function (as) {\n        for (var i = as.length - 1; i >= 0; i--) {\n            if (predicate(as[i])) {\n                return _.some(as[i]);\n            }\n        }\n        return _.none;\n    };\n}\nexports.findLast = findLast;\n/**\n * Find the last element returned by an option based selector function\n *\n * @example\n * import { findLastMap } from 'fp-ts/ReadonlyArray'\n * import { some, none } from 'fp-ts/Option'\n *\n * interface Person {\n *   readonly name: string\n *   readonly age?: number\n * }\n *\n * const persons: ReadonlyArray<Person> = [{ name: 'John' }, { name: 'Mary', age: 45 }, { name: 'Joey', age: 28 }]\n *\n * // returns the name of the last person that has an age\n * assert.deepStrictEqual(findLastMap((p: Person) => (p.age === undefined ? none : some(p.name)))(persons), some('Joey'))\n *\n * @since 2.5.0\n */\nvar findLastMap = function (f) {\n    return function (as) {\n        for (var i = as.length - 1; i >= 0; i--) {\n            var out = f(as[i]);\n            if (_.isSome(out)) {\n                return out;\n            }\n        }\n        return _.none;\n    };\n};\nexports.findLastMap = findLastMap;\n/**\n * Returns the index of the last element of the list which matches the predicate\n *\n * @example\n * import { findLastIndex } from 'fp-ts/ReadonlyArray'\n * import { some, none } from 'fp-ts/Option'\n *\n * interface X {\n *   readonly a: number\n *   readonly b: number\n * }\n * const xs: ReadonlyArray<X> = [{ a: 1, b: 0 }, { a: 1, b: 1 }]\n * assert.deepStrictEqual(findLastIndex((x: { readonly a: number }) => x.a === 1)(xs), some(1))\n * assert.deepStrictEqual(findLastIndex((x: { readonly a: number }) => x.a === 4)(xs), none)\n *\n *\n * @since 2.5.0\n */\nvar findLastIndex = function (predicate) {\n    return function (as) {\n        for (var i = as.length - 1; i >= 0; i--) {\n            if (predicate(as[i])) {\n                return _.some(i);\n            }\n        }\n        return _.none;\n    };\n};\nexports.findLastIndex = findLastIndex;\n/**\n * Insert an element at the specified index, creating a new array, or returning `None` if the index is out of bounds\n *\n * @example\n * import { insertAt } from 'fp-ts/ReadonlyArray'\n * import { some } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(insertAt(2, 5)([1, 2, 3, 4]), some([1, 2, 5, 3, 4]))\n *\n * @since 2.5.0\n */\nvar insertAt = function (i, a) {\n    return function (as) {\n        return i < 0 || i > as.length ? _.none : _.some(RNEA.unsafeInsertAt(i, a, as));\n    };\n};\nexports.insertAt = insertAt;\n/**\n * Change the element at the specified index, creating a new array, or returning `None` if the index is out of bounds\n *\n * @example\n * import { updateAt } from 'fp-ts/ReadonlyArray'\n * import { some, none } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(updateAt(1, 1)([1, 2, 3]), some([1, 1, 3]))\n * assert.deepStrictEqual(updateAt(1, 1)([]), none)\n *\n * @since 2.5.0\n */\nvar updateAt = function (i, a) {\n    return (0, exports.modifyAt)(i, function () { return a; });\n};\nexports.updateAt = updateAt;\n/**\n * Delete the element at the specified index, creating a new array, or returning `None` if the index is out of bounds\n *\n * @example\n * import { deleteAt } from 'fp-ts/ReadonlyArray'\n * import { some, none } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(deleteAt(0)([1, 2, 3]), some([2, 3]))\n * assert.deepStrictEqual(deleteAt(1)([]), none)\n *\n * @since 2.5.0\n */\nvar deleteAt = function (i) {\n    return function (as) {\n        return (0, exports.isOutOfBound)(i, as) ? _.none : _.some((0, exports.unsafeDeleteAt)(i, as));\n    };\n};\nexports.deleteAt = deleteAt;\n/**\n * Apply a function to the element at the specified index, creating a new array, or returning `None` if the index is out\n * of bounds\n *\n * @example\n * import { modifyAt } from 'fp-ts/ReadonlyArray'\n * import { some, none } from 'fp-ts/Option'\n *\n * const double = (x: number): number => x * 2\n * assert.deepStrictEqual(modifyAt(1, double)([1, 2, 3]), some([1, 4, 3]))\n * assert.deepStrictEqual(modifyAt(1, double)([]), none)\n *\n * @since 2.5.0\n */\nvar modifyAt = function (i, f) {\n    return function (as) {\n        return (0, exports.isOutOfBound)(i, as) ? _.none : _.some((0, exports.unsafeUpdateAt)(i, f(as[i]), as));\n    };\n};\nexports.modifyAt = modifyAt;\n/**\n * Reverse an array, creating a new array\n *\n * @example\n * import { reverse } from 'fp-ts/ReadonlyArray'\n *\n * assert.deepStrictEqual(reverse([1, 2, 3]), [3, 2, 1])\n *\n * @since 2.5.0\n */\nvar reverse = function (as) { return (as.length <= 1 ? as : as.slice().reverse()); };\nexports.reverse = reverse;\n/**\n * Extracts from an array of `Either` all the `Right` elements. All the `Right` elements are extracted in order\n *\n * @example\n * import { rights } from 'fp-ts/ReadonlyArray'\n * import { right, left } from 'fp-ts/Either'\n *\n * assert.deepStrictEqual(rights([right(1), left('foo'), right(2)]), [1, 2])\n *\n * @since 2.5.0\n */\nvar rights = function (as) {\n    var r = [];\n    for (var i = 0; i < as.length; i++) {\n        var a = as[i];\n        if (a._tag === 'Right') {\n            r.push(a.right);\n        }\n    }\n    return r;\n};\nexports.rights = rights;\n/**\n * Extracts from an array of `Either` all the `Left` elements. All the `Left` elements are extracted in order\n *\n * @example\n * import { lefts } from 'fp-ts/ReadonlyArray'\n * import { left, right } from 'fp-ts/Either'\n *\n * assert.deepStrictEqual(lefts([right(1), left('foo'), right(2)]), ['foo'])\n *\n * @since 2.5.0\n */\nvar lefts = function (as) {\n    var r = [];\n    for (var i = 0; i < as.length; i++) {\n        var a = as[i];\n        if (a._tag === 'Left') {\n            r.push(a.left);\n        }\n    }\n    return r;\n};\nexports.lefts = lefts;\n/**\n * Sort the elements of an array in increasing order, creating a new array\n *\n * @example\n * import { sort } from 'fp-ts/ReadonlyArray'\n * import * as N from 'fp-ts/number'\n *\n * assert.deepStrictEqual(sort(N.Ord)([3, 2, 1]), [1, 2, 3])\n *\n * @since 2.5.0\n */\nvar sort = function (O) {\n    return function (as) {\n        return as.length <= 1 ? as : as.slice().sort(O.compare);\n    };\n};\nexports.sort = sort;\n// TODO: curry and make data-last in v3\n/**\n * Apply a function to pairs of elements at the same index in two arrays, collecting the results in a new array. If one\n * input array is short, excess elements of the longer array are discarded.\n *\n * @example\n * import { zipWith } from 'fp-ts/ReadonlyArray'\n *\n * assert.deepStrictEqual(zipWith([1, 2, 3], ['a', 'b', 'c', 'd'], (n, s) => s + n), ['a1', 'b2', 'c3'])\n *\n * @since 2.5.0\n */\nvar zipWith = function (fa, fb, f) {\n    var fc = [];\n    var len = Math.min(fa.length, fb.length);\n    for (var i = 0; i < len; i++) {\n        fc[i] = f(fa[i], fb[i]);\n    }\n    return fc;\n};\nexports.zipWith = zipWith;\nfunction zip(as, bs) {\n    if (bs === undefined) {\n        return function (bs) { return zip(bs, as); };\n    }\n    return (0, exports.zipWith)(as, bs, function (a, b) { return [a, b]; });\n}\nexports.zip = zip;\n/**\n * The function is reverse of `zip`. Takes an array of pairs and return two corresponding arrays\n *\n * @example\n * import { unzip } from 'fp-ts/ReadonlyArray'\n *\n * assert.deepStrictEqual(unzip([[1, 'a'], [2, 'b'], [3, 'c']]), [[1, 2, 3], ['a', 'b', 'c']])\n *\n * @since 2.5.0\n */\nvar unzip = function (as) {\n    var fa = [];\n    var fb = [];\n    for (var i = 0; i < as.length; i++) {\n        fa[i] = as[i][0];\n        fb[i] = as[i][1];\n    }\n    return [fa, fb];\n};\nexports.unzip = unzip;\n/**\n * Prepend an element to every member of an array\n *\n * @example\n * import { prependAll } from 'fp-ts/ReadonlyArray'\n *\n * assert.deepStrictEqual(prependAll(9)([1, 2, 3, 4]), [9, 1, 9, 2, 9, 3, 9, 4])\n *\n * @since 2.10.0\n */\nvar prependAll = function (middle) {\n    var f = RNEA.prependAll(middle);\n    return function (as) { return ((0, exports.isNonEmpty)(as) ? f(as) : as); };\n};\nexports.prependAll = prependAll;\n/**\n * Places an element in between members of an array\n *\n * @example\n * import { intersperse } from 'fp-ts/ReadonlyArray'\n *\n * assert.deepStrictEqual(intersperse(9)([1, 2, 3, 4]), [1, 9, 2, 9, 3, 9, 4])\n *\n * @since 2.9.0\n */\nvar intersperse = function (middle) {\n    var f = RNEA.intersperse(middle);\n    return function (as) { return ((0, exports.isNonEmpty)(as) ? f(as) : as); };\n};\nexports.intersperse = intersperse;\n/**\n * Rotate a `ReadonlyArray` by `n` steps.\n *\n * @example\n * import { rotate } from 'fp-ts/ReadonlyArray'\n *\n * assert.deepStrictEqual(rotate(2)([1, 2, 3, 4, 5]), [4, 5, 1, 2, 3])\n *\n * @since 2.5.0\n */\nvar rotate = function (n) {\n    var f = RNEA.rotate(n);\n    return function (as) { return ((0, exports.isNonEmpty)(as) ? f(as) : as); };\n};\nexports.rotate = rotate;\nfunction elem(E) {\n    return function (a, as) {\n        if (as === undefined) {\n            var elemE_1 = elem(E);\n            return function (as) { return elemE_1(a, as); };\n        }\n        var predicate = function (element) { return E.equals(element, a); };\n        var i = 0;\n        for (; i < as.length; i++) {\n            if (predicate(as[i])) {\n                return true;\n            }\n        }\n        return false;\n    };\n}\nexports.elem = elem;\n/**\n * Remove duplicates from an array, keeping the first occurrence of an element.\n *\n * @example\n * import { uniq } from 'fp-ts/ReadonlyArray'\n * import * as N from 'fp-ts/number'\n *\n * assert.deepStrictEqual(uniq(N.Eq)([1, 2, 1]), [1, 2])\n *\n * @since 2.5.0\n */\nvar uniq = function (E) {\n    var f = RNEA.uniq(E);\n    return function (as) { return ((0, exports.isNonEmpty)(as) ? f(as) : as); };\n};\nexports.uniq = uniq;\n/**\n * Sort the elements of an array in increasing order, where elements are compared using first `ords[0]`, then `ords[1]`,\n * etc...\n *\n * @example\n * import { sortBy } from 'fp-ts/ReadonlyArray'\n * import { contramap } from 'fp-ts/Ord'\n * import * as S from 'fp-ts/string'\n * import * as N from 'fp-ts/number'\n * import { pipe } from 'fp-ts/function'\n *\n * interface Person {\n *   readonly name: string\n *   readonly age: number\n * }\n * const byName = pipe(S.Ord, contramap((p: Person) => p.name))\n * const byAge = pipe(N.Ord, contramap((p: Person) => p.age))\n *\n * const sortByNameByAge = sortBy([byName, byAge])\n *\n * const persons = [{ name: 'a', age: 1 }, { name: 'b', age: 3 }, { name: 'c', age: 2 }, { name: 'b', age: 2 }]\n * assert.deepStrictEqual(sortByNameByAge(persons), [\n *   { name: 'a', age: 1 },\n *   { name: 'b', age: 2 },\n *   { name: 'b', age: 3 },\n *   { name: 'c', age: 2 }\n * ])\n *\n * @since 2.5.0\n */\nvar sortBy = function (ords) {\n    var f = RNEA.sortBy(ords);\n    return function (as) { return ((0, exports.isNonEmpty)(as) ? f(as) : as); };\n};\nexports.sortBy = sortBy;\n/**\n * A useful recursion pattern for processing a `ReadonlyArray` to produce a new `ReadonlyArray`, often used for \"chopping\" up the input\n * `ReadonlyArray`. Typically `chop` is called with some function that will consume an initial prefix of the `ReadonlyArray` and produce a\n * value and the tail of the `ReadonlyArray`.\n *\n * @example\n * import { Eq } from 'fp-ts/Eq'\n * import * as RA from 'fp-ts/ReadonlyArray'\n * import * as N from 'fp-ts/number'\n * import { pipe } from 'fp-ts/function'\n *\n * const group = <A>(S: Eq<A>): ((as: ReadonlyArray<A>) => ReadonlyArray<ReadonlyArray<A>>) => {\n *   return RA.chop(as => {\n *     const { init, rest } = pipe(as, RA.spanLeft((a: A) => S.equals(a, as[0])))\n *     return [init, rest]\n *   })\n * }\n * assert.deepStrictEqual(group(N.Eq)([1, 1, 2, 3, 3, 4]), [[1, 1], [2], [3, 3], [4]])\n *\n * @since 2.5.0\n */\nvar chop = function (f) {\n    var g = RNEA.chop(f);\n    return function (as) { return ((0, exports.isNonEmpty)(as) ? g(as) : exports.empty); };\n};\nexports.chop = chop;\n/**\n * Splits a `ReadonlyArray` into two pieces, the first piece has max `n` elements.\n *\n * @example\n * import { splitAt } from 'fp-ts/ReadonlyArray'\n *\n * assert.deepStrictEqual(splitAt(2)([1, 2, 3, 4, 5]), [[1, 2], [3, 4, 5]])\n *\n * @since 2.5.0\n */\nvar splitAt = function (n) {\n    return function (as) {\n        return n >= 1 && (0, exports.isNonEmpty)(as) ? RNEA.splitAt(n)(as) : (0, exports.isEmpty)(as) ? [as, exports.empty] : [exports.empty, as];\n    };\n};\nexports.splitAt = splitAt;\n/**\n * Splits a `ReadonlyArray` into length-`n` pieces. The last piece will be shorter if `n` does not evenly divide the length of\n * the `ReadonlyArray`. Note that `chunksOf(n)([])` is `[]`, not `[[]]`. This is intentional, and is consistent with a recursive\n * definition of `chunksOf`; it satisfies the property that:\n *\n * ```ts\n * chunksOf(n)(xs).concat(chunksOf(n)(ys)) == chunksOf(n)(xs.concat(ys)))\n * ```\n *\n * whenever `n` evenly divides the length of `as`.\n *\n * @example\n * import { chunksOf } from 'fp-ts/ReadonlyArray'\n *\n * assert.deepStrictEqual(chunksOf(2)([1, 2, 3, 4, 5]), [[1, 2], [3, 4], [5]])\n *\n * @since 2.5.0\n */\nvar chunksOf = function (n) {\n    var f = RNEA.chunksOf(n);\n    return function (as) { return ((0, exports.isNonEmpty)(as) ? f(as) : exports.empty); };\n};\nexports.chunksOf = chunksOf;\n/**\n * @category lifting\n * @since 2.11.0\n */\nvar fromOptionK = function (f) {\n    return function () {\n        var a = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            a[_i] = arguments[_i];\n        }\n        return (0, exports.fromOption)(f.apply(void 0, a));\n    };\n};\nexports.fromOptionK = fromOptionK;\nfunction comprehension(input, f, g) {\n    if (g === void 0) { g = function () { return true; }; }\n    var go = function (scope, input) {\n        return (0, exports.isNonEmpty)(input)\n            ? (0, exports.flatMap)(RNEA.head(input), function (a) { return go((0, function_1.pipe)(scope, (0, exports.append)(a)), RNEA.tail(input)); })\n            : g.apply(void 0, scope) ? [f.apply(void 0, scope)]\n                : exports.empty;\n    };\n    return go(exports.empty, input);\n}\nexports.comprehension = comprehension;\n/**\n * @since 2.11.0\n */\nvar concatW = function (second) {\n    return function (first) {\n        return (0, exports.isEmpty)(first) ? second : (0, exports.isEmpty)(second) ? first : first.concat(second);\n    };\n};\nexports.concatW = concatW;\n/**\n * @since 2.11.0\n */\nexports.concat = exports.concatW;\nfunction union(E) {\n    var unionE = RNEA.union(E);\n    return function (first, second) {\n        if (second === undefined) {\n            var unionE_1 = union(E);\n            return function (second) { return unionE_1(second, first); };\n        }\n        return (0, exports.isNonEmpty)(first) && (0, exports.isNonEmpty)(second) ? unionE(second)(first) : (0, exports.isNonEmpty)(first) ? first : second;\n    };\n}\nexports.union = union;\nfunction intersection(E) {\n    var elemE = elem(E);\n    return function (xs, ys) {\n        if (ys === undefined) {\n            var intersectionE_1 = intersection(E);\n            return function (ys) { return intersectionE_1(ys, xs); };\n        }\n        return xs.filter(function (a) { return elemE(a, ys); });\n    };\n}\nexports.intersection = intersection;\nfunction difference(E) {\n    var elemE = elem(E);\n    return function (xs, ys) {\n        if (ys === undefined) {\n            var differenceE_1 = difference(E);\n            return function (ys) { return differenceE_1(ys, xs); };\n        }\n        return xs.filter(function (a) { return !elemE(a, ys); });\n    };\n}\nexports.difference = difference;\nvar _map = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.map)(f)); };\nvar _mapWithIndex = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.mapWithIndex)(f)); };\nvar _ap = function (fab, fa) { return (0, function_1.pipe)(fab, (0, exports.ap)(fa)); };\nvar _filter = function (fa, predicate) {\n    return (0, function_1.pipe)(fa, (0, exports.filter)(predicate));\n};\nvar _filterMap = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.filterMap)(f)); };\nvar _partition = function (fa, predicate) {\n    return (0, function_1.pipe)(fa, (0, exports.partition)(predicate));\n};\nvar _partitionMap = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.partitionMap)(f)); };\nvar _partitionWithIndex = function (fa, predicateWithIndex) { return (0, function_1.pipe)(fa, (0, exports.partitionWithIndex)(predicateWithIndex)); };\nvar _partitionMapWithIndex = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.partitionMapWithIndex)(f)); };\nvar _alt = function (fa, that) { return (0, function_1.pipe)(fa, (0, exports.alt)(that)); };\nvar _reduce = function (fa, b, f) { return (0, function_1.pipe)(fa, (0, exports.reduce)(b, f)); };\nvar _foldMap = function (M) {\n    var foldMapM = (0, exports.foldMap)(M);\n    return function (fa, f) { return (0, function_1.pipe)(fa, foldMapM(f)); };\n};\nvar _reduceRight = function (fa, b, f) { return (0, function_1.pipe)(fa, (0, exports.reduceRight)(b, f)); };\nvar _reduceWithIndex = function (fa, b, f) {\n    return (0, function_1.pipe)(fa, (0, exports.reduceWithIndex)(b, f));\n};\nvar _foldMapWithIndex = function (M) {\n    var foldMapWithIndexM = (0, exports.foldMapWithIndex)(M);\n    return function (fa, f) { return (0, function_1.pipe)(fa, foldMapWithIndexM(f)); };\n};\nvar _reduceRightWithIndex = function (fa, b, f) {\n    return (0, function_1.pipe)(fa, (0, exports.reduceRightWithIndex)(b, f));\n};\nvar _filterMapWithIndex = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.filterMapWithIndex)(f)); };\nvar _filterWithIndex = function (fa, predicateWithIndex) { return (0, function_1.pipe)(fa, (0, exports.filterWithIndex)(predicateWithIndex)); };\nvar _extend = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.extend)(f)); };\nvar _traverse = function (F) {\n    var traverseF = (0, exports.traverse)(F);\n    return function (ta, f) { return (0, function_1.pipe)(ta, traverseF(f)); };\n};\n/* istanbul ignore next */\nvar _traverseWithIndex = function (F) {\n    var traverseWithIndexF = (0, exports.traverseWithIndex)(F);\n    return function (ta, f) { return (0, function_1.pipe)(ta, traverseWithIndexF(f)); };\n};\n/** @internal */\nvar _chainRecDepthFirst = function (a, f) { return (0, function_1.pipe)(a, (0, exports.chainRecDepthFirst)(f)); };\nexports._chainRecDepthFirst = _chainRecDepthFirst;\n/** @internal */\nvar _chainRecBreadthFirst = function (a, f) { return (0, function_1.pipe)(a, (0, exports.chainRecBreadthFirst)(f)); };\nexports._chainRecBreadthFirst = _chainRecBreadthFirst;\n/**\n * @category constructors\n * @since 2.5.0\n */\nexports.of = RNEA.of;\n/**\n * @since 2.7.0\n */\nvar zero = function () { return exports.empty; };\nexports.zero = zero;\n/**\n * Less strict version of [`alt`](#alt).\n *\n * The `W` suffix (short for **W**idening) means that the return types will be merged.\n *\n * @example\n * import * as RA from 'fp-ts/ReadonlyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3],\n *     RA.altW(() => ['a', 'b'])\n *   ),\n *   [1, 2, 3, 'a', 'b']\n * )\n *\n * @category error handling\n * @since 2.9.0\n */\nvar altW = function (that) {\n    return function (fa) {\n        return fa.concat(that());\n    };\n};\nexports.altW = altW;\n/**\n * Identifies an associative operation on a type constructor. It is similar to `Semigroup`, except that it applies to\n * types of kind `* -> *`.\n *\n * In case of `ReadonlyArray` concatenates the inputs into a single array.\n *\n * @example\n * import * as RA from 'fp-ts/ReadonlyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3],\n *     RA.alt(() => [4, 5])\n *   ),\n *   [1, 2, 3, 4, 5]\n * )\n *\n * @category error handling\n * @since 2.5.0\n */\nexports.alt = exports.altW;\n/**\n * @since 2.5.0\n */\nvar ap = function (fa) {\n    return (0, exports.flatMap)(function (f) { return (0, function_1.pipe)(fa, (0, exports.map)(f)); });\n};\nexports.ap = ap;\n/**\n * Composes computations in sequence, using the return value of one computation to determine the next computation.\n *\n * @example\n * import * as RA from 'fp-ts/ReadonlyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3],\n *     RA.flatMap((n) => [`a${n}`, `b${n}`])\n *   ),\n *   ['a1', 'b1', 'a2', 'b2', 'a3', 'b3']\n * )\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3],\n *     RA.flatMap(() => [])\n *   ),\n *   []\n * )\n *\n * @category sequencing\n * @since 2.14.0\n */\nexports.flatMap = (0, function_1.dual)(2, function (ma, f) {\n    return (0, function_1.pipe)(ma, (0, exports.chainWithIndex)(function (i, a) { return f(a, i); }));\n});\n/**\n * @category sequencing\n * @since 2.5.0\n */\nexports.flatten = (0, exports.flatMap)(function_1.identity);\n/**\n * `map` can be used to turn functions `(a: A) => B` into functions `(fa: F<A>) => F<B>` whose argument and return types\n * use the type constructor `F` to represent some computational context.\n *\n * @category mapping\n * @since 2.5.0\n */\nvar map = function (f) { return function (fa) {\n    return fa.map(function (a) { return f(a); });\n}; };\nexports.map = map;\n/**\n * @category mapping\n * @since 2.5.0\n */\nvar mapWithIndex = function (f) { return function (fa) {\n    return fa.map(function (a, i) { return f(i, a); });\n}; };\nexports.mapWithIndex = mapWithIndex;\n/**\n * @category filtering\n * @since 2.5.0\n */\nvar separate = function (fa) {\n    var left = [];\n    var right = [];\n    for (var _i = 0, fa_1 = fa; _i < fa_1.length; _i++) {\n        var e = fa_1[_i];\n        if (e._tag === 'Left') {\n            left.push(e.left);\n        }\n        else {\n            right.push(e.right);\n        }\n    }\n    return (0, Separated_1.separated)(left, right);\n};\nexports.separate = separate;\n/**\n * @category filtering\n * @since 2.5.0\n */\nvar filter = function (predicate) {\n    return function (as) {\n        return as.filter(predicate);\n    };\n};\nexports.filter = filter;\n/**\n * @category filtering\n * @since 2.5.0\n */\nvar filterMapWithIndex = function (f) {\n    return function (fa) {\n        var out = [];\n        for (var i = 0; i < fa.length; i++) {\n            var optionB = f(i, fa[i]);\n            if (_.isSome(optionB)) {\n                out.push(optionB.value);\n            }\n        }\n        return out;\n    };\n};\nexports.filterMapWithIndex = filterMapWithIndex;\n/**\n * @category filtering\n * @since 2.5.0\n */\nvar filterMap = function (f) {\n    return (0, exports.filterMapWithIndex)(function (_, a) { return f(a); });\n};\nexports.filterMap = filterMap;\n/**\n * @category filtering\n * @since 2.5.0\n */\nexports.compact = (0, exports.filterMap)(function_1.identity);\n/**\n * @category filtering\n * @since 2.5.0\n */\nvar partition = function (predicate) {\n    return (0, exports.partitionWithIndex)(function (_, a) { return predicate(a); });\n};\nexports.partition = partition;\n/**\n * @category filtering\n * @since 2.5.0\n */\nvar partitionWithIndex = function (predicateWithIndex) {\n    return function (as) {\n        var left = [];\n        var right = [];\n        for (var i = 0; i < as.length; i++) {\n            var a = as[i];\n            if (predicateWithIndex(i, a)) {\n                right.push(a);\n            }\n            else {\n                left.push(a);\n            }\n        }\n        return (0, Separated_1.separated)(left, right);\n    };\n};\nexports.partitionWithIndex = partitionWithIndex;\n/**\n * @category filtering\n * @since 2.5.0\n */\nvar partitionMap = function (f) {\n    return (0, exports.partitionMapWithIndex)(function (_, a) { return f(a); });\n};\nexports.partitionMap = partitionMap;\n/**\n * @category filtering\n * @since 2.5.0\n */\nvar partitionMapWithIndex = function (f) {\n    return function (fa) {\n        var left = [];\n        var right = [];\n        for (var i = 0; i < fa.length; i++) {\n            var e = f(i, fa[i]);\n            if (e._tag === 'Left') {\n                left.push(e.left);\n            }\n            else {\n                right.push(e.right);\n            }\n        }\n        return (0, Separated_1.separated)(left, right);\n    };\n};\nexports.partitionMapWithIndex = partitionMapWithIndex;\n/**\n * @category filtering\n * @since 2.5.0\n */\nvar filterWithIndex = function (predicateWithIndex) {\n    return function (as) {\n        return as.filter(function (a, i) { return predicateWithIndex(i, a); });\n    };\n};\nexports.filterWithIndex = filterWithIndex;\n/**\n * @since 2.5.0\n */\nvar extend = function (f) { return function (wa) {\n    return wa.map(function (_, i) { return f(wa.slice(i)); });\n}; };\nexports.extend = extend;\n/**\n * @since 2.5.0\n */\nexports.duplicate = (0, exports.extend)(function_1.identity);\n/**\n * @category folding\n * @since 2.5.0\n */\nvar foldMapWithIndex = function (M) {\n    return function (f) {\n        return function (fa) {\n            return fa.reduce(function (b, a, i) { return M.concat(b, f(i, a)); }, M.empty);\n        };\n    };\n};\nexports.foldMapWithIndex = foldMapWithIndex;\n/**\n * @category folding\n * @since 2.5.0\n */\nvar reduce = function (b, f) {\n    return (0, exports.reduceWithIndex)(b, function (_, b, a) { return f(b, a); });\n};\nexports.reduce = reduce;\n/**\n * @category folding\n * @since 2.5.0\n */\nvar foldMap = function (M) {\n    var foldMapWithIndexM = (0, exports.foldMapWithIndex)(M);\n    return function (f) { return foldMapWithIndexM(function (_, a) { return f(a); }); };\n};\nexports.foldMap = foldMap;\n/**\n * @category folding\n * @since 2.5.0\n */\nvar reduceWithIndex = function (b, f) { return function (fa) {\n    var len = fa.length;\n    var out = b;\n    for (var i = 0; i < len; i++) {\n        out = f(i, out, fa[i]);\n    }\n    return out;\n}; };\nexports.reduceWithIndex = reduceWithIndex;\n/**\n * @category folding\n * @since 2.5.0\n */\nvar reduceRight = function (b, f) {\n    return (0, exports.reduceRightWithIndex)(b, function (_, a, b) { return f(a, b); });\n};\nexports.reduceRight = reduceRight;\n/**\n * @category folding\n * @since 2.5.0\n */\nvar reduceRightWithIndex = function (b, f) { return function (fa) {\n    return fa.reduceRight(function (b, a, i) { return f(i, a, b); }, b);\n}; };\nexports.reduceRightWithIndex = reduceRightWithIndex;\n/**\n * @category traversing\n * @since 2.6.3\n */\nvar traverse = function (F) {\n    var traverseWithIndexF = (0, exports.traverseWithIndex)(F);\n    return function (f) { return traverseWithIndexF(function (_, a) { return f(a); }); };\n};\nexports.traverse = traverse;\n/**\n * @category traversing\n * @since 2.6.3\n */\nvar sequence = function (F) {\n    return function (ta) {\n        return _reduce(ta, F.of((0, exports.zero)()), function (fas, fa) {\n            return F.ap(F.map(fas, function (as) { return function (a) { return (0, function_1.pipe)(as, (0, exports.append)(a)); }; }), fa);\n        });\n    };\n};\nexports.sequence = sequence;\n/**\n * @category sequencing\n * @since 2.6.3\n */\nvar traverseWithIndex = function (F) {\n    return function (f) {\n        return (0, exports.reduceWithIndex)(F.of((0, exports.zero)()), function (i, fbs, a) {\n            return F.ap(F.map(fbs, function (bs) { return function (b) { return (0, function_1.pipe)(bs, (0, exports.append)(b)); }; }), f(i, a));\n        });\n    };\n};\nexports.traverseWithIndex = traverseWithIndex;\n/**\n * @category filtering\n * @since 2.6.5\n */\nvar wither = function (F) {\n    var _witherF = _wither(F);\n    return function (f) { return function (fa) { return _witherF(fa, f); }; };\n};\nexports.wither = wither;\n/**\n * @category filtering\n * @since 2.6.5\n */\nvar wilt = function (F) {\n    var _wiltF = _wilt(F);\n    return function (f) { return function (fa) { return _wiltF(fa, f); }; };\n};\nexports.wilt = wilt;\n/**\n * @since 2.6.6\n */\nvar unfold = function (b, f) {\n    var out = [];\n    var bb = b;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n        var mt = f(bb);\n        if (_.isSome(mt)) {\n            var _a = mt.value, a = _a[0], b_1 = _a[1];\n            out.push(a);\n            bb = b_1;\n        }\n        else {\n            break;\n        }\n    }\n    return out;\n};\nexports.unfold = unfold;\n/**\n * @category type lambdas\n * @since 2.5.0\n */\nexports.URI = 'ReadonlyArray';\n/**\n * @category instances\n * @since 2.5.0\n */\nvar getShow = function (S) { return ({\n    show: function (as) { return \"[\".concat(as.map(S.show).join(', '), \"]\"); }\n}); };\nexports.getShow = getShow;\n/**\n * @category instances\n * @since 2.5.0\n */\nvar getSemigroup = function () { return ({\n    concat: function (first, second) { return ((0, exports.isEmpty)(first) ? second : (0, exports.isEmpty)(second) ? first : first.concat(second)); }\n}); };\nexports.getSemigroup = getSemigroup;\n/**\n * Returns a `Monoid` for `ReadonlyArray<A>`.\n *\n * @example\n * import { getMonoid } from 'fp-ts/ReadonlyArray'\n *\n * const M = getMonoid<number>()\n * assert.deepStrictEqual(M.concat([1, 2], [3, 4]), [1, 2, 3, 4])\n *\n * @category instances\n * @since 2.5.0\n */\nvar getMonoid = function () { return ({\n    concat: (0, exports.getSemigroup)().concat,\n    empty: exports.empty\n}); };\nexports.getMonoid = getMonoid;\n/**\n * Derives an `Eq` over the `ReadonlyArray` of a given element type from the `Eq` of that type. The derived `Eq` defines two\n * arrays as equal if all elements of both arrays are compared equal pairwise with the given `E`. In case of arrays of\n * different lengths, the result is non equality.\n *\n * @example\n * import * as S from 'fp-ts/string'\n * import { getEq } from 'fp-ts/ReadonlyArray'\n *\n * const E = getEq(S.Eq)\n * assert.strictEqual(E.equals(['a', 'b'], ['a', 'b']), true)\n * assert.strictEqual(E.equals(['a'], []), false)\n *\n * @category instances\n * @since 2.5.0\n */\nvar getEq = function (E) {\n    return (0, Eq_1.fromEquals)(function (xs, ys) { return xs.length === ys.length && xs.every(function (x, i) { return E.equals(x, ys[i]); }); });\n};\nexports.getEq = getEq;\n/**\n * Derives an `Ord` over the `ReadonlyArray` of a given element type from the `Ord` of that type. The ordering between two such\n * arrays is equal to: the first non equal comparison of each arrays elements taken pairwise in increasing order, in\n * case of equality over all the pairwise elements; the longest array is considered the greatest, if both arrays have\n * the same length, the result is equality.\n *\n * @example\n * import { getOrd } from 'fp-ts/ReadonlyArray'\n * import * as S from 'fp-ts/string'\n *\n * const O = getOrd(S.Ord)\n * assert.strictEqual(O.compare(['b'], ['a']), 1)\n * assert.strictEqual(O.compare(['a'], ['a']), 0)\n * assert.strictEqual(O.compare(['a'], ['b']), -1)\n *\n *\n * @category instances\n * @since 2.5.0\n */\nvar getOrd = function (O) {\n    return (0, Ord_1.fromCompare)(function (a, b) {\n        var aLen = a.length;\n        var bLen = b.length;\n        var len = Math.min(aLen, bLen);\n        for (var i = 0; i < len; i++) {\n            var ordering = O.compare(a[i], b[i]);\n            if (ordering !== 0) {\n                return ordering;\n            }\n        }\n        return N.Ord.compare(aLen, bLen);\n    });\n};\nexports.getOrd = getOrd;\n/**\n * @category instances\n * @since 2.11.0\n */\nvar getUnionSemigroup = function (E) {\n    var unionE = union(E);\n    return {\n        concat: function (first, second) { return unionE(second)(first); }\n    };\n};\nexports.getUnionSemigroup = getUnionSemigroup;\n/**\n * @category instances\n * @since 2.11.0\n */\nvar getUnionMonoid = function (E) { return ({\n    concat: (0, exports.getUnionSemigroup)(E).concat,\n    empty: exports.empty\n}); };\nexports.getUnionMonoid = getUnionMonoid;\n/**\n * @category instances\n * @since 2.11.0\n */\nvar getIntersectionSemigroup = function (E) {\n    var intersectionE = intersection(E);\n    return {\n        concat: function (first, second) { return intersectionE(second)(first); }\n    };\n};\nexports.getIntersectionSemigroup = getIntersectionSemigroup;\n/**\n * @category instances\n * @since 2.11.0\n */\nvar getDifferenceMagma = function (E) {\n    var differenceE = difference(E);\n    return {\n        concat: function (first, second) { return differenceE(second)(first); }\n    };\n};\nexports.getDifferenceMagma = getDifferenceMagma;\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Functor = {\n    URI: exports.URI,\n    map: _map\n};\n/**\n * @category mapping\n * @since 2.10.0\n */\nexports.flap = (0, Functor_1.flap)(exports.Functor);\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Pointed = {\n    URI: exports.URI,\n    of: exports.of\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.FunctorWithIndex = {\n    URI: exports.URI,\n    map: _map,\n    mapWithIndex: _mapWithIndex\n};\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Apply = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap\n};\n/**\n * Combine two effectful actions, keeping only the result of the first.\n *\n * @since 2.5.0\n */\nexports.apFirst = (0, Apply_1.apFirst)(exports.Apply);\n/**\n * Combine two effectful actions, keeping only the result of the second.\n *\n * @since 2.5.0\n */\nexports.apSecond = (0, Apply_1.apSecond)(exports.Apply);\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Applicative = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    of: exports.of\n};\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Chain = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    chain: exports.flatMap\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Monad = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    of: exports.of,\n    chain: exports.flatMap\n};\n/**\n * Composes computations in sequence, using the return value of one computation to determine the next computation and\n * keeping only the result of the first.\n *\n * @example\n * import * as RA from 'fp-ts/ReadonlyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3],\n *     RA.chainFirst(() => ['a', 'b'])\n *   ),\n *   [1, 1, 2, 2, 3, 3]\n * )\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3],\n *     RA.chainFirst(() => [])\n *   ),\n *   []\n * )\n *\n * @category sequencing\n * @since 2.5.0\n */\nexports.chainFirst = \n/*#__PURE__*/ (0, Chain_1.chainFirst)(exports.Chain);\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Unfoldable = {\n    URI: exports.URI,\n    unfold: exports.unfold\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Alt = {\n    URI: exports.URI,\n    map: _map,\n    alt: _alt\n};\n/**\n * @category instances\n * @since 2.11.0\n */\nexports.Zero = {\n    URI: exports.URI,\n    zero: exports.zero\n};\n/**\n * @category do notation\n * @since 2.11.0\n */\nexports.guard = (0, Zero_1.guard)(exports.Zero, exports.Pointed);\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Alternative = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    of: exports.of,\n    alt: _alt,\n    zero: exports.zero\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Extend = {\n    URI: exports.URI,\n    map: _map,\n    extend: _extend\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Compactable = {\n    URI: exports.URI,\n    compact: exports.compact,\n    separate: exports.separate\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Filterable = {\n    URI: exports.URI,\n    map: _map,\n    compact: exports.compact,\n    separate: exports.separate,\n    filter: _filter,\n    filterMap: _filterMap,\n    partition: _partition,\n    partitionMap: _partitionMap\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.FilterableWithIndex = {\n    URI: exports.URI,\n    map: _map,\n    mapWithIndex: _mapWithIndex,\n    compact: exports.compact,\n    separate: exports.separate,\n    filter: _filter,\n    filterMap: _filterMap,\n    partition: _partition,\n    partitionMap: _partitionMap,\n    partitionMapWithIndex: _partitionMapWithIndex,\n    partitionWithIndex: _partitionWithIndex,\n    filterMapWithIndex: _filterMapWithIndex,\n    filterWithIndex: _filterWithIndex\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Foldable = {\n    URI: exports.URI,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.FoldableWithIndex = {\n    URI: exports.URI,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    reduceWithIndex: _reduceWithIndex,\n    foldMapWithIndex: _foldMapWithIndex,\n    reduceRightWithIndex: _reduceRightWithIndex\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Traversable = {\n    URI: exports.URI,\n    map: _map,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    traverse: _traverse,\n    sequence: exports.sequence\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.TraversableWithIndex = {\n    URI: exports.URI,\n    map: _map,\n    mapWithIndex: _mapWithIndex,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    reduceWithIndex: _reduceWithIndex,\n    foldMapWithIndex: _foldMapWithIndex,\n    reduceRightWithIndex: _reduceRightWithIndex,\n    traverse: _traverse,\n    sequence: exports.sequence,\n    traverseWithIndex: _traverseWithIndex\n};\n/**\n * @category sequencing\n * @since 2.11.0\n */\nvar chainRecDepthFirst = function (f) {\n    return function (a) {\n        var todo = __spreadArray([], f(a), true);\n        var out = [];\n        while (todo.length > 0) {\n            var e = todo.shift();\n            if (_.isLeft(e)) {\n                todo.unshift.apply(todo, f(e.left));\n            }\n            else {\n                out.push(e.right);\n            }\n        }\n        return out;\n    };\n};\nexports.chainRecDepthFirst = chainRecDepthFirst;\n/**\n * @category instances\n * @since 2.11.0\n */\nexports.ChainRecDepthFirst = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    chain: exports.flatMap,\n    chainRec: exports._chainRecDepthFirst\n};\n/**\n * @category sequencing\n * @since 2.11.0\n */\nvar chainRecBreadthFirst = function (f) {\n    return function (a) {\n        var initial = f(a);\n        var todo = [];\n        var out = [];\n        function go(e) {\n            if (_.isLeft(e)) {\n                f(e.left).forEach(function (v) { return todo.push(v); });\n            }\n            else {\n                out.push(e.right);\n            }\n        }\n        for (var _i = 0, initial_1 = initial; _i < initial_1.length; _i++) {\n            var e = initial_1[_i];\n            go(e);\n        }\n        while (todo.length > 0) {\n            go(todo.shift());\n        }\n        return out;\n    };\n};\nexports.chainRecBreadthFirst = chainRecBreadthFirst;\n/**\n * @category instances\n * @since 2.11.0\n */\nexports.ChainRecBreadthFirst = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    chain: exports.flatMap,\n    chainRec: exports._chainRecBreadthFirst\n};\nvar _wither = /*#__PURE__*/ (0, Witherable_1.witherDefault)(exports.Traversable, exports.Compactable);\nvar _wilt = /*#__PURE__*/ (0, Witherable_1.wiltDefault)(exports.Traversable, exports.Compactable);\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Witherable = {\n    URI: exports.URI,\n    map: _map,\n    compact: exports.compact,\n    separate: exports.separate,\n    filter: _filter,\n    filterMap: _filterMap,\n    partition: _partition,\n    partitionMap: _partitionMap,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    traverse: _traverse,\n    sequence: exports.sequence,\n    wither: _wither,\n    wilt: _wilt\n};\n/**\n * Filter values inside a context.\n *\n * @example\n * import { pipe } from 'fp-ts/function'\n * import * as RA from 'fp-ts/ReadonlyArray'\n * import * as T from 'fp-ts/Task'\n *\n * const filterE = RA.filterE(T.ApplicativePar)\n * async function test() {\n *   assert.deepStrictEqual(\n *     await pipe(\n *       [-1, 2, 3],\n *       filterE((n) => T.of(n > 0))\n *     )(),\n *     [2, 3]\n *   )\n * }\n * test()\n *\n * @since 2.11.0\n */\nexports.filterE = (0, Witherable_1.filterE)(exports.Witherable);\n/**\n * @category instances\n * @since 2.11.0\n */\nexports.FromEither = {\n    URI: exports.URI,\n    fromEither: exports.fromEither\n};\n/**\n * @category lifting\n * @since 2.11.0\n */\nexports.fromEitherK = (0, FromEither_1.fromEitherK)(exports.FromEither);\n// -------------------------------------------------------------------------------------\n// unsafe\n// -------------------------------------------------------------------------------------\n/**\n * @category unsafe\n * @since 2.5.0\n */\nexports.unsafeInsertAt = RNEA.unsafeInsertAt;\n/**\n * @category unsafe\n * @since 2.5.0\n */\nvar unsafeUpdateAt = function (i, a, as) {\n    return (0, exports.isNonEmpty)(as) ? RNEA.unsafeUpdateAt(i, a, as) : as;\n};\nexports.unsafeUpdateAt = unsafeUpdateAt;\n/**\n * @category unsafe\n * @since 2.5.0\n */\nvar unsafeDeleteAt = function (i, as) {\n    var xs = as.slice();\n    xs.splice(i, 1);\n    return xs;\n};\nexports.unsafeDeleteAt = unsafeDeleteAt;\n/**\n * @category conversions\n * @since 2.5.0\n */\nvar toArray = function (as) { return as.slice(); };\nexports.toArray = toArray;\n/**\n * @category conversions\n * @since 2.5.0\n */\nvar fromArray = function (as) { return ((0, exports.isEmpty)(as) ? exports.empty : as.slice()); };\nexports.fromArray = fromArray;\n// -------------------------------------------------------------------------------------\n// utils\n// -------------------------------------------------------------------------------------\n/**\n * An empty array\n *\n * @since 2.5.0\n */\nexports.empty = RNEA.empty;\nfunction every(predicate) {\n    return function (as) { return as.every(predicate); };\n}\nexports.every = every;\n/**\n * Check if a predicate holds true for any array member.\n *\n * @example\n * import { some } from 'fp-ts/ReadonlyArray'\n * import { pipe } from 'fp-ts/function'\n *\n * const isPositive = (n: number): boolean => n > 0\n *\n * assert.deepStrictEqual(pipe([-1, -2, 3], some(isPositive)), true)\n * assert.deepStrictEqual(pipe([-1, -2, -3], some(isPositive)), false)\n *\n * @since 2.9.0\n */\nvar some = function (predicate) {\n    return function (as) {\n        return as.some(predicate);\n    };\n};\nexports.some = some;\n/**\n * Alias of [`some`](#some)\n *\n * @since 2.11.0\n */\nexports.exists = exports.some;\n/**\n * Places an element in between members of a `ReadonlyArray`, then folds the results using the provided `Monoid`.\n *\n * @example\n * import * as S from 'fp-ts/string'\n * import { intercalate } from 'fp-ts/ReadonlyArray'\n *\n * assert.deepStrictEqual(intercalate(S.Monoid)('-')(['a', 'b', 'c']), 'a-b-c')\n *\n * @since 2.12.0\n */\nvar intercalate = function (M) {\n    var intercalateM = RNEA.intercalate(M);\n    return function (middle) { return (0, exports.match)(function () { return M.empty; }, intercalateM(middle)); };\n};\nexports.intercalate = intercalate;\n// -------------------------------------------------------------------------------------\n// do notation\n// -------------------------------------------------------------------------------------\n/**\n * @category do notation\n * @since 2.9.0\n */\nexports.Do = (0, exports.of)(_.emptyRecord);\n/**\n * @category do notation\n * @since 2.8.0\n */\nexports.bindTo = (0, Functor_1.bindTo)(exports.Functor);\nvar let_ = /*#__PURE__*/ (0, Functor_1.let)(exports.Functor);\nexports.let = let_;\n/**\n * @category do notation\n * @since 2.8.0\n */\nexports.bind = (0, Chain_1.bind)(exports.Chain);\n/**\n * @category do notation\n * @since 2.8.0\n */\nexports.apS = (0, Apply_1.apS)(exports.Apply);\n// -------------------------------------------------------------------------------------\n// legacy\n// -------------------------------------------------------------------------------------\n/**\n * Alias of `flatMap`.\n *\n * @category legacy\n * @since 2.5.0\n */\nexports.chain = exports.flatMap;\n// -------------------------------------------------------------------------------------\n// deprecated\n// -------------------------------------------------------------------------------------\n/**\n * Use `ReadonlyNonEmptyArray` module instead.\n *\n * @category zone of death\n * @since 2.5.0\n * @deprecated\n */\nexports.range = RNEA.range;\n/**\n * Use [`prepend`](#prepend) instead.\n *\n * @category zone of death\n * @since 2.5.0\n * @deprecated\n */\nexports.cons = RNEA.cons;\n/**\n * Use [`append`](#append) instead.\n *\n * @category zone of death\n * @since 2.5.0\n * @deprecated\n */\nexports.snoc = RNEA.snoc;\n/**\n * Use [`prependAll`](#prependall) instead.\n *\n * @category zone of death\n * @since 2.9.0\n * @deprecated\n */\nexports.prependToAll = exports.prependAll;\n/**\n * This instance is deprecated, use small, specific instances instead.\n * For example if a function needs a `Functor` instance, pass `RA.Functor` instead of `RA.readonlyArray`\n * (where `RA` is from `import RA from 'fp-ts/ReadonlyArray'`)\n *\n * @category zone of death\n * @since 2.5.0\n * @deprecated\n */\nexports.readonlyArray = {\n    URI: exports.URI,\n    compact: exports.compact,\n    separate: exports.separate,\n    map: _map,\n    ap: _ap,\n    of: exports.of,\n    chain: exports.flatMap,\n    filter: _filter,\n    filterMap: _filterMap,\n    partition: _partition,\n    partitionMap: _partitionMap,\n    mapWithIndex: _mapWithIndex,\n    partitionMapWithIndex: _partitionMapWithIndex,\n    partitionWithIndex: _partitionWithIndex,\n    filterMapWithIndex: _filterMapWithIndex,\n    filterWithIndex: _filterWithIndex,\n    alt: _alt,\n    zero: exports.zero,\n    unfold: exports.unfold,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    traverse: _traverse,\n    sequence: exports.sequence,\n    reduceWithIndex: _reduceWithIndex,\n    foldMapWithIndex: _foldMapWithIndex,\n    reduceRightWithIndex: _reduceRightWithIndex,\n    traverseWithIndex: _traverseWithIndex,\n    extend: _extend,\n    wither: _wither,\n    wilt: _wilt\n};\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.lefts = exports.rights = exports.reverse = exports.modifyAt = exports.deleteAt = exports.updateAt = exports.insertAt = exports.copy = exports.findLastIndex = exports.findLastMap = exports.findLast = exports.findFirstMap = exports.findFirst = exports.findIndex = exports.dropLeftWhile = exports.dropRight = exports.dropLeft = exports.spanLeft = exports.takeLeftWhile = exports.takeRight = exports.takeLeft = exports.init = exports.tail = exports.last = exports.head = exports.lookup = exports.isOutOfBound = exports.size = exports.scanRight = exports.scanLeft = exports.chainWithIndex = exports.foldRight = exports.matchRight = exports.matchRightW = exports.foldLeft = exports.matchLeft = exports.matchLeftW = exports.match = exports.matchW = exports.fromEither = exports.fromOption = exports.fromPredicate = exports.replicate = exports.makeBy = exports.appendW = exports.append = exports.prependW = exports.prepend = exports.isNonEmpty = exports.isEmpty = void 0;\nexports.traverseWithIndex = exports.sequence = exports.traverse = exports.reduceRightWithIndex = exports.reduceRight = exports.reduceWithIndex = exports.reduce = exports.foldMapWithIndex = exports.foldMap = exports.duplicate = exports.extend = exports.filterWithIndex = exports.alt = exports.altW = exports.partitionMapWithIndex = exports.partitionMap = exports.partitionWithIndex = exports.partition = exports.filter = exports.separate = exports.compact = exports.filterMap = exports.filterMapWithIndex = exports.mapWithIndex = exports.flatten = exports.flatMap = exports.ap = exports.map = exports.zero = exports.of = exports.difference = exports.intersection = exports.union = exports.concat = exports.concatW = exports.comprehension = exports.fromOptionK = exports.chunksOf = exports.splitAt = exports.chop = exports.sortBy = exports.uniq = exports.elem = exports.rotate = exports.intersperse = exports.prependAll = exports.unzip = exports.zip = exports.zipWith = exports.sort = void 0;\nexports.some = exports.every = exports.unsafeDeleteAt = exports.unsafeUpdateAt = exports.unsafeInsertAt = exports.fromEitherK = exports.FromEither = exports.filterE = exports.ChainRecBreadthFirst = exports.chainRecBreadthFirst = exports.ChainRecDepthFirst = exports.chainRecDepthFirst = exports.Witherable = exports.TraversableWithIndex = exports.Traversable = exports.FoldableWithIndex = exports.Foldable = exports.FilterableWithIndex = exports.Filterable = exports.Compactable = exports.Extend = exports.Alternative = exports.guard = exports.Zero = exports.Alt = exports.Unfoldable = exports.Monad = exports.chainFirst = exports.Chain = exports.Applicative = exports.apSecond = exports.apFirst = exports.Apply = exports.FunctorWithIndex = exports.Pointed = exports.flap = exports.Functor = exports.getDifferenceMagma = exports.getIntersectionSemigroup = exports.getUnionMonoid = exports.getUnionSemigroup = exports.getOrd = exports.getEq = exports.getMonoid = exports.getSemigroup = exports.getShow = exports.URI = exports.unfold = exports.wilt = exports.wither = void 0;\nexports.array = exports.prependToAll = exports.snoc = exports.cons = exports.empty = exports.range = exports.chain = exports.apS = exports.bind = exports.let = exports.bindTo = exports.Do = exports.intercalate = exports.exists = void 0;\nvar Apply_1 = require(\"./Apply\");\nvar Chain_1 = require(\"./Chain\");\nvar FromEither_1 = require(\"./FromEither\");\nvar function_1 = require(\"./function\");\nvar Functor_1 = require(\"./Functor\");\nvar _ = __importStar(require(\"./internal\"));\nvar NEA = __importStar(require(\"./NonEmptyArray\"));\nvar RA = __importStar(require(\"./ReadonlyArray\"));\nvar Separated_1 = require(\"./Separated\");\nvar Witherable_1 = require(\"./Witherable\");\nvar Zero_1 = require(\"./Zero\");\n// -------------------------------------------------------------------------------------\n// refinements\n// -------------------------------------------------------------------------------------\n/**\n * Test whether an array is empty\n *\n * @example\n * import { isEmpty } from 'fp-ts/Array'\n *\n * assert.strictEqual(isEmpty([]), true)\n * assert.strictEqual(isEmpty(['a']), false)\n *\n * @category refinements\n * @since 2.0.0\n */\nvar isEmpty = function (as) { return as.length === 0; };\nexports.isEmpty = isEmpty;\n/**\n * Test whether an array is non empty narrowing down the type to `NonEmptyArray<A>`\n *\n * @example\n * import { isNonEmpty } from 'fp-ts/Array'\n *\n * assert.strictEqual(isNonEmpty([]), false)\n * assert.strictEqual(isNonEmpty(['a']), true)\n *\n * @category refinements\n * @since 2.0.0\n */\nexports.isNonEmpty = NEA.isNonEmpty;\n// -------------------------------------------------------------------------------------\n// constructors\n// -------------------------------------------------------------------------------------\n/**\n * Prepend an element to the front of a `Array`, creating a new `NonEmptyArray`.\n *\n * @example\n * import { prepend } from 'fp-ts/Array'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe([2, 3, 4], prepend(1)), [1, 2, 3, 4])\n *\n * @since 2.10.0\n */\nexports.prepend = NEA.prepend;\n/**\n * Less strict version of [`prepend`](#prepend).\n *\n * @example\n * import { prependW } from 'fp-ts/Array'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe([2, 3, 4], prependW(\"a\")), [\"a\", 2, 3, 4]);\n *\n * @since 2.11.0\n */\nexports.prependW = NEA.prependW;\n/**\n * Append an element to the end of a `Array`, creating a new `NonEmptyArray`.\n *\n * @example\n * import { append } from 'fp-ts/Array'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe([1, 2, 3], append(4)), [1, 2, 3, 4])\n *\n * @since 2.10.0\n */\nexports.append = NEA.append;\n/**\n * Less strict version of [`append`](#append).\n *\n * @example\n * import { appendW } from 'fp-ts/Array'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe([1, 2, 3], appendW(\"d\")), [1, 2, 3, \"d\"]);\n *\n * @since 2.11.0\n */\nexports.appendW = NEA.appendW;\n/**\n * Return a `Array` of length `n` with element `i` initialized with `f(i)`.\n *\n * **Note**. `n` is normalized to a non negative integer.\n *\n * @example\n * import { makeBy } from 'fp-ts/Array'\n *\n * const double = (i: number): number => i * 2\n * assert.deepStrictEqual(makeBy(5, double), [0, 2, 4, 6, 8])\n * assert.deepStrictEqual(makeBy(-3, double), [])\n * assert.deepStrictEqual(makeBy(4.32164, double), [0, 2, 4, 6])\n *\n * @category constructors\n * @since 2.0.0\n */\nvar makeBy = function (n, f) { return (n <= 0 ? [] : NEA.makeBy(f)(n)); };\nexports.makeBy = makeBy;\n/**\n * Create a `Array` containing a value repeated the specified number of times.\n *\n * **Note**. `n` is normalized to a non negative integer.\n *\n * @example\n * import { replicate } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(replicate(3, 'a'), ['a', 'a', 'a'])\n * assert.deepStrictEqual(replicate(-3, 'a'), [])\n * assert.deepStrictEqual(replicate(2.985647, 'a'), ['a', 'a'])\n *\n * @category constructors\n * @since 2.0.0\n */\nvar replicate = function (n, a) { return (0, exports.makeBy)(n, function () { return a; }); };\nexports.replicate = replicate;\nfunction fromPredicate(predicate) {\n    return function (a) { return (predicate(a) ? [a] : []); };\n}\nexports.fromPredicate = fromPredicate;\n// -------------------------------------------------------------------------------------\n// conversions\n// -------------------------------------------------------------------------------------\n/**\n * Create an array from an `Option`. The resulting array will contain the content of the\n * `Option` if it is `Some` and it will be empty if the `Option` is `None`.\n *\n * @example\n * import { fromOption } from 'fp-ts/Array'\n * import { option } from \"fp-ts\";\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe(option.some(\"a\"), fromOption),[\"a\"])\n * assert.deepStrictEqual(pipe(option.none, fromOption),[])\n *\n * @category conversions\n * @since 2.11.0\n */\nvar fromOption = function (ma) { return (_.isNone(ma) ? [] : [ma.value]); };\nexports.fromOption = fromOption;\n/**\n * Create an array from an `Either`. The resulting array will contain the content of the\n * `Either` if it is `Right` and it will be empty if the `Either` is `Left`.\n *\n * @example\n * import { fromEither } from 'fp-ts/Array'\n * import { either } from \"fp-ts\";\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe(either.right(\"r\"), fromEither), [\"r\"]);\n * assert.deepStrictEqual(pipe(either.left(\"l\"), fromEither), []);\n *\n * @category conversions\n * @since 2.11.0\n */\nvar fromEither = function (e) { return (_.isLeft(e) ? [] : [e.right]); };\nexports.fromEither = fromEither;\n/**\n * Less strict version of [`match`](#match).\n *\n * The `W` suffix (short for **W**idening) means that the handler return types will be merged.\n *\n * @example\n * import { matchW } from 'fp-ts/Array'\n * import { pipe } from 'fp-ts/function'\n *\n * const matcherW = matchW(\n *   () => \"No elements\",\n *   (as) => as.length\n * );\n * assert.deepStrictEqual(pipe([1, 2, 3, 4], matcherW), 4);\n * assert.deepStrictEqual(pipe([], matcherW), \"No elements\");\n *\n * @category pattern matching\n * @since 2.11.0\n */\nvar matchW = function (onEmpty, onNonEmpty) {\n    return function (as) {\n        return (0, exports.isNonEmpty)(as) ? onNonEmpty(as) : onEmpty();\n    };\n};\nexports.matchW = matchW;\n/**\n * Takes an array, if the array is empty it returns the result of `onEmpty`, otherwise\n * it passes the array to `onNonEmpty` and returns the result.\n *\n * @example\n * import { match } from 'fp-ts/Array'\n * import { pipe } from 'fp-ts/function'\n *\n * const matcher = match(\n *   () => \"No elements\",\n *   (as) => `Found ${as.length} element(s)`\n * );\n * assert.deepStrictEqual(pipe([1, 2, 3, 4], matcher), \"Found 4 element(s)\");\n * assert.deepStrictEqual(pipe([], matcher), \"No elements\");\n *\n * @category pattern matching\n * @since 2.11.0\n */\nexports.match = exports.matchW;\n/**\n * Less strict version of [`matchLeft`](#matchleft). It will work when `onEmpty` and\n * `onNonEmpty` have different return types.\n *\n * @example\n * import { matchLeftW } from 'fp-ts/Array'\n *\n * const f = matchLeftW(\n *   () => 0,\n *   (head: string, tail: string[]) => `Found \"${head}\" followed by ${tail.length} elements`\n * );\n * assert.strictEqual(f([\"a\", \"b\", \"c\"]), 'Found \"a\" followed by 2 elements');\n * assert.strictEqual(f([]), 0);\n *\n * @category pattern matching\n * @since 2.11.0\n */\nvar matchLeftW = function (onEmpty, onNonEmpty) {\n    return function (as) {\n        return (0, exports.isNonEmpty)(as) ? onNonEmpty(NEA.head(as), NEA.tail(as)) : onEmpty();\n    };\n};\nexports.matchLeftW = matchLeftW;\n/**\n * Takes an array, if the array is empty it returns the result of `onEmpty`, otherwise\n * it passes the array to `onNonEmpty` broken into its first element and remaining elements.\n *\n * @example\n * import { matchLeft } from 'fp-ts/Array'\n *\n * const len: <A>(as: Array<A>) => number = matchLeft(() => 0, (_, tail) => 1 + len(tail))\n * assert.strictEqual(len([1, 2, 3]), 3)\n *\n * @category pattern matching\n * @since 2.10.0\n */\nexports.matchLeft = exports.matchLeftW;\n/**\n * Alias of [`matchLeft`](#matchleft).\n *\n * @category pattern matching\n * @since 2.0.0\n */\nexports.foldLeft = exports.matchLeft;\n/**\n * Less strict version of [`matchRight`](#matchright). It will work when `onEmpty` and\n * `onNonEmpty` have different return types.\n *\n * @example\n * import { matchRightW } from 'fp-ts/Array'\n *\n * const f = matchRightW(\n *   () => 0,\n *   (head: string[], tail: string) => `Found ${head.length} elements folllowed by \"${tail}\"`\n * );\n * assert.strictEqual(f([\"a\", \"b\", \"c\"]), 'Found 2 elements folllowed by \"c\"');\n * assert.strictEqual(f([]), 0);\n *\n * @category pattern matching\n * @since 2.11.0\n */\nvar matchRightW = function (onEmpty, onNonEmpty) {\n    return function (as) {\n        return (0, exports.isNonEmpty)(as) ? onNonEmpty(NEA.init(as), NEA.last(as)) : onEmpty();\n    };\n};\nexports.matchRightW = matchRightW;\n/**\n * Takes an array, if the array is empty it returns the result of `onEmpty`, otherwise\n * it passes the array to `onNonEmpty` broken  into its initial elements and the last element.\n *\n * @example\n * import { matchRight } from 'fp-ts/Array'\n *\n * const len: <A>(as: Array<A>) => number = matchRight(\n *   () => 0,\n *   (head, _) => 1 + len(head)\n * );\n * assert.strictEqual(len([1, 2, 3]), 3);\n *\n * @category pattern matching\n * @since 2.10.0\n */\nexports.matchRight = exports.matchRightW;\n/**\n * Alias of [`matchRight`](#matchright).\n *\n * @category pattern matching\n * @since 2.0.0\n */\nexports.foldRight = exports.matchRight;\n// -------------------------------------------------------------------------------------\n// combinators\n// -------------------------------------------------------------------------------------\n/**\n * Same as [`chain`](#chain), but passing also the index to the iterating function.\n *\n * @example\n * import { chainWithIndex, replicate } from 'fp-ts/Array'\n * import { pipe } from 'fp-ts/function'\n *\n * const f = (index: number, x: string) => replicate(2, `${x}${index}`);\n * assert.deepStrictEqual(pipe([\"a\", \"b\", \"c\"], chainWithIndex(f)), [\"a0\", \"a0\", \"b1\", \"b1\", \"c2\", \"c2\"]);\n *\n * @category sequencing\n * @since 2.7.0\n */\nvar chainWithIndex = function (f) {\n    return function (as) {\n        var out = [];\n        for (var i = 0; i < as.length; i++) {\n            out.push.apply(out, f(i, as[i]));\n        }\n        return out;\n    };\n};\nexports.chainWithIndex = chainWithIndex;\n/**\n * Same as `reduce` but it carries over the intermediate steps\n *\n * @example\n * import { scanLeft } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(scanLeft(10, (b, a: number) => b - a)([1, 2, 3]), [10, 9, 7, 4])\n *\n * @since 2.0.0\n */\nvar scanLeft = function (b, f) {\n    return function (as) {\n        var len = as.length;\n        var out = new Array(len + 1);\n        out[0] = b;\n        for (var i = 0; i < len; i++) {\n            out[i + 1] = f(out[i], as[i]);\n        }\n        return out;\n    };\n};\nexports.scanLeft = scanLeft;\n/**\n * Fold an array from the right, keeping all intermediate results instead of only the final result\n *\n * @example\n * import { scanRight } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(scanRight(10, (a: number, b) => b - a)([1, 2, 3]), [4, 5, 7, 10])\n *\n * @since 2.0.0\n */\nvar scanRight = function (b, f) {\n    return function (as) {\n        var len = as.length;\n        var out = new Array(len + 1);\n        out[len] = b;\n        for (var i = len - 1; i >= 0; i--) {\n            out[i] = f(as[i], out[i + 1]);\n        }\n        return out;\n    };\n};\nexports.scanRight = scanRight;\n/**\n * Calculate the number of elements in a `Array`.\n *\n * @example\n * import { size } from 'fp-ts/Array'\n *\n * assert.strictEqual(size([\"a\",\"b\",\"c\"]),3)\n *\n * @since 2.10.0\n */\nvar size = function (as) { return as.length; };\nexports.size = size;\n/**\n * Test whether an array contains a particular index\n *\n * @example\n * import { isOutOfBound } from 'fp-ts/Array'\n *\n * assert.strictEqual(isOutOfBound(1,[\"a\",\"b\",\"c\"]),false)\n * assert.strictEqual(isOutOfBound(-1,[\"a\",\"b\",\"c\"]),true)\n * assert.strictEqual(isOutOfBound(3,[\"a\",\"b\",\"c\"]),true)\n *\n * @since 2.0.0\n */\nexports.isOutOfBound = NEA.isOutOfBound;\n// TODO: remove non-curried overloading in v3\n/**\n * This function provides a safe way to read a value at a particular index from an array.\n * It returns a `none` if the index is out of bounds, and a `some` of the element if the\n * index is valid.\n *\n * @example\n * import { lookup } from 'fp-ts/Array'\n * import { some, none } from 'fp-ts/Option'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe([1, 2, 3], lookup(1)), some(2))\n * assert.deepStrictEqual(pipe([1, 2, 3], lookup(3)), none)\n *\n * @since 2.0.0\n */\nexports.lookup = RA.lookup;\n/**\n * Get the first element in an array, or `None` if the array is empty\n *\n * @example\n * import { head } from 'fp-ts/Array'\n * import { some, none } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(head([1, 2, 3]), some(1))\n * assert.deepStrictEqual(head([]), none)\n *\n * @since 2.0.0\n */\nexports.head = RA.head;\n/**\n * Get the last element in an array, or `None` if the array is empty\n *\n * @example\n * import { last } from 'fp-ts/Array'\n * import { some, none } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(last([1, 2, 3]), some(3))\n * assert.deepStrictEqual(last([]), none)\n *\n * @since 2.0.0\n */\nexports.last = RA.last;\n/**\n * Get all but the first element of an array, creating a new array, or `None` if the array is empty\n *\n * @example\n * import { tail } from 'fp-ts/Array'\n * import { some, none } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(tail([1, 2, 3]), some([2, 3]))\n * assert.deepStrictEqual(tail([]), none)\n *\n * @since 2.0.0\n */\nvar tail = function (as) { return ((0, exports.isNonEmpty)(as) ? _.some(NEA.tail(as)) : _.none); };\nexports.tail = tail;\n/**\n * Get all but the last element of an array, creating a new array, or `None` if the array is empty\n *\n * @example\n * import { init } from 'fp-ts/Array'\n * import { some, none } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(init([1, 2, 3]), some([1, 2]))\n * assert.deepStrictEqual(init([]), none)\n *\n * @since 2.0.0\n */\nvar init = function (as) { return ((0, exports.isNonEmpty)(as) ? _.some(NEA.init(as)) : _.none); };\nexports.init = init;\n/**\n * Keep only a max number of elements from the start of an `Array`, creating a new `Array`.\n *\n * **Note**. `n` is normalized to a non negative integer.\n *\n * @example\n * import { takeLeft } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(takeLeft(2)([1, 2, 3, 4, 5]), [1, 2]);\n * assert.deepStrictEqual(takeLeft(7)([1, 2, 3, 4, 5]), [1, 2, 3, 4, 5]);\n * assert.deepStrictEqual(takeLeft(0)([1, 2, 3, 4, 5]), []);\n * assert.deepStrictEqual(takeLeft(-1)([1, 2, 3, 4, 5]), [1, 2, 3, 4, 5]);\n *\n * @since 2.0.0\n */\nvar takeLeft = function (n) {\n    return function (as) {\n        return (0, exports.isOutOfBound)(n, as) ? (0, exports.copy)(as) : as.slice(0, n);\n    };\n};\nexports.takeLeft = takeLeft;\n/**\n * Keep only a max number of elements from the end of an `Array`, creating a new `Array`.\n *\n * **Note**. `n` is normalized to a non negative integer.\n *\n * @example\n * import { takeRight } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(takeRight(2)([1, 2, 3, 4, 5]), [4, 5]);\n * assert.deepStrictEqual(takeRight(7)([1, 2, 3, 4, 5]), [1, 2, 3, 4, 5]);\n * assert.deepStrictEqual(takeRight(0)([1, 2, 3, 4, 5]), []);\n * assert.deepStrictEqual(takeRight(-1)([1, 2, 3, 4, 5]), [1, 2, 3, 4, 5]);\n *\n * @since 2.0.0\n */\nvar takeRight = function (n) {\n    return function (as) {\n        return (0, exports.isOutOfBound)(n, as) ? (0, exports.copy)(as) : n === 0 ? [] : as.slice(-n);\n    };\n};\nexports.takeRight = takeRight;\nfunction takeLeftWhile(predicate) {\n    return function (as) {\n        var out = [];\n        for (var _i = 0, as_1 = as; _i < as_1.length; _i++) {\n            var a = as_1[_i];\n            if (!predicate(a)) {\n                break;\n            }\n            out.push(a);\n        }\n        return out;\n    };\n}\nexports.takeLeftWhile = takeLeftWhile;\nvar spanLeftIndex = function (as, predicate) {\n    var l = as.length;\n    var i = 0;\n    for (; i < l; i++) {\n        if (!predicate(as[i])) {\n            break;\n        }\n    }\n    return i;\n};\nfunction spanLeft(predicate) {\n    return function (as) {\n        var _a = (0, exports.splitAt)(spanLeftIndex(as, predicate))(as), init = _a[0], rest = _a[1];\n        return { init: init, rest: rest };\n    };\n}\nexports.spanLeft = spanLeft;\n/**\n * Creates a new `Array` which is a copy of the input dropping a max number of elements from the start.\n *\n * **Note**. `n` is normalized to a non negative integer.\n *\n * @example\n * import { dropLeft } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(dropLeft(2)([1, 2, 3]), [3]);\n * assert.deepStrictEqual(dropLeft(5)([1, 2, 3]), []);\n * assert.deepStrictEqual(dropLeft(0)([1, 2, 3]), [1, 2, 3]);\n * assert.deepStrictEqual(dropLeft(-2)([1, 2, 3]), [1, 2, 3]);\n *\n * @since 2.0.0\n */\nvar dropLeft = function (n) {\n    return function (as) {\n        return n <= 0 || (0, exports.isEmpty)(as) ? (0, exports.copy)(as) : n >= as.length ? [] : as.slice(n, as.length);\n    };\n};\nexports.dropLeft = dropLeft;\n/**\n * Creates a new `Array` which is a copy of the input dropping a max number of elements from the end.\n *\n * **Note**. `n` is normalized to a non negative integer.\n *\n * @example\n * import { dropRight } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(dropRight(2)([1, 2, 3]), [1]);\n * assert.deepStrictEqual(dropRight(5)([1, 2, 3]), []);\n * assert.deepStrictEqual(dropRight(0)([1, 2, 3]), [1, 2, 3]);\n * assert.deepStrictEqual(dropRight(-2)([1, 2, 3]), [1, 2, 3]);\n *\n * @since 2.0.0\n */\nvar dropRight = function (n) {\n    return function (as) {\n        return n <= 0 || (0, exports.isEmpty)(as) ? (0, exports.copy)(as) : n >= as.length ? [] : as.slice(0, as.length - n);\n    };\n};\nexports.dropRight = dropRight;\nfunction dropLeftWhile(predicate) {\n    return function (as) { return as.slice(spanLeftIndex(as, predicate)); };\n}\nexports.dropLeftWhile = dropLeftWhile;\n/**\n * `findIndex` returns an `Option` containing the first index for which a predicate holds.\n * It returns `None` if no element satisfies the predicate.\n * Similar to [`findFirst`](#findFirst) but returning the index instead of the element.\n *\n * @example\n * import { findIndex } from 'fp-ts/Array'\n * import { some, none } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(findIndex((n: number) => n === 2)([1, 2, 3]), some(1))\n * assert.deepStrictEqual(findIndex((n: number) => n === 2)([]), none)\n *\n * @since 2.0.0\n */\nexports.findIndex = RA.findIndex;\nfunction findFirst(predicate) {\n    return RA.findFirst(predicate);\n}\nexports.findFirst = findFirst;\n/**\n * Given a selector function which takes an element and returns an option,\n * this function applies the selector to each element of the array and\n * returns the first `Some` result. Otherwise it returns `None`.\n *\n * @example\n * import { findFirstMap } from 'fp-ts/Array'\n * import { some, none } from 'fp-ts/Option'\n *\n * interface Person {\n *   readonly name: string;\n *   readonly age: number;\n * }\n *\n * const persons: Array<Person> = [\n *   { name: \"John\", age: 16 },\n *   { name: \"Mary\", age: 45 },\n *   { name: \"Joey\", age: 28 },\n * ];\n *\n * const nameOfPersonAbove18 = (p: Person) => (p.age <= 18 ? none : some(p.name));\n * const nameOfPersonAbove70 = (p: Person) => (p.age <= 70 ? none : some(p.name));\n * assert.deepStrictEqual(findFirstMap(nameOfPersonAbove18)(persons), some(\"Mary\"));\n * assert.deepStrictEqual(findFirstMap(nameOfPersonAbove70)(persons), none);\n *\n * @since 2.0.0\n */\nexports.findFirstMap = RA.findFirstMap;\nfunction findLast(predicate) {\n    return RA.findLast(predicate);\n}\nexports.findLast = findLast;\n/**\n * Given a selector function which takes an element and returns an option,\n * this function applies the selector to each element of the array starting from the\n * end and returns the last `Some` result. Otherwise it returns `None`.\n *\n * @example\n * import { findLastMap } from 'fp-ts/Array'\n * import { some, none } from 'fp-ts/Option'\n *\n * interface Person {\n *   readonly name: string;\n *   readonly age: number;\n * }\n *\n * const persons: Array<Person> = [\n *   { name: \"John\", age: 16 },\n *   { name: \"Mary\", age: 45 },\n *   { name: \"Joey\", age: 28 },\n * ];\n *\n * const nameOfPersonAbove18 = (p: Person) => (p.age <= 18 ? none : some(p.name));\n * const nameOfPersonAbove70 = (p: Person) => (p.age <= 70 ? none : some(p.name));\n * assert.deepStrictEqual(findLastMap(nameOfPersonAbove18)(persons), some(\"Joey\"));\n * assert.deepStrictEqual(findLastMap(nameOfPersonAbove70)(persons), none);\n *\n * @since 2.0.0\n */\nexports.findLastMap = RA.findLastMap;\n/**\n * Returns the index of the last element of the list which matches the predicate.\n * It returns an `Option` containing the index or `None` if not found.\n *\n * @example\n * import { findLastIndex } from 'fp-ts/Array'\n * import { some, none } from 'fp-ts/Option'\n *\n * interface X {\n *   readonly a: number\n *   readonly b: number\n * }\n * const xs: Array<X> = [{ a: 1, b: 0 }, { a: 1, b: 1 }]\n * assert.deepStrictEqual(findLastIndex((x: { readonly a: number }) => x.a === 1)(xs), some(1))\n * assert.deepStrictEqual(findLastIndex((x: { readonly a: number }) => x.a === 4)(xs), none)\n *\n * @since 2.0.0\n */\nexports.findLastIndex = RA.findLastIndex;\n/**\n * This function takes an array and makes a new array containing the same elements.\n *\n * @since 2.0.0\n */\nvar copy = function (as) { return as.slice(); };\nexports.copy = copy;\n/**\n * Insert an element at the specified index, creating a new array,\n * or returning `None` if the index is out of bounds.\n *\n * @example\n * import { insertAt } from 'fp-ts/Array'\n * import { some } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(insertAt(2, 5)([1, 2, 3, 4]), some([1, 2, 5, 3, 4]))\n *\n * @since 2.0.0\n */\nvar insertAt = function (i, a) {\n    return function (as) {\n        return i < 0 || i > as.length ? _.none : _.some((0, exports.unsafeInsertAt)(i, a, as));\n    };\n};\nexports.insertAt = insertAt;\n/**\n * Change the element at the specified index, creating a new array,\n * or returning `None` if the index is out of bounds.\n *\n * @example\n * import { updateAt } from 'fp-ts/Array'\n * import { some, none } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(updateAt(1, 1)([1, 2, 3]), some([1, 1, 3]))\n * assert.deepStrictEqual(updateAt(1, 1)([]), none)\n *\n * @since 2.0.0\n */\nvar updateAt = function (i, a) { return (0, exports.modifyAt)(i, function () { return a; }); };\nexports.updateAt = updateAt;\n/**\n * Delete the element at the specified index, creating a new array, or returning `None` if the index is out of bounds.\n *\n * @example\n * import { deleteAt } from 'fp-ts/Array'\n * import { some, none } from 'fp-ts/Option'\n *\n * assert.deepStrictEqual(deleteAt(0)([1, 2, 3]), some([2, 3]))\n * assert.deepStrictEqual(deleteAt(1)([]), none)\n *\n * @since 2.0.0\n */\nvar deleteAt = function (i) {\n    return function (as) {\n        return (0, exports.isOutOfBound)(i, as) ? _.none : _.some((0, exports.unsafeDeleteAt)(i, as));\n    };\n};\nexports.deleteAt = deleteAt;\n/**\n * Apply a function to the element at the specified index, creating a new array, or returning `None` if the index is out\n * of bounds.\n *\n * @example\n * import { modifyAt } from 'fp-ts/Array'\n * import { some, none } from 'fp-ts/Option'\n *\n * const double = (x: number): number => x * 2\n * assert.deepStrictEqual(modifyAt(1, double)([1, 2, 3]), some([1, 4, 3]))\n * assert.deepStrictEqual(modifyAt(1, double)([]), none)\n *\n * @since 2.0.0\n */\nvar modifyAt = function (i, f) {\n    return function (as) {\n        return (0, exports.isOutOfBound)(i, as) ? _.none : _.some((0, exports.unsafeUpdateAt)(i, f(as[i]), as));\n    };\n};\nexports.modifyAt = modifyAt;\n/**\n * Reverse an array, creating a new array\n *\n * @example\n * import { reverse } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(reverse([1, 2, 3]), [3, 2, 1])\n *\n * @since 2.0.0\n */\nvar reverse = function (as) { return ((0, exports.isEmpty)(as) ? [] : as.slice().reverse()); };\nexports.reverse = reverse;\n/**\n * Takes an `Array` of `Either` and produces a new `Array` containing\n * the values of all the `Right` elements in the same order.\n *\n * @example\n * import { rights } from 'fp-ts/Array'\n * import { right, left } from 'fp-ts/Either'\n *\n * assert.deepStrictEqual(rights([right(1), left('foo'), right(2)]), [1, 2])\n *\n * @since 2.0.0\n */\nvar rights = function (as) {\n    var r = [];\n    for (var i = 0; i < as.length; i++) {\n        var a = as[i];\n        if (a._tag === 'Right') {\n            r.push(a.right);\n        }\n    }\n    return r;\n};\nexports.rights = rights;\n/**\n * Takes an `Array` of `Either` and produces a new `Array` containing\n * the values of all the `Left` elements in the same order.\n *\n * @example\n * import { lefts } from 'fp-ts/Array'\n * import { left, right } from 'fp-ts/Either'\n *\n * assert.deepStrictEqual(lefts([right(1), left('foo'), right(2)]), ['foo'])\n *\n * @since 2.0.0\n */\nvar lefts = function (as) {\n    var r = [];\n    for (var i = 0; i < as.length; i++) {\n        var a = as[i];\n        if (a._tag === 'Left') {\n            r.push(a.left);\n        }\n    }\n    return r;\n};\nexports.lefts = lefts;\n/**\n * Sort the elements of an array in increasing order, creating a new array\n *\n * @example\n * import { sort } from 'fp-ts/Array'\n * import * as N from 'fp-ts/number'\n *\n * assert.deepStrictEqual(sort(N.Ord)([3, 2, 1]), [1, 2, 3])\n *\n * @since 2.0.0\n */\nvar sort = function (O) {\n    return function (as) {\n        return as.length <= 1 ? (0, exports.copy)(as) : as.slice().sort(O.compare);\n    };\n};\nexports.sort = sort;\n/**\n * Apply a function to pairs of elements at the same index in two arrays, collecting the results in a new array. If one\n * input array is short, excess elements of the longer array are discarded.\n *\n * @example\n * import { zipWith } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(zipWith([1, 2, 3], ['a', 'b', 'c', 'd'], (n, s) => s + n), ['a1', 'b2', 'c3'])\n *\n * @since 2.0.0\n */\nvar zipWith = function (fa, fb, f) {\n    var fc = [];\n    var len = Math.min(fa.length, fb.length);\n    for (var i = 0; i < len; i++) {\n        fc[i] = f(fa[i], fb[i]);\n    }\n    return fc;\n};\nexports.zipWith = zipWith;\nfunction zip(as, bs) {\n    if (bs === undefined) {\n        return function (bs) { return zip(bs, as); };\n    }\n    return (0, exports.zipWith)(as, bs, function (a, b) { return [a, b]; });\n}\nexports.zip = zip;\n/**\n * The function is reverse of `zip`. Takes an array of pairs and return two corresponding arrays\n *\n * @example\n * import { unzip } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(unzip([[1, 'a'], [2, 'b'], [3, 'c']]), [[1, 2, 3], ['a', 'b', 'c']])\n *\n * @since 2.0.0\n */\nvar unzip = function (as) {\n    var fa = [];\n    var fb = [];\n    for (var i = 0; i < as.length; i++) {\n        fa[i] = as[i][0];\n        fb[i] = as[i][1];\n    }\n    return [fa, fb];\n};\nexports.unzip = unzip;\n/**\n * Creates a new `Array`, prepending an element to every member of the input `Array`.\n *\n * @example\n * import { prependAll } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(prependAll(9)([1, 2, 3, 4]), [9, 1, 9, 2, 9, 3, 9, 4])\n *\n * @since 2.10.0\n */\nvar prependAll = function (middle) {\n    var f = NEA.prependAll(middle);\n    return function (as) { return ((0, exports.isNonEmpty)(as) ? f(as) : []); };\n};\nexports.prependAll = prependAll;\n/**\n * Creates a new `Array` placing an element in between members of the input `Array`.\n *\n * @example\n * import { intersperse } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(intersperse(9)([1, 2, 3, 4]), [1, 9, 2, 9, 3, 9, 4])\n *\n * @since 2.9.0\n */\nvar intersperse = function (middle) {\n    var f = NEA.intersperse(middle);\n    return function (as) { return ((0, exports.isNonEmpty)(as) ? f(as) : (0, exports.copy)(as)); };\n};\nexports.intersperse = intersperse;\n/**\n * Creates a new `Array` rotating the input `Array` by `n` steps.\n *\n * @example\n * import { rotate } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(rotate(2)([1, 2, 3, 4, 5]), [4, 5, 1, 2, 3])\n *\n * @since 2.0.0\n */\nvar rotate = function (n) {\n    var f = NEA.rotate(n);\n    return function (as) { return ((0, exports.isNonEmpty)(as) ? f(as) : (0, exports.copy)(as)); };\n};\nexports.rotate = rotate;\n// TODO: remove non-curried overloading in v3\n/**\n * Test if a value is a member of an `Array`. Takes a `Eq<A>` as a single\n * argument which returns the function to use to search for a value of type `A` in\n * an `Array<A>`.\n *\n * @example\n * import { elem } from 'fp-ts/Array'\n * import * as N from 'fp-ts/number'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.strictEqual(pipe([1, 2, 3], elem(N.Eq)(2)), true)\n * assert.strictEqual(pipe([1, 2, 3], elem(N.Eq)(0)), false)\n *\n * @since 2.0.0\n */\nexports.elem = RA.elem;\n/**\n * Creates a new `Array` removing duplicate elements, keeping the first occurrence of an element,\n * based on a `Eq<A>`.\n *\n * @example\n * import { uniq } from 'fp-ts/Array'\n * import * as N from 'fp-ts/number'\n *\n * assert.deepStrictEqual(uniq(N.Eq)([1, 2, 1]), [1, 2])\n *\n * @since 2.0.0\n */\nvar uniq = function (E) {\n    var f = NEA.uniq(E);\n    return function (as) { return ((0, exports.isNonEmpty)(as) ? f(as) : (0, exports.copy)(as)); };\n};\nexports.uniq = uniq;\n/**\n * Sort the elements of an array in increasing order, where elements are compared using first `ords[0]`, then `ords[1]`,\n * etc...\n *\n * @example\n * import { sortBy } from 'fp-ts/Array'\n * import { contramap } from 'fp-ts/Ord'\n * import * as S from 'fp-ts/string'\n * import * as N from 'fp-ts/number'\n * import { pipe } from 'fp-ts/function'\n *\n * interface Person {\n *   readonly name: string\n *   readonly age: number\n * }\n * const byName = pipe(S.Ord, contramap((p: Person) => p.name))\n * const byAge = pipe(N.Ord, contramap((p: Person) => p.age))\n *\n * const sortByNameByAge = sortBy([byName, byAge])\n *\n * const persons = [{ name: 'a', age: 1 }, { name: 'b', age: 3 }, { name: 'c', age: 2 }, { name: 'b', age: 2 }]\n * assert.deepStrictEqual(sortByNameByAge(persons), [\n *   { name: 'a', age: 1 },\n *   { name: 'b', age: 2 },\n *   { name: 'b', age: 3 },\n *   { name: 'c', age: 2 }\n * ])\n *\n * @since 2.0.0\n */\nvar sortBy = function (ords) {\n    var f = NEA.sortBy(ords);\n    return function (as) { return ((0, exports.isNonEmpty)(as) ? f(as) : (0, exports.copy)(as)); };\n};\nexports.sortBy = sortBy;\n/**\n * A useful recursion pattern for processing an array to produce a new array, often used for \"chopping\" up the input\n * array. Typically chop is called with some function that will consume an initial prefix of the array and produce a\n * value and the rest of the array.\n *\n * @example\n * import { Eq } from 'fp-ts/Eq'\n * import * as A from 'fp-ts/Array'\n * import * as N from 'fp-ts/number'\n * import { pipe } from 'fp-ts/function'\n *\n * const group = <A>(S: Eq<A>): ((as: Array<A>) => Array<Array<A>>) => {\n *   return A.chop(as => {\n *     const { init, rest } = pipe(as, A.spanLeft((a: A) => S.equals(a, as[0])))\n *     return [init, rest]\n *   })\n * }\n * assert.deepStrictEqual(group(N.Eq)([1, 1, 2, 3, 3, 4]), [[1, 1], [2], [3, 3], [4]])\n *\n * @since 2.0.0\n */\nvar chop = function (f) {\n    var g = NEA.chop(f);\n    return function (as) { return ((0, exports.isNonEmpty)(as) ? g(as) : []); };\n};\nexports.chop = chop;\n/**\n * Splits an `Array` into two pieces, the first piece has max `n` elements.\n *\n * @example\n * import { splitAt } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(splitAt(2)([1, 2, 3, 4, 5]), [[1, 2], [3, 4, 5]])\n *\n * @since 2.0.0\n */\nvar splitAt = function (n) {\n    return function (as) {\n        return n >= 1 && (0, exports.isNonEmpty)(as) ? NEA.splitAt(n)(as) : (0, exports.isEmpty)(as) ? [(0, exports.copy)(as), []] : [[], (0, exports.copy)(as)];\n    };\n};\nexports.splitAt = splitAt;\n/**\n * Splits an array into length-`n` pieces. The last piece will be shorter if `n` does not evenly divide the length of\n * the array. Note that `chunksOf(n)([])` is `[]`, not `[[]]`. This is intentional, and is consistent with a recursive\n * definition of `chunksOf`; it satisfies the property that\n *\n * ```ts\n * chunksOf(n)(xs).concat(chunksOf(n)(ys)) == chunksOf(n)(xs.concat(ys)))\n * ```\n *\n * whenever `n` evenly divides the length of `xs`.\n *\n * @example\n * import { chunksOf } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(chunksOf(2)([1, 2, 3, 4, 5]), [[1, 2], [3, 4], [5]])\n *\n * @since 2.0.0\n */\nvar chunksOf = function (n) {\n    var f = NEA.chunksOf(n);\n    return function (as) { return ((0, exports.isNonEmpty)(as) ? f(as) : []); };\n};\nexports.chunksOf = chunksOf;\n/**\n * @category lifting\n * @since 2.11.0\n */\nvar fromOptionK = function (f) {\n    return function () {\n        var a = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            a[_i] = arguments[_i];\n        }\n        return (0, exports.fromOption)(f.apply(void 0, a));\n    };\n};\nexports.fromOptionK = fromOptionK;\nfunction comprehension(input, f, g) {\n    if (g === void 0) { g = function () { return true; }; }\n    var go = function (scope, input) {\n        return (0, exports.isNonEmpty)(input)\n            ? (0, exports.flatMap)(NEA.head(input), function (a) { return go((0, function_1.pipe)(scope, (0, exports.append)(a)), NEA.tail(input)); })\n            : g.apply(void 0, scope) ? [f.apply(void 0, scope)]\n                : [];\n    };\n    return go([], input);\n}\nexports.comprehension = comprehension;\n/**\n * @since 2.11.0\n */\nvar concatW = function (second) {\n    return function (first) {\n        return (0, exports.isEmpty)(first) ? (0, exports.copy)(second) : (0, exports.isEmpty)(second) ? (0, exports.copy)(first) : first.concat(second);\n    };\n};\nexports.concatW = concatW;\n/**\n * @since 2.11.0\n */\nexports.concat = exports.concatW;\nfunction union(E) {\n    var unionE = NEA.union(E);\n    return function (first, second) {\n        if (second === undefined) {\n            var unionE_1 = union(E);\n            return function (second) { return unionE_1(second, first); };\n        }\n        return (0, exports.isNonEmpty)(first) && (0, exports.isNonEmpty)(second)\n            ? unionE(second)(first)\n            : (0, exports.isNonEmpty)(first)\n                ? (0, exports.copy)(first)\n                : (0, exports.copy)(second);\n    };\n}\nexports.union = union;\nfunction intersection(E) {\n    var elemE = (0, exports.elem)(E);\n    return function (xs, ys) {\n        if (ys === undefined) {\n            var intersectionE_1 = intersection(E);\n            return function (ys) { return intersectionE_1(ys, xs); };\n        }\n        return xs.filter(function (a) { return elemE(a, ys); });\n    };\n}\nexports.intersection = intersection;\nfunction difference(E) {\n    var elemE = (0, exports.elem)(E);\n    return function (xs, ys) {\n        if (ys === undefined) {\n            var differenceE_1 = difference(E);\n            return function (ys) { return differenceE_1(ys, xs); };\n        }\n        return xs.filter(function (a) { return !elemE(a, ys); });\n    };\n}\nexports.difference = difference;\nvar _map = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.map)(f)); };\n/* istanbul ignore next */\nvar _mapWithIndex = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.mapWithIndex)(f)); };\nvar _ap = function (fab, fa) { return (0, function_1.pipe)(fab, (0, exports.ap)(fa)); };\n/* istanbul ignore next */\nvar _filter = function (fa, predicate) { return (0, function_1.pipe)(fa, (0, exports.filter)(predicate)); };\n/* istanbul ignore next */\nvar _filterMap = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.filterMap)(f)); };\n/* istanbul ignore next */\nvar _partition = function (fa, predicate) {\n    return (0, function_1.pipe)(fa, (0, exports.partition)(predicate));\n};\n/* istanbul ignore next */\nvar _partitionMap = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.partitionMap)(f)); };\n/* istanbul ignore next */\nvar _partitionWithIndex = function (fa, predicateWithIndex) { return (0, function_1.pipe)(fa, (0, exports.partitionWithIndex)(predicateWithIndex)); };\n/* istanbul ignore next */\nvar _partitionMapWithIndex = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.partitionMapWithIndex)(f)); };\n/* istanbul ignore next */\nvar _alt = function (fa, that) { return (0, function_1.pipe)(fa, (0, exports.alt)(that)); };\nvar _reduce = function (fa, b, f) { return (0, function_1.pipe)(fa, (0, exports.reduce)(b, f)); };\n/* istanbul ignore next */\nvar _foldMap = function (M) {\n    var foldMapM = (0, exports.foldMap)(M);\n    return function (fa, f) { return (0, function_1.pipe)(fa, foldMapM(f)); };\n};\n/* istanbul ignore next */\nvar _reduceRight = function (fa, b, f) { return (0, function_1.pipe)(fa, (0, exports.reduceRight)(b, f)); };\n/* istanbul ignore next */\nvar _reduceWithIndex = function (fa, b, f) {\n    return (0, function_1.pipe)(fa, (0, exports.reduceWithIndex)(b, f));\n};\n/* istanbul ignore next */\nvar _foldMapWithIndex = function (M) {\n    var foldMapWithIndexM = (0, exports.foldMapWithIndex)(M);\n    return function (fa, f) { return (0, function_1.pipe)(fa, foldMapWithIndexM(f)); };\n};\n/* istanbul ignore next */\nvar _reduceRightWithIndex = function (fa, b, f) {\n    return (0, function_1.pipe)(fa, (0, exports.reduceRightWithIndex)(b, f));\n};\n/* istanbul ignore next */\nvar _filterMapWithIndex = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.filterMapWithIndex)(f)); };\n/* istanbul ignore next */\nvar _filterWithIndex = function (fa, predicateWithIndex) { return (0, function_1.pipe)(fa, (0, exports.filterWithIndex)(predicateWithIndex)); };\n/* istanbul ignore next */\nvar _extend = function (fa, f) { return (0, function_1.pipe)(fa, (0, exports.extend)(f)); };\n/* istanbul ignore next */\nvar _traverse = function (F) {\n    var traverseF = (0, exports.traverse)(F);\n    return function (ta, f) { return (0, function_1.pipe)(ta, traverseF(f)); };\n};\n/* istanbul ignore next */\nvar _traverseWithIndex = function (F) {\n    var traverseWithIndexF = (0, exports.traverseWithIndex)(F);\n    return function (ta, f) { return (0, function_1.pipe)(ta, traverseWithIndexF(f)); };\n};\nvar _chainRecDepthFirst = RA._chainRecDepthFirst;\nvar _chainRecBreadthFirst = RA._chainRecBreadthFirst;\n/**\n * Given an element of the base type, `of` builds an `Array` containing just that\n * element of the base type (this is useful for building a `Monad`).\n *\n * @example\n * import { of } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(of(\"a\"), [\"a\"]);\n *\n * @category constructors\n * @since 2.0.0\n */\nexports.of = NEA.of;\n/**\n * Makes an empty `Array`, useful for building a [`Monoid`](#Monoid)\n *\n * @since 2.7.0\n */\nvar zero = function () { return []; };\nexports.zero = zero;\n/**\n * `map` can be used to turn functions `(a: A) => B` into functions `(fa: Array<A>) => Array<B>`.\n * In practice it applies the base function to each element of the array and collects the\n * results in a new array.\n *\n * @example\n * import { map } from 'fp-ts/Array'\n * import { pipe } from 'fp-ts/function'\n *\n * const f = (n: number) => n * 2;\n * assert.deepStrictEqual(pipe([1, 2, 3], map(f)), [2, 4, 6]);\n *\n * @category mapping\n * @since 2.0.0\n */\nvar map = function (f) { return function (fa) { return fa.map(function (a) { return f(a); }); }; };\nexports.map = map;\n/**\n * @example\n * import { ap, map, of } from 'fp-ts/Array'\n * import { pipe } from 'fp-ts/function'\n *\n * // a curried function with 3 input parameteres\n * const f = (s1: string) => (n: number) => (s2: string) => s1 + n + s2;\n *\n * // let's use `ap` to iterate `f` over an array for each input parameter\n * assert.deepStrictEqual(pipe([\"a\", \"b\"], map(f), ap([1, 2]), ap([\"😀\", \"😫\", \"😎\"])), [\n *   \"a1😀\", \"a1😫\", \"a1😎\",\n *   \"a2😀\", \"a2😫\", \"a2😎\",\n *   \"b1😀\", \"b1😫\", \"b1😎\",\n *   \"b2😀\", \"b2😫\", \"b2😎\",\n * ]);\n *\n * // given Array implements the Applicative interface with the `of` method,\n * // we can write exactly the same thing in a more symmetric way\n * // using `of` on `f` and `ap` on each array in input\n * assert.deepStrictEqual(\n *   pipe(of(f), ap([\"a\", \"b\"]), ap([1, 2]), ap([\"😀\", \"😫\", \"😎\"])),\n *   pipe([\"a\", \"b\"], map(f), ap([1, 2]), ap([\"😀\", \"😫\", \"😎\"]))\n * );\n *\n * @since 2.0.0\n */\nvar ap = function (fa) {\n    return (0, exports.flatMap)(function (f) { return (0, function_1.pipe)(fa, (0, exports.map)(f)); });\n};\nexports.ap = ap;\n/**\n * Composes computations in sequence, using the return value of one computation to\n * determine the next computation.\n *\n * In other words it takes a function `f` that produces an array from a single element of\n * the base type `A` and returns a new function which applies `f` to each element of the\n * input array (like [`map`](#map)) and, instead of returning an array of arrays, concatenates the\n * results into a single array (like [`flatten`](#flatten)).\n *\n * @example\n * import { flatMap, map, replicate } from 'fp-ts/Array'\n * import { pipe } from 'fp-ts/function'\n *\n * const f = (n: number) => replicate(n, `${n}`);\n * assert.deepStrictEqual(pipe([1, 2, 3], map(f)), [[\"1\"], [\"2\", \"2\"], [\"3\", \"3\", \"3\"]]);\n * assert.deepStrictEqual(pipe([1, 2, 3], flatMap(f)), [\"1\", \"2\", \"2\", \"3\", \"3\", \"3\"]);\n *\n * @category sequencing\n * @since 2.14.0\n */\nexports.flatMap = (0, function_1.dual)(2, function (ma, f) {\n    return (0, function_1.pipe)(ma, (0, exports.chainWithIndex)(function (i, a) { return f(a, i); }));\n});\n/**\n * Takes an array of arrays of `A` and flattens them into an array of `A`\n * by concatenating the elements of each array in order.\n *\n * @example\n * import { flatten } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(flatten([[\"a\"], [\"b\", \"c\"], [\"d\", \"e\", \"f\"]]), [\"a\", \"b\", \"c\", \"d\", \"e\", \"f\"]);\n *\n * @category sequencing\n * @since 2.5.0\n */\nexports.flatten = (0, exports.flatMap)(function_1.identity);\n/**\n * Same as [`map`](#map), but the iterating function takes both the index and the value\n * of the element.\n *\n * @example\n * import { mapWithIndex } from 'fp-ts/Array'\n * import { pipe } from 'fp-ts/function'\n *\n * const f = (i: number, s: string) => `${s} - ${i}`;\n * assert.deepStrictEqual(pipe([\"a\", \"b\", \"c\"], mapWithIndex(f)), [\"a - 0\", \"b - 1\", \"c - 2\"]);\n *\n * @category mapping\n * @since 2.0.0\n */\nvar mapWithIndex = function (f) { return function (fa) {\n    return fa.map(function (a, i) { return f(i, a); });\n}; };\nexports.mapWithIndex = mapWithIndex;\n/**\n * Maps an array with an iterating function that takes the index and the value of\n * each element and returns an `Option`. It keeps only the `Some` values discarding\n * the `None`s.\n *\n * Same as [`filterMap`](#filterMap), but with an iterating function which takes also\n * the index as input.\n *\n * @example\n * import { filterMapWithIndex } from 'fp-ts/Array'\n * import { pipe } from 'fp-ts/function'\n * import { option } from \"fp-ts\";\n *\n * const f = (i: number, s: string) => (i % 2 === 1 ? option.some(s.toUpperCase()) : option.none);\n * assert.deepStrictEqual(pipe([\"a\", \"no\", \"neither\", \"b\"], filterMapWithIndex(f)), [\"NO\", \"B\"]);\n *\n * @category filtering\n * @since 2.0.0\n */\nvar filterMapWithIndex = function (f) {\n    return function (fa) {\n        var out = [];\n        for (var i = 0; i < fa.length; i++) {\n            var optionB = f(i, fa[i]);\n            if (_.isSome(optionB)) {\n                out.push(optionB.value);\n            }\n        }\n        return out;\n    };\n};\nexports.filterMapWithIndex = filterMapWithIndex;\n/**\n * Maps an array with an iterating function that returns an `Option`\n * and it keeps only the `Some` values discarding the `None`s.\n *\n * @example\n * import { filterMap } from 'fp-ts/Array'\n * import { pipe } from 'fp-ts/function'\n * import { option } from \"fp-ts\";\n *\n * const f = (s: string) => s.length === 1 ? option.some(s.toUpperCase()) : option.none;\n * assert.deepStrictEqual(pipe([\"a\", \"no\", \"neither\", \"b\"], filterMap(f)), [\"A\", \"B\"]);\n *\n * @category filtering\n * @since 2.0.0\n */\nvar filterMap = function (f) {\n    return (0, exports.filterMapWithIndex)(function (_, a) { return f(a); });\n};\nexports.filterMap = filterMap;\n/**\n * Compact an array of `Option`s discarding the `None` values and\n * keeping the `Some` values. It returns a new array containing the values of\n * the `Some` options.\n *\n * @example\n * import { compact } from 'fp-ts/Array'\n * import { option } from \"fp-ts\";\n *\n * assert.deepStrictEqual(compact([option.some(\"a\"), option.none, option.some(\"b\")]), [\"a\", \"b\"]);\n *\n * @category filtering\n * @since 2.0.0\n */\nexports.compact = (0, exports.filterMap)(function_1.identity);\n/**\n * Separate an array of `Either`s into `Left`s and `Right`s, creating two new arrays:\n * one containing all the left values and one containing all the right values.\n *\n * @example\n * import { separate } from 'fp-ts/Array'\n * import { either } from \"fp-ts\";\n *\n * assert.deepStrictEqual(separate([either.right(\"r1\"), either.left(\"l1\"), either.right(\"r2\")]), {\n *   left: [\"l1\"],\n *   right: [\"r1\", \"r2\"],\n * });\n *\n * @category filtering\n * @since 2.0.0\n */\nvar separate = function (fa) {\n    var left = [];\n    var right = [];\n    for (var _i = 0, fa_1 = fa; _i < fa_1.length; _i++) {\n        var e = fa_1[_i];\n        if (e._tag === 'Left') {\n            left.push(e.left);\n        }\n        else {\n            right.push(e.right);\n        }\n    }\n    return (0, Separated_1.separated)(left, right);\n};\nexports.separate = separate;\n/**\n * Given an iterating function that is a `Predicate` or a `Refinement`,\n * `filter` creates a new `Array` containing the elements of the original\n * `Array` for which the iterating function is `true`.\n *\n * @example\n * import { filter } from 'fp-ts/Array'\n * import { isString } from \"fp-ts/lib/string\";\n *\n * assert.deepStrictEqual(filter(isString)([\"a\", 1, {}, \"b\", 5]), [\"a\", \"b\"]);\n * assert.deepStrictEqual(filter((x:number) => x > 0)([-3, 1, -2, 5]), [1, 5]);\n *\n * @category filtering\n * @since 2.0.0\n */\nvar filter = function (predicate) {\n    return function (as) {\n        return as.filter(predicate);\n    };\n};\nexports.filter = filter;\n/**\n * Given an iterating function that is a `Predicate` or a `Refinement`,\n * `partition` creates two new `Array`s: `right` containing the elements of the original\n * `Array` for which the iterating function is `true`, `left` containing the elements\n * for which it is false.\n *\n * @example\n * import { partition } from 'fp-ts/Array'\n * import { isString } from \"fp-ts/lib/string\";\n *\n * assert.deepStrictEqual(partition(isString)([\"a\", 1, {}, \"b\", 5]), { left: [1, {}, 5], right: [\"a\", \"b\"] });\n * assert.deepStrictEqual(partition((x: number) => x > 0)([-3, 1, -2, 5]), { left: [-3, -2], right: [1, 5] });\n *\n * @category filtering\n * @since 2.0.0\n */\nvar partition = function (predicate) {\n    return (0, exports.partitionWithIndex)(function (_, a) { return predicate(a); });\n};\nexports.partition = partition;\n/**\n * Same as [`partition`](#partition), but passing also the index to the iterating function.\n *\n * @example\n * import { partitionWithIndex } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(partitionWithIndex((index, x: number) => index < 3 && x > 0)([-2, 5, 6, 7]), {\n *   left: [-2, 7],\n *   right: [5, 6],\n * });\n *\n * @category filtering\n * @since 2.0.0\n */\nvar partitionWithIndex = function (predicateWithIndex) {\n    return function (as) {\n        var left = [];\n        var right = [];\n        for (var i = 0; i < as.length; i++) {\n            var b = as[i];\n            if (predicateWithIndex(i, b)) {\n                right.push(b);\n            }\n            else {\n                left.push(b);\n            }\n        }\n        return (0, Separated_1.separated)(left, right);\n    };\n};\nexports.partitionWithIndex = partitionWithIndex;\n/**\n * Given an iterating function that returns an `Either`,\n * `partitionMap` applies the iterating function to each element and it creates two `Array`s:\n * `right` containing the values of `Right` results, `left` containing the values of `Left` results.\n *\n * @example\n * import { partitionMap } from 'fp-ts/Array'\n * import { Either, left, right } from \"fp-ts/lib/Either\";\n *\n * const upperIfString = <B>(x: B): Either<B, string> =>\n *   typeof x === \"string\" ? right(x.toUpperCase()) : left(x);\n * assert.deepStrictEqual(partitionMap(upperIfString)([-2, \"hello\", 6, 7, \"world\"]), {\n *   left: [-2, 6, 7],\n *   right: [ 'HELLO', 'WORLD' ],\n * });\n *\n * @category filtering\n * @since 2.0.0\n */\nvar partitionMap = function (f) { return (0, exports.partitionMapWithIndex)(function (_, a) { return f(a); }); };\nexports.partitionMap = partitionMap;\n/**\n * Same as [`partitionMap`](#partitionMap), but passing also the index to the iterating function.\n *\n * @example\n * import { partitionMapWithIndex } from 'fp-ts/Array'\n * import { Either, left, right } from \"fp-ts/lib/Either\";\n *\n * const upperIfStringBefore3 = <B>(index: number, x: B): Either<B, string> =>\n *   index < 3 && typeof x === \"string\" ? right(x.toUpperCase()) : left(x);\n * assert.deepStrictEqual(partitionMapWithIndex(upperIfStringBefore3)([-2, \"hello\", 6, 7, \"world\"]), {\n *   left: [-2, 6, 7, \"world\"],\n *   right: [\"HELLO\"],\n * });\n *\n * @category filtering\n * @since 2.0.0\n */\nvar partitionMapWithIndex = function (f) {\n    return function (fa) {\n        var left = [];\n        var right = [];\n        for (var i = 0; i < fa.length; i++) {\n            var e = f(i, fa[i]);\n            if (e._tag === 'Left') {\n                left.push(e.left);\n            }\n            else {\n                right.push(e.right);\n            }\n        }\n        return (0, Separated_1.separated)(left, right);\n    };\n};\nexports.partitionMapWithIndex = partitionMapWithIndex;\n/**\n * Less strict version of [`alt`](#alt).\n *\n * The `W` suffix (short for **W**idening) means that the return types will be merged.\n *\n * @example\n * import * as A from 'fp-ts/Array'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3],\n *     A.altW(() => ['a', 'b'])\n *   ),\n *   [1, 2, 3, 'a', 'b']\n * )\n *\n * @category error handling\n * @since 2.9.0\n */\nvar altW = function (that) {\n    return function (fa) {\n        return fa.concat(that());\n    };\n};\nexports.altW = altW;\n/**\n * Identifies an associative operation on a type constructor. It is similar to `Semigroup`, except that it applies to\n * types of kind `* -> *`.\n *\n * In case of `Array` concatenates the inputs into a single array.\n *\n * @example\n * import * as A from 'fp-ts/Array'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3],\n *     A.alt(() => [4, 5])\n *   ),\n *   [1, 2, 3, 4, 5]\n * )\n *\n * @category error handling\n * @since 2.0.0\n */\nexports.alt = exports.altW;\n/**\n * Same as [`filter`](#filter), but passing also the index to the iterating function.\n *\n * @example\n * import { filterWithIndex } from 'fp-ts/Array';\n *\n * const f = (index: number, x: number) => x > 0 && index <= 2;\n * assert.deepStrictEqual(filterWithIndex(f)([-3, 1, -2, 5]), [1]);\n *\n * @category filtering\n * @since 2.0.0\n */\nvar filterWithIndex = function (predicateWithIndex) {\n    return function (as) {\n        return as.filter(function (b, i) { return predicateWithIndex(i, b); });\n    };\n};\nexports.filterWithIndex = filterWithIndex;\n/**\n * Given an iterating function that takes `Array<A>` as input, `extend` returns\n * an array containing the results of the iterating function applied to the whole input\n * `Array`, then to the input `Array` without the first element, then to the input\n * `Array` without the first two elements, etc.\n *\n * @example\n * import { extend } from 'fp-ts/Array'\n *\n * const f = (a: string[]) => a.join(\",\");\n * assert.deepStrictEqual(extend(f)([\"a\", \"b\", \"c\"]), [\"a,b,c\", \"b,c\", \"c\"]);\n *\n * @since 2.0.0\n */\nvar extend = function (f) { return function (wa) {\n    return wa.map(function (_, i) { return f(wa.slice(i)); });\n}; };\nexports.extend = extend;\n/**\n * `duplicate` returns an array containing the whole input `Array`,\n * then to the input `Array` dropping the first element, then to the input\n * `Array` dropping the first two elements, etc.\n *\n * @example\n * import { duplicate } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(duplicate([\"a\", \"b\", \"c\"]), [[\"a\", \"b\", \"c\"], [\"b\", \"c\"], [\"c\"]]);\n *\n * @since 2.0.0\n */\nexports.duplicate = (0, exports.extend)(function_1.identity);\n/**\n * Map and fold an `Array`.\n * Map the `Array` passing each value to the iterating function.\n * Then fold the results using the provided `Monoid`.\n *\n * @example\n * import { foldMap } from 'fp-ts/Array'\n *\n * const monoid = { concat: (a: string, b: string) => a + b, empty: \"\" };\n * const f = (s: string) => s.toUpperCase()\n * assert.deepStrictEqual(foldMap(monoid)(f)([\"a\", \"b\", \"c\"]), \"ABC\");\n *\n * @category folding\n * @since 2.0.0\n */\nexports.foldMap = RA.foldMap;\n/**\n * Same as [`foldMap`](#foldMap) but passing also the index to the iterating function.\n *\n * @example\n * import { foldMapWithIndex } from 'fp-ts/Array'\n *\n * const monoid = { concat: (a: string, b: string) => a + b, empty: \"\" };\n * const f = (index:number, s: string) => `${s.toUpperCase()}(${index})`\n * assert.deepStrictEqual(foldMapWithIndex(monoid)(f)([\"a\", \"b\", \"c\"]), \"A(0)B(1)C(2)\");\n *\n * @category folding\n * @since 2.0.0\n */\nexports.foldMapWithIndex = RA.foldMapWithIndex;\n/**\n * Reduces an `Array`.\n *\n * `reduce` executes the supplied iterating function on each element of the array,\n * in order, passing in the element and the return value from the calculation on the preceding element.\n *\n * The first time that the iterating function is called there is no \"return value of the\n * previous calculation\", the initial value is used in its place.\n *\n * @example\n * import { reduce } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(reduce(5, (acc: number, cur: number) => acc * cur)([2, 3]), 5 * 2 * 3);\n *\n * @category folding\n * @since 2.0.0\n */\nexports.reduce = RA.reduce;\n/**\n * Same as [`reduce`](#reduce) but passing also the index to the iterating function.\n *\n * @example\n * import { reduceWithIndex } from 'fp-ts/Array'\n *\n * const f = (index: number, acc: string, cur: unknown) =>\n *   acc + (typeof cur === \"string\" ? cur.toUpperCase() + index : \"\");\n * assert.deepStrictEqual(reduceWithIndex(\"\", f)([2, \"a\", \"b\", null]), \"A1B2\");\n *\n * @category folding\n * @since 2.0.0\n */\nexports.reduceWithIndex = RA.reduceWithIndex;\n/**\n * Same as [`reduce`](#reduce) but applied from the end to the start.\n *\n * *Note*: the iterating function in this case takes the accumulator as the last argument.\n *\n * @example\n * import { reduceRight } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(reduceRight(\"\", (cur: string, acc: string) => acc + cur)([\"a\", \"b\", \"c\"]), \"cba\");\n *\n * @category folding\n * @since 2.0.0\n */\nexports.reduceRight = RA.reduceRight;\n/**\n * Same as [`reduceRight`](#reduceRight) but passing also the index to the iterating function.\n *\n * @example\n * import { reduceRightWithIndex } from 'fp-ts/Array'\n *\n * const f = (index: number, cur: unknown, acc: string) =>\n *   acc + (typeof cur === \"string\" ? cur.toUpperCase() + index : \"\");\n * assert.deepStrictEqual(reduceRightWithIndex(\"\", f)([2, \"a\", \"b\", null]), \"B2A1\");\n *\n * @category folding\n * @since 2.0.0\n */\nexports.reduceRightWithIndex = RA.reduceRightWithIndex;\n/**\n * Given an iterating function that returns a `HKT` (higher kinded type), `traverse`\n * applies the iterating function to each element of the `Array` and then [`sequence`](#sequence)-s\n * the results using the provided `Applicative`.\n *\n * E.g. suppose you have an `Array` and you want to format each element with a function\n * that returns a result or an error as `f = (a: A) => Either<Error, B>`, using `traverse`\n * you can apply `f` to all elements and directly obtain as a result an `Either<Error,Array<B>>`\n * i.e. an `Array<B>` if all the results are `B`, or an `Error` if some of the results\n * are `Error`s.\n *\n * @example\n * import { traverse } from 'fp-ts/Array'\n * import { Applicative, left, right } from \"fp-ts/lib/Either\";\n *\n * const f = (x: unknown) =>\n *   typeof x === \"string\" ? right(x.toUpperCase()) : left(new Error(\"not a string\"));\n * assert.deepStrictEqual(traverse(Applicative)(f)([\"a\", \"b\"]), right([\"A\", \"B\"]));\n * assert.deepStrictEqual(traverse(Applicative)(f)([\"a\", 5]), left(new Error(\"not a string\")));\n *\n * @category traversing\n * @since 2.6.3\n */\nvar traverse = function (F) {\n    var traverseWithIndexF = (0, exports.traverseWithIndex)(F);\n    return function (f) { return traverseWithIndexF(function (_, a) { return f(a); }); };\n};\nexports.traverse = traverse;\n/**\n * `sequence` takes an `Array` where elements are `HKT<A>` (higher kinded type) and,\n * using an applicative of that `HKT`, returns an `HKT` of `Array<A>`.\n * E.g. it can turn an `Array<Either<Error, string>>` into an `Either<Error, Array<string>>`.\n *\n * `sequence` requires an `Applicative` of the `HKT` you are targeting, e.g. to turn an\n * `Array<Either<E, A>>` into an `Either<E, Array<A>>`, it needs an\n * `Applicative` for `Either`, to to turn an `Array<Option<A>>` into an `Option<Array<A>>`,\n * it needs an `Applicative` for `Option`.\n *\n * @example\n * import { sequence } from 'fp-ts/Array'\n * import { Applicative, left, right } from \"fp-ts/lib/Either\";\n *\n * assert.deepStrictEqual(sequence(Applicative)([right(\"a\"), right(\"b\")]), right([\"a\", \"b\"]));\n * assert.deepStrictEqual(\n *   sequence(Applicative)([right(\"a\"), left(new Error(\"not a string\"))]),\n *   left(new Error(\"not a string\"))\n * );\n *\n * @category traversing\n * @since 2.6.3\n */\nvar sequence = function (F) {\n    return function (ta) {\n        return _reduce(ta, F.of((0, exports.zero)()), function (fas, fa) {\n            return F.ap(F.map(fas, function (as) { return function (a) { return (0, function_1.pipe)(as, (0, exports.append)(a)); }; }), fa);\n        });\n    };\n};\nexports.sequence = sequence;\n/**\n * Same as [`traverse`](#traverse) but passing also the index to the iterating function.\n *\n * @example\n * import { traverseWithIndex } from 'fp-ts/Array'\n * import { Applicative, left, right } from \"fp-ts/lib/Either\";\n *\n * const f = (index:number, x:unknown) =>\n *   typeof x === \"string\" ? right(x.toUpperCase() + index) : left(new Error(\"not a string\"));\n * assert.deepStrictEqual(traverseWithIndex(Applicative)(f)([\"a\", \"b\"]), right([\"A0\", \"B1\"]));\n * assert.deepStrictEqual(traverseWithIndex(Applicative)(f)([\"a\", 5]), left(new Error(\"not a string\")));\n *\n * @category sequencing\n * @since 2.6.3\n */\nvar traverseWithIndex = function (F) {\n    return function (f) {\n        return (0, exports.reduceWithIndex)(F.of((0, exports.zero)()), function (i, fbs, a) {\n            return F.ap(F.map(fbs, function (bs) { return function (b) { return (0, function_1.pipe)(bs, (0, exports.append)(b)); }; }), f(i, a));\n        });\n    };\n};\nexports.traverseWithIndex = traverseWithIndex;\n/**\n * @category filtering\n * @since 2.6.5\n */\nvar wither = function (F) {\n    var _witherF = _wither(F);\n    return function (f) { return function (fa) { return _witherF(fa, f); }; };\n};\nexports.wither = wither;\n/**\n * @category filtering\n * @since 2.6.5\n */\nvar wilt = function (F) {\n    var _wiltF = _wilt(F);\n    return function (f) { return function (fa) { return _wiltF(fa, f); }; };\n};\nexports.wilt = wilt;\n/**\n * `unfold` takes a function `f` which returns an `Option` of a tuple containing an outcome\n * value and an input for the following iteration.\n * `unfold` applies `f` to the initial value `b` and then recursively to the second\n * element of the tuple contained in the returned `option` of the previous\n * calculation until `f` returns `Option.none`.\n *\n * @example\n * import { unfold } from 'fp-ts/Array'\n * import { option } from 'fp-ts'\n *\n * const f = (n: number) => {\n *   if (n <= 0) return option.none;\n *   const returnValue = n * 2;\n *   const inputForNextRound = n - 1;\n *   return option.some([returnValue, inputForNextRound] as const);\n * };\n * assert.deepStrictEqual(unfold(5, f), [10, 8, 6, 4, 2]);\n *\n * @since 2.6.6\n */\nvar unfold = function (b, f) {\n    var out = [];\n    var bb = b;\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n        var mt = f(bb);\n        if (_.isSome(mt)) {\n            var _a = mt.value, a = _a[0], b_1 = _a[1];\n            out.push(a);\n            bb = b_1;\n        }\n        else {\n            break;\n        }\n    }\n    return out;\n};\nexports.unfold = unfold;\n/**\n * @category type lambdas\n * @since 2.0.0\n */\nexports.URI = 'Array';\n/**\n * `getShow` makes a `Show` for an `Array<A>` from a `Show` for\n * an `A`.\n *\n * @example\n * import { getShow } from 'fp-ts/Array'\n *\n * const numShow = { show: (n: number) => (n >= 0 ? `${n}` : `(${-n})`) };\n * assert.deepStrictEqual(getShow(numShow).show([-2, -1, 0, 1]), \"[(2), (1), 0, 1]\");\n *\n * @category instances\n * @since 2.0.0\n */\nexports.getShow = RA.getShow;\n/**\n * Get a `Semigroup` based on the concatenation of `Array`s.\n * See also [`getMonoid`](#getMonoid).\n *\n * @example\n * import { getSemigroup } from 'fp-ts/Array'\n *\n * const S = getSemigroup<number>();\n * assert.deepStrictEqual(S.concat([1, 2], [2, 3]), [1, 2, 2, 3]);\n *\n * @category instances\n * @since 2.10.0\n */\nvar getSemigroup = function () { return ({\n    concat: function (first, second) { return first.concat(second); }\n}); };\nexports.getSemigroup = getSemigroup;\n/**\n * Returns a `Monoid` for `Array<A>` based on the concatenation of `Array`s.\n *\n * @example\n * import { getMonoid } from 'fp-ts/Array'\n *\n * const M = getMonoid<number>()\n * assert.deepStrictEqual(M.concat([1, 2], [3, 4]), [1, 2, 3, 4])\n *\n * @category instances\n * @since 2.0.0\n */\nvar getMonoid = function () { return ({\n    concat: (0, exports.getSemigroup)().concat,\n    empty: []\n}); };\nexports.getMonoid = getMonoid;\n/**\n * Derives an `Eq` over the `Array` of a given element type from the `Eq` of that type. The derived `Eq` defines two\n * arrays as equal if all elements of both arrays are compared equal pairwise with the given `E`. In case of arrays of\n * different lengths, the result is non equality.\n *\n * @example\n * import * as S from 'fp-ts/string'\n * import { getEq } from 'fp-ts/Array'\n *\n * const E = getEq(S.Eq)\n * assert.strictEqual(E.equals(['a', 'b'], ['a', 'b']), true)\n * assert.strictEqual(E.equals(['a'], []), false)\n *\n * @category instances\n * @since 2.0.0\n */\nexports.getEq = RA.getEq;\n/**\n * Derives an `Ord` over the `Array` of a given element type from the `Ord` of that type. The ordering between two such\n * arrays is equal to: the first non equal comparison of each arrays elements taken pairwise in increasing order, in\n * case of equality over all the pairwise elements; the longest array is considered the greatest, if both arrays have\n * the same length, the result is equality.\n *\n * @example\n * import { getOrd } from 'fp-ts/Array'\n * import * as S from 'fp-ts/string'\n *\n * const O = getOrd(S.Ord)\n * assert.strictEqual(O.compare(['b'], ['a']), 1)\n * assert.strictEqual(O.compare(['a'], ['a']), 0)\n * assert.strictEqual(O.compare(['a'], ['b']), -1)\n *\n * @category instances\n * @since 2.0.0\n */\nexports.getOrd = RA.getOrd;\n/**\n * Get a `Semigroup` based on the union of the elements of `Array`s.\n * Elements which equal according to the provided `Eq` are included\n * only once in the result.\n * See also [`getUnionMonoid`](#getUnionMonoid).\n *\n * @example\n * import { getUnionSemigroup } from 'fp-ts/Array';\n * import { Eq } from 'fp-ts/number';\n *\n * const S = getUnionSemigroup<number>(Eq);\n * assert.deepStrictEqual(S.concat([1, 2], [2, 3]), [1, 2, 3]);\n *\n * @category instances\n * @since 2.11.0\n */\nvar getUnionSemigroup = function (E) {\n    var unionE = union(E);\n    return {\n        concat: function (first, second) { return unionE(second)(first); }\n    };\n};\nexports.getUnionSemigroup = getUnionSemigroup;\n/**\n * Get a `Monoid` based on the union of the elements of `Array`s.\n * Elements which equal according to the provided `Eq` are included\n * only once in the result.\n *\n * @example\n * import { getUnionMonoid } from 'fp-ts/Array'\n * import { Eq } from 'fp-ts/number';\n *\n * const M = getUnionMonoid<number>(Eq);\n * assert.deepStrictEqual(M.concat([1, 2], [2, 3]), [1, 2, 3]);\n * assert.deepStrictEqual(M.empty,[]);\n *\n * @category instances\n * @since 2.11.0\n */\nvar getUnionMonoid = function (E) { return ({\n    concat: (0, exports.getUnionSemigroup)(E).concat,\n    empty: []\n}); };\nexports.getUnionMonoid = getUnionMonoid;\n/**\n * Get a `Semigroup` based on the intersection of the elements of `Array`s.\n * Only elements present in the two arrays which are equal according to the\n * provided `Eq` are included in the result.\n *\n * @example\n * import { getIntersectionSemigroup } from 'fp-ts/Array'\n * import { Eq } from 'fp-ts/number';\n *\n * const S = getIntersectionSemigroup<number>(Eq);\n * assert.deepStrictEqual(S.concat([1, 2], [2, 3]), [2]);\n *\n * @category instances\n * @since 2.11.0\n */\nvar getIntersectionSemigroup = function (E) {\n    var intersectionE = intersection(E);\n    return {\n        concat: function (first, second) { return intersectionE(second)(first); }\n    };\n};\nexports.getIntersectionSemigroup = getIntersectionSemigroup;\n/**\n * Get a `Magma` for `Array` where the `concat` function is the differnce between\n * the first and the second array, i.e. the result contains all the elements of the\n * first array for which their is no equal element in the second array according\n * to the `Eq` provided.\n *\n *\n * @example\n * import { getDifferenceMagma } from 'fp-ts/Array'\n * import { Eq } from 'fp-ts/number';\n *\n * const S = getDifferenceMagma<number>(Eq);\n * assert.deepStrictEqual(S.concat([1, 2], [2, 3]), [1]);\n *\n * @category instances\n * @since 2.11.0\n */\nvar getDifferenceMagma = function (E) {\n    var differenceE = difference(E);\n    return {\n        concat: function (first, second) { return differenceE(second)(first); }\n    };\n};\nexports.getDifferenceMagma = getDifferenceMagma;\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Functor = {\n    URI: exports.URI,\n    map: _map\n};\n/**\n * Given an input an `Array` of functions, `flap` returns an `Array` containing\n * the results of applying each function to the given input.\n *\n * @example\n * import { flap } from 'fp-ts/Array'\n *\n * const funs = [\n *   (n: number) => `Double: ${n * 2}`,\n *   (n: number) => `Triple: ${n * 3}`,\n *   (n: number) => `Square: ${n * n}`,\n * ];\n * assert.deepStrictEqual(flap(4)(funs), ['Double: 8', 'Triple: 12', 'Square: 16']);\n *\n * @category mapping\n * @since 2.10.0\n */\nexports.flap = (0, Functor_1.flap)(exports.Functor);\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Pointed = {\n    URI: exports.URI,\n    of: exports.of\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.FunctorWithIndex = {\n    URI: exports.URI,\n    map: _map,\n    mapWithIndex: _mapWithIndex\n};\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Apply = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap\n};\n/**\n * Combine two effectful actions, keeping only the result of the first.\n *\n * @since 2.5.0\n */\nexports.apFirst = (0, Apply_1.apFirst)(exports.Apply);\n/**\n * Combine two effectful actions, keeping only the result of the second.\n *\n * @since 2.5.0\n */\nexports.apSecond = (0, Apply_1.apSecond)(exports.Apply);\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Applicative = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    of: exports.of\n};\n/**\n * @category instances\n * @since 2.10.0\n */\nexports.Chain = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    chain: exports.flatMap\n};\n/**\n * Composes computations in sequence, using the return value of one computation to determine the next computation and\n * keeping only the result of the first.\n *\n * @example\n * import * as A from 'fp-ts/Array'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3],\n *     A.chainFirst(() => ['a', 'b'])\n *   ),\n *   [1, 1, 2, 2, 3, 3]\n * )\n * assert.deepStrictEqual(\n *   pipe(\n *     [1, 2, 3],\n *     A.chainFirst(() => [])\n *   ),\n *   []\n * )\n *\n * @category sequencing\n * @since 2.0.0\n */\nexports.chainFirst = \n/*#__PURE__*/ (0, Chain_1.chainFirst)(exports.Chain);\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Monad = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    of: exports.of,\n    chain: exports.flatMap\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Unfoldable = {\n    URI: exports.URI,\n    unfold: exports.unfold\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Alt = {\n    URI: exports.URI,\n    map: _map,\n    alt: _alt\n};\n/**\n * @category instances\n * @since 2.11.0\n */\nexports.Zero = {\n    URI: exports.URI,\n    zero: exports.zero\n};\n/**\n * @category do notation\n * @since 2.11.0\n */\nexports.guard = (0, Zero_1.guard)(exports.Zero, exports.Pointed);\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Alternative = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    of: exports.of,\n    alt: _alt,\n    zero: exports.zero\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Extend = {\n    URI: exports.URI,\n    map: _map,\n    extend: _extend\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Compactable = {\n    URI: exports.URI,\n    compact: exports.compact,\n    separate: exports.separate\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Filterable = {\n    URI: exports.URI,\n    map: _map,\n    compact: exports.compact,\n    separate: exports.separate,\n    filter: _filter,\n    filterMap: _filterMap,\n    partition: _partition,\n    partitionMap: _partitionMap\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.FilterableWithIndex = {\n    URI: exports.URI,\n    map: _map,\n    mapWithIndex: _mapWithIndex,\n    compact: exports.compact,\n    separate: exports.separate,\n    filter: _filter,\n    filterMap: _filterMap,\n    partition: _partition,\n    partitionMap: _partitionMap,\n    partitionMapWithIndex: _partitionMapWithIndex,\n    partitionWithIndex: _partitionWithIndex,\n    filterMapWithIndex: _filterMapWithIndex,\n    filterWithIndex: _filterWithIndex\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Foldable = {\n    URI: exports.URI,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.FoldableWithIndex = {\n    URI: exports.URI,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    reduceWithIndex: _reduceWithIndex,\n    foldMapWithIndex: _foldMapWithIndex,\n    reduceRightWithIndex: _reduceRightWithIndex\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Traversable = {\n    URI: exports.URI,\n    map: _map,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    traverse: _traverse,\n    sequence: exports.sequence\n};\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.TraversableWithIndex = {\n    URI: exports.URI,\n    map: _map,\n    mapWithIndex: _mapWithIndex,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    reduceWithIndex: _reduceWithIndex,\n    foldMapWithIndex: _foldMapWithIndex,\n    reduceRightWithIndex: _reduceRightWithIndex,\n    traverse: _traverse,\n    sequence: exports.sequence,\n    traverseWithIndex: _traverseWithIndex\n};\nvar _wither = /*#__PURE__*/ (0, Witherable_1.witherDefault)(exports.Traversable, exports.Compactable);\nvar _wilt = /*#__PURE__*/ (0, Witherable_1.wiltDefault)(exports.Traversable, exports.Compactable);\n/**\n * @category instances\n * @since 2.7.0\n */\nexports.Witherable = {\n    URI: exports.URI,\n    map: _map,\n    compact: exports.compact,\n    separate: exports.separate,\n    filter: _filter,\n    filterMap: _filterMap,\n    partition: _partition,\n    partitionMap: _partitionMap,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    traverse: _traverse,\n    sequence: exports.sequence,\n    wither: _wither,\n    wilt: _wilt\n};\n/**\n * @category sequencing\n * @since 2.11.0\n */\nexports.chainRecDepthFirst = RA.chainRecDepthFirst;\n/**\n * @category instances\n * @since 2.11.0\n */\nexports.ChainRecDepthFirst = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    chain: exports.flatMap,\n    chainRec: _chainRecDepthFirst\n};\n/**\n * @category sequencing\n * @since 2.11.0\n */\nexports.chainRecBreadthFirst = RA.chainRecBreadthFirst;\n/**\n * @category instances\n * @since 2.11.0\n */\nexports.ChainRecBreadthFirst = {\n    URI: exports.URI,\n    map: _map,\n    ap: _ap,\n    chain: exports.flatMap,\n    chainRec: _chainRecBreadthFirst\n};\n/**\n * Filter values inside a context.\n *\n * @since 2.11.0\n */\nexports.filterE = (0, Witherable_1.filterE)(exports.Witherable);\n/**\n * @category instances\n * @since 2.11.0\n */\nexports.FromEither = {\n    URI: exports.URI,\n    fromEither: exports.fromEither\n};\n/**\n * @category lifting\n * @since 2.11.0\n */\nexports.fromEitherK = (0, FromEither_1.fromEitherK)(exports.FromEither);\n// -------------------------------------------------------------------------------------\n// unsafe\n// -------------------------------------------------------------------------------------\n/**\n * @category unsafe\n * @since 2.0.0\n */\nexports.unsafeInsertAt = NEA.unsafeInsertAt;\n/**\n * @category unsafe\n * @since 2.0.0\n */\nvar unsafeUpdateAt = function (i, a, as) {\n    return (0, exports.isNonEmpty)(as) ? NEA.unsafeUpdateAt(i, a, as) : [];\n};\nexports.unsafeUpdateAt = unsafeUpdateAt;\n/**\n * @category unsafe\n * @since 2.0.0\n */\nvar unsafeDeleteAt = function (i, as) {\n    var xs = as.slice();\n    xs.splice(i, 1);\n    return xs;\n};\nexports.unsafeDeleteAt = unsafeDeleteAt;\n// -------------------------------------------------------------------------------------\n// utils\n// -------------------------------------------------------------------------------------\n/**\n * `every` tells if the provided predicate holds true for every element in the `Array`.\n *\n * @example\n * import { every } from 'fp-ts/Array'\n *\n * assert.equal(every((x: number) => x >= 0)([1, 2, 3]), true);\n * assert.equal(every((x: number) => x >= 0)([-1, 2, 3]), false);\n *\n * @since 2.9.0\n */\nexports.every = RA.every;\n/**\n * `some` tells if the provided predicate holds true at least for one element in the `Array`.\n *\n * @example\n * import { some } from 'fp-ts/Array'\n *\n * assert.equal(some((x: number) => x >= 0)([1, 2, 3]), true);\n * assert.equal(some((x: number) => x >= 10)([1, 2, 3]), false);\n *\n * @since 2.9.0\n */\nvar some = function (predicate) {\n    return function (as) {\n        return as.some(predicate);\n    };\n};\nexports.some = some;\n/**\n * Alias of [`some`](#some)\n *\n * @since 2.11.0\n */\nexports.exists = exports.some;\n/**\n * Places an element in between members of an `Array`, then folds the results using the provided `Monoid`.\n *\n * @example\n * import * as S from 'fp-ts/string'\n * import { intercalate } from 'fp-ts/Array'\n *\n * assert.deepStrictEqual(intercalate(S.Monoid)('-')(['a', 'b', 'c']), 'a-b-c')\n *\n * @since 2.12.0\n */\nexports.intercalate = RA.intercalate;\n// -------------------------------------------------------------------------------------\n// do notation\n// -------------------------------------------------------------------------------------\n/**\n * @category do notation\n * @since 2.9.0\n */\nexports.Do = (0, exports.of)(_.emptyRecord);\n/**\n * @category do notation\n * @since 2.8.0\n */\nexports.bindTo = (0, Functor_1.bindTo)(exports.Functor);\nvar let_ = /*#__PURE__*/ (0, Functor_1.let)(exports.Functor);\nexports.let = let_;\n/**\n * @category do notation\n * @since 2.8.0\n */\nexports.bind = (0, Chain_1.bind)(exports.Chain);\n/**\n * @category do notation\n * @since 2.8.0\n */\nexports.apS = (0, Apply_1.apS)(exports.Apply);\n// -------------------------------------------------------------------------------------\n// legacy\n// -------------------------------------------------------------------------------------\n/**\n * Alias of `flatMap`.\n *\n * @category legacy\n * @since 2.0.0\n */\nexports.chain = exports.flatMap;\n// -------------------------------------------------------------------------------------\n// deprecated\n// -------------------------------------------------------------------------------------\n/**\n * Use `NonEmptyArray` module instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.range = NEA.range;\n/**\n * Use a new `[]` instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.empty = [];\n/**\n * Use `prepend` instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.cons = NEA.cons;\n/**\n * Use `append` instead.\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.snoc = NEA.snoc;\n/**\n * Use `prependAll` instead\n *\n * @category zone of death\n * @since 2.9.0\n * @deprecated\n */\nexports.prependToAll = exports.prependAll;\n/**\n * This instance is deprecated, use small, specific instances instead.\n * For example if a function needs a `Functor` instance, pass `A.Functor` instead of `A.array`\n * (where `A` is from `import A from 'fp-ts/Array'`)\n *\n * @category zone of death\n * @since 2.0.0\n * @deprecated\n */\nexports.array = {\n    URI: exports.URI,\n    compact: exports.compact,\n    separate: exports.separate,\n    map: _map,\n    ap: _ap,\n    of: exports.of,\n    chain: exports.flatMap,\n    filter: _filter,\n    filterMap: _filterMap,\n    partition: _partition,\n    partitionMap: _partitionMap,\n    mapWithIndex: _mapWithIndex,\n    partitionMapWithIndex: _partitionMapWithIndex,\n    partitionWithIndex: _partitionWithIndex,\n    filterMapWithIndex: _filterMapWithIndex,\n    filterWithIndex: _filterWithIndex,\n    alt: _alt,\n    zero: exports.zero,\n    unfold: exports.unfold,\n    reduce: _reduce,\n    foldMap: _foldMap,\n    reduceRight: _reduceRight,\n    traverse: _traverse,\n    sequence: exports.sequence,\n    reduceWithIndex: _reduceWithIndex,\n    foldMapWithIndex: _foldMapWithIndex,\n    reduceRightWithIndex: _reduceRightWithIndex,\n    traverseWithIndex: _traverseWithIndex,\n    extend: _extend,\n    wither: _wither,\n    wilt: _wilt\n};\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.endsWith = exports.startsWith = exports.includes = exports.split = exports.size = exports.isEmpty = exports.slice = exports.trimRight = exports.trimLeft = exports.trim = exports.replace = exports.toLowerCase = exports.toUpperCase = exports.isString = exports.Show = exports.Ord = exports.Monoid = exports.empty = exports.Semigroup = exports.Eq = void 0;\nvar ReadonlyNonEmptyArray_1 = require(\"./ReadonlyNonEmptyArray\");\n// -------------------------------------------------------------------------------------\n// instances\n// -------------------------------------------------------------------------------------\n/**\n * @example\n * import * as S from 'fp-ts/string'\n *\n * assert.deepStrictEqual(S.Eq.equals('a', 'a'), true)\n * assert.deepStrictEqual(S.Eq.equals('a', 'b'), false)\n *\n * @category instances\n * @since 2.10.0\n */\nexports.Eq = {\n    equals: function (first, second) { return first === second; }\n};\n/**\n * `string` semigroup under concatenation.\n *\n * @example\n * import * as S from 'fp-ts/string'\n *\n * assert.deepStrictEqual(S.Semigroup.concat('a', 'b'), 'ab')\n *\n * @category instances\n * @since 2.10.0\n */\nexports.Semigroup = {\n    concat: function (first, second) { return first + second; }\n};\n/**\n * An empty `string`.\n *\n * @since 2.10.0\n */\nexports.empty = '';\n/**\n * `string` monoid under concatenation.\n *\n * The `empty` value is `''`.\n *\n * @example\n * import * as S from 'fp-ts/string'\n *\n * assert.deepStrictEqual(S.Monoid.concat('a', 'b'), 'ab')\n * assert.deepStrictEqual(S.Monoid.concat('a', S.Monoid.empty), 'a')\n *\n * @category instances\n * @since 2.10.0\n */\nexports.Monoid = {\n    concat: exports.Semigroup.concat,\n    empty: exports.empty\n};\n/**\n * @example\n * import * as S from 'fp-ts/string'\n *\n * assert.deepStrictEqual(S.Ord.compare('a', 'a'), 0)\n * assert.deepStrictEqual(S.Ord.compare('a', 'b'), -1)\n * assert.deepStrictEqual(S.Ord.compare('b', 'a'), 1)\n *\n * @category instances\n * @since 2.10.0\n */\nexports.Ord = {\n    equals: exports.Eq.equals,\n    compare: function (first, second) { return (first < second ? -1 : first > second ? 1 : 0); }\n};\n/**\n * @example\n * import * as S from 'fp-ts/string'\n *\n * assert.deepStrictEqual(S.Show.show('a'), '\"a\"')\n *\n * @category instances\n * @since 2.10.0\n */\nexports.Show = {\n    show: function (s) { return JSON.stringify(s); }\n};\n// -------------------------------------------------------------------------------------\n// refinements\n// -------------------------------------------------------------------------------------\n/**\n * @example\n * import * as S from 'fp-ts/string'\n *\n * assert.deepStrictEqual(S.isString('a'), true)\n * assert.deepStrictEqual(S.isString(1), false)\n *\n * @category refinements\n * @since 2.11.0\n */\nvar isString = function (u) { return typeof u === 'string'; };\nexports.isString = isString;\n// -------------------------------------------------------------------------------------\n// combinators\n// -------------------------------------------------------------------------------------\n/**\n * @example\n * import * as S from 'fp-ts/string'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe('a', S.toUpperCase), 'A')\n *\n * @since 2.11.0\n */\nvar toUpperCase = function (s) { return s.toUpperCase(); };\nexports.toUpperCase = toUpperCase;\n/**\n * @example\n * import * as S from 'fp-ts/string'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe('A', S.toLowerCase), 'a')\n *\n * @since 2.11.0\n */\nvar toLowerCase = function (s) { return s.toLowerCase(); };\nexports.toLowerCase = toLowerCase;\n/**\n * @example\n * import * as S from 'fp-ts/string'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe('abc', S.replace('b', 'd')), 'adc')\n *\n * @since 2.11.0\n */\nvar replace = function (searchValue, replaceValue) {\n    return function (s) {\n        return s.replace(searchValue, replaceValue);\n    };\n};\nexports.replace = replace;\n/**\n * @example\n * import * as S from 'fp-ts/string'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe(' a ', S.trim), 'a')\n *\n * @since 2.11.0\n */\nvar trim = function (s) { return s.trim(); };\nexports.trim = trim;\n/**\n * @example\n * import * as S from 'fp-ts/string'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe(' a ', S.trimLeft), 'a ')\n *\n * @since 2.11.0\n */\nvar trimLeft = function (s) { return s.trimLeft(); };\nexports.trimLeft = trimLeft;\n/**\n * @example\n * import * as S from 'fp-ts/string'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe(' a ', S.trimRight), ' a')\n *\n * @since 2.11.0\n */\nvar trimRight = function (s) { return s.trimRight(); };\nexports.trimRight = trimRight;\n/**\n * @example\n * import * as S from 'fp-ts/string'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe('abcd', S.slice(1, 3)), 'bc')\n *\n * @since 2.11.0\n */\nvar slice = function (start, end) {\n    return function (s) {\n        return s.slice(start, end);\n    };\n};\nexports.slice = slice;\n// -------------------------------------------------------------------------------------\n// utils\n// -------------------------------------------------------------------------------------\n/**\n * Test whether a `string` is empty.\n *\n * @example\n * import * as S from 'fp-ts/string'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe('', S.isEmpty), true)\n * assert.deepStrictEqual(pipe('a', S.isEmpty), false)\n *\n * @since 2.10.0\n */\nvar isEmpty = function (s) { return s.length === 0; };\nexports.isEmpty = isEmpty;\n/**\n * Calculate the number of characters in a `string`.\n *\n * @example\n * import * as S from 'fp-ts/string'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe('abc', S.size), 3)\n *\n * @since 2.10.0\n */\nvar size = function (s) { return s.length; };\nexports.size = size;\n/**\n * @example\n * import * as S from 'fp-ts/string'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe('abc', S.split('')), ['a', 'b', 'c'])\n * assert.deepStrictEqual(pipe('', S.split('')), [''])\n *\n * @since 2.11.0\n */\nvar split = function (separator) {\n    return function (s) {\n        var out = s.split(separator);\n        return (0, ReadonlyNonEmptyArray_1.isNonEmpty)(out) ? out : [s];\n    };\n};\nexports.split = split;\n/**\n * @example\n * import * as S from 'fp-ts/string'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe('abc', S.includes('b')), true)\n * assert.deepStrictEqual(pipe('abc', S.includes('d')), false)\n *\n * @since 2.11.0\n */\nvar includes = function (searchString, position) {\n    return function (s) {\n        return s.includes(searchString, position);\n    };\n};\nexports.includes = includes;\n/**\n * @example\n * import * as S from 'fp-ts/string'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe('abc', S.startsWith('a')), true)\n * assert.deepStrictEqual(pipe('bc', S.startsWith('a')), false)\n *\n * @since 2.11.0\n */\nvar startsWith = function (searchString, position) {\n    return function (s) {\n        return s.startsWith(searchString, position);\n    };\n};\nexports.startsWith = startsWith;\n/**\n * @example\n * import * as S from 'fp-ts/string'\n * import { pipe } from 'fp-ts/function'\n *\n * assert.deepStrictEqual(pipe('abc', S.endsWith('c')), true)\n * assert.deepStrictEqual(pipe('ab', S.endsWith('c')), false)\n *\n * @since 2.11.0\n */\nvar endsWith = function (searchString, position) {\n    return function (s) {\n        return s.endsWith(searchString, position);\n    };\n};\nexports.endsWith = endsWith;\n","(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n\ttypeof define === 'function' && define.amd ? define(factory) :\n\t(global.JSON5 = factory());\n}(this, (function () { 'use strict';\n\n\tfunction createCommonjsModule(fn, module) {\n\t\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n\t}\n\n\tvar _global = createCommonjsModule(function (module) {\n\t// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028\n\tvar global = module.exports = typeof window != 'undefined' && window.Math == Math\n\t  ? window : typeof self != 'undefined' && self.Math == Math ? self\n\t  // eslint-disable-next-line no-new-func\n\t  : Function('return this')();\n\tif (typeof __g == 'number') { __g = global; } // eslint-disable-line no-undef\n\t});\n\n\tvar _core = createCommonjsModule(function (module) {\n\tvar core = module.exports = { version: '2.6.5' };\n\tif (typeof __e == 'number') { __e = core; } // eslint-disable-line no-undef\n\t});\n\tvar _core_1 = _core.version;\n\n\tvar _isObject = function (it) {\n\t  return typeof it === 'object' ? it !== null : typeof it === 'function';\n\t};\n\n\tvar _anObject = function (it) {\n\t  if (!_isObject(it)) { throw TypeError(it + ' is not an object!'); }\n\t  return it;\n\t};\n\n\tvar _fails = function (exec) {\n\t  try {\n\t    return !!exec();\n\t  } catch (e) {\n\t    return true;\n\t  }\n\t};\n\n\t// Thank's IE8 for his funny defineProperty\n\tvar _descriptors = !_fails(function () {\n\t  return Object.defineProperty({}, 'a', { get: function () { return 7; } }).a != 7;\n\t});\n\n\tvar document = _global.document;\n\t// typeof document.createElement is 'object' in old IE\n\tvar is = _isObject(document) && _isObject(document.createElement);\n\tvar _domCreate = function (it) {\n\t  return is ? document.createElement(it) : {};\n\t};\n\n\tvar _ie8DomDefine = !_descriptors && !_fails(function () {\n\t  return Object.defineProperty(_domCreate('div'), 'a', { get: function () { return 7; } }).a != 7;\n\t});\n\n\t// 7.1.1 ToPrimitive(input [, PreferredType])\n\n\t// instead of the ES6 spec version, we didn't implement @@toPrimitive case\n\t// and the second argument - flag - preferred type is a string\n\tvar _toPrimitive = function (it, S) {\n\t  if (!_isObject(it)) { return it; }\n\t  var fn, val;\n\t  if (S && typeof (fn = it.toString) == 'function' && !_isObject(val = fn.call(it))) { return val; }\n\t  if (typeof (fn = it.valueOf) == 'function' && !_isObject(val = fn.call(it))) { return val; }\n\t  if (!S && typeof (fn = it.toString) == 'function' && !_isObject(val = fn.call(it))) { return val; }\n\t  throw TypeError(\"Can't convert object to primitive value\");\n\t};\n\n\tvar dP = Object.defineProperty;\n\n\tvar f = _descriptors ? Object.defineProperty : function defineProperty(O, P, Attributes) {\n\t  _anObject(O);\n\t  P = _toPrimitive(P, true);\n\t  _anObject(Attributes);\n\t  if (_ie8DomDefine) { try {\n\t    return dP(O, P, Attributes);\n\t  } catch (e) { /* empty */ } }\n\t  if ('get' in Attributes || 'set' in Attributes) { throw TypeError('Accessors not supported!'); }\n\t  if ('value' in Attributes) { O[P] = Attributes.value; }\n\t  return O;\n\t};\n\n\tvar _objectDp = {\n\t\tf: f\n\t};\n\n\tvar _propertyDesc = function (bitmap, value) {\n\t  return {\n\t    enumerable: !(bitmap & 1),\n\t    configurable: !(bitmap & 2),\n\t    writable: !(bitmap & 4),\n\t    value: value\n\t  };\n\t};\n\n\tvar _hide = _descriptors ? function (object, key, value) {\n\t  return _objectDp.f(object, key, _propertyDesc(1, value));\n\t} : function (object, key, value) {\n\t  object[key] = value;\n\t  return object;\n\t};\n\n\tvar hasOwnProperty = {}.hasOwnProperty;\n\tvar _has = function (it, key) {\n\t  return hasOwnProperty.call(it, key);\n\t};\n\n\tvar id = 0;\n\tvar px = Math.random();\n\tvar _uid = function (key) {\n\t  return 'Symbol('.concat(key === undefined ? '' : key, ')_', (++id + px).toString(36));\n\t};\n\n\tvar _library = false;\n\n\tvar _shared = createCommonjsModule(function (module) {\n\tvar SHARED = '__core-js_shared__';\n\tvar store = _global[SHARED] || (_global[SHARED] = {});\n\n\t(module.exports = function (key, value) {\n\t  return store[key] || (store[key] = value !== undefined ? value : {});\n\t})('versions', []).push({\n\t  version: _core.version,\n\t  mode: _library ? 'pure' : 'global',\n\t  copyright: '© 2019 Denis Pushkarev (zloirock.ru)'\n\t});\n\t});\n\n\tvar _functionToString = _shared('native-function-to-string', Function.toString);\n\n\tvar _redefine = createCommonjsModule(function (module) {\n\tvar SRC = _uid('src');\n\n\tvar TO_STRING = 'toString';\n\tvar TPL = ('' + _functionToString).split(TO_STRING);\n\n\t_core.inspectSource = function (it) {\n\t  return _functionToString.call(it);\n\t};\n\n\t(module.exports = function (O, key, val, safe) {\n\t  var isFunction = typeof val == 'function';\n\t  if (isFunction) { _has(val, 'name') || _hide(val, 'name', key); }\n\t  if (O[key] === val) { return; }\n\t  if (isFunction) { _has(val, SRC) || _hide(val, SRC, O[key] ? '' + O[key] : TPL.join(String(key))); }\n\t  if (O === _global) {\n\t    O[key] = val;\n\t  } else if (!safe) {\n\t    delete O[key];\n\t    _hide(O, key, val);\n\t  } else if (O[key]) {\n\t    O[key] = val;\n\t  } else {\n\t    _hide(O, key, val);\n\t  }\n\t// add fake Function#toString for correct work wrapped methods / constructors with methods like LoDash isNative\n\t})(Function.prototype, TO_STRING, function toString() {\n\t  return typeof this == 'function' && this[SRC] || _functionToString.call(this);\n\t});\n\t});\n\n\tvar _aFunction = function (it) {\n\t  if (typeof it != 'function') { throw TypeError(it + ' is not a function!'); }\n\t  return it;\n\t};\n\n\t// optional / simple context binding\n\n\tvar _ctx = function (fn, that, length) {\n\t  _aFunction(fn);\n\t  if (that === undefined) { return fn; }\n\t  switch (length) {\n\t    case 1: return function (a) {\n\t      return fn.call(that, a);\n\t    };\n\t    case 2: return function (a, b) {\n\t      return fn.call(that, a, b);\n\t    };\n\t    case 3: return function (a, b, c) {\n\t      return fn.call(that, a, b, c);\n\t    };\n\t  }\n\t  return function (/* ...args */) {\n\t    return fn.apply(that, arguments);\n\t  };\n\t};\n\n\tvar PROTOTYPE = 'prototype';\n\n\tvar $export = function (type, name, source) {\n\t  var IS_FORCED = type & $export.F;\n\t  var IS_GLOBAL = type & $export.G;\n\t  var IS_STATIC = type & $export.S;\n\t  var IS_PROTO = type & $export.P;\n\t  var IS_BIND = type & $export.B;\n\t  var target = IS_GLOBAL ? _global : IS_STATIC ? _global[name] || (_global[name] = {}) : (_global[name] || {})[PROTOTYPE];\n\t  var exports = IS_GLOBAL ? _core : _core[name] || (_core[name] = {});\n\t  var expProto = exports[PROTOTYPE] || (exports[PROTOTYPE] = {});\n\t  var key, own, out, exp;\n\t  if (IS_GLOBAL) { source = name; }\n\t  for (key in source) {\n\t    // contains in native\n\t    own = !IS_FORCED && target && target[key] !== undefined;\n\t    // export native or passed\n\t    out = (own ? target : source)[key];\n\t    // bind timers to global for call from export context\n\t    exp = IS_BIND && own ? _ctx(out, _global) : IS_PROTO && typeof out == 'function' ? _ctx(Function.call, out) : out;\n\t    // extend global\n\t    if (target) { _redefine(target, key, out, type & $export.U); }\n\t    // export\n\t    if (exports[key] != out) { _hide(exports, key, exp); }\n\t    if (IS_PROTO && expProto[key] != out) { expProto[key] = out; }\n\t  }\n\t};\n\t_global.core = _core;\n\t// type bitmap\n\t$export.F = 1;   // forced\n\t$export.G = 2;   // global\n\t$export.S = 4;   // static\n\t$export.P = 8;   // proto\n\t$export.B = 16;  // bind\n\t$export.W = 32;  // wrap\n\t$export.U = 64;  // safe\n\t$export.R = 128; // real proto method for `library`\n\tvar _export = $export;\n\n\t// 7.1.4 ToInteger\n\tvar ceil = Math.ceil;\n\tvar floor = Math.floor;\n\tvar _toInteger = function (it) {\n\t  return isNaN(it = +it) ? 0 : (it > 0 ? floor : ceil)(it);\n\t};\n\n\t// 7.2.1 RequireObjectCoercible(argument)\n\tvar _defined = function (it) {\n\t  if (it == undefined) { throw TypeError(\"Can't call method on  \" + it); }\n\t  return it;\n\t};\n\n\t// true  -> String#at\n\t// false -> String#codePointAt\n\tvar _stringAt = function (TO_STRING) {\n\t  return function (that, pos) {\n\t    var s = String(_defined(that));\n\t    var i = _toInteger(pos);\n\t    var l = s.length;\n\t    var a, b;\n\t    if (i < 0 || i >= l) { return TO_STRING ? '' : undefined; }\n\t    a = s.charCodeAt(i);\n\t    return a < 0xd800 || a > 0xdbff || i + 1 === l || (b = s.charCodeAt(i + 1)) < 0xdc00 || b > 0xdfff\n\t      ? TO_STRING ? s.charAt(i) : a\n\t      : TO_STRING ? s.slice(i, i + 2) : (a - 0xd800 << 10) + (b - 0xdc00) + 0x10000;\n\t  };\n\t};\n\n\tvar $at = _stringAt(false);\n\t_export(_export.P, 'String', {\n\t  // 21.1.3.3 String.prototype.codePointAt(pos)\n\t  codePointAt: function codePointAt(pos) {\n\t    return $at(this, pos);\n\t  }\n\t});\n\n\tvar codePointAt = _core.String.codePointAt;\n\n\tvar max = Math.max;\n\tvar min = Math.min;\n\tvar _toAbsoluteIndex = function (index, length) {\n\t  index = _toInteger(index);\n\t  return index < 0 ? max(index + length, 0) : min(index, length);\n\t};\n\n\tvar fromCharCode = String.fromCharCode;\n\tvar $fromCodePoint = String.fromCodePoint;\n\n\t// length should be 1, old FF problem\n\t_export(_export.S + _export.F * (!!$fromCodePoint && $fromCodePoint.length != 1), 'String', {\n\t  // 21.1.2.2 String.fromCodePoint(...codePoints)\n\t  fromCodePoint: function fromCodePoint(x) {\n\t    var arguments$1 = arguments;\n\t // eslint-disable-line no-unused-vars\n\t    var res = [];\n\t    var aLen = arguments.length;\n\t    var i = 0;\n\t    var code;\n\t    while (aLen > i) {\n\t      code = +arguments$1[i++];\n\t      if (_toAbsoluteIndex(code, 0x10ffff) !== code) { throw RangeError(code + ' is not a valid code point'); }\n\t      res.push(code < 0x10000\n\t        ? fromCharCode(code)\n\t        : fromCharCode(((code -= 0x10000) >> 10) + 0xd800, code % 0x400 + 0xdc00)\n\t      );\n\t    } return res.join('');\n\t  }\n\t});\n\n\tvar fromCodePoint = _core.String.fromCodePoint;\n\n\t// This is a generated file. Do not edit.\n\tvar Space_Separator = /[\\u1680\\u2000-\\u200A\\u202F\\u205F\\u3000]/;\n\tvar ID_Start = /[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u0860-\\u086A\\u08A0-\\u08B4\\u08B6-\\u08BD\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u09FC\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0AF9\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58-\\u0C5A\\u0C60\\u0C61\\u0C80\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D54-\\u0D56\\u0D5F-\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F5\\u13F8-\\u13FD\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u1884\\u1887-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1C80-\\u1C88\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312E\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FEA\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA7AE\\uA7B0-\\uA7B7\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA8FD\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB65\\uAB70-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]|\\uD800[\\uDC00-\\uDC0B\\uDC0D-\\uDC26\\uDC28-\\uDC3A\\uDC3C\\uDC3D\\uDC3F-\\uDC4D\\uDC50-\\uDC5D\\uDC80-\\uDCFA\\uDD40-\\uDD74\\uDE80-\\uDE9C\\uDEA0-\\uDED0\\uDF00-\\uDF1F\\uDF2D-\\uDF4A\\uDF50-\\uDF75\\uDF80-\\uDF9D\\uDFA0-\\uDFC3\\uDFC8-\\uDFCF\\uDFD1-\\uDFD5]|\\uD801[\\uDC00-\\uDC9D\\uDCB0-\\uDCD3\\uDCD8-\\uDCFB\\uDD00-\\uDD27\\uDD30-\\uDD63\\uDE00-\\uDF36\\uDF40-\\uDF55\\uDF60-\\uDF67]|\\uD802[\\uDC00-\\uDC05\\uDC08\\uDC0A-\\uDC35\\uDC37\\uDC38\\uDC3C\\uDC3F-\\uDC55\\uDC60-\\uDC76\\uDC80-\\uDC9E\\uDCE0-\\uDCF2\\uDCF4\\uDCF5\\uDD00-\\uDD15\\uDD20-\\uDD39\\uDD80-\\uDDB7\\uDDBE\\uDDBF\\uDE00\\uDE10-\\uDE13\\uDE15-\\uDE17\\uDE19-\\uDE33\\uDE60-\\uDE7C\\uDE80-\\uDE9C\\uDEC0-\\uDEC7\\uDEC9-\\uDEE4\\uDF00-\\uDF35\\uDF40-\\uDF55\\uDF60-\\uDF72\\uDF80-\\uDF91]|\\uD803[\\uDC00-\\uDC48\\uDC80-\\uDCB2\\uDCC0-\\uDCF2]|\\uD804[\\uDC03-\\uDC37\\uDC83-\\uDCAF\\uDCD0-\\uDCE8\\uDD03-\\uDD26\\uDD50-\\uDD72\\uDD76\\uDD83-\\uDDB2\\uDDC1-\\uDDC4\\uDDDA\\uDDDC\\uDE00-\\uDE11\\uDE13-\\uDE2B\\uDE80-\\uDE86\\uDE88\\uDE8A-\\uDE8D\\uDE8F-\\uDE9D\\uDE9F-\\uDEA8\\uDEB0-\\uDEDE\\uDF05-\\uDF0C\\uDF0F\\uDF10\\uDF13-\\uDF28\\uDF2A-\\uDF30\\uDF32\\uDF33\\uDF35-\\uDF39\\uDF3D\\uDF50\\uDF5D-\\uDF61]|\\uD805[\\uDC00-\\uDC34\\uDC47-\\uDC4A\\uDC80-\\uDCAF\\uDCC4\\uDCC5\\uDCC7\\uDD80-\\uDDAE\\uDDD8-\\uDDDB\\uDE00-\\uDE2F\\uDE44\\uDE80-\\uDEAA\\uDF00-\\uDF19]|\\uD806[\\uDCA0-\\uDCDF\\uDCFF\\uDE00\\uDE0B-\\uDE32\\uDE3A\\uDE50\\uDE5C-\\uDE83\\uDE86-\\uDE89\\uDEC0-\\uDEF8]|\\uD807[\\uDC00-\\uDC08\\uDC0A-\\uDC2E\\uDC40\\uDC72-\\uDC8F\\uDD00-\\uDD06\\uDD08\\uDD09\\uDD0B-\\uDD30\\uDD46]|\\uD808[\\uDC00-\\uDF99]|\\uD809[\\uDC00-\\uDC6E\\uDC80-\\uDD43]|[\\uD80C\\uD81C-\\uD820\\uD840-\\uD868\\uD86A-\\uD86C\\uD86F-\\uD872\\uD874-\\uD879][\\uDC00-\\uDFFF]|\\uD80D[\\uDC00-\\uDC2E]|\\uD811[\\uDC00-\\uDE46]|\\uD81A[\\uDC00-\\uDE38\\uDE40-\\uDE5E\\uDED0-\\uDEED\\uDF00-\\uDF2F\\uDF40-\\uDF43\\uDF63-\\uDF77\\uDF7D-\\uDF8F]|\\uD81B[\\uDF00-\\uDF44\\uDF50\\uDF93-\\uDF9F\\uDFE0\\uDFE1]|\\uD821[\\uDC00-\\uDFEC]|\\uD822[\\uDC00-\\uDEF2]|\\uD82C[\\uDC00-\\uDD1E\\uDD70-\\uDEFB]|\\uD82F[\\uDC00-\\uDC6A\\uDC70-\\uDC7C\\uDC80-\\uDC88\\uDC90-\\uDC99]|\\uD835[\\uDC00-\\uDC54\\uDC56-\\uDC9C\\uDC9E\\uDC9F\\uDCA2\\uDCA5\\uDCA6\\uDCA9-\\uDCAC\\uDCAE-\\uDCB9\\uDCBB\\uDCBD-\\uDCC3\\uDCC5-\\uDD05\\uDD07-\\uDD0A\\uDD0D-\\uDD14\\uDD16-\\uDD1C\\uDD1E-\\uDD39\\uDD3B-\\uDD3E\\uDD40-\\uDD44\\uDD46\\uDD4A-\\uDD50\\uDD52-\\uDEA5\\uDEA8-\\uDEC0\\uDEC2-\\uDEDA\\uDEDC-\\uDEFA\\uDEFC-\\uDF14\\uDF16-\\uDF34\\uDF36-\\uDF4E\\uDF50-\\uDF6E\\uDF70-\\uDF88\\uDF8A-\\uDFA8\\uDFAA-\\uDFC2\\uDFC4-\\uDFCB]|\\uD83A[\\uDC00-\\uDCC4\\uDD00-\\uDD43]|\\uD83B[\\uDE00-\\uDE03\\uDE05-\\uDE1F\\uDE21\\uDE22\\uDE24\\uDE27\\uDE29-\\uDE32\\uDE34-\\uDE37\\uDE39\\uDE3B\\uDE42\\uDE47\\uDE49\\uDE4B\\uDE4D-\\uDE4F\\uDE51\\uDE52\\uDE54\\uDE57\\uDE59\\uDE5B\\uDE5D\\uDE5F\\uDE61\\uDE62\\uDE64\\uDE67-\\uDE6A\\uDE6C-\\uDE72\\uDE74-\\uDE77\\uDE79-\\uDE7C\\uDE7E\\uDE80-\\uDE89\\uDE8B-\\uDE9B\\uDEA1-\\uDEA3\\uDEA5-\\uDEA9\\uDEAB-\\uDEBB]|\\uD869[\\uDC00-\\uDED6\\uDF00-\\uDFFF]|\\uD86D[\\uDC00-\\uDF34\\uDF40-\\uDFFF]|\\uD86E[\\uDC00-\\uDC1D\\uDC20-\\uDFFF]|\\uD873[\\uDC00-\\uDEA1\\uDEB0-\\uDFFF]|\\uD87A[\\uDC00-\\uDFE0]|\\uD87E[\\uDC00-\\uDE1D]/;\n\tvar ID_Continue = /[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u0860-\\u086A\\u08A0-\\u08B4\\u08B6-\\u08BD\\u08D4-\\u08E1\\u08E3-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u09FC\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0AF9-\\u0AFF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58-\\u0C5A\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C80-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D00-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D54-\\u0D57\\u0D5F-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F5\\u13F8-\\u13FD\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1C80-\\u1C88\\u1CD0-\\u1CD2\\u1CD4-\\u1CF9\\u1D00-\\u1DF9\\u1DFB-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312E\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FEA\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA7AE\\uA7B0-\\uA7B7\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C5\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA8FD\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB65\\uAB70-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2F\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]|\\uD800[\\uDC00-\\uDC0B\\uDC0D-\\uDC26\\uDC28-\\uDC3A\\uDC3C\\uDC3D\\uDC3F-\\uDC4D\\uDC50-\\uDC5D\\uDC80-\\uDCFA\\uDD40-\\uDD74\\uDDFD\\uDE80-\\uDE9C\\uDEA0-\\uDED0\\uDEE0\\uDF00-\\uDF1F\\uDF2D-\\uDF4A\\uDF50-\\uDF7A\\uDF80-\\uDF9D\\uDFA0-\\uDFC3\\uDFC8-\\uDFCF\\uDFD1-\\uDFD5]|\\uD801[\\uDC00-\\uDC9D\\uDCA0-\\uDCA9\\uDCB0-\\uDCD3\\uDCD8-\\uDCFB\\uDD00-\\uDD27\\uDD30-\\uDD63\\uDE00-\\uDF36\\uDF40-\\uDF55\\uDF60-\\uDF67]|\\uD802[\\uDC00-\\uDC05\\uDC08\\uDC0A-\\uDC35\\uDC37\\uDC38\\uDC3C\\uDC3F-\\uDC55\\uDC60-\\uDC76\\uDC80-\\uDC9E\\uDCE0-\\uDCF2\\uDCF4\\uDCF5\\uDD00-\\uDD15\\uDD20-\\uDD39\\uDD80-\\uDDB7\\uDDBE\\uDDBF\\uDE00-\\uDE03\\uDE05\\uDE06\\uDE0C-\\uDE13\\uDE15-\\uDE17\\uDE19-\\uDE33\\uDE38-\\uDE3A\\uDE3F\\uDE60-\\uDE7C\\uDE80-\\uDE9C\\uDEC0-\\uDEC7\\uDEC9-\\uDEE6\\uDF00-\\uDF35\\uDF40-\\uDF55\\uDF60-\\uDF72\\uDF80-\\uDF91]|\\uD803[\\uDC00-\\uDC48\\uDC80-\\uDCB2\\uDCC0-\\uDCF2]|\\uD804[\\uDC00-\\uDC46\\uDC66-\\uDC6F\\uDC7F-\\uDCBA\\uDCD0-\\uDCE8\\uDCF0-\\uDCF9\\uDD00-\\uDD34\\uDD36-\\uDD3F\\uDD50-\\uDD73\\uDD76\\uDD80-\\uDDC4\\uDDCA-\\uDDCC\\uDDD0-\\uDDDA\\uDDDC\\uDE00-\\uDE11\\uDE13-\\uDE37\\uDE3E\\uDE80-\\uDE86\\uDE88\\uDE8A-\\uDE8D\\uDE8F-\\uDE9D\\uDE9F-\\uDEA8\\uDEB0-\\uDEEA\\uDEF0-\\uDEF9\\uDF00-\\uDF03\\uDF05-\\uDF0C\\uDF0F\\uDF10\\uDF13-\\uDF28\\uDF2A-\\uDF30\\uDF32\\uDF33\\uDF35-\\uDF39\\uDF3C-\\uDF44\\uDF47\\uDF48\\uDF4B-\\uDF4D\\uDF50\\uDF57\\uDF5D-\\uDF63\\uDF66-\\uDF6C\\uDF70-\\uDF74]|\\uD805[\\uDC00-\\uDC4A\\uDC50-\\uDC59\\uDC80-\\uDCC5\\uDCC7\\uDCD0-\\uDCD9\\uDD80-\\uDDB5\\uDDB8-\\uDDC0\\uDDD8-\\uDDDD\\uDE00-\\uDE40\\uDE44\\uDE50-\\uDE59\\uDE80-\\uDEB7\\uDEC0-\\uDEC9\\uDF00-\\uDF19\\uDF1D-\\uDF2B\\uDF30-\\uDF39]|\\uD806[\\uDCA0-\\uDCE9\\uDCFF\\uDE00-\\uDE3E\\uDE47\\uDE50-\\uDE83\\uDE86-\\uDE99\\uDEC0-\\uDEF8]|\\uD807[\\uDC00-\\uDC08\\uDC0A-\\uDC36\\uDC38-\\uDC40\\uDC50-\\uDC59\\uDC72-\\uDC8F\\uDC92-\\uDCA7\\uDCA9-\\uDCB6\\uDD00-\\uDD06\\uDD08\\uDD09\\uDD0B-\\uDD36\\uDD3A\\uDD3C\\uDD3D\\uDD3F-\\uDD47\\uDD50-\\uDD59]|\\uD808[\\uDC00-\\uDF99]|\\uD809[\\uDC00-\\uDC6E\\uDC80-\\uDD43]|[\\uD80C\\uD81C-\\uD820\\uD840-\\uD868\\uD86A-\\uD86C\\uD86F-\\uD872\\uD874-\\uD879][\\uDC00-\\uDFFF]|\\uD80D[\\uDC00-\\uDC2E]|\\uD811[\\uDC00-\\uDE46]|\\uD81A[\\uDC00-\\uDE38\\uDE40-\\uDE5E\\uDE60-\\uDE69\\uDED0-\\uDEED\\uDEF0-\\uDEF4\\uDF00-\\uDF36\\uDF40-\\uDF43\\uDF50-\\uDF59\\uDF63-\\uDF77\\uDF7D-\\uDF8F]|\\uD81B[\\uDF00-\\uDF44\\uDF50-\\uDF7E\\uDF8F-\\uDF9F\\uDFE0\\uDFE1]|\\uD821[\\uDC00-\\uDFEC]|\\uD822[\\uDC00-\\uDEF2]|\\uD82C[\\uDC00-\\uDD1E\\uDD70-\\uDEFB]|\\uD82F[\\uDC00-\\uDC6A\\uDC70-\\uDC7C\\uDC80-\\uDC88\\uDC90-\\uDC99\\uDC9D\\uDC9E]|\\uD834[\\uDD65-\\uDD69\\uDD6D-\\uDD72\\uDD7B-\\uDD82\\uDD85-\\uDD8B\\uDDAA-\\uDDAD\\uDE42-\\uDE44]|\\uD835[\\uDC00-\\uDC54\\uDC56-\\uDC9C\\uDC9E\\uDC9F\\uDCA2\\uDCA5\\uDCA6\\uDCA9-\\uDCAC\\uDCAE-\\uDCB9\\uDCBB\\uDCBD-\\uDCC3\\uDCC5-\\uDD05\\uDD07-\\uDD0A\\uDD0D-\\uDD14\\uDD16-\\uDD1C\\uDD1E-\\uDD39\\uDD3B-\\uDD3E\\uDD40-\\uDD44\\uDD46\\uDD4A-\\uDD50\\uDD52-\\uDEA5\\uDEA8-\\uDEC0\\uDEC2-\\uDEDA\\uDEDC-\\uDEFA\\uDEFC-\\uDF14\\uDF16-\\uDF34\\uDF36-\\uDF4E\\uDF50-\\uDF6E\\uDF70-\\uDF88\\uDF8A-\\uDFA8\\uDFAA-\\uDFC2\\uDFC4-\\uDFCB\\uDFCE-\\uDFFF]|\\uD836[\\uDE00-\\uDE36\\uDE3B-\\uDE6C\\uDE75\\uDE84\\uDE9B-\\uDE9F\\uDEA1-\\uDEAF]|\\uD838[\\uDC00-\\uDC06\\uDC08-\\uDC18\\uDC1B-\\uDC21\\uDC23\\uDC24\\uDC26-\\uDC2A]|\\uD83A[\\uDC00-\\uDCC4\\uDCD0-\\uDCD6\\uDD00-\\uDD4A\\uDD50-\\uDD59]|\\uD83B[\\uDE00-\\uDE03\\uDE05-\\uDE1F\\uDE21\\uDE22\\uDE24\\uDE27\\uDE29-\\uDE32\\uDE34-\\uDE37\\uDE39\\uDE3B\\uDE42\\uDE47\\uDE49\\uDE4B\\uDE4D-\\uDE4F\\uDE51\\uDE52\\uDE54\\uDE57\\uDE59\\uDE5B\\uDE5D\\uDE5F\\uDE61\\uDE62\\uDE64\\uDE67-\\uDE6A\\uDE6C-\\uDE72\\uDE74-\\uDE77\\uDE79-\\uDE7C\\uDE7E\\uDE80-\\uDE89\\uDE8B-\\uDE9B\\uDEA1-\\uDEA3\\uDEA5-\\uDEA9\\uDEAB-\\uDEBB]|\\uD869[\\uDC00-\\uDED6\\uDF00-\\uDFFF]|\\uD86D[\\uDC00-\\uDF34\\uDF40-\\uDFFF]|\\uD86E[\\uDC00-\\uDC1D\\uDC20-\\uDFFF]|\\uD873[\\uDC00-\\uDEA1\\uDEB0-\\uDFFF]|\\uD87A[\\uDC00-\\uDFE0]|\\uD87E[\\uDC00-\\uDE1D]|\\uDB40[\\uDD00-\\uDDEF]/;\n\n\tvar unicode = {\n\t\tSpace_Separator: Space_Separator,\n\t\tID_Start: ID_Start,\n\t\tID_Continue: ID_Continue\n\t};\n\n\tvar util = {\n\t    isSpaceSeparator: function isSpaceSeparator (c) {\n\t        return typeof c === 'string' && unicode.Space_Separator.test(c)\n\t    },\n\n\t    isIdStartChar: function isIdStartChar (c) {\n\t        return typeof c === 'string' && (\n\t            (c >= 'a' && c <= 'z') ||\n\t        (c >= 'A' && c <= 'Z') ||\n\t        (c === '$') || (c === '_') ||\n\t        unicode.ID_Start.test(c)\n\t        )\n\t    },\n\n\t    isIdContinueChar: function isIdContinueChar (c) {\n\t        return typeof c === 'string' && (\n\t            (c >= 'a' && c <= 'z') ||\n\t        (c >= 'A' && c <= 'Z') ||\n\t        (c >= '0' && c <= '9') ||\n\t        (c === '$') || (c === '_') ||\n\t        (c === '\\u200C') || (c === '\\u200D') ||\n\t        unicode.ID_Continue.test(c)\n\t        )\n\t    },\n\n\t    isDigit: function isDigit (c) {\n\t        return typeof c === 'string' && /[0-9]/.test(c)\n\t    },\n\n\t    isHexDigit: function isHexDigit (c) {\n\t        return typeof c === 'string' && /[0-9A-Fa-f]/.test(c)\n\t    },\n\t};\n\n\tvar source;\n\tvar parseState;\n\tvar stack;\n\tvar pos;\n\tvar line;\n\tvar column;\n\tvar token;\n\tvar key;\n\tvar root;\n\n\tvar parse = function parse (text, reviver) {\n\t    source = String(text);\n\t    parseState = 'start';\n\t    stack = [];\n\t    pos = 0;\n\t    line = 1;\n\t    column = 0;\n\t    token = undefined;\n\t    key = undefined;\n\t    root = undefined;\n\n\t    do {\n\t        token = lex();\n\n\t        // This code is unreachable.\n\t        // if (!parseStates[parseState]) {\n\t        //     throw invalidParseState()\n\t        // }\n\n\t        parseStates[parseState]();\n\t    } while (token.type !== 'eof')\n\n\t    if (typeof reviver === 'function') {\n\t        return internalize({'': root}, '', reviver)\n\t    }\n\n\t    return root\n\t};\n\n\tfunction internalize (holder, name, reviver) {\n\t    var value = holder[name];\n\t    if (value != null && typeof value === 'object') {\n\t        if (Array.isArray(value)) {\n\t            for (var i = 0; i < value.length; i++) {\n\t                var key = String(i);\n\t                var replacement = internalize(value, key, reviver);\n\t                if (replacement === undefined) {\n\t                    delete value[key];\n\t                } else {\n\t                    Object.defineProperty(value, key, {\n\t                        value: replacement,\n\t                        writable: true,\n\t                        enumerable: true,\n\t                        configurable: true,\n\t                    });\n\t                }\n\t            }\n\t        } else {\n\t            for (var key$1 in value) {\n\t                var replacement$1 = internalize(value, key$1, reviver);\n\t                if (replacement$1 === undefined) {\n\t                    delete value[key$1];\n\t                } else {\n\t                    Object.defineProperty(value, key$1, {\n\t                        value: replacement$1,\n\t                        writable: true,\n\t                        enumerable: true,\n\t                        configurable: true,\n\t                    });\n\t                }\n\t            }\n\t        }\n\t    }\n\n\t    return reviver.call(holder, name, value)\n\t}\n\n\tvar lexState;\n\tvar buffer;\n\tvar doubleQuote;\n\tvar sign;\n\tvar c;\n\n\tfunction lex () {\n\t    lexState = 'default';\n\t    buffer = '';\n\t    doubleQuote = false;\n\t    sign = 1;\n\n\t    for (;;) {\n\t        c = peek();\n\n\t        // This code is unreachable.\n\t        // if (!lexStates[lexState]) {\n\t        //     throw invalidLexState(lexState)\n\t        // }\n\n\t        var token = lexStates[lexState]();\n\t        if (token) {\n\t            return token\n\t        }\n\t    }\n\t}\n\n\tfunction peek () {\n\t    if (source[pos]) {\n\t        return String.fromCodePoint(source.codePointAt(pos))\n\t    }\n\t}\n\n\tfunction read () {\n\t    var c = peek();\n\n\t    if (c === '\\n') {\n\t        line++;\n\t        column = 0;\n\t    } else if (c) {\n\t        column += c.length;\n\t    } else {\n\t        column++;\n\t    }\n\n\t    if (c) {\n\t        pos += c.length;\n\t    }\n\n\t    return c\n\t}\n\n\tvar lexStates = {\n\t    default: function default$1 () {\n\t        switch (c) {\n\t        case '\\t':\n\t        case '\\v':\n\t        case '\\f':\n\t        case ' ':\n\t        case '\\u00A0':\n\t        case '\\uFEFF':\n\t        case '\\n':\n\t        case '\\r':\n\t        case '\\u2028':\n\t        case '\\u2029':\n\t            read();\n\t            return\n\n\t        case '/':\n\t            read();\n\t            lexState = 'comment';\n\t            return\n\n\t        case undefined:\n\t            read();\n\t            return newToken('eof')\n\t        }\n\n\t        if (util.isSpaceSeparator(c)) {\n\t            read();\n\t            return\n\t        }\n\n\t        // This code is unreachable.\n\t        // if (!lexStates[parseState]) {\n\t        //     throw invalidLexState(parseState)\n\t        // }\n\n\t        return lexStates[parseState]()\n\t    },\n\n\t    comment: function comment () {\n\t        switch (c) {\n\t        case '*':\n\t            read();\n\t            lexState = 'multiLineComment';\n\t            return\n\n\t        case '/':\n\t            read();\n\t            lexState = 'singleLineComment';\n\t            return\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    multiLineComment: function multiLineComment () {\n\t        switch (c) {\n\t        case '*':\n\t            read();\n\t            lexState = 'multiLineCommentAsterisk';\n\t            return\n\n\t        case undefined:\n\t            throw invalidChar(read())\n\t        }\n\n\t        read();\n\t    },\n\n\t    multiLineCommentAsterisk: function multiLineCommentAsterisk () {\n\t        switch (c) {\n\t        case '*':\n\t            read();\n\t            return\n\n\t        case '/':\n\t            read();\n\t            lexState = 'default';\n\t            return\n\n\t        case undefined:\n\t            throw invalidChar(read())\n\t        }\n\n\t        read();\n\t        lexState = 'multiLineComment';\n\t    },\n\n\t    singleLineComment: function singleLineComment () {\n\t        switch (c) {\n\t        case '\\n':\n\t        case '\\r':\n\t        case '\\u2028':\n\t        case '\\u2029':\n\t            read();\n\t            lexState = 'default';\n\t            return\n\n\t        case undefined:\n\t            read();\n\t            return newToken('eof')\n\t        }\n\n\t        read();\n\t    },\n\n\t    value: function value () {\n\t        switch (c) {\n\t        case '{':\n\t        case '[':\n\t            return newToken('punctuator', read())\n\n\t        case 'n':\n\t            read();\n\t            literal('ull');\n\t            return newToken('null', null)\n\n\t        case 't':\n\t            read();\n\t            literal('rue');\n\t            return newToken('boolean', true)\n\n\t        case 'f':\n\t            read();\n\t            literal('alse');\n\t            return newToken('boolean', false)\n\n\t        case '-':\n\t        case '+':\n\t            if (read() === '-') {\n\t                sign = -1;\n\t            }\n\n\t            lexState = 'sign';\n\t            return\n\n\t        case '.':\n\t            buffer = read();\n\t            lexState = 'decimalPointLeading';\n\t            return\n\n\t        case '0':\n\t            buffer = read();\n\t            lexState = 'zero';\n\t            return\n\n\t        case '1':\n\t        case '2':\n\t        case '3':\n\t        case '4':\n\t        case '5':\n\t        case '6':\n\t        case '7':\n\t        case '8':\n\t        case '9':\n\t            buffer = read();\n\t            lexState = 'decimalInteger';\n\t            return\n\n\t        case 'I':\n\t            read();\n\t            literal('nfinity');\n\t            return newToken('numeric', Infinity)\n\n\t        case 'N':\n\t            read();\n\t            literal('aN');\n\t            return newToken('numeric', NaN)\n\n\t        case '\"':\n\t        case \"'\":\n\t            doubleQuote = (read() === '\"');\n\t            buffer = '';\n\t            lexState = 'string';\n\t            return\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    identifierNameStartEscape: function identifierNameStartEscape () {\n\t        if (c !== 'u') {\n\t            throw invalidChar(read())\n\t        }\n\n\t        read();\n\t        var u = unicodeEscape();\n\t        switch (u) {\n\t        case '$':\n\t        case '_':\n\t            break\n\n\t        default:\n\t            if (!util.isIdStartChar(u)) {\n\t                throw invalidIdentifier()\n\t            }\n\n\t            break\n\t        }\n\n\t        buffer += u;\n\t        lexState = 'identifierName';\n\t    },\n\n\t    identifierName: function identifierName () {\n\t        switch (c) {\n\t        case '$':\n\t        case '_':\n\t        case '\\u200C':\n\t        case '\\u200D':\n\t            buffer += read();\n\t            return\n\n\t        case '\\\\':\n\t            read();\n\t            lexState = 'identifierNameEscape';\n\t            return\n\t        }\n\n\t        if (util.isIdContinueChar(c)) {\n\t            buffer += read();\n\t            return\n\t        }\n\n\t        return newToken('identifier', buffer)\n\t    },\n\n\t    identifierNameEscape: function identifierNameEscape () {\n\t        if (c !== 'u') {\n\t            throw invalidChar(read())\n\t        }\n\n\t        read();\n\t        var u = unicodeEscape();\n\t        switch (u) {\n\t        case '$':\n\t        case '_':\n\t        case '\\u200C':\n\t        case '\\u200D':\n\t            break\n\n\t        default:\n\t            if (!util.isIdContinueChar(u)) {\n\t                throw invalidIdentifier()\n\t            }\n\n\t            break\n\t        }\n\n\t        buffer += u;\n\t        lexState = 'identifierName';\n\t    },\n\n\t    sign: function sign$1 () {\n\t        switch (c) {\n\t        case '.':\n\t            buffer = read();\n\t            lexState = 'decimalPointLeading';\n\t            return\n\n\t        case '0':\n\t            buffer = read();\n\t            lexState = 'zero';\n\t            return\n\n\t        case '1':\n\t        case '2':\n\t        case '3':\n\t        case '4':\n\t        case '5':\n\t        case '6':\n\t        case '7':\n\t        case '8':\n\t        case '9':\n\t            buffer = read();\n\t            lexState = 'decimalInteger';\n\t            return\n\n\t        case 'I':\n\t            read();\n\t            literal('nfinity');\n\t            return newToken('numeric', sign * Infinity)\n\n\t        case 'N':\n\t            read();\n\t            literal('aN');\n\t            return newToken('numeric', NaN)\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    zero: function zero () {\n\t        switch (c) {\n\t        case '.':\n\t            buffer += read();\n\t            lexState = 'decimalPoint';\n\t            return\n\n\t        case 'e':\n\t        case 'E':\n\t            buffer += read();\n\t            lexState = 'decimalExponent';\n\t            return\n\n\t        case 'x':\n\t        case 'X':\n\t            buffer += read();\n\t            lexState = 'hexadecimal';\n\t            return\n\t        }\n\n\t        return newToken('numeric', sign * 0)\n\t    },\n\n\t    decimalInteger: function decimalInteger () {\n\t        switch (c) {\n\t        case '.':\n\t            buffer += read();\n\t            lexState = 'decimalPoint';\n\t            return\n\n\t        case 'e':\n\t        case 'E':\n\t            buffer += read();\n\t            lexState = 'decimalExponent';\n\t            return\n\t        }\n\n\t        if (util.isDigit(c)) {\n\t            buffer += read();\n\t            return\n\t        }\n\n\t        return newToken('numeric', sign * Number(buffer))\n\t    },\n\n\t    decimalPointLeading: function decimalPointLeading () {\n\t        if (util.isDigit(c)) {\n\t            buffer += read();\n\t            lexState = 'decimalFraction';\n\t            return\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    decimalPoint: function decimalPoint () {\n\t        switch (c) {\n\t        case 'e':\n\t        case 'E':\n\t            buffer += read();\n\t            lexState = 'decimalExponent';\n\t            return\n\t        }\n\n\t        if (util.isDigit(c)) {\n\t            buffer += read();\n\t            lexState = 'decimalFraction';\n\t            return\n\t        }\n\n\t        return newToken('numeric', sign * Number(buffer))\n\t    },\n\n\t    decimalFraction: function decimalFraction () {\n\t        switch (c) {\n\t        case 'e':\n\t        case 'E':\n\t            buffer += read();\n\t            lexState = 'decimalExponent';\n\t            return\n\t        }\n\n\t        if (util.isDigit(c)) {\n\t            buffer += read();\n\t            return\n\t        }\n\n\t        return newToken('numeric', sign * Number(buffer))\n\t    },\n\n\t    decimalExponent: function decimalExponent () {\n\t        switch (c) {\n\t        case '+':\n\t        case '-':\n\t            buffer += read();\n\t            lexState = 'decimalExponentSign';\n\t            return\n\t        }\n\n\t        if (util.isDigit(c)) {\n\t            buffer += read();\n\t            lexState = 'decimalExponentInteger';\n\t            return\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    decimalExponentSign: function decimalExponentSign () {\n\t        if (util.isDigit(c)) {\n\t            buffer += read();\n\t            lexState = 'decimalExponentInteger';\n\t            return\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    decimalExponentInteger: function decimalExponentInteger () {\n\t        if (util.isDigit(c)) {\n\t            buffer += read();\n\t            return\n\t        }\n\n\t        return newToken('numeric', sign * Number(buffer))\n\t    },\n\n\t    hexadecimal: function hexadecimal () {\n\t        if (util.isHexDigit(c)) {\n\t            buffer += read();\n\t            lexState = 'hexadecimalInteger';\n\t            return\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    hexadecimalInteger: function hexadecimalInteger () {\n\t        if (util.isHexDigit(c)) {\n\t            buffer += read();\n\t            return\n\t        }\n\n\t        return newToken('numeric', sign * Number(buffer))\n\t    },\n\n\t    string: function string () {\n\t        switch (c) {\n\t        case '\\\\':\n\t            read();\n\t            buffer += escape();\n\t            return\n\n\t        case '\"':\n\t            if (doubleQuote) {\n\t                read();\n\t                return newToken('string', buffer)\n\t            }\n\n\t            buffer += read();\n\t            return\n\n\t        case \"'\":\n\t            if (!doubleQuote) {\n\t                read();\n\t                return newToken('string', buffer)\n\t            }\n\n\t            buffer += read();\n\t            return\n\n\t        case '\\n':\n\t        case '\\r':\n\t            throw invalidChar(read())\n\n\t        case '\\u2028':\n\t        case '\\u2029':\n\t            separatorChar(c);\n\t            break\n\n\t        case undefined:\n\t            throw invalidChar(read())\n\t        }\n\n\t        buffer += read();\n\t    },\n\n\t    start: function start () {\n\t        switch (c) {\n\t        case '{':\n\t        case '[':\n\t            return newToken('punctuator', read())\n\n\t        // This code is unreachable since the default lexState handles eof.\n\t        // case undefined:\n\t        //     return newToken('eof')\n\t        }\n\n\t        lexState = 'value';\n\t    },\n\n\t    beforePropertyName: function beforePropertyName () {\n\t        switch (c) {\n\t        case '$':\n\t        case '_':\n\t            buffer = read();\n\t            lexState = 'identifierName';\n\t            return\n\n\t        case '\\\\':\n\t            read();\n\t            lexState = 'identifierNameStartEscape';\n\t            return\n\n\t        case '}':\n\t            return newToken('punctuator', read())\n\n\t        case '\"':\n\t        case \"'\":\n\t            doubleQuote = (read() === '\"');\n\t            lexState = 'string';\n\t            return\n\t        }\n\n\t        if (util.isIdStartChar(c)) {\n\t            buffer += read();\n\t            lexState = 'identifierName';\n\t            return\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    afterPropertyName: function afterPropertyName () {\n\t        if (c === ':') {\n\t            return newToken('punctuator', read())\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    beforePropertyValue: function beforePropertyValue () {\n\t        lexState = 'value';\n\t    },\n\n\t    afterPropertyValue: function afterPropertyValue () {\n\t        switch (c) {\n\t        case ',':\n\t        case '}':\n\t            return newToken('punctuator', read())\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    beforeArrayValue: function beforeArrayValue () {\n\t        if (c === ']') {\n\t            return newToken('punctuator', read())\n\t        }\n\n\t        lexState = 'value';\n\t    },\n\n\t    afterArrayValue: function afterArrayValue () {\n\t        switch (c) {\n\t        case ',':\n\t        case ']':\n\t            return newToken('punctuator', read())\n\t        }\n\n\t        throw invalidChar(read())\n\t    },\n\n\t    end: function end () {\n\t        // This code is unreachable since it's handled by the default lexState.\n\t        // if (c === undefined) {\n\t        //     read()\n\t        //     return newToken('eof')\n\t        // }\n\n\t        throw invalidChar(read())\n\t    },\n\t};\n\n\tfunction newToken (type, value) {\n\t    return {\n\t        type: type,\n\t        value: value,\n\t        line: line,\n\t        column: column,\n\t    }\n\t}\n\n\tfunction literal (s) {\n\t    for (var i = 0, list = s; i < list.length; i += 1) {\n\t        var c = list[i];\n\n\t        var p = peek();\n\n\t        if (p !== c) {\n\t            throw invalidChar(read())\n\t        }\n\n\t        read();\n\t    }\n\t}\n\n\tfunction escape () {\n\t    var c = peek();\n\t    switch (c) {\n\t    case 'b':\n\t        read();\n\t        return '\\b'\n\n\t    case 'f':\n\t        read();\n\t        return '\\f'\n\n\t    case 'n':\n\t        read();\n\t        return '\\n'\n\n\t    case 'r':\n\t        read();\n\t        return '\\r'\n\n\t    case 't':\n\t        read();\n\t        return '\\t'\n\n\t    case 'v':\n\t        read();\n\t        return '\\v'\n\n\t    case '0':\n\t        read();\n\t        if (util.isDigit(peek())) {\n\t            throw invalidChar(read())\n\t        }\n\n\t        return '\\0'\n\n\t    case 'x':\n\t        read();\n\t        return hexEscape()\n\n\t    case 'u':\n\t        read();\n\t        return unicodeEscape()\n\n\t    case '\\n':\n\t    case '\\u2028':\n\t    case '\\u2029':\n\t        read();\n\t        return ''\n\n\t    case '\\r':\n\t        read();\n\t        if (peek() === '\\n') {\n\t            read();\n\t        }\n\n\t        return ''\n\n\t    case '1':\n\t    case '2':\n\t    case '3':\n\t    case '4':\n\t    case '5':\n\t    case '6':\n\t    case '7':\n\t    case '8':\n\t    case '9':\n\t        throw invalidChar(read())\n\n\t    case undefined:\n\t        throw invalidChar(read())\n\t    }\n\n\t    return read()\n\t}\n\n\tfunction hexEscape () {\n\t    var buffer = '';\n\t    var c = peek();\n\n\t    if (!util.isHexDigit(c)) {\n\t        throw invalidChar(read())\n\t    }\n\n\t    buffer += read();\n\n\t    c = peek();\n\t    if (!util.isHexDigit(c)) {\n\t        throw invalidChar(read())\n\t    }\n\n\t    buffer += read();\n\n\t    return String.fromCodePoint(parseInt(buffer, 16))\n\t}\n\n\tfunction unicodeEscape () {\n\t    var buffer = '';\n\t    var count = 4;\n\n\t    while (count-- > 0) {\n\t        var c = peek();\n\t        if (!util.isHexDigit(c)) {\n\t            throw invalidChar(read())\n\t        }\n\n\t        buffer += read();\n\t    }\n\n\t    return String.fromCodePoint(parseInt(buffer, 16))\n\t}\n\n\tvar parseStates = {\n\t    start: function start () {\n\t        if (token.type === 'eof') {\n\t            throw invalidEOF()\n\t        }\n\n\t        push();\n\t    },\n\n\t    beforePropertyName: function beforePropertyName () {\n\t        switch (token.type) {\n\t        case 'identifier':\n\t        case 'string':\n\t            key = token.value;\n\t            parseState = 'afterPropertyName';\n\t            return\n\n\t        case 'punctuator':\n\t            // This code is unreachable since it's handled by the lexState.\n\t            // if (token.value !== '}') {\n\t            //     throw invalidToken()\n\t            // }\n\n\t            pop();\n\t            return\n\n\t        case 'eof':\n\t            throw invalidEOF()\n\t        }\n\n\t        // This code is unreachable since it's handled by the lexState.\n\t        // throw invalidToken()\n\t    },\n\n\t    afterPropertyName: function afterPropertyName () {\n\t        // This code is unreachable since it's handled by the lexState.\n\t        // if (token.type !== 'punctuator' || token.value !== ':') {\n\t        //     throw invalidToken()\n\t        // }\n\n\t        if (token.type === 'eof') {\n\t            throw invalidEOF()\n\t        }\n\n\t        parseState = 'beforePropertyValue';\n\t    },\n\n\t    beforePropertyValue: function beforePropertyValue () {\n\t        if (token.type === 'eof') {\n\t            throw invalidEOF()\n\t        }\n\n\t        push();\n\t    },\n\n\t    beforeArrayValue: function beforeArrayValue () {\n\t        if (token.type === 'eof') {\n\t            throw invalidEOF()\n\t        }\n\n\t        if (token.type === 'punctuator' && token.value === ']') {\n\t            pop();\n\t            return\n\t        }\n\n\t        push();\n\t    },\n\n\t    afterPropertyValue: function afterPropertyValue () {\n\t        // This code is unreachable since it's handled by the lexState.\n\t        // if (token.type !== 'punctuator') {\n\t        //     throw invalidToken()\n\t        // }\n\n\t        if (token.type === 'eof') {\n\t            throw invalidEOF()\n\t        }\n\n\t        switch (token.value) {\n\t        case ',':\n\t            parseState = 'beforePropertyName';\n\t            return\n\n\t        case '}':\n\t            pop();\n\t        }\n\n\t        // This code is unreachable since it's handled by the lexState.\n\t        // throw invalidToken()\n\t    },\n\n\t    afterArrayValue: function afterArrayValue () {\n\t        // This code is unreachable since it's handled by the lexState.\n\t        // if (token.type !== 'punctuator') {\n\t        //     throw invalidToken()\n\t        // }\n\n\t        if (token.type === 'eof') {\n\t            throw invalidEOF()\n\t        }\n\n\t        switch (token.value) {\n\t        case ',':\n\t            parseState = 'beforeArrayValue';\n\t            return\n\n\t        case ']':\n\t            pop();\n\t        }\n\n\t        // This code is unreachable since it's handled by the lexState.\n\t        // throw invalidToken()\n\t    },\n\n\t    end: function end () {\n\t        // This code is unreachable since it's handled by the lexState.\n\t        // if (token.type !== 'eof') {\n\t        //     throw invalidToken()\n\t        // }\n\t    },\n\t};\n\n\tfunction push () {\n\t    var value;\n\n\t    switch (token.type) {\n\t    case 'punctuator':\n\t        switch (token.value) {\n\t        case '{':\n\t            value = {};\n\t            break\n\n\t        case '[':\n\t            value = [];\n\t            break\n\t        }\n\n\t        break\n\n\t    case 'null':\n\t    case 'boolean':\n\t    case 'numeric':\n\t    case 'string':\n\t        value = token.value;\n\t        break\n\n\t    // This code is unreachable.\n\t    // default:\n\t    //     throw invalidToken()\n\t    }\n\n\t    if (root === undefined) {\n\t        root = value;\n\t    } else {\n\t        var parent = stack[stack.length - 1];\n\t        if (Array.isArray(parent)) {\n\t            parent.push(value);\n\t        } else {\n\t            Object.defineProperty(parent, key, {\n\t                value: value,\n\t                writable: true,\n\t                enumerable: true,\n\t                configurable: true,\n\t            });\n\t        }\n\t    }\n\n\t    if (value !== null && typeof value === 'object') {\n\t        stack.push(value);\n\n\t        if (Array.isArray(value)) {\n\t            parseState = 'beforeArrayValue';\n\t        } else {\n\t            parseState = 'beforePropertyName';\n\t        }\n\t    } else {\n\t        var current = stack[stack.length - 1];\n\t        if (current == null) {\n\t            parseState = 'end';\n\t        } else if (Array.isArray(current)) {\n\t            parseState = 'afterArrayValue';\n\t        } else {\n\t            parseState = 'afterPropertyValue';\n\t        }\n\t    }\n\t}\n\n\tfunction pop () {\n\t    stack.pop();\n\n\t    var current = stack[stack.length - 1];\n\t    if (current == null) {\n\t        parseState = 'end';\n\t    } else if (Array.isArray(current)) {\n\t        parseState = 'afterArrayValue';\n\t    } else {\n\t        parseState = 'afterPropertyValue';\n\t    }\n\t}\n\n\t// This code is unreachable.\n\t// function invalidParseState () {\n\t//     return new Error(`JSON5: invalid parse state '${parseState}'`)\n\t// }\n\n\t// This code is unreachable.\n\t// function invalidLexState (state) {\n\t//     return new Error(`JSON5: invalid lex state '${state}'`)\n\t// }\n\n\tfunction invalidChar (c) {\n\t    if (c === undefined) {\n\t        return syntaxError((\"JSON5: invalid end of input at \" + line + \":\" + column))\n\t    }\n\n\t    return syntaxError((\"JSON5: invalid character '\" + (formatChar(c)) + \"' at \" + line + \":\" + column))\n\t}\n\n\tfunction invalidEOF () {\n\t    return syntaxError((\"JSON5: invalid end of input at \" + line + \":\" + column))\n\t}\n\n\t// This code is unreachable.\n\t// function invalidToken () {\n\t//     if (token.type === 'eof') {\n\t//         return syntaxError(`JSON5: invalid end of input at ${line}:${column}`)\n\t//     }\n\n\t//     const c = String.fromCodePoint(token.value.codePointAt(0))\n\t//     return syntaxError(`JSON5: invalid character '${formatChar(c)}' at ${line}:${column}`)\n\t// }\n\n\tfunction invalidIdentifier () {\n\t    column -= 5;\n\t    return syntaxError((\"JSON5: invalid identifier character at \" + line + \":\" + column))\n\t}\n\n\tfunction separatorChar (c) {\n\t    console.warn((\"JSON5: '\" + (formatChar(c)) + \"' in strings is not valid ECMAScript; consider escaping\"));\n\t}\n\n\tfunction formatChar (c) {\n\t    var replacements = {\n\t        \"'\": \"\\\\'\",\n\t        '\"': '\\\\\"',\n\t        '\\\\': '\\\\\\\\',\n\t        '\\b': '\\\\b',\n\t        '\\f': '\\\\f',\n\t        '\\n': '\\\\n',\n\t        '\\r': '\\\\r',\n\t        '\\t': '\\\\t',\n\t        '\\v': '\\\\v',\n\t        '\\0': '\\\\0',\n\t        '\\u2028': '\\\\u2028',\n\t        '\\u2029': '\\\\u2029',\n\t    };\n\n\t    if (replacements[c]) {\n\t        return replacements[c]\n\t    }\n\n\t    if (c < ' ') {\n\t        var hexString = c.charCodeAt(0).toString(16);\n\t        return '\\\\x' + ('00' + hexString).substring(hexString.length)\n\t    }\n\n\t    return c\n\t}\n\n\tfunction syntaxError (message) {\n\t    var err = new SyntaxError(message);\n\t    err.lineNumber = line;\n\t    err.columnNumber = column;\n\t    return err\n\t}\n\n\tvar stringify = function stringify (value, replacer, space) {\n\t    var stack = [];\n\t    var indent = '';\n\t    var propertyList;\n\t    var replacerFunc;\n\t    var gap = '';\n\t    var quote;\n\n\t    if (\n\t        replacer != null &&\n\t        typeof replacer === 'object' &&\n\t        !Array.isArray(replacer)\n\t    ) {\n\t        space = replacer.space;\n\t        quote = replacer.quote;\n\t        replacer = replacer.replacer;\n\t    }\n\n\t    if (typeof replacer === 'function') {\n\t        replacerFunc = replacer;\n\t    } else if (Array.isArray(replacer)) {\n\t        propertyList = [];\n\t        for (var i = 0, list = replacer; i < list.length; i += 1) {\n\t            var v = list[i];\n\n\t            var item = (void 0);\n\n\t            if (typeof v === 'string') {\n\t                item = v;\n\t            } else if (\n\t                typeof v === 'number' ||\n\t                v instanceof String ||\n\t                v instanceof Number\n\t            ) {\n\t                item = String(v);\n\t            }\n\n\t            if (item !== undefined && propertyList.indexOf(item) < 0) {\n\t                propertyList.push(item);\n\t            }\n\t        }\n\t    }\n\n\t    if (space instanceof Number) {\n\t        space = Number(space);\n\t    } else if (space instanceof String) {\n\t        space = String(space);\n\t    }\n\n\t    if (typeof space === 'number') {\n\t        if (space > 0) {\n\t            space = Math.min(10, Math.floor(space));\n\t            gap = '          '.substr(0, space);\n\t        }\n\t    } else if (typeof space === 'string') {\n\t        gap = space.substr(0, 10);\n\t    }\n\n\t    return serializeProperty('', {'': value})\n\n\t    function serializeProperty (key, holder) {\n\t        var value = holder[key];\n\t        if (value != null) {\n\t            if (typeof value.toJSON5 === 'function') {\n\t                value = value.toJSON5(key);\n\t            } else if (typeof value.toJSON === 'function') {\n\t                value = value.toJSON(key);\n\t            }\n\t        }\n\n\t        if (replacerFunc) {\n\t            value = replacerFunc.call(holder, key, value);\n\t        }\n\n\t        if (value instanceof Number) {\n\t            value = Number(value);\n\t        } else if (value instanceof String) {\n\t            value = String(value);\n\t        } else if (value instanceof Boolean) {\n\t            value = value.valueOf();\n\t        }\n\n\t        switch (value) {\n\t        case null: return 'null'\n\t        case true: return 'true'\n\t        case false: return 'false'\n\t        }\n\n\t        if (typeof value === 'string') {\n\t            return quoteString(value, false)\n\t        }\n\n\t        if (typeof value === 'number') {\n\t            return String(value)\n\t        }\n\n\t        if (typeof value === 'object') {\n\t            return Array.isArray(value) ? serializeArray(value) : serializeObject(value)\n\t        }\n\n\t        return undefined\n\t    }\n\n\t    function quoteString (value) {\n\t        var quotes = {\n\t            \"'\": 0.1,\n\t            '\"': 0.2,\n\t        };\n\n\t        var replacements = {\n\t            \"'\": \"\\\\'\",\n\t            '\"': '\\\\\"',\n\t            '\\\\': '\\\\\\\\',\n\t            '\\b': '\\\\b',\n\t            '\\f': '\\\\f',\n\t            '\\n': '\\\\n',\n\t            '\\r': '\\\\r',\n\t            '\\t': '\\\\t',\n\t            '\\v': '\\\\v',\n\t            '\\0': '\\\\0',\n\t            '\\u2028': '\\\\u2028',\n\t            '\\u2029': '\\\\u2029',\n\t        };\n\n\t        var product = '';\n\n\t        for (var i = 0; i < value.length; i++) {\n\t            var c = value[i];\n\t            switch (c) {\n\t            case \"'\":\n\t            case '\"':\n\t                quotes[c]++;\n\t                product += c;\n\t                continue\n\n\t            case '\\0':\n\t                if (util.isDigit(value[i + 1])) {\n\t                    product += '\\\\x00';\n\t                    continue\n\t                }\n\t            }\n\n\t            if (replacements[c]) {\n\t                product += replacements[c];\n\t                continue\n\t            }\n\n\t            if (c < ' ') {\n\t                var hexString = c.charCodeAt(0).toString(16);\n\t                product += '\\\\x' + ('00' + hexString).substring(hexString.length);\n\t                continue\n\t            }\n\n\t            product += c;\n\t        }\n\n\t        var quoteChar = quote || Object.keys(quotes).reduce(function (a, b) { return (quotes[a] < quotes[b]) ? a : b; });\n\n\t        product = product.replace(new RegExp(quoteChar, 'g'), replacements[quoteChar]);\n\n\t        return quoteChar + product + quoteChar\n\t    }\n\n\t    function serializeObject (value) {\n\t        if (stack.indexOf(value) >= 0) {\n\t            throw TypeError('Converting circular structure to JSON5')\n\t        }\n\n\t        stack.push(value);\n\n\t        var stepback = indent;\n\t        indent = indent + gap;\n\n\t        var keys = propertyList || Object.keys(value);\n\t        var partial = [];\n\t        for (var i = 0, list = keys; i < list.length; i += 1) {\n\t            var key = list[i];\n\n\t            var propertyString = serializeProperty(key, value);\n\t            if (propertyString !== undefined) {\n\t                var member = serializeKey(key) + ':';\n\t                if (gap !== '') {\n\t                    member += ' ';\n\t                }\n\t                member += propertyString;\n\t                partial.push(member);\n\t            }\n\t        }\n\n\t        var final;\n\t        if (partial.length === 0) {\n\t            final = '{}';\n\t        } else {\n\t            var properties;\n\t            if (gap === '') {\n\t                properties = partial.join(',');\n\t                final = '{' + properties + '}';\n\t            } else {\n\t                var separator = ',\\n' + indent;\n\t                properties = partial.join(separator);\n\t                final = '{\\n' + indent + properties + ',\\n' + stepback + '}';\n\t            }\n\t        }\n\n\t        stack.pop();\n\t        indent = stepback;\n\t        return final\n\t    }\n\n\t    function serializeKey (key) {\n\t        if (key.length === 0) {\n\t            return quoteString(key, true)\n\t        }\n\n\t        var firstChar = String.fromCodePoint(key.codePointAt(0));\n\t        if (!util.isIdStartChar(firstChar)) {\n\t            return quoteString(key, true)\n\t        }\n\n\t        for (var i = firstChar.length; i < key.length; i++) {\n\t            if (!util.isIdContinueChar(String.fromCodePoint(key.codePointAt(i)))) {\n\t                return quoteString(key, true)\n\t            }\n\t        }\n\n\t        return key\n\t    }\n\n\t    function serializeArray (value) {\n\t        if (stack.indexOf(value) >= 0) {\n\t            throw TypeError('Converting circular structure to JSON5')\n\t        }\n\n\t        stack.push(value);\n\n\t        var stepback = indent;\n\t        indent = indent + gap;\n\n\t        var partial = [];\n\t        for (var i = 0; i < value.length; i++) {\n\t            var propertyString = serializeProperty(String(i), value);\n\t            partial.push((propertyString !== undefined) ? propertyString : 'null');\n\t        }\n\n\t        var final;\n\t        if (partial.length === 0) {\n\t            final = '[]';\n\t        } else {\n\t            if (gap === '') {\n\t                var properties = partial.join(',');\n\t                final = '[' + properties + ']';\n\t            } else {\n\t                var separator = ',\\n' + indent;\n\t                var properties$1 = partial.join(separator);\n\t                final = '[\\n' + indent + properties$1 + ',\\n' + stepback + ']';\n\t            }\n\t        }\n\n\t        stack.pop();\n\t        indent = stepback;\n\t        return final\n\t    }\n\t};\n\n\tvar JSON5 = {\n\t    parse: parse,\n\t    stringify: stringify,\n\t};\n\n\tvar lib = JSON5;\n\n\tvar es5 = lib;\n\n\treturn es5;\n\n})));\n","import { integerTest, throwFromResult } from './Guards.js';\nexport { string as random } from './Random.js';\n\n/**\n * Returns source text that is between `start` and `end` match strings. Returns _undefined_ if start/end is not found.\n *\n * ```js\n * // Yields ` orange `;\n * between(`apple orange melon`, `apple`, `melon`);\n * ```\n * @param source Source text\n * @param start Start match\n * @param end If undefined, the `start` string will be looked for\n * @param lastEndMatch If true, looks for the last match of `end` (default). If false, looks for the first match.\n * @returns\n */\nexport const between = (\n  source: string,\n  start: string,\n  end?: string,\n  lastEndMatch = true\n): string | undefined => {\n  // ✔ Unit tested\n\n  const startPos = source.indexOf(start);\n  if (startPos < 0) return;\n\n  if (end === undefined) end = start;\n\n  const endPos = lastEndMatch\n    ? source.lastIndexOf(end)\n    : source.indexOf(end, startPos + 1);\n  if (endPos < 0) return;\n\n  return source.slice(startPos + 1, endPos);\n};\n\n/**\n * Like {@link between}, but also returns the source string without the start/end match and what's between.\n * ```js\n * const [src,between] = betweenChomp('hello [there] friend', '[', ']');\n * // src: 'hello  friend'\n * // between: 'there'\n * ```\n * @param source\n * @param start\n * @param end\n * @param lastEndMatch\n * @returns\n */\nexport const betweenChomp = (\n  source: string,\n  start: string,\n  end?: string,\n  lastEndMatch = true\n): [ source: string, between: string | undefined ] => {\n  // ✔ Unit tested\n  const startPos = source.indexOf(start);\n  if (startPos < 0) return [ source, undefined ];\n\n  if (end === undefined) end = start;\n\n  const endPos = lastEndMatch\n    ? source.lastIndexOf(end)\n    : source.indexOf(end, startPos + 1);\n  if (endPos < 0) return [ source, undefined ];\n\n  const between = source.slice(startPos + 1, endPos);\n  const sourceResult = source.slice(0, startPos) + source.slice(endPos + 1);\n  return [ sourceResult, between ];\n};\n/**\n * Returns first position of the given character code, or -1 if not found.\n * @param source Source string\n * @param code Code to seek\n * @param start Start index, 0 by default\n * @param end End index (inclusive), source.length-1 by default\n * @returns Found position, or -1 if not found\n */\nexport const indexOfCharCode = (\n  source: string,\n  code: number,\n  start = 0,\n  end = source.length - 1\n): number => {\n  //eslint-disable-next-line functional/no-let\n  for (let index = start; index <= end; index++) {\n    if (source.codePointAt(index) === code) return index;\n  }\n  return -1;\n};\n\n/**\n * Returns `source` with a given number of characters removed from a start position.\n *\n * ```js\n * // Remove three characters starting at position 1\n * omitChars(`hello there`, 1, 3); // ie. removes 'ell'\n * // Yields: `ho there`\n * ```\n * @param source\n * @param removeStart Start point to remove\n * @param removeLength Number of characters to remove\n * @returns\n */\nexport const omitChars = (\n  source: string,\n  removeStart: number,\n  removeLength: number\n) =>\n  source.slice(0, removeStart) +\n  source.slice(removeStart + removeLength);\n\n/**\n * Splits a string into `length`-size chunks.\n *\n * If `length` is greater than the length of `source`, a single element array is returned with source.\n * The final array element may be smaller if we ran out of characters.\n *\n * ```js\n * splitByLength(`hello there`, 2);\n * // Yields:\n * // [`he`, `ll`, `o `, `th`, `er`, `e`]\n * ```\n * @param source Source string\n * @param length Length of each chunk\n * @returns\n */\nexport const splitByLength = (\n  source: string | null,\n  length: number\n): ReadonlyArray<string> => {\n  throwFromResult(integerTest(length, `aboveZero`, `length`));\n  if (source === null) throw new Error(`source parameter null`);\n  if (typeof source !== `string`) {\n    throw new TypeError(`source parameter not a string`);\n  }\n\n  // ✔ Unit tested\n  const chunks = Math.ceil(source.length / length);\n  const returnValue: Array<string> = [];\n  //eslint-disable-next-line functional/no-let\n  let start = 0;\n\n  //eslint-disable-next-line functional/no-let\n  for (let c = 0; c < chunks; c++) {\n    //eslint-disable-next-line functional/immutable-data\n    returnValue.push(source.slice(start, start + length));\n    start += length;\n  }\n  return returnValue;\n};\n\n/**\n * Returns the `source` string up until (and excluding) `match`. If match is not\n * found, all of `source` is returned.\n *\n * ```js\n * // Yields `apple `\n * untilMarch(`apple orange melon`, `orange`);\n * ```\n * @param source\n * @param match\n * @param startPos If provided, gives the starting offset. Default 0\n */\nexport const untilMatch = (\n  source: string,\n  match: string,\n  options: MatchOptions = {}\n): string => {\n  //  ✔️ Unit tested\n  const startPos = options.startPos ?? undefined;\n  const fromEnd = options.fromEnd ?? false;\n  const m = fromEnd\n    ? source.lastIndexOf(match, startPos)\n    : source.indexOf(match, startPos);\n\n  if (m < 0) return source;\n  return source.slice(startPos ?? 0, m);\n};\n\nexport type MatchOptions = {\n  readonly startPos?: number;\n  readonly fromEnd?: boolean;\n}\n/**\n * Returns all the text in `source` that follows `match`. If not found, `source` is returned.\n * ```js\n * afterMatch(`Hello. There`, `.`); // ' There'\n * afterMatch(`Hello, there', `,`); // 'Hello, there'\n * ```\n * \n * If `source` is _undefined_, an error is thrown.\n * @param source\n * @param match\n * @param startPos\n * @returns\n */\nexport const afterMatch = (\n  source: string,\n  match: string,\n  options: MatchOptions = {}\n): string => {\n  if (source === undefined) throw new Error(`source is undefined`);\n\n  //  ✔️ Unit tested\n  const startPos = options.startPos ?? undefined;\n  const fromEnd = options.fromEnd ?? false;\n\n  const m = fromEnd\n    ? source.lastIndexOf(match, startPos)\n    : source.indexOf(match, startPos);\n\n  if (m < 0) return source;\n  return source.slice(Math.max(0, m + match.length));\n};\n\n/**\n * 'Unwraps' a string, removing one or more 'wrapper' strings that it starts and ends with.\n * Only removes when a matching end is found.\n * ```js\n * unwrap(\"'hello'\", \"'\");        // hello\n * // No mataching end 'a', so nothing happens\n * unwrap(\"apple\", \"a\");          // apple\n * unwrap(\"wow\", \"w\");            // o\n * unwrap(`\"'blah'\"`, '\"', \"'\");  // blah\n * ```\n * @param source\n * @param wrappers\n * @returns\n */\nexport const unwrap = (\n  source: string,\n  ...wrappers: ReadonlyArray<string>\n): string => {\n  //eslint-disable-next-line functional/no-let\n  let matched = false;\n  do {\n    matched = false;\n    for (const w of wrappers) {\n      if (source.startsWith(w) && source.endsWith(w)) {\n        source = source.slice(w.length, source.length - w.length * 2 + 1);\n        matched = true;\n      }\n    }\n  } while (matched);\n\n  return source;\n};\n\n/**\n * A range\n */\nexport type Range = {\n  /**\n   * Text of range\n   */\n  readonly text: string;\n  /**\n   * Start position, with respect to source text\n   */\n  readonly start: number;\n  /**\n   * End position, with respect to source text\n   */\n  readonly end: number;\n  /**\n   * Index of range. First range is 0\n   */\n  readonly index: number;\n}\n\nexport type LineSpan = {\n  readonly start: number;\n  readonly end: number;\n  readonly length: number;\n}\n\n/**\n * Calculates the span, defined in {@link Range} indexes, that includes `start` through to `end` character positions.\n *\n * After using {@link splitRanges} to split text, `lineSpan` is used to associate some text coordinates with ranges.\n *\n * @param ranges Ranges\n * @param start Start character position, in source text reference\n * @param end End character position, in source text reference\n * @returns Span\n */\nexport const lineSpan = (\n  ranges: ReadonlyArray<Range>,\n  start: number,\n  end: number\n): LineSpan => {\n  //eslint-disable-next-line functional/no-let\n  let s = -1;\n  //eslint-disable-next-line functional/no-let\n  let endPos = -1;\n  //eslint-disable-next-line functional/no-let\n  for (const [ index, r ] of ranges.entries()) {\n    s = index;\n    if (r.text.length === 0) continue;\n    if (start < r.end) {\n      break;\n    }\n  }\n\n  //eslint-disable-next-line functional/no-let\n  for (let index = s; index < ranges.length; index++) {\n    const r = ranges[ index ];\n    endPos = index;\n    if (end === r.end) {\n      endPos = index + 1;\n      break;\n    }\n    if (end < r.end) {\n      break;\n    }\n  }\n  return { length: endPos - s, start: s, end: endPos };\n};\n\n/**\n * Splits a source string into ranges:\n * ```js\n * const ranges = splitRanges(\"hello;there;fella\", \";\");\n * ```\n *\n * Each range consists of:\n * ```js\n * {\n *  text: string  - the text of range\n *  start: number - start pos of range, wrt to source\n *  end: number   - end pos of range, wrt to source\n *  index: number - index of range (starting at 0)\n * }\n * ```\n * @param source\n * @param split\n * @returns\n */\nexport const splitRanges = (\n  source: string,\n  split: string\n): ReadonlyArray<Range> => {\n  //eslint-disable-next-line functional/no-let\n  let start = 0;\n  //eslint-disable-next-line functional/no-let\n  let text = ``;\n  const ranges: Array<Range> = [];\n  //eslint-disable-next-line functional/no-let\n  let index = 0;\n  //eslint-disable-next-line functional/no-let,unicorn/prevent-abbreviations\n  for (let i = 0; i < source.length; i++) {\n    if (source.indexOf(split, i) === i) {\n      //eslint-disable-next-line functional/no-let\n      const end = i;\n      //eslint-disable-next-line functional/immutable-data\n      ranges.push({\n        text,\n        start,\n        end,\n        index,\n      });\n      start = end + 1;\n      text = ``;\n      index++;\n    } else {\n      text += source.charAt(i);\n    }\n  }\n  if (start < source.length) {\n    //eslint-disable-next-line functional/immutable-data\n    ranges.push({ text, start, index, end: source.length });\n  }\n  return ranges;\n};\n\n/**\n * Counts the number of times one of `chars` appears at the front of\n * a string, contiguously.\n *\n * ```js\n * countCharsFromStart(`  hi`, ` `); // 2\n * countCharsFromStart(`hi  `, ` `); // 0\n * countCharsFromStart(`  hi  `, ` `); // 2\n * ```\n * @param source\n * @param chars\n * @returns\n */\nexport const countCharsFromStart = (\n  source: string,\n  ...chars: ReadonlyArray<string>\n): number => {\n  //eslint-disable-next-line functional/no-let\n  let counted = 0;\n  //eslint-disable-next-line functional/no-let\n  for (let index = 0; index < source.length; index++) {\n    if (chars.includes(source.charAt(index))) {\n      counted++;\n    } else {\n      break;\n    }\n  }\n  return counted;\n};\n\n/**\n * Returns _true_ if `source` starts and ends with `start` and `end`. Case-sensitive.\n * If _end_ is omitted, the the `start` value will be used.\n *\n * ```js\n * startsEnds(`This is a string`, `This`, `string`); // True\n * startsEnds(`This is a string`, `is`, `a`); // False\n * starsEnds(`test`, `t`); // True, starts and ends with 't'\n * ```\n * @param source String to search within\n * @param start Start\n * @param end End (if omitted, start will be looked for at end as well)\n * @returns True if source starts and ends with provided values.\n */\nexport const startsEnds = (\n  source: string,\n  start: string,\n  end: string = start\n): boolean => source.startsWith(start) && source.endsWith(end);\n\n//eslint-disable-next-line no-useless-escape\nexport const htmlEntities = (source: string): string =>\n  source.replaceAll(/[&<>\\u00A0-\\u9999]/g, (index) => `&#${ index.codePointAt(0) };`);\n","import { shuffle } from './collections/Arrays.js';\nimport { numberTest as guardNumberTest, integerTest as guardIntegerTest, throwFromResult } from './Guards.js';\nimport { type EasingName, get as EasingGet } from './modulation/Easing.js';\nimport { clamp } from './data/Clamp.js';\nimport { range } from './IterableSync.js';\n\nexport { randomElement as arrayElement } from './collections/Arrays.js';\nexport { randomHue as hue } from './visual/Colour.js';\n\nexport type RandomOptions = Readonly<{\n  max: number;\n  min?: number;\n  source?: RandomSource;\n}>\n\n/**\n * Default random number generator: `Math.random`.\n */\nexport const defaultRandom = Math.random;\n\n/**\n * A random source.\n *\n * Predefined sources: {@link defaultRandom}, {@link gaussianSource}, {@link weightedSource}\n */\nexport type RandomSource = () => number;\n\n/**\n * Options for producing weighted distribution\n */\nexport type WeightedOptions = Readonly<{\n  /**\n   * Easing function to use (optional)\n   */\n  easing?: EasingName;\n  /**\n   * Random source (optional)\n   */\n  source?: RandomSource;\n}>\n\n/***\n * Returns a random number, 0..1, weighted by a given easing function.\n * Default easing is `quadIn`, which skews towards zero.\n * Use {@link weighted} to get a value directly.\n *\n * ```js\n * import * as Random from 'https://unpkg.com/ixfx/dist/random.js';\n * const r1 = Random.weightedSource();          // quadIn easing by default, which skews toward low values\n * r1(); // Produce a value\n *\n * const r2 = Random.weightedSource(`quadOut`); // quadOut favours high values\n * r2(); // Produce a value\n * ```\n * @param easingName Easing name or options `quadIn` by default.\n * @see {@link weighted} Returns value instead of function\n * @returns Function which returns a weighted random value\n */\nexport const weightedSource = (\n  easingNameOrOptions: EasingName | WeightedOptions = `quadIn`\n): RandomSource => {\n  const options =\n    typeof easingNameOrOptions === `string`\n      ? { easing: easingNameOrOptions }\n      : easingNameOrOptions;\n  const source = options.source ?? defaultRandom;\n  const easingName = options.easing ?? `quadIn`;\n  const easingFunction = EasingGet(easingName);\n  if (easingFunction === undefined) {\n    throw new Error(`Easing function '${ easingName }' not found.`);\n  }\n\n  const compute = (): number => {\n    const r = source();\n    return easingFunction(r);\n  };\n  return compute;\n};\n\n/***\n * Returns a random number, 0..1, weighted by a given easing function.\n * Default easing is `quadIn`, which skews towards zero.\n *\n * Use {@link weightedSource} to return a function instead.\n *\n * ```js\n * import * as Random from 'https://unpkg.com/ixfx/dist/random.js';\n * Random.weighted();          // quadIn easing by default, which skews toward low values\n * Random.weighted(`quadOut`); // quadOut favours high values\n * ```\n * @param easingNameOrOpts Options. Uses 'quadIn' by default.\n * @see {@link weightedSource} Returns a function rather than value\n * @returns Random number (0-1)\n */\nexport const weighted = (\n  easingNameOrOptions: EasingName | WeightedOptions = `quadIn`\n): number => weightedSource(easingNameOrOptions)();\n\nexport type WeightedIntegerOptions = WeightedOptions & Readonly<{\n  min?: number;\n  max: number;\n}>;\n/**\n * Random integer, weighted according to an easing function.\n * Number will be inclusive of `min` and below `max`.\n *\n * @example 0..99\n * ```js\n * import * as Random from 'https://unpkg.com/ixfx/dist/random.js';\n * const r = Random.weightedIntegerFn(100);\n * r(); // Produce value\n * ```\n *\n * @example 20..29\n * ```js\n * const r = Random.weightedIntegerFn({ min: 20, max: 30 });\n * r(); // Produce value\n * ```\n *\n * @example  0..99 with 'quadIn' easing\n * ```js\n * const r = Random.weightedInteger({ max: 100, easing: `quadIn` });\n * ```\n *\n * Note: result from easing function will be clamped to\n * the min/max (by default 0-1);\n *\n * @param maxOrOpts Maximum (exclusive)\n * @returns Function that produces a random weighted integer\n */\nexport const weightedIntegerSource = (\n  maxOrOptions: number | WeightedIntegerOptions\n): RandomSource => {\n  const options = typeof maxOrOptions === `number` ? { max: maxOrOptions } : maxOrOptions;\n  const source = options.source ?? defaultRandom;\n  const max = options.max;\n  const min = options.min ?? 0;\n  const easingName = options.easing ?? `quadIn`;\n  if (typeof max === `undefined`) throw new Error(`max field is undefined`);\n  if (typeof easingName !== `string`) {\n    throw new TypeError(`easing field expected to be string`);\n  }\n  throwFromResult(guardNumberTest(max));\n\n  const easingFunction = EasingGet(easingName);\n  if (easingFunction === undefined) {\n    throw new Error(`Easing '${ easingName }' not found`);\n  }\n\n  throwFromResult(guardNumberTest(min));\n  if (max <= min) throw new Error(`Max should be greater than min`);\n\n  const compute = (): number => {\n    const r = clamp(easingFunction(source()));\n    return Math.floor(r * (max - min)) + min;\n  };\n  return compute;\n};\n\n/**\n * @example 0..99\n * ```js\n * import * as Random from 'https://unpkg.com/ixfx/dist/random.js';\n * Random.weightedInteger(100);\n * ```\n *\n * @example 20..29\n * ```js\n * Random.weightedInteger({ min: 20, max: 30 });\n * ```\n *\n * @example  0..99 with 'quadIn' easing\n * ```js\n * Random.weightedInteger({ max: 100, easing: `quadIn` })\n * ```\n * @inheritDoc {@link weightedIntegerSource}\n * @param maxOrOpts\n * @returns Random weighted integer\n */\nexport const weightedInteger = (maxOrOptions: number | WeightedIntegerOptions): number =>\n  weightedIntegerSource(maxOrOptions)();\n\n/**\n* Returns a random number from 0..weightings.length, distributed by the weighting values.\n* \n* eg: produces 0 20% of the time, 1 50% of the time, 2 30% of the time\n* ```js\n* weightedIndex([0.2, 0.5, 0.3]);\n* ```\n* @param weightings \n* @param rand \n* @returns \n*/\nexport const weightedIndex = (weightings: Array<number>, rand: RandomSource = defaultRandom): () => number => {\n  const precompute: Array<number> = [];\n  let total = 0;\n  // eslint-disable-next-line unicorn/no-for-loop\n  for (let index = 0; index < weightings.length; index++) {\n    total += weightings[ index ];\n    precompute[ index ] = total;\n  }\n  if (total !== 1) throw new Error(`Weightings should add up to 1. Got: ${ total }`);\n\n  return (): number => {\n    const v = rand();\n    // eslint-disable-next-line unicorn/no-for-loop\n    for (let index = 0; index < precompute.length; index++) {\n      if (v <= precompute[ index ]) return index;\n    }\n    throw new Error(`Bug: weightedIndex could not select index`);\n  }\n}\n\n/**\n * Returns a random number with gaussian (ie. bell-curved) distribution\n * \n * @example Random number between 0..1 with gaussian distribution\n * ```js\n * import * as Random from 'https://unpkg.com/ixfx/dist/random.js';\n * Random.gaussian();\n * ```\n * \n * @example Distribution can be skewed\n * ```js\n * Random.gaussian(10);\n * ```\n * \n\n * @param skew Skew factor. Defaults to 1, no skewing. Above 1 will skew to left, below 1 will skew to right\n * @returns \n */\nexport const gaussian = (skew = 1) => gaussianSource(skew)();\n\n/**\n * Returns a function that generates a gaussian-distributed random number\n *  * @example Random number between 0..1 with gaussian distribution\n * ```js\n * import * as Random from 'https://unpkg.com/ixfx/dist/random.js';\n *\n * // Create function\n * const r = Random.gaussianFn();\n *\n * // Generate random value\n * r();\n * ```\n *\n * @example Pass the random number generator elsewhere\n * ```js\n * import * as Random from 'https://unpkg.com/ixfx/dist/random.js';\n * import * as Arrays from 'https://unpkg.com/ixfx/dist/arrays.js';\n * const r = Random.gaussianFn(10);\n *\n * // Randomise array with gaussian distribution\n * Arrays.shuffle(r);\n * ```\n * @param skew\n * @returns\n */\nexport const gaussianSource = (skew = 1): RandomSource => {\n  const min = 0;\n  const max = 1;\n  // Source: https://stackoverflow.com/questions/25582882/javascript-math-random-normal-distribution-gaussian-bell-curve\n\n  const compute = (): number => {\n    const u = calculateNonZero();\n    const v = calculateNonZero();\n    //eslint-disable-next-line functional/no-let\n    let result = Math.sqrt(-2 * Math.log(u)) * Math.cos(2 * Math.PI * v);\n\n    result = result / 10 + 0.5; // Translate to 0 -> 1\n    if (result > 1 || result < 0) {\n      result = compute(); //;gaussian(skew); // resample between 0 and 1 if out of range\n    } else {\n      result = Math.pow(result, skew); // Skew\n      result *= max - min; // Stretch to fill range\n      result += min; // offset to min\n    }\n    return result;\n  };\n  return compute;\n};\n\nconst calculateNonZero = (source: RandomSource = defaultRandom) => {\n  let v = 0;\n  while (v === 0) {\n    //eslint-disable-next-line functional/no-expression-statements\n    v = source();\n  }\n  return v;\n}\n\n/**\n * Returns a function that produces a random integer between `max` (exclusive) and 0 (inclusive)\n * Use {@link integer} if you want a random number directly.\n *\n * Invoke directly:\n * ```js\n * integerSource(10)();  // Random number 0-9\n * ```\n *\n * Or keep a reference to re-compute:\n * ```js\n * const r = integerSource(10);\n * r(); // Produce a random integer\n * ```\n *\n * If a negative value is given, this is assumed to be the\n * minimum (inclusive), with 0 as the max (inclusive)\n * ```js\n * integerSource(-5)();  // Random number from -5 to 0\n * ```\n *\n * Specify options for a custom minimum or source of random:\n * ```js\n * integerSource({ max: 5,  min: 10 })();  // Random number 4-10\n * integerSource({ max: -5, min: -10 })(); // Random number from -10 to -6\n * integerSource({ max: 10, source: Math.random })(); // Random number between 0-9, with custom source of random\n * ```\n *\n * Throws an error if max & min are equal\n * @param maxOrOpts Max value (exclusive), or set of options\n * @returns Random integer\n */\nexport const integerSource = (maxOrOptions: number | RandomOptions): RandomSource => {\n  if (typeof maxOrOptions === `undefined`) {\n    throw new TypeError(`maxOrOpts is undefined`);\n  }\n  const options = typeof maxOrOptions === `number` ? { max: maxOrOptions } : maxOrOptions;\n  //eslint-disable-next-line functional/no-let\n  let max = Math.floor(options.max);\n  //eslint-disable-next-line functional/no-let\n  let min = Math.floor(options.min ?? 0);\n\n  // If we just get -5 as the max, invert so\n  // max:1 and min: -5 instead for -5...0 range\n  if (!options.min && max < 0) {\n    max = 1;\n    min = options.max;\n  }\n  const randomSource = options.source ?? defaultRandom;\n  if (min > max) {\n    throw new Error(`Min value is greater than max (min: ${ min } max: ${ max })`);\n  }\n\n  throwFromResult(guardNumberTest(min, ``, `min`));\n  throwFromResult(guardNumberTest(max, ``, `max`));\n\n  if (max === min) {\n    throw new Error(`Max and min values cannot be the same (${ max })`);\n  }\n\n  // Distance\n  const amt = Math.abs(max - min);\n  return () => Math.floor(randomSource() * amt) + min;\n};\n\n/**\n * Returns a random integer between `max` (exclusive) and 0 (inclusive)\n * Use {@link integerSource} to return a function instead.\n *\n * ```js\n * integer(10);  // Random number 0-9\n * ```\n *\n * If a negative value is given, this is assumed to be the\n * minimum (inclusive), with 0 as the max (inclusive)\n * ```js\n * integer(-5);  // Random number from -5 to 0\n * ```\n *\n * Specify options for a custom minimum or source of random:\n * ```js\n * integer({ max: 5,  min: 10 });  // Random number 4-10\n * integer({ max: -5, min: -10 }); // Random number from -10 to -6\n * integer({ max: 10, source: Math.random }); // Random number between 0-9, with custom source of random\n * ```\n *\n * Throws an error if max & min are equal\n * @param maxOrOpts Max value (exclusive), or set of options\n * @returns Random integer\n */\nexport const integer = (maxOrOptions: number | RandomOptions): number =>\n  integerSource(maxOrOptions)();\n\n/**\n * Returns a function that produces random float values.\n * Use {@link float} to produce a valued directly.\n *\n * Random float between `max` (exclusive) and 0 (inclusive). Max is 1 if unspecified.\n *\n *\n * ```js\n * // Random number between 0..1 (but not including 1)\n * // (this would be identical to Math.random())\n * const r = floatSource();\n * r(); // Execute to produce random value\n *\n * // Random float between 0..100 (but not including 100)\n * const v = floatSource(100)();\n * ```\n *\n * Options can be used:\n * ```js\n * // Random float between 20..40 (possibly including 20, but always lower than 40)\n * const r = floatSource({ min: 20, max: 40 });\n * ```\n * @param maxOrOpts Maximum value (exclusive) or options\n * @returns Random number\n */\nexport const floatSource = (maxOrOptions: number | RandomOptions = 1): RandomSource => {\n  const options = typeof maxOrOptions === `number` ? { max: maxOrOptions } : maxOrOptions;\n  //eslint-disable-next-line functional/no-let\n  let max = options.max;\n  //eslint-disable-next-line functional/no-let\n  let min = options.min ?? 0;\n  const source = options.source ?? defaultRandom;\n\n  throwFromResult(guardNumberTest(min, ``, `min`));\n  throwFromResult(guardNumberTest(max, ``, `max`));\n\n  if (!options.min && max < 0) {\n    min = max;\n    max = 0;\n  }\n  if (min > max) {\n    throw new Error(`Min is greater than max. Min: ${ min } max: ${ max }`);\n  }\n\n  return () => source() * (max - min) + min;\n};\n\n/**\n * Returns a random float between `max` (exclusive) and 0 (inclusive). Max is 1 if unspecified.\n * Use {@link floatSource} to get a function that produces values. This is used internally.\n *\n * ```js\n * // Random number between 0..1 (but not including 1)\n * // (this would be identical to Math.random())\n * const v = float();\n * // Random float between 0..100 (but not including 100)\n * const v = float(100);\n * ```\n *\n * Options can be used:\n * ```js\n * // Random float between 20..40 (possibly including 20, but always lower than 40)\n * const v = float({ min: 20, max: 40 });\n * ```\n * @param maxOrOpts Maximum value (exclusive) or options\n * @returns Random number\n */\nexport const float = (maxOrOptions: number | RandomOptions = 1): number =>\n  floatSource(maxOrOptions)();\n\nexport type StringOptions = Readonly<{\n  length: number;\n  source?: RandomSource;\n}>\n\n/**\n * Returns a string of random letters and numbers of a given `length`.\n *\n * ```js\n * string();  // Random string of length 5\n * string(4); // eg. `4afd`\n * ```\n * @param length Length of random string\n * @returns Random string\n */\nexport const string = (lengthOrOptions: number | StringOptions = 5) => {\n  const options =\n    typeof lengthOrOptions === `number` ? { length: lengthOrOptions } : lengthOrOptions;\n  const calculate = options.source ?? defaultRandom;\n  return calculate()\n    .toString(36)\n    .slice(2, length + 2);\n};\n\n/**\n * Generates a short roughly unique id\n * ```js\n * const id = shortGuid();\n * ```\n * @param opts Options.\n * @returns\n */\nexport const shortGuid = (options: Readonly<{ source?: RandomSource }> = {}) => {\n  const source = options.source ?? defaultRandom;\n  // Via Stackoverflow...\n  const firstPart = Math.trunc(source() * 46_656);\n  const secondPart = Math.trunc(source() * 46_656);\n  const firstPartString = `000${ firstPart.toString(36) }`.slice(-3);\n  const secondPartString = `000${ secondPart.toString(36) }`.slice(-3);\n  return firstPartString + secondPartString;\n};\n\n/**\n * Returns a random number of minutes, with a unit of milliseconds.\n * Max value is exclusive.\n * Use {@link minutesMs} to get a value directly, or {@link minutesMsSource} to return a function.\n *\n * @example Random value from 0 to one milli less than 5 * 60 * 1000\n * ```js\n * // Create function that returns value\n * const f = minutesMsSource(5);\n *\n * f(); // Generate value\n * ```\n *\n * @example Specified options:\n * ```js\n * // Random time between one minute and 5 minutes\n * const f = minutesMsSource({ max: 5, min: 1 });\n * f();\n * ```\n *\n * @remarks\n * It's a very minor function, but can make\n * code a little more literate:\n * ```js\n * // Random timeout of up to 5 mins\n * setTimeout(() => { ... }, minutesMsSource(5));\n * ```\n * @param maxMinutesOrOpts\n * @see {@link minutesMs}\n * @returns Function that produces a random value\n */\nexport const minutesMsSource = (\n  maxMinutesOrOptions: number | RandomOptions\n): RandomSource => {\n  const options =\n    typeof maxMinutesOrOptions === `number`\n      ? { max: maxMinutesOrOptions }\n      : maxMinutesOrOptions;\n  const min = (options.min ?? 0) * 60 * 1000;\n  const max = options.max * 60 * 1000;\n  return integerSource({ ...options, max, min });\n};\n\n/**\n * @example Random value from 0 to one milli less than 5 * 60 * 1000\n * ```js\n * // Random value from 0 to one milli less than 5*60*1000\n * minuteMs(5);\n * ```\n *\n * @example Specified options:\n * ```js\n * // Random time between one minute and 5 minutes\n * minuteMs({ max: 5, min: 1 });\n * ```\n * @inheritDoc minutesMsSource\n *\n * @param maxMinutesOrOpts\n * @see {@link minutesMsSource}\n * @returns Milliseconds\n */\nexport const minutesMs = (maxMinutesOrOptions: number | RandomOptions): number =>\n  minutesMsSource(maxMinutesOrOptions)();\n\n/**\n * Returns function which produces a random number of seconds, with a unit of milliseconds.\n * Maximum value is exclusive.\n * Use {@link secondsMs} to return a random value directly, or {@link secondsMsSource} to return a function.\n *\n * @example Random milliseconds between 0..4999\n * ```js\n * // Create function\n * const f = secondsMsSource(5000);\n * // Produce a value\n * const value = f();\n * ```\n *\n * @example Options can be provided\n * ```js\n * // Random milliseconds between 1000-4999\n * const value = secondsMsSource({ max:5, min:1 })();\n * // Note the extra () at the end to execute the function\n * ```\n *\n * @remarks\n * It's a very minor function, but can make\n * code a little more literate:\n * ```js\n * // Random timeout of up to 5 seconds\n * setTimeout(() => { ...}, secondsMsSource(5));\n * ```\n * @param maxSecondsOrOpts Maximum seconds, or options.\n * @returns Milliseconds\n */\nexport const secondsMsSource = (\n  maxSecondsOrOptions: number | RandomOptions\n): RandomSource => {\n  const options =\n    typeof maxSecondsOrOptions === `number`\n      ? { max: maxSecondsOrOptions }\n      : maxSecondsOrOptions;\n  const min = (options.min ?? 0) * 1000;\n  const max = options.max * 1000;\n  return () => integer({ ...options, max, min });\n};\n\n/**\n * @example Random milliseconds between 0..4999\n * ```js\n * secondsMs(5000);\n * ```\n *\n * @example Options can be provided\n * ```js\n * // Random milliseconds between 1000-4999\n * secondsMs({ max:5, min:1 });\n * ```\n * @inheritDoc secondsMsSource\n * @param maxSecondsOrOpts\n * @returns\n */\nexport const secondsMs = (maxSecondsOrOptions: number | RandomOptions): number =>\n  secondsMsSource(maxSecondsOrOptions)();\n\nexport type GenerateRandomOptions = RandomOptions & Readonly<{\n  /**\n   * If true, number range is looped\n   */\n  loop?: boolean;\n}>;\n\n/**\n * Returns a generator over random unique integers, up to\n * but not including the given max value.\n *\n * @example 0..9 range\n * ```js\n * const rand = [ ...integerUniqueGen(10) ];\n * // eg: [2, 9, 6, 0, 8, 7, 3, 4, 5, 1]\n * ```\n *\n * @example Options can be provided:\n * ```js\n * // 5..9 range\n * const rand = [ ...integerUniqueGen({ min: 5, max: 10 })];\n * ```\n *\n * Range can be looped. Once the initial random walk through the number\n * range completes, it starts again in a new random way.\n *\n * ```js\n * for (const r of integerUniqueGen({ max: 10, loop: true })) {\n *  // Warning: loops forever\n * }\n * ```\n *\n * Behind the scenes, an array of numbers is created that captures the range, this is then\n * shuffled on the first run, and again whenever the iterator loops, if that's allowed.\n *\n * As a consequence, large ranges will consume larger amounts of memory.\n * @param maxOrOpts\n * @returns\n */\nexport function* integerUniqueGen(\n  maxOrOptions: number | GenerateRandomOptions\n): IterableIterator<number> {\n  const options = typeof maxOrOptions === `number` ? { max: maxOrOptions } : maxOrOptions;\n  const min = options.min ?? 0;\n  const max = options.max;\n  const source = options.source ?? defaultRandom;\n  const loop = options.loop ?? false;\n\n  throwFromResult(guardIntegerTest(min, ``, `min`));\n  throwFromResult(guardIntegerTest(max, ``, `max`));\n  if (min > max) {\n    throw new Error(`Min value is greater than max. Min: ${ min } Max: ${ max }`);\n  }\n\n  const origRange = [ ...range(min, max - min) ];\n  //eslint-disable-next-line functional/no-let\n  let numberRange = shuffle(origRange);\n  //eslint-disable-next-line functional/no-let\n  let index = 0;\n  while (true) {\n    if (index === numberRange.length) {\n      if (loop) numberRange = shuffle(origRange, source);\n      else return;\n    }\n    yield numberRange[ index++ ];\n  }\n}\n\nexport { randomIndex as arrayIndex } from './collections/Arrays.js';","/* eslint-disable indent */\n/**\n * Functions for working with primitive arrays, regardless of type\n * See Also: NumericArrays.ts\n */\n\nimport { throwIntegerTest } from '../Guards.js';\nimport { defaultRandom, weightedIndex, type RandomSource } from '../Random.js';\nimport {\n  type ToString,\n  toStringDefault,\n} from '../Util.js';\nimport {\n  type IsEqual,\n  isEqualDefault,\n  isEqualValueDefault\n} from '../IsEqual.js'\nimport { fromIterable as mapFromIterable } from './map/MapFns.js';\nexport * from './NumericArrays.js';\nexport { compareValues, compareValuesEqual } from './Iterables.js';\n\n/**\n * Throws an error if `array` parameter is not a valid array\n *\n * ```js\n * import { guardArray } from 'https://unpkg.com/ixfx/dist/arrays.js';\n * guardArray(someVariable);\n * ```\n * @private\n * @param array\n * @param name\n */\nexport const guardArray = <V>(array: ArrayLike<V>, name = `?`) => {\n  if (array === undefined) {\n    throw new TypeError(`Param '${ name }' is undefined. Expected array.`);\n  }\n  if (array === null) {\n    throw new TypeError(`Param '${ name }' is null. Expected array.`);\n  }\n  if (!Array.isArray(array)) {\n    throw new TypeError(`Param '${ name }' not an array as expected`);\n  }\n};\n\n/**\n * Throws if `index` is an invalid array index for `array`, and if\n * `array` itself is not a valid array.\n * @param array\n * @param index\n */\nexport const guardIndex = <V>(\n  array: ArrayLike<V>,\n  index: number,\n  name = `index`\n) => {\n  guardArray(array);\n  throwIntegerTest(index, `positive`, name);\n  if (index > array.length - 1) {\n    throw new Error(\n      `'${ name }' ${ index } beyond array max of ${ array.length - 1 }`\n    );\n  }\n};\n\n/**\n * Returns _true_ if all the contents of the array are identical.\n *\n * @example Uses default equality function:\n * ```js\n * import { valuesEqual } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * const a1 = [10, 10, 10];\n * valuesEqual(a1); // True\n *\n * const a2 = [ {name:`Jane`}, {name:`John} ];\n * valuesEqual(a2); // True, because JSON version captures value\n * ```\n *\n * If we want to compare by value for objects that aren't readily\n * converted to JSON, you need to provide a function:\n *\n * ```js\n * valuesEqual(someArray, (a, b) => {\n *  return (a.eventType === b.eventType);\n * });\n * ```\n *\n * Returns _true_ if `array` is empty.\n * @param array Array\n * @param equality Equality checker. Uses string-conversion checking by default\n * @returns\n */\nexport const valuesEqual = <V>(\n  //eslint-disable-next-line functional/prefer-readonly-type\n  array: ReadonlyArray<V> | Array<V>,\n  equality?: IsEqual<V>\n): boolean => {\n  // Unit tested\n\n  if (!Array.isArray(array)) throw new Error(`Param 'array' is not an array.`);\n  if (array.length === 0) return true;\n  const eq = equality ?? isEqualValueDefault;\n  const a = array[ 0 ];\n  const r = array.some((v) => !eq(a, v));\n  if (r) return false;\n  return true;\n};\n\n/**\n * Returns the _intersection_ of two arrays: the elements that are in common.\n * \n * ```js\n * intersection([1, 2, 3], [2, 4, 6]);\n// returns [2]\n * ```\n * See also: \n * * {@link unique}: Unique set of items amongst one or more arrays\n * @param arrayA \n * @param arrayB \n * @param equality \n * @returns \n */\nexport const intersection = <V>(\n  arrayA: ReadonlyArray<V> | Array<V>,\n  arrayB: ReadonlyArray<V> | Array<V>,\n  equality: IsEqual<V> = isEqualDefault\n) => arrayA.filter((valueFromA) => arrayB.some((valueFromB) => equality(valueFromA, valueFromB)));\n\n/**\n * Returns a 'flattened' copy of array, un-nesting arrays one level\n * ```js\n * flatten([1, [2, 3], [[4]] ]);\n * // Yields: [ 1, 2, 3, [4]];\n * ```\n * @param array\n * @returns\n */\nexport const flatten = (array: ReadonlyArray<any> | Array<any>): Array<any> =>\n  [ ...array ].flat();\n\n\n/**\n * Zip combines the elements of two or more arrays based on their index.\n *\n * ```js\n * import { zip } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * const a = [1,2,3];\n * const b = [`red`, `blue`, `green`];\n *\n * const c = zip(a, b);\n * // Yields:\n * // [\n * //   [1, `red`],\n * //   [2, `blue`],\n * //   [3, `green`]\n * // ]\n * ```\n *\n * Typically the arrays you zip together are all about the same logical item. Eg, in the above example\n * perhaps `a` is size and `b` is colour. So thing #1 (at array index 0) is a red thing of size 1. Before\n * zipping we'd access it by `a[0]` and `b[0]`. After zipping, we'd have c[0], which is array of [1, `red`].\n * @param arrays\n * @returns Zipped together array\n */\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const zip = (\n  ...arrays: Array<Array<any>> | ReadonlyArray<Array<any>> | ReadonlyArray<ReadonlyArray<any>>\n): Array<any> => {\n  // Unit tested\n  if (arrays.some((a) => !Array.isArray(a))) {\n    throw new Error(`All parameters must be an array`);\n  }\n  const lengths = arrays.map((a) => a.length);\n  if (!valuesEqual(lengths)) {\n    throw new Error(`Arrays must be of same length`);\n  }\n\n  const returnValue = [];\n  const length = lengths[ 0 ];\n\n  for (let index = 0; index < length; index++) {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    returnValue.push(arrays.map((a) => a[ index ]));\n  }\n  return returnValue;\n};\n\n/**\n * Returns an interleaving of two or more arrays. All arrays must be the same length.\n *\n * ```js\n * import { interleave } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * const a = [`a`, `b`, `c`];\n * const b = [`1`, `2`, `3`];\n * const c = interleave(a, b);\n * // Yields:\n * // [`a`, `1`, `b`, `2`, `c`, `3`]\n * ```\n * @param arrays\n * @returns\n */\nexport const interleave = <V>(\n  ...arrays: ReadonlyArray<ReadonlyArray<V>> | Array<Array<V>>\n): Array<V> => {\n  if (arrays.some((a) => !Array.isArray(a))) {\n    throw new Error(`All parameters must be an array`);\n  }\n  const lengths = arrays.map((a) => a.length);\n  if (!valuesEqual(lengths)) {\n    throw new Error(`Arrays must be of same length`);\n  }\n\n  const returnValue = [];\n  const length = lengths[ 0 ];\n  //eslint-disable-next-line functional/no-let\n  for (let index = 0; index < length; index++) {\n    //eslint-disable-next-line functional/no-let\n    for (const array of arrays) {\n      //eslint-disable-next-line functional/immutable-data\n      returnValue.push(array[ index ]);\n    }\n  }\n  return returnValue;\n};\n\n/**\n * Returns a copy of `data` with specified length.\n * If the input array is too long, it is truncated.\n *\n * If the input array is too short, it will be expanded based on the `expand` strategy:\n *  - 'undefined': fill with `undefined`\n *  - 'repeat': repeat array elements, starting from position 0\n *  - 'first': repeat with first element from `data`\n *  - 'last': repeat with last element from `data`\n *\n * ```js\n * import { ensureLength } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * ensureLength([1,2,3], 2); // [1,2]\n * ensureLength([1,2,3], 5, `undefined`); // [1,2,3,undefined,undefined]\n * ensureLength([1,2,3], 5, `repeat`);    // [1,2,3,1,2]\n * ensureLength([1,2,3], 5, `first`);     // [1,2,3,1,1]\n * ensureLength([1,2,3], 5, `last`);      // [1,2,3,3,3]\n * ```\n * @param data Input array to expand\n * @param length Desired length\n * @param expand Expand strategy\n * @typeParam V Type of array\n */\nexport const ensureLength = <V>(\n  data: ReadonlyArray<V> | Array<V>,\n  length: number,\n  expand: `undefined` | `repeat` | `first` | `last` = `undefined`\n): Array<V> => {\n  // Unit tested\n  if (data === undefined) throw new Error(`Data undefined`);\n  if (!Array.isArray(data)) throw new Error(`data is not an array`);\n  if (data.length === length) return [ ...data ];\n  if (data.length > length) {\n    return data.slice(0, length);\n  }\n  const d = [ ...data ];\n  const add = length - d.length;\n\n  //eslint-disable-next-line functional/no-let\n  for (let index = 0; index < add; index++) {\n    //eslint-disable-next-line functional/immutable-data\n    switch (expand) {\n      case `undefined`: {\n        // @ts-expect-error\n        d.push(undefined);\n        break;\n      }\n      case `repeat`: {\n        d.push(data[ index % data.length ]);\n        break;\n      }\n      case `first`: {\n        d.push(data[ 0 ]);\n        break;\n      }\n      case `last`: {\n        // @ts-expect-error\n        d.push(data.at(-1));\n        break;\n      }\n      // No default\n    }\n  }\n  return d;\n};\n\n/**\n * Return elements from `array` that match a given `predicate`, and moreover are between\n * the given `startIndex` (inclusive) and `endIndex` (exclusive).\n *\n * While this can be done with in the in-built `array.filter` function, it will\n * needlessly iterate through the whole array. It also avoids another alternative\n * of slicing the array before using `filter`.\n *\n * ```js\n * import { filterBetween } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * // Return 'registered' people between and including array indexes 5-10\n * const filtered = filterBetween(people, person => person.registered, 5, 10);\n * ```\n * @param array Array to filter\n * @param predicate Filter function\n * @param startIndex Start index (defaults to 0)\n * @param endIndex End index (by default runs until end)\n */\nexport const filterBetween = <V>(\n  array: ReadonlyArray<V> | Array<V>,\n  predicate: (\n    value: V,\n    index: number,\n    array: ReadonlyArray<V> | Array<V>\n  ) => boolean,\n  startIndex?: number,\n  endIndex?: number\n): Array<V> => {\n  guardArray(array);\n  if (typeof startIndex === `undefined`) startIndex = 0;\n  if (typeof endIndex === `undefined`) endIndex = array.length; //- 1;\n  guardIndex(array, startIndex, `startIndex`);\n  guardIndex(array, endIndex - 1, `endIndex`);\n\n  const t: Array<V> = [];\n\n  //eslint-disable-next-line functional/no-let\n  for (let index = startIndex; index < endIndex; index++) {\n    //eslint-disable-next-line functional/immutable-data\n    if (predicate(array[ index ], index, array)) t.push(array[ index ]);\n  }\n  return t;\n};\n\n/**\n * Returns a random array index.\n *\n * ```js\n * import { randomIndex } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * const v = [`blue`, `red`, `orange`];\n * randomIndex(v); // Yields 0, 1 or 2\n * ```\n *\n * Use {@link randomElement} if you want a value from `array`, not index.\n *\n * @param array Array\n * @param rand Random generator. `Math.random` by default.\n * @returns\n */\nexport const randomIndex = <V>(\n  array: ArrayLike<V>,\n  rand: RandomSource = defaultRandom\n): number => Math.floor(rand() * array.length);\n\n/**\n * Selects a random array index, biased by the provided `weightings`.\n * \n * In the below example, `a` will be picked 20% of the time, `b` 50% and so on.\n * ```js\n * const data =    [  `a`,  `b`,  `c`,  `d` ]\n * const weights = [ 0.2,  0.5,  0.1,  0.2 ] \n * ```\n * @param array \n * @param weightings \n * @param randomSource \n */\nexport const randomElementWeightedSource = <V>(array: ArrayLike<V>, weightings: Array<number>, randomSource: RandomSource = defaultRandom) => {\n  if (array.length !== weightings.length) throw new Error(`Lengths of 'array' and 'weightings' should be the same.`);\n  const r = weightedIndex(weightings, randomSource);\n  return (): V => {\n    const index = r();\n    return array[ index ];\n  }\n}\n\n\n\n\n/**\n * Returns random element.\n *\n * ```js\n * import { randomElement } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * const v = [`blue`, `red`, `orange`];\n * randomElement(v); // Yields `blue`, `red` or `orange`\n * ```\n *\n * Use {@link randomIndex} if you want a random index within `array`.\n *\n * @param array\n * @params rand Random generator. `Math.random` by default.\n * @returns\n */\nexport const randomElement = <V>(\n  array: ArrayLike<V>,\n  rand: RandomSource = defaultRandom\n): V => {\n  guardArray(array, `array`);\n  return array[ Math.floor(rand() * array.length) ];\n};\n\n/**\n * Removes a random item from an array, returning both the item and the new array as a result.\n * Does not modify the original array unless `mutate` parameter is true.\n *\n * @example Without changing source\n * ```js\n * import { randomPluck } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * const data = [100, 20, 40];\n * const {value, array} = randomPluck(data);\n * // value: 20, array: [100, 40], data: [100, 20, 40];\n * ```\n *\n * @example Mutating source\n * ```js\n * import { randomPluck } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * const data = [100, 20, 40];\n * const {value} = randomPluck(data, true);\n * // value: 20, data: [100, 40];\n * ```\n *\n * @template V Type of array\n * @param array Array to pluck item from\n * @param mutate If _true_, changes input array. _False_ by default.\n * @param random Random generatr. `Math.random` by default.\n * @return Returns an object `{value:V|undefined, array:V[]}`\n *\n */\nexport const randomPluck = <V>(\n  array: ReadonlyArray<V> | Array<V>,\n  mutate = false,\n  rand: RandomSource = defaultRandom\n): { readonly value: V | undefined; readonly array: Array<V> } => {\n  if (array === undefined) throw new Error(`array is undefined`);\n  if (!Array.isArray(array)) throw new Error(`'array' param is not an array`);\n  if (array.length === 0) return { value: undefined, array: [] };\n  const index = randomIndex(array, rand);\n  if (mutate) {\n    return {\n      value: array[ index ],\n      //eslint-disable-next-line functional/immutable-data\n      array: array.splice(index, 1),\n    };\n  } else {\n    // Copy array, remove item from that\n    const t = [ ...array ];\n    //eslint-disable-next-line functional/immutable-data\n    t.splice(index, 1);\n    return {\n      value: array[ index ],\n      array: t,\n    };\n  }\n};\n\n/**\n * Returns a shuffled copy of the input array.\n * @example\n * ```js\n * import { shuffle } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * const d = [1, 2, 3, 4];\n * const s = shuffle(d);\n * // d: [1, 2, 3, 4], s: [3, 1, 2, 4]\n * ```\n * @param dataToShuffle\n * @param rand Random generator. `Math.random` by default.\n * @returns Copy with items moved around randomly\n * @template V Type of array items\n */\nexport const shuffle = <V>(\n  dataToShuffle: ReadonlyArray<V>,\n  rand: RandomSource = defaultRandom\n): Array<V> => {\n  const array = [ ...dataToShuffle ];\n  // eslint-disable-next-line  functional/no-let\n  for (let index = array.length - 1; index > 0; index--) {\n    const index_ = Math.floor(rand() * (index + 1));\n    [ array[ index ], array[ index_ ] ] = [ array[ index_ ], array[ index ] ];\n  }\n  return array;\n};\n\n/**\n * Sorts an array of objects in ascending order\n * by the given property name, assuming it is a number.\n *\n * ```js\n * const data = [\n *  { size: 10, colour: `red` },\n *  { size: 20, colour: `blue` },\n *  { size: 5, colour: `pink` }\n * ];\n * const sorted = Arrays.sortByNumericProperty(data, `size`);\n *\n * Yields items ascending order:\n * [ { size: 5, colour: `pink` }, { size: 10, colour: `red` }, { size: 20, colour: `blue` } ]\n * ```\n * @param data\n * @param propertyName\n */\nexport const sortByNumericProperty = <V, K extends keyof V>(\n  data: ReadonlyArray<V> | Array<V>,\n  propertyName: K\n) => [ ...data ].sort((a, b) => {\n  guardArray(data, `data`);\n  const av = a[ propertyName ];\n  const bv = b[ propertyName ];\n  if (av < bv) return -1;\n  if (av > bv) return 1;\n  return 0;\n});\n\n/**\n * Returns an array with value(s) omitted. If value is not found, result will be a copy of input.\n * Value checking is completed via the provided `comparer` function.\n * By default checking whether `a === b`. To compare based on value, use the `isEqualValueDefault` comparer.\n *\n * @example\n * ```js\n * import { without } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * const data = [100, 20, 40];\n * const filtered = without(data, 20); // [100, 40]\n * ```\n *\n * @example Using value-based comparison\n * ```js\n * import { without } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * const data = [{name: `Alice`}, {name:`Sam`}];\n *\n * // This wouldn't work as expected, because the default comparer uses instance,\n * // not value:\n * without(data, {name: `Alice`});\n *\n * // So instead we can use a value comparer:\n * without(data, {name:`Alice`}, isEqualValueDefault);\n * ```\n *\n * @example Use a function\n * ```js\n * import { without } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * const data = [{name: `Alice`}, {name:`Sam`}];\n * without(data, {name:`ALICE`}, (a, b) => {\n *  return (a.name.toLowerCase() === b.name.toLowerCase());\n * });\n * ```\n *\n * Consider {@link remove} to remove an item by index.\n *\n * @template V Type of array items\n * @param data Source array\n * @param value Value(s) to remove\n * @param comparer Comparison function. If not provided `Util.isEqualDefault` is used, which compares using `===`\n * @return Copy of array without value.\n */\nexport const without = <V>(\n  //eslint-disable-next-line functional/prefer-readonly-type\n  data: ReadonlyArray<V> | Array<V>,\n  value: V | Array<V>,\n  comparer: IsEqual<V> = isEqualDefault\n): Array<V> => {\n  if (Array.isArray(value)) {\n    const returnArray = []\n    for (const source of data) {\n      if (!value.some(v => comparer(source, v))) {\n        returnArray.push(source);\n      }\n    }\n    return returnArray;\n  } else {\n    return data.filter((v) => !comparer(v, value));\n  }\n}\n\nexport const withoutUndefined = <V>(data: ReadonlyArray<V> | Array<V>): Array<V> => {\n  return data.filter(v => v !== undefined);\n}\n/**\n * Returns all items in `data` for as long as `predicate` returns true.\n *\n * `predicate` returns an array of `[stop:boolean, acc:A]`. The first value\n * is _true_ when the iteration should stop, and the `acc` is the accumulated value.\n * This allows `until` to be used to carry over some state from item to item.\n *\n * @example Stop when we hit an item with value of 3\n * ```js\n * const v = Arrays.until([1,2,3,4,5], v => [v === 3, 0]);\n * // [ 1, 2 ]\n * ```\n *\n * @example Stop when we reach a total\n * ```js\n * // Stop when accumulated value reaches 6\n * const v = Arrays.until[1,2,3,4,5], (v, acc) => [acc >= 7, v+acc], 0);\n * // [1, 2, 3]\n * ```\n * @param data\n * @param predicate\n * @returns\n */\nexport const until = <V, A>(\n  //eslint-disable-next-line functional/prefer-readonly-type\n  data: ReadonlyArray<V> | Array<V>,\n  predicate: (v: V, accumulator: A) => readonly [ stop: boolean, acc: A ],\n  initial: A\n): Array<V> => {\n  const returnValue = [];\n  //eslint-disable-next-line functional/no-let\n  let total = initial;\n  //eslint-disable-next-line functional/no-let\n  for (const datum of data) {\n    const [ stop, accumulator ] = predicate(datum, total);\n    if (stop) break;\n\n    total = accumulator;\n\n    //eslint-disable-next-line functional/immutable-data\n    returnValue.push(datum);\n  }\n  return returnValue;\n};\n\n/**\n * Removes an element at `index` index from `data`, returning the resulting array without modifying the original.\n *\n * ```js\n * import { remove } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * const v = [ 100, 20, 50 ];\n * const vv = remove(2);\n *\n * Yields:\n *  v: [ 100, 20, 50 ]\n * vv: [ 100, 20 ]\n * ```\n *\n * Consider {@link without} if you want to remove an item by value.\n *\n * Throws an exception if `index` is outside the range of `data` array.\n * @param data Input array\n * @param index Index to remove\n * @typeParam V Type of array\n * @returns\n */\nexport const remove = <V>(\n  //eslint-disable-next-line functional/prefer-readonly-type\n  data: ReadonlyArray<V> | Array<V>,\n  index: number\n): Array<V> => {\n  // ✔️ Unit tested\n  if (!Array.isArray(data)) {\n    throw new TypeError(`'data' parameter should be an array`);\n  }\n  guardIndex(data, index, `index`);\n  return [ ...data.slice(0, index), ...data.slice(index + 1) ];\n};\n\n/**\n * Groups data by a function `grouper`, returning data as a map with string\n * keys and array values. Multiple values can be assigned to the same group.\n *\n * `grouper` must yield a string designated group for a given item.\n *\n * @example\n * ```js\n * import { groupBy } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * const data = [\n *  { age: 39, city: `London` }\n *  { age: 14, city: `Copenhagen` }\n *  { age: 23, city: `Stockholm` }\n *  { age: 56, city: `London` }\n * ];\n *\n * // Whatever the function returns will be the designated group\n * // for an item\n * const map = groupBy(data, item => data.city);\n * ```\n *\n * This yields a Map with keys London, Stockholm and Copenhagen, and the corresponding values.\n *\n * ```\n * London: [{ age: 39, city: `London` }, { age: 56, city: `London` }]\n * Stockhom: [{ age: 23, city: `Stockholm` }]\n * Copenhagen: [{ age: 14, city: `Copenhagen` }]\n * ```\n * @param array Array to group\n * @param grouper Function that returns a key for a given item\n * @typeParam K Type of key to group by. Typically string.\n * @typeParam V Type of values\n * @returns Map\n */\nexport const groupBy = <K, V>(\n  //eslint-disable-next-line functional/prefer-readonly-type\n  array: Iterable<V>,\n  grouper: (item: V) => K\n) => {\n  const map = new Map<K, Array<V>>();\n\n  for (const a of array) {\n    const key = grouper(a);\n    //eslint-disable-next-line functional/no-let\n    let existing = map.get(key);\n    if (!existing) {\n      existing = [];\n      map.set(key, existing);\n    }\n    //eslint-disable-next-line functional/immutable-data\n    existing.push(a);\n  }\n  return map;\n};\n\n/**\n * Samples array\n *\n * @example By percentage - get half of the items\n * ```\n * import { sample } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * const list = [1,2,3,4,5,6,7,8,9,10];\n * const sub = sample(list, 0.5);\n * // Yields: [2, 4, 6, 8, 10]\n * ```\n *\n * @example By steps - every third\n * ```\n * import { sample } from 'https://unpkg.com/ixfx/dist/arrays.js';\n *\n * const list = [1,2,3,4,5,6,7,8,9,10];\n * const sub = sample(list, 3);\n * // Yields:\n * // [3, 6, 9]\n * ```\n * @param array Array to sample\n * @param amount Amount, given as a percentage (0..1) or the number of interval (ie 3 for every third item)\n * @returns\n */\nexport const sample = <V>(array: ArrayLike<V>, amount: number): Array<V> => {\n  //eslint-disable-next-line functional/no-let\n  let subsampleSteps = 1;\n  if (amount <= 1) {\n    // Subsample based on a percentage\n    const numberOfItems = array.length * amount;\n    subsampleSteps = Math.round(array.length / numberOfItems);\n  } else {\n    subsampleSteps = amount;\n  }\n\n  throwIntegerTest(subsampleSteps, `positive`, `amount`);\n  if (subsampleSteps > array.length - 1) {\n    throw new Error(`Subsample steps exceeds array length`);\n  }\n  const r: Array<V> = [];\n\n  //eslint-disable-next-line functional/no-let\n  for (let index = subsampleSteps - 1; index < array.length; index += subsampleSteps) {\n    //eslint-disable-next-line functional/immutable-data\n    r.push(array[ index ]);\n  }\n  return r;\n};\n\n/**\n * Return `arr` broken up into chunks of `size`\n *\n * ```js\n * chunks([1,2,3,4,5,6,7,8,9,10], 3);\n * // Yields: [[1, 2, 3], [4, 5, 6], [7, 8, 9], [10]]\n * ```\n * @param arr\n * @param size\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function chunks<V>(\n  array: ReadonlyArray<V>,\n  size: number\n) {\n  // https://surma.github.io/underdash/\n  const output = [];\n  //eslint-disable-next-line  functional/no-let\n  for (let index = 0; index < array.length; index += size) {\n    //eslint-disable-next-line functional/immutable-data\n    output.push(array.slice(index, index + size));\n  }\n  return output;\n}\n\n/**\n * Returns a result of a merged into b.\n * B is always the 'newer' data that takes\n * precedence.\n */\nexport type MergeReconcile<V> = (a: V, b: V) => V;\n\n/**\n * Merges arrays left to right, using the provided\n * `reconcile` function to choose a winner when keys overlap.\n *\n * There's also [Maps.mergeByKey](functions/Collections.Maps.mergeByKey.html) if the input data is in Map form.\n *\n * For example, if we have the array A:\n * [`A-1`, `A-2`, `A-3`]\n *\n * And array B:\n * [`B-1`, `B-2`, `B-4`]\n *\n * And with the key function:\n * ```js\n * // Make a key for value based on last char\n * const keyFn = (v) => v.substr(-1, 1);\n * ```\n *\n * If they are merged with the reconile function:\n * ```js\n * const reconcile = (a, b) => b.replace(`-`, `!`);\n * const output = mergeByKey(keyFn, reconcile, arrayA, arrayB);\n * ```\n *\n * The final result will be:\n *\n * [`B!1`, `B!2`, `A-3`, `B-4`]\n *\n * In this toy example, it's obvious how the reconciler transforms\n * data where the keys overlap. For the keys that do not overlap -\n * 3 and 4 in this example - they are copied unaltered.\n *\n * A practical use for `mergeByKey` has been in smoothing keypoints\n * from a TensorFlow pose. In this case, we want to smooth new keypoints\n * with older keypoints. But if a keypoint is not present, for it to be\n * passed through.\n *\n * @param keyFn Function to generate a unique key for data\n * @param reconcile Returns value to decide 'winner' when keys conflict.\n * @param arrays Arrays of data to merge\n */\nexport const mergeByKey = <V>(\n  keyFunction: ToString<V>,\n  reconcile: MergeReconcile<V>,\n  ...arrays: ReadonlyArray<ReadonlyArray<V>>\n): Array<V> => {\n  const result = new Map<string, V>();\n  for (const m of arrays) {\n    for (const mv of m) {\n      if (mv === undefined) continue;\n      const mk = keyFunction(mv);\n      //eslint-disable-next-line functional/no-let\n      let v = result.get(mk);\n      v = v ? reconcile(v, mv) : mv;\n      result.set(mk, v);\n    }\n  }\n  return [ ...result.values() ];\n};\n\n/**\n * Reduces in a pairwise fashion.\n *\n * Eg, if we have input array of [1, 2, 3, 4, 5], the\n * `reducer` fn will run with 1,2 as parameters, then 2,3, then 3,4 etc.\n * ```js\n * const values = [1, 2, 3, 4, 5]\n * reducePairwise(values, (acc, a, b) => {\n *  return acc + (b - a);\n * }, 0);\n * ```\n *\n * If input array has less than two elements, the initial value is returned.\n *\n * ```js\n * const reducer = (acc:string, a:string, b:string) => acc + `[${a}-${b}]`;\n * const result = reducePairwise(`a b c d e f g`.split(` `), reducer, `!`);\n * Yields: `![a-b][b-c][c-d][d-e][e-f][f-g]`\n * ```\n * @param arr\n * @param reducer\n * @param initial\n * @returns\n */\nexport const reducePairwise = <V, X>(\n  array: ReadonlyArray<V>,\n  reducer: (accumulator: X, a: V, b: V) => X,\n  initial: X\n) => {\n  guardArray(array, `arr`);\n  if (array.length < 2) return initial;\n  //eslint-disable-next-line functional/no-let\n  for (let index = 0; index < array.length - 1; index++) {\n    initial = reducer(initial, array[ index ], array[ index + 1 ]);\n  }\n  return initial;\n};\n\n/**\n * Returns two separate arrays of everything that `filter` returns _true_,\n * and everything it returns _false_ on. The in-built Array.filter() in\n * constrast only returns things that `filter` returns _true_ for.\n *\n * ```js\n * const [ matching, nonMatching ] = filterAB(data, v => v.enabled);\n * // `matching` is a list of items from `data` where .enabled is true\n * // `nonMatching` is a list of items from `data` where .enabled is false\n * ```\n * @param data Array of data to filter\n * @param filter Function which returns _true_ to add items to the A list, or _false_ for items to add to the B list\n * @returns Array of two elements. The first is items that match `filter`, the second is items that do not.\n */\nexport const filterAB = <V>(\n  data: ReadonlyArray<V>,\n  filter: (a: V) => boolean\n): [ a: Array<V>, b: Array<V> ] => {\n  const a: Array<V> = [];\n  const b: Array<V> = [];\n  for (const datum of data) {\n    //eslint-disable-next-line functional/immutable-data\n    if (filter(datum)) a.push(datum);\n    //eslint-disable-next-line functional/immutable-data\n    else b.push(datum);\n  }\n  return [ a, b ];\n};\n\n/**\n * Combines the values of one or more arrays, removing duplicates\n * ```js\n * const v = Arrays.unique([ [1, 2, 3, 4], [ 3, 4, 5, 6] ]);\n * // [ 1, 2, 3, 4, 5, 6]\n * ```\n *\n * A single array can be provided as well:\n * ```js\n * const v = Arrays.unique([ 1, 2, 3, 1, 2, 3 ]);\n * // [ 1, 2, 3 ]\n * ```\n * See also:\n * * {@link intersection}: Overlap between two arrays\n * * {@link additionalValues}: Yield values from an iterable not present in the other\n * @param arrays\n * @param comparer\n * @returns\n */\nexport const unique = <V>(\n  arrays:\n    | Array<Array<V>>\n    | Array<V>\n    | ReadonlyArray<V>\n    | ReadonlyArray<ReadonlyArray<V>>,\n  comparer = isEqualDefault<V>\n): ReadonlyArray<V> => {\n  const t: Array<V> = [];\n  for (const a of arrays) {\n    if (Array.isArray(a)) {\n      for (const v of additionalValues<V>(t, a, comparer)) {\n        t.push(v);\n      }\n    } else {\n      return [ ...additionalValues<V>([], arrays as Array<V>, comparer) ];\n    }\n  }\n  return t;\n};\n\n/**\n * Returns _true_ if array contains duplicate values.\n *\n * ```js\n *\n * containsDuplicateValues(['a','b','a']); // True\n * containsDuplicateValues([\n *  { name: 'Apple' },\n *  { name: 'Apple' }\n * ]); // True\n * ```\n * @param array\n * @param comparer\n * @returns\n */\nexport const containsDuplicateValues = <V>(\n  //eslint-disable-next-line functional/prefer-readonly-type\n  array: Array<V> | ReadonlyArray<V>,\n  keyFunction = toStringDefault<V>\n): boolean => {\n  if (!Array.isArray(array)) throw new Error(`Parameter needs to be an array`);\n  try {\n    const _ = mapFromIterable(array, keyFunction);\n  } catch {\n    return true;\n  }\n  return false;\n};\n\n/**\n * Returns _true_ if contents of `needles` is contained by `haystack`.\n * ```js\n * const a = ['apples','oranges','pears','mandarins'];\n * const b = ['pears', 'apples'];\n * contains(a, b); // True\n *\n * const c = ['pears', 'bananas'];\n * contains(a, b); // False ('bananas' does not exist in a)\n * ```\n * @param haystack\n * @param needles\n * @param eq\n */\nexport const contains = <V>(\n  haystack: ArrayLike<V>,\n  needles: ArrayLike<V>,\n  eq = isEqualDefault<V>\n) => {\n  if (!Array.isArray(haystack)) {\n    throw new TypeError(`Expects haystack parameter to be an array`);\n  }\n  if (!Array.isArray(needles)) {\n    throw new TypeError(`Expects needles parameter to be an array`);\n  }\n\n  for (const needle of needles) {\n    //eslint-disable-next-line functional/no-let\n    let found = false;\n    for (const element of haystack) {\n      if (eq(needle, element)) {\n        found = true;\n        break;\n      }\n    }\n    if (!found) {\n      return false;\n    }\n  }\n  return true;\n};\n\n/**\n * Yield values from an iterable not present in the other.\n *\n * Assuming that `input` array is unique values, this function\n * yields items from `values` which are not present in `input`.\n *\n * Duplicate items in `values` are ignored - only the first is yielded.\n *\n * If `eq` function is not provided, values are compared using the\n * default === semantics (via {@link isEqualDefault})\n *\n * ```js\n * const existing = [ 1, 2, 3 ];\n * const newValues = [ 3, 4, 5];\n * const v = [...additionalValues(existing, newValues)];\n * // [ 1, 2, 3, 4, 5]\n * ```\n *\n * ```js\n * const existing = [ 1, 2, 3 ];\n * const newValues = [ 3, 4, 5 ];\n * for (const v of additionalValues(existing, newValues)) {\n *  // 4, 5\n * }\n * To combine one or more iterables, keeping only unique items, use {@link unique}\n * @param input\n * @param values\n */\nexport function* additionalValues<V>(\n  //eslint-disable-next-line functional/prefer-readonly-type\n  input: Array<V>,\n  //eslint-disable-next-line functional/prefer-readonly-type\n  values: Iterable<V>,\n  eq: IsEqual<V> = isEqualDefault\n): Iterable<V> {\n  // Keep track of values already yielded\n  const yielded: Array<V> = [];\n  for (const v of values) {\n    const found = input.find((index) => eq(index, v));\n    if (!found) {\n      const alreadyYielded = yielded.find((ii) => eq(ii, v));\n      if (!alreadyYielded) {\n        //eslint-disable-next-line functional/immutable-data\n        yielded.push(v);\n        yield v;\n      }\n    }\n  }\n}\n","import { isEqualDefault, type IsEqual } from '../../IsEqual.js';\nimport {\n  toStringDefault,\n  defaultComparer,\n  type ToString,\n} from '../../Util.js';\nimport type { IWithEntries } from './IMappish.js';\n\n// ✔ UNIT TESTED!\n/**\n * Gets the closest integer key to `target` in `data`.\n * * Requires map to have numbers as keys, not strings\n * * Math.round is used for rounding `target`.\n *\n * Examples:\n * ```js\n * // Assuming numeric keys 1, 2, 3, 4 exist:\n * getClosestIntegerKey(map, 3);    // 3\n * getClosestIntegerKey(map, 3.1);  // 3\n * getClosestIntegerKey(map, 3.5);  // 4\n * getClosestIntegerKey(map, 3.6);  // 4\n * getClosestIntegerKey(map, 100);  // 4\n * getClosestIntegerKey(map, -100); // 1\n * ```\n * @param data Map\n * @param target Target value\n * @returns\n */\nexport const getClosestIntegerKey = (\n  data: ReadonlyMap<number, any>,\n  target: number\n): number => {\n  target = Math.round(target);\n  if (data.has(target)) {\n    return target;\n  } else {\n    //eslint-disable-next-line functional/no-let\n    let offset = 1;\n    while (offset < 1000) {\n      if (data.has(target - offset)) return target - offset;\n      else if (data.has(target + offset)) return target + offset;\n      offset++;\n    }\n    throw new Error(`Could not find target ${ target }`);\n  }\n};\n\n/**\n * Returns true if map contains `value` under `key`, using `comparer` function. Use {@link hasAnyValue} if you don't care\n * what key value might be under.\n *\n * Having a comparer function is useful to check by value rather than object reference.\n *\n * @example Find key value based on string equality\n * ```js\n * hasKeyValue(map,`hello`, `samantha`, (a, b) => a === b);\n * ```\n * @param map Map to search\n * @param key Key to search\n * @param value Value to search\n * @param comparer Function to determine match\n * @returns True if key is found\n */\nexport const hasKeyValue = <K, V>(\n  map: ReadonlyMap<K, V>,\n  key: K,\n  value: V,\n  comparer: IsEqual<V>\n): boolean => {\n  if (!map.has(key)) return false;\n  const values = [ ...map.values() ];\n  return values.some((v) => comparer(v, value));\n};\n\n/**\n * Deletes all key/values from map where value matches `value`,\n * with optional comparer. Mutates map.\n *\n * ```js\n * import { Maps } from \"https://unpkg.com/ixfx/dist/collections.js\"\n *\n * // Compare fruits based on their colour property\n * const colourComparer = (a, b) => a.colour === b.colour;\n *\n * // Deletes all values where .colour = `red`\n * Maps.deleteByValue(map, { colour: `red` }, colourComparer);\n * ```\n * @param map\n * @param value\n * @param comparer\n */\nexport const deleteByValue = <K, V>(\n  map: ReadonlyMap<K, V>,\n  value: V,\n  comparer: IsEqual<V> = isEqualDefault\n) => {\n  for (const entry of Object.entries(map)) {\n    if (comparer(entry[ 1 ], value)) {\n      (map as any).delete(entry[ 0 ]);\n    }\n  }\n};\n\n\n\n/**\n * Finds first entry by iterable value. Expects a map with an iterable as values.\n *\n * ```js\n * const map = new Map();\n * map.set('hello', 'a');\n * map.set('there', 'b');\n *\n * const entry = firstEntryByIterablePredicate(map, (value, key) => {\n *  return (value === 'b');\n * });\n * // Entry is: ['there', 'b']\n * ```\n *\n * An alternative is {@link firstEntryByIterableValue} to search by value.\n * @param map Map to search\n * @param predicate Filter function returns true when there is a match of value\n * @returns Entry, or _undefined_ if `filter` function never returns _true_\n */\nexport const firstEntryByIterablePredicate = <K, V>(\n  map: IWithEntries<K, V>,\n  predicate: (value: V, key: K) => boolean\n): readonly [ key: K, value: V ] | undefined => {\n  for (const e of map.entries()) {\n    if (predicate(e[ 1 ], e[ 0 ])) return e;\n  }\n};\n\n/**\n * Finds first entry by iterable value.\n *\n * ```js\n * const map = new Map();\n * map.set('hello', 'a');\n * map.set('there', 'b');\n *\n * const entry = firstEntryByIterableValue(map, 'b');\n * // Entry is: ['there', 'b']\n * ```\n *\n * An alternative is {@link firstEntryByIterablePredicate} to search by predicate function.\n * @param map Map to search\n * @param value Value to seek\n * @param isEqual Filter function which checks equality. Uses JS comparer by default.\n * @returns Entry, or _undefined_ if `value` not found.\n */\nexport const firstEntryByIterableValue = <K, V>(\n  map: IWithEntries<K, V>,\n  value: V,\n  isEqual: IsEqual<V> = isEqualDefault\n): readonly [ key: K, value: V ] | undefined => {\n  for (const entry of map.entries()) {\n    if (isEqual(entry[ 1 ], value)) return entry;\n  }\n};\n\n\n\n/**\n * Adds items to a map only if their key doesn't already exist\n *\n * Uses provided {@link Util.ToString} function to create keys for items. Item is only added if it doesn't already exist.\n * Thus the older item wins out, versus normal `Map.set` where the newest wins.\n *\n *\n * @example\n * ```js\n * import { Maps } from \"https://unpkg.com/ixfx/dist/collections.js\";\n * const map = new Map();\n * const peopleArray = [ _some people objects..._];\n * Maps.addKeepingExisting(map, p => p.name, ...peopleArray);\n * ```\n * @param set\n * @param hasher\n * @param values\n * @returns\n */\nexport const addKeepingExisting = <V>(\n  set: ReadonlyMap<string, V> | undefined,\n  hasher: ToString<V>,\n  ...values: readonly V[]\n) => {\n  const s = set === undefined ? new Map() : new Map(set);\n  for (const v of values) {\n    const hashResult = hasher(v);\n    if (s.has(hashResult)) continue;\n    s.set(hashResult, v);\n  }\n  return s;\n};\n\n/**\n * Returns a array of entries from a map, sorted by value.\n *\n * ```js\n * const m = new Map();\n * m.set(`4491`, { name: `Bob` });\n * m.set(`2319`, { name: `Alice` });\n *\n * // Compare by name\n * const comparer = (a, b) => defaultComparer(a.name, b.name);\n *\n * // Get sorted values\n * const sorted = Maps.sortByValue(m, comparer);\n * ```\n *\n * `sortByValue` takes a comparison function that should return -1, 0 or 1 to indicate order of `a` to `b`. If not provided, {@link Util.defaultComparer} is used.\n * @param map\n * @param comparer\n * @returns\n */\nexport const sortByValue = <K, V>(\n  map: ReadonlyMap<K, V>,\n  comparer?: (a: V, b: V) => number\n) => {\n  const f = comparer ?? defaultComparer;\n  [ ...map.entries() ].sort((a, b) => f(a[ 1 ], b[ 1 ]));\n};\n\n/**\n * Returns an array of entries from a map, sorted by a property of the value\n *\n * ```js\n * cosnt m = new Map();\n * m.set(`4491`, { name: `Bob` });\n * m.set(`2319`, { name: `Alice` });\n * const sorted = Maps.sortByValue(m, `name`);\n * ```\n * @param map Map to sort\n * @param prop Property of value\n * @param compareFn Comparer. If unspecified, uses a default.\n */\nexport const sortByValueProperty = <K, V, Z>(\n  map: ReadonlyMap<K, V>,\n  prop: string,\n  compareFn?: (a: Z, b: Z) => number\n) => {\n  const cfn = typeof compareFn === `undefined` ? defaultComparer : compareFn;\n  return [ ...map.entries() ].sort((aE, bE) => {\n    const a = aE[ 1 ];\n    const b = bE[ 1 ];\n    // @ts-ignore\n    return cfn(a[ prop ], b[ prop ]);\n  });\n};\n/**\n * Returns _true_ if any key contains `value`, based on the provided `comparer` function. Use {@link hasKeyValue}\n * if you only want to find a value under a certain key.\n *\n * Having a comparer function is useful to check by value rather than object reference.\n * @example Finds value where name is 'samantha', regardless of other properties\n * ```js\n * hasAnyValue(map, {name:`samantha`}, (a, b) => a.name === b.name);\n * ```\n *\n * Works by comparing `value` against all values contained in `map` for equality using the provided `comparer`.\n *\n * @param map Map to search\n * @param value Value to find\n * @param comparer Function that determines matching. Should return true if `a` and `b` are considered equal.\n * @returns True if value is found\n */\nexport const hasAnyValue = <K, V>(\n  map: ReadonlyMap<K, V>,\n  value: V,\n  comparer: IsEqual<V>\n): boolean => {\n  const entries = Array.from(map.entries());\n  return entries.some((kv) => comparer(kv[ 1 ], value));\n};\n\n/**\n * Returns values where `predicate` returns true.\n *\n * If you just want the first match, use `find`\n *\n * @example All people over thirty\n * ```js\n * // for-of loop\n * for (const v of filter(people, person => person.age > 30)) {\n *\n * }\n * // If you want an array\n * const overThirty = Array.from(filter(people, person => person.age > 30));\n * ```\n * @param map Map\n * @param predicate Filtering predicate\n * @returns Values that match predicate\n */\n//eslint-disable-next-line func-style\nexport function* filter<V>(\n  map: ReadonlyMap<string, V>,\n  predicate: (v: V) => boolean\n) {\n  for (const v of map.values()) {\n    if (predicate(v)) yield v;\n  }\n}\n\n//export const filter = <V>(map:ReadonlyMap<string, V>, predicate:(v:V) => boolean):ReadonlyArray<V> => Array.from(map.values()).filter(predicate);\n\n/**\n * Copies data to an array\n * @param map\n * @returns\n */\nexport const toArray = <V>(map: ReadonlyMap<string, V>): ReadonlyArray<V> =>\n  Array.from(map.values());\n\n\n/**\n * Returns a Map from an iterable. By default throws an exception\n * if iterable contains duplicate values.\n *\n * ```js\n * const data = [\n *  { fruit: `granny-smith`, family: `apple`, colour: `green` }\n *  { fruit: `mango`, family: `stone-fruit`, colour: `orange` }\n * ];\n * const map = Maps.fromIterable(data, v => v.fruit);\n * ```\n * @param data Input data\n * @param keyFn Function which returns a string id. By default uses the JSON value of the object.\n * @param allowOverwrites When set to _true_, items with same id will silently overwrite each other, with last write wins. _false_ by default.\n * @returns\n */\nexport const fromIterable = <V>(\n  data: Iterable<V>,\n  keyFn = toStringDefault<V>,\n  allowOverwrites = false\n): ReadonlyMap<string, V> => {\n  const m = new Map<string, V>();\n  for (const d of data) {\n    const id = keyFn(d);\n    if (m.has(id) && !allowOverwrites) {\n      throw new Error(\n        `id ${ id } is already used and new data will overwrite it. `\n      );\n    }\n    m.set(id, d);\n  }\n  return m;\n};\n\n/**\n * Returns a Map from an object, or array of objects.\n * Assumes the top-level properties of the object is the key.\n *\n * ```js\n * const data = {\n *  Sally: { name: `Sally`, colour: `red` },\n *  Bob: { name: `Bob`, colour: `pink` }\n * };\n * const map = Maps.fromObject(data);\n * map.get(`Sally`); // { name: `Sally`, colour: `red` }\n * ```\n *\n * To add an object to an existing map, use {@link addObject}.\n * @param data\n * @returns\n */\n//eslint-disable-next-line @typescript-eslint/no-explicit-any,functional/prefer-readonly-type\nexport const fromObject = <V>(data: any): ReadonlyMap<string, V> => {\n  //eslint-disable-next-line @typescript-eslint/no-explicit-any,functional/prefer-readonly-type\n  const map = new Map<string, V>();\n  if (Array.isArray(data)) {\n    data.forEach((d) => addObject<V>(map, d));\n  } else {\n    addObject<V>(map, data);\n  }\n  return map;\n};\n\n/**\n * Adds an object to an existing map. It assumes a structure where\n * each top-level property is a key:\n *\n * ```js\n * const data = {\n *  Sally: { name: `Sally`, colour: `red` },\n *  Bob: { name: `Bob`, colour: `pink` }\n * };\n * const map = new Map();\n * Maps.addObject(map, data);\n *\n * map.get(`Sally`); // { name: `Sally`, colour: `red` }\n * ```\n *\n * To create a new map from an object, use {@link fromObject} instead.\n * @param map\n * @param data\n */\n//eslint-disable-next-line @typescript-eslint/no-explicit-any,functional/prefer-readonly-type\nexport const addObject = <V>(map: Map<string, V>, data: any) => {\n  const entries = Object.entries(data);\n  for (const [ key, value ] of entries) {\n    map.set(key, value as V);\n  }\n};\n/**\n * Returns the first found item that matches `predicate` or _undefined_.\n *\n * If you want all matches, use {@link filter}.\n *\n * @example First person over thirty\n * ```js\n * const overThirty = find(people, person => person.age > 30);\n * ```\n * @param map Map to search\n * @param predicate Function that returns true for a matching item\n * @returns Found item or _undefined_\n */\nexport const find = <V>(\n  map: ReadonlyMap<string, V>,\n  predicate: (v: V) => boolean\n): V | undefined => Array.from(map.values()).find(predicate);\n\n/**\n * Converts a map to a simple object, transforming from type `T` to `K` as it does so. If no transforms are needed, use {@link toObject}.\n *\n * ```js\n * const map = new Map();\n * map.set(`name`, `Alice`);\n * map.set(`pet`, `dog`);\n *\n * const o = mapToObjTransform(map, v => {\n *  ...v,\n *  registered: true\n * });\n *\n * // Yields: { name: `Alice`, pet: `dog`, registered: true }\n * ```\n *\n * If the goal is to create a new map with transformed values, use {@link transformMap}.\n * @param m\n * @param valueTransform\n * @typeParam T Value type of input map\n * @typeParam K Value type of destination map\n * @returns\n */\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const mapToObjTransform = <T, K>(\n  m: ReadonlyMap<string, T>,\n  valueTransform: (value: T) => K\n): { readonly [ key: string ]: K } =>\n  Array.from(m).reduce((obj: any, [ key, value ]) => {\n    const t = valueTransform(value);\n    /* eslint-disable-next-line functional/immutable-data */\n    obj[ key ] = t;\n    return obj;\n  }, {});\n\n/**\n * Zips together an array of keys and values into an object. Requires that\n * `keys` and `values` are the same length.\n *\n * @example\n * ```js\n * const o = zipKeyValue([`a`, `b`, `c`], [0, 1, 2])\n * Yields: { a: 0, b: 1, c: 2}\n *```\n * @param keys String keys\n * @param values Values\n * @typeParam V Type of values\n * @return Object with keys and values\n */\nexport const zipKeyValue = <V>(\n  keys: ReadonlyArray<string>,\n  values: ArrayLike<V | undefined>\n) => {\n  if (keys.length !== values.length) {\n    throw new Error(`Keys and values arrays should be same length`);\n  }\n  return Object.fromEntries(keys.map((k, i) => [ k, values[ i ] ]));\n};\n\n//#region Functions by Kees C. Bakker\n// Functions by Kees C. Bakker\n// https://keestalkstech.com/2021/10/having-fun-grouping-arrays-into-maps-with-typescript/\n\n/**\n * Like `Array.map`, but for a Map. Transforms from Map<K,V> to Map<K,R>, returning as a new Map.\n *\n * @example\n * ```js\n * const mapOfStrings = new Map();\n * mapOfStrings.set(`a`, `10`);\n * mapOfStrings.get(`a`); // Yields `10` (a string)\n *\n * // Convert a map of string->string to string->number\n * const mapOfInts = transformMap(mapOfStrings, (value, key) => parseInt(value));\n *\n * mapOfInts.get(`a`); // Yields 10 (a proper number)\n * ```\n *\n * If you want to combine values into a single object, consider instead  {@link mapToObjTransform}.\n * @param source\n * @param transformer\n * @typeParam K Type of keys (generally a string)\n * @typeParam V Type of input map values\n * @typeParam R Type of output map values\n * @returns\n */\nexport const transformMap = <K, V, R>(\n  source: ReadonlyMap<K, V>,\n  transformer: (value: V, key: K) => R\n) => new Map(Array.from(source, (v) => [ v[ 0 ], transformer(v[ 1 ], v[ 0 ]) ]));\n\n/**\n * Converts a `Map` to a plain object, useful for serializing to JSON.\n * To convert back to a map use {@link fromObject}.\n *\n * @example\n * ```js\n * const map = new Map();\n * map.set(`Sally`, { name: `Sally`, colour: `red` });\n * map.set(`Bob`, { name: `Bob`, colour: `pink });\n *\n * const objects = Maps.toObject(map);\n * // Yields: {\n * //  Sally: { name: `Sally`, colour: `red` },\n * //  Bob: { name: `Bob`, colour: `pink` }\n * // }\n * ```\n * @param m\n * @returns\n */\n/* eslint-disable-next-line @typescript-eslint/no-explicit-any */\nexport const toObject = <T>(\n  m: ReadonlyMap<string, T>\n): { readonly [ key: string ]: T } =>\n  Array.from(m).reduce((obj: any, [ key, value ]) => {\n    /* eslint-disable-next-line functional/immutable-data */\n    obj[ key ] = value;\n    return obj;\n  }, {});\n\n/**\n * Converts Map to Array with a provided `transformer` function. Useful for plucking out certain properties\n * from contained values and for creating a new map based on transformed values from an input map.\n *\n * @example Get an array of ages from a map of Person objects\n * ```js\n * let person = { age: 29, name: `John`};\n * map.add(person.name, person);\n *\n * const ages = mapToArray(map, (key, person) => person.age);\n * // [29, ...]\n * ```\n *\n * In the above example, the `transformer` function returns a number, but it could\n * just as well return a transformed version of the input:\n *\n * ```js\n * // Return with random heights and uppercased name\n * mapToArray(map, (key, person) => ({\n *  ...person,\n *  height: Math.random(),\n *  name: person.name.toUpperCase();\n * }))\n * // Yields:\n * // [{height: 0.12, age: 29, name: \"JOHN\"}, ...]\n * ```\n * @param m\n * @param transformer A function that takes a key and item, returning a new item.\n * @returns\n */\nexport const mapToArray = <K, V, R>(\n  m: ReadonlyMap<K, V>,\n  transformer: (key: K, item: V) => R\n): readonly R[] => Array.from(m.entries()).map((x) => transformer(x[ 0 ], x[ 1 ]));\n// End Functions by Kees C. Bakker\n//#endregion\n\n/**\n * Returns a result of a merged into b.\n * B is always the 'newer' data that takes\n * precedence.\n */\nexport type MergeReconcile<V> = (a: V, b: V) => V;\n\n/**\n * Merges maps left to right, using the provided\n * `reconcile` function to choose a winner when keys overlap.\n *\n * There's also [Arrays.mergeByKey](functions/Collections.Arrays.mergeByKey.html) if you don't already have a map.\n *\n * For example, if we have the map A:\n * 1 => `A-1`, 2 => `A-2`, 3 => `A-3`\n *\n * And map B:\n * 2 => `B-1`, 2 => `B-2`, 4 => `B-4`\n *\n * If they are merged with the reconile function:\n * ```js\n * const reconcile = (a, b) => b.replace(`-`, `!`);\n * const output = mergeByKey(reconcile, mapA, mapB);\n * ```\n *\n * The final result will be:\n *\n * 1 => `B!1`, 2 => `B!2`, 3 => `A-3`, 4 => `B-4`\n *\n * In this toy example, it's obvious how the reconciler transforms\n * data where the keys overlap. For the keys that do not overlap -\n * 3 and 4 in this example - they are copied unaltered.\n *\n * A practical use for `mergeByKey` has been in smoothing keypoints\n * from a TensorFlow pose. In this case, we want to smooth new keypoints\n * with older keypoints. But if a keypoint is not present, for it to be\n * passed through.\n *\n * @param reconcile\n * @param maps\n */\nexport const mergeByKey = <K, V>(\n  reconcile: MergeReconcile<V>,\n  ...maps: readonly ReadonlyMap<K, V>[]\n): ReadonlyMap<K, V> => {\n  const result = new Map<K, V>();\n  for (const m of maps) {\n    for (const [ mk, mv ] of m) {\n      //eslint-disable-next-line functional/no-let\n      let v = result.get(mk);\n      if (v) {\n        v = reconcile(v, mv);\n      } else {\n        v = mv;\n      }\n      result.set(mk, v);\n    }\n  }\n  return result;\n};\n","// Easings from https://easings.net/\nimport { interpolate } from '../data/Interpolate.js';\nimport {\n  msElapsedTimer,\n  type HasCompletion,\n  relativeTimer,\n  ticksElapsedTimer,\n  type TimerSource,\n} from '../flow/index.js';\n\nconst sqrt = Math.sqrt;\nconst pow = Math.pow;\nconst cos = Math.cos;\n//eslint-disable-next-line @typescript-eslint/naming-convention\nconst pi = Math.PI;\nconst sin = Math.sin;\n/*\ntype RelativeTimer = {\n  reset(): void\n  elapsed(): number\n  isDone(): boolean\n}\n\ntype TimerSource = (upperBound: number) => RelativeTimer;\n\nconst msRelativeTimer = function (upperBound: number): RelativeTimer {\n  let start = performance.now();\n  return {\n    reset: () => {\n      start = performance.now();\n    },\n    elapsed: () => clamp((performance.now() - start) / upperBound),\n    isDone: () => (performance.now() - start) >= upperBound,\n  };\n};\n\nconst tickRelativeTimer = function (upperBound: number): RelativeTimer {\n  let start = 0;\n  return {\n    reset: () => {\n      start = 0;\n    },\n    elapsed: () => clamp(start++ / upperBound),\n    isDone: () => start >= upperBound,\n  };\n};\n*/\n\nexport type EasingFn = (x: number) => number;\n\n/**\n * Creates an easing based on clock time. Time\n * starts being counted when easing function is created.\n * @example Time based easing\n * ```\n * import { Easings } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * const t = Easings.time(`quintIn`, 5*1000); // Will take 5 seconds to complete\n * ...\n * t.compute(); // Get current value of easing\n * t.reset();   // Reset to 0\n * t.isDone;    // _True_ if finished\n * ```\n * @param nameOrFunction Name of easing, or an easing function\n * @param durationMs Duration in milliseconds\n * @returns Easing\n */\nexport const time = function (\n  nameOrFunction: EasingName | EasingFn,\n  durationMs: number\n): Easing {\n  return create(nameOrFunction, durationMs, msElapsedTimer);\n};\n\n/**\n * Creates an easing based on ticks\n *\n * @example Tick-based easing\n * ```\n * import { Easings } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * const t = Easings.tick(`sineIn`, 1000);   // Will take 1000 ticks to complete\n * t.compute(); // Each call to `compute` progresses the tick count\n * t.reset();   // Reset to 0\n * t.isDone;    // _True_ if finished\n * ```\n * @param nameOrFn Name of easing, or an easing function\n * @param durationTicks Duration in ticks\n * @returns Easing\n */\nexport const tick = function (\n  nameOrFunction: EasingName | EasingFn,\n  durationTicks: number\n): Easing {\n  return create(nameOrFunction, durationTicks, ticksElapsedTimer);\n};\n\n/**\n * 'Ease' from `0` to `1` over a delicious curve. Commonly used for animation\n * and basic modelling of phyical motion.\n *\n * Create via {@link tick} or {@link time}, call `compute` to calculate the next\n * value in the progression, until you reach `1` or `isDone` returns true.\n *\n */\nexport type Easing = HasCompletion & {\n  /**\n   * Computes the current value of the easing\n   *\n   * @returns {number}\n   */\n  compute(): number;\n\n  /**\n   * Reset the easing\n   */\n  reset(): void;\n  /**\n   * Returns true if the easing is complete\n   *\n   * @returns {boolean}\n   */\n  get isDone(): boolean;\n};\n\n/**\n * Creates a new easing by name\n *\n * ```js\n * import { Easings } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * const e = Easings.create(`circInOut`, 1000, msElapsedTimer);\n * ```\n * @param nameOrFn Name of easing, or an easing function\n * @param duration Duration (meaning depends on timer source)\n * @param timerSource Timer source. Eg {@link tickRelativeTimer}, {@link msRelativeTimer}\n * @returns\n */\nconst create = function (\n  nameOrFunction: EasingName | EasingFn,\n  duration: number,\n  timerSource: TimerSource\n): Easing {\n  //eslint-disable-next-line functional/no-let\n  const fn = typeof nameOrFunction === `function` ? nameOrFunction : get(nameOrFunction);\n  if (fn === undefined) {\n    const error = typeof nameOrFunction === `string` ? new Error(`Easing function not found: ${ nameOrFunction }`) : new Error(`Easing function not found`);\n    throw error;\n  }\n\n  // Get a relative version of timer\n  const timer = relativeTimer(duration, {\n    timer: timerSource(),\n    clampValue: true,\n  });\n\n  return {\n    get isDone() {\n      return timer.isDone;\n    },\n    compute: () => {\n      const relative = timer.elapsed;\n      //eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      return fn(relative);\n    },\n    reset: () => {\n      timer.reset();\n    },\n  };\n};\n\n/**\n * Creates an easing function using a simple cubic bezier defined by two points.\n *\n * Eg: https://cubic-bezier.com/#0,1.33,1,-1.25\n *  a:0, b: 1.33, c: 1, d: -1.25\n *\n * ```js\n * import { Easings } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * // Time-based easing using bezier\n * const e = Easings.time(fromCubicBezier(1.33, -1.25), 1000);\n * e.compute();\n * ```\n * @param b\n * @param d\n * @param t\n * @returns Value\n */\nexport const fromCubicBezier =\n  (b: number, d: number): EasingFn =>\n    (t: number) => {\n      const s = 1 - t;\n      const s2 = s * s;\n      const t2 = t * t;\n      const t3 = t2 * t;\n      return 3 * b * s2 * t + 3 * d * s * t2 + t3;\n    };\n\n/**\n * Returns a mix of two easing functions.\n *\n * ```js\n * import { Easings } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * // Get a 50/50 mix of two easing functions at t=0.25\n * Easings.mix(0.5, 0.25, Easings.functions.sineIn, Easings.functions.sineOut);\n *\n * // 10% of sineIn, 90% of sineOut\n * Easings.mix(0.90, 0.25, Easings.functions.sineIn, Easings.functions.sineOut);\n * ```\n * @param amt 'Progress' value passed to the easing functions\n * @param balance Mix between a and b\n * @param easingA\n * @param easingB\n * @returns Numeric value\n */\nexport const mix = (\n  amt: number,\n  balance: number,\n  easingA: EasingFn,\n  easingB: EasingFn\n) => interpolate(balance, easingA(amt), easingB(amt));\n\n/**\n * Returns a 'crossfade' of two easing functions, synchronised with the progress through the easing. That is:\n * * 0.0 will yield 100% of easingA at its `easing(0)` value.\n * * 0.2 will yield 80% of a, 20% of b, with both at their `easing(0.2)` values\n * * 0.5 will yield 50% of both functions both at their `easing(0.5)` values\n * * 0.8 will yield 20% of a, 80% of a, with both at their `easing(0.8)` values\n * * 1.0 will yield 100% of easingB at its `easing(1)` value.\n *\n * So easingB will only ever kick in at higher `amt` values and `easingA` will only be present in lower valus.\n *\n * ```js\n * import { Easings } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * Easings.crossFade(0.5, Easings.functions.sineIn, Easings.functions.sineOut);\n * ```\n * @param amt\n * @param easingA\n * @param easingB\n * @returns Numeric value\n */\nexport const crossfade = (amt: number, easingA: EasingFn, easingB: EasingFn) =>\n  mix(amt, amt, easingA, easingB);\n\n/**\n * Easing name\n */\nexport type EasingName = keyof typeof functions;\n\n/**\n * Returns an easing function by name, or _undefined_ if not found.\n * This is a manual way of working with easing functions. If you want to\n * ease over time or ticks, use `Flow.Timer.msElapsedTimer` or `Flow.Timer.ticksElapsedTimer`.\n *\n * ```js\n * const fn = Easings.get(`sineIn`);\n * // Returns 'eased' transformation of 0.5\n * fn(0.5);\n * ```\n *\n * This function is useful if trying to resolve an easing by string. If you\n * know in advance what easing to use, you could also access it via\n * `Easings.functions.NAME`, eg `Easings.functions.sineIn`.\n * @param easingName eg `sineIn`\n * @returns Easing function\n */\nexport const get = function (easingName: EasingName): EasingFn | undefined {\n  if (easingName === null) throw new Error(`easingName is null`);\n  if (easingName === undefined) throw new Error(`easingName is undefined`);\n  const name = easingName.toLocaleLowerCase();\n  const found = Object.entries(functions).find(\n    ([ k, _v ]) => k.toLocaleLowerCase() === name\n  );\n\n  if (found === undefined) return found;\n  return found[ 1 ];\n};\n\n/**\n * Iterate over available easings.\n * @private\n * @returns Returns list of available easing names\n */\nexport function* getEasings(): Iterable<string> {\n  yield* Object.keys(functions);\n};\n\n/**\n * Returns a roughly gaussian easing function\n * ```js\n * import { Easings } from \"https://unpkg.com/ixfx/dist/modulation.js\";\n * const fn = Easings.gaussian();\n * ```\n *\n * Try different positive and negative values for `stdDev` to pinch\n * or flatten the bell shape.\n * @param standardDeviation\n * @returns\n */\nexport const gaussian = (standardDeviation = 0.4): EasingFn => {\n  const a = 1 / sqrt(2 * pi);\n  const mean = 0.5;\n\n  return (t: number) => {\n    const f = a / standardDeviation;\n    // p:-8 pinched\n    //eslint-disable-next-line functional/no-let\n    let p = -2.5; // -1/1.25;\n    //eslint-disable-next-line functional/no-let\n    let c = (t - mean) / standardDeviation;\n    c *= c;\n    p *= c;\n    const v = f * pow(Math.E, p); // * (2/pi);//0.62;\n    if (v > 1) return 1;\n    if (v < 0) return 0;\n\n    //if (v >1) console.log(v);\n    //if (v < 0) console.log(v);\n    return v;\n  };\n};\n\nconst bounceOut = function (x: number): number {\n  const n1 = 7.5625;\n  const d1 = 2.75;\n\n  if (x < 1 / d1) {\n    return n1 * x * x;\n  } else if (x < 2 / d1) {\n    return n1 * (x -= 1.5 / d1) * x + 0.75;\n  } else if (x < 2.5 / d1) {\n    return n1 * (x -= 2.25 / d1) * x + 0.9375;\n  } else {\n    return n1 * (x -= 2.625 / d1) * x + 0.984_375;\n  }\n};\n\nconst quintIn = (x: number): number => x * x * x * x * x;\nconst quintOut = (x: number): number => 1 - pow(1 - x, 5);\nconst arch = (x: number): number => x * (1 - x) * 4;\n\n/**\n * Weighted average\n * \n * `slowDownFactor` \n * @param currentValue \n * @param targetValue \n * @param slowDownFactor \n * @returns \n */\nexport const weightedAverage = (currentValue: number, targetValue: number, slowDownFactor: number) => {\n  return ((currentValue * (slowDownFactor - 1)) + targetValue) / slowDownFactor\n}\n\nexport const functions = {\n  smoothstep: (x: number): number => x * x * (3 - 2 * x),\n  smootherstep: (x: number): number => (x * (x * 6 - 15) + 10) * x * x * x,\n  arch,\n  bell: gaussian(),\n  sineIn: (x: number): number => 1 - cos((x * pi) / 2),\n  sineOut: (x: number): number => sin((x * pi) / 2),\n  quadIn: (x: number): number => x * x,\n  quadOut: (x: number): number => 1 - (1 - x) * (1 - x),\n  sineInOut: (x: number): number => -(cos(pi * x) - 1) / 2,\n  quadInOut: (x: number): number =>\n    x < 0.5 ? 2 * x * x : 1 - pow(-2 * x + 2, 2) / 2,\n  cubicIn: (x: number): number => x * x * x,\n  cubicOut: (x: number): number => 1 - pow(1 - x, 3),\n  quartIn: (x: number): number => x * x * x * x,\n  quartOut: (x: number): number => 1 - pow(1 - x, 4),\n  quintIn,\n  quintOut, //: (x: number): number => 1 - pow(1 - x, 5),\n  expoIn: (x: number): number => (x === 0 ? 0 : pow(2, 10 * x - 10)),\n  expoOut: (x: number): number => (x === 1 ? 1 : 1 - pow(2, -10 * x)),\n  quintInOut: (x: number): number =>\n    x < 0.5 ? 16 * x * x * x * x * x : 1 - pow(-2 * x + 2, 5) / 2,\n  expoInOut: (x: number): number =>\n    x === 0\n      ? 0\n      : x === 1\n        ? 1\n        // eslint-disable-next-line unicorn/no-nested-ternary\n        : x < 0.5\n          ? pow(2, 20 * x - 10) / 2\n          : (2 - pow(2, -20 * x + 10)) / 2,\n  circIn: (x: number): number => 1 - sqrt(1 - pow(x, 2)),\n  circOut: (x: number): number => sqrt(1 - pow(x - 1, 2)),\n  backIn: (x: number): number => {\n    const c1 = 1.701_58;\n    const c3 = c1 + 1;\n\n    return c3 * x * x * x - c1 * x * x;\n  },\n  backOut: (x: number): number => {\n    const c1 = 1.701_58;\n    const c3 = c1 + 1;\n\n    return 1 + c3 * pow(x - 1, 3) + c1 * pow(x - 1, 2);\n  },\n  circInOut: (x: number): number =>\n    x < 0.5\n      ? (1 - sqrt(1 - pow(2 * x, 2))) / 2\n      : (sqrt(1 - pow(-2 * x + 2, 2)) + 1) / 2,\n  backInOut: (x: number): number => {\n    const c1 = 1.701_58;\n    const c2 = c1 * 1.525;\n\n    return x < 0.5\n      ? (pow(2 * x, 2) * ((c2 + 1) * 2 * x - c2)) / 2\n      : (pow(2 * x - 2, 2) * ((c2 + 1) * (x * 2 - 2) + c2) + 2) / 2;\n  },\n  elasticIn: (x: number): number => {\n    const c4 = (2 * pi) / 3;\n\n    return x === 0\n      ? 0\n      : (x === 1\n        ? 1\n        : -pow(2, 10 * x - 10) * sin((x * 10 - 10.75) * c4));\n  },\n  elasticOut: (x: number): number => {\n    const c4 = (2 * pi) / 3;\n\n    return x === 0\n      ? 0\n      : (x === 1\n        ? 1\n        : pow(2, -10 * x) * sin((x * 10 - 0.75) * c4) + 1);\n  },\n  bounceIn: (x: number): number => 1 - bounceOut(1 - x),\n  bounceOut: bounceOut,\n  elasticInOut: (x: number): number => {\n    const c5 = (2 * pi) / 4.5;\n\n    return x === 0\n      ? 0\n      : x === 1\n        ? 1\n        // eslint-disable-next-line unicorn/no-nested-ternary\n        : x < 0.5\n          ? -(pow(2, 20 * x - 10) * sin((20 * x - 11.125) * c5)) / 2\n          : (pow(2, -20 * x + 10) * sin((20 * x - 11.125) * c5)) / 2 + 1;\n  },\n  bounceInOut: (x: number): number =>\n    x < 0.5 ? (1 - bounceOut(1 - 2 * x)) / 2 : (1 + bounceOut(2 * x - 1)) / 2,\n};\n","import { throwNumberTest, throwIntegerTest } from '../Guards.js';\n\n/**\n * Wraps an integer number within a specified range, defaulting to degrees (0-360). Use {@link wrap} for floating-point wrapping.\n *\n * This is useful for calculations involving degree angles and hue, which wrap from 0-360.\n * Eg: to add 200 to 200, we don't want 400, but 40.\n *\n * ```js\n * const v = wrapInteger(200+200, 0, 360); // 40\n * ```\n *\n * Or if we minus 100 from 10, we don't want -90 but 270\n * ```js\n * const v = wrapInteger(10-100, 0, 360); // 270\n * ```\n *\n * `wrapInteger` uses 0-360 as a default range, so both of these\n * examples could just as well be:\n *\n * ```js\n * wrapInteger(200+200);  // 40\n * wrapInteger(10-100);  // 270\n * ```\n *\n * Non-zero starting points can be used. A range of 20-70:\n * ```js\n * const v = wrapInteger(-20, 20, 70); // 50\n * ```\n *\n * Note that the minimum value is inclusive, while the maximum is _exclusive_.\n * So with the default range of 0-360, 360 is never reached:\n *\n * ```js\n * wrapInteger(360); // 0\n * wrapInteger(361); // 1\n * ```\n *\n * If you just want to lock values to a range without wrapping, consider {@link clamp}.\n *\n * @param v Value to wrap\n * @param min Integer minimum of range (default: 0). Inclusive\n * @param max Integer maximum of range (default: 360). Exlusive\n * @returns\n */\nexport const wrapInteger = (v: number, min: number = 0, max: number = 360) => {\n  throwIntegerTest(v, undefined, `v`);\n  throwIntegerTest(min, undefined, `min`);\n  throwIntegerTest(max, undefined, `max`);\n\n  if (v === min) return min;\n  if (v === max) return min; // Wraps\n  if (v > 0 && v < min) v += min;\n\n  v -= min;\n  max -= min;\n  v = v % max;\n\n  if (v < 0) v = max - Math.abs(v) + min;\n  return v + min;\n};\n\n/**\n * Wraps floating point numbers to be within a range (default: 0..1). Use {@link wrapInteger} if you want to wrap integer values.\n *\n * This logic makes sense for some things like rotation angle.\n *\n * If you just want to lock values to a range without wrapping, consider {@link clamp}.\n *\n * ```js\n * wrap(1.2);   // 0.2\n * wrap(2);     // 1.0\n * wrap(-0.2); // 0.8\n * ```\n *\n * A range can be provided too:\n * ```js\n * wrap(30, 20, 50);  \t // 30\n * wrap(60, 20, 50);    //  30\n * ```\n * @param v\n * @param min\n * @param max\n * @returns\n */\nexport const wrap = (v: number, min: number = 0, max: number = 1) => {\n  throwNumberTest(v, ``, `min`);\n  throwNumberTest(min, ``, `min`);\n  throwNumberTest(max, ``, `max`);\n\n  if (v === min) return min;\n  if (v === max) return min; // Wraps\n\n  while (v <= min || v >= max) {\n    if (v === max) break;\n    if (v === min) break;\n    if (v > max) {\n      v = min + (v - max);\n    } else if (v < min) {\n      v = max - (min - v);\n    }\n  }\n  return v;\n};\n\n/**\n * Performs a calculation within a wrapping number range. This is a lower-level function.\n * See also: {@link wrapInteger} for simple wrapping within a range.\n *\n * `min` and `max` define the start and end of the valid range, inclusive. Eg for hue degrees it'd be 0, 360.\n * `a` and `b` is the range you want to work in.\n *\n * For example, let's say you want to get the middle point between a hue of 30 and a hue of 330 (ie warmer colours):\n * ```js\n * wrapRange(0,360, (distance) => {\n *  // for a:0 and b:330, distance would be 90 from 30 degrees to 330 (via zero)\n *  return distance * 0.5; // eg return middle point\n * }, 30, 330);\n * ```\n *\n * The return value of the callback should be in the range of 0-distance. `wrapRange` will subsequently\n * conform it to the `min` and `max` range before it's returned to the caller.\n *\n * @param a Output start (eg. 60)\n * @param b Output end (eg 300)\n * @param min Range start (eg 0)\n * @param max Range end (eg 360)\n * @param fn Returns a computed value from 0 to `distance`.\n * @returns\n */\nexport const wrapRange = (\n  min: number,\n  max: number,\n  fn: (distance: number) => number,\n  a: number,\n  b: number\n) => {\n  //eslint-disable-next-line functional/no-let\n  let r = 0;\n  // No wrapping\n  const distF = Math.abs(b - a);\n  // When b is wrapped forwards\n  const distFwrap = Math.abs(max - a + b);\n  // When b is wrapped backwards (10, 300)\n  const distBWrap = Math.abs(a + (360 - b));\n\n  const distMin = Math.min(distF, distFwrap, distBWrap);\n  if (distMin === distBWrap) {\n    // (10, 300) = 70\n    r = a - fn(distMin);\n  } else if (distMin === distFwrap) {\n    // (300, 60) = 120\n    r = a + fn(distMin);\n  } else {\n    // Forwards or backwards without wrapping\n    if (a > b) {\n      // (240,120) -- backwards\n      r = a - fn(distMin);\n    } else {\n      // (120,240) -- forwards\n      r = a + fn(distMin);\n    }\n  }\n  return wrapInteger(r, min, max);\n};\n","import { wrap } from './Wrap.js';\nexport const piPi = Math.PI * 2;\n\n/**\n * Interpolates between `a` and `b` by `amount`. Aka `lerp`.\n *\n * [ixfx Guide](https://clinth.github.io/ixfx-docs/modulation/interpolate/)\n *\n * @example Get the halfway point between 30 and 60\n * ```js\n * import {interpolate} from 'https://unpkg.com/ixfx/dist/data.js';\n * interpolate(0.5, 30, 60);\n * ```\n *\n * Interpolation is often used for animation. In that case, `amount`\n * would start at 0 and you would keep interpolating up to `1`\n * @example\n * ```js\n * import { interpolate } from 'https://unpkg.com/ixfx/dist/data.js';\n * import { percentPingPong } from 'https://unpkg.com/ixfx/dist/modulation.js'\n *\n * // Go back and forth between 0 and 1 by 0.1\n * let pp = percentPingPong(0.1);\n * continuously(() => {\n *  // Get position in ping-pong\n *  const amt = pp.next().value;\n *  // interpolate between Math.PI and Math.PI*2\n *  const v = interpolate(amt, Math.PI, Math.PI*2);\n *  // do something with v...\n * }).start();\n * ```\n *\n * See also {@link Visual.Colour.interpolate | Visual.Colour.interpolate }, {@link Geometry.Points.interpolate | Geometry.Points.interpolate}.\n * @param amount Interpolation amount, between 0 and 1 inclusive\n * @param a Start (ie when `amt` is 0)\n * @param b End (ie. when `amt` is 1)\n * @returns Interpolated value which will be between `a` and `b`.\n */\nexport const interpolate = (amount: number, a: number, b: number): number => {\n  const v = (1 - amount) * a + amount * b;\n  return v;\n};\n\n/**\n * Interpolate between angles `a` and `b` by `amount`. Angles are in radians.\n *\n * ```js\n * import { interpolateAngle } from 'https://unpkg.com/ixfx/dist/data.js';\n * interpolateAngle(0.5, Math.PI, Math.PI/2);\n * ```\n * @param amount\n * @param aRadians\n * @param bRadians\n * @returns\n */\nexport const interpolateAngle = (\n  amount: number,\n  aRadians: number,\n  bRadians: number\n): number => {\n  const t = wrap(bRadians - aRadians, 0, piPi);\n  return interpolate(amount, aRadians, aRadians + (t > Math.PI ? t - piPi : t));\n};\n","export type AsyncPromiseOrGenerator<V> =\n  | (() => Promise<V> | Promise<undefined>)\n  | (() => V | undefined)\n  | Generator<V>\n  | IterableIterator<V>\n  | AsyncIterableIterator<V>\n  | AsyncGenerator<V>\n  | AsyncIterable<V>\n  | Iterable<V>;\n\nexport * as Elapsed from './Elapsed.js';\nexport * from './DispatchList.js';\n\nimport { throwNumberTest } from '../Guards.js';\nimport { sleep } from './Sleep.js';\n\nimport * as StateMachine from './StateMachine.js';\nimport * as Timer from './Timer.js';\n\n/**\n * State Machine\n * See [here for usage](../classes/Flow.StateMachine.StateMachine.html).\n *\n * * {@link StateMachine.driver}: Drive a state machine\n * * {@link StateMachine.init}: Create a state machine from initial state and machine description\n * * {@link fromList}: Create a state machine from a simple list of states\n */\nexport * as StateMachine from './StateMachine.js';\n\nexport * from './Timer.js';\n\nexport * from './Interval.js';\nexport * from './Timeout.js';\nexport * from './UpdateOutdated.js';\nexport * from './Continuously.js';\nexport * from './Debounce.js';\nexport * from './Throttle.js';\nexport * from './Sleep.js';\nexport * from './WaitFor.js';\nexport * from './Delay.js';\nexport * from './Every.js';\nexport * from './RunOnce.js';\nexport * from './Retry.js';\nexport * from './Types.js';\n\nexport { TaskQueue } from './TaskQueue.js';\n\n\n\n/**\n * Iterates over `iterator` (iterable/array), calling `fn` for each value.\n * If `fn` returns _false_, iterator cancels.\n *\n * Over the default JS `forEach` function, this one allows you to exit the\n * iteration early.\n *\n * @example\n * ```js\n * forEach(count(5), () => console.log(`Hi`));  // Prints `Hi` 5x\n * forEach(count(5), i => console.log(i));      // Prints 0 1 2 3 4\n * forEach([0,1,2,3,4], i => console.log(i));   // Prints 0 1 2 3 4\n * ```\n *\n * Use {@link forEachAsync} if you want to use an async `iterator` and async `fn`.\n * @param iterator Iterable or array\n * @typeParam V Type of iterable\n * @param fn Function to call for each item. If function returns _false_, iteration cancels\n */\nexport const forEach = <V>(\n  iterator: IterableIterator<V> | ReadonlyArray<V>,\n  fn: (v?: V) => boolean\n) => {\n  for (const x of iterator) {\n    const r = fn(x);\n    if (typeof r === `boolean` && !r) break;\n  }\n};\n\n/**\n * Iterates over an async iterable or array, calling `fn` for each value, with optional\n * interval between each loop. If the async `fn` returns _false_, iterator cancels.\n *\n * Use {@link forEach} for a synchronous version.\n *\n * ```\n * // Prints items from array every second\n * await forEachAsync([0,1,2,3], i => console.log(i), 1000);\n * ```\n *\n * @example Retry `doSomething` up to five times, with 5 seconds between each attempt\n * ```\n * await forEachAsync(count(5), i=> {\n *  try {\n *    await doSomething();\n *    return false; // Succeeded, exit early\n *  } catch (ex) {\n *    console.log(ex);\n *    return true; // Keep trying\n *  }\n * }, 5000);\n * ```\n * @param iterator Iterable thing to loop over\n * @param fn Function to invoke on each item. If it returns _false_ loop ends.\n * @typeParam V Type of iterable\n */\nexport const forEachAsync = async function <V>(\n  iterator: AsyncIterableIterator<V> | ReadonlyArray<V>,\n  fn: (v?: V) => Promise<boolean> | Promise<void>,\n  intervalMs?: number\n) {\n  if (Array.isArray(iterator)) {\n    // Handle array\n    for (const x of iterator) {\n      const r = await fn(x);\n      if (intervalMs) await sleep(intervalMs);\n      if (typeof r === `boolean` && !r) break;\n    }\n  } else {\n    // Handle an async iterator\n    for await (const x of iterator) {\n      const r = await fn(x);\n      if (intervalMs) await sleep(intervalMs);\n      if (typeof r === `boolean` && !r) break;\n    }\n  }\n};\n\nexport type RepeatPredicate = (\n  repeats: number,\n  valuesProduced: number\n) => boolean;\n/**\n * Runs `fn` a certain number of times, yielding results.\n * If `fn` returns undefined, the result is ignored, but loop continues.\n *\n * ```js\n * // Results will be an array with five random numbers\n * const results = [...repeat(5, () => Math.random())];\n *\n * // Or as an generator (note also the simpler expression form)\n * for (const result of repeat(5, Math.random)) {\n * }\n * ```\n *\n * Repeats can be specified as an integer (eg. 5 for five repeats), or a function\n * that gives _false_ when repeating should stop.\n *\n * ```js\n * // Keep running `fn` until we've accumulated 10 values\n * // Useful if `fn` sometimes returns _undefined_\n * const results = repeat((repeats, valuesProduced) => valuesProduced < 10, fn);\n * ```\n *\n * If you don't need to accumulate return values, consider {@link Generators.count | Generators.count} with {@link Flow.forEach | Flow.forEach}.\n * If you want to have a waiting period between each repetition, consider {@link Flow.interval}.\n * @param countOrPredicate Number of repeats or function returning false when to stop\n * @param fn Function to run, must return a value to accumulate into array or _undefined_\n * @returns Yields results, one at a time\n */\nexport function* repeat<V>(\n  countOrPredicate: number | RepeatPredicate,\n  fn: (repeats: number, valuesProduced: number) => V | undefined\n) {\n  // Unit tested: expected return array length\n  //eslint-disable-next-line functional/no-let\n  let repeats, valuesProduced;\n  repeats = valuesProduced = 0;\n\n  if (typeof countOrPredicate === `number`) {\n    throwNumberTest(countOrPredicate, `positive`, `countOrPredicate`);\n    while (countOrPredicate-- > 0) {\n      repeats++;\n      const v = fn(repeats, valuesProduced);\n      if (v === undefined) continue;\n      yield v;\n      valuesProduced++;\n    }\n  } else if (typeof countOrPredicate === `function`) {\n    while (countOrPredicate(repeats, valuesProduced)) {\n      repeats++;\n      const v = fn(repeats, valuesProduced);\n      if (v === undefined) continue;\n      yield v;\n      valuesProduced++;\n    }\n  } else {\n    throw new TypeError(\n      `countOrPredicate should be a number or function. Got: ${ typeof countOrPredicate }`\n    );\n  }\n}\n\n/**\n * Repeatedly calls `fn`, reducing via `reduce`.\n *\n * ```js\n * repeatReduce(10, () => 1, (acc, v) => acc + v);\n * // Yields: 10\n *\n * // Multiplies random values against each other 10 times\n * repeatReduce(10, Math.random, (acc, v) => acc * v);\n * // Yields a single number\n * ```\n * @param countOrPredicate\n * @param fn\n * @param initial\n * @param reduce\n * @returns\n */\nexport const repeatReduce = <V>(\n  countOrPredicate: number | RepeatPredicate,\n  fn: () => V | undefined,\n  initial: V,\n  reduce: (accumulator: V, value: V) => V\n): V => {\n  if (typeof countOrPredicate === `number`) {\n    throwNumberTest(countOrPredicate, `positive`, `countOrPredicate`);\n    while (countOrPredicate-- > 0) {\n      const v = fn();\n      if (v === undefined) continue;\n      initial = reduce(initial, v);\n    }\n  } else {\n    //eslint-disable-next-line functional/no-let\n    let repeats, valuesProduced;\n    repeats = valuesProduced = 0;\n    while (countOrPredicate(repeats, valuesProduced)) {\n      repeats++;\n      const v = fn();\n      if (v === undefined) continue;\n      initial = reduce(initial, v);\n      valuesProduced++;\n    }\n  }\n  return initial;\n};\n\ntry {\n  if (typeof window !== `undefined`) {\n    //eslint-disable-next-line functional/immutable-data,@typescript-eslint/no-explicit-any\n    (window as any).ixfx = {\n      ...(window as any).ixfx,\n      Flow: { StateMachine, Timer, forEach, forEachAsync, repeat },\n    };\n  }\n} catch {\n  /* no-op */\n}\n\n","import { round } from '../Numbers.js';\nimport { intervalToMs, type Interval } from './IntervalType.js';\nimport { msElapsedTimer, relativeTimer } from './Timer.js';\n\nexport type Since = () => number;\n\n/**\n * Returns elapsed time since initial call.\n * ```js\n * // Record start\n * const elapsed = Elapsed.since();\n *\n * // Get elapsed time in millis\n * elapsed(); // Yields number\n * ```\n *\n * If you want to initialise a elapsed timer, but not yet start it, consider:\n * ```js\n * // Init\n * let state = {\n *  clicked: Elapsed.infinity()\n * };\n *\n * state.click(); // Returns a giant value\n *\n * // Later, when click happens:\n * state = { click: Elapsed.since() }\n * ```\n *\n * Use {@link once} if you want to measure a single period, and stop it.\n * @returns\n */\nexport const since = (): Since => {\n  const start = performance.now();\n  return (): number => {\n    return performance.now() - start;\n  };\n};\n\n/**\n * Returns elapsed time since initial call, however\n * timer stops when first invoked.\n *\n * ```js\n * const elapsed = Elapsed.once();\n * // ...do stuff\n * elapsed(); // Yields time since Elapsed.once() was called\n * // ...do more stuff\n * elapsed(); // Is still the same number as above\n * ```\n *\n * Use {@link since} to not have this stopping behaviour.\n * @returns\n */\nexport const once = (): Since => {\n  const start = Date.now();\n  //eslint-disable-next-line functional/no-let\n  let stoppedAt = 0;\n  return (): number => {\n    if (stoppedAt === 0) {\n      stoppedAt = Date.now() - start;\n    }\n    return stoppedAt;\n  };\n};\n/**\n * Returns a function that reports an 'infinite' elapsed time.\n * this can be useful as an initialiser for `elapsedSince`.\n *\n * ```js\n * // Init clicked to be an infinite time\n * let clicked = Elapsed.infinity();\n *\n * document.addEventListener('click', () => {\n *  // Now that click has happened, we can assign it properly\n *  clicked = Elapsed.since();\n * });\n * ```\n * @returns\n */\nexport const infinity = (): Since => {\n  return (): number => {\n    return Number.POSITIVE_INFINITY;\n  };\n};\n\n/**\n * Returns a function that returns the percentage of timer completion.\n * Starts timing immediately.\n *\n * ```js\n * const timer = Elapsed.progress(1000);\n * timer(); // Returns 0..1\n * ```\n *\n * Note that timer can exceed 1 (100%). To cap it:\n * ```js\n * Elapsed.progress(1000, { clampValue: true });\n * ```\n *\n * Takes an {@link Interval} for more expressive time:\n * ```js\n * const timer = Elapsed.progress({ mins: 4 });\n * ```\n * See also {@link hasElapsedMs}.\n * @param totalMs\n * @returns\n */\nexport function progress(\n  duration: Interval,\n  opts: { readonly clampValue?: boolean, readonly wrapValue?: boolean } = {}\n): () => number {\n  const totalMs = intervalToMs(duration);\n  if (!totalMs) throw new Error(`duration invalid`);\n  const timerOpts = {\n    ...opts,\n    timer: msElapsedTimer(),\n  };\n  const t = relativeTimer(totalMs, timerOpts);\n  return () => t.elapsed;\n}\n\nexport const toString = (millisOrFunction: number | Since | Interval, rounding = 2): string => {\n  //eslint-disable-next-line functional/no-let\n  let interval: number | undefined = {} = 0;\n  if (typeof millisOrFunction === `function`) {\n    const intervalResult = millisOrFunction();\n    return toString(intervalResult);\n  } else if (typeof millisOrFunction === `number`) {\n    interval = millisOrFunction;\n  } else if (typeof millisOrFunction === `object`) {\n    interval = intervalToMs(interval);\n  }\n\n  //eslint-disable-next-line functional/no-let\n  let ms = intervalToMs(interval);\n  if (typeof ms === `undefined`) return `(undefined)`;\n  if (ms < 1000) return `${ round(rounding, ms) }ms`;\n  ms /= 1000;\n  if (ms < 120) return `${ ms.toFixed(1) }secs`;\n  ms /= 60;\n  if (ms < 60) return `${ ms.toFixed(2) }mins`;\n  ms /= 60;\n  return `${ ms.toFixed(2) }hrs`;\n};\n","import * as NumericArrays from './collections/NumericArrays.js';\nimport { numberTracker } from './data/NumberTracker.js';\nimport { type TrackedValueOpts as TrackedValueOptions } from './data/TrackedValue.js';\nimport { Easings } from './modulation/index.js';\nimport { numberTest, integerTest, throwFromResult } from './Guards.js';\n\n/**\n * Calculates the average of all numbers in an array.\n * Array items which aren't a valid number are ignored and do not factor into averaging.\n\n * @example\n * ```\n * import * as Numbers from 'https://unpkg.com/ixfx/dist/numbers.js';\n * \n * // Average of a list\n * const avg = Numbers.average(1, 1.4, 0.9, 0.1);\n * \n * // Average of a variable\n * let data = [100,200];\n * Numbers.average(...data);\n * ```\n * \n * See also: [Arrays.average](Collections.Arrays.average.html) which takes an array.\n * @param data Data to average.\n * @returns Average of array\n */\nexport const average = (...numbers: ReadonlyArray<number>) =>\n  NumericArrays.average(numbers);\n\n/**\n * See [Arrays.averageWeighted](Collections.Arrays.averageWeighted.html)\n * @param weightings\n * @param numbers\n * @returns\n */\nexport const averageWeighted = (\n  weightings: Array<number> | ReadonlyArray<number> | Easings.EasingFn,\n  ...numbers: Array<number> | ReadonlyArray<number>\n): number => NumericArrays.averageWeighted(numbers, weightings);\n\n/**\n * Apples `fn` to every key of `obj` which is numeric.\n * ```js\n * const o = {\n *  name: 'john',\n *  x: 10,\n *  y: 20\n * };\n * const o2 = applyToValues(o, (v) => v * 2);\n * \n * // Yields: { name: 'john', x: 20, y: 40 }\n * ```\n * @param obj \n * @param apply \n * @returns \n */\nexport const applyToValues = <T extends Record<string, any>>(object: T, apply: (v: number) => number): T => {\n  const o: T = { ...object };\n  for (const [ key, value ] of Object.entries(object)) {\n    if (typeof value === `number`) {\n      // Run number through function\n      //eslint-disable-next-line functional/immutable-data\n      (o as any)[ key ] = apply(value);\n    } else {\n      // Copy value\n      //eslint-disable-next-line functional/immutable-data,@typescript-eslint/no-unsafe-assignment\n      (o as any)[ key ] = value;\n    }\n  }\n  return o;\n}\n\n/**\n * Returns the minimum number out of `data`.\n * Undefined and non-numbers are silently ignored.\n *\n * ```js\n * import * as Numbers from 'https://unpkg.com/ixfx/dist/numbers.js';\n * Numbers.min(10, 20, 0); // Yields 0\n * ```\n * @param data\n * @returns Minimum number\n */\nexport const min = (...data: ReadonlyArray<number>): number =>\n  NumericArrays.min(data);\n\n/**\n * Returns the maximum number out of `data`.\n * Undefined and non-numbers are silently ignored.\n *\n * ```js\n * import * as Numbers from 'https://unpkg.com/ixfx/dist/numbers.js';\n * Numbers.max(10, 20, 0); // Yields 20\n * ```\n * @param data\n * @returns Maximum number\n */\nexport const max = (...data: ReadonlyArray<number>): number =>\n  NumericArrays.max(data);\n\n/**\n * Returns the total of `data`.\n * Undefined and non-numbers are silently ignored.\n *\n * ```js\n * import * as Numbers from 'https://unpkg.com/ixfx/dist/numbers.js';\n * Numbers.total(10, 20, 0); // Yields 30\n * ```\n * @param data\n * @returns Total\n */\nexport const total = (...data: ReadonlyArray<number>): number =>\n  NumericArrays.total(data);\n\n/**\n * Returns true if `possibleNumber` is a number and not NaN\n * @param possibleNumber\n * @returns\n */\nexport const isValid = (possibleNumber: unknown) => {\n  if (typeof possibleNumber !== `number`) return false;\n  if (Number.isNaN(possibleNumber)) return false;\n  return true;\n};\n\n/**\n * Alias for [Data.numberTracker](Data.numberTracker.html)\n */\nexport const tracker = (options?: TrackedValueOptions) => numberTracker(options);\n\n/**\n * Filters an iterator of values, only yielding\n * those that are valid numbers\n *\n * ```js\n * import * as Numbers from 'https://unpkg.com/ixfx/dist/numbers.js';\n *\n * const data = [true, 10, '5', { x: 5 }];\n * for (const n of Numbers.filter(data)) {\n *  // 5\n * }\n * ```\n * @param it\n */\n//eslint-disable-next-line func-style\nexport function* filter(it: Iterable<unknown>) {\n  for (const v of it) {\n    if (isValid(v)) yield v;\n  }\n}\n\n/**\n * Rounds `v` by `every`. Middle values are rounded up by default.\n *\n * ```js\n * quantiseEvery(11, 10);  // 10\n * quantiseEvery(25, 10);  // 30\n * quantiseEvery(0, 10);   // 0\n * quantiseEvery(4, 10);   // 0\n * quantiseEvery(100, 10); // 100\n * ```\n *\n * @param v\n * @param every\n * @param middleRoundsUp\n * @returns\n */\nexport const quantiseEvery = (\n  v: number,\n  every: number,\n  middleRoundsUp = true\n) => {\n  // Unit tested!\n  throwFromResult(numberTest(v, ``, `v`));\n  throwFromResult(integerTest(every, ``, `every`));\n\n  //eslint-disable-next-line functional/no-let\n  let div = v / every;\n  const divModule = div % 1;\n  div = Math.floor(div);\n  if ((divModule === 0.5 && middleRoundsUp) || divModule > 0.5) div++;\n  return every * div;\n};\n\n/**\n * Generates a `step`-length series of values between `start` and `end` (inclusive).\n * Each value will be equally spaced.\n *\n * ```js\n * for (const v of linearSpace(1, 5, 6)) {\n *  // Yields: [ 1, 1.8, 2.6, 3.4, 4.2, 5 ]\n * }\n * ```\n *\n * Numbers can be produced from large to small as well\n * ```js\n * const values = [...linearSpace(10, 5, 3)];\n * // Yields: [10, 7.5, 5]\n * ```\n * @param start Start number (inclusive)\n * @param end  End number (inclusive)\n * @param steps How many steps to make from start -> end\n * @param precision Number of decimal points to round to\n */\nexport function* linearSpace(\n  start: number,\n  end: number,\n  steps: number,\n  precision?: number\n): IterableIterator<number> {\n  throwFromResult(numberTest(start, ``, `start`));\n  throwFromResult(numberTest(end, ``, `end`));\n\n  throwFromResult(numberTest(steps, ``, `steps`));\n\n  const r = precision ? round(precision) : (v: number) => v;\n  const step = (end - start) / (steps - 1);\n\n  throwFromResult(numberTest(step, ``, `step`));\n  if (!Number.isFinite(step)) {\n    throw new TypeError(`Calculated step value is infinite`);\n  }\n\n  //eslint-disable-next-line functional/no-let\n  for (let index = 0; index < steps; index++) {\n    const v = start + step * index;\n    yield r(v);\n  }\n}\n\nexport function round(decimalPlaces: number, v: number): number;\nexport function round(decimalPlaces: number): (v: number) => number;\n\n/**\n * Rounds a number.\n *\n * If one parameter is given, it's the decimal places,\n * and a rounding function is returned:\n * ```js\n * const r = round(2);\n * r(10.12355); // 10.12\n * ```\n *\n * If two parameters are given, the first is decimal places,\n * the second the value to round.\n * ```js\n * round(2, 10.12355); // 10.12\n * ```\n * @param decimalPlaces\n * @returns\n */\nexport function round(a: number, b?: number) {\n  throwFromResult(integerTest(a, `positive`, `decimalPlaces`));\n\n  //eslint-disable-next-line functional/no-let\n  let rounder;\n  if (a === 0) rounder = Math.round;\n  else {\n    const p = Math.pow(10, a);\n    rounder = (v: number) => Math.floor(v * p) / p;\n  }\n\n  return b === undefined ? rounder : rounder(b);\n}\n\nexport function isApproximately(\n  baseValue: number,\n  rangePercent: number\n): (v: number) => boolean;\n\nexport function isApproximately(\n  baseValue: number,\n  rangePercent: number,\n  v: number\n): boolean;\n\n/**\n * Returns a function that yields _true_ if a value is within\n * a percentage range of a base value.\n *\n * ```js\n * // Allow 10% above or below\n * const closeTo100 = isApproximately(100, 0.1); // returns a function\n * closeTo100(100); // true\n * closeTo100(101); // true;\n * closeTo100(90); // true;\n * closeTo100(80); // false;\n * ```\n *\n * `isApproximately` returns a function, but if a third value is provided,\n * it returns true/false, testing the value:\n * ```js\n * isApproximately(100, 0.1, 101); // True\n * ```\n * If the tested value is not a number, _false_ is returned\n * (because it is not, in fact approximately `baseValue`).\n *\n * For baseValues between -2 and 2, the calculated difference is rounded down\n * to 5 decimal places to avoid weird JS floating point math.\n * @param baseValue\n * @param rangePercent\n * @returns\n */\nexport function isApproximately(\n  baseValue: number,\n  rangePercent: number,\n  v?: number\n) {\n  throwFromResult(numberTest(rangePercent, `percentage`, `rangePercent`));\n  throwFromResult(numberTest(baseValue, ``, `baseValue`));\n\n  const diff = baseValue * rangePercent;\n  const test = (v: number): boolean => {\n    try {\n      throwFromResult(numberTest(v, ``, `v`));\n\n      //eslint-disable-next-line functional/no-let\n      let diffV = Math.abs(v - baseValue);\n      if (Math.abs(baseValue) <= 2) {\n        diffV = round(5, diffV);\n      }\n      return diffV <= diff;\n    } catch {\n      return false;\n    }\n  };\n\n  return v === undefined ? test : test(v);\n}\n","import { type GetOrGenerate, getOrGenerate } from '../collections/map/GetOrGenerate.js';\nimport { TrackerBase } from './TrackerBase.js';\n\nexport type Timestamped = {\n  readonly at: number\n}\nexport type TimestampedObject<V> = V & Timestamped;\n\n/**\n * Options\n */\nexport type TrackedValueOpts = {\n  readonly id?: string;\n\n  /**\n   * If true, intermediate points are stored. False by default\n   */\n  readonly storeIntermediate?: boolean;\n  /**\n   * If above zero, tracker will reset after this many samples\n   */\n  readonly resetAfterSamples?: number;\n\n  /**\n   * If above zero, there will be a limit to intermediate values kept.\n   *\n   * When the seen values is twice `sampleLimit`, the stored values will be trimmed down\n   * to `sampleLimit`. We only do this when the values are double the size so that\n   * the collections do not need to be trimmed repeatedly whilst we are at the limit.\n   *\n   * Automatically implies storeIntermediate\n   */\n  readonly sampleLimit?: number;\n\n  /**\n   * If true\n   */\n  readonly debug?: boolean\n};\n\n/**\n * Keeps track of keyed values of type `V` (eg Point). It stores occurences in type `T`, which\n * must extend from `TrackerBase<V>`, eg `PointTracker`.\n *\n * The `creator` function passed in to the constructor is responsible for instantiating\n * the appropriate `TrackerBase` sub-class.\n *\n * @example Sub-class\n * ```js\n * export class TrackedPointMap extends TrackedValueMap<Points.Point> {\n *  constructor(opts:TrackOpts = {}) {\n *   super((key, start) => {\n *    if (start === undefined) throw new Error(`Requires start point`);\n *    const p = new PointTracker(key, opts);\n *    p.seen(start);\n *    return p;\n *   });\n *  }\n * }\n * ```\n *\n */\nexport class TrackedValueMap<V, T extends TrackerBase<V, TResult>, TResult> {\n  store: Map<string, T>;\n  gog: GetOrGenerate<string, T, V>;\n\n  constructor(creator: (key: string, start: V | undefined) => T) {\n    this.store = new Map();\n    this.gog = getOrGenerate<string, T, V>(this.store, creator);\n  }\n\n  /**\n   * Number of named values being tracked\n   */\n  get size() {\n    return this.store.size;\n  }\n\n  /**\n   * Returns _true_ if `id` is stored\n   * @param id\n   * @returns\n   */\n  has(id: string) {\n    return this.store.has(id);\n  }\n\n  /**\n   * For a given id, note that we have seen one or more values.\n   * @param id Id\n   * @param values Values(s)\n   * @returns Information about start to last value\n   */\n  //eslint-disable-next-line @typescript-eslint/no-explicit-any\n  //eslint-disable-next-line functional/prefer-immutable-types\n  public async seen(id: string, ...values: Array<V>): Promise<TResult> {\n    const trackedValue = await this.getTrackedValue(id, ...values);\n\n    // Pass it over to the TrackedValue\n    const result = trackedValue.seen(...values);\n\n    return result;\n  }\n\n  /**\n   * Creates or returns a TrackedValue instance for `id`.\n   * @param id\n   * @param values\n   * @returns\n   */\n  //eslint-disable-next-line functional/prefer-immutable-types\n  protected async getTrackedValue(id: string, ...values: Array<V>) {\n    if (id === null) throw new Error(`id parameter cannot be null`);\n    if (id === undefined) throw new Error(`id parameter cannot be undefined`);\n\n    // Create or recall TrackedValue by id\n    const trackedValue = await this.gog(id, values[ 0 ]);\n    return trackedValue;\n  }\n\n  /**\n   * Remove a tracked value by id.\n   * Use {@link reset} to clear them all.\n   * @param id\n   */\n  delete(id: string) {\n    this.store.delete(id);\n  }\n\n  /**\n   * Remove all tracked values.\n   * Use {@link delete} to remove a single value by id.\n   */\n  reset() {\n    this.store = new Map();\n  }\n\n  /**\n   * Enumerate ids\n   */\n  *ids() {\n    yield* this.store.keys();\n  }\n\n  /**\n   * Enumerate tracked values\n   */\n  *tracked() {\n    yield* this.store.values();\n  }\n\n  /**\n   * Iterates TrackedValues ordered with oldest first\n   * @returns\n   */\n  *trackedByAge() {\n    const tp = [ ...this.store.values() ];\n    tp.sort((a, b) => {\n      const aa = a.elapsed;\n      const bb = b.elapsed;\n      if (aa === bb) return 0;\n      if (aa > bb) return -1;\n      return 1;\n    });\n\n    for (const t of tp) {\n      yield t;\n    }\n  }\n\n  /**\n   * Iterates underlying values, ordered by age (oldest first)\n   * First the named values are sorted by their `elapsed` value, and then\n   * we return the last value for that group.\n   */\n  *valuesByAge() {\n    for (const tb of this.trackedByAge()) {\n      yield tb.last;\n    }\n  }\n\n  /**\n   * Enumerate last received values\n   *\n   * @example Calculate centroid of latest-received values\n   * ```js\n   * const pointers = pointTracker();\n   * const c = Points.centroid(...Array.from(pointers.lastPoints()));\n   * ```\n   */\n  *last() {\n    for (const p of this.store.values()) {\n      yield p.last;\n    }\n  }\n\n  /**\n   * Enumerate starting values\n   */\n  *initialValues() {\n    for (const p of this.store.values()) {\n      yield p.initial;\n    }\n  }\n\n  /**\n   * Returns a tracked value by id, or undefined if not found\n   * @param id\n   * @returns\n   */\n  get(id: string): TrackerBase<V, TResult> | undefined {\n    return this.store.get(id);\n  }\n}\n","import { type Timestamped, type TrackedValueOpts } from './TrackedValue.js';\n\n/**\n * Base tracker class\n */\nexport abstract class TrackerBase<V, SeenResultType> {\n  /**\n   * @ignore\n   */\n  seenCount: number;\n\n  /**\n   * @ignore\n   */\n  protected storeIntermediate: boolean;\n\n  /**\n   * @ignore\n   */\n  protected resetAfterSamples: number;\n\n  /**\n   * @ignore\n   */\n  protected sampleLimit: number;\n\n  public readonly id: string;\n\n  protected debug: boolean;\n\n  constructor(opts: TrackedValueOpts = {}) {\n    this.id = opts.id ?? `tracker`;\n    this.debug = opts.debug ?? false;\n    this.sampleLimit = opts.sampleLimit ?? -1;\n    this.resetAfterSamples = opts.resetAfterSamples ?? -1;\n\n    this.storeIntermediate =\n      opts.storeIntermediate ??\n      (this.sampleLimit > -1 || this.resetAfterSamples > -1);\n    this.seenCount = 0;\n\n    if (this.debug) {\n      console.log(`TrackerBase: sampleLimit: ${ this.sampleLimit } resetAfter: ${ this.resetAfterSamples } store: ${ this.storeIntermediate }`);\n    }\n  }\n\n  /**\n   * Reset tracker\n   */\n  reset() {\n    this.seenCount = 0;\n    this.onReset();\n  }\n\n  /**\n   * Calculate results\n   *  \n   * @param p \n   * @returns \n   */\n  seen(...p: Array<V>): SeenResultType {\n    if (this.resetAfterSamples > 0 && this.seenCount > this.resetAfterSamples) {\n      this.reset();\n    } else if (this.sampleLimit > 0 && this.seenCount > this.sampleLimit * 2) {\n      this.seenCount = this.trimStore(this.sampleLimit);\n      this.onTrimmed();\n    }\n\n    this.seenCount += p.length;\n    const t = this.filterData(p);\n    return this.computeResults(t);\n  }\n\n  /**\n   * @ignore\n   * @param p\n   */\n  abstract filterData(p: Array<V>): Array<Timestamped>;\n\n  abstract get last(): V | undefined;\n\n  /**\n   * Returns the initial value, or undefined\n   */\n  abstract get initial(): V | undefined;\n\n  /**\n   * Returns the elapsed milliseconds since the initial value\n   */\n  abstract get elapsed(): number;\n\n  /**\n   * @ignore\n   */\n  //eslint-disable-next-line @typescript-eslint/no-empty-function\n  abstract computeResults(_p: Array<Timestamped>): SeenResultType;\n\n  /**\n   * @ignore\n   */\n  abstract onReset(): void;\n\n  abstract onTrimmed(): void;\n  abstract trimStore(limit: number): number;\n}\n","//import { repeat } from '../flow/index.js';\n\nimport type { TrackedValueOpts } from './TrackedValue.js';\nimport { TrackerBase } from './TrackerBase.js';\n\nexport type TimestampedPrimitive<V extends number | string> = {\n  at: number\n  value: V\n}\n\nexport abstract class PrimitiveTracker<\n  V extends number | string,\n  TResult\n> extends TrackerBase<V, TResult> {\n\n  //computeResults(_p: Timestamped[]): TResult;\n\n  values: Array<V>;\n  timestamps: Array<number>;\n  //data: Array<TimestampedPrimitive<V>>;\n\n  constructor(opts?: TrackedValueOpts) {\n    super(opts);\n    //this.data = [];\n    this.values = [];\n    this.timestamps = [];\n  }\n\n  /**\n   * Reduces size of value store to `limit`. Returns\n   * number of remaining items\n   * @param limit\n   */\n  trimStore(limit: number): number {\n    if (limit >= this.values.length) return this.values.length;\n    //this.data = this.data.slice(-limit);\n    this.values = this.values.slice(-limit);\n    this.timestamps = this.timestamps.slice(-limit);\n    return this.values.length;\n  }\n\n  onTrimmed() {\n    // no-op\n  }\n\n  get last(): V | undefined {\n    return this.values.at(-1);\n  }\n\n  get initial(): V | undefined {\n    return this.values.at(0);\n  }\n\n  /**\n   * Returns number of recorded values (this can include the initial value)\n   */\n  get size() {\n    return this.values.length;\n  }\n\n  /**\n   * Returns the elapsed time, in milliseconds since the instance was created\n   */\n  get elapsed(): number {\n    if (this.values.length < 0) throw new Error(`No values seen yet`);\n    return Date.now() - this.timestamps[ 0 ];\n  }\n\n  onReset() {\n    this.values = [];\n    this.timestamps = [];\n  }\n\n  /**\n   * Tracks a value\n   */\n  filterData(rawValues: Array<V>): Array<TimestampedPrimitive<V>> {\n    const lastValue = rawValues.at(-1);\n    const last: TimestampedPrimitive<V> = { value: lastValue as unknown as V, at: performance.now() };\n\n    const values: Array<TimestampedPrimitive<V>> = rawValues.map(value => ({\n      at: performance.now(),\n      value: value\n    }));\n\n    //const now = Date.now();\n    if (this.storeIntermediate) {\n      this.values.push(...rawValues);\n      //this.timestamps.push(...repeat(p.length, () => now));\n      this.timestamps.push(...values.map(v => v.at));\n    } else switch (this.values.length) {\n      case 0: {\n        // Add as initial value\n        this.values.push(last.value);\n        this.timestamps.push(last.at);\n        break;\n      }\n      case 2: {\n        // Replace last value\n        this.values[ 1 ] = last.value;\n        this.timestamps[ 1 ] = last.at;\n        break;\n      }\n      case 1: {\n        // Add last value\n        this.values.push(last.value);\n        this.timestamps.push(last.at);\n        break;\n      }\n      // No default\n    }\n\n    return values;\n  }\n}\n","import { PrimitiveTracker, type TimestampedPrimitive } from './PrimitiveTracker.js';\nimport {\n  type TrackedValueOpts as TrackOpts,\n} from './TrackedValue.js';\nimport { minFast, maxFast, totalFast } from '../collections/NumericArrays.js';\n\nexport type NumberTrackerResults = {\n  readonly total: number\n  readonly min: number\n  readonly max: number\n  readonly avg: number\n};\n\nexport class NumberTracker extends PrimitiveTracker<number, NumberTrackerResults> {\n  total = 0;\n  min = Number.MAX_SAFE_INTEGER;\n  max = Number.MIN_SAFE_INTEGER;\n\n  get avg() {\n    return this.total / this.seenCount;\n  }\n\n  /**\n   * Difference between last value and initial.\n   * Eg. if last value was 10 and initial value was 5, 5 is returned (10 - 5)\n   * If either of those is missing, undefined is returned\n   */\n  difference(): number | undefined {\n    if (this.last === undefined) return;\n    if (this.initial === undefined) return;\n    return this.last - this.initial;\n  }\n\n  /**\n   * Relative difference between last value and initial.\n   * Eg if last value was 10 and initial value was 5, 2 is returned (200%)\n   */\n  relativeDifference(): number | undefined {\n    if (this.last === undefined) return;\n    if (this.initial === undefined) return;\n    return this.last / this.initial;\n  }\n\n  onReset() {\n    this.min = Number.MAX_SAFE_INTEGER;\n    this.max = Number.MIN_SAFE_INTEGER;\n    this.total = 0;\n    super.onReset();\n  }\n\n  onTrimmed() {\n    this.min = minFast(this.values);\n    this.max = maxFast(this.values);\n    this.total = totalFast(this.values);\n  }\n\n  computeResults(values: Array<TimestampedPrimitive<number>>): NumberTrackerResults {\n    if (values.some((v) => Number.isNaN(v))) throw new Error(`Cannot add NaN`);\n    const numbers = values.map(value => value.value);\n\n    this.total = numbers.reduce((accumulator, v) => accumulator + v, this.total);\n    this.min = Math.min(...numbers, this.min);\n    this.max = Math.max(...numbers, this.max);\n    const r: NumberTrackerResults = {\n      max: this.max,\n      min: this.min,\n      total: this.total,\n      avg: this.avg\n    }\n    return r;\n  }\n\n  getMinMaxAvg() {\n    return {\n      min: this.min,\n      max: this.max,\n      avg: this.avg,\n    };\n  }\n}\n\n/**\n * Keeps track of the total, min, max and avg in a stream of values. By default values\n * are not stored.\n *\n * Usage:\n *\n * ```js\n * import { numberTracker } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * const t = numberTracker();\n * t.seen(10);\n *\n * t.avg / t.min/ t.max\n * t.initial; // initial value\n * t.size;    // number of seen values\n * t.elapsed; // milliseconds since intialisation\n * t.last;    // last value\n * ```\n *\n * To get `{ avg, min, max, total }`\n * ```\n * t.getMinMax()\n * ```\n *\n * Use `t.reset()` to clear everything.\n *\n * Trackers can automatically reset after a given number of samples\n * ```\n * // reset after 100 samples\n * const t = numberTracker({ resetAfterSamples: 100 });\n * ```\n *\n * To store values, use the `storeIntermediate` option:\n *\n * ```js\n * const t = numberTracker({ storeIntermediate: true });\n * ```\n *\n * Difference between last value and initial value:\n * ```js\n * t.relativeDifference();\n * ```\n *\n * Get raw data (if it is being stored):\n * ```js\n * t.values; // array of numbers\n * t.timestampes; // array of millisecond times, indexes correspond to t.values\n * ```\n * @class NumberTracker\n */\nexport const numberTracker = (opts: TrackOpts = {}) => new NumberTracker(opts);\n","import * as Easings from './Easing.js';\nimport * as Envelopes from './Envelope.js';\nimport * as Forces from './Forces.js';\nimport * as Oscillators from './Oscillator.js';\nexport { perSecond } from './PerSecond.js';\nexport * from './PingPong.js';\n\n\n/**\n * Easings module\n *\n * [See the guide](https://clinth.github.io/ixfx-docs/modulation/easing/)\n *\n * Overview:\n * * {@link Easings.time}: Ease by time\n * * {@link Easings.tick}: Ease by tick\n * * {@link Easings.get}: Get an easing function by name\n * * {@link Easings.crossfade}: Mix two synchronised easing functions (a slight shortcut over `mix`)\n * * {@link Easings.mix}: Mix two easing functions\n * * {@link Easings.gaussian}: Gaussian distribution (rough bell curve)\n *\n * @example Importing\n * ```js\n * // If library is stored two directories up under `ixfx/`\n * import { Easings } from '../../ixfx/dist/modulation.js';\n * Easings.time(...);\n *\n * // Import from web\n * import { Easings } from 'https://unpkg.com/ixfx/dist/modulation.js'\n * Easings.time(...);\n * ```\n */\n\n\n/**\n * Envelopes\n */\nexport * from './Envelope.js';\n\nexport * as Envelopes from './Envelope.js';\n\n/**\n * Forces module can help to compute basic physical forces like gravity, friction, springs etc.\n *\n * @example Importing\n * ```js\n * // If library is stored two directories up under `ixfx/`\n * import { Forces } from '../../ixfx/dist/modulation.js';\n * Forces.attractionForce(...);\n *\n * // Import from web\n * import { Forces } from 'https://unpkg.com/ixfx/dist/modulation.js'\n * Forces.attractionForce(...);\n * ```\n *\n */\n\n\n/**\n * Oscillators module has waveshapes for producing values with a specified frequency.\n *\n * Overview\n * * {@link Oscillators.saw}: 'Sawtooth' wave\n * * {@link Oscillators.sine}: Sine wave\n * * {@link Oscillators.sineBipolar}: Sine wave with range of -1 to 1\n * * {@link Oscillators.square}: Square wave\n * * {@link Oscillators.triangle}: Triangle wave\n * * {@link Oscillators.spring}: Spring oscillator\n *\n * @example On-demand sampling\n * ```js\n * // Saw wave with frequency of 0.10hZ\n * const osc = Oscillators.saw(0.1);\n *\n * // Whever we need to sample from the oscillator...\n * const v = osc.next().value;\n * ```\n *\n * @example Importing\n * ```js\n * // If library is stored two directories up under `ixfx/`\n * import { Oscillators } from '../../ixfx/dist/modulation.js';\n * Oscillators.saw(...);\n *\n * // Import from web\n * import { Oscillators } from 'https://unpkg.com/ixfx/dist/modulation.js'\n * Oscillators.saw(...);\n * ```\n *\n */\n\n\ntry {\n  if (typeof window !== `undefined`) {\n    //eslint-disable-next-line functional/immutable-data,@typescript-eslint/no-explicit-any\n    (window as any).ixfx = {\n      ...(window as any).ixfx,\n      Modulation: { Forces, Envelopes, Oscillators, Easings },\n    };\n  }\n} catch {\n  /* no-op */\n}\n\nexport { type Jitterer, type JitterOpts, jitter, jitterAbsolute } from './Jitter.js';\nexport * as Easings from './Easing.js';\nexport * as Forces from './Forces.js';\nexport * as Oscillators from './Oscillator.js';","import { SimpleEventEmitter } from '../Events.js';\nimport { msElapsedTimer, type TimerSource } from '../flow/index.js';\nimport { type Timer } from '../flow/Timer.js';\nimport { type Path } from '../geometry/Path.js';\nimport * as Bezier from '../geometry/Bezier.js';\nimport { scale } from '../data/Scale.js';\nimport { interval } from '../flow/Interval.js';\nimport { StateMachineWithEvents } from '../flow/StateMachineWithEvents.js';\n\n/**\n * @returns Returns a full set of default ADSR options\n */\nexport const defaultAdsrOpts = (): EnvelopeOpts => ({\n  attackBend: -1,\n  decayBend: -0.3,\n  releaseBend: -0.3,\n  peakLevel: 1,\n  initialLevel: 0,\n  sustainLevel: 0.6,\n  releaseLevel: 0,\n  attackDuration: 600,\n  decayDuration: 200,\n  releaseDuration: 800,\n  shouldLoop: false,\n});\n\nexport type EnvelopeOpts = AdsrOpts & AdsrTimingOpts;\n/**\n * Options for the ADSR envelope.\n *\n * Use {@link defaultAdsrOpts} to get an initial default:\n * @example\n * ```js\n * let env = adsr({\n *  ...defaultAdsrOpts(),\n *  attackDuration: 2000,\n *  releaseDuration: 5000,\n *  sustainLevel: 1,\n *  retrigger: false\n * });\n * ```\n */\nexport type AdsrOpts = {\n  /**\n   * Attack bezier 'bend'. Bend from -1 to 1. 0 for a straight line\n   */\n  readonly attackBend?: number;\n  /**\n   * Decay bezier 'bend'. Bend from -1 to 1. 0 for a straight line\n   */\n  readonly decayBend?: number;\n  /**\n   * Release bezier 'bend'. Bend from -1 to 1. 0 for a straight line\n   */\n  readonly releaseBend?: number;\n\n  /**\n   * Peak level (maximum of attack stage)\n   */\n  readonly peakLevel?: number;\n\n  /**\n   * Starting level (usually 0)\n   */\n  readonly initialLevel?: number;\n  /**\n   * Sustain level. Only valid if trigger and hold happens\n   */\n  readonly sustainLevel?: number;\n  /**\n   * Release level, when envelope is done (usually 0)\n   */\n  readonly releaseLevel?: number;\n\n  /**\n   * When _false_, envelope starts from it's current level when being triggered.\n   * _True_ by default.\n   */\n  readonly retrigger?: boolean;\n};\n\nexport type AdsrTimingOpts = {\n  /**\n   * If true, envelope indefinately returns to attack stage after release\n   *\n   * @type {boolean}\n   */\n  readonly shouldLoop?: boolean;\n\n  /**\n   * Duration for attack stage\n   * Unit depends on timer source\n   * @type {number}\n   */\n  readonly attackDuration?: number;\n  /**\n   * Duration for decay stage\n   * Unit depends on timer source\n   * @type {number}\n   */\n  readonly decayDuration?: number;\n  /**\n   * Duration for release stage\n   * Unit depends on timer source\n   * @type {number}\n   */\n  readonly releaseDuration?: number;\n};\n\n/**\n * State change event\n */\nexport interface StateChangeEvent {\n  readonly newState: string;\n  readonly priorState: string;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface CompleteEvent {\n  /* no-op */\n}\n\nexport type Events = {\n  readonly change: StateChangeEvent;\n  readonly complete: CompleteEvent;\n};\n\nconst adsrTransitionsInstance = Object.freeze({\n  attack: [ `decay`, `release` ],\n  decay: [ `sustain`, `release` ],\n  sustain: [ `release` ],\n  release: [ `complete` ],\n  //eslint-disable-next-line unicorn/no-null\n  complete: null,\n});\ntype AdsrStateTransitions = Readonly<typeof adsrTransitionsInstance>;\n\nclass AdsrBase extends SimpleEventEmitter<Events> {\n  readonly #sm: StateMachineWithEvents<AdsrStateTransitions>;\n  readonly #timeSource: TimerSource;\n  #timer: Timer | undefined;\n\n  #holding: boolean;\n  #holdingInitial: boolean;\n\n  attackDuration: number;\n  decayDuration: number;\n  releaseDuration: number;\n  decayDurationTotal: number;\n  shouldLoop: boolean;\n\n  constructor(opts: AdsrTimingOpts) {\n    super();\n\n    this.attackDuration = opts.attackDuration ?? 300;\n    this.decayDuration = opts.decayDuration ?? 500;\n    this.releaseDuration = opts.releaseDuration ?? 1000;\n    this.shouldLoop = opts.shouldLoop ?? false;\n\n    this.#sm = new StateMachineWithEvents<AdsrStateTransitions>(\n      adsrTransitionsInstance,\n      { initial: `attack` }\n    );\n\n    this.#sm.addEventListener(`change`, (event) => {\n      // Reset timer on release\n      if (event.newState === `release` && this.#holdingInitial) {\n        this.#timer?.reset();\n      }\n      super.fireEvent(`change`, event);\n    });\n    this.#sm.addEventListener(`stop`, (event) => {\n      super.fireEvent(`complete`, event);\n    });\n\n    this.#timeSource = msElapsedTimer;\n    this.#holding = this.#holdingInitial = false;\n\n    this.decayDurationTotal = this.attackDuration + this.decayDuration;\n  }\n\n  protected switchState(): boolean {\n    if (this.#timer === undefined) return false;\n    // eslint-disable-next-line functional/no-let\n    let elapsed = this.#timer.elapsed;\n    const wasHeld = this.#holdingInitial && !this.#holding;\n\n    // Change through states for as long as needed\n    // eslint-disable-next-line functional/no-let\n    let hasChanged = false;\n    do {\n      hasChanged = false;\n      switch (this.#sm.state) {\n        case `attack`: {\n          if (elapsed > this.attackDuration || wasHeld) {\n            this.#sm.next();\n            hasChanged = true;\n          }\n          break;\n        }\n        case `decay`: {\n          if (elapsed > this.decayDurationTotal || wasHeld) {\n            this.#sm.next();\n            hasChanged = true;\n          }\n          break;\n        }\n        case `sustain`: {\n          if (!this.#holding || wasHeld) {\n            elapsed = 0;\n            this.#sm.next();\n            this.#timer.reset();\n            hasChanged = true;\n          }\n          break;\n        }\n        case `release`: {\n          if (elapsed > this.releaseDuration) {\n            this.#sm.next();\n            hasChanged = true;\n          }\n          break;\n        }\n        case `complete`: {\n          if (this.shouldLoop) {\n            this.trigger(this.#holdingInitial);\n          }\n        }\n      }\n    } while (hasChanged);\n    return hasChanged;\n  }\n\n  /**\n   * Computes a stage progress from 0-1\n   * @param allowStateChange\n   * @returns\n   */\n  protected computeRaw(\n    allowStateChange = true\n  ): [ stage: string | undefined, amount: number, prevStage: string ] {\n    if (this.#timer === undefined) return [ undefined, 0, this.#sm.state ];\n\n    // Change state if necessary based on elapsed time\n    if (allowStateChange) this.switchState();\n\n    const previousStage = this.#sm.state;\n\n    const elapsed = this.#timer.elapsed;\n    // eslint-disable-next-line functional/no-let\n    let relative = 0;\n    const state = this.#sm.state;\n    switch (state) {\n      case `attack`: {\n        relative = elapsed / this.attackDuration;\n        break;\n      }\n      case `decay`: {\n        relative = (elapsed - this.attackDuration) / this.decayDuration;\n        break;\n      }\n      case `sustain`: {\n        relative = 1;\n        break;\n      }\n      case `release`: {\n        relative = Math.min(elapsed / this.releaseDuration, 1);\n        break;\n      }\n      case `complete`: {\n        return [ undefined, 1, previousStage ];\n      }\n      default: {\n        throw new Error(`State machine in unknown state: ${ state }`);\n      }\n    }\n    return [ state, relative, previousStage ];\n  }\n\n  get isDone(): boolean {\n    return this.#sm.isDone;\n  }\n\n  onTrigger(): void {\n    /* no op */\n  }\n\n  trigger(hold = false) {\n    this.onTrigger();\n\n    this.#sm.reset();\n    this.#timer = this.#timeSource();\n    this.#holding = hold;\n    this.#holdingInitial = hold;\n  }\n\n  compute(): void {\n    /* no-op */\n  }\n\n  release() {\n    if (this.isDone || !this.#holdingInitial) return; // Was never holding or done\n\n    // Setting holding flag to false, computeRaw will change state\n    this.#holding = false;\n    this.compute();\n  }\n}\n\n/**\n * ADSR (Attack Decay Sustain Release) envelope. An envelope is a value that changes over time,\n * usually in response to an intial trigger.\n *\n * Created with the {@link adsr} function. [See the ixfx Guide on Envelopes](https://clinth.github.io/ixfx-docs/modulation/envelope/).\n *\n * @example Setup\n * ```js\n * import { Envelopes } from 'https://unpkg.com/ixfx/dist/modulation.js'\n * const opts = {\n *  ...Envelopes.defaultAdsrOpts(),\n *  attackDuration: 1000,\n *  decayDuration: 200,\n *  sustainDuration: 100\n * }\n * const env = Envelopes.adsr(opts);\n * ```\n *\n * [Options for envelope](https://clinth.github.io/ixfx/types/Modulation.EnvelopeOpts.html) are as follows:\n *\n * ```js\n * initialLevel?: number\n * attackBend: number\n * attackDuration: number\n * decayBend: number\n * decayDuration:number\n * sustainLevel: number\n * releaseBend: number\n * releaseDuration: number\n * releaseLevel?: number\n * peakLevel: number\n * retrigger?: boolean\n * shouldLoop: boolean\n * ```\n *\n * If `retrigger` is false, re-triggers will continue at current level\n * rather than resetting to `initialLevel`.\n *\n * If `shouldLoop` is true, envelope loops until `release()` is called.\n *\n * @example Using\n * ```js\n * env.trigger(); // Start envelope\n * ...\n * // Get current value of envelope\n * const [state, scaled, raw] = env.compute();\n * ```\n *\n * * `state` is a string, one of the following: 'attack', 'decay', 'sustain', 'release', 'complete'\n * * `scaled` is a value scaled according to the stage's _levels_\n * * `raw` is the progress from 0 to 1 within a stage. ie. 0.5 means we're halfway through a stage.\n *\n * Instead of `compute()`, most usage of the envelope is just fetching the `value` property, which returns the same scaled value of `compute()`:\n *\n * ```js\n * const value = env.value; // Get scaled number\n * ```\n *\n * @example Hold & release\n * ```js\n * env.trigger(true);   // Pass in true to hold\n * ...envelope will stop at sustain stage...\n * env.release();      // Release into decay\n * ```\n *\n * Check if it's done:\n *\n * ```js\n * env.isDone; // True if envelope is completed\n * ```\n *\n * Envelope has events to track activity: 'change' and 'complete':\n *\n * ```\n * env.addEventListener(`change`, ev => {\n *  console.log(`Old: ${evt.oldState} new: ${ev.newState}`);\n * })\n * ```\n */\nexport interface Adsr extends SimpleEventEmitter<Events> {\n  /**\n   * Compute value of envelope at this point in time.\n   *\n   * Returns an array of [stage, scaled, raw]. Most likely you want to use {@link value} to just get the scaled value.\n   * @param allowStateChange If true (default) envelope will be allowed to change state if necessary before returning value\n   */\n  compute(\n    allowStateChange?: boolean\n  ): readonly [ stage: string | undefined, scaled: number, raw: number ];\n\n  /**\n   * Returns the scaled value\n   * Same as .compute()[1]\n   */\n  get value(): number;\n  /**\n   * Releases a held envelope. Has no effect if envelope was not held or is complete.\n   */\n  release(): void;\n  /**\n   * Triggers envelope.\n   *\n   * If event is already trigged,\n   * it will be _retriggered_. If`opts.retriggered` is false (default)\n   * envelope starts again at `opts.initialValue`. Otherwise it starts at\n   * the current value.\n   *\n   * @param hold If _true_ envelope will hold at sustain stage\n   */\n  trigger(hold?: boolean): void;\n  /**\n   * _True_ if envelope is completed\n   */\n  get isDone(): boolean;\n}\n\nclass AdsrImpl extends AdsrBase implements Adsr {\n  readonly attackPath: Path;\n  readonly decayPath: Path;\n  readonly releasePath: Path;\n\n  readonly initialLevel;\n  readonly peakLevel;\n  readonly releaseLevel;\n  readonly sustainLevel;\n\n  readonly attackBend;\n  readonly decayBend;\n  readonly releaseBend;\n\n  protected initialLevelOverride: number | undefined;\n  readonly retrigger: boolean;\n  private releasedAt: number | undefined;\n\n  constructor(opts: EnvelopeOpts) {\n    super(opts);\n    this.initialLevel = opts.initialLevel ?? 0;\n    this.peakLevel = opts.peakLevel ?? 1;\n    this.releaseLevel = opts.releaseLevel ?? 0;\n    this.sustainLevel = opts.sustainLevel ?? 0.75;\n    this.retrigger = opts.retrigger ?? true;\n\n    this.attackBend = opts.attackBend ?? 0;\n    this.releaseBend = opts.releaseBend ?? 0;\n    this.decayBend = opts.decayBend ?? 0;\n\n    const max = 1;\n    this.attackPath = Bezier.toPath(\n      Bezier.quadraticSimple(\n        { x: 0, y: this.initialLevel },\n        { x: max, y: this.peakLevel },\n        -this.attackBend\n      )\n    );\n    this.decayPath = Bezier.toPath(\n      Bezier.quadraticSimple(\n        { x: 0, y: this.peakLevel },\n        { x: max, y: this.sustainLevel },\n        -this.decayBend\n      )\n    );\n    this.releasePath = Bezier.toPath(\n      Bezier.quadraticSimple(\n        { x: 0, y: this.sustainLevel },\n        { x: max, y: this.releaseLevel },\n        -this.releaseBend\n      )\n    );\n  }\n\n  onTrigger() {\n    this.initialLevelOverride = undefined;\n    if (!this.retrigger) {\n      const [ _stage, scaled, _raw ] = this.compute();\n      if (!Number.isNaN(scaled) && scaled > 0) {\n        this.initialLevelOverride = scaled;\n      }\n    }\n  }\n\n  get value(): number {\n    return this.compute(true)[ 1 ];\n  }\n\n  compute(\n    allowStateChange = true\n  ): [ stage: string | undefined, scaled: number, raw: number ] {\n    const [ stage, amt ] = super.computeRaw(allowStateChange);\n    if (stage === undefined) return [ undefined, Number.NaN, Number.NaN ];\n    // eslint-disable-next-line functional/no-let\n    let v;\n    switch (stage) {\n      case `attack`: {\n        v = this.attackPath.interpolate(amt).y;\n        if (this.initialLevelOverride !== undefined) {\n          v = scale(v, 0, 1, this.initialLevelOverride, 1);\n        }\n        this.releasedAt = v;\n        break;\n      }\n      case `decay`: {\n        v = this.decayPath.interpolate(amt).y;\n        this.releasedAt = v;\n        break;\n      }\n      case `sustain`: {\n        v = this.sustainLevel;\n        this.releasedAt = v;\n        break;\n      }\n      case `release`: {\n        v = this.releasePath.interpolate(amt).y;\n        // Bound release level to the amp level that we released at.\n        // ie. when release happens before a stage completes\n        if (this.releasedAt !== undefined) {\n          v = scale(v, 0, this.sustainLevel, 0, this.releasedAt);\n        }\n        break;\n      }\n      case `complete`: {\n        v = this.releaseLevel;\n        this.releasedAt = undefined;\n        break;\n      }\n      default: {\n        throw new Error(`Unknown state: ${ stage }`);\n      }\n    }\n    return [ stage, v, amt ];\n  }\n}\n\n/**\n * Creates an {@link Adsr} envelope.\n * @param opts\n * @returns New {@link Adsr} Envelope\n */\nexport const adsr = (opts: EnvelopeOpts): Adsr => new AdsrImpl(opts);\n\n/**\n * Creates and runs an envelope, sampling its values at `sampleRateMs`.\n * Note that if the envelope loops, iterator never returns.\n *\n * @example Init\n * ```js\n * import { Envelopes } from 'https://unpkg.com/ixfx/dist/modulation.js';\n * import { IterableAsync } from  'https://unpkg.com/ixfx/dist/util.js';\n *\n * const opts = {\n *  ...Envelopes.defaultAdsrOpts(),\n *  attackDuration: 1000,\n *  releaseDuration: 1000,\n *  sustainLevel: 1,\n *  attackBend: 1,\n *  decayBend: -1\n * };\n * ```\n *\n * @example Add data to array\n * ```js\n * // Sample an envelope every 20ms into an array\n * const data = await IterableAsync.toArray(Envelopes.adsrIterable(opts, 20));\n * ```\n *\n * @example Iterate with `for await`\n * ```js\n * // Work with values as sampled\n * for await (const v of Envelopes.adsrIterable(opts, 5)) {\n *  // Work with envelope value `v`...\n * }\n * ```\n * @param opts Envelope options\n * @param sampleRateMs Sample rate\n * @returns\n */\nexport async function* adsrIterable(\n  opts: AdsrIterableOpts\n): AsyncGenerator<number> {\n  const envelope = adsr(opts.env);\n  const sampleRateMs = opts.sampleRateMs ?? 100;\n  envelope.trigger();\n\n  for await (const v of interval<number>(\n    () => {\n      if (envelope.isDone) return;\n      return envelope.value;\n    },\n    {\n      fixed: sampleRateMs,\n      signal: opts.signal,\n    }\n  )) {\n    yield v;\n  }\n}\n\nexport type AdsrIterableOpts = {\n  readonly signal?: AbortSignal;\n  readonly sampleRateMs?: number;\n  readonly env: EnvelopeOpts;\n};\n\n// const iterableSwap = <V>() => {\n//   let current:AsyncIterableIterator<V>|IterableIterator<V>|undefined;\n\n//   const set = (it:AsyncIterableIterator<V>|IterableIterator<V>) => {\n//     current = it;\n//   }\n\n//   return {\n//     set,\n//     [Symbol.asyncIterator]() {\n//       return {\n//         async next() {\n//           if (!current) return { done: true, value: undefined};\n//           const v = await current.next();\n//           return { value: v.value, done: v.done };\n//         }\n//       };\n//     }}\n// }\n\n// export type IterableDrainOpts =  {\n//   minIntervalMs?:number\n// }\n// const iterableDrain = <V>(opts:IterableDrainOpts = {}) => {\n//   const minIntervalMs = opts.minIntervalMs ?? 0;\n\n//   const swap = iterableSwap<V>();\n//   const timer = continuously(() => {\n\n//   }, )\n//   const set = (it:AsyncIterableIterator<V>|IterableIterator<V>) => {\n//     swap.set(it);\n//   }\n\n// }\n\n// const delayedCount = delayIterable(count(5), { intervalMs: 500, delay: 'both'});\n// const i = interval(delayedCount, { minIntervalMs: 1500, delay: 'after'});\n// for await (const v of i) {\n//   console.log(v);\n// }\n// console.log('x test');\n// const xx = iterableSwap();\n\n// setInterval(async () => {\n//   for await (const v of xx) {\n//     console.log(`v: ${v}`);\n//   }\n//   console.log(`For await done`);\n// }, 1000);\n\n// xx.set(count(10, 1));\n// setTimeout(() => {\n//   xx.set(count(20, 2000));\n// }, 2000);\n","import { clamp } from '../data/Clamp.js';\nimport { type HasCompletion } from './index.js';\n/**\n * Creates a timer\n */\nexport type TimerSource = () => Timer;\n\n/**\n * A timer instance.\n * See {@link msElapsedTimer}, {@link ticksElapsedTimer}, {@link frequencyTimer}\n */\nexport type Timer = {\n  reset(): void;\n  get elapsed(): number;\n};\n\nexport type ModulationTimer = Timer & {\n  mod(amt: number): void;\n};\n\nexport type TimerOpts = {\n  /**\n   * Timer to use. By default {@link msElapsedTimer}.\n   */\n  readonly timer?: Timer;\n};\n\n/**\n * Options for relative timer\n */\nexport type RelativeTimerOpts = TimerOpts & {\n  /**\n   * If true, returned value will be clamped to 0..1. False by default\n   */\n  readonly clampValue?: boolean\n  readonly wrapValue?: boolean\n};\n\n/**\n * Returns a function that returns true if timer is complete\n *\n * ```js\n * const timer = hasElapsedMs(1000);\n * timer(); // Returns true if timer is done\n * ```\n *\n * See also {@link Elapsed.progress}.\n * @param totalMs\n * @returns\n */\nexport function hasElapsedMs(totalMs: number): () => boolean {\n  const t = relativeTimer(totalMs, { timer: msElapsedTimer() });\n  return () => t.isDone;\n}\n\nexport const frequencyTimerSource =\n  (frequency: number): TimerSource =>\n    () =>\n      frequencyTimer(frequency, { timer: msElapsedTimer() });\n\n/**\n * Wraps a timer, returning a relative elapsed value based on\n * a given total. ie. percentage complete toward a total duration.\n *\n * If no timer is specified, milliseconds-based timer is used.\n *\n * ```js\n * const t = relativeTimer(1000);\n * t.isDone;\n * t.reset();\n * t.elapsed;\n * ```\n *\n * With options\n * ```js\n * // Total duration of 1000 ticks\n * const t = relativeTimer(1000, { timer: ticksElapsedTimer(); clampValue:true });\n *\n * t.isDone;  // true if total has elapsed\n * t.reset(); // reset timer to 0\n * t.elapsed; // 0..1 scale of how close to completion\n * ```\n *\n * @private\n * @param total Total\n * @param opts Options\n * @returns Timer\n */\nexport const relativeTimer = (\n  total: number,\n  opts: RelativeTimerOpts = {}\n): ModulationTimer & HasCompletion => {\n  const timer = opts.timer ?? msElapsedTimer();\n  const clampValue = opts.clampValue ?? false;\n  const wrapValue = opts.wrapValue ?? false;\n  if (clampValue && wrapValue) throw new Error(`clampValue and wrapValue cannot both be enabled`);\n\n  //eslint-disable-next-line functional/no-let\n  let done = false;\n  //eslint-disable-next-line functional/no-let\n  let modulationAmount = 1;\n\n  return {\n    mod(amt: number) {\n      modulationAmount = amt;\n    },\n    get isDone() {\n      return done;\n    },\n    reset: () => {\n      done = false;\n      timer.reset();\n    },\n    get elapsed() {\n      //eslint-disable-next-line functional/no-let\n      let v = timer.elapsed / (total * modulationAmount);\n      if (clampValue) v = clamp(v);\n      else if (wrapValue) {\n        if (v >= 1) v = v % 1;\n      } else {\n        if (v >= 1) done = true;\n      }\n      return v;\n    },\n  };\n};\n\n/**\n * A timer based on frequency: cycles per unit of time. These timers return a number from\n * 0..1 indicating position with a cycle.\n *\n * In practice, timers are used to 'drive' something like an Oscillator.\n *\n * @example Init a spring oscillator, with a half a cycle per second\n * ```js\n * import { Oscillators } from \"https://unpkg.com/ixfx/dist/modulation.js\"\n * import { frequencyTimer } from \"https://unpkg.com/ixfx/dist/flow.js\"\n * Oscillators.spring({}, frequencyTimer(0.5));\n * ```\n *\n * By default it uses elapsed clock time as a basis for frequency. ie., cycles per second.\n *\n * It returns a `ModulationTimer`, which allows for a modulation amount to be continually applied\n * to the calculation of the 'position' within a cycle.\n *\n * @example Prints around 0/0.5 each second, as timer is half a cycle per second\n * ```js\n * import { frequencyTimer } from \"https://unpkg.com/ixfx/dist/flow.js\"\n * const t = frequencyTimer(0.5);\n * setInterval(() => {\n *  console.log(t.elapsed);\n * }, 1000);\n * ```\n * @param frequency\n * @param timer\n * @returns\n */\nexport const frequencyTimer = (\n  frequency: number,\n  opts: TimerOpts = {}\n): ModulationTimer => {\n  const timer = opts.timer ?? msElapsedTimer();\n  const cyclesPerSecond = frequency / 1000;\n  //eslint-disable-next-line functional/no-let\n  let modulationAmount = 1;\n  return {\n    mod: (amt: number) => {\n      modulationAmount = amt;\n    },\n    reset: () => {\n      timer.reset();\n    },\n    get elapsed() {\n      // Get position in a cycle\n      const v = timer.elapsed * (cyclesPerSecond * modulationAmount);\n\n      // Get fractional part\n      const f = v - Math.floor(v);\n      if (f < 0) {\n        throw new Error(\n          `Unexpected cycle fraction less than 0. Elapsed: ${ v } f: ${ f }`\n        );\n      }\n      if (f > 1) {\n        throw new Error(\n          `Unexpected cycle fraction more than 1. Elapsed: ${ v } f: ${ f }`\n        );\n      }\n      return f;\n    },\n  };\n};\n\n/**\n * A timer that uses clock time. Start time is from the point of invocation.\n *\n * ```js\n * const t = msElapsedTimer();\n * t.reset(); // reset start\n * t.elapsed; // ms since start\n * ```\n * @returns {Timer}\n * @see {ticksElapsedTimer}\n */\nexport const msElapsedTimer = (): Timer => {\n  // eslint-disable-next-line functional/no-let\n  let start = performance.now();\n  return {\n    reset: () => {\n      start = performance.now();\n    },\n    get elapsed() {\n      return performance.now() - start;\n    },\n  };\n};\n\n/**\n * A timer that progresses with each call to `elapsed`.\n *\n * The first call to elapsed will return 1.\n *\n * ```js\n * const timer = ticksElapsedTimer();\n * timer.reset(); // Reset to 0\n * timer.elapsed; // Number of ticks\n * ```\n * @returns {Timer}\n * @see {msElapsedTimer}\n */\nexport const ticksElapsedTimer = (): Timer => {\n  // eslint-disable-next-line functional/no-let\n  let start = 0;\n  return {\n    reset: () => {\n      start = 0;\n    },\n    get elapsed() {\n      return ++start;\n    },\n  };\n};\n","/**\n * Clamps a value between min and max (both inclusive)\n * Defaults to a 0-1 range, useful for percentages.\n *\n * @example Usage\n * ```js\n * // 0.5 - just fine, within default of 0 to 1\n * clamp(0.5);\n * // 1 - above default max of 1\n * clamp(1.5);\n * // 0 - below range\n * clamp(-50, 0, 100);\n * // 50 - within range\n * clamp(50, 0, 50);\n * ```\n *\n * For clamping integer ranges, consider {@link clampIndex }\n * For clamping `{ x, y }` points, consider {@link Geometry.Points.clamp | Geometry.Points.clamp}.\n * For clamping bipolar values: {@link Bipolar.clamp}\n * @param value Value to clamp\n * @param Minimum value (inclusive)\n * @param Maximum value (inclusive)\n * @returns Clamped value\n */\nexport const clamp = (value: number, min = 0, max = 1) => {\n  // ✔ UNIT TESTED\n  if (Number.isNaN(value)) throw new Error(`'value' parameter is NaN`);\n  if (Number.isNaN(min)) throw new Error(`'min' parameter is NaN`);\n  if (Number.isNaN(max)) throw new Error(`'max' parameter is NaN`);\n\n  if (value < min) return min;\n  if (value > max) return max;\n  return value;\n};\n\n/**\n * Clamps integer `v` between 0 (inclusive) and array length or length (exclusive).\n * Returns value then will always be at least zero, and a valid array index.\n *\n * @example Usage\n * ```js\n * // Array of length 4\n * const myArray = [`a`, `b`, `c`, `d`];\n * clampIndex(0, myArray);    // 0\n * clampIndex(4, myArray);    // 3\n * clampIndex(-1, myArray);   // 0\n *\n * clampIndex(5, 3); // 2\n * ```\n *\n * Throws an error if `v` is not an integer.\n *\n * For some data it makes sense that data might 'wrap around' if it exceeds the\n * range. For example rotation angle. Consider using {@link wrap} for this.\n *\n * @param v Value to clamp (must be an interger)\n * @param arrayOrLength Array, or length of bounds (must be an integer)\n * @returns Clamped value, minimum will be 0, maximum will be one less than `length`.\n */\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const clampIndex = (\n  v: number,\n  arrayOrLength: number | ReadonlyArray<any>\n): number => {\n  // ✔ UNIT TESTED\n  if (!Number.isInteger(v)) {\n    throw new TypeError(`v parameter must be an integer (${ v })`);\n  }\n  const length = Array.isArray(arrayOrLength)\n    ? arrayOrLength.length\n    : (arrayOrLength as number);\n\n  if (!Number.isInteger(length)) {\n    throw new TypeError(\n      `length parameter must be an integer (${ length }, ${ typeof length })`\n    );\n  }\n  v = Math.round(v);\n  if (v < 0) return 0;\n  if (v >= length) return length - 1;\n  return v;\n};\n","import { Lines, Beziers, Rects, Points } from './index.js';\n\n//eslint-disable-next-line  functional/no-mixed-type\nexport type Path = {\n  length():number\n/**\n   * Returns a point at a relative (0.0-1.0) position along the path\n   *\n   * @param {number} t Relative position (0.0-1.0)\n   * @returns {Point} Point\n   */\n  interpolate(t:number):Points.Point\n  bbox():Rects.RectPositioned\n  /**\n   * Returns the nearest point on path to `point`\n   * @param point \n   */\n  nearest(point:Points.Point):Points.Point\n  toString():string\n  toSvgString():readonly string[]\n  readonly kind:`compound` | `elliptical` | `circular` | `arc` | `bezier/cubic` | `bezier/quadratic` | `line`\n}\n/**\n * Return the start point of a path\n *\n * @param path\n * @return Point\n */\nexport const getStart = function (path:Path):Points.Point {\n  if (Beziers.isQuadraticBezier(path)) return path.a;\n  else if (Lines.isLine(path)) return path.a;\n  else throw new Error(`Unknown path type ${JSON.stringify(path)}`);\n};\n\n/**\n * Return the end point of a path\n *\n * @param path\n * @return Point\n */\nexport const getEnd = function (path:Path):Points.Point {\n  if (Beziers.isQuadraticBezier(path)) return path.b;\n  else if (Lines.isLine(path)) return path.b;\n  else throw new Error(`Unknown path type ${JSON.stringify(path)}`);\n};\n\nexport type WithBeziers = {\n  //eslint-disable-next-line  functional/no-method-signature\n  getBeziers():readonly Path[]\n};","import * as Arcs from './Arc.js';\nimport * as Beziers from './Bezier.js';\nimport * as Circles from './Circle.js';\nimport * as Compound from './CompoundPath.js';\nimport * as Grids from './Grid.js';\nimport * as Lines from './Line.js';\nimport * as Paths from './Path.js';\nimport * as Points from './Point.js';\nimport * as Rects from './Rect.js';\nimport * as Ellipses from './Ellipse.js';\nimport * as Shapes from './Shape.js';\nimport * as Vectors from './Vector.js';\nimport * as Waypoints from './Waypoint.js';\nimport * as Spheres from './Sphere.js';\nimport * as Polar from './Polar.js';\nimport * as Layouts from './Layout.js';\n\nexport { Circles, Lines, Rects, Points, Paths, Grids, Beziers, Compound, Ellipses,  Waypoints, Spheres };\nexport { Layouts };\n\n/**\n * Quad tree is a datastructure for efficiently determining whether\n * a point/shape is at a location\n * - {@link quadTree}: Create a quad tree\n */\nexport * as QuadTree from './QuadTree.js';\n\nexport * as Scaler from './Scaler.js';\nexport * as Convolve2d from './Convolve2d.js';\n\n/**\n * Work with arcs. Arcs are a angle-limited circle, describing a wedge.\n * \n * {@link ArcPositioned} has a origin x,y.\n * \n * Conversions:\n * - {@link fromDegrees}\n * - {@link toLine}: A line from start/end position of arc\n * - {@link toSvg}: Returns an SVG representation of arc\n * \n * Calculations:\n * - {@link bbox}: Bounding box\n * - {@link interpolate}: Interplate two arcs\n * - {@link point}: Find a point on the arc, given an angle\n * - {@link length}: Circumference of arc\n * \n * Comparisons:\n * - {@link isArc}: Returns true if object is Arc-ish\n * - {@link isEqual}: Returns true if two objects have identical arc properties\n */\nexport { Arcs };\n\n/**\n * Generate a few basic geometric shapes\n * Overview:\n * * {@link arrow}\n * * {@link starburst}\n */\nexport { Shapes };\n\n/**\n * Helper functions for working with vectors, which can either be a {@link Points.Point} or Polar {@link Polar.Coord}.\n * While most of the functionality is provided in either of those modules, the Vector module lets you cleanly\n * interoperate between these two coordinates.\n */\nexport { Vectors };\n\n/**\n * Work with Polar coordinates.\n * A Polar {@link Coord} is just `{ angleRadians:number, distance: number }`.\n * \n * Conversion: {@link toCartesian}, {@link fromCartesian}, {@link toString}\n * \n * Math: {@link divide}, {@link invert}, {@link multiply}, {@link dotProduct}\n * \n * Geometric manipulations: {@link rotate}, {@link rotateDegrees}\n * \n * Cleaning: {@link clampMagnitude}, {@link normalise}\n * \n * Debugging: {@link toString}\n * \n * Comparisons: {@link isAntiParallel}, {@link isOpposite}, {@link isParallel}, {@link isCoord}\n */\nexport { Polar };\n\n/**\n * Functions for producing points within a shape.\n * Useful for creating patterns.\n * \n * Overview:\n * * {@link sphereFibonacci}: Generate points on a sphere\n * * {@link circleVogelSpiral}: Generate a sunflower-esque pattern of points in a circle \n */\nexport * as SurfacePoints from './SurfacePoints.js';\n\n/**\n * Triangle processing.\n * \n * Helpers for creating:\n * - {@link Triangles.fromFlatArray}: Create from `[ x1, y1, x2, y2, x3, y3 ]`\n * - {@link Triangles.fromPoints}: Create from three `{ x, y }` sets\n * - {@link Triangles.fromRadius}: Equilateral triangle of a given radius and center\n * \n * There are sub-modules for dealing with particular triangles:\n * - {@link Triangles.Equilateral}: Equilateral triangls\n * - {@link Triangles.Right}: Right-angled triangles\n * - {@link Triangles.Isosceles}: Iscosceles triangles\n * \n * Calculations\n * - {@link angles}: Internal angles in radians. {@link anglesDegrees} for degrees. \n * - {@link area}: Area of triangle\n * - {@link bbox}: Bounding box\n * - {@link centroid}: Centroid of triangle\n * - {@link perimeter}: Calculate perimeter\n * - {@link lengths}: Return array lengths of triangle's edges\n * - {@link rotate}, {@link rotateByVertex}\n * \n * Conversions\n * - {@link edges}: Edges of triangle as {@link Lines.Line}\n * - {@link corners}: Corner positions\n * - {@link innerCircle}: Largest circle to fit within triangle\n * - {@link outerCircle}: Largest circle to enclose triangle\n * - {@link toFlatArray}\n * \n * Comparisons\n * - {@link intersectsPoint}: Whether a point intersects triangle\n * - {@link isEqual}: Check whether two triangles have equal values\n * - {@link isAcute}, {@link isEquilateral}, {@link isIsosceles}, {@link isRightAngle}\n * - {@link isTriangle}: Returns true if object has expected properties of a triangle\n */\nexport * as Triangles from './Triangle.js';\n\n/**\n * Convert angle in degrees to angle in radians.\n * @param angleInDegrees \n * @returns \n */\nexport function degreeToRadian(angleInDegrees:number):number;\n\n/**\n * Convert angles in degrees to angles in radians\n * @param angleInDegrees \n */\nexport function degreeToRadian(angleInDegrees:readonly number[]):readonly number[];\n\n//eslint-disable-next-line func-style\nexport function degreeToRadian(angleInDegrees:number|readonly number[]):number|readonly number[] {\n  if (Array.isArray(angleInDegrees)) {\n    return angleInDegrees.map(v => v * (Math.PI / 180.0));\n  } else {\n    return (angleInDegrees as number) * (Math.PI / 180.0);\n  }\n}\n\n/**\n * Convert angle in radians to angle in degrees\n * @param angleInRadians\n * @returns \n */\nexport function radianToDegree(angleInRadians:number):number;\n\n/**\n * Convert angles in radians to angles in degrees\n * @param angleInRadians \n */\nexport function radianToDegree(angleInRadians:readonly number[]):readonly number[];\n\n//eslint-disable-next-line func-style\nexport function radianToDegree(angleInRadians:number|readonly number[]):number| readonly number[] {\n  if (Array.isArray(angleInRadians)) {\n    return angleInRadians.map(v => v * 180 / Math.PI);\n  } else {\n    return (angleInRadians as number) * 180 / Math.PI;\n  }\n}\n\n/**\n * Angle from x-axis to point (ie. `Math.atan2`)\n * @param point \n * @returns \n */\nexport const radiansFromAxisX = (point:Points.Point):number => Math.atan2(point.x, point.y);\n\ntry {\n  if (typeof window !== `undefined`) {\n    //eslint-disable-next-line functional/immutable-data,@typescript-eslint/no-explicit-any\n    (window as any).ixfx = { ...(window as any).ixfx, Geometry: { Circles, Arcs, Lines, Rects, Points, Paths, Grids, Beziers, Compound, Ellipses, Polar, Shapes, radiansFromAxisX, radianToDegree, degreeToRadian } };\n  }\n} catch { /* no-op */ }","import {degreeToRadian, Polar} from './index.js';\nimport {guard as guardPoint, isPoint} from './Point.js';\nimport {type Path} from './Path.js';\nimport {Lines, Points, Rects} from './index.js';\n\n/**\n * Returns true if parameter is an arc\n * @param p Arc or number\n * @returns \n */\nexport const isArc = (p: Arc | number | unknown): p is Arc => (p as Arc).startRadian !== undefined && (p as Arc).endRadian !== undefined;\n\n/**\n * Returns true if parameter has a positioned (x,y) \n * @param p Point, Arc or ArcPositiond\n * @returns \n */\nexport const isPositioned = (p: Points.Point | Arc | ArcPositioned): p is Points.Point => (p as Points.Point).x !== undefined && (p as Points.Point).y !== undefined;\n\n/**\n * Arc, defined by radius, start and end point in radians, and whether it is counter-clockwise.\n */\nexport type Arc = {\n  /**\n   * Radius of arc\n   */\n  readonly radius: number\n  /**\n   * Start radian\n   */\n  readonly startRadian: number\n  /**\n   * End radian\n   */\n  readonly endRadian: number\n  /**\n   * If true, arc is counter-clockwise\n   */\n  readonly counterClockwise?: boolean\n}\n\n/**\n * An {@link Geometry.Arcs.Arc} that also has a position, given in x, y\n */\nexport type ArcPositioned = Points.Point & Arc;\n\nconst piPi = Math.PI * 2;\n\n/**\n * Returns an arc from degrees, rather than radians\n * @param radius Radius of arc\n * @param startDegrees Start angle in degrees\n * @param endDegrees End angle in degrees\n * @param origin Optional center of arc\n * @returns Arc\n */\nexport function fromDegrees(radius: number, startDegrees: number, endDegrees: number): Arc;\nexport function fromDegrees(radius: number, startDegrees: number, endDegrees: number, origin: Points.Point): ArcPositioned\n\n//eslint-disable-next-line func-style\nexport function fromDegrees(radius: number, startDegrees: number, endDegrees: number, origin?: Points.Point): Arc | ArcPositioned {\n  const a: Arc = {\n    radius,\n    startRadian: degreeToRadian(startDegrees),\n    endRadian: degreeToRadian(endDegrees)\n  };\n  if (isPoint(origin)) {\n    guardPoint(origin);\n    const ap: ArcPositioned = {\n      ...a,\n      x: origin.x,\n      y: origin.y\n    };\n    return Object.freeze(ap);\n  } else {\n    return Object.freeze(a);\n  }\n}\n\n/**\n * Returns a {@link Geometry.Lines.Line} linking the start and end points of an {@link ArcPositioned}.\n *\n * @param arc\n * @returns Line from start to end of arc\n */\nexport const toLine = (arc: ArcPositioned): Lines.Line => Lines.fromPoints(\n  point(arc, arc.startRadian),\n  point(arc, arc.endRadian)\n);\n\n/**\n * Calculates a coordinate on an arc, based on an angle\n * @param arc Arc\n * @param angleRadian Angle of desired coordinate \n * @param origin Origin of arc (0,0 used by default)\n * @returns Coordinate\n */\nexport const point = (arc: Arc | ArcPositioned, angleRadian: number, origin?: Points.Point): Points.Point => {\n  if (angleRadian > arc.endRadian) throw new Error(`angleRadian beyond end angle of arc`);\n  if (angleRadian < arc.startRadian) throw new Error(`angleRadian beyond start angle of arc`);\n\n  if (origin === undefined) {\n    if (isPositioned(arc)) {\n      origin = arc;\n    } else {\n      origin = {x: 0, y: 0};\n    }\n  }\n  return {\n    x: (Math.cos(angleRadian) * arc.radius) + origin.x,\n    y: (Math.sin(angleRadian) * arc.radius) + origin.y\n  };\n};\n\n/**\n * Throws an error if arc instance is invalid\n * @param arc \n */\nexport const guard = (arc: Arc | ArcPositioned) => {\n  if (arc === undefined) throw new Error(`Arc is undefined`);\n  if (isPositioned(arc)) {\n    guardPoint(arc, `arc`);\n  }\n  if (arc.radius === undefined) throw new Error(`Arc radius is undefined (${JSON.stringify(arc)})`);\n  if (typeof arc.radius !== `number`) throw new Error(`Radius must be a number`);\n  if (Number.isNaN(arc.radius)) throw new Error(`Radius is NaN`);\n  if (arc.radius <= 0) throw new Error(`Radius must be greater than zero`);\n\n  if (arc.startRadian === undefined) throw new Error(`Arc is missing 'startRadian' field`);\n  if (arc.endRadian === undefined) throw new Error(`Arc is missing 'startRadian' field`);\n  if (Number.isNaN(arc.endRadian)) throw new Error(`Arc endRadian is NaN`);\n  if (Number.isNaN(arc.startRadian)) throw new Error(`Arc endRadian is NaN`);\n\n  if (arc.startRadian >= arc.endRadian) throw new Error(`startRadian is expected to be les than endRadian`);\n};\n\n\ntype Interpolate = {\n  (amount: number, arc: Arc, origin: Points.Point): Points.Point;\n  (amount: number, arc: ArcPositioned): Points.Point;\n};\n\n/**\n * Compute relative position on arc\n * @param arc Arc\n * @param amount Relative position 0-1\n * @param origin If arc is not positioned, pass in an origin\n * @returns \n */\nexport const interpolate: Interpolate = (amount: number, arc: ArcPositioned | Arc, origin?: Points.Point): Points.Point => {\n  guard(arc);\n  return point(arc, arc.startRadian + ((arc.endRadian - arc.startRadian) * amount), origin);\n};\n\n/**\n * Creates a {@link Geometry.Paths.Path} instance from the arc. This wraps up some functions for convienence.\n * @param arc \n * @returns Path\n */\nexport const toPath = (arc: ArcPositioned): Path => {\n  guard(arc);\n\n  return Object.freeze({\n    ...arc,\n    nearest: (point: Points.Point) => {throw new Error(`not implemented`);},\n    interpolate: (amount: number) => interpolate(amount, arc),\n    bbox: () => bbox(arc) as Rects.RectPositioned,\n    length: () => length(arc),\n    toSvgString: () => toSvg(arc),\n    kind: `arc`\n  });\n};\n\n/**\n * Calculates the length of the arc\n * @param arc \n * @returns Length\n */\nexport const length = (arc: Arc): number => piPi * arc.radius * ((arc.startRadian - arc.endRadian) / piPi);\n\n/**\n * Calculates a {@link Geometry.Rects.Rect | Rect} bounding box for arc.\n * @param arc \n * @returns Rectangle encompassing arc.\n */\nexport const bbox = (arc: ArcPositioned | Arc): Rects.RectPositioned | Rects.Rect => {\n  if (isPositioned(arc)) {\n    const middle = interpolate(0.5, arc);\n    const asLine = toLine(arc);\n    return Points.bbox(middle, asLine.a, asLine.b);\n  } else {\n    return {\n      width: arc.radius * 2,\n      height: arc.radius * 2\n    };\n  }\n};\n\n\ntype ToSvg = {\n  /**\n   * SVG path for arc description\n   * @param origin Origin of arc\n   * @param radius Radius\n   * @param startRadian Start\n   * @param endRadian End\n   */\n  (origin: Points.Point, radius: number, startRadian: number, endRadian: number, opts?: SvgOpts): readonly string[];\n  /**\n   * SVG path for non-positioned arc\n   */\n  (arc: Arc, origin: Points.Point, opts?: SvgOpts): readonly string[];\n  /**\n   * SVG path for positioned arc\n   */\n  (arc: ArcPositioned, opts?: SvgOpts): readonly string[];\n};\n\n\n/**\n * Creates an SV path snippet for arc\n * @returns \n */\nexport const toSvg: ToSvg = (a: Points.Point | Arc | ArcPositioned, b?: number | Points.Point | SvgOpts, c?: number | SvgOpts, d?: number, e?: SvgOpts) => {\n  if (isArc(a)) {\n    if (isPositioned(a)) {\n      return toSvgFull(a, a.radius, a.startRadian, a.endRadian, b as SvgOpts);\n    } else {\n      if (isPoint(b)) {\n        return toSvgFull(b, a.radius, a.startRadian, a.endRadian, c as SvgOpts);\n      } else {\n        return toSvgFull({x: 0, y: 0}, a.radius, a.startRadian, a.endRadian);\n      }\n    }\n  } else {\n    if (c === undefined) throw new Error(`startAngle undefined`);\n    if (d === undefined) throw new Error(`endAngle undefined`);\n\n    if (isPoint(a)) {\n      if (typeof b === `number` && typeof c === `number` && typeof d === `number`) {\n        return toSvgFull(a, b, c, d, e);\n      } else {\n        throw new Error(`Expected (point, number, number, number). Missing a number param.`);\n      }\n    } else {\n      throw new Error(`Expected (point, number, number, number). Missing first point.`);\n    }\n  }\n};\n\nexport type SvgOpts = {\n\n  /**\n   * \"If the arc should be greater or less than 180 degrees\"\n   * ie. tries to maximise arc length\n   */\n  readonly largeArc?: boolean\n\n  /**\n   * \"If the arc should begin moving at positive angles\"\n   * ie. the kind of bend it makes to reach end point\n   */\n  readonly sweep?: boolean\n}\n\nconst toSvgFull = (origin: Points.Point, radius: number, startRadian: number, endRadian: number, opts?: SvgOpts): readonly string[] => {\n  // https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths\n  // A rx ry x-axis-rotation large-arc-flag sweep-flag x y\n  // a rx ry x-axis-rotation large-arc-flag sweep-flag dx dy\n\n  if (opts === undefined || typeof opts !== `object`) opts = {};\n\n  const isFullCircle = endRadian - startRadian === 360;\n  const start = Polar.toCartesian(radius, endRadian - 0.01, origin);\n  const end = Polar.toCartesian(radius, startRadian, origin);\n\n  const {largeArc = false, sweep = false} = opts;\n\n  const d = [`\n    M ${start.x} ${start.y}\n    A ${radius} ${radius} 0 ${largeArc ? `1` : `0`} ${sweep ? `1` : `0`} ${end.x} ${end.y},\n  `];\n\n  //eslint-disable-next-line functional/immutable-data\n  if (isFullCircle) d.push(`z`);\n\n  return d;\n};\n\n/**\n * Calculates the distance between the centers of two arcs\n * @param a\n * @param b \n * @returns Distance \n */\nexport const distanceCenter = (a: ArcPositioned, b: ArcPositioned): number => Points.distance(a, b);\n\n/**\n * Returns true if the two arcs have the same values\n *\n * ```js\n * const arcA = { radius: 5, endRadian: 0, startRadian: 1 };\n * const arcA = { radius: 5, endRadian: 0, startRadian: 1 };\n * arcA === arcB; // false, because object identities are different\n * Arcs.isEqual(arcA, arcB); // true, because values are identical\n * ```\n * @param a\n * @param b\n * @returns {boolean}\n */\nexport const isEqual = (a: Arc | ArcPositioned, b: Arc | ArcPositioned): boolean => {\n  if (a.radius !== b.radius) return false;\n\n  if (isPositioned(a) && isPositioned(b)) {\n    if (a.x !== b.x) return false;\n    if (a.y !== b.y) return false;\n    if (a.z !== b.z) return false;\n    return true;\n  } else if (!isPositioned(a) && !isPositioned(b)) {\n    // no-op\n  } else return false; // one is positioned one not\n\n  if (a.endRadian !== b.endRadian) return false;\n  if (a.startRadian !== b.startRadian) return false;\n  return true;\n};","import { Circles, Lines, Points, Polar, Rects } from './index.js';\nimport { interpolate as lineInterpolate } from './Line.js';\nimport { throwNumberTest } from '../Guards.js';\nimport { clamp as clampNumber, wrap as wrapNumber } from '../data/index.js';\nimport { Arrays } from '../collections/index.js';\nimport { type RandomSource, defaultRandom } from '../Random.js';\nimport { quantiseEvery as quantiseEveryNumber, round as roundNumber } from '../Numbers.js';\n/**\n * A point, consisting of x, y and maybe z fields.\n */\nexport type Point = {\n  readonly x: number;\n  readonly y: number;\n  readonly z?: number;\n};\n\nexport type Point3d = Point & {\n  readonly z: number;\n};\n\n/**\n * Returns a Point form of either a point, x,y params or x,y,z params.\n * If parameters are undefined, an empty point is returned (0, 0)\n * @ignore\n * @param a\n * @param b\n * @returns\n */\nexport function getPointParameter(\n  //eslint-disable-next-line functional/prefer-readonly-type\n  a?: Point | number | Array<number> | ReadonlyArray<number>,\n  b?: number | boolean,\n  c?: number\n): Point | Point3d {\n  if (a === undefined) return { x: 0, y: 0 };\n\n  if (Array.isArray(a)) {\n    if (a.length === 0) return Object.freeze({ x: 0, y: 0 });\n    if (a.length === 1) return Object.freeze({ x: a[ 0 ], y: 0 });\n    if (a.length === 2) return Object.freeze({ x: a[ 0 ], y: a[ 1 ] });\n    if (a.length === 3) return Object.freeze({ x: a[ 0 ], y: a[ 1 ], z: a[ 2 ] });\n    throw new Error(\n      `Expected array to be 1-3 elements in length. Got ${ a.length }.`\n    );\n  }\n\n  if (Points.isPoint(a)) {\n    return a;\n  } else if (typeof a !== `number` || typeof b !== `number`) {\n    throw new TypeError(\n      `Expected point or x,y as parameters. Got: a: ${ JSON.stringify(\n        a\n      ) } b: ${ JSON.stringify(b) }`\n    );\n  }\n\n  // x,y,z\n  if (typeof c === `number`) {\n    return Object.freeze({ x: a, y: b, z: c });\n  }\n  // x,y\n  return Object.freeze({ x: a, y: b });\n}\n\nexport const dotProduct = (...pts: ReadonlyArray<Point>): number => {\n  const a = pts.map(p => Points.toArray(p));\n  return Arrays.dotProduct(a);\n};\n\n/**\n * An empty point of `{ x:0, y:0 }`.\n *\n * Use `isEmpty` to check if a point is empty.\n */\n//eslint-disable-next-line @typescript-eslint/naming-convention\nexport const Empty = Object.freeze({ x: 0, y: 0 });\n\n/**\n * Placeholder point, where x and y is `NaN`.\n * Use `isPlaceholder` to check if a point is a placeholder.\n */\n//eslint-disable-next-line @typescript-eslint/naming-convention\nexport const Placeholder = Object.freeze({ x: Number.NaN, y: Number.NaN });\n\n/**\n * Returns true if both x and y is 0.\n * Use `Points.Empty` to return an empty point.\n * @param p\n * @returns\n */\nexport const isEmpty = (p: Point) => p.x === 0 && p.y === 0;\n\n/**\n * Returns true if point is a placeholder, where both x and y\n * are `NaN`.\n *\n * Use Points.Placeholder to return a placeholder point.\n * @param p\n * @returns\n */\nexport const isPlaceholder = (p: Point) =>\n  Number.isNaN(p.x) && Number.isNaN(p.y);\n\n/**\n * Returns true if p.x and p.y === null\n * @param p\n * @returns\n */\nexport const isNull = (p: Point) => p.x === null && p.y === null;\n\n/***\n * Returns true if p.x or p.y isNaN\n */\nexport const isNaN = (p: Point) => Number.isNaN(p.x) || Number.isNaN(p.y);\n/**\n * Returns the 'minimum' point from an array of points, using a comparison function.\n *\n * @example Find point closest to a coordinate\n * ```js\n * const points = [...];\n * const center = {x: 100, y: 100};\n *\n * const closestToCenter = findMinimum((a, b) => {\n *  const aDist = distance(a, center);\n *  const bDist = distance(b, center);\n *  if (aDistance < bDistance) return a;\n *  return b;\n * }, points);\n * ```\n * @param comparer Compare function returns the smallest of `a` or `b`\n * @param points\n * @returns\n */\nexport const findMinimum = (\n  comparer: (a: Point, b: Point) => Point,\n  ...points: ReadonlyArray<Point>\n): Point => {\n  if (points.length === 0) throw new Error(`No points provided`);\n  //eslint-disable-next-line functional/no-let\n  let min = points[ 0 ];\n  for (const p of points) {\n    min = comparer(min, p);\n  }\n  return min;\n};\n\n/**\n * Returns the left-most of the provided points.\n *\n * Same as:\n * ```js\n * findMinimum((a, b) => {\n *  if (a.x <= b.x) return a;\n *  return b;\n *}, ...points)\n * ```\n *\n * @param points\n * @returns\n */\nexport const leftmost = (...points: ReadonlyArray<Point>): Point =>\n  findMinimum((a, b) => (a.x <= b.x ? a : b), ...points);\n\n/**\n * Returns the right-most of the provided points.\n *\n * Same as:\n * ```js\n * findMinimum((a, b) => {\n *  if (a.x >= b.x) return a;\n *  return b;\n *}, ...points)\n * ```\n *\n * @param points\n * @returns\n */\nexport const rightmost = (...points: ReadonlyArray<Point>): Point =>\n  findMinimum((a, b) => (a.x >= b.x ? a : b), ...points);\n\nexport function distance(a: Point, b?: Point): number;\nexport function distance(a: Point, x: number, y: number): number;\n//export function distance(a: Point): number;\n\n\n/**\n * Calculate distance between two points.\n *\n * ```js`\n * // Distance between two points\n * const ptA = { x: 0.5, y:0.8 };\n * const ptB = { x: 1, y: 0.4 };\n * distance(ptA, ptB);\n * // Or, provide x,y as parameters\n * distance(ptA, 0.4, 0.9);\n *\n * // Distance from ptA to x: 0.5, y:0.8, z: 0.1\n * const ptC = { x: 0.5, y:0.5, z: 0.3 };\n * // With x,y,z as parameters:\n * distance(ptC, 0.5, 0.8, 0.1);\n * ``\n * @param a First point\n * @param xOrB Second point, or x coord\n * @param y y coord, if x coord is given\n * @param z Optional z coord, if x and y are given.\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function distance(\n  a: Point | Point3d,\n  xOrB?: Point | Point3d | number,\n  y?: number,\n  z?: number\n): number {\n  const pt = getPointParameter(xOrB, y, z);\n  guard(pt, `b`);\n  guard(a, `a`);\n  return isPoint3d(pt) && isPoint3d(a) ? Math.hypot(pt.x - a.x, pt.y - a.y, pt.z - a.z) : Math.hypot(pt.x - a.x, pt.y - a.y);\n}\n\n/**\n * Returns the distance from point `a` to the exterior of `shape`.\n *\n * @example Distance from point to rectangle\n * ```\n * const distance = distanceToExterior(\n *  {x: 50, y: 50},\n *  {x: 100, y: 100, width: 20, height: 20}\n * );\n * ```\n *\n * @example Find closest shape to point\n * ```\n * import {minIndex} from '../collections/arrays.js';\n * const shapes = [ some shapes... ]; // Shapes to compare against\n * const pt = { x: 10, y: 10 };       // Comparison point\n * const distances = shapes.map(v => distanceToExterior(pt, v));\n * const closest = shapes[minIndex(...distances)];\n * ```\n * @param a Point\n * @param shape Point, or a positioned Rect or Circle.\n * @returns\n */\nexport const distanceToExterior = (\n  a: Point,\n  shape: PointCalculableShape\n): number => {\n  if (Rects.isRectPositioned(shape)) {\n    return Rects.distanceFromExterior(shape, a);\n  }\n  if (Circles.isCirclePositioned(shape)) {\n    return Circles.distanceFromExterior(shape, a);\n  }\n  if (isPoint(shape)) return distance(a, shape);\n  throw new Error(`Unknown shape`);\n};\n\n/**\n * Returns the distance from point `a` to the center of `shape`.\n * @param a Point\n * @param shape Point, or a positioned Rect or Circle.\n * @returns\n */\nexport const distanceToCenter = (\n  a: Point,\n  shape: PointCalculableShape\n): number => {\n  if (Rects.isRectPositioned(shape)) {\n    return Rects.distanceFromExterior(shape, a);\n  }\n  if (Circles.isCirclePositioned(shape)) {\n    return Circles.distanceFromExterior(shape, a);\n  }\n  if (isPoint(shape)) return distance(a, shape);\n  throw new Error(`Unknown shape`);\n};\n\nexport type PointCalculableShape =\n  | Lines.PolyLine\n  | Lines.Line\n  | Rects.RectPositioned\n  | Point\n  | Circles.CirclePositioned;\n\n/**\n * Throws an error if point is invalid\n * @param p\n * @param name\n */\nexport function guard(p: Point, name = `Point`) {\n  if (p === undefined) {\n    throw new Error(\n      `'${ name }' is undefined. Expected {x,y} got ${ JSON.stringify(p) }`\n    );\n  }\n  if (p === null) {\n    throw new Error(\n      `'${ name }' is null. Expected {x,y} got ${ JSON.stringify(p) }`\n    );\n  }\n  if (p.x === undefined) {\n    throw new Error(\n      `'${ name }.x' is undefined. Expected {x,y} got ${ JSON.stringify(p) }`\n    );\n  }\n  if (p.y === undefined) {\n    throw new Error(\n      `'${ name }.y' is undefined. Expected {x,y} got ${ JSON.stringify(p) }`\n    );\n  }\n  if (typeof p.x !== `number`) {\n    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n    throw new TypeError(`'${ name }.x' must be a number. Got ${ p.x }`);\n  }\n  if (typeof p.y !== `number`) {\n    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n    throw new TypeError(`'${ name }.y' must be a number. Got ${ p.y }`);\n  }\n\n  if (p.x === null) throw new Error(`'${ name }.x' is null`);\n  if (p.y === null) throw new Error(`'${ name }.y' is null`);\n\n  if (Number.isNaN(p.x)) throw new Error(`'${ name }.x' is NaN`);\n  if (Number.isNaN(p.y)) throw new Error(`'${ name }.y' is NaN`);\n}\n\n/**\n * Throws if parameter is not a valid point, or either x or y is 0\n * @param pt\n * @returns\n */\nexport const guardNonZeroPoint = (pt: Point | Point3d, name = `pt`) => {\n  guard(pt, name);\n  throwNumberTest(pt.x, `nonZero`, `${ name }.x`);\n  throwNumberTest(pt.y, `nonZero`, `${ name }.y`);\n  if (typeof pt.z !== `undefined`) {\n    throwNumberTest(pt.z, `nonZero`, `${ name }.z`);\n  }\n\n  return true;\n};\n\n/**\n * Returns a point with Math.abs applied to x and y.\n * ```js\n * Points.abs({ x:1,  y:1  }); // { x: 1, y: 1 }\n * Points.abs({ x:-1, y:1  }); // { x: 1, y: 1 }\n * Points.abs({ x:-1, y:-1 }); // { x: 1, y: 1 }\n * ```\n * @param pt\n * @returns\n */\nexport const abs = (pt: Point) => ({\n  ...pt,\n  x: Math.abs(pt.x),\n  y: Math.abs(pt.y),\n});\n\n/**\n * Returns the angle in radians between `a` and `b`.\n *\n * Eg if `a` is the origin, and `b` is another point,\n * in degrees one would get 0 to -180 when `b` was above `a`.\n *  -180 would be `b` in line with `a`.\n * Same for under `a`.\n *\n * Providing a third point `c` gives the interior angle, where `b` is the middle point.\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport const angle = (a: Point, b?: Point, c?: Point) => {\n  guard(a, `a`);\n\n  if (b === undefined) {\n    return Math.atan2(a.y, a.x);\n  }\n  guard(b, `b`);\n  if (c === undefined) {\n    return Math.atan2(b.y - a.y, b.x - a.x);\n  }\n\n  guard(c, `c`);\n  return Math.atan2(b.y - a.y, b.x - a.x) - Math.atan2(c.y - a.y, c.x - a.x);\n};\n\n/**\n * Calculates the [centroid](https://en.wikipedia.org/wiki/Centroid#Of_a_finite_set_of_points) of a set of points\n * Undefined values are skipped over.\n *\n * ```js\n * // Find centroid of a list of points\n * const c1 = centroid(p1, p2, p3, ...);\n *\n * // Find centroid of an array of points\n * const c2 = centroid(...pointsArray);\n * ```\n * @param points\n * @returns A single point\n */\nexport const centroid = (...points: ReadonlyArray<Point | undefined>): Point => {\n  if (!Array.isArray(points)) throw new Error(`Expected list of points`);\n  // eslint-disable-next-line unicorn/no-array-reduce\n  const sum = points.reduce<Point>(\n    (previous, p) => {\n      if (p === undefined) return previous; // Ignore undefined\n      if (Array.isArray(p)) {\n        throw new TypeError(\n          `'points' list contains an array. Did you mean: centroid(...myPoints)?`\n        );\n      }\n      if (!isPoint(p)) {\n        throw new Error(\n          `'points' contains something which is not a point: ${ JSON.stringify(\n            p\n          ) }`\n        );\n      }\n      return {\n        x: previous.x + p.x,\n        y: previous.y + p.y,\n      };\n    },\n    { x: 0, y: 0 }\n  );\n\n  return Object.freeze({\n    x: sum.x / points.length,\n    y: sum.y / points.length,\n  });\n};\n\n/**\n * Returns the minimum rectangle that can enclose all provided points\n * @param points\n * @returns\n */\nexport const bbox = (...points: ReadonlyArray<Point>): Rects.RectPositioned => {\n  const leftMost = findMinimum((a, b) => {\n    return a.x < b.x ? a : b;\n  }, ...points);\n  const rightMost = findMinimum((a, b) => {\n    return a.x > b.x ? a : b;\n  }, ...points);\n  const topMost = findMinimum((a, b) => {\n    return a.y < b.y ? a : b;\n  }, ...points);\n  const bottomMost = findMinimum((a, b) => {\n    return a.y > b.y ? a : b;\n  }, ...points);\n\n  const topLeft = { x: leftMost.x, y: topMost.y };\n  const topRight = { x: rightMost.x, y: topMost.y };\n  const bottomRight = { x: rightMost.x, y: bottomMost.y };\n  const bottomLeft = { x: leftMost.x, y: bottomMost.y };\n  return Rects.maxFromCorners(topLeft, topRight, bottomRight, bottomLeft);\n};\n\n/**\n * Returns _true_ if the parameter has x and y fields\n * @param p\n * @returns\n */\n// eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\nexport function isPoint(p: number | unknown): p is Point {\n  if (p === undefined) return false;\n  if (p === null) return false;\n  if ((p as Point).x === undefined) return false;\n  if ((p as Point).y === undefined) return false;\n  return true;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-redundant-type-constituents\nexport const isPoint3d = (p: Point | unknown): p is Point3d => {\n  if (p === undefined) return false;\n  if (p === null) return false;\n  if ((p as Point3d).x === undefined) return false;\n  if ((p as Point3d).y === undefined) return false;\n  if ((p as Point3d).z === undefined) return false;\n  return true;\n};\n\n/**\n * Returns point as an array in the form [x,y]. This can be useful for some libraries\n * that expect points in array form.\n *\n * ```\n * const p = {x: 10, y:5};\n * const p2 = toArray(p); // yields [10,5]\n * ```\n * @param p\n * @returns\n */\nexport const toArray = (p: Point): ReadonlyArray<number> => [ p.x, p.y ];\n\n/**\n * Returns a human-friendly string representation `(x, y)`.\n * If `precision` is supplied, this will be the number of significant digits.\n * @param p\n * @returns\n */\nexport function toString(p: Point, digits?: number): string {\n  if (p === undefined) return `(undefined)`;\n  if (p === null) return `(null)`;\n\n  const x = digits ? p.x.toFixed(digits) : p.x;\n  const y = digits ? p.y.toFixed(digits) : p.y;\n\n  if (p.z === undefined) {\n    return `(${ x },${ y })`;\n  } else {\n    const z = digits ? p.z.toFixed(digits) : p.z;\n    return `(${ x },${ y },${ z })`;\n  }\n}\n\n/**\n * Returns _true_ if the points have identical values\n *\n * ```js\n * const a = {x: 10, y: 10};\n * const b = {x: 10, y: 10;};\n * a === b        // False, because a and be are different objects\n * isEqual(a, b)   // True, because a and b are same value\n * ```\n * @param a\n * @param b\n * @returns _True_ if points are equal\n */\nexport const isEqual = (...p: ReadonlyArray<Point>): boolean => {\n  if (p === undefined) throw new Error(`parameter 'p' is undefined`);\n  if (p.length < 2) return true;\n\n  //eslint-disable-next-line functional/no-let\n  for (let index = 1; index < p.length; index++) {\n    if (p[ index ].x !== p[ 0 ].x) return false;\n    if (p[ index ].y !== p[ 0 ].y) return false;\n  }\n  return true;\n};\n\n/**\n * Returns true if two points are within a specified range on both axes.\n * \n * Provide a point for the range to set different x/y range, or pass a number\n * to use the same range for both axis.\n *\n * Note this simply compares x,y values it does not calcuate distance.\n *\n * @example\n * ```js\n * withinRange({x:100,y:100}, {x:101, y:101}, 1); // True\n * withinRange({x:100,y:100}, {x:105, y:101}, {x:5, y:1}); // True\n * withinRange({x:100,y:100}, {x:105, y:105}, {x:5, y:1}); // False - y axis too far\n * ```\n * @param a\n * @param b\n * @param maxRange\n * @returns\n */\nexport const withinRange = (\n  a: Point,\n  b: Point,\n  maxRange: Point | number\n): boolean => {\n  guard(a, `a`);\n  guard(b, `b`);\n\n  if (typeof maxRange === `number`) {\n    throwNumberTest(maxRange, `positive`, `maxRange`);\n    maxRange = { x: maxRange, y: maxRange };\n  } else {\n    guard(maxRange, `maxRange`);\n  }\n  const x = Math.abs(b.x - a.x);\n  const y = Math.abs(b.y - a.y);\n  return x <= maxRange.x && y <= maxRange.y;\n};\n\n/**\n * Returns a relative point between two points\n * ```js\n * interpolate(0.5, a, b); // Halfway point between a and b\n * ```\n *\n * Alias for Lines.interpolate(amount, a, b);\n *\n * @param amount Relative amount, 0-1\n * @param a\n * @param b\n * @param allowOverflow If true, length of line can be exceeded for `amount` of below 0 and above `1`.\n * @returns {@link Point}\n */\nexport const interpolate = (\n  amount: number,\n  a: Point,\n  b: Point,\n  allowOverflow = false\n): Point => lineInterpolate(amount, a, b, allowOverflow); //({x: (1-amt) * a.x + amt * b.x, y:(1-amt) * a.y + amt * b.y });\n\n/**\n * Returns a point from two coordinates or an array of [x,y]\n * @example\n * ```js\n * let p = from([10, 5]); // yields {x:10, y:5}\n * let p = from(10, 5);   // yields {x:10, y:5}\n * let p = from(10);      // yields {x:10, y:0} 0 is used for default y\n * let p = from();        // yields {x:0, y:0}  0 used for default x & y\n * ```\n * @param xOrArray\n * @param [y]\n * @returns Point\n */\nexport const from = (\n  xOrArray?: number | ReadonlyArray<number>,\n  y?: number\n): Point => {\n  if (Array.isArray(xOrArray)) {\n    if (xOrArray.length !== 2) {\n      throw new Error(`Expected array of length two, got ` + xOrArray.length);\n    }\n    return Object.freeze({\n      x: xOrArray[ 0 ],\n      y: xOrArray[ 1 ],\n    });\n  } else {\n    if (xOrArray === undefined) xOrArray = 0;\n    else if (Number.isNaN(xOrArray)) throw new Error(`x is NaN`);\n    if (y === undefined) y = 0;\n    else if (Number.isNaN(y)) throw new Error(`y is NaN`);\n    return Object.freeze({ x: xOrArray as number, y: y });\n  }\n};\n\n/**\n * Returns an array of points from an array of numbers.\n *\n * Array can be a continuous series of x, y values:\n * ```\n * [1,2,3,4] would yield: [{x:1, y:2}, {x:3, y:4}]\n * ```\n *\n * Or it can be an array of arrays:\n * ```\n * [[1,2], [3,4]] would yield: [{x:1, y:2}, {x:3, y:4}]\n * ```\n * @param coords\n * @returns\n */\nexport const fromNumbers = (\n  ...coords: ReadonlyArray<ReadonlyArray<number>> | ReadonlyArray<number>\n): ReadonlyArray<Point> => {\n  const pts: Array<Point> = [];\n\n  if (Array.isArray(coords[ 0 ])) {\n    // [[x,y],[x,y]...]\n    for (const coord of (coords as Array<Array<number>>)) {\n      if (!(coord.length % 2 === 0)) {\n        throw new Error(`coords array should be even-numbered`);\n      }\n      //eslint-disable-next-line  functional/immutable-data\n      pts.push(Object.freeze({ x: coord[ 0 ], y: coord[ 1 ] }));\n    }\n  } else {\n    // [x,y,x,y,x,y]\n    if (coords.length % 2 !== 0) {\n      throw new Error(`Expected even number of elements: [x,y,x,y...]`);\n    }\n    //eslint-disable-next-line functional/no-let\n    for (let index = 0; index < coords.length; index += 2) {\n      //eslint-disable-next-line  functional/immutable-data\n      pts.push(\n        Object.freeze({ x: coords[ index ] as number, y: coords[ index + 1 ] as number })\n      );\n    }\n  }\n  return pts;\n};\n\n/**\n * Returns `a` minus `b`\n *\n * ie.\n * ```js\n * return {\n *   x: a.x - b.x,\n *   y: a.y - b.y\n * };\n * ```\n * @param a Point a\n * @param b Point b\n * @returns Point\n */\nexport function subtract(a: Point, b: Point): Point;\n\n/**\n * Returns `a` minus the given coordinates.\n *\n * ie:\n * ```js\n * return {\n *  x: a.x - x,\n *  y: a.y - y\n * }\n * ```\n * @param a Point\n * @param x X coordinate\n * @param y Y coordinate (if omitted, x is used as well)\n */\nexport function subtract(a: Point, x: number, y?: number): Point;\n\n/**\n * Subtracts two sets of x,y pairs.\n *\n * If first parameter is a Point, any additional properties of it\n * are included in returned Point.\n * @param x1\n * @param y1\n * @param x2\n * @param y2\n */\nexport function subtract(x1: number, y1: number, x2: number, y2: number): Point;\n\n//eslint-disable-next-line func-style\nexport function subtract(\n  a: Point | number,\n  b: Point | number,\n  c?: number,\n  d?: number\n): Point {\n  if (isPoint(a)) {\n    guard(a, `a`);\n    if (isPoint(b)) {\n      guard(b, `b`);\n      return Object.freeze({\n        ...a,\n        x: a.x - b.x,\n        y: a.y - b.y,\n      });\n    } else {\n      if (c === undefined) c = b;\n      return Object.freeze({\n        ...a,\n        x: a.x - b,\n        y: a.y - c,\n      });\n    }\n  } else {\n    throwNumberTest(a, ``, `a`);\n    if (typeof b !== `number`) {\n      throw new TypeError(`Second parameter is expected to by y value`);\n    }\n    throwNumberTest(b, ``, `b`);\n\n    if (Number.isNaN(c)) throw new Error(`Third parameter is NaN`);\n    if (Number.isNaN(d)) throw new Error(`Fourth parameter is NaN`);\n\n    if (c === undefined) c = 0;\n    if (d === undefined) d = 0;\n    return Object.freeze({\n      x: a - c,\n      y: b - d,\n    });\n  }\n}\n\n/**\n * Applies `fn` on `x` and `y` fields, returning all other fields as well\n * ```js\n * const p = {x:1.234, y:4.9};\n * const p2 = Points.apply(p, Math.round);\n * // Yields: {x:1, y:5}\n * ```\n *\n * The name of the field is provided as well. Here we only round the `x` field:\n *\n * ```js\n * const p = {x:1.234, y:4.9};\n * const p2 = Points.apply(p, (v, field) => {\n *  if (field === `x`) return Math.round(v);\n *  return v;\n * });\n * ```\n * @param pt\n * @param fn\n * @returns\n */\nexport const apply = (\n  pt: Point,\n  fn: (v: number, field?: string) => number\n): Point =>\n  Object.freeze<Point>({\n    ...pt,\n    x: fn(pt.x, `x`),\n    y: fn(pt.y, `y`),\n  });\n\n/**\n * Runs a sequential series of functions on `pt`. The output from one feeding into the next.\n * ```js\n * const p = Points.pipelineApply(somePoint, Points.normalise, Points.invert);\n * ```\n *\n * If you want to make a reusable pipeline of functions, consider {@link pipeline} instead.\n * @param pt\n * @param pipeline\n * @returns\n */\nexport const pipelineApply = (\n  pt: Point,\n  ...pipelineFns: ReadonlyArray<(pt: Point) => Point>\n): Point => pipeline(...pipelineFns)(pt); // pipeline.reduce((prev, curr) => curr(prev), pt);\n\n/**\n * Returns a pipeline function that takes a point to be transformed through a series of functions\n * ```js\n * // Create pipeline\n * const p = Points.pipeline(Points.normalise, Points.invert);\n *\n * // Now run it on `somePoint`.\n * // First we normalised, and then invert\n * const changedPoint = p(somePoint);\n * ```\n *\n * If you don't want to create a pipeline, use {@link pipelineApply}.\n * @param pipeline Pipeline of functions\n * @returns\n */\nexport const pipeline =\n  (...pipeline: ReadonlyArray<(pt: Point) => Point>) =>\n    (pt: Point) =>\n      // eslint-disable-next-line unicorn/no-array-reduce\n      pipeline.reduce((previous, current) => current(previous), pt);\n\n/**\n * Reduces over points, treating _x_ and _y_ separately.\n *\n * ```\n * // Sum x and y values\n * const total = Points.reduce(points, (p, acc) => {\n *  return {x: p.x + acc.x, y: p.y + acc.y}\n * });\n * ```\n * @param pts Points to reduce\n * @param fn Reducer\n * @param initial Initial value, uses `{ x:0, y:0 }` by default\n * @returns\n */\nexport const reduce = (\n  pts: ReadonlyArray<Point>,\n  fn: (p: Point, accumulated: Point) => Point,\n  initial?: Point\n): Point => {\n  if (initial === undefined) initial = { x: 0, y: 0 }\n  //eslint-disable-next-line functional/no-let\n  let accumulator = initial;\n  for (const p of pts) {\n    accumulator = fn(p, accumulator);\n  };\n  return accumulator;\n};\n\ntype Sum = {\n  /**\n   * Adds two sets of coordinates. If y is omitted, the parameter for x is added to both x and y\n   */\n  (aX: number, aY: number, bX: number, bY: number): Point;\n  /**\n   * Add x,y to a\n   */\n  (a: Point, x: number, y?: number): Point;\n  /**\n   * Add two points\n   */\n  (a: Point, b?: Point): Point;\n};\n\n/**\n * Returns a Point of `a` plus `b`. ie:\n *\n * ```js\n * return {\n *   x: a.x + b.x,\n *   y: a.y + b.y\n * };\n * ```\n *\n * Usage:\n *\n * ```js\n * sum(ptA, ptB);\n * sum(x1, y1, x2, y2);\n * sum(ptA, x2, y2);\n * sum(ptA, xAndY);\n * ```\n */\nexport const sum: Sum = function (\n  a: Point | number,\n  b: Point | number | undefined,\n  c?: number,\n  d?: number\n): Point {\n  // ✔️ Unit tested\n  if (a === undefined) throw new TypeError(`a missing`);\n\n  //eslint-disable-next-line functional/no-let\n  let ptA: Point | undefined;\n  //eslint-disable-next-line functional/no-let\n  let ptB: Point | undefined;\n  if (isPoint(a)) {\n    ptA = a;\n    if (b === undefined) b = Empty;\n    if (isPoint(b)) {\n      ptB = b;\n    } else {\n      if (b === undefined) throw new Error(`Expects x coordinate`);\n      ptB = { x: b, y: c ?? b };\n    }\n  } else if (!isPoint(b)) {\n    // Neither of first two params are points\n    if (b === undefined) throw new Error(`Expected number as second param`);\n    ptA = { x: a, y: b };\n    if (c === undefined) throw new Error(`Expects x coordiante`);\n    ptB = { x: c, y: d ?? 0 };\n  }\n\n  if (ptA === undefined) throw new Error(`ptA missing. a: ${ JSON.stringify(a) }`);\n  if (ptB === undefined) throw new Error(`ptB missing. b: ${ JSON.stringify(b) }`);\n  guard(ptA, `a`);\n  guard(ptB, `b`);\n  return Object.freeze({\n    x: ptA.x + ptB.x,\n    y: ptA.y + ptB.y,\n  });\n};\n\n/**\n * Multiply by a width,height or x,y\n * ```\n * return {\n *  x: a.x * rect.width,\n *  y: a.y * rect.height\n * };\n * ```\n * @param a\n * @param rect\n */\nexport function multiply(a: Point, rectOrPoint: Rects.Rect | Points.Point): Point;\n\n/**\n * Returns `a` multipled by some x and/or y scaling factor\n *\n * ie.\n * ```js\n * return {\n *  x: a.x * x\n *   y: a.y * y\n * }\n * ```\n *\n * Usage:\n * ```js\n * multiply(pt, 10, 100); // Scale pt by x:10, y:100\n * multiply(pt, Math.min(window.innerWidth, window.innerHeight)); // Scale both x,y by viewport with or height, whichever is smaller\n * ```\n * @export\n * @parama Point to scale\n * @param x Scale factor for x axis\n * @param [y] Scale factor for y axis (if not specified, the x value is used)\n * @returns Scaled point\n */\nexport function multiply(a: Point, x: number, y?: number): Point;\n\n/**\n * Returns `a` multiplied by `b` point, or given x and y.\n * ie.\n * ```js\n * return {\n *   x: a.x * b.x,\n *   y: a.y * b.y\n * };\n * ```\n * @param a\n * @param bOrX\n * @param y\n * @returns\n */\n/* eslint-disable func-style */\nexport function multiply(\n  a: Point,\n  bOrX: Rects.Rect | Point | number,\n  y?: number\n): Point {\n  // ✔️ Unit tested\n\n  guard(a, `a`);\n  if (typeof bOrX === `number`) {\n    if (typeof y === `undefined`) y = bOrX;\n    throwNumberTest(y, ``, `y`);\n    throwNumberTest(bOrX, ``, `x`);\n    return Object.freeze({ x: a.x * bOrX, y: a.y * y });\n  } else if (isPoint(bOrX)) {\n    guard(bOrX, `b`);\n    return Object.freeze({\n      x: a.x * bOrX.x,\n      y: a.y * bOrX.y,\n    });\n  } else if (Rects.isRect(bOrX)) {\n    Rects.guard(bOrX, `rect`);\n    return Object.freeze({\n      x: a.x * bOrX.width,\n      y: a.y * bOrX.height,\n    });\n  } else {\n    throw new Error(\n      `Invalid arguments. a: ${ JSON.stringify(a) } b: ${ JSON.stringify(bOrX) }`\n    );\n  }\n}\n\n/**\n * Multiplies all components by `v`.\n * Existing properties of `pt` are maintained.\n *\n * ```js\n * multiplyScalar({ x:2, y:4 }, 2);\n * // Yields: { x:4, y:8 }\n * ```\n * @param pt Point\n * @param v Value to multiply by\n * @returns\n */\nexport const multiplyScalar = (\n  pt: Point | Point3d,\n  v: number\n): Point | Point3d => {\n  return isPoint3d(pt) ? Object.freeze({\n    ...pt,\n    x: pt.x * v,\n    y: pt.y * v,\n    z: pt.z * v,\n  }) : Object.freeze({\n    ...pt,\n    x: pt.x * v,\n    y: pt.y * v,\n  });\n};\n\n/**\n * Divides point a by rectangle:\n * ```js\n * return {\n *  x: a.x / rect.width,\n *  y: a.y / rect.hight\n * };\n * ```\n * \n * Or point:\n * ```js\n * return {\n *  x: a.x / b.x,\n *  y: a.y / b.y\n * }\n * ```\n * \n * \n * Dividing by zero will give Infinity for that dimension.\n * @param a\n * @param Rect\n */\nexport function divide(a: Point, rectOrPoint: Rects.Rect | Points.Point): Point;\n\n/**\n * Divides a point by x,y.\n * ```js\n * return {\n *  x: a.x / x,\n *  y: b.y / y\n * };\n * ```\n * \n * Dividing by zero will give Infinity for that dimension.\n * @param a Point\n * @param x X divisor\n * @param y Y divisor. If unspecified, x divisor is used.\n */\nexport function divide(a: Point, x: number, y?: number): Point;\n\n/**\n * Divides two sets of points:\n * ```js\n * return {\n *  x: x1 / x2,\n *  y: y1 / y2\n * };\n * ```\n * \n * Dividing by zero will give Infinity for that dimension.\n * @param x1\n * @param y1\n * @param x2\n * @param y2\n */\nexport function divide(x1: number, y1: number, x2?: number, y2?: number): Point;\n\n/**\n * Divides a from b. If a contains a zero, that axis will be returned as zero\n * @param a\n * @param b\n * @param c\n * @param d\n * @returns\n */\nexport function divide(\n  a: Point | number,\n  b: Rects.Rect | Point | number,\n  c?: number,\n  d?: number\n): Point {\n  // ✔️ Unit tested\n\n  if (isPoint(a)) {\n    guard(a, `a`);\n    if (isPoint(b)) {\n      //guardNonZeroPoint(b);\n      return Object.freeze({\n        x: a.x / b.x,\n        y: a.y / b.y,\n      });\n    } else if (Rects.isRect(b)) {\n      Rects.guard(b, `rect`);\n      return Object.freeze({\n        x: a.x / b.width,\n        y: a.y / b.height,\n      });\n    } else {\n      if (c === undefined) c = b;\n      guard(a);\n      throwNumberTest(b, `nonZero`, `x`);\n      throwNumberTest(c, `nonZero`, `y`);\n      return Object.freeze({\n        x: a.x / b,\n        y: a.y / c,\n      });\n    }\n  } else {\n    if (typeof b !== `number`) {\n      throw new TypeError(`expected second parameter to be y1 coord`);\n    }\n    throwNumberTest(a, `positive`, `x1`);\n    throwNumberTest(b, `positive`, `y1`);\n    if (c === undefined) c = 1;\n    if (d === undefined) d = c;\n    throwNumberTest(c, `nonZero`, `x2`);\n    throwNumberTest(d, `nonZero`, `y2`);\n\n    return Object.freeze({\n      x: a / c,\n      y: b / d,\n    });\n  }\n}\n\n/**\n * Returns a function that divides a point:\n * ```js\n * const f = divider(100, 200);\n * f(50,100); // Yields: { x: 0.5, y: 0.5 }\n * ```\n *\n * Input values can be Point, separate x,y and optional z values or an array:\n * ```js\n * const f = divider({ x: 100, y: 100 });\n * const f = divider( 100, 100 );\n * const f = divider([ 100, 100 ]);\n * ```\n *\n * Likewise the returned function an take these as inputs:\n * ```js\n * f({ x: 100, y: 100});\n * f( 100, 100 );\n * f([ 100, 100 ]);\n * ```\n *\n * Function throws if divisor has 0 for any coordinate (since we can't divide by 0)\n * @param a Divisor point, array of points or x\n * @param b Divisor y value\n * @param c Divisor z value\n * @returns\n */\n//eslint-disable-next-line functional/prefer-readonly-type\nexport function divider(a: Point | number | Array<number>, b?: number, c?: number) {\n  const divisor = getPointParameter(a, b, c);\n  guardNonZeroPoint(divisor, `divisor`);\n\n  return (\n    aa: Point | number | Array<number>,\n    bb?: number,\n    cc?: number\n  ): Point | Point3d => {\n    const dividend = getPointParameter(aa, bb, cc);\n\n    return typeof dividend.z === `undefined` ? Object.freeze({\n      x: dividend.x / divisor.x,\n      y: dividend.y / divisor.y,\n    }) : Object.freeze({\n      x: dividend.x / divisor.x,\n      y: dividend.y / divisor.y,\n      z: dividend.z / (divisor.z ?? 1),\n    });\n  };\n}\n\nexport const quantiseEvery = (pt: Point, snap: Point, middleRoundsUp = true) =>\n  Object.freeze({\n    x: quantiseEveryNumber(pt.x, snap.x, middleRoundsUp),\n    y: quantiseEveryNumber(pt.y, snap.y, middleRoundsUp),\n  });\n/**\n * Simple convex hull impementation. Returns a set of points which\n * enclose `pts`.\n *\n * For more power, see something like [Hull.js](https://github.com/AndriiHeonia/hull)\n * @param pts\n * @returns\n */\nexport const convexHull = (...pts: ReadonlyArray<Point>): ReadonlyArray<Point> => {\n  const sorted = [ ...pts ].sort(compareByX);\n  if (sorted.length === 1) return sorted;\n\n  const x = (points: Array<Point>) => {\n    const v: Array<Point> = [];\n    for (const p of points) {\n      while (v.length >= 2) {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const q = v.at(-1)!;\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        const r = v.at(-2)!;\n        if ((q.x - r.x) * (p.y - r.y) >= (q.y - r.y) * (p.x - r.x)) {\n          //eslint-disable-next-line functional/immutable-data\n          v.pop();\n        } else break;\n      }\n      //eslint-disable-next-line functional/immutable-data\n      v.push(p);\n    }\n    //eslint-disable-next-line functional/immutable-data\n    v.pop();\n    return v;\n  };\n\n  const upper = x(sorted);\n  //eslint-disable-next-line functional/immutable-data\n  const lower = x(sorted.reverse());\n\n  if (upper.length === 1 && lower.length === 1 && isEqual(lower[ 0 ], upper[ 0 ])) {\n    return upper;\n  }\n  return [ ...upper, ...lower ];\n};\n\n/**\n * Returns -2 if both x & y of a is less than b\n * Returns -1 if either x/y of a is less than b\n *\n * Returns 2 if both x & y of a is greater than b\n * Returns 1 if either x/y of a is greater than b's x/y\n *\n * Returns 0 if x/y of a and b are equal\n * @param a\n * @param b\n * @returns\n */\nexport const compare = (a: Point, b: Point): number => {\n  if (a.x < b.x && a.y < b.y) return -2;\n  if (a.x > b.x && a.y > b.y) return 2;\n  if (a.x < b.x || a.y < b.y) return -1;\n  if (a.x > b.x || a.y > b.y) return 1;\n  if (a.x === b.x && a.x === b.y) return 0;\n  return Number.NaN;\n};\n\n/**\n * Compares points based on x value.\n * Returns above 0 if a.x > b.x (to the right)\n * Returns 0 if a.x === b.x\n * Returns below 0 if a.x < b.x (to the left)\n *\n * @example Sorting by x\n * ```js\n * arrayOfPoints.sort(Points.compareByX);\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const compareByX = (a: Point, b: Point): number =>\n  a.x - b.x || a.y - b.y;\n\n/**\n * Project `origin` by `distance` and `angle` (radians).\n *\n * To figure out rotation, imagine a horizontal line running through `origin`.\n * * Rotation = 0 deg puts the point on the right of origin, on same y-axis\n * * Rotation = 90 deg/3:00 puts the point below origin, on the same x-axis\n * * Rotation = 180 deg/6:00 puts the point on the left of origin on the same y-axis\n * * Rotation = 270 deg/12:00 puts the point above the origin, on the same x-axis\n *\n * ```js\n * // Yields a point 100 units away from 10,20 with 10 degrees rotation (ie slightly down)\n * const a = Points.project({x:10, y:20}, 100, degreeToRadian(10));\n * ```\n * @param origin\n * @param distance\n * @param angle\n * @returns\n */\nexport const project = (origin: Point, distance: number, angle: number) => {\n  const x = Math.cos(angle) * distance + origin.x;\n  const y = Math.sin(angle) * distance + origin.y;\n  return { x, y };\n};\n\n/**\n * Rotate a single point by a given amount in radians\n * @param pt\n * @param amountRadian\n * @param origin\n */\nexport function rotate(pt: Point, amountRadian: number, origin?: Point): Point;\n\n/**\n * Rotate several points by a given amount in radians\n * @param pt Points\n * @param amountRadian Amount to rotate in radians. If 0 is given, a copy of the input array is returned\n * @param origin Origin to rotate around. Defaults to 0,0\n */\nexport function rotate(\n  pt: ReadonlyArray<Point>,\n  amountRadian: number,\n  origin?: Point\n): ReadonlyArray<Point>;\n\nexport function rotate(\n  pt: Point | ReadonlyArray<Point>,\n  amountRadian: number,\n  origin?: Point\n): Point | ReadonlyArray<Point> {\n  if (origin === undefined) origin = { x: 0, y: 0 };\n  guard(origin, `origin`);\n  throwNumberTest(amountRadian, ``, `amountRadian`);\n  const arrayInput = Array.isArray(pt);\n\n  // no-op\n  if (amountRadian === 0) return pt;\n\n  if (!arrayInput) {\n    pt = [ pt as Point ];\n  }\n\n  const ptAr = pt as ReadonlyArray<Point>;\n  for (const [ index, p ] of ptAr.entries()) guard(p, `pt[${ index }]`);\n\n  //eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const asPolar = ptAr.map((p) => Polar.fromCartesian(p, origin!));\n  const rotated = asPolar.map((p) => Polar.rotate(p, amountRadian));\n  const asCartesisan = rotated.map((p) => Polar.toCartesian(p, origin));\n  return arrayInput ? asCartesisan : asCartesisan[ 0 ];\n\n  //const p = Polar.fromCartesian(pt, origin);\n  //const pp = Polar.rotate(p, amountRadian);\n  //return Polar.toCartesian(pp, origin);\n}\n\n//eslint-disable-next-line functional/prefer-readonly-type\nexport const rotatePointArray = (\n  v: ReadonlyArray<ReadonlyArray<number>>,\n  amountRadian: number\n): Array<Array<number>> => {\n  const mat = [\n    [ Math.cos(amountRadian), -Math.sin(amountRadian) ],\n    [ Math.sin(amountRadian), Math.cos(amountRadian) ],\n  ];\n  const result = [];\n  //eslint-disable-next-line functional/no-let\n  for (const [ index, element ] of v.entries()) {\n    //eslint-disable-next-line functional/immutable-data\n    result[ index ] = [\n      mat[ 0 ][ 0 ] * element[ 0 ] + mat[ 0 ][ 1 ] * element[ 1 ],\n      mat[ 1 ][ 0 ] * element[ 0 ] + mat[ 1 ][ 1 ] * element[ 1 ],\n    ];\n  }\n  return result;\n};\n\nconst length = (ptOrX: Point | number, y?: number): number => {\n  if (isPoint(ptOrX)) {\n    y = ptOrX.y;\n    ptOrX = ptOrX.x;\n  }\n  if (y === undefined) throw new Error(`Expected y`);\n  return Math.hypot(ptOrX, y);\n};\n\n/**\n * Normalise point as a unit vector.\n *\n * ```js\n * normalise({x:10, y:20});\n * normalise(10, 20);\n * ```\n * @param ptOrX Point, or x value\n * @param y y value if first param is x\n * @returns\n */\nexport const normalise = (ptOrX: Point | number, y?: number): Point => {\n  const pt = getPointParameter(ptOrX, y);\n  const l = length(pt);\n  if (l === 0) return Points.Empty;\n  return Object.freeze({\n    ...pt,\n    x: pt.x / l,\n    y: pt.y / l,\n  });\n};\n\n/**\n * Round the point's _x_ and _y_ to given number of digits\n * @param ptOrX \n * @param yOrDigits \n * @param digits \n * @returns \n */\nexport const round = (ptOrX: Point | number, yOrDigits?: number, digits?: number): Point => {\n  const pt = getPointParameter(ptOrX, yOrDigits);\n  digits = digits ?? yOrDigits;\n  digits = digits ?? 2;\n  return Object.freeze({\n    ...pt,\n    x: roundNumber(digits, pt.x),\n    y: roundNumber(digits, pt.y)\n  })\n}\n/**\n * Normalises a point by a given width and height\n * @param pt Point\n * @param width Width\n * @param height Height\n */\nexport function normaliseByRect(\n  pt: Point,\n  width: number,\n  height: number\n): Point;\n\nexport function normaliseByRect(pt: Point, rect: Rects.Rect): Point;\n\n/**\n * Normalises x,y by width and height so it is on a 0..1 scale\n * @param x\n * @param y\n * @param width\n * @param height\n */\nexport function normaliseByRect(\n  x: number,\n  y: number,\n  width: number,\n  height: number\n): Point;\n\n/**\n * Normalises a point so it is on a 0..1 scale\n * @param a Point, or x\n * @param b y coord or width\n * @param c height or width\n * @param d height\n * @returns Point\n */\nexport function normaliseByRect(\n  a: Point | number,\n  b: number | Rects.Rect,\n  c?: number,\n  d?: number\n): Point {\n  // ✔️ Unit tested\n  if (isPoint(a)) {\n    if (typeof b === `number` && c !== undefined) {\n      throwNumberTest(b, `positive`, `width`);\n      throwNumberTest(c, `positive`, `height`);\n    } else {\n      if (!Rects.isRect(b)) {\n        throw new Error(`Expected second parameter to be a rect`);\n      }\n      c = b.height;\n      b = b.width;\n    }\n    return Object.freeze({\n      x: a.x / b,\n      y: a.y / c,\n    });\n  } else {\n    throwNumberTest(a, `positive`, `x`);\n    if (typeof b !== `number`) {\n      throw new TypeError(`Expecting second parameter to be a number (width)`);\n    }\n    if (typeof c !== `number`) {\n      throw new TypeError(`Expecting third parameter to be a number (height)`);\n    }\n\n    throwNumberTest(b, `positive`, `y`);\n    throwNumberTest(c, `positive`, `width`);\n    if (d === undefined) throw new Error(`Expected height parameter`);\n    throwNumberTest(d, `positive`, `height`);\n    return Object.freeze({\n      x: a / c,\n      y: b / d,\n    });\n  }\n}\n\n/**\n * Returns a random point on a 0..1 scale.\n * ```js\n * import { Points } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const pt = Points.random(); // eg {x: 0.2549012, y:0.859301}\n * ```\n *\n * A custom source of randomness can be provided:\n * ```js\n * import { Points } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * import { weightedSource } from \"https://unpkg.com/ixfx/dist/random.js\"\n * const pt = Points.random(weightedSource(`quadIn`));\n * ```\n * @param rando\n * @returns\n */\nexport const random = (rando?: RandomSource): Point => {\n  if (rando === undefined) rando = defaultRandom;\n\n  return Object.freeze({\n    x: rando(),\n    y: rando(),\n  });\n};\n\n/**\n * Wraps a point to be within `ptMin` and `ptMax`.\n * Note that max values are _exclusive_, meaning the return value will always be one less.\n *\n * Eg, if a view port is 100x100 pixels, wrapping the point 150,100 yields 50,99.\n *\n * ```js\n * // Wraps 150,100 to on 0,0 -100,100 range\n * wrap({x:150,y:100}, {x:100,y:100});\n * ```\n *\n * Wrap normalised point:\n * ```js\n * wrap({x:1.2, y:1.5}); // Yields: {x:0.2, y:0.5}\n * ```\n * @param pt Point to wrap\n * @param ptMax Maximum value, or `{ x:1, y:1 }` by default\n * @param ptMin Minimum value, or `{ x:0, y:0 }` by default\n * @returns Wrapped point\n */\nexport const wrap = (\n  pt: Point,\n  ptMax?: Point,\n  ptMin?: Point\n): Point => {\n\n  if (ptMax === undefined) ptMax = { x: 1, y: 1 };\n  if (ptMin === undefined) ptMin = { x: 0, y: 0 };\n\n  // ✔️ Unit tested\n  guard(pt, `pt`);\n  guard(ptMax, `ptMax`);\n  guard(ptMin, `ptMin`);\n\n  return Object.freeze({\n    x: wrapNumber(pt.x, ptMin.x, ptMax.x),\n    y: wrapNumber(pt.y, ptMin.y, ptMax.y),\n  });\n};\n\n/**\n * Inverts one or more axis of a point\n * ```js\n * invert({x:10, y:10}); // Yields: {x:-10, y:-10}\n * invert({x:10, y:10}, `x`); // Yields: {x:-10, y:10}\n * ```\n * @param pt Point to invert\n * @param what Which axis. If unspecified, both axies are inverted\n * @returns\n */\nexport const invert = (\n  pt: Point | Point3d,\n  what: `both` | `x` | `y` | `z` = `both`\n): Point => {\n  switch (what) {\n    case `both`: {\n      return isPoint3d(pt) ? Object.freeze({\n        ...pt,\n        x: pt.x * -1,\n        y: pt.y * -1,\n        z: pt.z * -1,\n      }) : Object.freeze({\n        ...pt,\n        x: pt.x * -1,\n        y: pt.y * -1,\n      });\n    }\n    case `x`: {\n      return Object.freeze({\n        ...pt,\n        x: pt.x * -1,\n      });\n    }\n    case `y`: {\n      return Object.freeze({\n        ...pt,\n        y: pt.y * -1,\n      });\n    }\n    case `z`: {\n      if (isPoint3d(pt)) {\n        return Object.freeze({\n          ...pt,\n          z: pt.z * -1,\n        });\n      } else throw new Error(`pt parameter is missing z`);\n    }\n    default: {\n      throw new Error(`Unknown what parameter. Expecting 'both', 'x' or 'y'`);\n    }\n  }\n};\n\n/**\n * Returns a point with rounded x,y coordinates. By default uses `Math.round` to round.\n * ```js\n * toIntegerValues({x:1.234, y:5.567}); // Yields: {x:1, y:6}\n * ```\n *\n * ```js\n * toIntegerValues(pt, Math.ceil); // Use Math.ceil to round x,y of `pt`.\n * ```\n * @param pt Point to round\n * @param rounder Rounding function, or Math.round by default\n * @returns\n */\nexport const toIntegerValues = (\n  pt: Point,\n  rounder: (x: number) => number = Math.round\n): Point => {\n  guard(pt, `pt`);\n  return Object.freeze({\n    x: rounder(pt.x),\n    y: rounder(pt.y),\n  });\n};\n\n/**\n * Clamps the magnitude of a point.\n * This is useful when using a Point as a vector, to limit forces.\n * @param pt\n * @param max Maximum magnitude (1 by default)\n * @param min Minimum magnitude (0 by default)\n * @returns\n */\nexport const clampMagnitude = (pt: Point, max = 1, min = 0): Point => {\n  const length = distance(pt);\n  //eslint-disable-next-line functional/no-let\n  let ratio = 1;\n  if (length > max) {\n    ratio = max / length;\n  } else if (length < min) {\n    ratio = min / length;\n  }\n  return ratio === 1 ? pt : multiply(pt, ratio, ratio);\n};\n\n/**\n * Clamps a point to be between `min` and `max` (0 & 1 by default)\n * @param pt Point\n * @param min Minimum value (0 by default)\n * @param max Maximum value (1 by default)\n */\nexport function clamp(pt: Point, min?: number, max?: number): Point;\n\n/**\n * Clamps an x,y pair to be between `min` and `max` (0 & 1 by default)\n * @param x X coordinate\n * @param y Y coordinate\n * @param min Minimum value (0 by default)\n * @param max Maximum value (1 by default)\n */\nexport function clamp(x: number, y: number, min?: number, max?: number): Point;\nexport function clamp(\n  a: Point | number,\n  b?: number,\n  c?: number,\n  d?: number\n): Point {\n  // ✔️ Unit tested\n\n  if (isPoint(a)) {\n    if (b === undefined) b = 0;\n    if (c === undefined) c = 1;\n    throwNumberTest(b, ``, `min`);\n    throwNumberTest(c, ``, `max`);\n    return Object.freeze({\n      x: clampNumber(a.x, b, c),\n      y: clampNumber(a.y, b, c),\n    });\n  } else {\n    if (b === undefined) throw new Error(`Expected y coordinate`);\n    if (c === undefined) c = 0;\n    if (d === undefined) d = 1;\n    throwNumberTest(a, ``, `x`);\n    throwNumberTest(b, ``, `y`);\n    throwNumberTest(c, ``, `min`);\n    throwNumberTest(d, ``, `max`);\n\n    return Object.freeze({\n      x: clampNumber(a, c, d),\n      y: clampNumber(b, c, d),\n    });\n  }\n}\n\nexport type PointRelation = (\n  a: Point | number,\n  b?: number\n) => PointRelationResult;\n\nexport type PointRelationResult = {\n  /**\n   * Angle from start\n   */\n  readonly angle: number;\n  /**\n   * Distance from start\n   */\n  readonly distanceFromStart: number;\n  /**\n   * Distance from last compared point\n   */\n  readonly distanceFromLast: number;\n\n  /**\n   * Center point from start\n   */\n  readonly centroid: Point;\n  /**\n   * Average of all points seen\n   * This is calculated by summing x,y and dividing by total points\n   */\n  readonly average: Point;\n\n  /**\n   * Speed. Distance/millisecond from one sample to the next.\n   */\n  readonly speed: number;\n};\n\n/**\n * Tracks the relation between two points.\n * \n * 1. Call `Points.relation` with the initial reference point\n * 2. You get back a function\n * 3. Call the function with a new point to compute relational information.\n * \n * It computes angle, average, centroid, distance and speed.\n * \n * ```js\n * import { Points } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * // Reference point: 50,50\n * const t = Points.relation({x:50,y:50}); // t is a function\n *\n * // Invoke the returned function with a point\n * const relation = t({ x:0, y:0 }); // Juicy relational data\n * ```\n * \n * Or with destructuring:\n * \n * ```js\n * const { angle, distanceFromStart, distanceFromLast, average, centroid, speed } = t({ x:0,y:0 });\n * ```\n *\n * x & y coordinates can also be used as parameters:\n * ```js\n * const t = Points.relation(50, 50);\n * const result = t(0, 0);\n * // result.speed, result.angle ...\n * ```\n *\n * Note that intermediate values are not stored. It keeps the initial\n * and most-recent point. If you want to compute something over a set\n * of prior points, you may want to use [Data.pointsTracker](./Data.pointsTracker.html)\n * @param start\n * @returns\n */\nexport const relation = (a: Point | number, b?: number): PointRelation => {\n  const start = getPointParameter(a, b);\n  //eslint-disable-next-line functional/no-let\n  let totalX = 0;\n  //eslint-disable-next-line functional/no-let\n  let totalY = 0;\n  //eslint-disable-next-line functional/no-let\n  let count = 0;\n  //eslint-disable-next-line functional/no-let\n  let lastUpdate = performance.now();\n  //eslint-disable-next-line functional/no-let\n  let lastPoint = start;\n  const update = (aa: Point | number, bb?: number) => {\n    const p = getPointParameter(aa, bb);\n    totalX += p.x;\n    totalY += p.y;\n    count++;\n\n    const distanceFromStart = distance(p, start);\n    const distanceFromLast = distance(p, lastPoint);\n\n    // Track speed\n    const now = performance.now();\n    const speed = distanceFromLast / (now - lastUpdate);\n    lastUpdate = now;\n\n    lastPoint = p;\n\n    return Object.freeze({\n      angle: angle(p, start),\n      distanceFromStart,\n      distanceFromLast,\n      speed,\n      centroid: centroid(p, start),\n      average: {\n        x: totalX / count,\n        y: totalY / count,\n      },\n    });\n  };\n\n  return update;\n};\n\nexport const progressBetween = (\n  currentPos: Points.Point | Points.Point3d,\n  from: Points.Point | Points.Point3d,\n  to: Points.Point | Points.Point3d\n) => {\n  // Via: https://www.habrador.com/tutorials/math/2-passed-waypoint/?s=09\n  // from -> current\n  const a = Points.subtract(currentPos, from);\n\n  // from -> to\n  const b = Points.subtract(to, from);\n\n  return Points.isPoint3d(a) && Points.isPoint3d(b) ? (\n    (a.x * b.x + a.y * b.y + a.z * b.z) / (b.x * b.x + b.y * b.y + b.z * b.z)\n  ) : (a.x * b.x + a.y * b.y) / (b.x * b.x + b.y * b.y);\n};\n// const p = { x: 100, y: 100 };\n// console.log(`distance: ` + distance(p));\n// const pp = clampMagnitude(p, 10);\n// console.log(`c1: ${toString(pp)} distance: ${distance(pp)}`);\n\n// const p = { x: 42, y: 1337};\n// const pNorm = normalise(p);\n// console.log(`normalised: ${toString(pNorm)}`);\n","import { Arrays } from '../collections/index.js';\nimport { minFast } from '../collections/NumericArrays.js';\nimport { throwNumberTest, throwPercentTest } from '../Guards.js';\nimport { Points, Rects } from './index.js';\nimport { type Path } from './Path.js';\nimport { guard as guardPoint, type Point } from './Point.js';\n\n/**\n * A line, which consists of an `a` and `b` {@link Points.Point}.\n */\nexport type Line = {\n  readonly a: Points.Point\n  readonly b: Points.Point\n}\n\n//eslint-disable-next-line @typescript-eslint/naming-convention\nexport const Empty = Object.freeze({\n  a: Object.freeze({ x: 0, y: 0 }),\n  b: Object.freeze({ x: 0, y: 0 })\n});\n\n//eslint-disable-next-line @typescript-eslint/naming-convention\nexport const Placeholder = Object.freeze({\n  a: Object.freeze({ x: Number.NaN, y: Number.NaN }),\n  b: Object.freeze({ x: Number.NaN, y: Number.NaN })\n});\n\n/**\n * Returns true if `l` is the same as Line.Empty, that is\n * the `a` and `b` points are Points.Empty.\n * @param l \n * @returns \n */\nexport const isEmpty = (l: Line): boolean => Points.isEmpty(l.a) && Points.isEmpty(l.b);\n\nexport const isPlaceholder = (l: Line): boolean => Points.isPlaceholder(l.a) && Points.isPlaceholder(l.b);\n\n/**\n * A PolyLine, consisting of more than one line.\n */\nexport type PolyLine = ReadonlyArray<Line>;\n\n/**\n * Returns true if `p` is a valid line, containing `a` and `b` Points.\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * Lines.isLine(l);\n * ```\n * @param p Value to check\n * @returns True if a valid line.\n */\nexport const isLine = (p: Path | Line | Points.Point): p is Line => {\n  if (p === undefined) return false;\n  if ((p as Line).a === undefined) return false;\n  if ((p as Line).b === undefined) return false;\n  if (!Points.isPoint((p as Line).a)) return false;\n  if (!Points.isPoint((p as Line).b)) return false;\n  return true;\n};\n\n/**\n * Returns true if `p` is a {@link PolyLine}, ie. an array of {@link Line}s.\n * Validates all items in array.\n * @param p \n * @returns\n */\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const isPolyLine = (p: any): p is PolyLine => {\n  if (!Array.isArray(p)) return false;\n\n  const valid = !p.some(v => !isLine(v));\n  return valid;\n};\n\n/**\n * Returns true if the lines have the same value. Note that only\n * the line start and end points are compared. So the lines might\n * be different in other properties, and `isEqual` will still return\n * true.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const a = { a: {x:0,  y: 10 }, b: { x: 20, y: 20 }};\n * const b = { a: {x:0,  y: 10 }, b: { x: 20, y: 20 }};\n * a === b; // false, because they are different objects\n * Lines.isEqual(a, b); // true, because they have the same value\n * ```\n * @param {Line} a\n * @param {Line} b\n * @returns {boolean}\n */\nexport const isEqual = (a: Line, b: Line): boolean => Points.isEqual(a.a, b.a) && Points.isEqual(a.b, b.b);\n\n/**\n * Applies `fn` to both start and end points.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * // Line 10,10 -> 20,20\n * const line = Lines.fromNumbers(10,10, 20,20);\n * \n * // Applies randomisation to both x and y.\n * const rand = (p) => ({\n *  x: p.x * Math.random(),\n *  y: p.y * Math.random()\n * });\n * \n * // Applies our randomisation function\n * const line2 = apply(line, rand);\n * ```\n * @param line Line\n * @param fn Function that takes a point and returns a point\n * @returns \n */\nexport const apply = (line: Line, fn: (p: Points.Point) => Points.Point) => Object.freeze<Line>(\n  {\n    ...line,\n    a: fn(line.a),\n    b: fn(line.b)\n  }\n);\n\n\n/**\n * Throws an exception if:\n * * line is undefined\n * * a or b parameters are missing\n * \n * Does not validate points\n * @param line \n * @param name \n */\nexport const guard = (line: Line, name = `line`) => {\n  if (line === undefined) throw new Error(`${ name } undefined`);\n  if (line.a === undefined) throw new Error(`${ name }.a undefined. Expected {a:Point, b:Point}. Got: ${ JSON.stringify(line) }`);\n  if (line.b === undefined) throw new Error(`${ name }.b undefined. Expected {a:Point, b:Point} Got: ${ JSON.stringify(line) }`);\n};\n\n/**\n * Returns the angle in radians of a line, or two points\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * Lines.angleRadian(line);\n * Lines.angleRadian(ptA, ptB);\n * ```\n * @param lineOrPoint \n * @param b \n * @returns \n */\nexport const angleRadian = (lineOrPoint: Line | Points.Point, b?: Points.Point): number => {\n  //eslint-disable-next-line functional/no-let\n  let a: Points.Point;\n  if (isLine(lineOrPoint)) {\n    a = lineOrPoint.a;\n    b = lineOrPoint.b;\n  } else {\n    a = lineOrPoint;\n    if (b === undefined) throw new Error(`b point must be provided`);\n  }\n  return Math.atan2(b.y - a.y, b.x - a.x);\n};\n\n/**\n * Multiplies start and end of line by point.x, point.y.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * \n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1, 1, 10, 10);\n * const ll = Lines.multiply(l, {x:2, y:3});\n * // Yields: 2,20 -> 3,30\n * ```\n * @param line \n * @param point \n * @returns \n */\nexport const multiply = (line: Line, point: Points.Point): Line => (Object.freeze({\n  ...line,\n  a: Points.multiply(line.a, point),\n  b: Points.multiply(line.b, point)\n}));\n\n/**\n * Divides both start and end points by given x,y\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * \n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1,1,10,10);\n * const ll = Lines.divide(l, {x:2, y:4});\n * // Yields: 0.5,0.25 -> 5,2.5\n * ```\n * \n * Dividing by zero will give Infinity for that dimension.\n * @param line \n * @param point \n * @returns \n */\nexport const divide = (line: Line, point: Points.Point): Line => Object.freeze({\n  ...line,\n  a: Points.divide(line.a, point),\n  b: Points.divide(line.b, point)\n});\n\n/**\n * Adds both start and end points by given x,y\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1,1,10,10);\n * const ll = Lines.sum(l, {x:2, y:4});\n * // Yields: 3,5 -> 12,14\n * ```\n * @param line \n * @param point \n * @returns \n */\nexport const sum = (line: Line, point: Points.Point): Line => Object.freeze({\n  ...line,\n  a: Points.sum(line.a, point),\n  b: Points.sum(line.b, point)\n});\n\n/**\n * Subtracts both start and end points by given x,y\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * \n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1,1,10,10);\n * const ll = Lines.subtract(l, {x:2, y:4});\n * // Yields: -1,-3 -> 8,6\n * ```\n * @param line \n * @param point \n * @returns \n */\nexport const subtract = (line: Line, point: Points.Point): Line => Object.freeze({\n  ...line,\n  a: Points.subtract(line.a, point),\n  b: Points.subtract(line.b, point)\n});\n\n/**\n * Normalises start and end points by given width and height. Useful\n * for converting an absolutely-defined line to a relative one.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * \n * // Line 1,1 -> 10,10\n * const l = Lines.fromNumbers(1,1,10,10);\n * const ll = Lines.normaliseByRect(l, 10, 10);\n * // Yields: 0.1,0.1 -> 1,1\n * ```\n * @param line \n * @param width\n * @param height \n * @returns \n */\nexport const normaliseByRect = (line: Line, width: number, height: number): Line => Object.freeze({\n  ...line,\n  a: Points.normaliseByRect(line.a, width, height),\n  b: Points.normaliseByRect(line.b, width, height)\n});\n\n\n/**\n * Returns true if `point` is within `maxRange` of `line`.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const line = Lines.fromNumbers(0,20,20,20);\n * Lines.withinRange(line, {x:0,y:21}, 1); // True\n * ```\n * @param line\n * @param point\n * @param maxRange \n * @returns True if point is within range\n */\nexport const withinRange = (line: Line, point: Points.Point, maxRange: number): boolean => {\n  const calculatedDistance = distance(line, point);\n  return calculatedDistance <= maxRange;\n};\n\n/**\n * Returns the length between two points\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * Lines.length(ptA, ptB);\n * ```\n * @param a First point\n * @param b Second point\n * @returns \n */\nexport function length(a: Points.Point, b: Points.Point): number;\n\n/**\n * Returns length of line. If a polyline (array of lines) is provided,\n * it is the sum total that is returned.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * Lines.length(a: {x:0, y:0}, b: {x: 100, y:100});\n * Lines.length(lines);\n * ```\n * @param line Line\n */\nexport function length(line: Line | PolyLine): number;\n\n/**\n * Returns length of line, polyline or between two points\n * \n * @param aOrLine Point A, line or polyline (array of lines)\n * @param pointB Point B, if first parameter is a point\n * @returns Length (total accumulated length for arrays)\n */\n//eslint-disable-next-line func-style\nexport function length(aOrLine: Points.Point | Line | PolyLine, pointB?: Points.Point): number {\n  if (isPolyLine(aOrLine)) {\n    const sum = aOrLine.reduce((accumulator, v) => length(v) + accumulator, 0);\n    return sum;\n  }\n  if (aOrLine === undefined) throw new TypeError(`Parameter 'aOrLine' is undefined`);\n  const [ a, b ] = getPointParameter(aOrLine, pointB);\n  const x = b.x - a.x;\n  const y = b.y - a.y;\n  if (a.z !== undefined && b.z !== undefined) {\n    const z = b.z - a.z;\n    return Math.hypot(x, y, z);\n  } else {\n    return Math.hypot(x, y);\n  }\n}\n\n/**\n * Returns the mid-point of a line (same as `interpolate` with an amount of 0.5)\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * Lines.midpoint(line); // Returns {x, y}\n * ```\n * @param aOrLine \n * @param pointB \n * @returns \n */\nexport const midpoint = (aOrLine: Points.Point | Line, pointB?: Points.Point): Points.Point => {\n  const [ a, b ] = getPointParameter(aOrLine, pointB);\n  return interpolate(0.5, a, b);\n};\n\n/**\n * Returns [a,b] points from either a line parameter, or two points.\n * It additionally applies the guardPoint function to ensure validity.\n * This supports function overloading.\n * @ignore\n * @param aOrLine \n * @param b \n * @returns \n */\nexport const getPointParameter = (aOrLine: Points.Point | Line, b?: Points.Point): readonly [ Points.Point, Points.Point ] => {\n  //eslint-disable-next-line functional/no-let\n  let a;\n  if (isLine(aOrLine)) {\n    b = aOrLine.b;\n    a = aOrLine.a;\n  } else {\n    a = aOrLine;\n    if (b === undefined) throw new Error(`Since first parameter is not a line, two points are expected. Got a: ${ JSON.stringify(a) } b: ${ JSON.stringify(b) }`);\n  }\n  guardPoint(a, `a`);\n  guardPoint(a, `b`);\n\n  return [ a, b ];\n};\n\n/**\n * Returns the nearest point on `line` closest to `point`.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const pt = Lines.nearest(line, {x:10,y:10});\n * ```\n * \n * If an array of lines is provided, it will be the closest point amongst all the lines\n * @param line Line or array of lines\n * @param point\n * @returns Point `{ x, y }`\n */\nexport const nearest = (line: Line | ReadonlyArray<Line>, point: Points.Point): Points.Point => {\n\n  const n = (line: Line): Points.Point => {\n    const { a, b } = line;\n    const atob = { x: b.x - a.x, y: b.y - a.y };\n    const atop = { x: point.x - a.x, y: point.y - a.y };\n    const length = atob.x * atob.x + atob.y * atob.y;\n\n    //eslint-disable-next-line functional/no-let\n    let dot = atop.x * atob.x + atop.y * atob.y;\n    const t = Math.min(1, Math.max(0, dot / length));\n    dot = (b.x - a.x) * (point.y - a.y) - (b.y - a.y) * (point.x - a.x);\n    return { x: a.x + atob.x * t, y: a.y + atob.y * t };\n  };\n\n  if (Array.isArray(line)) {\n    const pts = line.map(l => n(l));\n    const dists = pts.map(p => Points.distance(p, point));\n    return Object.freeze<Points.Point>(pts[ Arrays.minIndex(...dists) ]);\n  } else {\n    return Object.freeze<Points.Point>(n(line as Line));\n  }\n};\n\n/**\n * Calculates [slope](https://en.wikipedia.org/wiki/Slope) of line.\n * \n * @example\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * Lines.slope(line);\n * Lines.slope(ptA, ptB)\n * ```\n * @param lineOrPoint Line or point. If point is provided, second point must be given too\n * @param b Second point if needed\n * @returns \n */\nexport const slope = (lineOrPoint: Line | Points.Point, b?: Points.Point): number => {\n  //eslint-disable-next-line functional/no-let\n  let a: Points.Point;\n  if (isLine(lineOrPoint)) {\n    //eslint-disable-next-line functional/no-let\n    a = lineOrPoint.a;\n    b = lineOrPoint.b;\n  } else {\n    a = lineOrPoint;\n    if (b === undefined) throw new Error(`b parameter required`);\n  }\n  if (b === undefined) {\n    throw new TypeError(`Second point missing`)\n  } else {\n    return (b.y - a.y) / (b.x - a.x);\n  }\n};\n\nconst directionVector = (line: Line): Points.Point => ({\n  x: line.b.x - line.a.x,\n  y: line.b.y - line.a.y\n});\n\nconst directionVectorNormalised = (line: Line): Points.Point => {\n  const l = length(line);\n  const v = directionVector(line);\n  return {\n    x: v.x / l,\n    y: v.y / l\n  };\n};\n\n/**\n * Returns a point perpendicular to `line` at a specified `distance`. Use negative\n * distances for the other side of line.\n * ```\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * // Project a point 100 units away from line, at its midpoint.\n * const pt = Lines.perpendicularPoint(line, 100, 0.5);\n * ```\n * @param line Line\n * @param distance Distance from line. Use negatives to flip side\n * @param amount Relative place on line to project point from. 0 projects from A, 0.5 from the middle, 1 from B.\n */\nexport const perpendicularPoint = (line: Line, distance: number, amount = 0) => {\n  const origin = interpolate(amount, line);\n  const dvn = directionVectorNormalised(line);\n  return {\n    x: origin.x - dvn.y * distance,\n    y: origin.y + dvn.x * distance\n  };\n};\n\n/**\n * Returns a parallel line to `line` at `distance`.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const l = Lines.parallel(line, 10);\n * ```\n * @param line\n * @param distance \n */\nexport const parallel = (line: Line, distance: number): Line => {\n  const dv = directionVector(line);\n  const dvn = directionVectorNormalised(line);\n  const a = {\n    x: line.a.x - dvn.y * distance,\n    y: line.a.y + dvn.x * distance\n  };\n  return {\n    a,\n    b: {\n      x: a.x + dv.x,\n      y: a.y + dv.y\n    }\n  };\n};\n\n/**\n * Scales a line from its midpoint\n * \n * @example Shorten by 50%, anchored at the midpoint\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const l = {\n *  a: {x:50, y:50}, b: {x: 100, y: 90}\n * }\n * const l2 = Lines.scaleFromMidpoint(l, 0.5);\n * ```\n * @param line\n * @param factor \n */\nexport const scaleFromMidpoint = (line: Line, factor: number): Line => {\n  const a = interpolate(factor / 2, line);\n  const b = interpolate(0.5 + factor / 2, line);\n  return { a, b };\n};\n\n/**\n * Calculates `y` where `line` intersects `x`.\n * @param line Line to extend\n * @param x Intersection of x-axis.\n */\nexport const pointAtX = (line: Line, x: number): Points.Point => {\n  const y = line.a.y + (x - line.a.x) * slope(line);\n  return Object.freeze({ x: x, y });\n};\n\n/**\n * Returns a line extended from its `a` point by a specified distance\n *\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const line = {a: {x: 0, y:0}, b: {x:10, y:10} }\n * const extended = Lines.extendFromA(line, 2);\n * ```\n * @param line\n * @param distance\n * @return Newly extended line\n */\nexport const extendFromA = (line: Line, distance: number): Line => {\n  const calculatedLength = length(line);\n  return Object.freeze({\n    ...line,\n    a: line.a,\n    b: Object.freeze({\n      x: line.b.x + (line.b.x - line.a.x) / calculatedLength * distance,\n      y: line.b.y + (line.b.y - line.a.y) / calculatedLength * distance,\n    })\n  });\n};\n\n/**\n * Yields every integer point along `line`. \n * \n * @example Basic usage\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const l = { a: {x: 0, y: 0}, b: {x: 100, y: 100} };\n * for (const p of Lines.pointsOf(l)) {\n *  // Do something with point `p`...\n * }\n * ```\n * \n * Some precision is lost as start and end\n * point is also returned as an integer.\n * \n * Uses [Bresenham's line algorithm](https://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm)\n * @param line Line\n */\n//eslint-disable-next-line func-style\nexport function* pointsOf(line: Line): Generator<Points.Point> {\n  // Via https://play.ertdfgcvb.xyz/#/src/demos/dyna\n  const { a, b } = line;\n  let x0 = Math.floor(a.x);\n  let y0 = Math.floor(a.y);\n  const x1 = Math.floor(b.x);\n  const y1 = Math.floor(b.y);\n  const dx = Math.abs(x1 - x0);\n  const dy = -Math.abs(y1 - y0);\n  const sx = x0 < x1 ? 1 : -1;\n  const sy = y0 < y1 ? 1 : -1;\n  // eslint-disable-next-line unicorn/prevent-abbreviations\n  let err = dx + dy;\n\n  while (true) {\n    yield { x: x0, y: y0 };\n    if (x0 === x1 && y0 === y1) break;\n    // eslint-disable-next-line unicorn/prevent-abbreviations\n    const e2 = 2 * err;\n    if (e2 >= dy) {\n      err += dy;\n      x0 += sx;\n    }\n    if (e2 <= dx) {\n      err += dx;\n      y0 += sy;\n    }\n  }\n}\n\n/**\n * Returns the distance of `point` to the \n * nearest point on `line`.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const d = Lines.distance(line, {x:10,y:10});\n * ```\n * \n * If an array of lines is provided, the shortest distance is returned.\n * @param line Line (or array of lines)\n * @param point Point to check against\n * @returns Distance\n */\nexport const distance = (line: Line | ReadonlyArray<Line>, point: Points.Point): number => {\n  if (Array.isArray(line)) {\n    const distances = line.map(l => distanceSingleLine(l, point));\n    return minFast(distances);\n  } else {\n    return distanceSingleLine(line as Line, point);\n  }\n};\n\n/**\n * Returns the distance of `point` to the nearest point on `line`\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const distance = Lines.distanceSingleLine(line, pt);\n * ```\n * @param line Line\n * @param point Target point\n * @returns \n */\nconst distanceSingleLine = (line: Line, point: Points.Point): number => {\n  guard(line, `line`);\n  guardPoint(point, `point`);\n\n  if (length(line) === 0) {\n    // Line is really a point\n    return length(line.a, point);\n  }\n\n  const near = nearest(line, point);\n  return length(near, point);\n};\n\n/**\n * Calculates a point in-between `a` and `b`.\n * \n * If an interpolation amount below 0 or above 1 is given, _and_\n * `allowOverflow_ is true, a point will be returned that is extended\n * past `line`. This is useful for easing functions which might\n * briefly go past the limits.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * \n * // Get {x,y} at 50% along line\n * Lines.interpolate(0.5, line);\n * \n * // Get {x,y} at 80% between point A and B\n * Lines.interpolate(0.8, ptA, ptB);\n * ```\n * @param amount Relative position, 0 being at a, 0.5 being halfway, 1 being at b\n * @param a Start\n * @param b End\n * @returns Point between a and b\n */\nexport function interpolate(amount: number, a: Points.Point, pointB: Points.Point, allowOverflow?: boolean): Points.Point;\n\n/**\n * Calculates a point in-between `line`'s start and end points.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * \n * // Get {x, y } at 50% along line\n * Lines.interpolate(0.5, line);\n * ```\n * \n * Any additional properties from `b`  are returned on the result as well.\n * @param amount 0..1 \n * @param line Line\n * @param allowOverflow If true, interpolation amount is permitted to exceed 0..1, extending the line\n */\nexport function interpolate(amount: number, line: Line, allowOverflow?: boolean): Points.Point;\n\n/**\n * Calculates a point in-between a line's start and end points.\n * \n * @param amount Interpolation amount\n * @param aOrLine Line, or first point\n * @param pointBOrAllowOverflow Second point (if needed) or allowOverflow.\n * @param allowOverflow If true, interpolation amount is permitted to exceed 0..1, extending the line.\n * @returns \n */\n//eslint-disable-next-line func-style\nexport function interpolate(amount: number, aOrLine: Points.Point | Line, pointBOrAllowOverflow?: Points.Point | boolean, allowOverflow?: boolean): Points.Point {\n\n  if (typeof pointBOrAllowOverflow === `boolean`) {\n    allowOverflow = pointBOrAllowOverflow;\n    pointBOrAllowOverflow = undefined;\n  }\n\n  // eslint-disable-next-line unicorn/no-negated-condition\n  if (!allowOverflow) throwPercentTest(amount, `amount`);\n  else throwNumberTest(amount, ``, `amount`);\n\n  const [ a, b ] = getPointParameter(aOrLine, pointBOrAllowOverflow);\n\n  const d = length(a, b);\n  const d2 = d * (1 - amount);\n\n  // Points are identical, return a copy of b\n  if (d === 0 && d2 === 0) return Object.freeze({ ...b });\n\n  const x = b.x - (d2 * (b.x - a.x) / d);\n  const y = b.y - (d2 * (b.y - a.y) / d);\n\n  return Object.freeze({\n    ...b,\n    x: x,\n    y: y\n  });\n}\n\n/**\n * Returns a string representation of two points\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * console.log(Lines.toString(a, b)));\n * ```\n * @param a \n * @param b \n * @returns \n */\nexport function toString(a: Points.Point, b: Points.Point): string;\n\n/**\n * Returns a string representation of a line \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * Lines.toString(line);\n * ```\n * @param line \n */\nexport function toString(line: Line): string;\n\n/**\n * Returns a string representation of a line or two points.\n * @param a\n * @param b \n * @returns \n */\n//eslint-disable-next-line func-style\nexport function toString(a: Points.Point | Line, b?: Points.Point): string {\n  if (isLine(a)) {\n    guard(a, `a`);\n    b = a.b;\n    a = a.a;\n  } else if (b === undefined) throw new Error(`Expect second point if first is a point`);\n  return Points.toString(a) + `-` + Points.toString(b);\n}\n\n/**\n * Returns a line from a basis of coordinates (x1, y1, x2, y2)\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * // Line from 0,1 -> 10,15\n * Lines.fromNumbers(0, 1, 10, 15);\n * ```\n * @param x1 \n * @param y1 \n * @param x2 \n * @param y2 \n * @returns \n */\nexport const fromNumbers = (x1: number, y1: number, x2: number, y2: number): Line => {\n  if (Number.isNaN(x1)) throw new Error(`x1 is NaN`);\n  if (Number.isNaN(x2)) throw new Error(`x2 is NaN`);\n  if (Number.isNaN(y1)) throw new Error(`y1 is NaN`);\n  if (Number.isNaN(y2)) throw new Error(`y2 is NaN`);\n\n  const a = { x: x1, y: y1 };\n  const b = { x: x2, y: y2 };\n  return fromPoints(a, b);\n};\n\n/**\n * Returns an array representation of line: [a.x, a.y, b.x, b.y]\n * \n * See {@link fromFlatArray} to create a line _from_ this representation.\n *\n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * Lines.toFlatArray(line);\n * Lines.toFlatArray(pointA, pointB);\n * ```\n * @export\n * @param {Point} a\n * @param {Point} b\n * @returns {number[]}\n */\nexport const toFlatArray = (a: Points.Point | Line, b: Points.Point): ReadonlyArray<number> => {\n  if (isLine(a)) {\n    return [ a.a.x, a.a.y, a.b.x, a.b.y ];\n  } else if (Points.isPoint(a) && Points.isPoint(b)) {\n    return [ a.x, a.y, b.x, b.y ];\n  } else {\n    throw new Error(`Expected single line parameter, or a and b points`);\n  }\n};\n\n/**\n * Yields all the points of all the lines.\n * \n * ```js\n * const lines = [ ..some array of lines.. ];\n * for (const pt of Lines.asPoints(lines)) {\n *  // Yields a and then b of each point sequentially\n * }\n * ```\n * @param lines \n */\n//eslint-disable-next-line func-style\nexport function* asPoints(lines: Iterable<Line>) {\n  for (const l of lines) {\n    yield l.a;\n    yield l.b;\n  }\n}\n\n/**\n * Returns an SVG description of line\n * ```\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js';\n * Lines.toSvgString(ptA, ptB);\n * ```\n * @param a \n * @param b \n * @returns \n */\nexport const toSvgString = (a: Points.Point, b: Points.Point): ReadonlyArray<string> => [ `M${ a.x } ${ a.y } L ${ b.x } ${ b.y }` ];\n\n/**\n * Returns a line from four numbers [x1,y1,x2,y2].\n * \n * See {@link toFlatArray} to create an array from a line.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const line = Lines.fromFlatArray(...[0, 0, 100, 100]);\n * // line is {a: { x:0, y:0 }, b: { x: 100, y: 100 } }\n * ```\n * @param array Array in the form [x1,y1,x2,y2]\n * @returns Line\n */\nexport const fromFlatArray = (array: ReadonlyArray<number>): Line => {\n  if (!Array.isArray(array)) throw new Error(`arr parameter is not an array`);\n  if (array.length !== 4) throw new Error(`array is expected to have length four`);\n  return fromNumbers(array[ 0 ], array[ 1 ], array[ 2 ], array[ 3 ]);\n};\n\n/**\n * Returns a line from two points\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * // Line from 0,1 to 10,15\n * const line = Lines.fromPoints( { x:0, y:1 }, { x:10, y:15 });\n * // line is: { a: { x: 0, y: 1}, b: { x: 10, y: 15 } };\n * ```\n * @param a Start point\n * @param b End point\n * @returns \n */\nexport const fromPoints = (a: Points.Point, b: Points.Point): Line => {\n  guardPoint(a, `a`);\n  guardPoint(b, `b`);\n  a = Object.freeze({ ...a });\n  b = Object.freeze({ ...b });\n  return Object.freeze({\n    a: a,\n    b: b\n  });\n};\n\n/**\n * Returns an array of lines that connects provided points. Note that line is not closed.\n * \n * Eg, if points a,b,c are provided, two lines are provided: a->b and b->c.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const lines = Lines.joinPointsToLines(ptA, ptB, ptC);\n * // lines is an array of, well, lines\n * ```\n * @param points \n * @returns \n */\nexport const joinPointsToLines = (...points: ReadonlyArray<Points.Point>): PolyLine => {\n  const lines = [];\n  //eslint-disable-next-line functional/no-let\n  let start = points[ 0 ];\n  //eslint-disable-next-line functional/no-let\n  for (let index = 1; index < points.length; index++) {\n    //eslint-disable-next-line functional/immutable-data\n    lines.push(fromPoints(start, points[ index ]));\n    start = points[ index ];\n  }\n  return lines;\n};\n\n/**\n * Returns a {@link LinePath} from two points\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const path = Lines.fromPointsToPath(ptA, ptB);\n * ```\n * @param a \n * @param b \n * @returns \n */\nexport const fromPointsToPath = (a: Points.Point, b: Points.Point): LinePath => toPath(fromPoints(a, b));\n\n/**\n * Returns a rectangle that encompasses dimension of line\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js';\n * const rect = Lines.bbox(line);\n * ```\n */\nexport const bbox = (line: Line): Rects.RectPositioned => Points.bbox(line.a, line.b);\n\n/**\n * Returns a path wrapper around a line instance. This is useful if there are a series\n * of operations you want to do with the same line because you don't have to pass it\n * in as an argument to each function.\n * \n * Note that the line is immutable, so a function like `sum` returns a new LinePath,\n * wrapping the result of `sum`.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * // Create a path\n * const l = Lines.toPath(fromNumbers(0,0,10,10));\n * \n * // Now we can use it...\n * l.length();\n * \n * // Mutate functions return a new path\n * const ll = l.sum({x:10,y:10});\n * ll.length();\n * ```\n * @param line \n * @returns \n */\nexport const toPath = (line: Line): LinePath => {\n  const { a, b } = line;\n  return Object.freeze({\n    ...line,\n    length: () => length(a, b),\n    interpolate: (amount: number) => interpolate(amount, a, b),\n    bbox: () => bbox(line),\n    toString: () => toString(a, b),\n    toFlatArray: () => toFlatArray(a, b),\n    toSvgString: () => toSvgString(a, b),\n    toPoints: () => [ a, b ],\n    rotate: (amountRadian: number, origin: Points.Point) => toPath(rotate(line, amountRadian, origin)),\n    nearest: (point: Point) => nearest(line, point),\n    sum: (point: Points.Point) => toPath(sum(line, point)),\n    divide: (point: Points.Point) => toPath(divide(line, point)),\n    multiply: (point: Point) => toPath(multiply(line, point)),\n    subtract: (point: Point) => toPath(subtract(line, point)),\n    midpoint: () => midpoint(a, b),\n    distance: (point: Point) => distanceSingleLine(line, point),\n    parallel: (distance: number) => parallel(line, distance),\n    perpendicularPoint: (distance: number, amount?: number) => perpendicularPoint(line, distance, amount),\n    slope: () => slope(line),\n    withinRange: (point: Point, maxRange: number) => withinRange(line, point, maxRange),\n    isEqual: (otherLine: Line) => isEqual(line, otherLine),\n    apply: (fn: (point: Points.Point) => Points.Point) => toPath(apply(line, fn)),\n    kind: `line`\n  });\n};\n\nexport type LinePath = Line & Path & {\n  toFlatArray(): ReadonlyArray<number>\n  toPoints(): ReadonlyArray<Points.Point>\n  rotate(amountRadian: number, origin: Points.Point): LinePath\n  sum(point: Points.Point): LinePath\n  divide(point: Points.Point): LinePath\n  multiply(point: Points.Point): LinePath\n  subtract(point: Points.Point): LinePath\n  apply(fn: (point: Points.Point) => Points.Point): LinePath\n  midpoint(): Point\n  distance(point: Point): number\n  parallel(distance: number): Line\n  perpendicularPoint(distance: number, amount?: number): Point\n  slope(): number\n  withinRange(point: Point, maxRange: number): boolean\n  isEqual(otherLine: Line): boolean\n}\n\n/**\n * Returns a line that is rotated by `angleRad`. By default it rotates\n * around its center, but an arbitrary `origin` point can be provided.\n * If `origin` is a number, it's presumed to be a 0..1 percentage of the line.\n * \n * ```js\n * import { Lines } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * \n * // Rotates line by 0.1 radians around point 10,10\n * const r = Lines.rotate(line, 0.1, {x:10,y:10});\n * \n * // Rotate line by 5 degrees around its center\n * const r = Lines.rotate(line, degreeToRadian(5));\n * \n * // Rotate line by 5 degres around its end point\n * const r = Lines.rotate(line, degreeToRadian(5), line.b);\n * \n * // Rotate by 90 degrees at the 80% position\n * const r = Lines.rotated = rotate(line, Math.PI / 2, 0.8);\n * ```\n * @param line Line to rotate\n * @param amountRadian Angle in radians to rotate by\n * @param origin Point to rotate around. If undefined, middle of line will be used\n * @returns \n */\nexport const rotate = (line: Line, amountRadian?: number, origin?: Points.Point | number): Line => {\n  if (amountRadian === undefined || amountRadian === 0) return line;\n  if (origin === undefined) origin = 0.5;\n  if (typeof origin === `number`) {\n    origin = interpolate(origin, line.a, line.b);\n  }\n  return Object.freeze({\n    ...line,\n    a: Points.rotate(line.a, amountRadian, origin),\n    b: Points.rotate(line.b, amountRadian, origin)\n  });\n};","export type ArrayKeys<K, V> = ReadonlyArray<readonly [ key: K, value: V ]>;\nexport type ObjKeys<K, V> = ReadonlyArray<{\n  readonly key: K;\n  readonly value: V;\n}>;\nexport type EitherKey<K, V> = ArrayKeys<K, V> | ObjKeys<K, V>;\n\nexport {\n  circularArray,\n  type ICircularArray as CircularArray,\n} from './CircularArray.js';\nexport * as Trees from './Trees.js';\n\nexport * as Iterables from './Iterables.js';\n\n/**\n * Stacks store items in order.\n *\n * Stacks and queues can be helpful for processing data in order. They each have slightly different behaviour.\n *\n * Like a stack of plates, the newest item (on top) is removed\n * before the oldest items (at the bottom). {@link Queues} operate differently, with\n * the oldest items (at the front of the queue) removed before the newest items (at the end of the queue).\n *\n * Create stacks with {@link Stacks.immutable} or {@link Stacks.mutable}. These return a {@link IStackImmutable} or {@link IStackMutable} respectively.\n *\n * The ixfx implementation allow you to set a capacity limit with three {@link StackDiscardPolicy |policies} for\n * how items are evicted.\n *\n */\nexport * as Stacks from './stack/index.js';\n\nexport { StackMutable } from './stack/StackMutable.js';\nexport { StackImmutable } from './stack/StackImmutable.js';\n\n/**\n * Arrays are a list of data. ixfx provides a number of functions for working with arrays in an immutable manner.\n * This means that the input array is not changed.\n *\n * Import example:\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/collections.js';\n * ```\n * \n * For arrays of numbers:\n * * {@link average}, {@link max}, {@link min}, {@link total}: Calculate average/max/min/total\n * * {@link averageWeighted}: Calculate average, but applies a weighting function, eg to favour items at beginning of array\n * * {@link minMaxAvg}: Find smallest, largest and average\n * * {@link maxIndex}, {@link minIndex}: Return index of largest/smallest value\n * * {@link dotProduct}: Returns the dot-product between two arrays\n * * {@link weight}: Applies a weighting function to all values based on their index\n *\n * Randomisation\n * * {@link randomIndex}: Return a random array index\n * * {@link randomElement}: Return a random value\n * * {@link randomPluck}: Remove a random element from an array, returning it and the new array\n * * {@link shuffle}: Returns a randomly-sorted copy of arra\n *\n * Finding/accessing\n * * {@link filterBetween}: Same as `Array.filter` but only looks within a specified index range\n * * {@link sample}: Returns a new array with a random sampling of input\n * * {@link valuesEqual}: Returns true if all the values in the array are identical\n *\n * Changing the shape\n * * {@link ensureLength}: Returns a copy of array with designated length, either padding it out or truncating as necessary\n * * {@link groupBy}: Groups data into a new Map\n * * {@link interleave}: Flattens several arrays into one, interleaving their values.\n * * {@link remove}: Remove an item by index\n * * {@link without}: Returns an array with specified value omitted\n * * {@link zip}: Groups together elements from several arrays based on their index\n */\nexport * as Arrays from './Arrays.js';\n\nimport * as Sets from './set/index.js';\n\n/**\n * Sets store unique items.\n *\n * ixfx's {@link ISetImmutable} (or {@link ISetMutable}) compares items by value rather than reference, unlike the default JS implementation.\n *\n * Create using {@link Sets.immutable} or {@link Sets.mutable}\n */\nexport { Sets };\nexport { SetStringMutable } from './set/SetMutable.js';\nexport { SetStringImmutable } from './set/SetImmutable.js';\nimport * as Queues from './queue/index.js';\n\n/**\n * Queues store items in the order in which they are added.\n *\n * Stacks and queues can be helpful when it's necessary to process data in order, but each one has slightly different behaviour.\n *\n * Like lining up at a bakery, the oldest items (at the front of the queue) are removed\n * before the newest items (at the end of the queue). This is different to {@link Stacks},\n * where the newest item (on top) is removed before the oldest items (at the bottom).\n *\n * The ixfx implementations allow you to set a capacity limit with three {@link QueueDiscardPolicy | policies} for\n * how items are evicted.\n *\n * Create queues with {@link Queues.immutable} or {@link Queues.mutable}. These return a {@link IQueueImmutable} or {@link IQueueMutable} respectively.\n */\nexport { Queues };\nexport { QueueMutable } from './queue/QueueMutable.js';\nexport { QueueImmutable } from './queue/QueueImmutable.js';\nimport * as Maps from './map/index.js';\n\n/**\n * Maps associate keys with values. Several helper functions are provided\n * for working with the standard JS Map class.\n *\n * Import example\n * ```js\n * import { Maps } from 'https://unpkg.com/ixfx/dist/collections.js';\n * ```\n * \n * ixfx also includes {@link Maps.IMapMutable}, {@link Maps.IMapImmutable}\n *\n * Overview:\n * * {@link getOrGenerate}: Solves a common scenario of wanting a value by a particular key, or generating it if it doesn't exist\n * * {@link filter}: Yields values in map that match a predicate\n * * {@link find}: Finds the first value that matches a predicate, or _undefined_ if nothing found\n * * {@link hasAnyValue}: Searches through all keys, returning true if any occurence of _value_ was found\n *\n * Transformations:\n * * {@link toArray}: Returns the values of the map as an array\n * * {@link mapToArray}: Applies a function to convert a map's values to an array\n * * {@link toObject}: Coverts a Map to a plain object, useful for JSON serialising.\n * * {@link mapToObjTransform}: Converts a map to a plain object, but applying a function to values\n * * {@link transformMap}: Like `Array.map`, but for Maps. Useful for generating a map as a transform of an input map.\n * * {@link zipKeyValue}: Given an array of keys and values, combines them together into a map\n */\nexport { Maps };\n","import {throwIntegerTest} from '../Guards.js';\n\n/**\n * The circular array is immutable. It keeps up to `capacity` items.\n * Old items are overridden with new items.\n *\n * `CircularArray` extends the regular JS array. Only use `add` to change the array if you want\n * to keep the `CircularArray` behaviour.\n * @example\n * ```js\n * let a = circularArray(10);\n * a = a.add(`hello`); // Because it's immutable, capture the return result of `add`\n * a.isFull;  // True if circular array is full\n * a.pointer; // The current position in array it will write to\n * ```\n * @class CircularArray\n * @extends {Array}\n * @template V\n */\nexport interface ICircularArray<V> extends Array<V> {\n  /**\n   * Returns true if the array has filled to capacity and is now\n   * recycling array indexes.\n   */\n  get isFull(): boolean;\n\n  /**\n   * Returns a new Circular with item added\n   *\n   * Items are added at `pointer` position, which automatically cycles through available array indexes.\n   *\n   * @param {V} thing Thing to add\n   * @returns {Circular<V>} Circular with item added\n   * @memberof Circular\n   */\n  add(v: V): ICircularArray<V>;\n\n  get length(): number;\n\n  /**\n   * Returns the current add position of array.\n   */\n  get pointer(): number;\n}\n\nclass CircularArray<V> extends Array {\n  // ✔ Class is unit tested!\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  #capacity: number;\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  #pointer: number;\n\n  constructor(capacity: number = 0) {\n    super();\n    // Allowed to create with capacity zero\n    throwIntegerTest(capacity, `positive`, `capacity`);\n\n    // Can't throw because .filter won't use ctor proprly\n    this.#capacity = capacity;\n    this.#pointer = 0;\n  }\n\n  add(thing: V): CircularArray<V> {\n    const ca = CircularArray.from(this) as CircularArray<V>;\n    /* eslint-disable-next-line functional/immutable-data */\n    ca[this.#pointer] = thing;\n    /* eslint-disable-next-line functional/immutable-data */\n    ca.#capacity = this.#capacity;\n    if (this.#capacity > 0) {\n      /* eslint-disable-next-line functional/immutable-data */\n      ca.#pointer =\n        this.#pointer + 1 === this.#capacity ? 0 : this.#pointer + 1;\n    } else {\n      /* eslint-disable-next-line functional/immutable-data */\n      ca.#pointer = this.#pointer + 1;\n    }\n    return ca;\n  }\n\n  get pointer(): number {\n    return this.#pointer;\n  }\n\n  get isFull(): boolean {\n    if (this.#capacity === 0) return false;\n    return this.length === this.#capacity;\n  }\n}\n\n/**\n * Returns a new circular array. Immutable. A circular array only keeps up to `capacity` items.\n * Old items are overridden with new items.\n *\n * `CircularArray` extends the regular JS array. Only use `add` to change the array if you want\n * to keep the `CircularArray` behaviour.\n *\n * @example Basic functions\n * ```js\n * let a = circularArray(10);\n * a = a.add(`hello`);  // Because it's immutable, capture the return result of `add`\n * a.isFull;            // True if circular array is full\n * a.pointer;           // The current position in array it will write to\n * ```\n *\n * Since it extends the regular JS array, you can access items as usual:\n * @example Accessing\n * ```js\n * let a = circularArray(10);\n * ... add some stuff ..\n * a.forEach(item => // do something with item);\n * ```\n * @param capacity Maximum capacity before recycling array entries\n * @return Circular array\n */\nexport const circularArray = <V>(capacity: number): ICircularArray<V> =>\n  new CircularArray<V>(capacity);\n","// #region Imports\nimport { type IsEqual, isEqualDefault } from '../IsEqual.js';\nimport { QueueMutable } from './queue/QueueMutable.js';\nimport { StackMutable } from './stack/StackMutable.js';\nimport { betweenChomp } from '../Text.js';\n\nimport { integerParse, nullUndef } from '../Guards.js';\nimport { last } from '../IterableSync.js';\n\n// #endregion\n\n\n\nexport type Entry = readonly [ name: string, value: any ];\n\n/**\n * TreeNode type\n */\nexport type TreeNode = {\n  /**\n   * Direct children of node\n   */\n  children(): IterableIterator<TreeNode>;\n  /**\n   * Chain of parents of node. First result will be immediate parent,\n   * last result will be the terminating parent (root)\n   */\n  parents(): IterableIterator<TreeNode>;\n\n  getLengthChildren?(): number;\n};\n\n/**\n * Options for parsing a path\n */\nexport type PathOpts = {\n  /**\n   * Separator for path, eg '.'\n   */\n  readonly separator?: string;\n  /**\n   * If true, [integer] will be used for arrays\n   */\n  readonly allowArrayIndexes?: boolean;\n};\n\n/**\n * Returns _true_ if `p` seems to match the `TreeNode` type.\n * Returns _false_ if `p` is undefined or null.\n *\n * @param p\n * @returns\n */\nexport function isTreeNode(p: TreeNode | object): p is TreeNode {\n  nullUndef(p, `p`);\n\n  if ((p as TreeNode).children === undefined) return false;\n  if ((p as TreeNode).parents === undefined) return false;\n  return true;\n}\n\n/**\n * Returns the count of immediate children for this\n * TreeNode (or map, or plain object)\n *\n * ```js\n * const basicObj = {\n *  john: {\n *    address: { postcode: 1234, city: 'Blahville' }\n *  }\n * }\n * Trees.getLengthChildren(basicObj); // 1\n * ```\n * @param p\n * @returns\n */\nexport const getLengthChildren = (p: TreeNode | object): number => {\n  // ✔️ Unit tested\n  if (isTreeNode(p) && typeof p.getLengthChildren !== `undefined`) {\n    return p.getLengthChildren();\n  }\n  return [ ...directChildren(p) ].length;\n};\n\nfunction prettyPrintEntryPath(entries: ReadonlyArray<Entry>) {\n  if (entries.length === 0) return `(empty)`;\n  //eslint-disable-next-line functional/no-let\n  let t = ``;\n  for (const [ index, entry ] of entries.entries()) {\n    t += `  `.repeat(index);\n    t += entry[ 0 ] + ` = ` + JSON.stringify(entry[ 1 ]) + `\\n`;\n  }\n  return t;\n}\n\n/**\n * Returns a human-friendly debug string for a tree-like structure\n * ```js\n * console.log(Trees.prettyPrint(obj));\n * ```\n * @param indent\n * @param node\n * @param defaultLabel\n * @returns\n */\nexport const prettyPrint = (\n  node: object,\n  indent = 0,\n  defaultLabel = `root`\n): string => {\n  nullUndef(node, `node`);\n  const entry = getEntry(node, defaultLabel);\n  const t = `${ `  `.repeat(indent) } + label: ${ entry[ 0 ]\n    } value: ${ JSON.stringify(entry[ 1 ]) }`;\n  const children = [ ...directChildren(node, defaultLabel) ];\n  return children.length > 0 ? (\n    t +\n    `\\n` +\n    children.map((d) => prettyPrint(d[ 1 ], indent + 1, d[ 0 ])).join(`\\n`)\n  ) : t;\n};\n\n/**\n * Returns the direct children of a tree-like object as a pairing\n * of node label and value. Supports basic objects, Maps, arrays and {@link TreeNode}s.\n * \n * Sub-children are included as an object blob.\n * \n * @example Simple object\n * ```js\n * const o = {\n *  colour: {\n *    r: 0.5, g: 0.5, b: 0.5\n *  }\n * };\n * \n * const children = [...Trees.directChildren(o)];\n * // Children:\n * // [\n * //  [ \"colour\", { b: 0.5, g: 0.5, r: 0.5 }]\n * // ]\n * ```\n * \n * Arrays are assigned a label based on index.\n * @example Arrays\n * ```js\n  const colours = [ {r:1,g:0,b:0}, {r:0,g:1,b:0}, {r:0,g:0,b:1} ];\n * // Children: \n * // [\n * //  [\"array[0]\", {r:1,g:0,b:0}],\n * //  [\"array[1]\", {r:0,g:1,b:0}],\n * //  [\"array[2]\", {r:0,g:0,b:1}],\n * // ]\n * ```\n * \n * Pass in `defaultName` (eg 'colours') to have labels generated as 'colours[0]', etc.\n * @param node \n * @param defaultName \n */\nexport function* directChildren(\n  node: object,\n  defaultName?: string\n): IterableIterator<Entry> {\n  // ✔️ Unit tested\n  nullUndef(node, `node`);\n  if (Array.isArray(node)) {\n    if (!defaultName) defaultName = `array`;\n    for (const [ index, element ] of node.entries()) {\n      yield [ defaultName + `[` + index.toString() + `]`, element ];\n    }\n  } else if (isTreeNode(node)) {\n    for (const n of node.children()) yield getEntry(n);\n  } else if (typeof node === `object`) {\n    if (`entries` in node) {\n      yield* (node as Map<any, any>).entries();\n    }\n    yield* Object.entries(node);\n  }\n}\n\n/**\n * Finds a given direct child by label\n * @param label\n * @param node\n * @returns\n */\nfunction findDirectChildByLabel(\n  label: string,\n  node: object\n): Entry | undefined {\n  for (const d of directChildren(node)) {\n    if (d[ 0 ] === label) return d;\n  }\n}\n\n/**\n * Returns the closest matching entry, tracing `path` in a tree.\n * Returns an entry with _undefined_ value at the point where tracing stopped.\n * Use {@link traceByPath} to step through all the segments.\n *\n * ```js\n * const people = {\n *  jane: {\n *   address: {\n *    postcode: 1000,\n *    street: 'West St',\n *    city: 'Blahville'\n *   },\n *   colour: 'red'\n *  }\n * }\n * Trees.getByPath('jane.address.postcode', people); // '.' default separator\n * // ['postcode', 1000]\n * Trees.getByPath('jane.address.country.state', people);\n * // ['country', undefined] - since full path could not be resolved.\n * ```\n * @param path Path, eg `jane.address.postcode`\n * @param node Node to look within\n * @param opts Options for parsing path. By default '.' is used as a separator\n * @returns\n */\nexport function getByPath(\n  path: string,\n  node: object,\n  opts: PathOpts = {}\n): Entry {\n  // ✔️ Unit tested\n  const v = last(traceByPath(path, node, opts));\n  if (!v) throw new Error(`Could not trace path: ${ path }`);\n  return v;\n}\n\n/**\n * Enumerates from root over nodes that lead to the given path terminus.\n * Use {@link getByPath} to only fetch the closest matching entry.\n *\n * ```js\n * const people = {\n *  jane: {\n *   address: {\n *    postcode: 1000,\n *    street: 'West St',\n *    city: 'Blahville'\n *   },\n *   colour: 'red'\n *  }\n * }\n * for (const p of Trees.traceByPath('jane.address.street', rootNode)) {\n * // [\"jane\", { address: { postcode: 1000,street: 'West St', city: 'Blahville' }, colour: 'red'}],\n * // [\"address\", { postcode: 1000, street: 'West St', city: 'Blahville' }],\n * // [\"street\",\"West St\"]\n * }\n * ```\n *\n * Results stop when the path can't be followed. The last entry will have a label of\n * the last sought path segment, and _undefined_ as its value.\n *\n * @param path\n * @param node\n * @returns\n */\nexport function* traceByPath(\n  path: string,\n  node: object,\n  opts: PathOpts = {}\n): Iterable<Entry> {\n  // ✔️ Unit tested\n  nullUndef(path, `path`);\n  nullUndef(node, `node`);\n\n  const separator = opts.separator ?? `.`;\n  const allowArrayIndexes = opts.allowArrayIndexes ?? true;\n  const pathSplit = path.split(separator);\n\n  for (const p of pathSplit) {\n    //eslint-disable-next-line functional/no-let\n    let entry = findDirectChildByLabel(p, node);\n    if (allowArrayIndexes) {\n      const [ withoutBrackets, arrayIndexString ] = betweenChomp(p, `[`, `]`);\n      const arrayIndex = integerParse(arrayIndexString, `positive`, -1);\n      if (arrayIndex >= 0) {\n        // Get array by name without the []\n        entry = findDirectChildByLabel(withoutBrackets, node);\n\n        if (entry && Array.isArray(entry[ 1 ])) {\n          // Result was array as expected\n          entry = [ p, entry[ 1 ][ arrayIndex ] ];\n        }\n      }\n    }\n\n    if (!entry) {\n      yield [ p, undefined ];\n      return;\n    }\n    node = entry[ 1 ];\n    yield entry;\n  }\n}\n\n/**\n * Generates a label for a node.\n * Uses the 'label' property if it exists, otherwise uses `defaultLabel`\n * @param node\n * @param defaultLabel\n * @returns\n */\nfunction getEntry(node: object, defaultLabel = ``): Entry {\n  if (`label` in node) {\n    return [ node.label as string, node ];\n  }\n  return [ defaultLabel, node ];\n}\n\n/**\n * Depth-first traversal over object, array, Map or TreeNode\n * @param root\n * @returns\n */\nexport function* depthFirst(root: object): IterableIterator<Entry> {\n  if (!root) return;\n  const stack = new StackMutable<Entry>();\n  //eslint-disable-next-line functional/immutable-data\n  stack.push(getEntry(root, `root`));\n  //eslint-disable-next-line functional/no-let,functional/immutable-data\n  let entry = stack.pop();\n  while (entry) {\n    yield entry;\n    if (entry) {\n      //eslint-disable-next-line functional/immutable-data\n      stack.push(...directChildren(entry[ 1 ], entry[ 0 ]));\n    }\n    if (stack.isEmpty) break;\n    //eslint-disable-next-line functional/immutable-data\n    entry = stack.pop();\n  }\n}\n\n/**\n * Breadth-first traversal over object, array, Map or TreeNode\n * @param root\n * @returns\n */\nexport function* breadthFirst(root: object): IterableIterator<Entry> {\n  if (!root) return;\n  const queue = new QueueMutable<Entry>();\n  queue.enqueue(getEntry(root, `root`));\n  //eslint-disable-next-line functional/no-let\n  let entry = queue.dequeue();\n  while (entry) {\n    yield entry;\n    if (entry) {\n      queue.enqueue(...directChildren(entry[ 1 ], entry[ 0 ]));\n    }\n    if (queue.isEmpty) break;\n    entry = queue.dequeue();\n  }\n}\n\n/**\n * Returns _true_ if _possibleChild_ is contained within _parent_ tree.\n * That is, it is any possible sub-child.\n * @param parent Parent tree\n * @param possibleChild Sought child\n * @param eq Equality function, or {@link isEqualDefault} if undefined.\n * @returns\n */\nexport const hasAnyChild = <V extends TreeNode>(\n  parent: V,\n  possibleChild: V,\n  eq: IsEqual<V> = isEqualDefault\n): boolean => {\n  return hasChild(parent, possibleChild, Number.MAX_SAFE_INTEGER, eq);\n};\n\n/**\n * Returns _true_ if _possibleChild_ is contained within _maxDepth_ children\n * of _parent_ node. By default only looks at immediate children (maxDepth = 0).\n *\n * ```js\n * // Just check parentNode for childNode\n * Trees.hasChild(parentNode, childNode);\n * // See if parentNode or parentNode's parents have childNode\n * Trees.hasChild(parentNode, childNode, 1);\n * // Use custom equality function, in this case comparing on name field\n * Trees.hasChild(parentNode, childNode, 0, (a, b) => a.name === b.name);\n * ```\n * @param parent Parent tree\n * @param possibleChild Sought child\n * @param maxDepth Maximum depth. 0 for immediate children, Number.MAX_SAFE_INTEGER for boundless\n * @param eq Equality function, or {@link isEqualDefault} if undefined.\n * @returns\n */\nexport const hasChild = <V extends TreeNode>(\n  parent: V,\n  possibleChild: V,\n  maxDepth = 0,\n  eq: IsEqual<V> = isEqualDefault\n): boolean => {\n  nullUndef(parent, `parent`);\n  nullUndef(possibleChild, `possibleChild`);\n\n  if (maxDepth < 0) return false;\n  for (const d of parent.children()) {\n    if (eq(d as V, possibleChild)) return true;\n    if (hasChild(d, possibleChild, maxDepth - 1)) return true;\n  }\n  return false;\n};\n\n/**\n * Returns _true_ if `child` exists within `possibleParent`. By default it only looks at the immediate\n * parent (maxDepth: 0). Use Number.MAX_SAFE_INTEGER for searching recursively upwards (or {@link hasAnyParent})\n * @param child Child being sought\n * @param possibleParent Possible parent of child\n * @param maxDepth Max depth of traversal. Default of 0 only looks for immediate parent.\n * @param eq Equality comparison function. {@link isEqualDefault} used by default.\n * @returns\n */\nexport const hasParent = <V extends TreeNode>(\n  child: V,\n  possibleParent: V,\n  maxDepth = 0,\n  eq: IsEqual<V> = isEqualDefault\n): boolean => {\n  nullUndef(possibleParent, `possibleParent`);\n  nullUndef(child, `child`);\n\n  for (const p of child.parents()) {\n    if (eq(p as V, possibleParent)) return true;\n    maxDepth--;\n    if (maxDepth < 0) break;\n  }\n  return false;\n};\n\n/**\n * Returns _true_ if `child` is parented at any level (grand-parented etc) by `possibleParent`\n * @param child Child being sought\n * @param possibleParent Possible parent of child\n * @param eq Equality comparison function {@link isEqualDefault} used by default\n * @returns\n */\nexport const hasAnyParent = <V extends TreeNode>(\n  child: V,\n  possibleParent: V,\n  eq: IsEqual<V> = isEqualDefault\n): boolean => {\n  return hasParent(child, possibleParent, Number.MAX_SAFE_INTEGER, eq);\n};\n\n/**\n * Returns _true_ if `prospectiveChild` can be legally added to `parent`.\n * _False_ is returned if:\n *  * `parent` and `prospectiveChild` are equal\n *  * `parent` already contains `prospectiveChild`\n *  * `prospectiveChild` has `parent` as its own child\n *\n * Throws an error if `parent` or `prospectiveChild` is null/undefined.\n * @param parent Parent to add to\n * @param prospectiveChild Prospective child\n * @param eq Equality function\n */\nexport const couldAddChild = <V extends TreeNode>(\n  parent: V,\n  prospectiveChild: V,\n  eq: IsEqual<V> = isEqualDefault\n) => {\n  nullUndef(prospectiveChild, `prospectiveChild`);\n  nullUndef(parent, `parent`);\n\n  if (eq(parent, prospectiveChild)) throw new Error(`Child equals parent`);\n  if (hasAnyChild(parent, prospectiveChild, eq)) {\n    throw new Error(`Circular. Parent already has child`);\n  }\n  if (hasAnyChild(prospectiveChild, parent, eq)) {\n    throw new Error(`Prospective child has parent as child relation`);\n  }\n};\n\nexport { TreeNodeMutable, treeNodeMutable } from './TreeNodeMutable.js';","import type { QueueOpts } from './index.js';\n\nexport const debug = (opts: QueueOpts<any>, message: string): void => {\n  /* eslint-disable-next-line functional/no-expression-statements */\n  opts.debug ? console.log(`queue:${ message }`) : null;\n};\n\nexport const trimQueue = <V>(\n  opts: QueueOpts<V>,\n  queue: ReadonlyArray<V>,\n  toAdd: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  const potentialLength = queue.length + toAdd.length;\n  const capacity = opts.capacity ?? potentialLength;\n  const toRemove = potentialLength - capacity;\n  const policy = opts.discardPolicy ?? `additions`;\n  // debug(\n  //   opts,\n  //   `queueLen: ${queue.length} potentialLen: ${potentialLength} toRemove: ${toRemove} policy: ${policy} toAdd.length: ${toAdd.length} capacity: ${capacity}`\n  // );\n  // debug(opts, `to add: ${JSON.stringify(toAdd)}`);\n\n  switch (policy) {\n    // Only add what we can from toAdd\n    case `additions`: {\n      // debug(\n      //   opts,\n      //   `trimQueue:DiscardAdditions: queueLen: ${queue.length} slice: ${\n      //     potentialLength - capacity\n      //   } toAddLen: ${toAdd.length} nowFull: ${queue.length === opts.capacity}`\n      // );\n      if (queue.length === 0) return toAdd.slice(0, toAdd.length - toRemove);\n      if (queue.length === opts.capacity) {\n        return queue; // Completely full\n      } else {\n        // Only add some from the new array (from the front)\n        return [ ...queue, ...toAdd.slice(0, toRemove - 1) ];\n      }\n    }\n    // Remove from rear of queue (last index) before adding new things\n    case `newer`: {\n      if (toRemove >= queue.length) {\n        // New items will completely flush out old\n        //debug(opts, `slice start: ${toAdd.length - capacity}`);\n        if (queue.length === 0) {\n          // Special case when queue starts off empty\n          return [ ...toAdd.slice(0, capacity - 1), toAdd.at(-1)! ];\n        }\n        return toAdd.slice(\n          Math.max(0, toAdd.length - capacity),\n          Math.min(toAdd.length, capacity) + 1\n        );\n        //debug(opts, `Final value: ${JSON.stringify(tmp)}`);\n        //return tmp;\n      } else {\n        // Keep some of the old\n        // const toAddFinal = toAdd.slice(\n        //   0,\n        //   Math.min(toAdd.length, capacity - toRemove + 1)\n        // );\n        // Cap 5, queue 5, toAdd: 10.\n        const countToAdd = Math.max(1, toAdd.length - queue.length);\n        const toAddFinal = toAdd.slice(toAdd.length - countToAdd, toAdd.length);\n        const toKeep = queue.slice(0, Math.min(queue.length, capacity - 1)); //toRemove);\n        // debug(\n        //   opts,\n        //   `trimQueue: countToAdd: ${countToAdd} qLen: ${\n        //     queue.length\n        //   } capacity: ${capacity} toRemove: ${toRemove} keeping: ${JSON.stringify(\n        //     toKeep\n        //   )} from orig: ${JSON.stringify(queue)} toAddFinal: ${JSON.stringify(\n        //     toAddFinal\n        //   )}`\n        // );\n        const t = [ ...toKeep, ...toAddFinal ];\n        //debug(opts, `final: ${JSON.stringify(t)}`);\n        return t;\n      }\n    }\n    // Remove from the front of the queue (0 index). ie. older items are discarded\n    case `older`: {\n      // If queue is A, B and toAdd is C, D this yields A, B, C, D\n      return [ ...queue, ...toAdd ].slice(toRemove);\n    }\n    default: {\n      // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      throw new Error(`Unknown overflow policy ${ policy }`);\n    }\n  }\n};\n\n/**\n * Adds to the back of the queue (last array index)\n * Last item of `toAdd` will potentially be the new end of the queue (depending on capacity limit and overflow policy)\n * @template V\n * @param {QueueOpts} opts\n * @param {V[]} queue\n * @param {...V[]} toAdd\n * @returns {V[]}\n */\nexport const enqueue = <V>(\n  opts: QueueOpts<V>,\n  queue: ReadonlyArray<V>,\n  ...toAdd: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  if (opts === undefined) throw new Error(`opts parameter undefined`);\n\n  const potentialLength = queue.length + toAdd.length;\n  const overSize = opts.capacity && potentialLength > opts.capacity;\n\n  const toReturn = overSize\n    ? trimQueue(opts, queue, toAdd)\n    : [ ...queue, ...toAdd ];\n  if (opts.capacity && toReturn.length !== opts.capacity && overSize) {\n    throw new Error(\n      `Bug! Expected return to be at capacity. Return len: ${ toReturn.length\n      } capacity: ${ opts.capacity } opts: ${ JSON.stringify(opts) }`\n    );\n  }\n  if (!opts.capacity && toReturn.length !== potentialLength) {\n    throw new Error(\n      `Bug! Return length not expected. Return len: ${ toReturn.length\n      } expected: ${ potentialLength } opts: ${ JSON.stringify(opts) }`\n    );\n  }\n  return toReturn;\n};\n\n// Remove from front of queue (0 index)\nexport const dequeue = <V>(\n  opts: QueueOpts<V>,\n  queue: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  if (queue.length === 0) throw new Error(`Queue is empty`);\n  return queue.slice(1);\n};\n\n/**\n * Returns front of queue (oldest item), or undefined if queue is empty\n *\n * @template V\n * @param {QueueOpts} opts\n * @param {V[]} queue\n * @returns {(V | undefined)}\n */\nexport const peek = <V>(\n  opts: QueueOpts<V>,\n  queue: ReadonlyArray<V>\n): V | undefined => queue[ 0 ];\n\nexport const isEmpty = <V>(opts: QueueOpts<V>, queue: ReadonlyArray<V>): boolean =>\n  queue.length === 0;\n\nexport const isFull = <V>(\n  opts: QueueOpts<V>,\n  queue: ReadonlyArray<V>\n): boolean => {\n  if (opts.capacity) {\n    return queue.length >= opts.capacity;\n  }\n  return false;\n};\n","import { type IQueueMutable } from './IQueueMutable.js';\nimport { enqueue, peek, dequeue, isEmpty, isFull } from './QueueFns.js';\nimport { type QueueOpts } from './QueueTypes.js';\nimport { without } from '../Arrays.js';\nimport { isEqualDefault, type IsEqual } from '../../IsEqual.js';\n/**\n * Returns a mutable queue. Queues are useful if you want to treat 'older' or 'newer'\n * items differently. _Enqueing_ adds items at the back of the queue, while\n * _dequeing_ removes items from the front (ie. the oldest).\n *\n * ```js\n * const q = Queues.mutable();       // Create\n * q.enqueue(`a`, `b`);     // Add two strings\n * const front = q.dequeue();  // `a` is at the front of queue (oldest)\n * ```\n *\n * @example Cap size to 5 items, throwing away newest items already in queue.\n * ```js\n * const q = Queues.mutable({capacity: 5, discardPolicy: `newer`});\n * ```\n *\n * @template V Data type of items\n * @param opts\n * @param startingItems Items are added in array order. So first item will be at the front of the queue.\n */\nexport class QueueMutable<V> implements IQueueMutable<V> {\n  readonly opts: QueueOpts<V>;\n  // eslint-disable-next-line functional/prefer-readonly-type\n  data: ReadonlyArray<V>;\n  eq: IsEqual<V>;\n\n  constructor(opts: QueueOpts<V> = {}, data: ReadonlyArray<V> = []) {\n    if (opts === undefined) throw new Error(`opts parameter undefined`);\n    this.opts = opts;\n    this.data = data;\n    this.eq = opts.eq ?? isEqualDefault;\n  }\n\n  clear() {\n    this.data = [];\n  }\n\n  /**\n   * Return a copy of the array\n   * @returns \n   */\n  toArray() {\n    return [ ...this.data ];\n  }\n\n  enqueue(...toAdd: ReadonlyArray<V>): number {\n    /* eslint-disable-next-line functional/immutable-data */\n    this.data = enqueue(this.opts, this.data, ...toAdd);\n    return this.data.length;\n  }\n\n  dequeue(): V | undefined {\n    const v = peek(this.opts, this.data);\n    if (v === undefined) return;\n    /* eslint-disable-next-line functional/immutable-data */\n    this.data = dequeue(this.opts, this.data);\n    return v;\n  }\n\n  /**\n   * Remove item from queue, regardless of position.\n   * Returns _true_ if something was removed.\n   * @param v \n   */\n  remove(v: V, comparer?: IsEqual<V>): boolean {\n    const length = this.data.length;\n    this.data = without(this.data, v, comparer ?? this.eq);\n    return this.data.length !== length;\n  }\n\n  get isEmpty(): boolean {\n    return isEmpty(this.opts, this.data);\n  }\n\n  get isFull(): boolean {\n    return isFull(this.opts, this.data);\n  }\n\n  get length(): number {\n    return this.data.length;\n  }\n\n  get peek(): V | undefined {\n    return peek(this.opts, this.data);\n  }\n}\n\nexport function mutable<V>(\n  opts: QueueOpts<V> = {},\n  ...startingItems: ReadonlyArray<V>\n): IQueueMutable<V> {\n  return new QueueMutable({ ...opts }, [ ...startingItems ]);\n}\n\n","import type { StackOpts } from '.';\n\nexport const trimStack = <V>(\n  opts: StackOpts,\n  stack: ReadonlyArray<V>,\n  toAdd: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  const potentialLength = stack.length + toAdd.length;\n  const policy = opts.discardPolicy ?? `additions`;\n  const capacity = opts.capacity ?? potentialLength;\n  const toRemove = potentialLength - capacity;\n  if (opts.debug) {\n    console.log(\n      `Stack.push: stackLen: ${stack.length} potentialLen: ${potentialLength} toRemove: ${toRemove} policy: ${policy}`\n    );\n  }\n  switch (policy) {\n    case `additions`:\n      if (opts.debug) {\n        console.log(\n          `Stack.push:DiscardAdditions: stackLen: ${stack.length} slice: ${\n            potentialLength - capacity\n          } toAddLen: ${toAdd.length}`\n        );\n      }\n      if (stack.length === opts.capacity) {\n        return stack; // Completely full\n      } else {\n        // Only add some from the new array\n        return [...stack, ...toAdd.slice(0, toAdd.length - toRemove)];\n      }\n    case `newer`:\n      if (toRemove >= stack.length) {\n        // New items will completely flush out old\n        return toAdd.slice(\n          Math.max(0, toAdd.length - capacity),\n          Math.min(toAdd.length, capacity) + 1\n        );\n      } else {\n        // Keep some of the old (from 0)\n        //if (opts.debug) console.log(` orig: ${JSON.stringify(stack)}`);\n        if (opts.debug) {\n          console.log(` from orig: ${stack.slice(0, stack.length - toRemove)}`);\n        }\n        return [\n          ...stack.slice(0, stack.length - toRemove),\n          ...toAdd.slice(0, Math.min(toAdd.length, capacity - toRemove + 1)),\n        ];\n      }\n    case `older`:\n      // Oldest item in stack is position 0\n      return [...stack, ...toAdd].slice(toRemove);\n    default:\n      throw new Error(`Unknown discard policy ${policy}`);\n  }\n};\n\n// Add to top (last index)\nexport const push = <V>(\n  opts: StackOpts,\n  stack: ReadonlyArray<V>,\n  ...toAdd: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  // If stack is A, B and toAdd is C, D this yields A, B, C, D\n  //const mutated = [...stack, ...toAdd];\n  const potentialLength = stack.length + toAdd.length;\n\n  const overSize = opts.capacity && potentialLength > opts.capacity;\n  const toReturn = overSize\n    ? trimStack(opts, stack, toAdd)\n    : [...stack, ...toAdd];\n  return toReturn;\n};\n\n// Remove from top (last index)\nexport const pop = <V>(\n  opts: StackOpts,\n  stack: ReadonlyArray<V>\n): ReadonlyArray<V> => {\n  if (stack.length === 0) throw new Error(`Stack is empty`);\n  return stack.slice(0, stack.length - 1);\n};\n\n/**\n * Peek at the top of the stack (end of array)\n *\n * @template V\n * @param {StackOpts} opts\n * @param {V[]} stack\n * @returns {(V | undefined)}\n */\nexport const peek = <V>(\n  opts: StackOpts,\n  stack: ReadonlyArray<V>\n): V | undefined => stack[stack.length - 1];\n\nexport const isEmpty = <V>(opts: StackOpts, stack: ReadonlyArray<V>): boolean =>\n  stack.length === 0;\n\nexport const isFull = <V>(\n  opts: StackOpts,\n  stack: ReadonlyArray<V>\n): boolean => {\n  if (opts.capacity) {\n    return stack.length >= opts.capacity;\n  }\n  return false;\n};\n","// -------------------------\n// Mutable\n// -------------------------\n\nimport type { IStackMutable } from './IStackMutable.js';\nimport { push, peek, pop, isEmpty, isFull } from './StackFns.js';\nimport type { StackOpts } from './index.js';\n\n/**\n * Creates a stack. Mutable. Use {@link StackImmutable} for an immutable alternative.\n *\n * @example Basic usage\n * ```js\n * // Create\n * const s = new StackMutable();\n * // Add one or more items\n * s.push(1, 2, 3, 4);\n *\n * // See what's on top\n * s.peek;  // 4\n *\n * // Remove the top-most, and return it\n * s.pop();   // 4\n *\n * // Now there's a new top-most element\n * s.peek;  // 3\n * ```\n */\nexport class StackMutable<V> implements IStackMutable<V> {\n  readonly opts: StackOpts;\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  data: ReadonlyArray<V>;\n\n  constructor(opts: StackOpts = {}, data: ReadonlyArray<V> = []) {\n    this.opts = opts;\n    this.data = data;\n  }\n\n  push(...toAdd: ReadonlyArray<V>): number {\n    /* eslint-disable-next-line functional/immutable-data */\n    this.data = push(this.opts, this.data, ...toAdd);\n    return this.data.length;\n  }\n\n  forEach(fn: (v: V) => void): void {\n    this.data.forEach(fn);\n  }\n\n  forEachFromTop(fn: (v: V) => void): void {\n    [...this.data].reverse().forEach(fn);\n  }\n\n  pop(): V | undefined {\n    const v = peek(this.opts, this.data);\n    this.data = pop(this.opts, this.data);\n    return v;\n  }\n\n  get isEmpty(): boolean {\n    return isEmpty(this.opts, this.data);\n  }\n\n  get isFull(): boolean {\n    return isFull(this.opts, this.data);\n  }\n\n  get peek(): V | undefined {\n    return peek(this.opts, this.data);\n  }\n\n  get length(): number {\n    return this.data.length;\n  }\n}\n\n/**\n * Creates a stack. Mutable. Use {@link Stacks.immutable} for an immutable alternative.\n *\n * @example Basic usage\n * ```js\n * // Create\n * const s = Stacks.mutable();\n * // Add one or more items\n * s.push(1, 2, 3, 4);\n *\n * // See what's on top\n * s.peek;  // 4\n *\n * // Remove the top-most, and return it\n * s.pop();   // 4\n *\n * // Now there's a new top-most element\n * s.peek;  // 3\n * ```\n */\nexport const mutable = <V>(\n  opts: StackOpts = {},\n  ...startingItems: ReadonlyArray<V>\n): IStackMutable<V> => new StackMutable({ ...opts }, [...startingItems]);\n","/**\n * Return `it` broken up into chunks of `size`\n *\n * ```js\n * chunks([1,2,3,4,5,6,7,8,9,10], 3);\n * // Yields: [[1, 2, 3], [4, 5, 6], [7, 8, 9], [10]]\n * ```\n * @param it\n * @param size\n * @returns\n */\n\nimport { type ToString, toStringDefault } from './Util.js';\nimport { type IsEqual } from './IsEqual.js';\n\n/**\n * Returns a function that yields a value from a generator.\n * ```js\n * const spring = yieldNumber(Oscillators.spring());\n *\n * spring(); // latest value\n * ```\n *\n * Instead of:\n * ```js\n * const spring = Oscillators.spring();\n *\n * spring.next().value\n * ```\n *\n * A `defaultValue` can be provided if the source generator returns undefined:\n * ```js\n * const spring = yieldNumber(Oscillators.spring(), 0);\n * spring(); // Returns 0 if the generator returns undefined\n * ```\n * @param generator\n * @param defaultValue\n * @returns\n */\nexport function yieldNumber(\n  generator: Generator<number>,\n  defaultValue?: number\n) {\n\n  return (): number | undefined => {\n    const v: number | undefined = generator.next().value as number | undefined;\n    if (v === undefined) return defaultValue;\n    return v;\n  };\n}\n\n/**\n * Return first value from an iterable, or _undefined_ if\n * no values are generated\n * @param it\n * @returns\n */\nexport function first<V>(it: Iterable<V>): V | undefined {\n  for (const value of it) {\n    return value;\n  }\n}\n\n/**\n * Returns last value from an iterable, or _undefined_\n * if no values are generated\n * @param it\n */\nexport function last<V>(it: Iterable<V>): V | undefined {\n  //eslint-disable-next-line functional/no-let\n  let returnValue: V | undefined;\n  for (const value of it) {\n    returnValue = value;\n  }\n  return returnValue;\n}\n\n/**\n * Yields chunks of the iterable `it` such that the end of a chunk is the\n * start of the next chunk.\n *\n * Eg, with the input [1,2,3,4,5] and a size of 2, we would get back\n * [1,2], [2,3], [3,4], [4,5].\n *\n *\n * @param it\n * @param size\n * @returns\n */\nexport function* chunksOverlapping<V>(it: Iterable<V>, size: number) {\n  if (size <= 1) throw new Error(`Size should be at least 2`);\n\n  //eslint-disable-next-line functional/no-let\n  let buffer: Array<V> = [];\n\n  for (const v of it) {\n    //eslint-disable-next-line functional/immutable-data\n    buffer.push(v);\n    if (buffer.length === size) {\n      yield buffer;\n      //eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      buffer = [ buffer.at(-1)! ];\n    }\n  }\n  if (buffer.length <= 1) return;\n\n  if (buffer.length > 0) yield buffer;\n}\n\n/**\n * Breaks an iterable into array chunks\n * ```js\n * chunks([1,2,3,4,5,6,7,8,9,10], 3);\n * // Yields [[1, 2, 3], [4, 5, 6], [7, 8, 9], [10]]\n * ```\n * @param it\n * @param size\n */\n//eslint-disable-next-line func-style\nexport function* chunks<V>(it: Iterable<V>, size: number) {\n  //eslint-disable-next-line functional/no-let\n  let buffer = [];\n\n  for (const v of it) {\n    //eslint-disable-next-line functional/immutable-data\n    buffer.push(v);\n    if (buffer.length === size) {\n      yield buffer;\n      buffer = [];\n    }\n  }\n  if (buffer.length > 0) yield buffer;\n}\n\n/**\n * Return concatenation of iterators\n * @param its\n */\n//eslint-disable-next-line func-style\nexport function* concat<V>(...its: ReadonlyArray<Iterable<V>>) {\n  for (const it of its) yield* it;\n}\n\n/**\n * Drops elements that do not meet the predicate `f`.\n * ```js\n * dropWhile([1, 2, 3, 4], e => e < 3);\n * returns [3, 4]\n * ```\n * @param it\n * @param f\n */\n//eslint-disable-next-line func-style\nexport function* dropWhile<V>(it: Iterable<V>, f: (v: V) => boolean) {\n  for (const v of it) {\n    if (!f(v)) {\n      yield v;\n      break;\n    }\n  }\n  yield* it;\n}\n\n/**\n * Returns true if items in two iterables are equal, as\n * determined by the `equality` function.\n * @param it1\n * @param it2\n * @param equality\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function equals<V>(\n  it1: IterableIterator<V>,\n  it2: IterableIterator<V>,\n  equality?: IsEqual<V>\n) {\n  //it1 = it1[Symbol.iterator]();\n  //it2 = it2[Symbol.iterator]();\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    const index1 = it1.next(),\n      index2 = it2.next();\n    if (equality !== undefined) {\n      if (!equality(index1.value, index2.value)) return false;\n    } else if (index1.value !== index2.value) return false;\n    if (index1.done ?? index2.done) return index1.done && index2.done;\n  }\n}\n\n/**\n * Returns true if `f` returns true for\n * every item in iterable\n * @param it\n * @param f\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function every<V>(it: Iterable<V>, f: (v: V) => boolean) {\n  // https://surma.github.io/underdash/\n  //eslint-disable-next-line functional/no-let\n  let ok = true;\n\n  for (const v of it) ok = ok && f(v);\n  return ok;\n}\n\n/**\n * Yields `v` for each item within `it`.\n *\n * ```js\n * fill([1, 2, 3], 0);\n * // Yields: [0, 0, 0]\n * ```\n * @param it\n * @param v\n */\n//eslint-disable-next-line func-style\nexport function* fill<V>(it: Iterable<V>, v: V) {\n  // https://surma.github.io/underdash/\n\n  //eslint-disable-next-line @typescript-eslint/no-unused-vars\n  for (const _ of it) yield v;\n}\n\n/**\n * Execute function `f` for each item in iterable\n * @param it\n * @param f\n */\n//eslint-disable-next-line func-style\nexport function forEach<V>(it: Iterable<V>, f: (v: V) => boolean) {\n  // https://surma.github.io/underdash/\n\n  for (const v of it) f(v);\n}\n\n/**\n * ```js\n * filter([1, 2, 3, 4], e => e % 2 == 0);\n * returns [2, 4]\n * ```\n * @param it\n * @param f\n */\n//eslint-disable-next-line func-style\nexport function* filter<V>(it: Iterable<V>, f: (v: V) => boolean) {\n  // https://surma.github.io/underdash/\n\n  for (const v of it) {\n    if (!f(v)) continue;\n    yield v;\n  }\n}\n\n/**\n * Returns first item from iterable `it` that matches predicate `f`\n * ```js\n * find([1, 2, 3, 4], e => e > 2);\n * // Yields: 3\n * ```\n * @param it\n * @param f\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function find<V>(it: Iterable<V>, f: (v: V) => boolean) {\n  // https://surma.github.io/underdash/\n\n  for (const v of it) {\n    if (f(v)) return v;\n  }\n}\n\n/**\n * Returns a 'flattened' copy of array, un-nesting arrays one level\n * ```js\n * flatten([1, [2, 3], [[4]]]);\n * // Yields: [1, 2, 3, [4]];\n * ```\n * @param it\n */\n//eslint-disable-next-line func-style\nexport function* flatten<V>(it: Iterable<V>) {\n  // https://surma.github.io/underdash/\n\n  for (const v of it) {\n    //eslint-disable-next-line @typescript-eslint/no-explicit-any\n    if (Symbol.iterator in (v as any)) {\n      // @ts-expect-error\n      yield* v;\n    } else {\n      yield v;\n    }\n  }\n}\n\n/**\n * Maps an iterable of type `V` to type `X`.\n * ```js\n * map([1, 2, 3], e => e*e)\n * returns [1, 4, 9]\n * ```\n * @param it\n * @param f\n */\n//eslint-disable-next-line func-style\nexport function* map<V, X>(it: Iterable<V>, f: (v: V) => X) {\n  // https://surma.github.io/underdash/\n\n  for (const v of it) {\n    yield f(v);\n  }\n}\n\n/**\n * Returns the maximum seen of an iterable\n * ```js\n * min([\n *  {i:0,v:1},\n *  {i:1,v:9},\n *  {i:2,v:-2}\n * ], (a, b) => a.v > b.v);\n * // Yields: {i:1, v:-9}\n * ```\n * @param it Iterable\n * @param gt Should return _true_ if `a` is greater than `b`.\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function max<V>(it: Iterable<V>, gt = (a: V, b: V) => a > b) {\n  // https://surma.github.io/underdash/\n  //eslint-disable-next-line functional/no-let\n  let max;\n\n  for (const v of it) {\n    if (!max) {\n      max = v;\n      continue;\n    }\n    max = gt(max, v) ? max : v;\n  }\n  return max;\n}\n\n/**\n * Returns the minimum seen of an iterable\n * ```js\n * min([\n *  {i:0,v:1},\n *  {i:1,v:9},\n *  {i:2,v:-2}\n * ], (a, b) => a.v > b.v);\n * // Yields: {i:2, v:-2}\n * ```\n * @param it Iterable\n * @param gt Should return _true_ if `a` is greater than `b`.\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function min<V>(it: Iterable<V>, gt = (a: V, b: V) => a > b) {\n  // https://surma.github.io/underdash/\n  //eslint-disable-next-line functional/no-let\n  let min;\n\n  for (const v of it) {\n    if (!min) {\n      min = v;\n      continue;\n    }\n    min = gt(min, v) ? v : min;\n  }\n  return min;\n}\n\n/**\n * Returns count from `start` for a given length\n * ```js\n * range(-5, 10);\n * // Yields: [-5, -4, -3, -2, -1, 0, 1, 2, 3, 4]\n * ```\n * @param start\n * @param len\n */\n//eslint-disable-next-line func-style\nexport function* range(start: number, length: number) {\n  // https://surma.github.io/underdash/\n  //eslint-disable-next-line functional/no-let\n  for (let index = 0; index < length; index++) {\n    yield start++;\n  }\n  //for (let i=len;len > 0; len--) yield start++;\n}\n\n/**\n * Reduce for iterables\n * ```js\n * reduce([1, 2, 3], (acc, cur) => acc + cur, 0);\n * // Yields: 6\n * ```\n * @param it Iterable\n * @param f Function\n * @param start Start value\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function reduce<V>(\n  it: Iterable<V>,\n  f: (accumulator: V, current: V) => V,\n  start: V\n) {\n  // https://surma.github.io/underdash/\n\n  for (const v of it) start = f(start, v);\n  return start;\n}\n\n/**\n * Returns a section from an iterable\n * @param it Iterable\n * @param start Start index\n * @param end End index (or until completion)\n */\n//eslint-disable-next-line func-style\nexport function* slice<V>(\n  it: Iterable<V>,\n  start = 0,\n  end = Number.POSITIVE_INFINITY\n) {\n  // https://surma.github.io/underdash/\n  const iit = it[ Symbol.iterator ]();\n\n  for (; start > 0; start--, end--) iit.next();\n\n  for (const v of it) {\n    if (end-- > 0) {\n      yield v;\n    } else {\n      break;\n    }\n  }\n}\n\n/**\n * Returns true the first time `f` returns true. Useful for spotting any occurrence of\n * data, and exiting quickly\n * ```js\n * some([1, 2, 3, 4], e => e % 3 === 0);\n * // Yields: true\n * ```\n * @param it Iterable\n * @param f Filter function\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function some<V>(it: Iterable<V>, f: (v: V) => boolean) {\n  // https://surma.github.io/underdash/\n\n  for (const v of it) {\n    if (f(v)) return true;\n  }\n  return false;\n}\n\n/**\n * Returns items for which the filter function returns _true_\n * ```js\n * takeWhile([ 1, 2, 3, 4 ], e => e < 3);\n * // Yields: [ 1, 2 ]\n * ```\n * @param it Iterable\n * @param f Filter function\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function* takeWhile<V>(it: Iterable<V>, f: (v: V) => boolean) {\n  // https://surma.github.io/underdash/\n\n  for (const v of it) {\n    if (!f(v)) return;\n    yield v;\n  }\n}\n\n/**\n * Returns unique items from an iterable or\n * array of iterables.\n *\n * ```js\n * const data = [ 'apples', 'oranges' ]\n * const data2 = [ 'oranges', 'pears' ]\n * const unique = [...unique([data,data2]];\n * // Yields: [ 'apples', 'oranges', 'pears' ]\n * ```\n *\n * Custom function can be used that returns a key for\n * an item, determining equality. By default uses\n * JSON.stringify.\n *\n * ```js\n * const data = [ {i:0,v:2}, {i:1,v:3}, {i:2,v:2} ];\n *\n * // Item identity based on 'v' field\n * unique(data, e => e.v);\n * //Yields: [ {i:0,v:2}, {i:1,v:3} ]\n * ```\n * @param iterable Iterable, or array of iterables\n * @param f\n */\n//eslint-disable-next-line func-style\nexport function* unique<V>(\n  //eslint-disable-next-line functional/prefer-readonly-type\n  iterable: Iterable<V> | Array<Iterable<V>>,\n  keyFunction: ToString<V> = toStringDefault\n) {\n  // f: (id: V) => V = (id) => id) {\n  // Adapted from https://surma.github.io/underdash/\n  const buffer: Array<string> = [];\n  //eslint-disable-next-line functional/no-let\n  let itera: Array<Iterable<V>> = [];\n  itera = Array.isArray(iterable) ? iterable : [ iterable ];\n  for (const it of itera) {\n    for (const v of it) {\n      const fv = keyFunction(v);\n      if (buffer.includes(fv)) continue;\n      //eslint-disable-next-line functional/immutable-data\n      buffer.push(fv);\n      yield v;\n    }\n  }\n}\n\n/**\n * Combine same-positioned items from several iterables\n * ```js\n * zip( [1, 2, 3], [4, 5, 6], [7, 8, 9] );\n * Yields: [ [1, 4, 7], [2, 5, 8], [3, 6, 9] ]\n * ```\n * @param its\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function* zip<V>(...its: ReadonlyArray<Iterable<V>>) {\n  // https://surma.github.io/underdash/\n  const iits = its.map((it) => it[ Symbol.iterator ]());\n\n  while (true) {\n    const vs = iits.map((it) => it.next());\n    if (vs.some((v) => v.done)) return;\n    yield vs.map((v) => v.value as V);\n  }\n}\n","import { type TreeNode } from '../collections/Trees.js';\nimport { Points, Rects, Shapes } from './index.js';\nimport { type ShapePositioned } from './Shape.js';\n\n/**\n * Options for quad tree\n */\nexport type QuadTreeOpts = {\n  /**\n   * Maximum items per node\n   */\n  readonly maxItems: number;\n  /**\n   * Maximum level of sub-division\n   */\n  readonly maxLevels: number;\n};\n\n/**\n * Direction\n */\nexport enum Direction {\n  Nw,\n  Ne,\n  Sw,\n  Se,\n}\n\n/**\n * A Point or ShapePositioned\n */\nexport type QuadTreeItem = Points.Point | ShapePositioned;\n\n/**\n * Creates a QuadTreeNode\n * @param bounds Bounds of region\n * @param initialData Initial items to place in quad tree\n * @param opts Options\n * @returns New quad tree\n */\n// export const quadTree = (bounds:Rects.RectPositioned, initialData:readonly QuadTreeItem[] = [], opts:Partial<QuadTreeOpts> = {}):QuadTreeNode => {\n//   const o:QuadTreeOpts = {\n//     maxItems: opts.maxItems ?? 4,\n//     maxLevels: opts.maxLevels ?? 4\n//   };\n\n//   const n = new QuadTreeNode( undefined, bounds, 0, o);\n//   initialData.forEach(d => {\n//     n.add(d);\n//   });\n//   return n;\n// };\n\n/**\n * QuadTreeNode\n *\n * To create, you probably want the {@link quadTree} function.\n */\nexport class QuadTreeNode implements TreeNode {\n  #items: QuadTreeItem[] = [];\n  #children: QuadTreeNode[] = [];\n  #parent: QuadTreeNode | undefined;\n  /**\n   * Constructor\n   * @param boundary\n   * @param level\n   * @param opts\n   */\n  constructor(\n    parent: QuadTreeNode | undefined,\n    readonly boundary: Rects.RectPositioned,\n    readonly level: number,\n    readonly opts: QuadTreeOpts\n  ) {\n    this.#parent = parent;\n  }\n\n  getLengthChildren(): number {\n    return this.#children.length;\n  }\n\n  *parents(): IterableIterator<QuadTreeNode> {\n    //eslint-disable-next-line functional/no-let,@typescript-eslint/no-this-alias\n    let n: QuadTreeNode | undefined = this;\n    while (n.#parent !== undefined) {\n      yield n.#parent;\n      n = n.#parent;\n    }\n  }\n\n  *children(): IterableIterator<QuadTreeNode> {\n    for (const c of this.#children) {\n      yield c;\n    }\n  }\n  /**\n   * Get a descendant node in a given direction\n   * @param d\n   * @returns\n   */\n  direction(d: Direction): QuadTreeNode | undefined {\n    return this.#children[d] as QuadTreeNode | undefined;\n  }\n\n  /**\n   * Add an item to the quadtree\n   * @param p\n   * @returns False if item is outside of boundary, True if item was added\n   */\n  add(p: QuadTreeItem): boolean {\n    if (!Shapes.isIntersecting(this.boundary, p)) return false;\n\n    if (this.#children.length) {\n      this.#children.forEach((d) => (d as QuadTreeNode).add(p));\n      return true;\n    }\n\n    this.#items.push(p);\n\n    if (\n      this.#items.length > this.opts.maxItems &&\n      this.level < this.opts.maxLevels\n    ) {\n      if (!this.#children.length) {\n        this.#subdivide();\n      }\n\n      // Add to child\n      this.#items.forEach((item) => {\n        this.#children.forEach((d) => (d as QuadTreeNode).add(item));\n      });\n      //this.descendants.forEach(d => (d as QuadTreeNode).add(p));\n      this.#items = [];\n    }\n    return true;\n  }\n\n  /**\n   * Returns true if point is inside node's boundary\n   * @param p\n   * @returns\n   */\n  couldHold(p: Points.Point) {\n    return Rects.intersectsPoint(this.boundary, p);\n  }\n\n  #subdivide() {\n    const w = this.boundary.width / 2;\n    const h = this.boundary.height / 2;\n    const x = this.boundary.x;\n    const y = this.boundary.y;\n\n    // top-left corners of each of the four new sections\n    const coords = Points.fromNumbers(x + w, y, x, y, x, y + h, x + w, y + h);\n    const rects = coords.map((p) => Rects.fromTopLeft(p, w, h));\n    // rects.forEach((r, index) => {\n    //   this.descendants[index] = new QuadTreeNode(r, this.level + 1, this.opts);\n    // });\n    this.#children = rects.map(\n      (r) => new QuadTreeNode(this, r, this.level + 1, this.opts)\n    );\n  }\n}\n","import { toCartesian } from './Polar.js';\nimport { throwIntegerTest } from '../Guards.js';\nimport { Triangles, Points, Rects, Circles } from './index.js';\nimport type { CirclePositioned } from './Circle.js';\nimport type { RandomSource } from '../Random.js';\nimport type { RectPositioned } from './Rect.js';\n\nexport type ContainsResult = `none` | `contained`;\n\nexport type ShapePositioned = CirclePositioned | RectPositioned;\n\n/**\n * Returns the intersection result between a and b.\n * @param a\n * @param b\n */\nexport const isIntersecting = (\n  a: ShapePositioned,\n  b: ShapePositioned | Points.Point\n): boolean => {\n  if (Circles.isCirclePositioned(a)) {\n    return Circles.isIntersecting(a, b);\n  } else if (Rects.isRectPositioned(a)) {\n    return Rects.isIntersecting(a, b);\n  }\n  throw new Error(\n    `a or b are unknown shapes. a: ${ JSON.stringify(a) } b: ${ JSON.stringify(b) }`\n  );\n};\n\n// export enum Quadrant {\n//   Nw, Ne, Sw, Se\n// }\n\nexport type RandomPointOpts = {\n  readonly randomSource?: RandomSource;\n  readonly margin?: Points.Point;\n};\n\nexport const randomPoint = (\n  shape: ShapePositioned,\n  opts: RandomPointOpts = {}\n): Points.Point => {\n  if (Circles.isCirclePositioned(shape)) {\n    return Circles.randomPoint(shape, opts);\n  } else if (Rects.isRectPositioned(shape)) {\n    return Rects.randomPoint(shape, opts);\n  }\n  throw new Error(`Cannot create random point for unknown shape`);\n};\n\n// export type Shape = {\n//   intersects(x:Points.Point|Shape):ContainsResult\n//   readonly kind:`circular`\n\n// }\n\n/**\n * Returns the center of a shape\n * Shape can be: rectangle, triangle, circle\n * @param shape\n * @returns\n */\nexport const center = (\n  shape?: Rects.Rect | Triangles.Triangle | Circles.Circle\n): Points.Point => {\n  if (shape === undefined) {\n    return Object.freeze({ x: 0.5, y: 0.5 });\n  } else if (Rects.isRect(shape)) {\n    return Rects.center(shape as Rects.Rect);\n  } else if (Triangles.isTriangle(shape)) {\n    return Triangles.centroid(shape);\n  } else if (Circles.isCircle(shape)) {\n    return Circles.center(shape);\n  } else {\n    throw new Error(`Unknown shape: ${ JSON.stringify(shape) }`);\n  }\n};\n\n/**\n * Generates a starburst shape, returning an array of points. By default, initial point is top and horizontally-centred.\n *\n * ```\n * // Generate a starburst with four spikes\n * const pts = starburst(4, 100, 200);\n * ```\n *\n * `points` of two produces a lozenge shape.\n * `points` of three produces a triangle shape.\n * `points` of five is the familiar 'star' shape.\n *\n * Note that the path will need to be closed back to the first point to enclose the shape.\n *\n * @example Create starburst and draw it. Note use of 'loop' flag to close the path\n * ```\n * const points = starburst(4, 100, 200);\n * Drawing.connectedPoints(ctx, pts, {loop: true, fillStyle: `orange`, strokeStyle: `red`});\n * ```\n *\n * Options:\n * * initialAngleRadian: angle offset to begin from. This overrides the `-Math.PI/2` default.\n *\n * @param points Number of points in the starburst. Defaults to five, which produces a typical star\n * @param innerRadius Inner radius. A proportionally smaller inner radius makes for sharper spikes. If unspecified, 50% of the outer radius is used.\n * @param outerRadius Outer radius. Maximum radius of a spike to origin\n * @param opts Options\n * @param origin Origin, or `{ x:0, y:0 }` by default.\n */\nexport const starburst = (\n  outerRadius: number,\n  points: number = 5,\n  innerRadius?: number,\n  origin: Points.Point = { x: 0, y: 0 },\n  opts?: { readonly initialAngleRadian?: number }\n): readonly Points.Point[] => {\n  throwIntegerTest(points, `positive`, `points`);\n  const angle = (Math.PI * 2) / points;\n  const angleHalf = angle / 2;\n\n  const initialAngle = opts?.initialAngleRadian ?? -Math.PI / 2;\n  if (innerRadius === undefined) innerRadius = outerRadius / 2;\n\n  //eslint-disable-next-line functional/no-let\n  let a = initialAngle;\n  const pts = [];\n\n  //eslint-disable-next-line functional/no-let\n  for (let i = 0; i < points; i++) {\n    const peak = toCartesian(outerRadius, a, origin);\n    const left = toCartesian(innerRadius, a - angleHalf, origin);\n    const right = toCartesian(innerRadius, a + angleHalf, origin);\n\n    //eslint-disable-next-line functional/immutable-data\n    pts.push(left, peak);\n    //eslint-disable-next-line functional/immutable-data\n    if (i + 1 < points) pts.push(right);\n    a += angle;\n  }\n  return pts;\n};\n\nexport type ArrowOpts = {\n  readonly arrowSize?: number;\n  readonly tailLength?: number;\n  readonly tailThickness?: number;\n  readonly angleRadian?: number;\n};\n\n/**\n * Returns the points forming an arrow.\n *\n * @example Create an arrow anchored by its tip at 100,100\n * ```js\n * const opts = {\n *  tailLength: 10,\n *  arrowSize: 20,\n *  tailThickness: 5,\n *  angleRadian: degreeToRadian(45)\n * }\n * const arrow = Shapes.arrow({x:100, y:100}, `tip`, opts); // Yields an array of points\n *\n * // Eg: draw points\n * Drawing.connectedPoints(ctx, arrow, {strokeStyle: `red`, loop: true});\n * ```\n *\n * @param origin Origin of arrow\n * @param from Does origin describe the tip, tail or middle?\n * @param opts Options for arrow\n * @returns\n */\nexport const arrow = (\n  origin: Points.Point,\n  from: `tip` | `tail` | `middle`,\n  opts: ArrowOpts = {}\n): readonly Points.Point[] => {\n  const tailLength = opts.tailLength ?? 10;\n  const tailThickness = opts.tailThickness ?? Math.max(tailLength / 5, 5);\n  const angleRadian = opts.angleRadian ?? 0;\n  const arrowSize = opts.arrowSize ?? Math.max(tailLength / 5, 15);\n\n  const triAngle = Math.PI / 2;\n\n  //eslint-disable-next-line functional/no-let\n  let tri: Triangles.Triangle;\n  //eslint-disable-next-line functional/no-let\n  let tailPoints: readonly Points.Point[];\n\n  if (from === `tip`) {\n    tri = Triangles.equilateralFromVertex(origin, arrowSize, triAngle);\n    tailPoints = Rects.corners(\n      Rects.fromTopLeft(\n        { x: tri.a.x - tailLength, y: origin.y - tailThickness / 2 },\n        tailLength,\n        tailThickness\n      )\n    );\n  } else if (from === `middle`) {\n    const midX = tailLength + arrowSize / 2;\n    const midY = tailThickness / 2;\n    tri = Triangles.equilateralFromVertex(\n      {\n        x: origin.x + arrowSize * 1.2,\n        y: origin.y,\n      },\n      arrowSize,\n      triAngle\n    );\n\n    tailPoints = Rects.corners(\n      Rects.fromTopLeft(\n        { x: origin.x - midX, y: origin.y - midY },\n        tailLength + arrowSize,\n        tailThickness\n      )\n    );\n  } else {\n    //const midY = origin.y - tailThickness/2;\n    tailPoints = Rects.corners(\n      Rects.fromTopLeft(\n        { x: origin.x, y: origin.y - tailThickness / 2 },\n        tailLength,\n        tailThickness\n      )\n    );\n    tri = Triangles.equilateralFromVertex(\n      { x: origin.x + tailLength + arrowSize * 0.7, y: origin.y },\n      arrowSize,\n      triAngle\n    );\n  }\n\n  const arrow = Points.rotate(\n    [\n      tailPoints[ 0 ],\n      tailPoints[ 1 ],\n      tri.a,\n      tri.b,\n      tri.c,\n      tailPoints[ 2 ],\n      tailPoints[ 3 ],\n    ],\n    angleRadian,\n    origin\n  );\n\n  return arrow;\n};\n","import { degreeToRadian, radianToDegree } from './index.js';\nimport * as Points from './Point.js';\nimport { throwNumberTest } from '../Guards.js';\nconst _piPi = Math.PI * 2;\n\n//eslint-disable-next-line @typescript-eslint/naming-convention\nconst EmptyCartesian = Object.freeze({ x: 0, y: 0 });\n\n/**\n * Polar coordinate, made up of a distance and angle in radians.\n * Most computations involving Coords require an `origin` as well.\n */\nexport type Coord = {\n  readonly distance: number;\n  readonly angleRadian: number;\n};\n\n/**\n * Converts to Cartesian coordiantes\n */\ntype ToCartesian = {\n  (point: Coord, origin?: Points.Point): Points.Point;\n  (distance: number, angleRadians: number, origin?: Points.Point): Points.Point;\n};\n\n/**\n * Returns true if `p` seems to be a {@link Coord} (ie has both distance & angleRadian fields)\n * @param p\n * @returns True if `p` seems to be a Coord\n */\nexport const isCoord = (p: number | unknown): p is Coord => {\n  if ((p as Coord).distance === undefined) return false;\n  if ((p as Coord).angleRadian === undefined) return false;\n  return true;\n};\n\n/**\n * Converts a Cartesian coordinate to polar\n *\n * ```js\n * import { Polar } from 'https://unpkg.com/ixfx/dist/geometry.js';\n *\n * // Yields: { angleRadian, distance }\n * const polar = Polar.fromCartesian({x: 50, y: 50}, origin);\n * ```\n *\n * Any additional properties of `point` are copied to object.\n * @param point Point\n * @param origin Origin\n * @returns\n */\nexport const fromCartesian = (\n  point: Points.Point,\n  origin: Points.Point\n): Coord => {\n  point = Points.subtract(point, origin);\n  //eslint-disable-next-line functional/no-let\n  //let a =  Math.atan2(point.y, point.x);\n  //if (a < 0) a = Math.abs(a);\n  //else a = Math.PI + (Math.PI - a);\n\n  const angle = Math.atan2(point.y, point.x);\n  //if (point.x < 0 && point.y > 0) angle += 180;\n  //if (point.x > 0 && point.y < 0) angle += 360;\n  //if (point.x < 0 && point.y < 0) angle += 180;\n\n  return Object.freeze({\n    ...point,\n    angleRadian: angle,\n    distance: Math.sqrt(point.x * point.x + point.y * point.y),\n  });\n};\n\n/**\n * Converts to Cartesian coordinate from polar.\n *\n * ```js\n * import { Polar } from 'https://unpkg.com/ixfx/dist/geometry.js';\n *\n * const origin = { x: 50, y: 50}; // Polar origin\n * // Yields: { x, y }\n * const polar = Polar.toCartesian({ distance: 10, angleRadian: 0 }, origin);\n * ```\n *\n * Distance and angle can be provided as numbers intead:\n *\n * ```\n * // Yields: { x, y }\n * const polar = Polar.toCartesian(10, 0, origin);\n * ```\n *\n * @param a\n * @param b\n * @param c\n * @returns\n */\nexport const toCartesian: ToCartesian = (\n  a: Coord | number,\n  b?: Points.Point | number,\n  c?: Points.Point\n): Points.Point => {\n  if (isCoord(a)) {\n    if (b === undefined) b = Points.Empty;\n    if (Points.isPoint(b)) {\n      return polarToCartesian(a.distance, a.angleRadian, b);\n    }\n    throw new Error(\n      `Expecting (Coord, Point). Second parameter is not a point`\n    );\n  } else if (typeof a === `object`) {\n    throw new Error(\n      `First param is an object, but not a Coord: ${ JSON.stringify(a) }`\n    );\n  } else {\n    if (typeof a === `number` && typeof b === `number`) {\n      if (c === undefined) c = Points.Empty;\n      if (!Points.isPoint(c)) {\n        throw new Error(\n          `Expecting (number, number, Point). Point param wrong type`\n        );\n      }\n      return polarToCartesian(a, b, c);\n    } else {\n      throw new Error(\n        `Expecting parameters of (number, number). Got: (${ typeof a }, ${ typeof b }, ${ typeof c }). a: ${ JSON.stringify(\n          a\n        ) }`\n      );\n    }\n  }\n};\n\n/**\n * Produces an Archimedean spiral. It's a generator.\n *\n * ```js\n * const s = spiral(0.1, 1);\n * for (const coord of s) {\n *  // Use Polar coord...\n *  if (coord.step === 1000) break; // Stop after 1000 iterations\n * }\n * ```\n *\n * @param smoothness 0.1 pretty rounded, at around 5 it starts breaking down\n * @param zoom At smoothness 0.1, zoom starting at 1 is OK\n */\n//eslint-disable-next-line func-style\nexport function* spiral(\n  smoothness: number,\n  zoom: number\n): IterableIterator<Coord & { readonly step: number }> {\n  //eslint-disable-next-line functional/no-let\n  let step = 0;\n\n  while (true) {\n    //eslint-disable-next-line functional/no-let\n    const a = smoothness * step++;\n    yield {\n      distance: zoom * a,\n      angleRadian: a,\n      step: step,\n    };\n  }\n}\n\n/**\n * Returns a rotated coordiante\n * @param c Coordinate\n * @param amountRadian Amount to rotate, in radians\n * @returns\n */\nexport const rotate = (c: Coord, amountRadian: number): Coord =>\n  Object.freeze({\n    ...c,\n    angleRadian: c.angleRadian + amountRadian,\n  });\n\nexport const normalise = (c: Coord): Coord => {\n  //guard(v, `v`);\n  if (c.distance === 0) throw new Error(`Cannot normalise vector of length 0`);\n  return Object.freeze({\n    ...c,\n    distance: 1,\n  });\n};\n\n/**\n * Throws an error if Coord is invalid\n * @param p\n * @param name\n */\nexport const guard = (p: Coord, name = `Point`) => {\n  if (p === undefined) {\n    throw new Error(\n      `'${ name }' is undefined. Expected {distance, angleRadian} got ${ JSON.stringify(\n        p\n      ) }`\n    );\n  }\n  if (p === null) {\n    throw new Error(\n      `'${ name }' is null. Expected {distance, angleRadian} got ${ JSON.stringify(\n        p\n      ) }`\n    );\n  }\n  if (p.angleRadian === undefined) {\n    throw new Error(\n      `'${ name }.angleRadian' is undefined. Expected {distance, angleRadian} got ${ JSON.stringify(\n        p\n      ) }`\n    );\n  }\n  if (p.distance === undefined) {\n    throw new Error(\n      `'${ name }.distance' is undefined. Expected {distance, angleRadian} got ${ JSON.stringify(\n        p\n      ) }`\n    );\n  }\n  if (typeof p.angleRadian !== `number`) {\n    throw new Error(\n      `'${ name }.angleRadian' must be a number. Got ${ p.angleRadian }`\n    );\n  }\n  if (typeof p.distance !== `number`) {\n    throw new Error(`'${ name }.distance' must be a number. Got ${ p.distance }`);\n  }\n\n  if (p.angleRadian === null) throw new Error(`'${ name }.angleRadian' is null`);\n  if (p.distance === null) throw new Error(`'${ name }.distance' is null`);\n\n  if (Number.isNaN(p.angleRadian)) {\n    throw new Error(`'${ name }.angleRadian' is NaN`);\n  }\n  if (Number.isNaN(p.distance)) throw new Error(`'${ name }.distance' is NaN`);\n};\n/**\n * Calculate dot product of two Coords.\n *\n * Eg, power is the dot product of force and velocity\n *\n * Dot products are also useful for comparing similarity of\n *  angle between two unit Coord.\n * @param a\n * @param b\n * @returns\n */\nexport const dotProduct = (a: Coord, b: Coord): number => {\n  guard(a, `a`);\n  guard(b, `b`);\n  return a.distance * b.distance * Math.cos(b.angleRadian - a.angleRadian);\n};\n\n/**\n * Inverts the direction of coordinate. Ie if pointing north, will point south.\n * @param p\n * @returns\n */\nexport const invert = (p: Coord): Coord => {\n  guard(p, `c`);\n  return Object.freeze({\n    ...p,\n    angleRadian: p.angleRadian - Math.PI,\n  });\n};\n\n/**\n * Returns true if Coords have same magnitude but opposite direction\n * @param a\n * @param b\n * @returns\n */\nexport const isOpposite = (a: Coord, b: Coord): boolean => {\n  guard(a, `a`);\n  guard(b, `b`);\n  if (a.distance !== b.distance) return false;\n  return a.angleRadian === -b.angleRadian;\n};\n\n/**\n * Returns true if Coords have the same direction, regardless of magnitude\n * @param a\n * @param b\n * @returns\n */\nexport const isParallel = (a: Coord, b: Coord): boolean => {\n  guard(a, `a`);\n  guard(b, `b`);\n  return a.angleRadian === b.angleRadian;\n};\n\n/**\n * Returns true if coords are opposite direction, regardless of magnitude\n * @param a\n * @param b\n * @returns\n */\nexport const isAntiParallel = (a: Coord, b: Coord): boolean => {\n  guard(a, `a`);\n  guard(b, `b`);\n  return a.angleRadian === -b.angleRadian;\n};\n\n/**\n * Returns a rotated coordinate\n * @param c Coordinate\n * @param amountDeg Amount to rotate, in degrees\n * @returns\n */\nexport const rotateDegrees = (c: Coord, amountDeg: number): Coord =>\n  Object.freeze({\n    ...c,\n    angleRadian: c.angleRadian + degreeToRadian(amountDeg),\n  });\n\n/**\n * Produces an Archimedian spiral with manual stepping.\n * @param step Step number. Typically 0, 1, 2 ...\n * @param smoothness 0.1 pretty rounded, at around 5 it starts breaking down\n * @param zoom At smoothness 0.1, zoom starting at 1 is OK\n * @returns\n */\nexport const spiralRaw = (\n  step: number,\n  smoothness: number,\n  zoom: number\n): Coord => {\n  const a = smoothness * step;\n  return Object.freeze({\n    distance: zoom * a,\n    angleRadian: a,\n  });\n};\n\n/**\n * Multiplies the magnitude of a coord by `amt`.\n * Direction is unchanged.\n * @param v\n * @param amt\n * @returns\n */\nexport const multiply = (v: Coord, amt: number): Coord => {\n  guard(v);\n  throwNumberTest(amt, ``, `amt`);\n  return Object.freeze({\n    ...v,\n    distance: v.distance * amt,\n  });\n};\n\n/**\n * Divides the magnitude of a coord by `amt`.\n * Direction is unchanged.\n * @param v\n * @param amt\n * @returns\n */\nexport const divide = (v: Coord, amt: number): Coord => {\n  guard(v);\n  throwNumberTest(amt, ``, `amt`);\n  return Object.freeze({\n    ...v,\n    distance: v.distance / amt,\n  });\n};\n\n/**\n * Clamps the magnitude of a vector\n * @param v\n * @param max\n * @param min\n * @returns\n */\nexport const clampMagnitude = (v: Coord, max = 1, min = 0): Coord => {\n  //eslint-disable-next-line functional/no-let\n  let mag = v.distance;\n  if (mag > max) mag = max;\n  if (mag < min) mag = min;\n  return Object.freeze({\n    ...v,\n    distance: mag,\n  });\n};\n\n/**\n * Converts a polar coordiante to Cartesian\n * @param distance Distance\n * @param angleRadians Angle in radians\n * @param origin Origin, or 0,0 by default.\n * @returns\n */\nconst polarToCartesian = (\n  distance: number,\n  angleRadians: number,\n  origin: Points.Point = Points.Empty\n): Points.Point => {\n  Points.guard(origin);\n  return Object.freeze({\n    x: origin.x + distance * Math.cos(angleRadians),\n    y: origin.y + distance * Math.sin(angleRadians),\n  });\n};\n\n/**\n * Returns a human-friendly string representation `(distance, angleDeg)`.\n * If `precision` is supplied, this will be the number of significant digits.\n * @param p\n * @returns\n */\nexport const toString = (p: Coord, digits?: number): string => {\n  if (p === undefined) return `(undefined)`;\n  if (p === null) return `(null)`;\n\n  const angleDeg = radianToDegree(p.angleRadian);\n  const d = digits ? p.distance.toFixed(digits) : p.distance;\n  const a = digits ? angleDeg.toFixed(digits) : angleDeg;\n  return `(${ d },${ a })`;\n};\n\nexport const toPoint = (v: Coord, origin = EmptyCartesian): Points.Point => {\n  guard(v, `v`);\n  return Object.freeze({\n    x: origin.x + v.distance * Math.cos(v.angleRadian),\n    y: origin.y + v.distance * Math.sin(v.angleRadian),\n  });\n};\n","// #region Import\nimport { afterMatch } from '../Text.js';\nimport { type QuadTreeItem } from '../geometry/QuadTree.js';\nimport { without } from './Arrays.js';\nimport * as Trees from './Trees.js';\nimport { couldAddChild, directChildren } from './Trees.js';\n// #endregion\n\n/**\n * Basic tree node implementation\n */\nexport class TreeNodeMutable<V> implements Trees.TreeNode {\n  value: V;\n  readonly label: string;\n  #children: readonly TreeNodeMutable<V>[];\n  #parent: TreeNodeMutable<V> | undefined;\n\n  /**\n   * Constructor\n   * @param value Value associated with node\n   * @param label Label\n   */\n  constructor(value: V, label: string) {\n    this.value = value;\n    this.label = label;\n    this.#children = [];\n  }\n\n  getLengthChildren(): number {\n    return this.#children.length;\n  }\n\n  hasChild = (possibleChild: TreeNodeMutable<V>) =>\n    Trees.hasChild(this, possibleChild);\n  hasAnyChild = (possibleChild: TreeNodeMutable<V>) =>\n    Trees.hasAnyChild(this, possibleChild);\n\n  hasParent = (possibleParent: TreeNodeMutable<V>) =>\n    Trees.hasParent(this, possibleParent);\n  hasAnyParent = (possibleParent: TreeNodeMutable<V>) =>\n    Trees.hasAnyParent(this, possibleParent);\n  getByPath = (\n    path: string,\n    opts: Trees.PathOpts = {}\n  ): TreeNodeMutable<V> | undefined => {\n    const e = Trees.getByPath(path, this, opts);\n    if (!e[1]) return;\n    return e[1] as TreeNodeMutable<V>;\n  };\n\n  /**\n   * Adds a value by a string path.\n   * Automatically generates intermediate nodes.\n   *\n   * ```js\n   * const rootValue = {}\n   * const root = treeNodeMutable(rootValue, 'pc');\n   * root.addValueByPath({x:'c'},  'c');\n   * root.addValueByPath({x:'admin'}, 'c.users.admin');\n   * ```\n   *\n   * Creates the structure:\n   * ```\n   * pc         {}\n   * + c        {x: 'c' }\n   *  + users   undefined\n   *   + admin  {x: 'admin'}\n   * ```\n   * @param value\n   * @param path\n   * @param pathOpts\n   */\n  addValueByPath(value: V, path: string, pathOpts: Trees.PathOpts = {}) {\n    const sep = pathOpts.separator ?? '.';\n    const split = path.split(sep);\n    const label = split.at(-1); //afterMatch(path, sep, { fromEnd: true });\n    let node: TreeNodeMutable<any> = this;\n\n    for (const p of split) {\n      const found = node?.findChild(p);\n      if (!found && node) {\n        const n = new TreeNodeMutable<V | undefined>(undefined, p);\n        node.add(n);\n        node = n;\n      } else if (found) {\n        node = found;\n      }\n    }\n    if (node) node.value = value;\n  }\n\n  /**\n   * Adds a child\n   * Throws an error if child cannot be added due to logical inconsistency (eg adding a child to self)\n   * @param child\n   */\n  add(child: TreeNodeMutable<V>) {\n    Trees.couldAddChild(this, child);\n    this.#children = [...this.#children, child];\n    if (child.#parent) {\n      child.#parent.remove(child);\n    }\n    child.#parent = this;\n  }\n\n  /**\n   * Removes a child node.\n   * Throws an exception if child was not found\n   * @param child\n   */\n  remove(child: TreeNodeMutable<V>) {\n    if (child.#parent !== this) throw new Error(`child.parent doesn't match`);\n    const w = without(this.#children, child);\n    if (w.length === this.#children.length)\n      throw new Error(`child not found in descendants`);\n    this.#children = w;\n  }\n\n  /**\n   * Sets the descendents of the node\n   * 'Unparents' existing children nodes. Checks each new node that it can\n   * be logically added\n   * @param d\n   */\n  setDescendants(d: TreeNodeMutable<V>[]) {\n    // Unset existing\n    for (const d of this.#children) {\n      d.#parent = undefined;\n    }\n\n    for (const dd of d) {\n      couldAddChild(this, dd);\n      dd.#parent = this;\n    }\n    this.#children = d;\n  }\n\n  /**\n   * Returns a string representation of tree\n   * @param indent\n   * @returns\n   */\n  prettyPrint(indent = 0): string {\n    const t = `${'  '.repeat(indent)} + label: ${this.label} value: ${\n      this.value ? JSON.stringify(this.value) : '-'\n    }`;\n    if (this.#children.length) {\n      return (\n        t +\n        '\\n' +\n        this.#children.map((d) => d.prettyPrint(indent + 1)).join('\\n')\n      );\n    } else {\n      return t;\n    }\n  }\n\n  /**\n   * Iterates all parents up to its root.\n   * First result is the immediate parent.\n   */\n  *parents(): IterableIterator<TreeNodeMutable<V>> {\n    let n: TreeNodeMutable<V> | undefined = this;\n    while (n.#parent !== undefined) {\n      yield n.#parent;\n      n = n.#parent;\n    }\n  }\n\n  /**\n   * Iterates over the direct descendents of node\n   */\n  *children(): IterableIterator<TreeNodeMutable<V>> {\n    for (const c of this.#children) {\n      yield c;\n    }\n  }\n\n  /**\n   * Searches direct children, returning the node that has the given `label`\n   * @param label\n   * @returns\n   */\n  findChild(label: string): TreeNodeMutable<V> | undefined {\n    if (label === undefined) throw new Error(`label param cannot be undefined`);\n    for (const c of this.#children) {\n      if (c.label === label) return c;\n    }\n  }\n\n  /**\n   * Returns _true_ if this node is root,\n   * ie. does not have a parent\n   */\n  get isRoot(): boolean {\n    return this.#parent === undefined;\n  }\n\n  /**\n   * Returns _true_ if this node has no children\n   */\n  get isEmpty(): boolean {\n    return this.#children.length === 0;\n  }\n}\n\n/**\n * Creates a tree node from an object\n * @param obj\n * @param label\n * @param parent\n * @returns\n */\nexport const fromObject = (\n  obj: object,\n  label = `root`,\n  parent?: TreeNodeMutable<any>\n): TreeNodeMutable<any> => {\n  const root = new TreeNodeMutable(obj, label);\n  if (parent) parent.add(root);\n  const children = [...directChildren(obj, label)];\n  const childNodes = children.map((c) => fromObject(c[1], c[0], root));\n  root.setDescendants(childNodes);\n  return root;\n};\n\n/**\n * Create a root tree node\n * @param value Value associated with node\n * @param label Label for node\n * @returns New TreeNodeMutable instance\n */\nexport const treeNodeMutable = <V>(value: V, label: string) =>\n  new TreeNodeMutable<V>(value, label);\n","import { isEqualDefault } from '../IsEqual.js'\n\nexport const max = <V>(iterable: Iterable<V>, scorer: (v: V) => number): V | undefined => {\n  let highestValue: V | undefined;\n  let highestScore = Number.MIN_SAFE_INTEGER;\n  for (const value of iterable) {\n    const score = scorer(value);\n    if (score >= highestScore) {\n      highestScore = score;\n      highestValue = value;\n    }\n  }\n  return highestValue;\n}\n\nexport const min = <V>(iterable: Iterable<V>, scorer: (v: V) => number): V | undefined => {\n  let lowestValue: V | undefined;\n  let lowestScore\n    = Number.MAX_SAFE_INTEGER;\n  for (const value of iterable) {\n    const score = scorer(value);\n    if (score <= lowestScore) {\n      lowestScore = score;\n      lowestValue = value;\n    }\n  }\n  return lowestValue;\n}\n\n/**\n * Returns _true_ if all values in iterables are equal, regardless\n * of their position. Uses === equality semantics by default.\n * \n * @example Default equality checking\n * ```js\n * const a = ['apples','oranges','pears'];\n * const b = ['pears','oranges','apples'];\n * compareValuesEqual(a, b); // True\n * ```\n *\n * @example Custom equality checking\n * ```js\n * const a = [ { name: 'John' }];\n * const b = [ { name: 'John' }];\n * // False, since object identies are different\n * compareValuesEqual(a, b); \n * // True, since now we're comparing by value\n * compareValuesEqual(a, b, (aa,bb) => aa.name === bb.name);\n * ```\n * @param arrays\n * @param eq\n */\nexport const compareValuesEqual = <V>(\n  //eslint-disable-next-line functional/prefer-readonly-type\n  iterableA: Iterable<V>,\n  iterableB: Iterable<V>,\n  eq = isEqualDefault<V>\n): boolean => {\n  const returnValue = compareValues(iterableA, iterableB, eq);\n  return returnValue.a.length === 0 && returnValue.b.length === 0;\n};\n\n\n/**\n * Compares the values of two iterables, returning a list\n * of items they have in common, and those unique in `a` or `b`.\n *\n * ```js\n * const a = ['apples', 'oranges', 'pears' ]\n * const b = ['pears', 'kiwis', 'bananas' ];\n *\n * const r = compareValues(a, b);\n * r.shared;  // [ 'pears' ]\n * r.a;       // [ 'apples', 'oranges' ]\n * r.b;       // [ 'kiwis', 'bananas' ]\n * @param a\n * @param b\n * @param eq\n * @returns\n */\nexport const compareValues = <V>(\n  a: Iterable<V>,\n  b: Iterable<V>,\n  eq = isEqualDefault<V>\n) => {\n  const shared = [];\n  const aUnique = [];\n  const bUnique = [];\n\n  for (const element of a) {\n    //eslint-disable-next-line functional/no-let\n    let seenInB = false;\n    for (const element_ of b) {\n      if (eq(element, element_)) {\n        seenInB = true;\n        break;\n      }\n    }\n    if (seenInB) {\n      //eslint-disable-next-line functional/immutable-data\n      shared.push(element);\n    } else {\n      //eslint-disable-next-line functional/immutable-data\n      aUnique.push(element);\n    }\n  }\n\n  for (const element of b) {\n    //eslint-disable-next-line functional/no-let\n    let seenInA = false;\n    for (const element_ of a) {\n      if (eq(element, element_)) {\n        seenInA = true;\n      }\n    }\n    if (!seenInA) {\n      //eslint-disable-next-line functional/immutable-data\n      bUnique.push(element);\n    }\n  }\n\n  return {\n    shared,\n    a: aUnique,\n    b: bUnique,\n  };\n};\n","export type { IStack } from './IStack.js';\nexport type { IStackMutable } from './IStackMutable.js';\nexport type { IStackImmutable } from './IStackImmutable.js';\n\n// ✔ Unit tested!\nexport type StackDiscardPolicy = `older` | `newer` | `additions`;\n\nexport type StackOpts = {\n  readonly debug?: boolean;\n  readonly capacity?: number;\n  readonly discardPolicy?: StackDiscardPolicy;\n};\n\nexport { immutable } from './StackImmutable.js';\nexport { mutable } from './StackMutable.js';\n","// -------------------------\n// Immutable\n// -------------------------\nimport type { IStackImmutable } from './IStackImmutable.js';\nimport { push, pop, isEmpty, isFull, peek } from './StackFns.js';\nimport type { StackOpts } from './index.js';\n\nexport class StackImmutable<V> implements IStackImmutable<V> {\n  private readonly opts: StackOpts;\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  readonly data: ReadonlyArray<V>;\n\n  constructor(opts: StackOpts = {}, data: ReadonlyArray<V> = []) {\n    this.opts = opts;\n    this.data = data;\n  }\n\n  push(...toAdd: ReadonlyArray<V>): StackImmutable<V> {\n    return new StackImmutable<V>(\n      this.opts,\n      push(this.opts, this.data, ...toAdd)\n    );\n  }\n\n  pop(): IStackImmutable<V> {\n    return new StackImmutable<V>(this.opts, pop(this.opts, this.data));\n  }\n\n  forEach(fn: (v: V) => void): void {\n    this.data.forEach(fn);\n  }\n\n  forEachFromTop(fn: (v: V) => void): void {\n    [...this.data].reverse().forEach(fn);\n  }\n\n  get isEmpty(): boolean {\n    return isEmpty(this.opts, this.data);\n  }\n\n  get isFull(): boolean {\n    return isFull(this.opts, this.data);\n  }\n\n  get peek(): V | undefined {\n    return peek(this.opts, this.data);\n  }\n\n  get length(): number {\n    return this.data.length;\n  }\n}\n\n/**\n * Returns a stack. Immutable. Use {@link Stacks.mutable} for a mutable alternative.\n *\n * The basic usage is `push`/`pop` to add/remove, returning the modified stack. Use the\n * property `peek` to see what's on top.\n *\n * @example Basic usage\n * ```js\n * // Create\n * let s = stack();\n * // Add one or more items\n * s = s.push(1, 2, 3, 4);\n * // See what's at the top of the stack\n * s.peek;      // 4\n *\n * // Remove from the top of the stack, returning\n * // a new stack without item\n * s = s.pop();\n * s.peek;        // 3\n * ```\n * @param opts Options\n * @param startingItems List of items to add to stack. Items will be pushed 'left to right', ie array index 0 will be bottom of the stack.\n */\nexport const immutable = <V>(\n  opts: StackOpts = {},\n  ...startingItems: ReadonlyArray<V>\n): IStackImmutable<V> => new StackImmutable({ ...opts }, [...startingItems]);\n","\nexport * from './QueueTypes.js';\nexport { type IQueueMutable } from './IQueueMutable.js';\nexport { type IQueueImmutable } from './IQueueImmutable.js';\nexport { type IPriorityQueueMutable } from './IPriorityQueueMutable.js';\nexport { type QueueOpts } from './QueueTypes.js';\nexport { immutable } from './QueueImmutable.js';\nexport { mutable } from './QueueMutable.js';\nexport { priority } from './PriorityMutable.js';\n","import type { IQueueImmutable } from './IQueueImmutable.js';\nimport { peek, isFull, isEmpty, enqueue, dequeue } from './QueueFns.js';\nimport { type QueueOpts } from './index.js';\n\n// -------------------------------\n// Immutable\n// -------------------------------\nexport class QueueImmutable<V> implements IQueueImmutable<V> {\n  readonly opts: QueueOpts<V>;\n  readonly data: ReadonlyArray<V>;\n\n  /**\n   * Creates an instance of Queue.\n   * @param {QueueOpts} opts Options foor queue\n   * @param {V[]} data Initial data. Index 0 is front of queue\n   * @memberof Queue\n   */\n  constructor(opts: QueueOpts<V> = {}, data: ReadonlyArray<V> = []) {\n    if (opts === undefined) throw new Error(`opts parameter undefined`);\n\n    this.opts = opts;\n    this.data = data;\n  }\n\n  forEach(fn: (v: V) => void) {\n    //eslint-disable-next-line functional/no-let\n    for (let index = this.data.length - 1; index >= 0; index--) {\n      fn(this.data[ index ]);\n    }\n  }\n\n  forEachFromFront(fn: (v: V) => void) {\n    // From front of queue\n    this.data.forEach(fn); //(vv) => fn(vv));\n  }\n\n  enqueue(...toAdd: ReadonlyArray<V>): QueueImmutable<V> {\n    return new QueueImmutable<V>(\n      this.opts,\n      enqueue(this.opts, this.data, ...toAdd)\n    );\n  }\n\n  dequeue(): QueueImmutable<V> {\n    return new QueueImmutable<V>(this.opts, dequeue(this.opts, this.data));\n  }\n\n  get isEmpty(): boolean {\n    return isEmpty(this.opts, this.data);\n  }\n\n  get isFull(): boolean {\n    return isFull(this.opts, this.data);\n  }\n\n  get length(): number {\n    return this.data.length;\n  }\n\n  get peek(): V | undefined {\n    return peek(this.opts, this.data);\n  }\n}\n\n/**\n * Returns an immutable queue. Queues are useful if you want to treat 'older' or 'newer'\n * items differently. _Enqueing_ adds items at the back of the queue, while\n * _dequeing_ removes items from the front (ie. the oldest).\n *\n * ```js\n * let q = Queues.immutable();           // Create\n * q = q.enqueue(`a`, `b`);   // Add two strings\n * const front = q.peek();    // `a` is at the front of queue (oldest)\n * q = q.dequeue();           // q now just consists of `b`\n * ```\n * @example Cap size to 5 items, throwing away newest items already in queue.\n * ```js\n * const q = Queues.immutable({capacity: 5, discardPolicy: `newer`});\n * ```\n *\n * @template V Data type of items\n * @param opts\n * @param startingItems Index 0 is the front of the queue\n * @returns A new queue\n */\nexport const immutable = <V>(\n  opts: QueueOpts<V> = {},\n  ...startingItems: ReadonlyArray<V>\n): IQueueImmutable<V> => {\n  opts = { ...opts }; // Make a copy of options\n  return new QueueImmutable(opts, [ ...startingItems ]); // Make a copy of array so it can't be modified\n};\n","import { isEqualDefault, type IsEqual } from \"../../IsEqual.js\";\nimport { max as IterablesMax, min as IterablesMin } from \"../Iterables.js\";\nimport type { IPriorityQueueMutable, PriorityItem } from \"./IPriorityQueueMutable.js\";\nimport { QueueMutable } from \"./QueueMutable.js\";\nimport type { QueueOpts } from \"./QueueTypes.js\";\n\nexport class PriorityMutable<V> extends QueueMutable<PriorityItem<V>> implements IPriorityQueueMutable<V> {\n\n  constructor(opts: QueueOpts<PriorityItem<V>> = {}) {\n    if (opts.eq === undefined) {\n      opts = {\n        ...opts,\n        eq: (a, b) => {\n          return isEqualDefault(a.item, b.item);\n        }\n      }\n    }\n    super(opts);\n  }\n\n  enqueueWithPriority(item: V, priority: number) {\n    super.enqueue({ item, priority });\n  }\n\n  changePriority(item: V, priority: number, addIfMissing = false, eq?: IsEqual<V>) {\n    if (item === undefined) throw new Error(`Item cannot be undefined`);\n    let toDelete: PriorityItem<V> | undefined;\n    for (const d of this.data) {\n      if (eq) {\n        if (eq(d.item, item)) {\n          toDelete = d;\n          break;\n        }\n      } else {\n        if (this.eq(d, { item, priority: 0 })) {\n          toDelete = d;\n          break;\n        }\n      }\n    }\n    if (toDelete === undefined && !addIfMissing) throw new Error(`Item not found in priority queue. Item: ${ JSON.stringify(item) }`);\n    if (toDelete !== undefined) {\n      this.remove(toDelete);\n    }\n    this.enqueueWithPriority(item, priority);\n  }\n\n  dequeueMax(): V | undefined {\n    const m = IterablesMax(this.data, v => v.priority);\n    if (m === undefined) return;\n    this.remove(m);\n    return m.item;\n  }\n\n  dequeueMin(): V | undefined {\n    const m = IterablesMin(this.data, v => v.priority);\n    if (m === undefined) return;\n    this.remove(m);\n    return m.item;\n  }\n\n  peekMax(): V | undefined {\n    const m = IterablesMax(this.data, v => v.priority);\n    if (m === undefined) return;\n    return m.item;\n  }\n\n  peekMin(): V | undefined {\n    const m = IterablesMin(this.data, v => v.priority);\n    if (m === undefined) return;\n    return m.item;\n  }\n}\n\nexport function priority<V>(\n  opts: QueueOpts<PriorityItem<V>> = {}\n): IPriorityQueueMutable<V> {\n  return new PriorityMutable(opts);\n}","export { create as expiringMap, ExpiringMap } from './ExpiringMap.js';\nexport type {\n  ExpiringMapEvent,\n  ExpiringMapEvents,\n  Opts as ExpiringMapOpts,\n} from './ExpiringMap.js';\n\nexport type { IMapOf } from './IMapOf.js';\nexport { immutable, type IMapImmutable } from './Map.js';\nexport { mutable, type IMapMutable } from './MapMutable.js';\nexport { ofSetMutable } from './MapOfSetMutable.js';\nexport { ofCircularMutable } from './MapOfCircularMutable.js';\nexport type { MapCircularOpts } from './MapOfCircularMutable.js';\nexport type { IMapOfMutable } from './IMapOfMutable.js';\nexport type { IMappish, IWithEntries } from './IMappish.js';\nexport type { MapArrayOpts } from './MapOfArrayMutable.js';\nexport { NumberMap } from './NumberMap.js';\nexport * from './MapMulti.js';\nexport * from './MapFns.js';\n","import { SimpleEventEmitter } from '../../Events.js';\nimport { sortByValueProperty } from './MapFns.js';\nimport { throwIntegerTest } from '../../Guards.js';\n\n/**\n * Expiring map options\n */\nexport type Opts = {\n  /**\n   * Capacity limit\n   */\n  readonly capacity?: number;\n  /**\n   * Policy for evicting items if capacity is reached\n   */\n  readonly evictPolicy?: `none` | `oldestGet` | `oldestSet`;\n  /**\n   * Automatic deletion policy.\n   * none: no automatic deletion (default)\n   * get/set: interval based on last get/set\n   * either: if either interval has elapsed\n   */\n  readonly autoDeletePolicy?: `none` | `get` | `set` | `either`;\n  /**\n   * Automatic deletion interval\n   */\n  readonly autoDeleteElapsedMs?: number;\n};\n\ntype Item<V> = {\n  readonly value: V;\n  readonly lastSet: number;\n  readonly lastGet: number;\n};\n\n/**\n * Event from the ExpiringMap\n */\nexport type ExpiringMapEvent<K, V> = {\n  readonly key: K;\n  readonly value: V;\n};\n\nexport type ExpiringMapEvents<K, V> = {\n  /**\n   * Fires when an item is removed due to eviction\n   * or automatic expiry\n   */\n  readonly expired: ExpiringMapEvent<K, V>;\n  /**\n   * Fires when a item with a new key is added\n   */\n  readonly newKey: ExpiringMapEvent<K, V>;\n\n  /**\n   * Fires when an item is manually removed,\n   * removed due to eviction or automatic expiry\n   */\n  readonly removed: ExpiringMapEvent<K, V>;\n};\n\n/**\n * Create a ExpiringMap instance\n * @param opts\n * @returns\n */\nexport const create = <K, V>(opts: Opts = {}): ExpiringMap<K, V> =>\n  new ExpiringMap(opts);\n/***\n * A map that can have a capacity limit. The elapsed time for each get/set\n * operation is maintained allowing for items to be automatically removed.\n * `has()` does not affect the last access time.\n *\n * By default, it uses the `none` eviction policy, meaning that when full\n * an error will be thrown if attempting to add new keys.\n *\n * Eviction policies:\n * `oldestGet` removes the item that hasn't been accessed the longest,\n * `oldestSet` removes the item that hasn't been updated the longest.\n *\n * ```js\n * const map = new ExpiringMap();\n * map.set(`fruit`, `apple`);\n *\n * // Remove all entries that were set more than 100ms ago\n * map.deleteWithElapsed(100, `set`);\n * // Remove all entries that were last accessed more than 100ms ago\n * map.deleteWithElapsed(100, `get`);\n * // Returns the elapsed time since `fruit` was last accessed\n * map.elapsedGet(`fruit`);\n * // Returns the elapsed time since `fruit` was last set\n * map.elapsedSet(`fruit`);\n * ```\n *\n * Last set/get time for a key can be manually reset using `touch(key)`.\n *\n *\n * Events:\n * * `expired`: when an item is automatically removed.\n * * `removed`: when an item is manually or automatically removed.\n * * `newKey`: when a new key is added\n *\n * ```js\n * map.addEventListener(`expired`, evt => {\n *  const { key, value } = evt;\n * });\n * ```\n * The map can automatically remove items based on elapsed intervals.\n *\n * @example Automatically delete items that haven't been accessed for one second\n * ```js\n * const map = new ExpiringMap({\n *  autoDeleteElapsed: 1000,\n *  autoDeletePolicy: `get`\n * });\n * ```\n *\n * @example Automatically delete the oldest item if we reach a capacity limit\n * ```\n * const map = new ExpiringMap({\n *  capacity: 5,\n *  evictPolicy: `oldestSet`\n * });\n * ```\n */\nexport class ExpiringMap<K, V> extends SimpleEventEmitter<\n  ExpiringMapEvents<K, V>\n> {\n  private capacity: number;\n  private store: Map<K, Item<V>>;\n  private keyCount: number;\n  private evictPolicy;\n\n  private autoDeleteElapsedMs: number;\n  private autoDeletePolicy;\n\n  constructor(opts: Opts = {}) {\n    super();\n    this.capacity = opts.capacity ?? -1;\n\n    throwIntegerTest(this.capacity, `nonZero`, `capacity`);\n    this.store = new Map();\n    this.keyCount = 0;\n\n    if (opts.evictPolicy && this.capacity <= 0) {\n      throw new Error(`evictPolicy is set, but no capacity limit is set`);\n    }\n    this.evictPolicy = opts.evictPolicy ?? `none`;\n    this.autoDeleteElapsedMs = opts.autoDeleteElapsedMs ?? -1;\n    this.autoDeletePolicy = opts.autoDeletePolicy ?? `none`;\n\n    if (this.autoDeleteElapsedMs > 0) {\n      setInterval(\n        () => this.#maintain(),\n        Math.max(1000, this.autoDeleteElapsedMs * 2)\n      );\n    }\n  }\n\n  /**\n   * Returns the number of keys being stored.\n   */\n  get keyLength() {\n    return this.keyCount;\n  }\n\n  *entries(): IterableIterator<[ k: K, v: V ]> {\n    for (const entry of this.store.entries()) {\n      yield [ entry[ 0 ], entry[ 1 ].value ];\n    }\n  }\n\n  *values(): IterableIterator<V> {\n    for (const v of this.store.values()) {\n      yield v.value;\n    }\n  }\n\n  *keys(): IterableIterator<K> {\n    yield* this.store.keys();\n  }\n\n  /**\n   * Returns the elapsed time since `key`\n   * was set. Returns _undefined_ if `key`\n   * does not exist\n   */\n  elapsedSet(key: K): number | undefined {\n    const v = this.store.get(key);\n    if (!v) return v;\n    return Date.now() - v.lastSet;\n  }\n\n  /**\n   * Returns the elapsed time since `key`\n   * was accessed. Returns _undefined_ if `key`\n   * does not exist\n   */\n  elapsedGet(key: K): number | undefined {\n    const v = this.store.get(key);\n    if (!v) return v;\n    return Date.now() - v.lastGet;\n  }\n\n  /**\n   * Returns true if `key` is stored.\n   * Does not affect the key's last access time.\n   * @param key\n   * @returns\n   */\n  has(key: K): boolean {\n    return this.store.has(key);\n  }\n\n  /**\n   * Gets an item from the map by key, returning\n   * undefined if not present\n   * @param key Key\n   * @returns Value, or undefined\n   */\n  get(key: K): V | undefined {\n    const v = this.store.get(key);\n    if (v) {\n      return v.value;\n    }\n  }\n\n  /**\n   * Deletes the value under `key`, if present.\n   *\n   * Returns _true_ if something was removed.\n   * @param key\n   * @returns\n   */\n  delete(key: K): boolean {\n    const val = this.store.get(key);\n    if (!val) return false;\n    const d = this.store.delete(key);\n    this.keyCount = this.keyCount - 1;\n    this.fireEvent(`removed`, {\n      key,\n      value: val.value,\n    });\n    return d;\n  }\n\n  /**\n   * Updates the lastSet/lastGet time for a value\n   * under `k`.\n   *\n   * Returns false if key was not found\n   * @param key\n   * @returns\n   */\n  touch(key: K): boolean {\n    const v = this.store.get(key);\n    if (!v) return false;\n    this.store.set(key, {\n      ...v,\n      lastSet: Date.now(),\n      lastGet: Date.now(),\n    });\n    return true;\n  }\n\n  private findEvicteeKey() {\n    if (this.evictPolicy === `none`) return null;\n    //eslint-disable-next-line functional/no-let\n    let sortBy = ``;\n    if (this.evictPolicy === `oldestGet`) sortBy = `lastGet`;\n    else if (this.evictPolicy === `oldestSet`) sortBy = `lastSet`;\n    else throw Error(`Unknown eviction policy ${ this.evictPolicy }`);\n    const sorted = sortByValueProperty(this.store, sortBy);\n    return sorted[ 0 ][ 0 ];\n  }\n\n  #maintain() {\n    if (this.autoDeletePolicy === `none`) return;\n    this.deleteWithElapsed(this.autoDeleteElapsedMs, this.autoDeletePolicy);\n  }\n\n  /**\n   * Deletes all values where elapsed time has past\n   * for get/set or either.\n   *\n   * Remove items are returned\n   * @param time\n   * @param prop get/set/either\n   */\n  deleteWithElapsed(\n    time: number,\n    prop: `get` | `set` | `either`\n  ): [ k: K, v: V ][] {\n    const entries = [ ...this.store.entries() ];\n    const prune: [ k: K, v: V ][] = [];\n    const now = Date.now();\n    for (const e of entries) {\n      const elapsedGet = now - e[ 1 ].lastGet;\n      const elapsedSet = now - e[ 1 ].lastSet;\n      const elapsed =\n        prop === `get`\n          ? elapsedGet\n          : prop === `set`\n            ? elapsedSet\n            : Math.max(elapsedGet, elapsedSet);\n      if (elapsed >= time) {\n        prune.push([ e[ 0 ], e[ 1 ].value ]);\n      }\n    }\n\n    for (const e of prune) {\n      this.store.delete(e[ 0 ]);\n      this.keyCount = this.keyCount - 1;\n      const eventArgs = {\n        key: e[ 0 ],\n        value: e[ 1 ],\n      };\n      this.fireEvent(`expired`, eventArgs);\n      this.fireEvent(`removed`, eventArgs);\n    }\n    return prune;\n  }\n\n  /**\n   * Sets the `key` to be `value`.\n   *\n   * If the key already exists, it is updated.\n   *\n   * If the map is full, according to its capacity,\n   * another value is selected for removal.\n   * @param key\n   * @param value\n   * @returns\n   */\n  set(key: K, value: V) {\n    const existing = this.store.get(key);\n\n    if (existing) {\n      // Update set time\n      this.store.set(key, {\n        ...existing,\n        lastSet: performance.now(),\n      });\n      return;\n    }\n\n    // New key\n    if (this.keyCount === this.capacity && this.capacity > 0) {\n      // Evict first\n      const key = this.findEvicteeKey();\n      if (!key) {\n        throw new Error(`ExpiringMap full (capacity: ${ this.capacity })`);\n      }\n      const existing = this.store.get(key);\n      this.store.delete(key);\n      this.keyCount = this.keyCount - 1;\n      if (existing) {\n        const eventArgs = { key, value: existing.value };\n        this.fireEvent(`expired`, eventArgs);\n        this.fireEvent(`removed`, eventArgs);\n      }\n    }\n\n    this.keyCount++;\n    this.store.set(key, {\n      lastGet: 0,\n      lastSet: Date.now(),\n      value: value,\n    });\n\n    this.fireEvent(`newKey`, { key, value });\n  }\n}\n","import type { ArrayKeys, EitherKey, ObjKeys } from '../index.js';\n\n/**\n * Adds an array o [k,v] to the map, returning a new instance\n * @param map Initial data\n * @param data Data to add\n * @returns New map with data added\n */\nconst addArray = <K, V>(\n  map: ReadonlyMap<K, V>,\n  data: ArrayKeys<K, V>\n): ReadonlyMap<K, V> => {\n  const x = new Map<K, V>(map.entries());\n  data.forEach((d) => {\n    if (d[0] === undefined) throw new Error(`key cannot be undefined`);\n    if (d[1] === undefined) throw new Error(`value cannot be undefined`);\n    x.set(d[0], d[1]);\n  });\n  return x;\n};\n\n/**\n * Adds objects to the map, returning a new instance\n * @param map Initial data\n * @param data Data to add\n * @returns A new map with data added\n */\nconst addObjects = <K, V>(\n  map: ReadonlyMap<K, V>,\n  data: ObjKeys<K, V>\n): ReadonlyMap<K, V> => {\n  const x = new Map<K, V>(map.entries());\n  data.forEach((d) => {\n    if (d.key === undefined) throw new Error(`key cannot be undefined`);\n    if (d.value === undefined) throw new Error(`value cannot be undefined`);\n\n    x.set(d.key, d.value);\n  });\n  return x;\n};\n\n/**\n * Returns true if map contains key\n *\n * @example\n * ```js\n * if (has(map, `London`)) ...\n * ```\n * @param map Map to search\n * @param key Key to find\n * @returns True if map contains key\n */\nexport const has = <K, V>(map: ReadonlyMap<K, V>, key: K): boolean =>\n  map.has(key);\n\n/**\n * Adds data to a map, returning the new map.\n *\n * Can add items in the form of [key,value] or {key, value}.\n * @example These all produce the same result\n * ```js\n * map.set(`hello`, `samantha`);\n * map.add([`hello`, `samantha`]);\n * map.add({key: `hello`, value: `samantha`})\n * ```\n * @param map Initial data\n * @param data One or more data to add in the form of [key,value] or {key, value}\n * @returns New map with data added\n */\nexport const add = <K, V>(\n  map: ReadonlyMap<K, V>,\n  ...data: EitherKey<K, V>\n): ReadonlyMap<K, V> => {\n  if (map === undefined) throw new Error(`map parameter is undefined`);\n  if (data === undefined) throw new Error(`data parameter i.s undefined`);\n  if (data.length === 0) return map;\n\n  const firstRecord = data[0];\n  const isObj =\n    typeof (firstRecord as { readonly key: K; readonly value: V }).key !==\n      `undefined` &&\n    typeof (firstRecord as { readonly key: K; readonly value: V }).value !==\n      `undefined`; //(typeof (data[0] as {readonly key:K}).key !== undefined && typeof (data[0] as {readonly value:V}).value !== undefined);\n  return isObj\n    ? addObjects(map, data as ObjKeys<K, V>)\n    : addArray(map, data as ArrayKeys<K, V>);\n};\n\n/**\n * Sets data in a copy of the initial map\n * @param map Initial map\n * @param key Key\n * @param value Value to  set\n * @returns New map with data set\n */\nexport const set = <K, V>(map: ReadonlyMap<K, V>, key: K, value: V) => {\n  const x = new Map<K, V>(map.entries());\n  x.set(key, value);\n  return x;\n};\n\n/**\n * Delete a key from the map, returning a new map\n * @param map Initial data\n * @param key\n * @returns New map with data deleted\n */\nexport const del = <K, V>(\n  map: ReadonlyMap<K, V>,\n  key: K\n): ReadonlyMap<K, V> => {\n  const x = new Map<K, V>(map.entries());\n  x.delete(key);\n  return x;\n};\n","import { type EitherKey } from '../index.js';\nimport type { IMapBase } from './IMapBase.js';\nimport { add, del, set } from './MapImmutableFns.js';\n\n/**\n * An immutable map. Rather than changing the map, functions like `add` and `delete`\n * return a new map reference which must be captured.\n *\n * Immutable data is useful because as it gets passed around your code, it never\n * changes from underneath you. You have what you have.\n *\n * @example\n * ```js\n * let m = map(); // Create\n * let m2 = m.set(`hello`, `samantha`);\n * // m is still empty, only m2 contains a value.\n * ```\n *\n * @template K Type of map keys. Typically `string`\n * @template V Type of stored values\n */\n//eslint-disable-next-line @typescript-eslint/consistent-type-definitions\nexport interface IMapImmutable<K, V> extends IMapBase<K, V> {\n  /**\n   * Adds one or more items, returning the changed map.\n   *\n   * Can add items in the form of `[key,value]` or `{key, value}`.\n   * @example These all produce the same result\n   * ```js\n   * map.set(`hello`, `samantha`);\n   * map.add([`hello`, `samantha`]);\n   * map.add({key: `hello`, value: `samantha`})\n   * ```\n   * @param itemsToAdd\n   */\n  add(...itemsToAdd: EitherKey<K, V>): IMapImmutable<K, V>;\n  /**\n   * Deletes an item by key, returning the changed map\n   * @param key\n   */\n  delete(key: K): IMapImmutable<K, V>;\n  /**\n   * Returns an empty map\n   */\n  clear(): IMapImmutable<K, V>;\n\n\n  /**\n   * Sets `key` to be `value`, overwriting anything existing.\n   * Returns a new map with added key.\n   * @param key\n   * @param value\n   */\n  set(key: K, value: V): IMapImmutable<K, V>;\n\n}\n\n/**\n * Returns an {@link IMapImmutable}.\n * Use {@link Maps.mutable} as a mutable alternatve.\n *\n * @example Basic usage\n * ```js\n * // Creating\n * let m = map();\n * // Add\n * m = m.set(\"name\", \"sally\");\n * // Recall\n * m.get(\"name\");\n * ```\n *\n * @example Enumerating\n * ```js\n * for (const [key, value] of map.entries()) {\n *  console.log(`${key} = ${value}`);\n * }\n * ```\n *\n * @example Overview\n * ```js\n * // Create\n * let m = map();\n * // Add as array or key & value pair\n * m = m.add([\"name\" , \"sally\"]);\n * m = m.add({ key: \"name\", value: \"sally\" });\n * // Add using the more typical set\n * m = m.set(\"name\", \"sally\");\n * m.get(\"name\");   // \"sally\";\n * m.has(\"age\");    // false\n * m.has(\"name\");   // true\n * m.isEmpty;       // false\n * m = m.delete(\"name\");\n * m.entries();     // Iterator of key value pairs\n * ```\n *\n * Since it is immutable, `add()`, `delete()` and `clear()` return a new version with change.\n *\n * @param dataOrMap Optional initial data in the form of an array of `{ key: value }` or `[ key, value ]`\n */\nexport const immutable = <K, V>(\n  dataOrMap?: ReadonlyMap<K, V> | EitherKey<K, V>\n): IMapImmutable<K, V> => {\n  if (dataOrMap === undefined) return immutable([]);\n  if (Array.isArray(dataOrMap)) return immutable<K, V>(add(new Map(), ...dataOrMap));\n\n  const data = dataOrMap as ReadonlyMap<K, V>;\n  return {\n    add: (...itemsToAdd: EitherKey<K, V>) => {\n      const s = add(data, ...itemsToAdd);\n      return immutable(s);\n    },\n    set: (key: K, value: V) => {\n      const s = set(data, key, value);\n      return immutable(s);\n    },\n    get: (key: K) => data.get(key),\n    delete: (key: K) => immutable(del(data, key)),\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    clear: () => immutable(),\n    has: (key: K) => data.has(key),\n    entries: () => data.entries(),\n    values: () => data.values(),\n    isEmpty: () => data.size === 0,\n  };\n};\n","import { type EitherKey } from '../index.js';\nimport type { IMapBase } from './IMapBase.js';\nimport { add, del, set, has } from './MapImmutableFns.js';\n\n/**\n * A mutable map.\n *\n * It is a wrapper around the in-built Map type, but adds roughly the same API as {@link IMapImmutable}.\n *\n * @template K Type of map keys. Typically `string`\n * @template V Type of stored values\n */\n//eslint-disable-next-line @typescript-eslint/consistent-type-definitions\nexport interface IMapMutable<K, V> extends IMapBase<K, V> {\n  /**\n   * Adds one or more items to map\n   *\n   * Can add items in the form of [key,value] or `{key, value}`.\n   * @example These all produce the same result\n   * ```js\n   * map.set(`hello`, `samantha`);\n   * map.add([`hello`, `samantha`]);\n   * map.add({key: `hello`, value: `samantha`})\n   * ```\n   * @param itemsToAdd\n   * @param itemsToAdd\n   */\n  add(...itemsToAdd: EitherKey<K, V>): void;\n  /**\n   * Sets a value to a specified key\n   * @param key\n   * @param value\n   */\n  set(key: K, value: V): void;\n  /**\n   * Deletes an item by key\n   * @param key\n   */\n  delete(key: K): void;\n  /**\n   * Clears map\n   */\n  clear(): void;\n}\n\n/**\n * Returns a {@link IMapMutable} (which just wraps the in-built Map)\n * Use {@link Maps.immutable} for the immutable alternative.\n *\n * @example Basic usage\n * ```js\n * const m = mapMutable();\n * // Add one or more entries\n * m.add([\"name\", \"sally\"]);\n * // Alternatively:\n * m.set(\"name\", \"sally\");\n * // Recall\n * m.get(\"name\");           // \"sally\"\n * m.delete(\"name\");\n * m.isEmpty; // True\n * m.clear();\n * ```\n * @param data Optional initial data in the form of an array of `{ key: value }` or `[ key, value ]`\n */\nexport const mutable = <K, V>(...data: EitherKey<K, V>): IMapMutable<K, V> => {\n  // eslint-disable-next-line functional/no-let\n  let m = add(new Map<K, V>(), ...data);\n  return {\n    add: (...data: EitherKey<K, V>) => {\n      m = add(m, ...data);\n    },\n    delete: (key: K) => {\n      m = del(m, key);\n    },\n    clear: () => {\n      m = add(new Map<K, V>());\n    },\n    set: (key: K, value: V): void => {\n      m = set(m, key, value);\n    },\n    get: (key: K): V | undefined => m.get(key),\n    entries: () => m.entries(),\n    values: () => m.values(),\n    isEmpty: () => m.size === 0,\n    has: (key: K) => has(m, key),\n  };\n};\n","import {\n  type IsEqual,\n  isEqualDefault\n} from '../../IsEqual.js';\nimport type {\n  MapArrayEvents,\n  IMapOfMutableExtended,\n} from './IMapOfMutableExtended.js';\nimport type { MapMultiOpts, MultiValue } from './MapMulti.js';\nimport { SimpleEventEmitter } from '../../Events.js';\nimport type { IMapOf } from './IMapOf.js';\nimport { toStringDefault, type ToString } from '../../Util.js';\n\n/**\n * @internal\n */\nexport class MapOfMutableImpl<V, M>\n  extends SimpleEventEmitter<MapArrayEvents<V>>\n  implements IMapOfMutableExtended<V, M>\n{\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  readonly #map = new Map<string, M>();\n  readonly groupBy: ToString<V>;\n  readonly type: MultiValue<V, M>;\n\n  constructor(type: MultiValue<V, M>, opts: MapMultiOpts<V> = {}) {\n    super();\n    this.type = type;\n    this.groupBy = opts.groupBy ?? toStringDefault;\n  }\n\n  /**\n   * Returns the type name. For in-built implementations, it will be one of: array, set or circular\n   */\n  get typeName() {\n    return this.type.name;\n  }\n\n  /**\n   * Returns the length of the longest child list\n   */\n  get lengthMax() {\n    //eslint-disable-next-line functional/no-let\n    let m = 0;\n    for (const v of this.#map.values()) {\n      m = Math.max(m, this.type.count(v));\n    }\n    return m;\n  }\n\n  debugString(): string {\n    const keys = [ ...this.#map.keys() ];\n    // eslint-disable-next-line functional/no-let\n    let r = `Keys: ${ keys.join(`, `) }\\r\\n`;\n    for (const k of keys) {\n      const v = this.#map.get(k);\n      if (v === undefined) {\n        r += ` - ${ k } (undefined)\\r\\n`\n      } else {\n        const asArray = this.type.toArray(v);\n        if (asArray !== undefined) {\n          r += ` - ${ k } (${ this.type.count(v) }) = ${ JSON.stringify(\n            asArray\n          ) }\\r\\n`;\n        }\n      }\n    };\n    return r;\n  }\n\n  get isEmpty(): boolean {\n    return this.#map.size === 0;\n  }\n\n  clear() {\n    this.#map.clear();\n    super.fireEvent(`clear`, true);\n  }\n\n  //eslint-disable-next-line functional/prefer-immutable-types\n  addKeyedValues(key: string, ...values: Array<V>) {\n    const set = this.#map.get(key);\n    if (set === undefined) {\n      this.#map.set(key, this.type.add(undefined, values));\n      super.fireEvent(`addedKey`, { key: key });\n      super.fireEvent(`addedValues`, { values: values });\n    } else {\n      // eslint-disable-next-line functional/immutable-data\n      this.#map.set(key, this.type.add(set, values));\n      super.fireEvent(`addedValues`, { values: values });\n    }\n  }\n  //eslint-disable-next-line functional/prefer-immutable-types\n  set(key: string, values: Array<V>) {\n    this.addKeyedValues(key, ...values);\n    return this;\n  }\n\n  addValue(...values: ReadonlyArray<V>) {\n    for (const v of values) this.addKeyedValues(this.groupBy(v), v);\n  }\n\n  hasKeyValue(key: string, value: V, eq: IsEqual<V>): boolean {\n    const m = this.#map.get(key);\n    if (m === undefined) return false;\n    return this.type.has(m, value, eq);\n  }\n\n  //eslint-disable-next-line functional/prefer-tacit\n  has(key: string): boolean {\n    return this.#map.has(key);\n  }\n\n  deleteKeyValue(key: string, value: V): boolean {\n    const a = this.#map.get(key);\n    if (a === undefined) return false;\n    return this.deleteKeyValueFromMap(a, key, value);\n  }\n\n  private deleteKeyValueFromMap(map: M, key: string, value: V): boolean {\n    const preCount = this.type.count(map);\n    const filtered = this.type.without(map, value);\n    const postCount = filtered.length;\n    this.#map.set(key, this.type.add(undefined, filtered));\n    return preCount > postCount;\n  }\n\n  deleteByValue(value: V): boolean {\n    //eslint-disable-next-line functional/no-let\n    let something = false;\n    [ ...this.#map.keys() ].filter((key) => {\n      const a = this.#map.get(key);\n      if (!a) throw new Error(`Bug: map could not be accessed`);\n      if (this.deleteKeyValueFromMap(a, key, value)) {\n        something = true; // note that something was deleted\n\n        // If key is empty, delete it\n        if (this.count(key) === 0) this.delete(key);\n      }\n    });\n    return something;\n  }\n\n  delete(key: string): boolean {\n    const a = this.#map.get(key);\n    if (a === undefined) return false;\n    this.#map.delete(key);\n    this.fireEvent(`deleteKey`, { key: key });\n    return true;\n  }\n\n  firstKeyByValue(\n    value: V,\n    eq: IsEqual<V> = isEqualDefault\n  ): string | undefined {\n    const keys = [ ...this.#map.keys() ];\n    const found = keys.find((key) => {\n      const a = this.#map.get(key);\n      if (a === undefined) throw new Error(`Bug: map could not be accessed`);\n      const r = this.type.has(a, value, eq);\n      return r;\n    });\n    return found;\n  }\n\n  count(key: string): number {\n    const entry = this.#map.get(key);\n    if (entry === undefined) return 0;\n    return this.type.count(entry);\n  }\n\n  /**\n   * Iterates over values stored under `key`\n   * An empty array is returned if there are no values\n   */\n  *get(key: string): IterableIterator<V> {\n    const m = this.#map.get(key);\n    if (m === undefined) return;\n    yield* this.type.iterable(m);\n  }\n\n  /**\n   * Iterate over the values stored under `key`.\n   * If key does not exist, iteration is essentially a no-op\n   * @param key\n   * @returns\n   */\n  *valuesFor(key: string) {\n    const m = this.#map.get(key);\n    if (m === undefined) return;\n    yield* this.type.iterable(m);\n  }\n\n  //eslint-disable-next-line functional/prefer-tacit\n  getSource(key: string): M | undefined {\n    return this.#map.get(key);\n  }\n\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  *keys(): IterableIterator<string> {\n    yield* this.#map.keys();\n    //return Array.from(this.#map.keys());\n  }\n\n  *entriesFlat(): IterableIterator<[ key: string, value: V ]> {\n    for (const entry of this.#map.entries()) {\n      for (const v of this.type.iterable(entry[ 1 ])) {\n        yield [ entry[ 0 ], v ];\n      }\n    }\n  }\n\n  *valuesFlat(): IterableIterator<V> {\n    for (const entry of this.#map.entries()) {\n      yield* this.type.iterable(entry[ 1 ]);\n    }\n  }\n\n  *entries(): IterableIterator<[ key: string, value: Array<V> ]> {\n    //yield* this.#map.entries();\n    for (const [ k, v ] of this.#map.entries()) {\n      const temporary = [ ...this.type.iterable(v) ];\n      yield [ k, temporary ];\n    }\n  }\n\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  *keysAndCounts(): IterableIterator<[ string, number ]> {\n    //const keys = this.keys();\n    /* eslint-disable-next-line functional/prefer-readonly-type */\n    //const r = keys.map(k => [k, this.count(k)]) as Array<[string, number]>;\n    //return r;\n\n    for (const key of this.keys()) {\n      yield [ key, this.count(key) ];\n    }\n  }\n\n  merge(other: IMapOf<V>) {\n    // const keys = other.keys();\n    // keys.forEach(key => {\n    //   const data = other.get(key);\n    //   if (data !== undefined) this.addKeyedValues(key, ...data);\n    // });\n    for (const key of other.keys()) {\n      const data = other.get(key);\n      this.addKeyedValues(key, ...data);\n    }\n  }\n\n  get size() {\n    return this.#map.size;\n  }\n  /*\n    forEach_(\n      fn: (\n        value: ReadonlyArray<V>,\n        key: string,\n        //eslint-disable-next-line functional/prefer-immutable-types\n        map: Map<string, ReadonlyArray<V>>\n      ) => void,\n      _?: any\n    ) {\n      // for (const [key,value] of this.#map.entries()) {\n      //   value\n      // }\n      // @ts-expect-error\n      this.#map.forEach(fn);\n    }\n    */\n\n  get [ Symbol.toStringTag ]() {\n    return this.#map[ Symbol.toStringTag ];\n  }\n\n  // [Symbol.iterator]() {\n  //   return this.type[Symbol.iterator]();\n  // }\n}\n","import { toStringDefault } from '../../Util.js';\nimport { without } from '../Arrays.js';\nimport type { MapSetOpts, MultiValue } from './MapMulti.js';\nimport { MapOfMutableImpl } from './MapOfMultiImpl.js';\nimport {\n  hasAnyValue as mapHasAnyValue,\n  toArray as mapToArray,\n  find as mapFind,\n  filter as mapFilter,\n  addKeepingExisting,\n} from './MapFns.js';\nimport type { IMapOfMutableExtended } from './IMapOfMutableExtended.js';\n\n/**\n * Returns a {@link IMapOfMutableExtended} that uses a set to hold values.\n * This means that only unique values are stored under each key. By default it\n * uses the JSON representation to compare items.\n *\n * Options: `{ hash: toStringFn } }`\n *\n * `hash` is a {@link Util.ToString} function: `(object) => string`. By default it uses\n * `JSON.stringify`.\n *\n * @example Only storing the newest three items per key\n * ```js\n * const map = mapOfSetMutable();\n * map.add(`hello`, [1, 2, 3, 1, 2, 3]);\n * const hello = map.get(`hello`); // [1, 2, 3]\n * ```\n *\n * @example\n * ```js\n * const hash = (v) => v.name; // Use name as the key\n * const map = mapOfSetMutable(hash);\n * map.add(`hello`, {age:40, name: `Mary`});\n * map.add(`hello`, {age:29, name: `Mary`}); // Value ignored as same name exists\n * ```\n * @param opts\n * @returns\n */\nexport const ofSetMutable = <V>(\n  opts?: MapSetOpts<V>\n): IMapOfMutableExtended<V, ReadonlyMap<string, V>> => {\n  const hash = opts?.hash ?? toStringDefault;\n  const comparer = (a: V, b: V) => hash(a) === hash(b);\n\n  const t: MultiValue<V, ReadonlyMap<string, V>> = {\n    get name() {\n      return `set`;\n    },\n    iterable: (source) => source.values(),\n    add: (dest, values) => addKeepingExisting(dest, hash, ...values),\n    count: (source) => source.size,\n    find: (source, predicate) => mapFind(source, predicate),\n    filter: (source, predicate) => mapFilter(source, predicate),\n    toArray: (source) => mapToArray(source),\n    has: (source, value) => mapHasAnyValue(source, value, comparer),\n    without: (source, value) => without(mapToArray(source), value, comparer),\n  };\n  const m = new MapOfMutableImpl<V, ReadonlyMap<string, V>>(t, opts);\n  return m;\n};\n","import { isEqualDefault } from '../../IsEqual.js';\nimport { type ICircularArray, circularArray } from '../CircularArray.js';\nimport type { MapMultiOpts, MultiValue } from './MapMulti.js';\nimport { MapOfMutableImpl } from './MapOfMultiImpl.js';\nimport type { IMapOfMutableExtended } from './IMapOfMutableExtended.js';\n\nexport type MapCircularOpts<V> = MapMultiOpts<V> & {\n  readonly capacity: number;\n};\n\n/**\n * Returns a {@link IMapOfMutableExtended} that uses a {@link ICircularArray} to hold values. Mutable.\n * This means that the number of values stored under each key will be limited to the defined\n * capacity.\n *\n * Required option:\n * * `capacity`: how many items to hold\n *\n * @example Only store the most recent three items per key\n * ```js\n * const map = ofCircularMutable({capacity: 3});\n * map.add(`hello`, [1, 2, 3, 4, 5]);\n * const hello = map.get(`hello`); // [3, 4, 5]\n * ```\n *\n *\n * @param opts\n * @returns\n */\nexport const ofCircularMutable = <V>(\n  opts: MapCircularOpts<V>\n): IMapOfMutableExtended<V, ICircularArray<V>> => {\n  const comparer = isEqualDefault;\n\n  const t: MultiValue<V, ICircularArray<V>> = {\n    get name() {\n      return `circular`;\n    },\n    add: (dest, values) => {\n      if (dest === undefined) dest = circularArray<V>(opts.capacity);\n      for (const v of values) {\n        //values.forEach(v => dest = dest?.add(v));\n        dest = dest.add(v);\n      }\n      return dest;\n    },\n    count: (source) => source.length,\n    find: (source, predicate) => source.find(predicate),\n    filter: (source, predicate) => source.filter(predicate),\n    toArray: (source) => source,\n    iterable: (source) => source.values(),\n    has: (source, value) =>\n      source.find((v) => comparer(v, value)) !== undefined,\n    without: (source, value) => source.filter((v) => !comparer(v, value)),\n  };\n  return new MapOfMutableImpl<V, ICircularArray<V>>(t, opts);\n};\n","/**\n * Simple map for numbers.\n * \n * Keys not present in map return the `defaultValue` given in the constructor\n * ```js\n * // All keys default to zero.\n * const map = new NumberMap();\n * map.get(`hello`); // 0\n * ```\n * \n * To check if a key is present, use `has`:\n * ```js\n * map.has(`hello`); // false\n * ```\n * \n * Math:\n * ```js\n * // Adds 1 by default to value of `hello`\n * map.add(`hello`);         // 1\n * map.multiply(`hello`, 2); // 2 \n * \n * // Reset key to default value\n * map.reset(`hello`); // 0\n * ```\n * \n * Different default value:\n * ```js\n * const map = new NumberMap(10);\n * map.get(`hello`); // 10\n * ```\n * \n * Regular `set` works as well:\n * ```js\n * map.set(`hello`, 5);\n * map.add(`hello`, 2); // 7\n * ```\n */\nexport class NumberMap<K> extends Map<K, number> {\n  readonly defaultValue: number;\n\n  constructor(defaultValue = 0) {\n    super();\n    this.defaultValue = defaultValue;\n  }\n\n  get(key: K): number {\n    const v = super.get(key);\n    if (v === undefined) return this.defaultValue;\n    return v;\n  }\n\n  reset(key: K): number {\n    super.set(key, this.defaultValue);\n    return this.defaultValue;\n  }\n\n  multiply(key: K, amount: number): number {\n    const v = super.get(key);\n    let value = v ?? this.defaultValue;\n    value *= amount;\n    super.set(key, value);\n    return value;\n  }\n\n  add(key: K, amount = 1): number {\n    const v = super.get(key);\n    let value = v ?? this.defaultValue;\n    value += amount;\n    super.set(key, value);\n    return value;\n  }\n\n  subtract(key: K, amount = 1): number {\n    const v = super.get(key);\n    let value = v ?? this.defaultValue;\n    value -= amount;\n    super.set(key, value);\n    return value;\n  }\n}","import type { ToString } from 'src/Util.js';\nimport { type IsEqual, isEqualDefault } from '../../IsEqual.js';\nimport { type IMapOfMutableExtended } from './IMapOfMutableExtended.js';\nimport { type MapMultiOpts, type MultiValue } from './MapMulti.js';\nimport { MapOfMutableImpl } from './MapOfMultiImpl.js';\n\n/**\n * Map of array options\n */\nexport type MapArrayOpts<V> = MapMultiOpts<V> & {\n  /**\n   * Comparer to use\n   */\n  readonly comparer?: IsEqual<V>;\n  /**\n   * Key function\n   */\n  readonly convertToString?: ToString<V>;\n};\n\n/**\n * Returns a {@link IMapOfMutableExtended} to allow storing multiple values under a key, unlike a regular Map.\n * @example\n * ```js\n * const map = ofArrayMutable();\n * map.addKeyedValues(`hello`, [1,2,3,4]); // Adds series of numbers under key `hello`\n *\n * const hello = map.get(`hello`); // Get back values\n * ```\n *\n * Takes options:\n * * `comparer`: {@link IsEqual}\n * * `toString`: {@link Util.ToString}\n *\n * A custom {@link Util.ToString} function can be provided as the `convertToString` opion. This is then used when checking value equality (`has`, `without`)\n * ```js\n * const map = ofArrayMutable({ convertToString:(v) => v.name}); // Compare values based on their `name` field;\n * ```\n *\n * Alternatively, a {@link IsEqual} function can be used:\n * ```js\n * const map = ofArrayMutable({comparer: (a, b) => a.name === b.name });\n * ```\n * @param opts\n * @template V Data type of items\n * @returns {@link IMapOfMutableExtended}\n */\nexport const ofArrayMutable = <V>(\n  opts: MapArrayOpts<V> = {}\n): IMapOfMutableExtended<V, ReadonlyArray<V>> => {\n  // const toStringFunction = opts.toString === undefined ?  \n  // const comparer =\n  //   opts.comparer === undefined\n  //     ? (opts.toString === undefined\n  //       ? (a: V, b: V) => opts.toString(a) === opts.toString(b)\n  //       : isEqualDefault)\n  //     : opts.comparer;\n  // const convertToStringComparer = opts.convertToString === undefined ? undefined : (a: V, b: V) => {\n  //   const r = opts.convertToString(a) === opts.convertToString(b)\n  //   console.log(`ofArrayMutable toString comparer: r: ${ r } a: ${ a } b: ${ b }`);\n  //   console.log(`ofArrayMutable toString comparer: a: ${ opts.toString(a) } b: ${ opts.toString(b) }`);\n  //   return r;\n  // };\n\n  const convertToString = opts.convertToString;\n  const toStringFunction: IsEqual<V> = typeof convertToString === `undefined` ? isEqualDefault : (a: V, b: V) => convertToString(a) === convertToString(b)\n\n  const comparer = opts.comparer ?? toStringFunction;\n\n  const t: MultiValue<V, ReadonlyArray<V>> = {\n    get name() {\n      return `array`;\n    },\n    add: (destination, values) => {\n      if (destination === undefined) return [ ...values ];\n      return [ ...destination, ...values ];\n    },\n    iterable: (source) => source.values(),\n    count: (source) => source.length,\n    find: (source, predicate) => source.find(f => predicate(f)),\n    filter: (source, predicate) => source.filter(f => predicate(f)),\n    toArray: (source) => source,\n    has: (source, value) => source.some((v) => comparer(v, value)),\n    without: (source, value) => source.filter((v) => !comparer(v, value)),\n    //[Symbol.iterator]: (source) => source[Symbol.iterator]()\n  };\n  const m = new MapOfMutableImpl<V, ReadonlyArray<V>>(t, opts);\n  return m;\n};\n","\n\n/**\n * Normalise module\n * * {@link array}: Normalises the contents of an array of known values.\n * * {@link stream}: Normalises a stream of unknown values.\n */\nexport * as Normalise from './Normalise.js';\n\nexport * from './FrequencyMutable.js';\nexport * from './MovingAverage.js';\nexport * from './NumberTracker.js';\nexport * from './IntervalTracker.js';\nexport * from './PointTracker.js';\nexport * from './TrackedValue.js';\nexport * from './TrackerBase.js';\n\nexport * from './Clamp.js';\nexport * from './Scale.js';\nexport * from './Flip.js';\n\nexport * as Reactive from './Reactive.js';\nexport * as Chains from './Chain.js';\nexport * as Graphs from './graphs/index.js'\n\nexport * from './Table.js';\n\n/**\n * Work with bipolar values (-1...1)\n * \n * Import:\n * ```js\n * import { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n * ```\n * \n * Overview:\n * * {@link immutable}: Immutable wrapper around a value\n * * {@link clamp}: Clamp on -1..1 scale\n * * {@link scale}: Scale a value to -1..1\n * * {@link toScalar}: Convert -1..1 to 0..1\n * * {@link fromScalar}: Convert from 0..1 to -1..1\n * * {@link towardZero}: Nudge a bipolar value towards zero\n */\nexport * as Bipolar from './Bipolar.js';\nexport * from './Interpolate.js';\nexport * from './Wrap.js';\nexport * as Correlate from './Correlate.js';\nexport * as Pool from './Pool.js';\n\nexport const piPi = Math.PI * 2;\nexport type NumberFunction = () => number;\n","import { minMaxAvg } from '../collections/NumericArrays.js';\nimport { clamp } from './Clamp.js';\nimport { scale } from './Scale.js';\nimport { throwNumberTest } from '../Guards.js';\n/**\n * Normalises numbers, adjusting min/max as new values are processed.\n * Normalised return values will be in the range of 0-1 (inclusive).\n *\n * [Read more in the docs](https://clinth.github.io/ixfx-docs/data/normalising/)\n *\n * @example\n * ```js\n * import {Normalise} from 'https://unpkg.com/ixfx/dist/data.js'\n * const s = Normalise.stream();\n * s(2);    // 1 (because 2 is highest seen)\n * s(1);    // 0 (because 1 is the lowest so far)\n * s(1.5);  // 0.5 (50% of range 1-2)\n * s(0.5);  // 0 (because it's the new lowest)\n * ```\n *\n * Since normalisation is being adjusted as new min/max are encountered, it might\n * be that value normalised to 1 at one time is different to what normalises to 1\n * at a later time.\n *\n * If you already know what to expect of the number range, passingin `minDefault`\n * and `maxDefault` primes the normalisation.\n * ```js\n * const s = Normalise.stream();\n * s(5); // 1, because it's the highest seen\n *\n * // With priming:\n * const s = Normalise.stream(0, 10);\n * s(5); // 0.5, because we're expecting range 0-10\n * ```\n *\n * Note that if a value exceeds the default range, normalisation adjusts.\n * Errors are thrown if min/max defaults are NaN or if one attempts to\n * normalise NaN.\n * @returns\n */\nexport const stream = (minDefault?: number, maxDefault?: number) => {\n  //eslint-disable-next-line functional/no-let\n  let min = minDefault ?? Number.MAX_SAFE_INTEGER;\n  //eslint-disable-next-line functional/no-let\n  let max = maxDefault ?? Number.MIN_SAFE_INTEGER;\n\n  throwNumberTest(minDefault);\n  throwNumberTest(maxDefault);\n\n  return (v: number): number => {\n    throwNumberTest(v);\n    min = Math.min(min, v);\n    max = Math.max(max, v);\n    return scale(v, min, max);\n  };\n};\n\n/**\n * Normalises an array. By default uses the actual min/max of the array\n * as the normalisation range. [Read more in the docs](https://clinth.github.io/ixfx-docs/data/normalising/)\n *\n * ```js\n * import {Normalise} from 'https://unpkg.com/ixfx/dist/data.js'\n * // Yields: [0.5, 0.1, 0.0, 0.9, 1]\n * Normalise.array([5,1,0,9,10]);\n * ```\n *\n * `minForced` and/or `maxForced` can\n * be provided to use an arbitrary range.\n * ```js\n * // Forced range 0-100\n * // Yields: [0.05, 0.01, 0.0, 0.09, 0.10]\n * Normalise.array([5,1,0,9,10], 0, 100);\n * ```\n *\n * Return values are clamped to always be 0-1, inclusive.\n *\n * @param values Values\n * @param minForced If provided, this will be min value used\n * @param maxForced If provided, this will be the max value used\n */\nexport const array = (\n  values: readonly number[],\n  minForced?: number,\n  maxForced?: number\n) => {\n  if (!Array.isArray(values)) {\n    throw new Error(`values param should be an array`);\n  }\n  const mma = minMaxAvg(values);\n\n  const min = minForced ?? mma.min;\n  const max = maxForced ?? mma.max;\n\n  return values.map((v) => clamp(scale(v, min, max)));\n};\n","import { clamp } from './Clamp.js';\nimport { numberTest, throwFromResult } from '../Guards.js';\n\n/**\n * Scales `v` from an input range to an output range (aka `map`)\n *\n * For example, if a sensor's useful range is 100-500, scale it to a percentage:\n *\n * ```js\n * import { scale } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * scale(sensorReading, 100, 500, 0, 1);\n * ```\n *\n * `scale` defaults to a percentage-range output, so you can get away with:\n * ```js\n * scale(sensorReading, 100, 500);\n * ```\n *\n * If `v` is outside of the input range, it will likewise be outside of the output range.\n * Use {@link scaleClamped} to clip value to range.\n *\n * If inMin and inMax are equal, outMax will be returned.\n *\n * An easing function can be provided for non-linear scaling. In this case\n * the input value is 'pre scaled' using the function before it is applied to the\n * output range.\n *\n * ```js\n * scale(sensorReading, 100, 500, 0, 1, Easings.gaussian());\n * ```\n * @param v Value to scale\n * @param inMin Input minimum\n * @param inMax Input maximum\n * @param outMin Output minimum. If not specified, 0\n * @param outMax Output maximum. If not specified, 1\n * @param easing Easing function\n * @returns Scaled value\n */\nexport const scale = (\n  v: number,\n  inMin: number,\n  inMax: number,\n  outMin?: number,\n  outMax?: number,\n  easing?: (v: number) => number\n): number => scaler(inMin, inMax, outMin, outMax, easing)(v);\n\n/**\n * Returns a scaling function\n * @param inMin Input minimum\n * @param inMax Input maximum\n * @param outMin Output minimum. If not specified, 0\n * @param outMax Output maximum. If not specified, 1\n * @param easing Easing function\n * @returns\n */\nexport const scaler = (\n  inMin: number,\n  inMax: number,\n  outMin?: number,\n  outMax?: number,\n  easing?: (v: number) => number\n): ((v: number) => number) => {\n\n  const oMax = outMax ?? 1;\n  const oMin = outMin ?? 0;\n\n  return (v: number): number => {\n    if (inMin === inMax) return oMax;\n\n    //eslint-disable-next-line functional/no-let\n    let a = (v - inMin) / (inMax - inMin);\n    if (easing !== undefined) a = easing(a);\n    return a * (oMax - oMin) + oMin;\n  };\n};\n\n/**\n * As {@link scale}, but result is clamped to be\n * within `outMin` and `outMax`.\n *\n * @param v\n * @param inMin\n * @param inMax\n * @param outMin 1 by default\n * @param outMax 0 by default d\n * @param easing\n * @returns\n */\nexport const scaleClamped = (\n  v: number,\n  inMin: number,\n  inMax: number,\n  outMin?: number,\n  outMax?: number,\n  easing?: (v: number) => number\n): number => {\n  if (outMax === undefined) outMax = 1;\n  if (outMin === undefined) outMin = 0;\n  if (inMin === inMax) return outMax;\n\n  const x = scale(v, inMin, inMax, outMin, outMax, easing);\n  return clamp(x, outMin, outMax);\n};\n\n/**\n * Scales an input percentage to a new percentage range.\n *\n * If you have an input percentage (0-1), `scalePercentageOutput` maps it to an\n * _output_ percentage of `outMin`-`outMax`.\n *\n * ```js\n * import { scalePercentages } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * // Scales 50% to a range of 0-10%\n * scalePercentages(0.5, 0, 0.10); // 0.05 - 5%\n * ```\n *\n * An error is thrown if any parameter is outside of percentage range. This added\n * safety is useful for catching bugs. Otherwise, you could just as well call\n * `scale(percentage, 0, 1, outMin, outMax)`.\n *\n * If you want to scale some input range to percentage output range, just use `scale`:\n * ```js\n * import { scale } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * // Yields 0.5\n * scale(2.5, 0, 5);\n * ```\n * @param percentage Input value, within percentage range\n * @param outMin Output minimum, between 0-1\n * @param outMax Output maximum, between 0-1\n * @returns Scaled value between outMin-outMax.\n */\nexport const scalePercentages = (\n  percentage: number,\n  outMin: number,\n  outMax = 1\n): number => {\n  throwFromResult(numberTest(percentage, `percentage`, `v`));\n  throwFromResult(numberTest(outMin, `percentage`, `outMin`));\n  throwFromResult(numberTest(outMax, `percentage`, `outMax`));\n  return scale(percentage, 0, 1, outMin, outMax);\n};\n\n/**\n * Scales an input percentage value to an output range\n * If you have an input percentage (0-1), `scalePercent` maps it to an output range of `outMin`-`outMax`.\n * ```js\n * import { scalePercent } from 'https://unpkg.com/ixfx/dist/data.js';\n * scalePercent(0.5, 10, 20); // 15\n * ```\n *\n * @see {@link scalerPercent} Returns a function\n * @param v Value to scale\n * @param outMin Minimum for output\n * @param outMax Maximum for output\n * @returns\n */\nexport const scalePercent = (\n  v: number,\n  outMin: number,\n  outMax: number\n): number => scalerPercent(outMin, outMax)(v);\n\n/**\n * Returns a function that scales an input percentage value to an output range\n * @see {@link scalePercent} Calculates value\n * @param outMin\n * @param outMax\n * @returns Function that takes a single argument\n */\nexport const scalerPercent = (outMin: number, outMax: number) => {\n  return (v: number) => {\n    throwFromResult(numberTest(v, `percentage`, `v`));\n    return scale(v, 0, 1, outMin, outMax);\n  };\n};\n","import { sort } from 'fp-ts/lib/Array.js';\nimport { pipe } from 'fp-ts/lib/function.js';\nimport * as S from 'fp-ts/lib/string.js';\nimport * as N from 'fp-ts/lib/number.js';\nimport { reverse as reverseOrd, contramap } from 'fp-ts/lib/Ord.js';\nimport { minMaxAvg as arrayMinMaxAg } from './collections/Arrays.js';\n\n/// ✔ Sorting functions are unit tested\n\nexport type StringOrNumber = string | number | bigint;\nexport type Primitive = string | number | bigint | boolean;\n\nexport type BasicType = StringOrNumber | object;\nexport type KeyValue = readonly [ key: string, value: StringOrNumber ];\n\nexport function isPrimitive(v: any): v is Primitive {\n  if (typeof v == `number`) return true;\n  if (typeof v === `string`) return true;\n  if (typeof v == `bigint`) return true;\n  if (typeof v === `boolean`) return true;\n  return false;\n}\n\nconst byKey = (reverse = false) => pipe(\n  reverse ? reverseOrd(S.Ord) : S.Ord,\n  contramap((v: KeyValue) => v[ 0 ])\n);\n\nexport const byValueString = (reverse = false) => pipe(\n  reverse ? reverseOrd(S.Ord) : S.Ord,\n  contramap((v: KeyValue) => v[ 1 ] as string)\n);\n\nconst byValueNumber = (reverse = false) => pipe(\n  reverse ? reverseOrd(N.Ord) : N.Ord,\n  contramap((v: KeyValue) => v[ 1 ] as number)\n);\n\nexport const sortByKey = (reverse = false) => sort<KeyValue>(byKey(reverse));\nexport const sortByValueString = (reverse = false) => sort<KeyValue>(byValueString(reverse));\nexport const sortByValueNumber = (reverse = false) => sort<KeyValue>(byValueNumber(reverse));\n\n// eslint-disable-next-line functional/prefer-readonly-type,functional/prefer-immutable-types\nexport type Sorter = (data: Array<KeyValue>) => Array<KeyValue>;\n\nexport const getSorter = (sortStyle: `value` | `valueReverse` | `key` | `keyReverse`) => {\n  switch (sortStyle) {\n    case `value`: {\n      return sortByValueNumber(false);\n    }\n    case `valueReverse`: {\n      return sortByValueNumber(true);\n    }\n    case `key`: {\n      return sortByKey(false);\n    }\n    case `keyReverse`: {\n      return sortByKey(true);\n    }\n    default: {\n      throw new Error(`Unknown sorting value '${ (sortStyle as string) }'. Expecting: value, valueReverse, key or keyReverse`);\n    }\n  }\n};\n\n\nexport const minMaxAvg = (entries: ReadonlyArray<KeyValue>, conversionFunction?: (v: KeyValue) => number) => {\n  const converter = conversionFunction ?? ((v: KeyValue) => v[ 1 ] as number);\n  const values = entries.map<number>(entry => converter(entry));\n  return arrayMinMaxAg(values);\n};","import { type StateChangeEvent } from '../flow/StateMachineWithEvents.js';\nimport { type Transitions } from '../flow/StateMachine.js';\nexport { type StateChangeEvent };\n\n/**\n * Generic support for Bluetooth LE devices\n */\nexport * as Bluetooth from './NordicBleDevice.js';\n\nexport * as AudioAnalysers from './AudioAnalyser.js';\nexport * as AudioVisualisers from './AudioVisualiser.js';\n\nexport { StringReceiveBuffer } from './StringReceiveBuffer.js';\nexport {\n  StringWriteBuffer,\n  type Opts as StringWriteBufferOpts,\n} from './StringWriteBuffer.js';\nexport { Codec } from './Codec.js';\n\n/**\n * Espruino-based devices connected via Bluetooth LE\n *\n * See [demos](https://clinth.github.io/ixfx-demos/io/)\n *\n * Overview:\n * * {@link puck}: Connects a [Espruino BLE Device](../classes/Io.Espruino.EspruinoBleDevice.html).\n * * {@link Espruino.connectBle}: Connect to a generic Espruino via BLE\n */\nexport * as Espruino from './Espruino.js';\n\nexport * as Camera from './Camera.js';\n\nexport * as VideoFile from './VideoFile.js';\n\nexport { FrameProcessor } from './FrameProcessor.js';\nexport type { FrameProcessorOpts } from './FrameProcessor.js';\n\n/**\n * Microcontrollers such as Arduinos connected via USB serial\n *\n * Overview\n * * {@link Serial.Device}\n *\n */\nexport * as Serial from './Serial.js';\n\nexport type IoDataEvent = {\n  readonly data: string;\n};\n\nexport type IoEvents<StateMachineTransitions extends Transitions> = {\n  readonly data: IoDataEvent;\n  readonly change: StateChangeEvent<StateMachineTransitions>;\n};\n\nexport const genericStateTransitionsInstance = Object.freeze({\n  ready: `connecting`,\n  connecting: [`connected`, `closed`],\n  connected: [`closed`],\n  closed: `connecting`,\n});\n\n//eslint-disable-next-line @typescript-eslint/naming-convention\nexport type GenericStateTransitions = Readonly<\n  typeof genericStateTransitionsInstance\n>;\n","import { unique } from '../collections/Arrays.js';\nimport {\n  StateMachineWithEvents,\n  type Opts,\n  type StateMachineEventMap,\n  type StopEvent,\n} from './StateMachineWithEvents.js';\nexport {\n  StateMachineWithEvents as WithEvents,\n  type Opts as StateMachineWithEventsOpts,\n  type StateMachineEventMap,\n  type StopEvent,\n};\n\n/**\n * State machine driver\n */\nexport { init as driver } from './StateMachineDriver.js';\nexport type {\n  DriverOpts,\n  StatesHandler as DriverHandler,\n  Runner,\n  ExpressionOrResult as DriverExpression,\n  Result as DriverResult,\n} from './StateMachineDriver.js';\n\n/**\n * Transition result\n * * 'Ok': transition valid\n * * 'FromNotFound': the from state is missing from machine definition\n * * 'ToNotFound': the 'to' state is missing from machine definition\n * * 'Invalid': not allowed to transition to target state from the current state\n * * 'Terminal':  not allowed to transition because from state is the final state\n */\nexport type TransitionResult =\n  | 'Ok'\n  | 'FromNotFound'\n  | 'ToNotFound'\n  | 'Invalid'\n  | 'Terminal';\n\nexport type TransitionCondition<V extends Transitions> = {\n  readonly hasPriorState: readonly StateNames<V>[];\n  readonly isInState: StateNames<V>;\n};\n\nexport type StateTargetStrict<V extends Transitions> = {\n  readonly state: StateNames<V> | null;\n  readonly preconditions?: readonly TransitionCondition<V>[];\n};\n\n/**\n * Possible state transitions, or _null_ if final state.\n */\n//export type StateTarget<V extends Transitions> = StateTargetExt<V> | null;\n\nexport type StateTarget<V extends Transitions> =\n  | string\n  //eslint-disable-next-line functional/prefer-readonly-type\n  | string[]\n  | readonly string[]\n  | null\n  | StateTargetStrict<V>;\n//eslint-disable-next-line functional/prefer-readonly-type\n// | StateTargetStrict<V>[]\n// | readonly StateTargetStrict<V>[];\n\n/**\n * Maps state to allowable next states\n */\nexport type Transitions = {\n  readonly [key: string]: StateTarget<Transitions>;\n};\n\nexport type TransitionsStrict = {\n  readonly [key: string]: readonly StateTargetStrict<Transitions>[];\n};\n/**\n * List of possible states\n */\nexport type StateNames<V extends Transitions> = keyof V & string;\n\nexport type Machine<V extends Transitions> = {\n  /**\n   * Allowable state transitions\n   */\n  readonly states: V;\n};\n\n/**\n * Encapsulation of a 'running' machine description and state.\n *\n * See:\n * - {@link cloneState}\n */\nexport type MachineState<V extends Transitions> = {\n  /**\n   * Current state\n   */\n  readonly value: StateNames<V>;\n  /**\n   * List of unique states visited. Won't contain the current\n   * state unless it has already been visited.\n   */\n  readonly visited: readonly StateNames<V>[];\n\n  //readonly machine: Machine<V>;\n  readonly machine: {\n    readonly [key in StateNames<V>]: readonly StateTargetStrict<V>[];\n  };\n};\n\n/**\n * Clones machine state\n * @param toClone\n * @returns Cloned of `toClone`\n */\nexport const cloneState = <V extends Transitions>(\n  toClone: MachineState<V>\n): MachineState<V> => {\n  return Object.freeze({\n    value: toClone.value,\n    visited: [...toClone.visited],\n    machine: toClone.machine,\n  });\n};\n/**\n * Initialises a state machine\n * ```js\n * const desc = {\n *  pants: ['shoes','socks'],\n *  socks: ['shoes', 'pants'],\n *  shoes: 'shirt',\n *  shirt: null\n * }\n * // Defaults to first key, 'pants'\n * let sm = StateMachine.init(descr);\n * // Move to 'shoes' state\n * sm = StateMachine.to(sm, 'shoes');\n * sm.state; // 'shoes'\n * sm.visited; // [ 'pants' ]\n * StateMachineLight.done(sm); // false\n * StateMachineLight.possible(sm); // [ 'shirt' ]\n * ```\n * @param sm\n * @param initialState\n * @returns\n */\nexport const init = <V extends Transitions>(\n  stateMachine: Machine<V> | Transitions | TransitionsStrict,\n  initialState?: StateNames<V>\n): MachineState<V> => {\n  const [machine, machineValidationError] = validateMachine(stateMachine);\n  if (!machine) throw new Error(machineValidationError);\n\n  const state: StateNames<V> =\n    (initialState as StateNames<V>) ?? Object.keys(machine.states)[0];\n  if (typeof machine.states[state] === 'undefined') {\n    throw new Error(`Initial state not found`);\n  }\n\n  // Normalise states\n  const transitions = validateAndNormaliseTransitions(machine.states);\n  if (transitions === undefined) {\n    throw new Error(`Could not normalise transitions`);\n  }\n  // @ts-ignore\n  return Object.freeze({\n    value: state,\n    visited: [],\n    machine: Object.fromEntries(transitions),\n  });\n};\n\nexport const reset = <V extends Transitions>(\n  sm: MachineState<V>\n): MachineState<V> => {\n  // @ts-ignore\n  return init<V>(sm.machine);\n};\n\nexport const validateMachine = <V extends Transitions>(\n  smOrTransitions: Machine<V> | Transitions | TransitionsStrict\n): [machine: Machine<V> | undefined, msg: string] => {\n  if (typeof smOrTransitions === 'undefined') {\n    return [undefined, 'Parameter undefined'];\n  }\n  if (smOrTransitions === null) {\n    return [undefined, 'Parameter null'];\n  }\n  if (`states` in smOrTransitions) {\n    // Assume Machine type\n    return [smOrTransitions as Machine<V>, ''];\n  }\n  if (typeof smOrTransitions === `object`) {\n    return [\n      {\n        // @ts-ignore\n        states: smOrTransitions,\n      },\n      '',\n    ];\n  }\n  return [\n    undefined,\n    `Unexpected type: ${typeof smOrTransitions}. Expected object`,\n  ];\n};\n\n// export const validateMachine = <V extends Transitions>(\n//   sm: Machine<V>\n// ): [machine: Machine<V> | undefined, msg: string] => {\n//   if (typeof sm === 'undefined') {\n//     return [undefined, `Parameter 'sm' is undefined`];\n//   }\n//   if (sm === null) return [undefined, `Parameter 'sm' is null`];\n//   if (`states` in sm) {\n//     const [transitions, validationError] = validateAndNormaliseTransitions(\n//       sm.states\n//     );\n//     if (transitions) {\n//       const machine: Machine<V> = {\n//         // @ts-ignore\n//         states: Object.fromEntries(transitions),\n//       };\n//       return [machine, ''];\n//     } else {\n//       return [undefined, validationError];\n//     }\n//   } else {\n//     return [undefined, `Parameter 'sm.states' is undefined`];\n//   }\n// };\n\n/**\n * Returns _true_ if `sm` is in its final state.\n * @param sm\n * @returns\n */\nexport const done = <V extends Transitions>(sm: MachineState<V>): boolean => {\n  return possible(sm).length === 0;\n};\n\n/**\n * Returns a list of possible state targets for `sm`, or\n * an empty list if no transitions are possible.\n * @param sm\n * @returns\n */\nexport const possibleTargets = <V extends Transitions>(\n  sm: MachineState<V>\n): readonly StateTargetStrict<V>[] => {\n  // Validate current state\n  validateMachineState(sm);\n  // get list of possible targets\n  const fromS = sm.machine[sm.value];\n\n  if (fromS.length === 1 && fromS[0].state === null) return [];\n  return fromS;\n};\n\n/**\n * Returns a list of possible state names for `sm`, or\n * an empty list if no transitions are possible.\n *\n * @param sm\n * @returns\n */\nexport const possible = <V extends Transitions>(\n  sm: MachineState<V>\n): (StateNames<V> | null)[] => {\n  const targets = possibleTargets(sm);\n  return targets.map((v) => v.state);\n};\n\nexport const normaliseTargets = <V extends Transitions>(\n  targets:\n    | StateTarget<V>\n    | readonly StateTargetStrict<V>[]\n    //eslint-disable-next-line functional/prefer-readonly-type\n    | StateTargetStrict<V>\n): StateTargetStrict<V>[] | null | undefined => {\n  const normaliseSingleTarget = (\n    target: string | undefined | null | object\n  ): StateTargetStrict<V> | undefined => {\n    // Terminal target\n    if (target === null) return { state: null };\n    // String is the target state\n    if (typeof target === 'string') {\n      return {\n        state: target,\n      };\n    } else if (typeof target === 'object' && 'state' in target) {\n      const targetState = target.state;\n      if (typeof targetState !== 'string') {\n        throw new Error(\n          `Target 'state' field is not a string. Got: ${typeof targetState}`\n        );\n      }\n      if (`preconditions` in target) {\n        return {\n          state: targetState,\n          preconditions: target.preconditions as TransitionCondition<V>[],\n        };\n      }\n      return { state: targetState };\n    } else {\n      throw new Error(\n        `Unexpected type: ${typeof target}. Expected string or object with 'state' field.`\n      );\n    }\n  };\n\n  // Array of targets (either strings or objects)\n  if (Array.isArray(targets)) {\n    //eslint-disable-next-line functional/no-let\n    let containsNull = false;\n    const mapResults = targets.map((t) => {\n      const r = normaliseSingleTarget(t);\n      if (!r) throw new Error(`Invalid target`);\n      containsNull = containsNull || r.state === null;\n      return r;\n    });\n    if (containsNull && mapResults.length > 1) {\n      throw new Error(`Cannot have null as an possible state`);\n    }\n    return mapResults;\n  } else {\n    const target = normaliseSingleTarget(targets);\n    if (!target) return;\n    return [target];\n  }\n};\n\nconst validateAndNormaliseTransitions = (\n  d: Transitions\n): Map<string, StateTargetStrict<typeof d>[]> | undefined => {\n  const returnMap = new Map<string, StateTargetStrict<typeof d>[]>();\n\n  // 1. Index top-level states\n  for (const [topLevelState, topLevelTargets] of Object.entries(d)) {\n    if (typeof topLevelState === `undefined`) {\n      throw new Error(`Top-level undefined state`);\n    }\n    if (typeof topLevelTargets === `undefined`) {\n      throw new Error(`Undefined target state for ${topLevelState}`);\n    }\n    if (returnMap.has(topLevelState)) {\n      throw new Error(`State defined twice: ${topLevelState}`);\n    }\n    if (topLevelState.includes(' ')) {\n      throw new Error('State names cannot contain spaces');\n    }\n    returnMap.set(topLevelState, []);\n  }\n\n  // 2. Normalise target\n  for (const [topLevelState, topLevelTargets] of Object.entries(d)) {\n    const targets = normaliseTargets(topLevelTargets);\n    if (targets === undefined) throw new Error(`Could not normalise target`);\n    if (targets !== null) {\n      // Check that they all exist as top-level states\n      const seenStates = new Set();\n      for (const target of targets) {\n        if (seenStates.has(target.state)) {\n          throw new Error(\n            `Target state '${target.state}' already exists for '${topLevelState}'`\n          );\n        }\n        seenStates.add(target.state);\n        if (target.state === null) continue;\n        if (!returnMap.has(target.state as string)) {\n          throw new Error(\n            `Target state '${target.state}' is not defined as a top-level state. Defined under: '${topLevelState}'`\n          );\n        }\n      }\n      returnMap.set(topLevelState, targets);\n    }\n  }\n  return returnMap;\n};\n\n/**\n * Validates machine state, throwing an exception if not valid\n * and returning `StateTargetStrict`\n * @param state\n * @returns\n */\nconst validateMachineState = <V extends Transitions>(\n  state: MachineState<V>\n): void => {\n  if (typeof state === 'undefined') {\n    throw new Error(`Parameter 'state' is undefined`);\n  }\n  if (typeof state.value !== 'string') {\n    throw new Error('Existing state is not a string');\n  }\n};\n\n/**\n * Attempts to transition to a new state. Either a new\n * `MachineState` is returned reflecting the change, or\n * an exception is thrown.\n * @param sm\n * @param toState\n * @returns\n */\nexport const to = <V extends Transitions>(\n  sm: MachineState<V>,\n  toState: StateNames<V>\n): MachineState<V> => {\n  validateMachineState(sm); // throws if not OK\n  validateTransition(sm, toState); // throws if not OK\n  return Object.freeze({\n    value: toState,\n    machine: sm.machine,\n    visited: unique<string>([sm.visited as string[], [sm.value] as string[]]),\n  });\n};\n\nexport const next = <V extends Transitions>(\n  sm: MachineState<V>\n): MachineState<V> => {\n  //validateMachineState(sm);\n  const first = possibleTargets(sm).at(0);\n  if (!first || first.state === null) {\n    throw new Error(\n      `Not possible to move to a next state from '${sm.value as string}`\n    );\n  }\n  return to(sm, first.state);\n};\n\n/**\n * Returns _true_ if `toState` is a valid transition from current state of `sm`\n * @param sm\n * @param toState\n * @returns\n */\nexport const isValidTransition = <V extends Transitions>(\n  sm: MachineState<V>,\n  toState: StateNames<V>\n): boolean => {\n  try {\n    validateTransition(sm, toState);\n    return true;\n  } catch (ex) {\n    return false;\n  }\n};\n\nexport const validateTransition = <V extends Transitions>(\n  sm: MachineState<V>,\n  toState: StateNames<V>\n): void => {\n  if (toState === null) throw new Error(`Cannot transition to null state`);\n  if (toState === undefined) {\n    throw new Error(`Cannot transition to undefined state`);\n  }\n  if (typeof toState !== 'string') {\n    throw new Error(\n      `Parameter 'toState' should be a string. Got: ${typeof toState}`\n    );\n  }\n\n  //const toS = sm.machine[toState];\n  //if (typeof toS === 'undefined') throw new Error(`Target state '${toState}' not defined`);\n\n  const p = possible(sm);\n  if (p.length === 0) throw new Error('Machine is in terminal state');\n  if (!p.includes(toState)) {\n    throw new Error(\n      `Target state '${toState}' not available at current state '${\n        sm.value\n      }'. Possible states: ${p.join(', ')}`\n    );\n  }\n};\n\n/**\n * Returns state transitions based on a list of strings.\n * The last string is the terminal state.\n *  A -> B -> C -> D\n *\n * ```js\n * const transitions = [`a`, `b`, `c`, `d`];\n * // Object state machine with events\n * const sm = new StateMachine.WithEvents(transitions);\n * // OR, immutable state machine\n * const sm = StateMachine.init(transitions);\n * ```\n * @param states List of states\n * @return MachineDescription\n */\nexport const fromList = (...states: readonly string[]): Transitions => {\n  const t = {};\n  if (!Array.isArray(states)) throw new Error(`Expected array of strings`);\n  if (states.length <= 2) throw new Error(`Expects at least two states`);\n  for (let i = 0; i < states.length; i++) {\n    const s = states[i];\n    if (typeof s !== `string`) {\n      throw new Error(\n        `Expected array of strings. Got type '${typeof s}' at index ${i}`\n      );\n    }\n    if (i === states.length - 1) {\n      /** @ts-ignore */\n      //eslint-disable-next-line functional/immutable-data\n      t[s] = null;\n    } else {\n      /** @ts-ignore */\n      //eslint-disable-next-line functional/immutable-data\n      t[s] = states[i + 1];\n    }\n  }\n  return t;\n};\n\n/**\n * Returns a machine description based on a list of strings. Machine\n * can go back and forth between states:\n *  A <-> B <-> C <-> D\n * ```js\n * const transitions = [`a`, `b`, `c`, `d`];\n * // Object state machine with events\n * const sm = new StateMachine.WithEvents(transitions);\n * // OR, immutable state machine\n * const sm = StateMachine.init(transitions);\n * ```\n * @param states\n * @returns\n */\nexport const bidirectionalFromList = (\n  ...states: readonly string[]\n): Transitions => {\n  const t = {};\n  if (!Array.isArray(states)) throw new Error(`Expected array of strings`);\n  if (states.length < 2) throw new Error(`Expects at least two states`);\n\n  for (let i = 0; i < states.length; i++) {\n    const s = states[i];\n    if (typeof s !== `string`) {\n      throw new Error(\n        `Expected array of strings. Got type '${typeof s}' at index ${i}`\n      );\n    }\n\n    /** @ts-ignore */\n    //eslint-disable-next-line functional/immutable-data\n    t[s] = [];\n  }\n\n  for (let i = 0; i < states.length; i++) {\n    /** @ts-ignore */\n    const v = t[states[i]] as string[];\n    if (i === states.length - 1) {\n      if (states.length > 1) {\n        //eslint-disable-next-line functional/immutable-data\n        v.push(states[i - 1]);\n      } else {\n        /** @ts-ignore */\n        //eslint-disable-next-line functional/immutable-data\n        t[states[i]] = null;\n      }\n    } else {\n      //eslint-disable-next-line functional/immutable-data\n      v.push(states[i + 1]);\n      //eslint-disable-next-line functional/immutable-data\n      if (i > 0) v.push(states[i - 1]);\n    }\n  }\n  return t;\n};\n","import { defaultComparer, type Comparer } from '../Util.js';\nimport { shuffle } from '../collections/Arrays.js';\n\nexport type ExpressionOrResult<ArgsType, ResultType> =\n  | ResultType\n  | ((\n      args: ArgsType | undefined\n    ) => Promise<ResultType | undefined> | ResultType | undefined | void);\n\n//eslint-disable-next-line functional/no-mixed-types\nexport type RunOpts<ResultType> = {\n  /**\n   * If provided, filters the set of results prior to returning.\n   * @param result\n   * @returns\n   */\n  readonly filter?: (result: ResultType) => boolean;\n  /**\n   * If true, execution order is shuffled each time\n   */\n  readonly shuffle?: boolean;\n  /**\n   * Function to rank results. By default uses {@link defaultComparer} which orders\n   * by numeric value or alphabetical.\n   */\n  readonly rank?: Comparer<ResultType>;\n  /**\n   * If provided, stops execution if _true_ is returned.\n   * Result(s) include most recent execution.\n   * @param latest Latest result\n   * @param sorted Sorted list of current results, not including latest\n   * @returns\n   */\n  readonly stop?: (\n    latest: ResultType | undefined,\n    sorted: readonly ResultType[]\n  ) => boolean;\n};\n\nexport type RunSingleOpts<V> = RunOpts<V> & {\n  readonly at?: number;\n};\n/**\n * Runs a series of async expressions, returning the results.\n * Use {@link runSingle} if it's only a single result you care about.\n *\n * @example Run three functions, returning the highest-ranked result.\n * ```js\n * const result = run([\n *  () => 10,\n *  () => 2,\n *  () => 3\n * ]);\n * // Yields: 10\n * ```\n *\n * Options can be passed for evaluation:\n * ```js\n * const result = run([\n *  (args) => {\n *    if (args === 'apple') return 100;\n *  },\n *  () => {\n *    return 10;\n *  }\n * ])\n * ```\n *\n * ```js\n * const expr = [\n *  (opts) => 10,\n *  (opts) => 2,\n *  (opts) => 3\n * ];\n * const opts = {\n *  rank: (a, b) => {\n *    if (a < b) return -1;\n *    if (a > b) return 1;\n *    return 0;\n *  }\n * }\n * const result = await run(expr, opts);\n * // Returns: 2\n * ```\n *\n * In terms of typing, it takes an generic arguments `ArgsType` and `ResultType`:\n * - `ArgsType`: type of expression arguments. This might be `void` if no arguments are used.\n * - `ResultType`:  return type of expression functions\n *\n * Thus the `expressions` parameter is an array of functions:\n * ```js\n * (args:ArgsType|undefined) => ResultType|undefined\n * // or\n * (args:ArgsType|undefined) => Promise<ResultType|undefined>\n * ```\n *\n * Example:\n * ```js\n * const expressions = [\n *  // Function takes a string arg\n *  (args:string) => return true; // boolean is the necessary return type\n * ];\n * const run<string,boolean>(expressions, opts, 'hello');\n * ```\n * @param expressions\n * @param opts\n * @param args\n * @returns\n */\nexport const run = async <ArgsType, ResultType>(\n  expressions: //eslint-disable-next-line functional/prefer-readonly-type\n  | ExpressionOrResult<ArgsType, ResultType>[]\n    | ExpressionOrResult<ArgsType, ResultType>\n    | readonly ExpressionOrResult<ArgsType, ResultType>[],\n  opts: RunOpts<ResultType> = {},\n  args?: ArgsType\n): Promise<ResultType[]> => {\n  const results: ResultType[] = [];\n  const compareFn = opts.rank ?? defaultComparer;\n  //eslint-disable-next-line functional/no-let\n  let expressionsArray = Array.isArray(expressions)\n    ? (expressions as ExpressionOrResult<ArgsType, ResultType>[])\n    : [expressions as ExpressionOrResult<ArgsType, ResultType>];\n  if (opts.shuffle) expressionsArray = shuffle(expressionsArray);\n\n  for (let i = 0; i < expressionsArray.length; i++) {\n    const exp = expressionsArray[i];\n    //eslint-disable-next-line functional/no-let\n    let r: ResultType;\n    if (typeof exp === 'function') {\n      // @ts-ignore\n      r = await exp(args);\n    } else {\n      r = exp;\n    }\n    if (r !== undefined) {\n      //eslint-disable-next-line functional/immutable-data\n      results.push(r);\n      //eslint-disable-next-line functional/immutable-data\n      results.sort(compareFn);\n    }\n\n    if (typeof opts.stop !== 'undefined') {\n      if (opts.stop(r, results)) {\n        break;\n      }\n    }\n  }\n\n  if (opts.filter) {\n    return results.filter(opts.filter);\n  }\n  return results;\n};\n\n/**\n * Like {@link run}, but it returns a single result or _undefined_.\n * Use the `at` option to specify which index of results to use.\n * By default it's -1, which is the presumably the highest-ranked result.\n *\n * @param expressions\n * @param opts\n * @param args\n * @returns\n */\nexport const runSingle = async <ArgsType, ResultType>(\n  expressions: readonly ExpressionOrResult<ArgsType, ResultType>[],\n  opts: RunSingleOpts<ResultType> = {},\n  args?: ArgsType\n): Promise<ResultType | undefined> => {\n  const results = await run(expressions, opts, args);\n  if (!results) return;\n  if (results.length === 0) return;\n  const at = opts.at ?? -1;\n  return results.at(at);\n};\n","import * as StateMachine from './StateMachine.js';\nimport * as Execute from './Execute.js';\nimport { type MachineState } from './StateMachine.js';\nimport { defaultComparer } from '../Util.js';\nimport { randomElement } from '../collections/Arrays.js';\nimport * as Logger from '../debug/Logger.js';\n\nexport type Result<V extends StateMachine.Transitions> = {\n  /**\n   * Score of this result. This is used when a state\n   * has multiple handlers returning results separately.\n   * If not defined, 0 is used.\n   */\n  readonly score?: number;\n\n  //readonly state?: StateMachine.StateNames<V>;\n  /**\n   * If specified,the state to transition to. Use\n   * _true_ to attempt to automatically advance machine.\n   * This field is 2nd priority.\n   */\n  readonly next?: StateMachine.StateNames<V> | boolean;\n  /**\n   * If true, resets the machine.\n   * This flag is 1st priority, taking precedence over the `next` field.\n   */\n  readonly reset?: boolean;\n};\n\n//eslint-disable-next-line functional/no-mixed-types\nexport type Runner<V extends StateMachine.Transitions> = {\n  readonly run: () => Promise<StateMachine.MachineState<V> | undefined>;\n  readonly getValue: () => StateMachine.StateNames<V>;\n  readonly reset: () => void;\n  readonly to: (\n    state: StateMachine.StateNames<V>\n  ) => StateMachine.MachineState<V>;\n};\n\nexport type StatesHandler<V extends StateMachine.Transitions> = {\n  readonly if:\n  | ReadonlyArray<StateMachine.StateNames<V>>\n  //eslint-disable-next-line functional/prefer-readonly-type\n  | Array<StateMachine.StateNames<V>>\n  | StateMachine.StateNames<V>;\n  readonly then: ReadonlyArray<ExpressionOrResult<V>> | ExpressionOrResult<V>;\n  /**\n   * Logic for choosing which result, if there are multiple expressions.\n   * By default 'highest' (for highest ranked result)\n   */\n  readonly resultChoice?: `first` | `highest` | `lowest` | `random`;\n};\n\n// export type Prerequisite<V extends StateMachine.Transitions> =\n//   | readonly StateMachine.StateNames<V>[]\n//   | ((\n//       potentialState: StateMachine.StateNames<V>,\n//       state: StateMachine.MachineState<V>\n//     ) => boolean);\n\n// export type StatePrerequisites<V extends StateMachine.Transitions> = {\n//   readonly states:\n//     | readonly StateMachine.StateNames<V>[]\n//     | StateMachine.StateNames<V>;\n//   readonly condition?: Prerequisite<V>;\n// };\n\nexport type DriverOpts<V extends StateMachine.Transitions> = {\n  readonly handlers: ReadonlyArray<StatesHandler<V>>;\n  //readonly prereqs?: StatePrerequisites<V>;\n  readonly debug?: Logger.LogOption;\n  /**\n   * If _true_ execution of handlers is shuffled each time\n   */\n  readonly shuffleHandlers?: boolean;\n};\n\n// async function run<V extends StateMachine.Transitions>(\n//   machine: StateMachine.Machine<V>,\n//   handlers: readonly StatesHandler<V>[]\n// );\n\nexport type ExpressionOrResult<Transitions extends StateMachine.Transitions> =\n  | Result<Transitions>\n  | ((\n    machine?: MachineState<Transitions>\n  ) => Result<Transitions> | undefined);\n\n/**\n * Drives a state machine.\n *\n * Defaults to selecting the highest-ranked result to determine\n * what to do next.\n * @param machine\n * @param handlersOrOpts\n * @returns\n */\n// eslint-disable-next-line @typescript-eslint/require-await\nexport async function init<V extends StateMachine.Transitions>(\n  machine: StateMachine.Machine<V> | StateMachine.Transitions,\n  handlersOrOpts: ReadonlyArray<StatesHandler<V>> | DriverOpts<V>\n): Promise<Runner<V>> {\n  const opts: DriverOpts<V> = Array.isArray(handlersOrOpts)\n    ? {\n      handlers: handlersOrOpts as ReadonlyArray<StatesHandler<V>>,\n    }\n    : (handlersOrOpts as DriverOpts<V>);\n\n  const debug = Logger.resolveLogOption(opts.debug, {\n    category: `StateMachineDriver`,\n  });\n\n  // Index handlers by state, making sure there are not multiple\n  // handlers for a given state.\n  const byState = new Map<string, StatesHandler<V>>();\n  for (const h of opts.handlers) {\n    const ifBlock = Array.isArray(h.if) ? h.if : [ h.if ];\n    for (const state of ifBlock) {\n      if (typeof state !== `string`) {\n        throw new TypeError(\n          `Expected single or array of strings for the 'if' field. Got: '${ typeof state }'.`\n        );\n      }\n\n      if (byState.has(state)) {\n        throw new Error(\n          `Multiple handlers defined for state '${ state\n          }'. There should be at most one.`\n        );\n      }\n      byState.set(state, h);\n    }\n  }\n\n  // const expressions: Expression<V>[] = [\n  //   (_machine) => {\n  //     const r: Result<V> = {\n  //       next: 'hello',\n  //     };\n  //     return r;\n  //   },\n  // ];\n\n  const runOpts: Execute.RunOpts<Result<V>> = {\n    // Rank results by score\n    rank: (a, b) => {\n      return defaultComparer(a.score ?? 0, b.score ?? 0);\n    },\n    shuffle: opts.shuffleHandlers ?? false,\n  };\n\n  //eslint-disable-next-line functional/no-let\n  let sm = StateMachine.init(machine);\n\n  // Check that all 'if' states are actually defined on machine\n  for (const [ ifState ] of byState) {\n    // Check if state is defined\n    if (\n      typeof sm.machine[ ifState ] === `undefined` &&\n      ifState !== `__fallback`\n    ) {\n      throw new Error(\n        `StateMachineDriver handler references a state ('${ ifState }') which is not defined on the machine. Therefore this handler will never run.'`\n      );\n    }\n  }\n\n  const run = async (): Promise<StateMachine.MachineState<V> | undefined> => {\n    debug(`Run. State: ${ sm.value }`);\n    const state = sm.value;\n    //eslint-disable-next-line functional/no-let\n    let handler = byState.get(state);\n    if (handler === undefined) {\n      debug(`  No handler for state '${ state }', trying __fallback`);\n\n      // Is there a fallback?\n      handler = byState.get(`__fallback`);\n    }\n    if (handler === undefined) {\n      debug(`  No __fallback handler`);\n      return;\n    }\n\n    // If the `first` option is given, stop executing fns as soon as we get\n    // a valid result.\n    const runOptionsForHandler =\n      handler.resultChoice === `first`\n        ? {\n          ...runOpts,\n          stop: (latest: Result<V> | undefined) => {\n            if (!latest) return false;\n            if (`reset` in latest) return true;\n            if (`next` in latest && latest.next !== undefined) return true;\n            return false;\n          },\n        }\n        : runOpts;\n\n    const results = await Execute.run<MachineState<V>, Result<V>>(\n      handler.then,\n      runOptionsForHandler,\n      sm\n    );\n    debug(\n      `  In state '${ sm.value }' results: ${ results.length }. Choice: ${ handler.resultChoice\n      }`\n    );\n\n    // Apply selection logic\n    //eslint-disable-next-line functional/no-let\n    let r: Result<V> | undefined;\n    switch (handler.resultChoice ?? `highest`) {\n      case `highest`: {\n        r = results.at(-1);\n        break;\n      }\n      case `first`: {\n        r = results[ 0 ]; // Since we break on the first result\n        break;\n      }\n      case `lowest`: {\n        r = results.at(0);\n        break;\n      }\n      case `random`: {\n        r = randomElement(results);\n        break;\n      }\n      default: {\n        throw new Error(\n          `Unknown 'resultChoice' option: ${ handler.resultChoice }. Expected highest, first, lowest or random`\n        );\n      }\n    }\n\n    debug(`  Chosen result: ${ JSON.stringify(r) }`);\n    // Apply result\n    if (r && r.reset) {\n      sm = StateMachine.reset(sm);\n    } else if (r && r.next) {\n      if (typeof r.next === `boolean`) {\n        sm = StateMachine.next(sm);\n      } else {\n        debug(JSON.stringify(results));\n        sm = StateMachine.to(sm, r.next);\n      }\n    }\n    return sm;\n  };\n\n  return {\n    reset: () => {\n      sm = StateMachine.reset(sm);\n    },\n    getValue: () => sm.value,\n    run,\n    to: (state: StateMachine.StateNames<V>) => {\n      sm = StateMachine.to(sm, state);\n      return sm;\n    },\n  };\n}\n","import { SimpleEventEmitter } from '../Events.js';\nimport * as StateMachine from './StateMachine.js';\n\nimport type { StateNames, Transitions, MachineState } from './StateMachine.js';\nimport { Elapsed } from './index.js';\n\nexport type StateChangeEvent<V extends Transitions> = {\n  readonly newState: StateNames<V>;\n  readonly priorState: StateNames<V>;\n};\n\nexport type StopEvent<V extends Transitions> = {\n  readonly state: StateNames<V>;\n};\n\nexport type StateMachineEventMap<V extends Transitions> = {\n  readonly change: StateChangeEvent<V>;\n  readonly stop: StopEvent<V>;\n};\n\nexport type Opts<V extends Transitions> = {\n  readonly debug?: boolean;\n  readonly initial?: StateNames<V>;\n};\n\nexport class StateMachineWithEvents<\n  V extends Transitions,\n> extends SimpleEventEmitter<StateMachineEventMap<V>> {\n  #sm: MachineState<V>;\n  #smInitial: MachineState<V>;\n\n  #debug: boolean;\n  #isDoneNeedsFiring = false;\n  #isDone = false;\n  #changedAt = Elapsed.infinity();\n\n  /**\n   * Create a state machine with initial state, description and options\n   * @param string initial Initial state\n   * @param MachineDescription m Machine description\n   * @param Options Options for machine (defaults to `{debug:false}`)\n   * @memberof StateMachine\n   */\n  constructor(m: V, opts: Opts<V> = {}) {\n    super();\n\n    this.#debug = opts.debug ?? false;\n    this.#sm = StateMachine.init(m, opts.initial);\n    this.#smInitial = StateMachine.cloneState(this.#sm);\n  }\n\n  #setIsDone(v: boolean) {\n    if (this.#isDone === v) return;\n    this.#isDone = v;\n    if (v) {\n      this.#isDoneNeedsFiring = true;\n      setTimeout(() => {\n        if (!this.#isDoneNeedsFiring) return;\n        this.#isDoneNeedsFiring = false;\n        //console.log(`StateMachine isDone (${this.#state}), firing stop.`);\n        this.fireEvent(`stop`, { state: this.#sm.value as string });\n      }, 2);\n    } else {\n      this.#isDoneNeedsFiring = false;\n    }\n  }\n\n  /**\n   * Return a list of possible states from current state.\n   *\n   * If list is empty, no states are possible. Otherwise lists\n   * possible states, including 'null' for terminal\n   */\n  get statesPossible(): readonly (StateNames<V> | null)[] {\n    return StateMachine.possible(this.#sm);\n  }\n\n  /**\n   * Return a list of all defined states\n   */\n  get statesDefined(): readonly StateNames<V>[] {\n    return Object.keys(this.#sm.machine);\n  }\n\n  /**\n   * Moves to the next state if possible. If multiple states are possible, it will use the first.\n   * If machine is finalised, no error is thrown and null is returned.\n   *\n   * @returns {(string|null)} Returns new state, or null if machine is finalised\n   * @memberof StateMachine\n   */\n  next(): string | null {\n    const p = StateMachine.possible(this.#sm);\n    if (p.length === 0) return null;\n    this.state = p[0] as string;\n    return p[0] as string;\n  }\n\n  /**\n   * Returns true if state machine is in its final state\n   *\n   * @returns\n   * @memberof StateMachine\n   */\n  get isDone(): boolean {\n    return StateMachine.done(this.#sm);\n  }\n\n  /**\n   * Resets machine to initial state\n   *\n   * @memberof StateMachine\n   */\n  reset() {\n    this.#setIsDone(false);\n    this.#sm = StateMachine.cloneState(this.#smInitial);\n\n    //eslint-disable-next-line functional/immutable-data\n    this.#changedAt = Elapsed.since();\n  }\n\n  /**\n   * Throws if it's not valid to transition to `newState`\n   * @param newState\n   * @returns\n   */\n  validateTransition(newState: StateNames<V>): void {\n    StateMachine.validateTransition(this.#sm, newState);\n  }\n\n  /**\n   * Returns _true_ if `newState` is valid transition from current state.\n   * Use {@link validateTransition} if you want an explanation for the _false_ results.\n   * @param newState\n   * @returns\n   */\n  isValid(newState: StateNames<V>): boolean {\n    return StateMachine.isValidTransition(this.#sm, newState);\n  }\n\n  /**\n   * Gets or sets state. Throws an error if an invalid transition is attempted.\n   * Use `StateMachine.isValid` to check validity without changing.\n   *\n   * If `newState` is the same as current state, the request is ignored silently.\n   *\n   * @memberof StateMachine\n   */\n  set state(newState: StateNames<V>) {\n    const priorState = this.#sm.value as string;\n    if (newState === this.#sm.value) return;\n\n    // Try to change state\n    this.#sm = StateMachine.to(this.#sm, newState);\n    if (this.#debug) {\n      console.log(`StateMachine: ${priorState} -> ${newState as string}`);\n    }\n    this.#changedAt = Elapsed.since();\n    setTimeout(() => {\n      this.fireEvent(`change`, { newState: newState, priorState: priorState });\n    }, 1);\n\n    if (StateMachine.done(this.#sm)) this.#setIsDone(true);\n  }\n\n  get state(): string {\n    return this.#sm.value as string;\n  }\n\n  /**\n   * Returns timestamp when state was last changed.\n   * See also `elapsed`\n   */\n  //eslint-disable-next-line functional/prefer-tacit\n  get changedAt(): number {\n    return this.#changedAt();\n  }\n\n  /**\n   * Returns milliseconds elapsed since last state change.\n   * See also `changedAt`\n   */\n  //eslint-disable-next-line functional/prefer-tacit\n  get elapsed(): number {\n    return this.#changedAt();\n  }\n}\n","import { BleDevice } from './BleDevice.js';\n\nexport const defaultOpts = {\n  chunkSize: 20,\n  service: `6e400001-b5a3-f393-e0a9-e50e24dcca9e`,\n  txGattCharacteristic: `6e400002-b5a3-f393-e0a9-e50e24dcca9e`,\n  rxGattCharacteristic: `6e400003-b5a3-f393-e0a9-e50e24dcca9e`,\n  name: `NordicDevice`,\n  connectAttempts: 5,\n  debug: false,\n};\n\nexport type Opts = {\n  readonly chunkSize?: number;\n  readonly name?: string;\n  readonly connectAttempts?: number;\n  readonly debug?: boolean;\n};\n\nexport class NordicBleDevice extends BleDevice {\n  constructor(device: BluetoothDevice, opts: Opts = {}) {\n    super(device, { ...defaultOpts, ...opts });\n  }\n}\n","/**\n * Handles utf-8 text encoding/decoding\n */\nexport class Codec {\n  enc = new TextEncoder();\n  dec = new TextDecoder(`utf-8`);\n\n  /**\n   * Convert string to Uint8Array buffer\n   * @param str\n   * @returns\n   */\n  toBuffer(str: string) {\n    return this.enc.encode(str);\n  }\n\n  /**\n   * Returns a string from a provided buffer\n   * @param buffer\n   * @returns\n   */\n  fromBuffer(buffer: ArrayBuffer) {\n    return this.dec.decode(buffer);\n  }\n}\n","/**\n * Receives text\n */\nexport class StringReceiveBuffer {\n  buffer: string = ``;\n  stream: WritableStream<string> | undefined;\n\n  constructor(\n    private onData: (data: string) => void,\n    public separator = `\\n`\n  ) {}\n\n  async close() {\n    const s = this.stream;\n    if (!s) return;\n    await s.abort();\n\n    await s.close();\n  }\n\n  clear() {\n    this.buffer = ``;\n  }\n\n  writable() {\n    if (this.stream === undefined) this.stream = this.createWritable();\n    return this.stream;\n  }\n\n  private createWritable() {\n    //eslint-disable-next-line @typescript-eslint/no-this-alias\n    const b = this;\n    return new WritableStream<string>({\n      write(chunk) {\n        b.add(chunk);\n      },\n      close() {\n        b.clear();\n      },\n    });\n  }\n\n  addImpl(str: string): string {\n    // Look for separator in new string\n    const pos = str.indexOf(this.separator);\n    if (pos < 0) {\n      // Not found, just add to buffer and return\n      this.buffer += str;\n      return ``;\n    }\n\n    // Found! Trigger callback for existing buffer and part of new string\n    const part = str.substring(0, pos);\n    try {\n      this.onData(this.buffer + part);\n      str = str.substring(part.length + this.separator.length);\n    } catch (ex) {\n      console.warn(ex);\n    }\n\n    this.buffer = ``;\n\n    return str;\n  }\n\n  add(str: string) {\n    while (str.length > 0) {\n      str = this.addImpl(str);\n    }\n  }\n}\n","import type { Interval } from '../flow/IntervalType.js';\nimport { QueueMutable } from '../collections/queue/QueueMutable.js';\nimport {\n  type Continuously,\n  continuously\n} from '../flow/index.js';\nimport { splitByLength } from '../Text.js';\n\nexport type Opts = {\n  readonly chunkSize?: number;\n  readonly interval?: Interval;\n};\n\n/**\n * Buffers a queue of strings.\n *\n * When text is queued via {@link add}, it is chopped up\n * into chunks and sent in serial to the `dataHandler` function.\n * Data is processed at a set rate, by default 10ms.\n *\n * ```js\n * const dataHandler = (data:string) => {\n *  // Do something with queued data.\n *  // eg. send to serial port\n * }\n *\n * // Create a buffer with a chunk size of 100 characters\n * const b = new StringWriteBuffer(dataHandler, { chunkSize: 100 });\n * b.add('some text'); // Write to buffer\n * // dataHandler will be called until queued data is empty\n * ```\n *\n * It's also possible to get the buffer as a WritableStream<string>:\n * ```js\n * const dataHandler = (data:string) => { ... }\n * const b = new StringWriteBuffer(dataHandler, 100);\n * const s = b.writable();\n * ```\n *\n * Other functions:\n * ```js\n * b.close(); // Close buffer\n * b.clear(); // Clear queued data, but don't close anything\n * ```\n */\nexport class StringWriteBuffer {\n  paused = false;\n  queue = new QueueMutable<string>();\n  writer: Continuously;\n  stream: WritableStream<string> | undefined;\n  closed = false;\n  chunkSize: number;\n\n  /**\n   * Constructor\n   * @param dataHandler Calback to 'send' data onwards\n   * @param chunkSize Size to break up strings\n   */\n  constructor(\n    private dataHandler: (data: string) => Promise<void>,\n    opts: Opts = {}\n  ) {\n    this.chunkSize = opts.chunkSize ?? -1;\n    this.writer = continuously(async () => {\n      await this.onWrite()\n    }, opts.interval ?? 10);\n  }\n\n  /**\n   * Close writer (async)\n   */\n  async close() {\n    if (this.closed) return;\n    const w = this.stream?.getWriter();\n    w?.releaseLock();\n    await w?.close();\n    this.closed = true;\n  }\n\n  /**\n   * Clear queued data.\n   *\n   * Throws an error if {@link close} has been called.\n   */\n  clear() {\n    if (this.closed) throw new Error(`Buffer closed`);\n    this.queue = new QueueMutable<string>();\n  }\n\n  /**\n   * Gets the buffer as a writable stream.\n   *\n   * Do not close stream directly, use .close on this class instead.\n   *\n   * Throws an error if .close() has been called.\n   * @returns Underlying stream\n   */\n  writable() {\n    if (this.closed) throw new Error(`Buffer closed`);\n    if (this.stream === undefined) this.stream = this.createWritable();\n    return this.stream;\n  }\n\n  private createWritable() {\n    // eslint-disable-next-line unicorn/no-this-assignment,@typescript-eslint/no-this-alias\n    const b = this;\n    return new WritableStream<string>({\n      write(chunk) {\n        b.add(chunk);\n      },\n      close() {\n        b.clear();\n      },\n    });\n  }\n\n  /**\n   * Run in a `continunously` loop to process queued data\n   * @returns _False_ if queue is empty and loop should stop. _True_ if it shoud continue.\n   */\n  async onWrite(): Promise<boolean> {\n    if (this.queue.isEmpty) {\n      //console.warn(`WriteBuffer.onWrite: queue empty`);\n      return false; // Stop continuously\n    }\n\n    if (this.paused) {\n      console.warn(`WriteBuffer.onWrite: paused...`);\n      return true; // Keep going tho\n    }\n\n    // Dequeue and send\n    const s = this.queue.dequeue();\n    if (s === undefined) return false;\n    await this.dataHandler(s);\n\n    return true;\n  }\n\n  /**\n   * Returns _true_ if {@link close} has been called.\n   */\n  get isClosed() {\n    return this.closed;\n  }\n\n  /**\n   * Adds some queued data to send.\n   * Longer strings are automatically chunked up according to the buffer's settings.\n   *\n   * Throws an error if {@link close} has been called.\n   * @param stringToQueue\n   */\n  add(stringToQueue: string) {\n    if (this.closed) throw new Error(`Buffer closed`);\n    // Add whole string or chunked string\n    if (this.chunkSize > 0) {\n      this.queue.enqueue(...splitByLength(stringToQueue, this.chunkSize));\n    } else {\n      this.queue.enqueue(stringToQueue);\n    }\n\n    // Run continuously loop if it's not already running\n    this.writer.start();\n  }\n}\n","import { sleep } from './Sleep.js';\nimport { resolveLogOption } from '../debug/Logger.js';\nimport { since, toString as elapsedToString } from './Elapsed.js';\nimport { throwIntegerTest } from '../Guards.js';\nimport { getErrorMessage } from '../debug/GetErrorMessage.js';\n/**\n * Result of backoff\n */\nexport type RetryResult<V> = {\n  /**\n   * Message describing outcome.\n   *\n   * If retry was aborted, message will be abort reason.\n   */\n  readonly message?: string;\n  /**\n   * True if callback function was invoked once where it returned _true_\n   */\n  readonly success: boolean;\n  /**\n   * Number of times callback was attempted\n   */\n  readonly attempts: number;\n  /**\n   * Total elapsed time since beginning of call to `retry`\n   */\n  readonly elapsed: number;\n\n  /**\n   * Value returned by succeeding function,\n   * or _undefined_ if it failed\n   */\n  readonly value: V | undefined;\n};\n\n/**\n * Backoff options\n */\nexport type RetryOpts<V> = {\n  /**\n   * Maximum number of attempts to make\n   */\n  readonly count: number;\n  /**\n   * Starting milliseconds for sleeping after failure\n   * Defaults to 1000.\n   * Must be above zero.\n   */\n  readonly startMs?: number;\n  /**\n   * Initial waiting period before first attempt (optional)\n   */\n  readonly predelayMs?: number;\n  /**\n   * Optional abort signal\n   */\n  readonly abort?: AbortSignal;\n  /**\n   * Log: _true_ logs to console\n   */\n  readonly log?: boolean;\n  /**\n   * Math.pow factor. Defaults to 1.1. How much slower to\n   * get with each retry.\n   */\n  readonly power?: number;\n\n  /***\n   * Default value to return if it fails\n   */\n  readonly defaultValue?: V;\n};\n\n/**\n * Keeps calling `cb` until it returns something other than _undefined_. If it throws an exception,\n * it will cancel the retry, bubbling the exception and cancelling the retry.\n *\n * ```js\n * // A function that only works some of the time\n * const flakyFn = async () => {\n *  // do the thing\n *  if (Math.random() > 0.9) return true; // success\n *  return; // 'failed'\n * };\n *\n * // Retry it up to five times,\n * // starting with 1000ms interval\n * const result = await retry(flakyFn, {\n *  count: 5\n * });\n *\n * if (result.success) {\n *  // Yay\n * } else {\n *  console.log(`Failed after ${result.attempts} attempts. Elapsed: ${result.elapsed}`);\n *  console.log(result.message);\n * }\n * ```\n *\n * An `AbortSignal` can be used to cancel process.\n * ```js\n * const abort = new AbortController();\n * const result = await retry(cb, { startMs: 6000, count: 1000, signal: abort.signal });\n *\n * // Somewhere else...\n * abort('Cancel!'); // Trigger abort\n * ```\n * @param callback Function to run\n * @param opts Options\n * @returns\n */\nexport const retry = async <V>(\n  callback: () => Promise<V | undefined>,\n  //eslint-disable-next-line functional/prefer-immutable-types\n  opts: RetryOpts<V>\n): Promise<RetryResult<V>> => {\n  const signal = opts.abort;\n  const log = resolveLogOption(opts.log);\n  const power = opts.power ?? 1.1;\n  const predelayMs = opts.predelayMs ?? 0;\n  const startedAt = since();\n\n  //eslint-disable-next-line functional/no-let\n  let t = opts.startMs ?? 1000;\n  const count = opts.count;\n  //eslint-disable-next-line functional/no-let\n  let attempts = 0;\n\n  throwIntegerTest(count, `aboveZero`, `count`);\n  if (t <= 0) throw new Error(`startMs must be above zero`);\n\n  if (predelayMs > 0) await sleep({ millis: predelayMs, signal: signal });\n  if (signal?.aborted) {\n    return {\n      success: false,\n      attempts,\n      value: opts.defaultValue,\n      elapsed: startedAt(),\n      message: `Aborted during predelay`,\n    };\n  }\n  while (attempts < count) {\n    attempts++;\n    const callbackResult = await callback();\n    if (callbackResult !== undefined) {\n      return { value: callbackResult, success: true, attempts, elapsed: startedAt() };\n    }\n    log({\n      msg: `retry attempts: ${ attempts } t: ${ elapsedToString(t) }`,\n    });\n\n    // Did not succeed.\n    if (attempts >= count) {\n      break; // Out of attempts, no point sleeping again\n    }\n    // Sleep\n    try {\n      await sleep({ millis: t, signal });\n    } catch (error) {\n      // Eg if abort signal fires\n      return {\n        success: false,\n        attempts,\n        value: opts.defaultValue,\n        message: getErrorMessage(error),\n        elapsed: startedAt(),\n      };\n    }\n\n    // Increase sleep time for next fail\n    t = Math.floor(Math.pow(t, power));\n  }\n\n  return {\n    message: `Giving up after ${ attempts } attempts.`,\n    success: false,\n    attempts,\n    value: opts.defaultValue,\n    elapsed: startedAt(),\n  };\n};\n","import { SimpleEventEmitter } from '../Events.js';\nimport * as StateMachine from '../flow/StateMachine.js';\n\nimport { indexOfCharCode, omitChars } from '../Text.js';\nimport { Codec } from './Codec.js';\nimport { StringReceiveBuffer } from './StringReceiveBuffer.js';\nimport { StringWriteBuffer } from './StringWriteBuffer.js';\nimport { retry } from '../flow/Retry.js';\nimport {\n  genericStateTransitionsInstance,\n  type GenericStateTransitions,\n  type IoEvents,\n} from './index.js';\n\nexport type Opts = {\n  readonly service: string;\n  readonly rxGattCharacteristic: string;\n  readonly txGattCharacteristic: string;\n  readonly chunkSize: number;\n  readonly name: string;\n  readonly connectAttempts: number;\n  readonly debug: boolean;\n};\n\nconst reconnect = async () => {\n  console.log(`Connect?`);\n  if (!(`bluetooth` in navigator)) return false;\n  if (!(`getDevices` in navigator.bluetooth)) return false;\n\n  const devices = await navigator.bluetooth.getDevices();\n  console.log(devices);\n\n  for (const device of devices) {\n    console.log(device);\n    // Start a scan for each device before connecting to check that they're in\n    // range.\n    const abortController = new AbortController();\n    await device.watchAdvertisements({ signal: abortController.signal });\n    // eslint-disable-next-line @typescript-eslint/no-misused-promises\n    device.addEventListener(`advertisementreceived`, async (event) => {\n      console.log(event);\n      // Stop the scan to conserve power on mobile devices.\n      abortController.abort();\n\n      // At this point, we know that the device is in range, and we can attempt\n      // to connect to it.\n      await event.device.gatt?.connect();\n      console.log(`Connected!`);\n    });\n  }\n};\n\nexport class BleDevice extends SimpleEventEmitter<\n  IoEvents<GenericStateTransitions>\n> {\n  states: StateMachine.WithEvents<GenericStateTransitions>;\n  codec: Codec;\n  rx: BluetoothRemoteGATTCharacteristic | undefined;\n  tx: BluetoothRemoteGATTCharacteristic | undefined;\n  gatt: BluetoothRemoteGATTServer | undefined;\n  verboseLogging = false;\n\n  rxBuffer: StringReceiveBuffer;\n  txBuffer: StringWriteBuffer;\n\n  constructor(\n    private device: BluetoothDevice,\n    private config: Opts\n  ) {\n    super();\n    this.verboseLogging = config.debug;\n    this.txBuffer = new StringWriteBuffer(async (data) => {\n      await this.writeInternal(data);\n    }, config);\n\n    this.rxBuffer = new StringReceiveBuffer((line) => {\n      this.fireEvent(`data`, { data: line });\n    });\n\n    this.codec = new Codec();\n    this.states = new StateMachine.WithEvents<GenericStateTransitions>(\n      genericStateTransitionsInstance,\n      {\n        initial: `ready`,\n      }\n    );\n    this.states.addEventListener(`change`, (event) => {\n      this.fireEvent(`change`, event);\n      this.verbose(`${ event.priorState } -> ${ event.newState }`);\n\n      if (event.priorState === `connected`) {\n        // Clear out buffers\n        this.rxBuffer.clear();\n        this.txBuffer.clear();\n      }\n    });\n\n    device.addEventListener(`gattserverdisconnected`, () => {\n      if (this.isClosed) return;\n      this.verbose(`GATT server disconnected`);\n      this.states.state = `closed`;\n    });\n\n    this.verbose(`ctor ${ device.name } ${ device.id }`);\n  }\n\n  get isConnected(): boolean {\n    return this.states.state === `connected`;\n  }\n\n  get isClosed(): boolean {\n    return this.states.state === `closed`;\n  }\n\n  write(txt: string) {\n    if (this.states.state !== `connected`) {\n      throw new Error(`Cannot write while state is ${ this.states.state }`);\n    }\n    this.txBuffer.add(txt);\n  }\n\n  private async writeInternal(txt: string) {\n    this.verbose(`writeInternal ${ txt }`);\n    const tx = this.tx;\n    if (tx === undefined) {\n      throw new Error(`Unexpectedly without tx characteristic`);\n    }\n    try {\n      await tx.writeValue(this.codec.toBuffer(txt));\n    } catch (error: unknown) {\n      this.warn(error);\n    }\n  }\n\n  disconnect() {\n    if (this.states.state !== `connected`) return;\n    this.gatt?.disconnect();\n  }\n\n  async connect() {\n    const attempts = this.config.connectAttempts ?? 3;\n\n    this.states.state = `connecting`;\n\n    this.verbose(`connect`);\n    const gatt = this.device.gatt;\n    if (gatt === undefined) throw new Error(`Gatt not available on device`);\n\n    await retry(\n      async () => {\n        this.verbose(`connect.retry`);\n        const server = await gatt.connect();\n        this.verbose(`Getting primary service`);\n        const service = await server.getPrimaryService(this.config.service);\n        this.verbose(`Getting characteristics`);\n        const rx = await service.getCharacteristic(\n          this.config.rxGattCharacteristic\n        );\n        const tx = await service.getCharacteristic(\n          this.config.txGattCharacteristic\n        );\n\n        rx.addEventListener(`characteristicvaluechanged`, (event) => { this.onRx(event); }\n        );\n        this.rx = rx;\n        this.tx = tx;\n        this.gatt = gatt;\n        this.states.state = `connected`;\n\n        await rx.startNotifications();\n        return true;\n      },\n      {\n        count: attempts,\n        startMs: 200,\n      }\n    );\n  }\n\n  private onRx(event: Event) {\n    const rx = this.rx;\n    if (rx === undefined) return;\n\n    //eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const view = (event.target as any).value as DataView;\n    if (view === undefined) return;\n\n    //eslint-disable-next-line functional/no-let\n    let string_ = this.codec.fromBuffer(view.buffer);\n\n    // Check for flow control chars\n    const plzStop = indexOfCharCode(string_, 19);\n    const plzStart = indexOfCharCode(string_, 17);\n\n    // Remove if found\n    if (plzStart && plzStop < plzStart) {\n      this.verbose(`Tx plz start`);\n      string_ = omitChars(string_, plzStart, 1);\n      this.txBuffer.paused = false;\n    }\n    if (plzStop && plzStop > plzStart) {\n      this.verbose(`Tx plz stop`);\n      string_ = omitChars(string_, plzStop, 1);\n      this.txBuffer.paused = true;\n    }\n\n    this.rxBuffer.add(string_);\n  }\n\n  protected verbose(m: string) {\n    if (this.verboseLogging) console.info(`${ this.config.name }`, m);\n  }\n\n  protected log(m: string) {\n    console.log(`${ this.config.name }`, m);\n  }\n\n  protected warn(m: unknown) {\n    console.warn(`${ this.config.name }`, m);\n  }\n}\n","import { Arrays } from '../collections/index.js';\nimport AudioVisualiser from './AudioVisualiser.js';\nimport { throwNumberTest, throwIntegerTest } from '../Guards.js';\nimport { isPowerOfTwo } from '../Util.js';\n\n/**\n * Options for audio processing\n *\n * fftSize: Must be a power of 2, from 32 - 32768. Higher number means\n * more precision and higher CPU overhead\n * @see https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode/fftSize\n *\n * smoothingTimeConstant: Range from 0-1, default is 0.8.\n * @see https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode/smoothingTimeConstant\n *\n * debug: If true, additonal console logging will happen\n */\nexport type Opts = {\n  readonly showVis?: boolean;\n  /**\n   * FFT size. Must be a power of 2, from 32 - 32768. Higher number means\n   * more precision and higher CPU overhead\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode/fftSize\n   */\n  readonly fftSize?: number;\n  /**\n   * Range from 0-1, default is 0.8\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode/smoothingTimeConstant\n   */\n  readonly smoothingTimeConstant?: number;\n  readonly debug?: boolean;\n};\n\nexport type DataAnalyser = (\n  node: AnalyserNode,\n  analyser: AudioAnalyser\n) => void;\n\n/**\n * Basic audio analyser. Returns back waveform and FFT analysis. Use {@link peakLevel} if you want sound level, or {@link freq} if you just want FFT results.\n *\n * ```js\n * const onData = (freq, wave, analyser) => {\n *  // Demo: Get FFT results just for 100Hz-1KHz.\n *  const freqSlice = analyser.sliceByFrequency(100,1000,freq);\n *\n *  // Demo: Get FFT value for a particular frequency (1KHz)\n *  const amt = freq[analyser.getIndexForFrequency(1000)];\n * }\n * basic(onData, {fftSize: 512});\n * ```\n *\n * An `Analyser` instance is returned and can be controlled:\n * ```js\n * const analyser = basic(onData);\n * analyser.paused = true;\n * ```\n *\n * Note: Browers won't allow microphone access unless the call has come from a user-interaction, eg pointerup event handler.\n *\n * @param onData Handler for data\n * @param opts Options\n * @returns Analyser instance\n */\nexport const basic = (\n  onData: (\n    freq: Float32Array,\n    wave: Float32Array,\n    analyser: AudioAnalyser\n  ) => void,\n  opts: Opts = {}\n): AudioAnalyser =>\n  new AudioAnalyser((node, analyser) => {\n    // Get frequency and amplitude data\n    const freq = new Float32Array(node.frequencyBinCount);\n    const wave = new Float32Array(node.fftSize);\n\n    // Load arrays with data\n    node.getFloatFrequencyData(freq);\n    node.getFloatTimeDomainData(wave);\n\n    // Send back\n    onData(freq, wave, analyser);\n  }, opts);\n\n/**\n * Basic audio analyser. Returns FFT analysis. Use {@link peakLevel} if you want the sound level, or {@link basic} if you also want the waveform.\n *\n * ```js\n * const onData = (freq, analyser) => {\n *  // Demo: Print out each sound frequency (Hz) and amount of energy in that band\n *  for (let i=0;i<freq.length;i++) {\n *    const f = analyser.getFrequencyAtIndex(0);\n *    console.log(`${i}. frequency: ${f} amount: ${freq[i]}`);\n *  }\n * }\n * freq(onData, {fftSize:512});\n * ```\n *\n * Note: Browers won't allow microphone access unless the call has come from a user-interaction, eg pointerup event handler.\n *\n * @param onData\n * @param opts\n * @returns\n */\nexport const freq = (\n  onData: (freq: Float32Array, analyser: AudioAnalyser) => void,\n  opts: Opts = {}\n): AudioAnalyser =>\n  new AudioAnalyser((node, analyser) => {\n    const freq = new Float32Array(node.frequencyBinCount);\n    node.getFloatFrequencyData(freq);\n    onData(freq, analyser);\n  }, opts);\n\n/**\n * Basic audio analyser which reports the peak sound level.\n *\n * ```js\n * peakLevel(level => {\n *  console.log(level);\n * });\n * ```\n *\n * Note: Browers won't allow microphone access unless the call has come from a user-interaction, eg pointerup event handler.\n * @param onData\n * @param opts\n * @returns\n */\nexport const peakLevel = (\n  onData: (level: number, analyser: AudioAnalyser) => void,\n  opts: Opts = {}\n): AudioAnalyser =>\n  new AudioAnalyser((node, analyser) => {\n    const wave = new Float32Array(node.fftSize);\n    node.getFloatTimeDomainData(wave);\n    onData(Arrays.maxFast(wave), analyser);\n  }, opts);\n\n/**\n * Helper for doing audio analysis. It takes case of connecting the audio stream, running in a loop and pause capability.\n *\n * Provide a function which works with an [AnalyserNode](https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode), and does something with the result.\n * ```js\n * const myAnalysis = (node, analyser) => {\n *  const freq = new Float32Array(node.frequencyBinCount);\n *  node.getFloatFrequencyData(freq);\n *  // Do something with frequency data...\n * }\n * const a = new Analyser(myAnalysis);\n * ```\n *\n * Two helper functions provide ready-to-use Analysers:\n * * {@link peakLevel} peak decibel reading\n * * {@link freq} FFT results\n * * {@link basic} FFT results and waveform\n *\n * Note: Browers won't allow microphone access unless the call has come from a user-interaction, eg pointerup event handler.\n *\n */\nexport class AudioAnalyser {\n  showVis: boolean;\n  fftSize: number;\n  smoothingTimeConstant: number;\n  #isPaused = false;\n  debug: boolean;\n  #initInProgress = false;\n\n  visualiser: AudioVisualiser | undefined;\n  audioCtx: AudioContext | undefined;\n  analyserNode: AnalyserNode | undefined;\n\n  analyse: DataAnalyser;\n\n  constructor(analyse: DataAnalyser, opts: Opts = {}) {\n    this.showVis = opts.showVis ?? false;\n    this.fftSize = opts.fftSize ?? 1024;\n    this.debug = opts.debug ?? false;\n    this.smoothingTimeConstant = opts.smoothingTimeConstant ?? 0.8;\n\n    throwIntegerTest(this.fftSize, `positive`, `opts.fftSize`);\n    throwNumberTest(\n      this.smoothingTimeConstant,\n      `percentage`,\n      `opts.smoothingTimeConstant`\n    );\n\n    if (!isPowerOfTwo(this.fftSize)) {\n      throw new Error(\n        `fftSize must be a power of two from 32 to 32768 (${ this.fftSize })`\n      );\n    }\n    if (this.fftSize < 32) throw new Error(`fftSize must be at least 32`);\n    if (this.fftSize > 32768) { throw new Error(`fftSize must be no greater than 32768`); }\n\n    this.analyse = analyse;\n    this.paused = false;\n\n    this.init();\n\n    const visualiserEl = document.getElementById(`audio-visualiser`);\n    if (visualiserEl) {\n      const visualiser = new AudioVisualiser(visualiserEl, this);\n      visualiser.setExpanded(this.showVis);\n      this.visualiser = visualiser;\n    }\n  }\n\n  init() {\n    if (this.#initInProgress) {\n      if (this.debug) console.debug(`Init already in progress`);\n      return;\n    }\n    this.#initInProgress = true;\n\n    // Initalise microphone\n    navigator.mediaDevices\n      .getUserMedia({ audio: true })\n      .then((stream) => {\n        this.onMicSuccess(stream);\n      })\n      .catch((err) => {\n        this.#initInProgress = false;\n        console.error(err);\n      });\n  }\n\n  get paused(): boolean {\n    return this.#isPaused;\n  }\n\n  set paused(v: boolean) {\n    if (v === this.#isPaused) return;\n    this.#isPaused = v;\n    if (!v) {\n      if (this.debug) console.log(`Unpaused`);\n      window.requestAnimationFrame(this.analyseLoop.bind(this));\n    } else {\n      if (this.debug) console.log(`Paused`);\n    }\n  }\n\n  private setup(audioCtx: AudioContext, stream: MediaStream) {\n    const analyser = audioCtx.createAnalyser();\n\n    // fftSize must be a power of 2. Higher values slower, more detailed\n    // Range is 32-32768\n    analyser.fftSize = this.fftSize;\n\n    // smoothingTimeConstant ranges from 0.0 to 1.0\n    // 0 = no averaging. Fast response, jittery\n    // 1 = maximum averaging. Slow response, smooth\n    analyser.smoothingTimeConstant = this.smoothingTimeConstant;\n\n    // Microphone -> analyser\n    const micSource = audioCtx.createMediaStreamSource(stream);\n    micSource.connect(analyser);\n    return analyser;\n  }\n\n  // Microphone successfully initalised, now have access to audio data\n  private onMicSuccess(stream: MediaStream) {\n    try {\n      const audioCtx = new AudioContext();\n\n      audioCtx.addEventListener(`statechange`, () => {\n        if (this.debug) console.log(`Audio context state: ${ audioCtx.state }`);\n      });\n\n      this.audioCtx = audioCtx;\n      this.analyserNode = this.setup(audioCtx, stream);\n\n      // Start loop\n      window.requestAnimationFrame(this.analyseLoop.bind(this));\n    } catch (ex) {\n      this.#initInProgress = false;\n      console.error(ex);\n    }\n  }\n\n  private analyseLoop() {\n    if (this.paused) {\n      if (this.debug) console.log(`Paused`);\n      return;\n    }\n\n    const a = this.analyserNode;\n    if (a === undefined) {\n      console.warn(`Analyser undefined`);\n      return;\n    }\n\n    try {\n      // Perform analysis\n      this.analyse(a, this);\n    } catch (e) {\n      console.error(e);\n    }\n\n    // Run again\n    window.requestAnimationFrame(this.analyseLoop.bind(this));\n  }\n\n  // visualise(wave, freq) {\n  //   if (!this.visualiser) return;\n  //   this.visualiser.renderWave(wave, true);\n  //   this.visualiser.renderFreq(freq);\n  // }\n\n  /**\n   * Returns the maximum FFT value within the given frequency range\n   */\n  getFrequencyRangeMax(\n    lowFreq: number,\n    highFreq: number,\n    freqData: readonly number[]\n  ): number {\n    const samples = this.sliceByFrequency(lowFreq, highFreq, freqData);\n    return Arrays.max(samples);\n  }\n\n  /**\n   * Returns a sub-sampling of frequency analysis data that falls between\n   * `lowFreq` and `highFreq`.\n   * @param lowFreq Low frequency\n   * @param highFreq High frequency\n   * @param freqData Full-spectrum frequency data\n   * @returns Sub-sampling of analysis\n   */\n  sliceByFrequency(\n    lowFreq: number,\n    highFreq: number,\n    freqData: readonly number[]\n  ) {\n    const lowIndex = this.getIndexForFrequency(lowFreq);\n    const highIndex = this.getIndexForFrequency(highFreq);\n\n    // Grab a 'slice' of the array between these indexes\n    const samples = freqData.slice(lowIndex, highIndex);\n    return samples;\n  }\n\n  /**\n   * Returns the starting frequency for a given binned frequency index.\n   * @param index Array index\n   * @returns Sound frequency\n   */\n  getFrequencyAtIndex(index: number): number {\n    const a = this.analyserNode;\n    const ctx = this.audioCtx;\n    if (a === undefined) throw new Error(`Analyser not available`);\n    if (ctx === undefined) throw new Error(`Audio context not available`);\n\n    throwIntegerTest(index, `positive`, `index`);\n    if (index > a.frequencyBinCount) {\n      throw new Error(\n        `Index ${ index } exceeds frequency bin count ${ a.frequencyBinCount }`\n      );\n    }\n\n    return (index * ctx.sampleRate) / (a.frequencyBinCount * 2);\n  }\n\n  /**\n   * Returns a binned array index for a given frequency\n   * @param freq Sound frequency\n   * @returns Array index into frequency bins\n   */\n  getIndexForFrequency(freq: number): number {\n    const a = this.analyserNode;\n    if (a === undefined) throw new Error(`Analyser not available`);\n\n    const nyquist = a.context.sampleRate / 2.0;\n    const index = Math.round((freq / nyquist) * a.frequencyBinCount);\n    if (index < 0) return 0;\n    if (index >= a.frequencyBinCount) return a.frequencyBinCount - 1;\n    return index;\n  }\n}\n","/**\n * Visualiser component\n *\n * Usage: import visualiser.js. Instantiate on document load, and pass in the\n * parent element into the constructor.\n *\n * eg: const v = new Visualiser(document.getElementById('renderer'));\n *\n * Data must be passed to the component via renderFreq or renderWave.\n *\n * Draws on https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API\n */\n\nimport { Arrays } from '../collections/index.js';\nimport { Points } from '../geometry/index.js';\nimport { numberTracker } from '../data/NumberTracker.js';\nimport { AudioAnalyser } from './AudioAnalyser.js';\n\n// TODO: This is an adaption of old code. Needs to be smartened up further\nexport default class AudioVisualiser {\n  freqMaxRange = 200;\n  audio: AudioAnalyser;\n  parent: HTMLElement;\n\n  lastPointer: Points.Point = { x: 0, y: 0 };\n  pointerDown = false;\n  pointerClicking = false;\n  pointerClickDelayMs = 100;\n  pointerDelaying = false;\n\n  waveTracker;\n  freqTracker;\n  el: HTMLElement;\n\n  constructor(parentElem: HTMLElement, audio: AudioAnalyser) {\n    this.audio = audio;\n    this.parent = parentElem;\n    this.waveTracker = numberTracker();\n    this.freqTracker = numberTracker();\n\n    // Add HTML\n    parentElem.innerHTML = `\n    <section>\n      <button id=\"rendererComponentToggle\">🔼</button>\n      <div>\n        <h1>Visualiser</h1>\n        <div style=\"display:flex; flex-wrap: wrap\">\n          <div class=\"visPanel\">\n            <h2>Frequency distribution</h2>\n            <br />\n            <canvas id=\"rendererComponentFreqData\" height=\"200\" width=\"400\"></canvas>\n          </div>\n          <div class=\"visPanel\">\n            <h2>Waveform</h2>\n            <button id=\"rendererComponentWaveReset\">Reset</button>\n            <div>\n              Press and hold on wave to measure\n            </div>\n            <br />\n            <canvas id=\"rendererComponentWaveData\" height=\"200\" width=\"400\"></canvas>\n          </div>\n        </div>\n      </div>\n    </section>\n    `;\n    this.el = parentElem.children[0] as HTMLElement;\n\n    document\n      .getElementById(`rendererComponentToggle`)\n      ?.addEventListener(`click`, () => {\n        this.setExpanded(!this.isExpanded());\n      });\n    this.el.addEventListener(`pointermove`, (e) => this.onPointer(e));\n    //this.el.addEventListener(`touchbegin`, (e) => this.onPointer(e));\n    this.el.addEventListener(`pointerup`, () => {\n      this.pointerDelaying = false;\n      this.pointerDown = false;\n    });\n    this.el.addEventListener(`pointerdown`, () => {\n      this.pointerDelaying = true;\n      setTimeout(() => {\n        if (this.pointerDelaying) {\n          this.pointerDelaying = false;\n          this.pointerDown = true;\n        }\n      }, this.pointerClickDelayMs);\n    });\n    this.el.addEventListener(`pointerleave`, () => {\n      this.pointerDelaying = false;\n      this.pointerDown = false;\n    });\n\n    document\n      .getElementById(`rendererComponentWaveReset`)\n      ?.addEventListener(`click`, () => {\n        this.clear();\n      });\n  }\n\n  renderFreq(freq: readonly number[]) {\n    if (!this.isExpanded()) return; // Don't render if collapsed\n    if (!freq) return; // Data is undefined/null\n\n    const canvas = document.getElementById(\n      `rendererComponentFreqData`\n    ) as HTMLCanvasElement;\n    if (canvas === null) throw new Error(`Cannot find canvas element`);\n    const g = canvas.getContext(`2d`);\n    if (g === null) throw new Error(`Cannot create drawing context`);\n\n    const bins = freq.length;\n    const canvasWidth = canvas.clientWidth;\n    const canvasHeight = canvas.clientHeight;\n    g.clearRect(0, 0, canvasWidth, canvasHeight);\n\n    const pointer = this.getPointerRelativeTo(canvas);\n    const width = canvasWidth / bins;\n    const minMax = Arrays.minMaxAvg(freq);\n\n    //eslint-disable-next-line functional/no-let\n    for (let i = 0; i < bins; i++) {\n      if (!Number.isFinite(freq[i])) continue;\n\n      const value = freq[i] - minMax.min;\n      const valueRelative = value / this.freqMaxRange;\n      const height = Math.abs(canvasHeight * valueRelative);\n      const offset = canvasHeight - height;\n\n      const hue = (i / bins) * 360;\n      const left = i * width;\n      g.fillStyle = `hsl(` + hue + `, 100%, 50%)`;\n\n      // Show info about data under pointer\n      if (\n        pointer.y > 0 &&\n        pointer.y <= canvasHeight &&\n        pointer.x >= left &&\n        pointer.x <= left + width\n      ) {\n        // Keep track of data\n        if (this.freqTracker.id !== i.toString()) {\n          this.freqTracker = numberTracker({ id: i.toString() });\n        }\n        this.freqTracker.seen(freq[i]);\n\n        const freqMma = this.freqTracker.getMinMaxAvg();\n\n        // Display\n        g.fillStyle = `black`;\n        if (this.audio) {\n          g.fillText(\n            `Frequency (${i}) at pointer: ${this.audio\n              .getFrequencyAtIndex(i)\n              .toLocaleString(`en`)} - ${this.audio\n              .getFrequencyAtIndex(i + 1)\n              .toLocaleString(`en`)}`,\n            2,\n            10\n          );\n        }\n        g.fillText(`Raw value: ${freq[i].toFixed(2)}`, 2, 20);\n        g.fillText(`Min: ${freqMma.min.toFixed(2)}`, 2, 40);\n        g.fillText(`Max: ${freqMma.max.toFixed(2)}`, 60, 40);\n        g.fillText(`Avg: ${freqMma.avg.toFixed(2)}`, 120, 40);\n      }\n      g.fillRect(left, offset, width, height);\n    }\n  }\n\n  isExpanded() {\n    const contentsElem = this.el.querySelector(`div`);\n    if (contentsElem === null) throw new Error(`contents div not found`);\n    return contentsElem.style.display === ``;\n  }\n\n  setExpanded(value: boolean) {\n    const contentsElem = this.el.querySelector(`div`);\n    const button = this.el.querySelector(`button`);\n\n    if (button === null) throw new Error(`Button element not found`);\n    if (contentsElem === null) throw new Error(`Contents element not found`);\n    if (value) {\n      contentsElem.style.display = ``;\n      button.innerText = `🔼`;\n    } else {\n      contentsElem.style.display = `none`;\n      button.innerText = `🔽`;\n    }\n  }\n\n  clear() {\n    this.clearCanvas(\n      document.getElementById(`rendererComponentFreqData`) as HTMLCanvasElement\n    );\n    this.clearCanvas(\n      document.getElementById(`rendererComponentWaveData`) as HTMLCanvasElement\n    );\n  }\n\n  // Clears a canvas to white\n  clearCanvas(canvas: HTMLCanvasElement | null) {\n    if (canvas === null) throw new Error(`Canvas is null`);\n    const g = canvas.getContext(`2d`);\n    if (g === null) throw new Error(`Cannot create drawing context`);\n    g.fillStyle = `white`;\n    g.fillRect(0, 0, canvas.clientWidth, canvas.clientHeight);\n  }\n\n  // Renders waveform data.\n  // Adapted from MDN's AnalyserNode.getFloatTimeDomainData() example\n  renderWave(wave: readonly number[], bipolar = true) {\n    if (!this.isExpanded()) return; // Don't render if collapsed\n    if (!wave) return; // Undefined or null data\n    const canvas = document.getElementById(\n      `rendererComponentWaveData`\n    ) as HTMLCanvasElement;\n    if (canvas === null) throw new Error(`Cannot find wave canvas`);\n\n    const g = canvas.getContext(`2d`);\n    if (g === null) throw new Error(`Cannot create drawing context for wave`);\n\n    const canvasWidth = canvas.clientWidth;\n    const canvasHeight = canvas.clientHeight;\n    const pointer = this.getPointerRelativeTo(canvas);\n    const infoAreaHeight = 20;\n    const infoAreaWidth = 60;\n    const bins = wave.length;\n    g.fillStyle = `white`;\n    g.fillRect(0, 0, infoAreaWidth, infoAreaHeight);\n\n    const width = canvasWidth / bins;\n\n    // Clears the screen with very light tint of white\n    // to fade out last waveform. Set this higher to remove effect\n    g.fillStyle = `rgba(255, 255, 255, 0.03)`;\n    g.fillRect(0, 20, canvasWidth, canvasHeight);\n\n    g.fillStyle = `red`;\n    if (bipolar) {\n      g.fillRect(0, canvasHeight / 2, canvasWidth, 1);\n    } else {\n      g.fillRect(0, canvasHeight - 1, canvasWidth, 1);\n    }\n\n    g.lineWidth = 1;\n    g.strokeStyle = `black`;\n    g.beginPath();\n\n    //eslint-disable-next-line functional/no-let\n    let x = 0;\n\n    //eslint-disable-next-line functional/no-let\n    for (let i = 0; i < bins; i++) {\n      const height = wave[i] * canvasHeight;\n      const y = bipolar ? canvasHeight / 2 - height : canvasHeight - height;\n\n      if (i === 0) {\n        g.moveTo(x, y);\n      } else {\n        g.lineTo(x, y);\n      }\n      x += width;\n\n      if (this.pointerDown) this.waveTracker.seen(wave[i]);\n    }\n    g.lineTo(canvasWidth, bipolar ? canvasHeight / 2 : canvasHeight); //canvas.height / 2);\n    g.stroke();\n\n    // Draw\n    if (this.pointerDown) {\n      const waveMma = this.waveTracker.getMinMaxAvg();\n      g.fillStyle = `rgba(255,255,0,1)`;\n      g.fillRect(infoAreaWidth, 0, 150, 20);\n      g.fillStyle = `black`;\n      g.fillText(`Min: ` + waveMma.min.toFixed(2), 60, 10);\n      g.fillText(`Max: ` + waveMma.max.toFixed(2), 110, 10);\n      g.fillText(`Avg: ` + waveMma.avg.toFixed(2), 160, 10);\n    } else {\n      this.waveTracker.reset();\n    }\n\n    // Show info about data under pointer\n    if (\n      pointer.y > 0 &&\n      pointer.y <= canvasHeight &&\n      pointer.x >= 0 &&\n      pointer.x <= canvasWidth\n    ) {\n      g.fillStyle = `black`;\n      g.fillText(\n        `Level: ` + (1.0 - pointer.y / canvasHeight).toFixed(2),\n        2,\n        10\n      );\n    }\n  }\n\n  // Yields pointer position relative to given element\n  getPointerRelativeTo(elem: HTMLElement) {\n    const rect = elem.getBoundingClientRect();\n    return {\n      x: this.lastPointer.x - rect.left - window.scrollX, //elem.offsetLeft + window.scrollX,\n      y: this.lastPointer.y - rect.top - window.scrollY, //elem.offsetTop + window.scrollY\n    };\n  }\n\n  // Keeps track of last pointer position in page coordinate space\n  onPointer(evt: MouseEvent | PointerEvent) {\n    this.lastPointer = {\n      x: evt.pageX,\n      y: evt.pageY,\n    };\n    evt.preventDefault();\n  }\n\n  // getMinMax(data, start = 0, end = data.length) {\n  //   if (end > data.length) throw new Error(`end is past size of array`);\n  //   if (start < 0) throw new Error(`start should be at least 0`);\n  //   if (end <= start) throw new Error(`end should be greater than start`);\n\n  //   let max = Number.MIN_SAFE_INTEGER;\n  //   let min = Number.MAX_SAFE_INTEGER;\n  //   for (let i = start; i < end; i++) {\n  //     max = Math.max(data[i], max);\n  //     min = Math.min(data[i], min);\n  //   }\n  //   if (!Number.isFinite(max)) max = 0;\n  //   if (!Number.isFinite(min)) min = 0;\n\n  //   return {max: max, min: min};\n  // }\n}\n","import { EspruinoBleDevice } from './EspruinoBleDevice.js';\nimport { defaultOpts as NordicDefaults } from './NordicBleDevice.js';\nimport { type StateChangeEvent } from '../flow/StateMachineWithEvents.js';\nimport { type ISimpleEventEmitter } from '../ISimpleEventEmitter.js';\nimport { string as randomString } from '../Random.js';\nimport { waitFor } from '../flow/WaitFor.js';\nimport {\n  EspruinoSerialDevice,\n\n} from './EspruinoSerialDevice.js';\nimport type {\n  GenericStateTransitions,\n  IoDataEvent,\n  IoEvents,\n} from './index.js';\n\n\n\n\nexport type EspruinoStates =\n  | `ready`\n  | `connecting`\n  | `connected`\n  | `closed`\n  | `closing`\n  ;\n\n/**\n * Options for device\n */\nexport type Options = {\n  /**\n   * Default milliseconds to wait before giving up on a well-formed reply. 5 seconds is the default.\n   */\n  readonly evalTimeoutMs?: number;\n  /**\n   * Name of device. Only used for printing log mesages to the console\n   */\n  readonly name?: string;\n\n  /**\n   * If true, additional logging information is printed\n   */\n  readonly debug?: boolean;\n};\n\n/**\n * Options for code evaluation\n */\nexport type EvalOpts = {\n  /**\n   * Milliseconds to wait before giving up on well-formed reply. 5 seconds is the default.\n   */\n  readonly timeoutMs?: number;\n  /**\n   * If true (default), it assumes that anything received from the board\n   * is a response to the eval\n   */\n  readonly assumeExclusive?: boolean;\n\n  /**\n   * If true, executed code is traced\n   */\n  readonly debug?: boolean;\n};\n\nexport type EspruinoBleOpts = {\n  /**\n   * If the name is specified, this value is used\n   * for filtering Bluetooth devices\n   */\n  readonly name?: string;\n  /**\n   * If true, additional logging messages are\n   * displayed on the console\n   */\n  readonly debug?: boolean;\n  /**\n   * If specified, these filtering options are used instead\n   */\n  readonly filters?: ReadonlyArray<BluetoothLEScanFilter>;\n};\n\n/**\n * Instantiates a Puck.js. See {@link EspruinoBleDevice} for more info.\n * [Online demos](https://clinth.github.io/ixfx-demos/io/)\n *\n * If `opts.name` is specified, this will the the Bluetooth device sought.\n *\n * ```js\n * import { Espruino } from 'https://unpkg.com/ixfx/dist/io.js'\n * const e = await Espruino.puck({ name:`Puck.js a123` });\n * ```\n *\n * If no name is specified, a list of all devices starting with `Puck.js` are shown.\n *\n * To get more control over filtering, pass in `opts.filter`. `opts.name` is not used as a filter in this scenario.\n *\n * ```js\n * import { Espruino } from 'https://unpkg.com/ixfx/dist/io.js'\n * const filters = [\n *  { namePrefix: `Puck.js` },\n *  { namePrefix: `Pixl.js` },\n *  {services: [NordicDefaults.service] }\n * ]\n * const e = await Espruino.puck({ filters });\n * ```\n *\n * @returns Returns a connected instance, or throws exception if user cancelled or could not connect.\n */\nexport const puck = async (opts: EspruinoBleOpts = {}) => {\n  const name = opts.name ?? `Puck`;\n  const debug = opts.debug ?? false;\n\n  const device = await navigator.bluetooth.requestDevice({\n    filters: getFilters(opts),\n    optionalServices: [ NordicDefaults.service ],\n  });\n\n  console.log(device.name);\n  const d = new EspruinoBleDevice(device, { name, debug });\n  await d.connect();\n  return d;\n};\n\n/**\n * Create a serial-connected Espruino device.\n *\n * ```js\n * import { Espruino } from 'https://unpkg.com/ixfx/dist/io.js'\n * const e = await Espruio.serial();\n * e.connect();\n * ```\n *\n * Options:\n * ```js\n * import { Espruino } from 'https://unpkg.com/ixfx/dist/io.js'\n * const e = await Espruino.serial({ debug: true, evalTimeoutMs: 1000, name: `My Pico` });\n * e.connect();\n * ```\n *\n * Listen for events:\n * ```js\n * e.addEventListener(`change`, evt => {\n *  console.log(`State change ${evt.priorState} -> ${evt.newState}`);\n *  if (evt.newState === `connected`) {\n *    // Do something when connected...\n *  }\n * });\n * ```\n *\n * Reading incoming data:\n * ```\n * // Parse incoming data as JSON\n * s.addEventListener(`data`, evt => {\n *  try {\n *    const o = JSON.parse(evt.data);\n *    // If we get this far, JSON is legit\n *  } catch (ex) {\n *  }\n * });\n * ```\n *\n * Writing to the microcontroller\n * ```\n * s.write(JSON.stringify({msg:\"hello\"}));\n * ```\n * @param opts\n * @returns Returns a connected instance, or throws exception if user cancelled or could not connect.\n */\nexport const serial = async (\n  opts: {\n    readonly name?: string;\n    readonly debug?: boolean;\n    readonly evalTimeoutMs?: number;\n  } = {}\n) => {\n  const d = new EspruinoSerialDevice(opts);\n  await d.connect();\n  return d;\n};\n\n/**\n * Returns a list of BLE scan filters, given the\n * connect options.\n * @param opts\n * @returns\n */\nconst getFilters = (opts: EspruinoBleOpts) => {\n  //eslint-disable-next-line functional/no-let\n  const filters: Array<BluetoothLEScanFilter> = [];\n\n  if (opts.filters) {\n    //eslint-disable-next-line functional/immutable-data\n    filters.push(...opts.filters);\n  } else if (opts.name) {\n    // Name filter\n    //eslint-disable-next-line functional/immutable-data\n    filters.push({ name: opts.name });\n    console.info(`Filtering Bluetooth devices by name '${ opts.name }'`);\n  } else {\n    // Default filter\n    //eslint-disable-next-line functional/immutable-data\n    filters.push({ namePrefix: `Puck.js` });\n  }\n  // {namePrefix: 'Pixl.js'},\n  // {namePrefix: 'MDBT42Q'},\n  // {namePrefix: 'RuuviTag'},\n  // {namePrefix: 'iTracker'},\n  // {namePrefix: 'Thingy'},\n  // {namePrefix: 'Espruino'},\n  //{services: [NordicDefaults.service]}\n\n  return filters;\n};\n/**\n * Connects to a generic Espruino BLE device. See  {@link EspruinoBleDevice} for more info.\n * Use {@link puck} if you're connecting to a Puck.js\n *\n * If `opts.name` is specified, only this BLE device will be shown.\n * ```js\n * const e = await connectBle({ name: `Puck.js a123` });\n * ```\n *\n * `opts.filters` overrides and sets arbitary filters.\n *\n * ```js\n * import { Espruino } from 'https://unpkg.com/ixfx/dist/io.js'\n * const filters = [\n *  { namePrefix: `Puck.js` },\n *  { namePrefix: `Pixl.js` },\n *  {services: [NordicDefaults.service] }\n * ]\n * const e = await Espruino.connectBle({ filters });\n * ```\n *\n * @returns Returns a connected instance, or throws exception if user cancelled or could not connect.\n */\nexport const connectBle = async (opts: EspruinoBleOpts = {}) => {\n  const device = await navigator.bluetooth.requestDevice({\n    filters: getFilters(opts),\n    optionalServices: [ NordicDefaults.service ],\n  });\n  const d = new EspruinoBleDevice(device, { name: `Espruino`, ...opts });\n  await d.connect();\n  return d;\n};\n\nexport type Events = IoEvents<GenericStateTransitions>;\n/**\n * EspruinoDevice\n *\n * This base interface is implemented by {@link EspruinoBleDevice} and {@link EspruinoSerialDevice}.\n */\nexport type EspruinoDevice = {\n  /**\n   * Sends some code to be executed on the Espruino. The result\n   * is packaged into JSON and sent back to your code. An exception is\n   * thrown if code can't be executed for some reason.\n   *\n   * ```js\n   * const sum = await e.eval(`2+2`);\n   * ```\n   *\n   * It will wait for a period of time for a well-formed response from the\n   * Espruino. This might not happen if there is a connection problem\n   * or a syntax error in the code being evaled. In cases like the latter,\n   * it will take up to `timeoutMs` (default 5 seconds) before we give up\n   * waiting for a correct response and throw an error.\n   *\n   * Tweaking of the timeout may be required if `eval()` is giving up too quickly\n   * or too slowly. A default timeout can be given when creating the class.\n   *\n   * Options:\n   *  timeoutMs: Timeout for execution. 5 seconds by default\n   *  assumeExclusive If true, eval assumes all replies from controller are in response to eval. True by default\n   *  debug: If true, execution is traced via `warn` callback\n   * @param code Code to run on the Espruino.\n   * @param opts Options\n   * @param warn Function to pass warning/trace messages to. If undefined, this.warn is used, printing to console.\n   */\n  eval(\n    code: string,\n    opts?: EvalOpts,\n    warn?: (message: string) => void\n  ): Promise<string>;\n\n  /**\n   * Write some code for immediate execution. This is a lower-level\n   * alternative to {@link writeScript}. Be sure to include a new line character '\\n' at the end.\n   * @param m Code\n   */\n  write(m: string): void;\n\n  /**\n   * Writes a script to Espruino.\n   *\n   * It will first send a CTRL+C to cancel any previous input, `reset()` to clear the board,\n   * and then the provided `code` followed by a new line.\n   *\n   * Use {@link eval} instead to execute remote code and get the result back.\n   *\n   * ```js\n   * // Eg from https://www.espruino.com/Web+Bluetooth\n   * espruino.writeScript(`\n   *  setInterval(() => Bluetooth.println(E.getTemperature()), 1000);\n   *  NRF.on('disconnect',()=>reset());\n   * `);\n   * ```\n   *\n   * @param code Code to send. A new line is added automatically.\n   */\n  writeScript(code: string): void;\n\n  /**\n   * Disconnect\n   */\n  disconnect(): void;\n\n  /**\n   * Gets the current evaluation (millis)\n   */\n  get evalTimeoutMs(): number;\n\n  get isConnected(): boolean;\n} & ISimpleEventEmitter<Events>\n\n/**\n * Evaluates some code on an Espruino device.\n *\n * Options:\n * * timeoutMs: how many millis to wait before assuming code failed. If not specified, `device.evalTimeoutMs` is used as a default.\n * * assumeExlusive: assume device is not producing any other output than for our evaluation\n *\n * A random string is created to pair eval requests and responses. `code` will be run on the device, with the result\n * wrapped in JSON, and in turn wrapped in a object that is sent back.\n *\n * The actual code that gets sent to the device is then:\n * `\\x10${evalReplyPrefix}(JSON.stringify({reply:\"${id}\", result:JSON.stringify(${code})}))\\n`\n *\n * For example, it might end up being:\n * `\\x10Bluetooth.println(JSON.stringify({reply: \"a35gP\", result: \"{ 'x': '10' }\" }))\\n`\n *\n * @param code Code to evaluation\n * @param opts Options for evaluation\n * @param device Device to execute on\n * @param evalReplyPrefix How to send code back (eg `Bluetooth.println`, `console.log`)\n * @param debug If true, the full evaled code is printed locally to the console\n * @param warn Callback to display warnings\n * @returns\n */\nexport const deviceEval = async (\n  code: string,\n  opts: EvalOpts = {},\n  device: EspruinoDevice,\n  evalReplyPrefix: string,\n  debug: boolean,\n  warn: (m: string) => void\n): Promise<string> => {\n  const timeoutMs = opts.timeoutMs ?? device.evalTimeoutMs;\n  const assumeExclusive = opts.assumeExclusive ?? true;\n\n  if (typeof code !== `string`) {\n    throw new TypeError(`code parameter should be a string`);\n  }\n\n  return new Promise((resolve, reject) => {\n    // Generate a random id so reply can be matched up with this request\n    const id = randomString(5);\n\n    const onData = (d: IoDataEvent) => {\n      try {\n        //eslint-disable-next-line functional/no-let\n        let cleaned = d.data;\n\n        // Prefixed with angled bracket sometimes?\n        if (cleaned.startsWith(`>{`) && cleaned.endsWith(`}`)) {\n          cleaned = cleaned.slice(1);\n        }\n\n        // Parse reply, expecting JSON.\n        const dd = JSON.parse(cleaned);\n\n        // Check for reply field, and that it matches\n        if (`reply` in dd) {\n          if (dd.reply === id) {\n            done(); // Stop waiting for result\n            if (`result` in dd) {\n              resolve(dd.result);\n            }\n          } else {\n            warn(`Expected reply ${ id }, got ${ dd.reply }`);\n          }\n        } else {\n          warn(`Expected packet, missing 'reply' field. Got: ${ d.data }`);\n        }\n      } catch (error: unknown) {\n        // If there was a syntax error, response won't be JSON\n        if (assumeExclusive) {\n          // Fail with unexpected reply as the message\n          done(d.data);\n        } else {\n          // Unexpected reply, but we cannot be sure if it's in response to eval or\n          // some other code running on board. So just warn and eventually timeout\n          warn(error as string);\n        }\n      }\n    };\n\n    const onStateChange = (event: StateChangeEvent<GenericStateTransitions>) => {\n      if (event.newState !== `connected`) {\n        done(`State changed to '${ event.newState }', aborting`);\n      }\n    };\n\n    device.addEventListener(`data`, onData);\n    device.addEventListener(`change`, onStateChange);\n\n    // Init waitFor\n    const done = waitFor(\n      timeoutMs,\n      (reason: string) => {\n        reject(reason);\n      },\n      () => {\n        // If we got a response or there was a timeout, remove event listeners\n        device.removeEventListener(`data`, onData);\n        device.removeEventListener(`change`, onStateChange);\n      }\n    );\n\n    const source = `\\u0010${ evalReplyPrefix }(JSON.stringify({reply:\"${ id }\", result:JSON.stringify(${ code })}))\\n`;\n    if (debug) warn(source);\n    device.write(source);\n  });\n};\n\nexport { type EspruinoSerialDeviceOpts, EspruinoSerialDevice } from './EspruinoSerialDevice.js';\nexport { EspruinoBleDevice } from './EspruinoBleDevice.js';","import { type EvalOpts, type Options, deviceEval } from './Espruino.js';\nimport { NordicBleDevice } from './NordicBleDevice.js';\n\n/**\n * An Espruino BLE-connection\n *\n * See [online demos](https://clinth.github.io/ixfx-demos/io/)\n *\n * Use the `puck` function to initialise and connect to a Puck.js.\n * It must be called in a UI event handler for browser security reasons.\n *\n * ```js\n * import { Espruino } from 'https://unpkg.com/ixfx/dist/io.js'\n * const e = await Espruino.puck();\n * ```\n *\n * To connect to a particular device:\n *\n * ```js\n * import { Espruino } from 'https://unpkg.com/ixfx/dist/io.js'\n * const e = await Espruino.puck({name:`Puck.js a123`});\n * ```\n *\n * Listen for events:\n * ```js\n * // Received something\n * e.addEventListener(`data`, d => console.log(d.data));\n * // Monitor connection state\n * e.addEventListener(`change`, c => console.log(`${d.priorState} -> ${d.newState}`));\n * ```\n *\n * Write to the device (note the \\n for a new line at the end of the string). This will\n * execute the code on the Espruino.\n *\n * ```js\n * e.write(`digitalPulse(LED1,1,[10,500,10,500,10]);\\n`);\n * ```\n *\n * Run some code and return result:\n * ```js\n * const result = await e.eval(`2+2\\n`);\n * ```\n */\nexport class EspruinoBleDevice extends NordicBleDevice {\n  evalTimeoutMs: number;\n  evalReplyBluetooth = true;\n\n  /**\n   * Creates instance. You probably would rather use {@link puck} to create.\n   * @param device\n   * @param opts\n   */\n  constructor(device: BluetoothDevice, opts: Options = {}) {\n    super(device, opts);\n    this.evalTimeoutMs = opts.evalTimeoutMs ?? 5 * 1000;\n  }\n\n  /**\n   * Writes a script to Espruino.\n   *\n   * It will first send a CTRL+C to cancel any previous input, `reset()` to clear the board,\n   * and then the provided `code` followed by a new line.\n   *\n   * Use {@link eval} instead to execute remote code and get the result back.\n   *\n   * ```js\n   * // Eg from https://www.espruino.com/Web+Bluetooth\n   * writeScript(`\n   *  setInterval(() => Bluetooth.println(E.getTemperature()), 1000);\n   *  NRF.on('disconnect',()=>reset());\n   * `);\n   * ```\n   *\n   * @param code Code to send. A new line is added automatically.\n   */\n  // eslint-disable-next-line @typescript-eslint/require-await\n  async writeScript(code: string) {\n    this.write(`\\u0003\\u0010reset();\\n`);\n    this.write(`\\u0010${ code }\\n`);\n  }\n\n  /**\n   * Sends some code to be executed on the Espruino. The result\n   * is packaged into JSON and sent back to your code. An exception is\n   * thrown if code can't be executed for some reason.\n   *\n   * ```js\n   * const sum = await e.eval(`2+2`);\n   * ```\n   *\n   * It will wait for a period of time for a well-formed response from the\n   * Espruino. This might not happen if there is a connection problem\n   * or a syntax error in the code being evaled. In cases like the latter,\n   * it will take up to `timeoutMs` (default 5 seconds) before we give up\n   * waiting for a correct response and throw an error.\n   *\n   * Tweaking of the timeout may be required if `eval()` is giving up too quickly\n   * or too slowly. A default timeout can be given when creating the class.\n   *\n   * Options:\n   *  timeoutMs: Timeout for execution. 5 seconds by default\n   *  assumeExclusive If true, eval assumes all replies from controller are in response to eval. True by default\n   *  debug: If true, execution is traced via `warn` callback\n   * @param code Code to run on the Espruino.\n   * @param opts Options\n   * @param warn Function to pass warning/trace messages to. If undefined, this.warn is used, printing to console.\n   */\n  async eval(\n    code: string,\n    opts: EvalOpts = {},\n    warn?: (message: string) => void\n  ): Promise<string> {\n    const debug = opts.debug ?? false;\n    const warnCallback = warn ?? ((m) => { this.warn(m); });\n    return deviceEval(code, opts, this, `Bluetooth.println`, debug, warnCallback);\n  }\n  /*\n    const timeoutMs = opts.timeoutMs ?? this.evalTimeoutMs;\n    const assumeExclusive = opts.assumeExclusive ?? true;\n\n    if (typeof code !== `string`) throw new Error(`code parameter should be a string`);\n      \n    return new Promise((resolve, reject) => {\n      // Generate a random id so reply can be matched up with this request\n      const id = randomString(5);\n\n      const onData = (d:DataEvent) => {\n        try {\n          // Parse reply, expecting JSON.\n          const dd = JSON.parse(d.data);\n\n          // Check for reply field, and that it matches\n          if (`reply` in dd) {\n            if (dd.reply === id) {\n              done(); // Stop waiting for result\n              if (`result` in dd) {\n                resolve(dd.result);\n              }\n            } else {\n              this.warn(`Expected reply ${id}, got ${dd.reply}`);\n            }\n          }\n        } catch (ex:unknown) {\n          // If there was a syntax error, response won't be JSON\n          if (assumeExclusive) {\n            // Fail with unexpected reply as the message\n            done(d.data);\n          } else {\n            // Unexpected reply, but we cannot be sure if it's in response to eval or\n            // some other code running on board. So just warn and eventually timeout\n            this.warn(ex);\n          }\n        }\n      };\n\n      const onStateChange = (e:StateChangeEvent) => {\n        if (e.newState !== `connected`) done(`State changed to '${e.newState}', aborting`);\n      };\n\n      this.addEventListener(`data`, onData);\n      this.addEventListener(`change`, onStateChange);\n\n      // Init waitFor\n      const done = waitFor(timeoutMs, (reason:string) => {\n        reject(reason);\n      }, () => {\n        // If we got a response or there was a timeout, remove event listeners\n        this.removeEventListener(`data`, onData);\n        this.removeEventListener(`change`, onStateChange);\n      });\n\n      this.write(`\\x10Bluetooth.println(JSON.stringify({reply:\"${id}\", result:JSON.stringify(${code})}))\\n`);\n    });\n  */\n}\n","/**\n * Helper function for calling code that should fail after a timeout.\n * In short, it allows you to signal when the function succeeded, to cancel it, or\n * to be notified if it was canceled or completes.\n *\n * @example Verbose example\n * ```js\n * // This function is called by `waitFor` if it was cancelled\n * const onAborted = (reason:string) => {\n *  // 'reason' is a string describing why it has aborted.\n *  // ie: due to timeout or because done() was called with an error\n * };\n *\n * // This function is called by `waitFor` if it completed\n * const onComplete = (success:boolean) => {\n *  // Called if we were aborted or finished succesfully.\n *  // onComplete will be called after onAborted, if it was an error case\n * }\n *\n * // If done() is not called after 1000, onAborted will be called\n * // if done() is called or there was a timeout, onComplete is called\n * const done = waitFor(1000, onAborted, onComplete);\n *\n * // Signal completed successfully (thus calling onComplete(true))\n * done();\n *\n * // Signal there was an error (thus calling onAborted and onComplete(false))\n * done(`Some error`);\n * ```\n *\n * The completion handler is useful for removing event handlers.\n *\n * @example Compact example\n * ```js\n * const done = waitFor(1000,\n *  (reason) => {\n *    console.log(`Aborted: ${reason}`);\n *  },\n *  (success) => {\n *    console.log(`Completed. Success: ${success ?? `Yes!` : `No`}`)\n *  });\n *\n * try {\n *  runSomethingThatMightScrewUp();\n *  done(); // Signal it succeeded\n * } catch (e) {\n *  done(e); // Signal there was an error\n * }\n * ```\n * @param timeoutMs\n * @param onAborted\n * @param onComplete\n * @returns\n */\nexport const waitFor = (\n  timeoutMs: number,\n  onAborted: (reason: string) => void,\n  onComplete?: (success: boolean) => void\n) => {\n  //eslint-disable-next-line functional/no-let\n  let success = false;\n  const done = (error?: string) => {\n    if (t !== 0) {\n      window.clearTimeout(t);\n      t = 0;\n    }\n    if (error) {\n      onAborted(error);\n    } else {\n      success = true;\n    }\n    if (onComplete !== undefined) onComplete(success);\n  };\n\n  //eslint-disable-next-line functional/no-let\n  let t = window.setTimeout(() => {\n    t = 0;\n    try {\n      onAborted(`Timeout after ${timeoutMs}ms`);\n    } finally {\n      if (onComplete !== undefined) onComplete(success);\n    }\n  }, timeoutMs);\n\n  return done;\n};\n","import {\n  type JsonDeviceOpts,\n  type JsonDeviceEvents,\n  type JsonDataEvent,\n  JsonDevice,\n} from './JsonDevice.js';\n\nexport type { JsonDeviceEvents, JsonDeviceOpts, JsonDataEvent };\n\nexport type SerialOpts = JsonDeviceOpts & {\n  readonly filters?: ReadonlyArray<SerialPortFilter>;\n  readonly baudRate?: number;\n  /**\n   * End-of-line string sequence. \\r\\n by default.\n   */\n  readonly eol?: string;\n};\n\n/**\n * Serial device. Assumes data is sent with new line characters (\\r\\n) between messages.\n *\n * ```\n * const s = new Device();\n * s.addEventListener(`change`, evt => {\n *  console.log(`State change ${evt.priorState} -> ${evt.newState}`);\n *  if (evt.newState === `connected`) {\n *    // Do something when connected...\n *  }\n * });\n *\n * // In a UI event handler...\n * s.connect();\n * ```\n *\n * Reading incoming data:\n * ```\n * // Parse incoming data as JSON\n * s.addEventListener(`data`, evt => {\n *  try {\n *    const o = JSON.parse(evt.data);\n *    // If we get this far, JSON is legit\n *  } catch (ex) {\n *  }\n * });\n * ```\n *\n * Writing to the microcontroller\n * ```\n * s.write(JSON.stringify({msg:\"hello\"}));\n * ```\n */\nexport class Device extends JsonDevice {\n  port: SerialPort | undefined;\n  tx: WritableStreamDefaultWriter<string> | undefined;\n  abort: AbortController;\n  baudRate: number;\n\n  constructor(private config: SerialOpts = {}) {\n    super(config);\n\n    this.abort = new AbortController();\n\n    const eol = config.eol ?? `\\r\\n`;\n\n    this.baudRate = config.baudRate ?? 9600;\n    if (config.name === undefined) super.name = `Serial.Device`;\n\n    // Serial.println on microcontroller == \\r\\n\n    this.rxBuffer.separator = eol;\n  }\n\n  /**\n   * Writes text collected in buffer\n   * @param txt\n   */\n  protected async writeInternal(txt: string) {\n    if (this.tx === undefined) throw new Error(`tx not ready`);\n    try {\n      this.tx.write(txt);\n    } catch (ex: unknown) {\n      this.warn(ex);\n    }\n  }\n\n  onClosed(): void {\n    this.tx?.releaseLock();\n\n    this.abort.abort(`closing port`);\n    // try {\n    //   this.port?.close();\n    // } catch (ex) {\n    //   this.warn(ex);\n    // }\n    this.states.state = `closed`;\n  }\n\n  onPreConnect(): Promise<void> {\n    return Promise.resolve();\n  }\n\n  async onConnectAttempt(): Promise<void> {\n    //eslint-disable-next-line functional/no-let\n    let reqOpts: SerialPortRequestOptions = {};\n    const openOpts: SerialOptions = {\n      baudRate: this.baudRate,\n    };\n\n    if (this.config.filters) reqOpts = { filters: [...this.config.filters] };\n    this.port = await navigator.serial.requestPort(reqOpts);\n\n    this.port.addEventListener(`disconnect`, (_) => {\n      this.close();\n    });\n\n    await this.port.open(openOpts);\n\n    const txW = this.port.writable;\n    const txText = new TextEncoderStream();\n    if (txW !== null) {\n      txText.readable\n        .pipeTo(txW, { signal: this.abort.signal })\n        .catch((err) => {\n          console.log(`Serial.onConnectAttempt txText pipe:`);\n          console.log(err);\n        });\n      this.tx = txText.writable.getWriter();\n    }\n\n    const rxR = this.port.readable;\n    const rxText = new TextDecoderStream();\n    if (rxR !== null) {\n      rxR\n        .pipeTo(rxText.writable, { signal: this.abort.signal })\n        .catch((err) => {\n          console.log(`Serial.onConnectAttempt rxR pipe:`);\n          console.log(err);\n        });\n      rxText.readable\n        .pipeTo(this.rxBuffer.writable(), { signal: this.abort.signal })\n        .catch((err) => {\n          console.log(`Serial.onConnectAttempt rxText pipe:`);\n          console.log(err);\n          try {\n            this.port?.close();\n          } catch (ex) {\n            console.log(ex);\n          }\n        });\n    }\n  }\n}\n","import { SimpleEventEmitter } from '../Events.js';\nimport * as StateMachine from '../flow/StateMachine.js';\nimport { type StateChangeEvent } from '../flow/StateMachineWithEvents.js';\nimport { indexOfCharCode, omitChars } from '../Text.js';\nimport { Codec } from './Codec.js';\nimport { StringReceiveBuffer } from './StringReceiveBuffer.js';\nimport { StringWriteBuffer } from './StringWriteBuffer.js';\nimport { retry } from '../flow/Retry.js';\nimport {\n  genericStateTransitionsInstance,\n  type GenericStateTransitions,\n} from './index.js';\n\n/**\n * Options for JsonDevice\n */\nexport type JsonDeviceOpts = {\n  /**\n   * How much data to transfer at a time\n   */\n  readonly chunkSize?: number;\n  /**\n   * Name of device. This is only used for assisting the console.log output\n   */\n  readonly name?: string;\n  /**\n   * Number of times to automatically try to reconnect\n   */\n  readonly connectAttempts?: number;\n  /**\n   * If true, additional logging will be done\n   */\n  readonly debug?: boolean;\n};\n\n/**\n * Data received event\n */\nexport type JsonDataEvent = {\n  /**\n   * Data received\n   */\n  readonly data: string;\n};\n\n/**\n * Events emitted by JsonDevice\n */\nexport type JsonDeviceEvents = {\n  /**\n   * Data received\n   */\n  readonly data: JsonDataEvent;\n  /**\n   * State changed\n   */\n  readonly change: StateChangeEvent<GenericStateTransitions>;\n};\n\nexport abstract class JsonDevice extends SimpleEventEmitter<JsonDeviceEvents> {\n  states: StateMachine.WithEvents<GenericStateTransitions>;\n  codec: Codec;\n\n  verboseLogging = false;\n  name: string;\n  connectAttempts: number;\n  chunkSize: number;\n\n  rxBuffer: StringReceiveBuffer;\n  txBuffer: StringWriteBuffer;\n\n  constructor(config: JsonDeviceOpts = {}) {\n    super();\n\n    // Init\n    this.verboseLogging = config.debug ?? false;\n    this.chunkSize = config.chunkSize ?? 1024;\n    this.connectAttempts = config.connectAttempts ?? 3;\n    this.name = config.name ?? `JsonDevice`;\n\n    // Transmit buffer\n    this.txBuffer = new StringWriteBuffer(async (data) => {\n      // When we have data to actually write to device\n      await this.writeInternal(data);\n    }, config);\n\n    // Receive buffer\n    this.rxBuffer = new StringReceiveBuffer((line) => {\n      this.fireEvent(`data`, { data: line });\n    });\n\n    this.codec = new Codec();\n    this.states = new StateMachine.WithEvents(genericStateTransitionsInstance, {\n      initial: `ready`,\n    });\n\n    this.states.addEventListener(`change`, (evt) => {\n      this.fireEvent(`change`, evt);\n      this.verbose(`${evt.priorState} -> ${evt.newState}`);\n      if (evt.priorState === `connected`) {\n        // Clear out buffers\n        this.rxBuffer.clear();\n        this.txBuffer.clear();\n      }\n    });\n  }\n\n  get isConnected(): boolean {\n    return this.states.state === `connected`;\n  }\n\n  get isClosed(): boolean {\n    return this.states.state === `closed`;\n  }\n\n  write(txt: string) {\n    if (this.states.state !== `connected`) {\n      throw new Error(`Cannot write while state is ${this.states.state}`);\n    }\n    this.txBuffer.add(txt);\n  }\n\n  /**\n   * Writes text to output device\n   * @param txt\n   */\n  protected abstract writeInternal(txt: string): void;\n\n  async close() {\n    if (this.states.state !== `connected`) return;\n\n    // console.log(`rxBuffer closing`);\n    // try {\n    //   await this.rxBuffer.close();\n    // } catch (e) {\n    //   console.warn(e);\n    // }\n\n    // console.log(`txBuffer closing`);\n    // try {\n    //   await this.txBuffer.close();\n    // } catch (e) {\n    //   console.warn(e);\n    // }\n\n    // console.log(`calling onClose`);\n\n    this.onClosed();\n  }\n\n  /**\n   * Must change state\n   */\n  abstract onClosed(): void;\n\n  abstract onPreConnect(): Promise<void>;\n\n  async connect() {\n    const attempts = this.connectAttempts;\n\n    this.states.state = `connecting`;\n    await this.onPreConnect();\n\n    await retry(\n      async () => {\n        await this.onConnectAttempt();\n        this.states.state = `connected`;\n        return true;\n      },\n      {\n        count: attempts,\n        startMs: 200,\n      }\n    );\n  }\n\n  /**\n   * Should throw if did not succeed.\n   */\n  protected abstract onConnectAttempt(): Promise<void>;\n\n  private onRx(evt: Event) {\n    //const rx = this.rx;\n    //if (rx === undefined) return;\n\n    //eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const view = (evt.target as any).value as DataView;\n    if (view === undefined) return;\n\n    //eslint-disable-next-line functional/no-let\n    let str = this.codec.fromBuffer(view.buffer);\n\n    // Check for flow control chars\n    const plzStop = indexOfCharCode(str, 19);\n    const plzStart = indexOfCharCode(str, 17);\n\n    // Remove if found\n    if (plzStart && plzStop < plzStart) {\n      this.verbose(`Tx plz start`);\n      str = omitChars(str, plzStart, 1);\n      this.txBuffer.paused = false;\n    }\n    if (plzStop && plzStop > plzStart) {\n      this.verbose(`Tx plz stop`);\n      str = omitChars(str, plzStop, 1);\n      this.txBuffer.paused = true;\n    }\n\n    this.rxBuffer.add(str);\n  }\n\n  protected verbose(m: string) {\n    if (this.verboseLogging) console.info(`${this.name} `, m);\n  }\n\n  protected log(m: string) {\n    console.log(`${this.name} `, m);\n  }\n\n  protected warn(m: unknown) {\n    console.warn(`${this.name} `, m);\n  }\n}\n","import { deviceEval, type EvalOpts } from './Espruino.js';\nimport { Device as SerialDevice, type SerialOpts } from './Serial.js';\n\nexport type EspruinoSerialDeviceOpts = SerialOpts & {\n  readonly evalTimeoutMs?: number;\n};\n\nexport class EspruinoSerialDevice extends SerialDevice {\n  evalTimeoutMs: number;\n  evalReplyBluetooth = false;\n\n  constructor(opts?: EspruinoSerialDeviceOpts) {\n    super(opts);\n\n    if (opts === undefined) opts = {};\n    this.evalTimeoutMs = opts.evalTimeoutMs ?? 5 * 1000;\n  }\n\n  async disconnect() {\n    return super.close();\n  }\n\n  /**\n   * Writes a script to Espruino.\n   *\n   * It will first send a CTRL+C to cancel any previous input, `reset()` to clear the board,\n   * and then the provided `code` followed by a new line.\n   *\n   * Use {@link eval} instead to execute remote code and get the result back.\n   *\n   * ```js\n   * // Eg from https://www.espruino.com/Web+Bluetooth\n   * writeScript(`\n   *  setInterval(() => Bluetooth.println(E.getTemperature()), 1000);\n   *  NRF.on('disconnect',()=>reset());\n   * `);\n   * ```\n   *\n   * @param code Code to send. A new line is added automatically.\n   */\n  async writeScript(code: string) {\n    this.write(`\\x03\\x10reset();\\n`);\n    this.write(`\\x10${code}\\n`);\n  }\n\n  /**\n   * Sends some code to be executed on the Espruino. The result\n   * is packaged into JSON and sent back to your code. An exception is\n   * thrown if code can't be executed for some reason.\n   *\n   * ```js\n   * const sum = await e.eval(`2+2`);\n   * ```\n   *\n   * It will wait for a period of time for a well-formed response from the\n   * Espruino. This might not happen if there is a connection problem\n   * or a syntax error in the code being evaled. In cases like the latter,\n   * it will take up to `timeoutMs` (default 5 seconds) before we give up\n   * waiting for a correct response and throw an error.\n   *\n   * Tweaking of the timeout may be required if `eval()` is giving up too quickly\n   * or too slowly. A default timeout can be given when creating the class.\n   *\n   * Options:\n   *  timeoutMs: Timeout for execution. 5 seconds by default\n   *  assumeExclusive: If true, eval assumes all replies from controller are in response to eval. True by default\n   *  debug: If true, execution is traced via `warn` callback\n   * @param code Code to run on the Espruino.\n   * @param opts Options\n   * @param warn Function to pass warning/trace messages to. If undefined, this.warn is used, printing to console.\n   */\n  async eval(\n    code: string,\n    opts: EvalOpts = {},\n    warn?: (msg: string) => void\n  ): Promise<string> {\n    const debug = opts.debug ?? false;\n    const warnCb = warn ?? ((m) => this.warn(m));\n\n    return deviceEval(code, opts, this, `USB.println`, debug, warnCb);\n  }\n}\n","import { waitFor } from '../flow/WaitFor.js';\nimport * as Rects from '../geometry/Rect.js';\n\nconst startTimeoutMs = 10000;\n\n/**\n * Print available media devices to console\n * @param filterKind Defaults `videoinput`\n */\nexport const dumpDevices = async (filterKind = `videoinput`) => {\n  const devices = await navigator.mediaDevices.enumerateDevices();\n\n  devices.forEach((d) => {\n    if (d.kind !== filterKind) return;\n    console.log(d.label);\n    console.log(` Kind: ${d.kind}`);\n    console.log(` Device id: ${d.deviceId}`);\n  });\n};\n\n/**\n * Constraints when requesting a camera source\n */\nexport type Constraints = {\n  /**\n   * Camera facing: user is front-facing, environment is a rear camera\n   */\n  readonly facingMode?: `user` | `environment`;\n  /**\n   * Maximum resolution\n   */\n  readonly max?: Rects.Rect;\n  /**\n   * Minimum resolution\n   */\n  readonly min?: Rects.Rect;\n  /**\n   * Ideal resolution\n   */\n  readonly ideal?: Rects.Rect;\n  /**\n   * If specified, will try to use this media device id\n   */\n  readonly deviceId?: string;\n\n  /**\n   * Number of milliseconds to wait on `getUserMedia` before giving up.\n   * Defaults to 30seconds\n   */\n  readonly startTimeoutMs?: number;\n};\n\n/**\n * Result from starting a camera\n */\n//eslint-disable-next-line functional/no-mixed-types\nexport type StartResult = {\n  /**\n   * Call dispose to stop the camera feed and remove any created resources,\n   * such as a VIDEO element\n   */\n  readonly dispose: () => void;\n  /**\n   * Video element camera is connected to\n   */\n  readonly videoEl: HTMLVideoElement;\n};\n\n/**\n * Attempts to start a video-only stream from a camera into a hidden\n * VIDEO element for frame capture. The VIDEO element is created automatically.\n *\n *\n * ```js\n * import {Camera} from 'https://unpkg.com/ixfx/dist/visual.js'\n * try\n *  const { videoEl, dispose } = await Camera.start();\n *  for await (const frame of frames(videoEl)) {\n *   // Do something with pixels...\n *  }\n * } catch (ex) {\n *  console.error(`Video could not be started`);\n * }\n * ```\n *\n * Be sure to call the dispose() function to stop the video stream and remov\n * the created VIDEO element.\n *\n * _Constraints_ can be specified to select a camera and resolution:\n * ```js\n * import {Camera} from 'https://unpkg.com/ixfx/dist/visual.js'\n * try\n *  const { videoEl, dispose } = await Camera.start({\n *    facingMode: `environment`,\n *    max: { width: 640, height: 480 }\n *  });\n *  for await (const frame of frames(videoEl)) {\n *   // Do something with pixels...\n *  }\n * } catch (ex) {\n *  console.error(`Video could not be started`);\n * }\n * ```\n * @param constraints\n * @returns Returns `{ videoEl, dispose }`, where `videoEl` is the created VIDEO element, and `dispose` is a function for removing the element and stopping the video.\n */\nexport const start = async (\n  constraints: Constraints = {}\n): Promise<StartResult> => {\n  const videoEl = document.createElement(`VIDEO`) as HTMLVideoElement;\n  //eslint-disable-next-line functional/immutable-data\n  videoEl.style.display = `none`;\n  //eslint-disable-next-line functional/immutable-data\n  videoEl.playsInline = true;\n  //eslint-disable-next-line functional/immutable-data\n  videoEl.muted = true;\n\n  videoEl.classList.add(`ixfx-camera`);\n\n  document.body.appendChild(videoEl);\n\n  //eslint-disable-next-line functional/no-let\n  let stopVideo = () => {\n    /* no-op */\n  };\n\n  const dispose = () => {\n    try {\n      // Stop source\n      stopVideo();\n    } catch {\n      /* no-op */\n    }\n\n    // Remove the element we created\n    videoEl.remove();\n  };\n\n  try {\n    // Attempt to start video\n    const r = await startWithVideoEl(videoEl, constraints);\n    stopVideo = r.dispose;\n    return { videoEl, dispose };\n  } catch (ex) {\n    // If it didn't work, delete the created element\n    console.error(ex);\n    dispose();\n    throw ex;\n  }\n};\n\n/**\n * Attempts to start a video-only stream from a camera into the designated VIDEO element.\n * @param videoEl\n * @param constraints\n * @returns Result contains videoEl and dispose function\n */\nconst startWithVideoEl = async (\n  videoEl: HTMLVideoElement,\n  constraints: Constraints = {}\n): Promise<StartResult> => {\n  if (videoEl === undefined) throw new Error(`videoEl undefined`);\n  if (videoEl === null) throw new Error(`videoEl null`);\n\n  const maxRes = constraints.max;\n  const minRes = constraints.min;\n  const idealRes = constraints.ideal;\n\n  // Setup constraints\n  const c = {\n    audio: false,\n    video: {\n      width: {},\n      height: {},\n    },\n  };\n\n  // Just in case some intuitive values are passed in...\n  if ((constraints as any).facingMode === `front`) {\n    constraints = { ...constraints, facingMode: `user` };\n  }\n  if ((constraints as any).facingMode === `back`) {\n    constraints = { ...constraints, facingMode: `environment` };\n  }\n\n  if (constraints.facingMode) {\n    //eslint-disable-next-line functional/immutable-data,@typescript-eslint/no-explicit-any\n    (c.video as any).facingMode = constraints.facingMode;\n  }\n\n  if (constraints.deviceId) {\n    //eslint-disable-next-line functional/immutable-data,@typescript-eslint/no-explicit-any\n    (c.video as any).deviceId = constraints.deviceId;\n  }\n\n  if (idealRes) {\n    //eslint-disable-next-line functional/immutable-data\n    c.video.width = {\n      ...c.video.width,\n      ideal: idealRes.width,\n    };\n    //eslint-disable-next-line functional/immutable-data\n    c.video.height = {\n      ...c.video.height,\n      ideal: idealRes.height,\n    };\n  }\n\n  if (maxRes) {\n    //eslint-disable-next-line functional/immutable-data\n    c.video.width = {\n      ...c.video.width,\n      max: maxRes.width,\n    };\n    //eslint-disable-next-line functional/immutable-data\n    c.video.height = {\n      ...c.video.height,\n      max: maxRes.height,\n    };\n  }\n\n  if (minRes) {\n    //eslint-disable-next-line functional/immutable-data\n    c.video.width = {\n      ...c.video.width,\n      min: minRes.width,\n    };\n    //eslint-disable-next-line functional/immutable-data\n    c.video.height = {\n      ...c.video.height,\n      min: minRes.height,\n    };\n  }\n\n  // Request stream\n  const done = waitFor(\n    constraints.startTimeoutMs ?? startTimeoutMs,\n    (reason) => {\n      throw new Error(`Camera getUserMedia failed: ${reason}`);\n    }\n  );\n\n  try {\n    const stream = await navigator.mediaDevices.getUserMedia(c);\n\n    // Clean-up function\n    const dispose = () => {\n      videoEl.pause();\n      const t = stream.getTracks();\n      t.forEach((track) => track.stop());\n    };\n\n    // Assign to VIDEO element\n    //eslint-disable-next-line functional/immutable-data\n    videoEl.srcObject = stream;\n    done();\n\n    const ret = { videoEl, dispose };\n    const p = new Promise<StartResult>((resolve, reject) => {\n      videoEl.addEventListener(`loadedmetadata`, () => {\n        videoEl\n          .play()\n          .then(() => {\n            resolve(ret);\n          })\n          .catch((ex) => {\n            reject(ex);\n          });\n      });\n    });\n    return p;\n  } catch (ex) {\n    //eslint-disable-next-line @typescript-eslint/no-explicit-any\n    done((ex as any).toString());\n    throw ex;\n  }\n};\n","import { Points, Lines } from './index.js';\nimport { type RandomSource, defaultRandom } from '../Random.js';\nimport { type CirclePositioned, isCirclePositioned } from './Circle.js';\nimport * as Intersects from './Intersects.js';\nimport type { CardinalDirection } from './Grid.js';\nimport type { PointCalculableShape } from './Point.js';\n\nexport type Rect = {\n  readonly width: number;\n  readonly height: number;\n};\nexport type RectPositioned = Points.Point & Rect;\n\nexport const empty = Object.freeze({ width: 0, height: 0 });\nexport const emptyPositioned = Object.freeze({\n  x: 0,\n  y: 0,\n  width: 0,\n  height: 0,\n});\n\nexport const placeholder = Object.freeze({\n  width: Number.NaN,\n  height: Number.NaN,\n});\nexport const placeholderPositioned = Object.freeze({\n  x: Number.NaN,\n  y: Number.NaN,\n  width: Number.NaN,\n  height: Number.NaN,\n});\n\nexport const isEmpty = (rect: Rect): boolean =>\n  rect.width === 0 && rect.height === 0;\nexport const isPlaceholder = (rect: Rect): boolean =>\n  Number.isNaN(rect.width) && Number.isNaN(rect.height);\n\n/**\n * Returns _true_ if `p` has a position (x,y)\n * @param p Point, Rect or RectPositiond\n * @returns\n */\nexport const isPositioned = (\n  p: Points.Point | Rect | RectPositioned\n): p is Points.Point =>\n  (p as Points.Point).x !== undefined && (p as Points.Point).y !== undefined;\n\n/**\n * Returns _true_ if `p` has width and height.\n * @param p\n * @returns\n */\nexport const isRect = (p: unknown): p is Rect => {\n  if (p === undefined) return false;\n  if ((p as Rect).width === undefined) return false;\n  if ((p as Rect).height === undefined) return false;\n  return true;\n};\n\n/**\n * Returns _true_ if `p` is a positioned rectangle\n * Having width, height, x and y properties.\n * @param p\n * @returns\n */\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const isRectPositioned = (\n  p: Rect | RectPositioned | PointCalculableShape\n): p is RectPositioned => isRect(p) && isPositioned(p);\n\n/**\n * Initialise a rectangle based on the width and height of a HTML element.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\"\n * Rects.fromElement(document.querySelector(`body`));\n * ```\n * @param el\n * @returns\n */\nexport const fromElement = (el: HTMLElement): Rect => ({\n  width: el.clientWidth,\n  height: el.clientHeight,\n});\n\n/**\n * Returns _true_ if the width & height of the two rectangles is the same.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rectA = { width: 10, height: 10, x: 10, y: 10 };\n * const rectB = { width: 10, height: 10, x: 20, y: 20 };\n *\n * // True, even though x,y are different\n * Rects.isEqualSize(rectA, rectB);\n *\n * // False, because coordinates are different\n * Rects.isEqual(rectA, rectB)\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const isEqualSize = (a: Rect, b: Rect): boolean => {\n  if (a === undefined) throw new Error(`a undefined`);\n  if (b === undefined) throw new Error(`b undefined`);\n  return a.width === b.width && a.height === b.height;\n};\n\n/**\n * Returns a rectangle from width, height\n * ```js\n * const r = Rects.fromNumbers(100, 200);\n * // {width: 100, height: 200}\n * ```\n *\n * Use {@link toArray} for the opposite conversion.\n *\n * @param width\n * @param height\n */\nexport function fromNumbers(width: number, height: number): Rect;\n\n/**\n * Returns a rectangle from x,y,width,height\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const r = Rects.fromNumbers(10, 20, 100, 200);\n * // {x: 10, y: 20, width: 100, height: 200}\n * ```\n *\n * Use the spread operator (...) if the source is an array:\n * ```js\n * const r3 = Rects.fromNumbers(...[10, 20, 100, 200]);\n * ```\n *\n * Use {@link toArray} for the opposite conversion.\n *\n * @param x\n * @param y\n * @param width\n * @param height\n */\nexport function fromNumbers(\n  x: number,\n  y: number,\n  width: number,\n  height: number\n): RectPositioned;\n\n/**\n * Returns a rectangle from a series of numbers: x, y, width, height OR width, height\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const r1 = Rects.fromNumbers(100, 200);\n * // {width: 100, height: 200}\n *\n * const r2 = Rects.fromNumbers(10, 20, 100, 200);\n * // {x: 10, y: 20, width: 100, height: 200}\n * ```\n * Use the spread operator (...) if the source is an array:\n *\n * ```js\n * const r3 = Rects.fromNumbers(...[10, 20, 100, 200]);\n * ```\n *\n * Use {@link toArray} for the opposite conversion.\n *\n * @see toArray\n * @param xOrWidth\n * @param yOrHeight\n * @param width\n * @param height\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function fromNumbers(\n  xOrWidth: number,\n  yOrHeight: number,\n  width?: number,\n  height?: number\n): Rect | RectPositioned {\n  if (width === undefined || height === undefined) {\n    if (typeof xOrWidth !== `number`) throw new Error(`width is not an number`);\n    if (typeof yOrHeight !== `number`) {\n      throw new TypeError(`height is not an number`);\n    }\n    return Object.freeze({ width: xOrWidth, height: yOrHeight });\n  }\n  if (typeof xOrWidth !== `number`) throw new Error(`x is not an number`);\n  if (typeof yOrHeight !== `number`) throw new Error(`y is not an number`);\n  if (typeof width !== `number`) throw new Error(`width is not an number`);\n  if (typeof height !== `number`) throw new Error(`height is not an number`);\n\n  return Object.freeze({ x: xOrWidth, y: yOrHeight, width, height });\n}\n\n/**\n * Rectangle as array: `[width, height]`\n */\nexport type RectArray = readonly [ width: number, height: number ];\n\n/**\n * Positioned rectangle as array: `[x, y, width, height]`\n */\nexport type RectPositionedArray = readonly [\n  x: number,\n  y: number,\n  width: number,\n  height: number\n];\n\n/**\n * Converts a rectangle to an array of numbers. See {@link fromNumbers} for the opposite conversion.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * const r1 = Rects.toArray({ x: 10, y:20, width: 100, height: 200 });\n * // [10, 20, 100, 200]\n * const r2 = Rects.toArray({ width: 100, height: 200 });\n * // [100, 200]\n * ```\n * @param rect\n * @see fromNumbers\n */\nexport function toArray(rect: Rect): RectArray;\n\n/**\n * Converts a rectangle to an array of numbers. See {@link fromNumbers} for the opposite conversion.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * const r1 = Rects.toArray({ x: 10, y:20, width: 100, height: 200 });\n * // [10, 20, 100, 200]\n * const r2 = Rects.toArray({ width: 100, height: 200 });\n * // [100, 200]\n * ```\n * @param rect\n * @see fromNumbers\n */\nexport function toArray(rect: RectPositioned): RectPositionedArray;\n\n/**\n * Converts a rectangle to an array of numbers. See {@link fromNumbers} for the opposite conversion.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const r1 = Rects.toArray({ x: 10, y:20, width: 100, height: 200 });\n * // [10, 20, 100, 200]\n * const r2 = Rects.toArray({ width: 100, height: 200 });\n * // [100, 200]\n * ```\n * @param rect\n * @see fromNumbers\n */\n// eslint-disable-next-line func-style\nexport function toArray(\n  rect: Rect | RectPositioned\n): RectArray | RectPositionedArray {\n  if (isPositioned(rect)) {\n    return [ rect.x, rect.y, rect.width, rect.height ];\n  } else if (isRect(rect)) {\n    return [ rect.width, rect.height ];\n  } else {\n    throw new Error(\n      `rect param is not a rectangle. Got: ${ JSON.stringify(rect) }`\n    );\n  }\n}\n\n/**\n * Returns _true_ if two rectangles have identical values.\n * Both rectangles must be positioned or not.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rectA = { width: 10, height: 10, x: 10, y: 10 };\n * const rectB = { width: 10, height: 10, x: 20, y: 20 };\n *\n * // False, because coordinates are different\n * Rects.isEqual(rectA, rectB)\n *\n * // True, even though x,y are different\n * Rects.isEqualSize(rectA, rectB);\n * ```\n * @param a\n * @param b\n * @returns\n */\nexport const isEqual = (\n  a: Rect | RectPositioned,\n  b: Rect | RectPositioned\n): boolean => {\n  if (isPositioned(a) && isPositioned(b)) {\n    if (!Points.isEqual(a, b)) return false;\n    return a.width === b.width && a.height === b.height;\n  } else if (!isPositioned(a) && !isPositioned(b)) {\n    return a.width === b.width && a.height === b.height;\n  } else {\n    // One param is positioned, the other is not\n    return false;\n  }\n};\n\n/**\n * Subtracts width/height of `b` from `a` (ie: a - b), returning result.\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rectA = { width: 100, height: 100 };\n * const rectB = { width: 200, height: 200 };\n *\n * // Yields: { width: -100, height: -100 }\n * Rects.subtract(rectA, rectB);\n * ```\n * @param a\n * @param b\n */\nexport function subtract(a: Rect, b: Rect): Rect;\n/**\n * Subtracts a width/height from `a`, returning result.\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100 };\n *\n * // Yields: { width: -100, height: -100 }\n * Rects.subtract(rect, 200, 200);\n * ```\n * @param a\n * @param width\n * @param height\n */\nexport function subtract(a: Rect, width: number, height?: number): Rect;\n\n/**\n * Subtracts width/height from `a`.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rectA = { width: 100, height: 100 };\n * const rectB = { width: 200, height: 200 };\n *\n * // Yields: { width: -100, height: -100 }\n * Rects.subtract(rectA, rectB);\n * Rects.subtract(rectA, 200, 200);\n * ```\n * @param a\n * @param b\n * @param c\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function subtract(a: Rect | undefined, b: Rect | number, c?: number): Rect {\n  if (a === undefined) throw new Error(`First parameter undefined`);\n  if (typeof b === `number`) {\n    const height = c ?? 0;\n    return Object.freeze({\n      ...a,\n      width: a.width - b,\n      height: a.height - height,\n    });\n  } else {\n    return Object.freeze({\n      ...a,\n      width: a.width - b.width,\n      height: a.height - b.height,\n    });\n  }\n}\n\n/**\n * Sums width/height of `b` with `a` (ie: a + b), returning result.\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rectA = { width: 100, height: 100 };\n * const rectB = { width: 200, height: 200 };\n *\n * // Yields: { width: 300, height: 300 }\n * Rects.sum(rectA, rectB);\n * ```\n * @param a\n * @param b\n */\nexport function sum(a: Rect, b: Rect): Rect;\n/**\n * Sums width/height of `b` with `a` (ie: a + b), returning result.\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100 };\n *\n * // Yields: { width: 300, height: 300 }\n * Rects.subtract(rect, 200, 200);\n * ```\n * @param a\n * @param width\n * @param height\n */\nexport function sum(a: Rect, width: number, height?: number): Rect;\n\n/**\n * Sums width/height of `b` with `a` (ie: a + b), returning result.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rectA = { width: 100, height: 100 };\n * const rectB = { width: 200, height: 200 };\n *\n * // Yields: { width: 300, height: 300 }\n * Rects.sum(rectA, rectB);\n * Rects.sum(rectA, 200, 200);\n * ```\n * @param a\n * @param b\n * @param c\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function sum(a: Rect, b: Rect | number, c?: number): Rect {\n  if (a === undefined) throw new Error(`First parameter undefined`);\n  if (typeof b === `number`) {\n    const height = c ?? 0;\n    return Object.freeze({\n      ...a,\n      width: a.width + b,\n      height: a.height + height,\n    });\n  } else {\n    return Object.freeze({\n      ...a,\n      width: a.width + b.width,\n      height: a.height + b.height,\n    });\n  }\n}\n\n/**\n * Returns _true_ if `point` is within, or on boundary of `rect`.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * Rects.intersectsPoint(rect, { x: 100, y: 100});\n * ```\n * @param rect\n * @param point\n */\nexport function intersectsPoint(\n  rect: Rect | RectPositioned,\n  point: Points.Point\n): boolean;\n\n/**\n * Returns true if x,y coordinate is within, or on boundary of `rect`.\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * Rects.intersectsPoint(rect, 100, 100);\n * ```\n * @param rect\n * @param x\n * @param y\n */\nexport function intersectsPoint(\n  rect: Rect | RectPositioned,\n  x: number,\n  y: number\n): boolean;\n\n/**\n * Returns true if point is within or on boundary of `rect`.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * Rects.intersectsPoint(rect, { x: 100, y: 100});\n * Rects.intersectsPoint(rect, 100, 100);\n * ```\n * @param rect\n * @param a\n * @param b\n * @returns\n */\n//eslint-disable-next-line func-style\nexport function intersectsPoint(\n  rect: Rect | RectPositioned,\n  a: Points.Point | number,\n  b?: number\n): boolean {\n  guard(rect, `rect`);\n  //eslint-disable-next-line functional/no-let\n  let x = 0;\n  //eslint-disable-next-line functional/no-let\n  let y = 0;\n  if (typeof a === `number`) {\n    if (b === undefined) throw new Error(`x and y coordinate needed`);\n    x = a;\n    y = b;\n  } else {\n    x = a.x;\n    y = a.y;\n  }\n  if (isPositioned(rect)) {\n    if (x - rect.x > rect.width || x < rect.x) return false;\n    if (y - rect.y > rect.height || y < rect.y) return false;\n  } else {\n    // Assume 0,0\n    if (x > rect.width || x < 0) return false;\n    if (y > rect.height || y < 0) return false;\n  }\n  return true;\n}\n\n/**\n * Initialises a rectangle based on its center, a width and height\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * // Rectangle with center at 50,50, width 100 height 200\n * Rects.fromCenter({x: 50, y:50}, 100, 200);\n * ```\n * @param origin\n * @param width\n * @param height\n * @returns\n */\nexport const fromCenter = (\n  origin: Points.Point,\n  width: number,\n  height: number\n): RectPositioned => {\n  Points.guard(origin, `origin`);\n\n  guardDim(width, `width`);\n  guardDim(height, `height`);\n\n  const halfW = width / 2;\n  const halfH = height / 2;\n  return {\n    x: origin.x - halfW,\n    y: origin.y - halfH,\n    width: width,\n    height: height,\n  };\n};\n\n/**\n * Returns the distance from the perimeter of `rect` to `pt`.\n * If the point is within the rectangle, 0 is returned.\n *\n * If `rect` does not have an x,y it's assumed to be 0,0\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100, x: 0, y: 0 };\n * Rects.distanceFromExterior(rect, { x: 20, y: 20 });\n * ```\n * @param rect Rectangle\n * @param pt Point\n * @returns Distance\n */\nexport const distanceFromExterior = (\n  rect: RectPositioned,\n  pt: Points.Point\n): number => {\n  guardPositioned(rect, `rect`);\n  Points.guard(pt, `pt`);\n  if (intersectsPoint(rect, pt)) return 0;\n  const dx = Math.max(rect.x - pt.x, 0, pt.x - rect.x + rect.width);\n  const dy = Math.max(rect.y - pt.y, 0, pt.y - rect.y + rect.height);\n  return Math.hypot(dx, dy);\n};\n\n/**\n * Return the distance of `pt` to the center of `rect`.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100, x: 0, y: 0 };\n * Rects.distanceFromCenter(rect, { x: 20, y: 20 });\n * ```\n * @param rect\n * @param pt\n * @returns\n */\nexport const distanceFromCenter = (\n  rect: RectPositioned,\n  pt: Points.Point\n): number => Points.distance(center(rect), pt);\n\n/**\n * Returns a rectangle based on provided four corners.\n *\n * To create a rectangle that contains an arbitary set of points, use {@link Geometry.Points.bbox | Geometry.Points.bbox}.\n *\n * Does some sanity checking such as:\n *  - x will be smallest of topLeft/bottomLeft\n *  - y will be smallest of topRight/topLeft\n *  - width will be largest between top/bottom left and right\n *  - height will be largest between left and right top/bottom\n *\n */\nexport const maxFromCorners = (\n  topLeft: Points.Point,\n  topRight: Points.Point,\n  bottomRight: Points.Point,\n  bottomLeft: Points.Point\n): RectPositioned => {\n  if (topLeft.y > bottomRight.y) {\n    throw new Error(`topLeft.y greater than bottomRight.y`);\n  }\n  if (topLeft.y > bottomLeft.y) {\n    throw new Error(`topLeft.y greater than bottomLeft.y`);\n  }\n\n  const w1 = topRight.x - topLeft.x;\n  const w2 = bottomRight.x - bottomLeft.x;\n  const h1 = Math.abs(bottomLeft.y - topLeft.y);\n  const h2 = Math.abs(bottomRight.y - topRight.y);\n  return {\n    x: Math.min(topLeft.x, bottomLeft.x),\n    y: Math.min(topRight.y, topLeft.y),\n    width: Math.max(w1, w2),\n    height: Math.max(h1, h2),\n  };\n};\n\nconst guardDim = (d: number, name = `Dimension`) => {\n  if (d === undefined) throw new Error(`${ name } is undefined`);\n  if (Number.isNaN(d)) throw new Error(`${ name } is NaN`);\n  if (d < 0) throw new Error(`${ name } cannot be negative`);\n};\n\n/**\n * Throws an error if rectangle is missing fields or they\n * are not valid.\n * @param rect\n * @param name\n */\nexport const guard = (rect: Rect, name = `rect`) => {\n  if (rect === undefined) throw new Error(`{$name} undefined`);\n  if (isPositioned(rect)) Points.guard(rect, name);\n  guardDim(rect.width, name + `.width`);\n  guardDim(rect.height, name + `.height`);\n};\n\n/**\n * Clamps `value` so it does not exceed `maximum`\n * on either dimension. x,y are ignored.\n * \n * ```js\n * clamp({ width:100, height:5 }, { width:10, height:10 }); // { width:10, height:5 }\n * \n * clamp({ width:10, height:10 }, { width:10, height:10 }); // { width:10, height:10 }\n * ```\n * \n * Any existing data on `value` is copied to output.\n * @param value Input rectangle\n * @param maximum Maximum allowed size\n */\nexport const clamp = (value: Rect, maximum: Rect): Rect => {\n  return Object.freeze({\n    ...value,\n    width: Math.min(value.width, maximum.width),\n    height: Math.min(value.height, maximum.height)\n  });\n}\n\nconst guardPositioned = (rect: RectPositioned, name = `rect`) => {\n  if (!isPositioned(rect)) throw new Error(`Expected ${ name } to have x,y`);\n  guard(rect, name);\n};\n\n/**\n * Creates a rectangle from its top-left coordinate, a width and height.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * // Rectangle at 50,50 with width of 100, height of 200.\n * const rect = Rects.fromTopLeft({ x: 50, y:50 }, 100, 200);\n * ```\n * @param origin\n * @param width\n * @param height\n * @returns\n */\nexport const fromTopLeft = (\n  origin: Points.Point,\n  width: number,\n  height: number\n): RectPositioned => {\n  guardDim(width, `width`);\n  guardDim(height, `height`);\n  Points.guard(origin, `origin`);\n\n  return { x: origin.x, y: origin.y, width: width, height: height };\n};\n\n/**\n * Returns the four corners of a rectangle as an array of Points.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100, x: 0, y: 0};\n * const pts = Rects.corners(rect);\n * ```\n *\n * If the rectangle is not positioned, is origin can be provided.\n * @param rect\n * @param origin\n * @returns\n */\nexport const corners = (\n  rect: RectPositioned | Rect,\n  origin?: Points.Point\n): ReadonlyArray<Points.Point> => {\n  guard(rect);\n  if (origin === undefined && Points.isPoint(rect)) origin = rect;\n  else if (origin === undefined) {\n    throw new Error(`Unpositioned rect needs origin param`);\n  }\n\n  return [\n    { x: origin.x, y: origin.y },\n    { x: origin.x + rect.width, y: origin.y },\n    { x: origin.x + rect.width, y: origin.y + rect.height },\n    { x: origin.x, y: origin.y + rect.height },\n  ];\n};\n\n/**\n * Returns a point on cardinal direction, or 'center' for the middle.\n *\n * ```js\n * cardinal({x: 10, y:10, width:100, height: 20}, 'center');\n * ```\n * @param rect Rectangle\n * @param card Cardinal direction or 'center'\n * @returns Point\n */\nexport const cardinal = (\n  rect: RectPositioned,\n  card: CardinalDirection | `center`\n): Points.Point => {\n  const { x, y, width, height } = rect;\n  switch (card) {\n    case `nw`: {\n      return Object.freeze({ x, y });\n    }\n    case `n`: {\n      return Object.freeze({\n        x: x + width / 2,\n        y,\n      });\n    }\n    case `ne`: {\n      return Object.freeze({\n        x: x + width,\n        y,\n      });\n    }\n    case `sw`: {\n      return Object.freeze({ x, y: y + height });\n    }\n    case `s`: {\n      return Object.freeze({\n        x: x + width / 2,\n        y: y + height,\n      });\n    }\n    case `se`: {\n      return Object.freeze({\n        x: x + width,\n        y: y + height,\n      });\n    }\n    case `w`: {\n      return Object.freeze({ x, y: y + height / 2 });\n    }\n    case `e`: {\n      return Object.freeze({ x: x + width, y: y + height / 2 });\n    }\n    case `center`: {\n      return Object.freeze({\n        x: x + width / 2,\n        y: y + height / 2,\n      });\n    }\n    default: {\n      // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n      throw new Error(`Unknown direction: ${ card }`);\n    }\n  }\n};\n\n/**\n * Returns a point on the edge of rectangle\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * const r1 = {x: 10, y: 10, width: 100, height: 50};\n * Rects.getEdgeX(r1, `right`);  // Yields: 110\n * Rects.getEdgeX(r1, `bottom`); // Yields: 10\n *\n * const r2 = {width: 100, height: 50};\n * Rects.getEdgeX(r2, `right`);  // Yields: 100\n * Rects.getEdgeX(r2, `bottom`); // Yields: 0\n * ```\n * @param rect\n * @param edge Which edge: right, left, bottom, top\n * @returns\n */\nexport const getEdgeX = (\n  rect: RectPositioned | Rect,\n  edge: `right` | `bottom` | `left` | `top`\n): number => {\n  guard(rect);\n  switch (edge) {\n    case `top`: {\n      return Points.isPoint(rect) ? rect.x : 0;\n    }\n    case `bottom`: {\n      return Points.isPoint(rect) ? rect.x : 0;\n    }\n    case `left`: {\n      return Points.isPoint(rect) ? rect.y : 0;\n    }\n    case `right`: {\n      return Points.isPoint(rect) ? rect.x + rect.width : rect.width;\n    }\n  }\n};\n\n/**\n * Returns a point on the edge of rectangle\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * const r1 = {x: 10, y: 10, width: 100, height: 50};\n * Rects.getEdgeY(r1, `right`);  // Yields: 10\n * Rects.getEdgeY(r1, `bottom`); // Yields: 60\n *\n * const r2 = {width: 100, height: 50};\n * Rects.getEdgeY(r2, `right`);  // Yields: 0\n * Rects.getEdgeY(r2, `bottom`); // Yields: 50\n * ```\n * @param rect\n * @param edge Which edge: right, left, bottom, top\n * @returns\n */\nexport const getEdgeY = (\n  rect: RectPositioned | Rect,\n  edge: `right` | `bottom` | `left` | `top`\n): number => {\n  guard(rect);\n  switch (edge) {\n    case `top`: {\n      return Points.isPoint(rect) ? rect.y : 0;\n    }\n    case `bottom`: {\n      return Points.isPoint(rect) ? rect.y + rect.height : rect.height;\n    }\n    case `left`: {\n      return Points.isPoint(rect) ? rect.y : 0;\n    }\n    case `right`: {\n      return Points.isPoint(rect) ? rect.y : 0;\n    }\n  }\n};\n\n/**\n * Returns `rect` divided by the width,height of `normaliseBy`.\n * This can be useful for normalising based on camera frame.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * const frameSize = {width: 640, height: 320};\n * const object = { x: 320, y: 160, width: 64, height: 32};\n *\n * const n = Rects.normaliseByRect(object, frameSize);\n * // Yields: {x: 0.5, y: 0.5, width: 0.1, height: 0.1}\n * ```\n *\n * Height and width can be supplied instead of a rectangle too:\n * ```js\n * const n = Rects.normaliseByRect(object, 640, 320);\n * ```\n * @param rect\n * @param normaliseBy\n * @returns\n */\nexport const normaliseByRect = (\n  rect: Rect | RectPositioned,\n  normaliseByOrWidth: Rect | number,\n  height?: number\n): Rect | RectPositioned => {\n  //eslint-disable-next-line functional/no-let\n  let width;\n  if (height === undefined) {\n    if (isRect(normaliseByOrWidth)) {\n      height = normaliseByOrWidth.height;\n      width = normaliseByOrWidth.width;\n    } else {\n      throw new Error(\n        `Expects rectangle or width and height parameters for normaliseBy`\n      );\n    }\n  } else {\n    if (typeof normaliseByOrWidth === `number`) {\n      width = normaliseByOrWidth;\n    } else {\n      throw new TypeError(\n        `Expects rectangle or width and height parameters for normaliseBy`\n      );\n    }\n  }\n\n  return isPositioned(rect) ? Object.freeze({\n    x: rect.x / width,\n    y: rect.y / height,\n    width: rect.width / width,\n    height: rect.height / height,\n  }) : Object.freeze({\n    width: rect.width / width,\n    height: rect.height / height,\n  });\n};\n\n/**\n * Multiplies `a` by rectangle or width/height. Useful for denormalising a value.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * // Normalised rectangle of width 50%, height 50%\n * const r = {width: 0.5, height: 0.5};\n *\n * // Map to window:\n * const rr = Rects.multiply(r, window.innerWidth, window.innerHeight);\n * ```\n *\n * ```js\n * // Returns {width: someRect.width * someOtherRect.width ...}\n * Rects.multiply(someRect, someOtherRect);\n *\n * // Returns {width: someRect.width * 100, height: someRect.height * 200}\n * Rects.multiply(someRect, 100, 200);\n * ```\n *\n * Multiplication applies to the first parameter's x/y fields, if present.\n */\nexport function multiply(\n  a: RectPositioned,\n  b: Rect | number,\n  c?: number\n): RectPositioned;\n\n/**\n * Multiplies `a` by rectangle or width/height. Useful for denormalising a value.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * // Normalised rectangle of width 50%, height 50%\n * const r = {width: 0.5, height: 0.5};\n *\n * // Map to window:\n * const rr = Rects.multiply(r, window.innerWidth, window.innerHeight);\n * ```\n *\n * ```js\n * // Returns {width: someRect.width * someOtherRect.width ...}\n * Rects.multiply(someRect, someOtherRect);\n *\n * // Returns {width: someRect.width * 100, height: someRect.height * 200}\n * Rects.multiply(someRect, 100, 200);\n * ```\n *\n * Multiplication applies to the first parameter's x/y fields, if present.\n */\nexport function multiply(a: Rect, b: Rect | number, c?: number): Rect;\nexport function multiply(a: RectPositioned, b: Rect): RectPositioned;\n\n/**\n * Multiplies `a` by rectangle or width/height. Useful for denormalising a value.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * // Normalised rectangle of width 50%, height 50%\n * const r = {width: 0.5, height: 0.5};\n *\n * // Map to window:\n * const rr = Rects.multiply(r, window.innerWidth, window.innerHeight);\n * ```\n *\n * ```js\n * // Returns {width: someRect.width * someOtherRect.width ...}\n * Rects.multiply(someRect, someOtherRect);\n *\n * // Returns {width: someRect.width * 100, height: someRect.height * 200}\n * Rects.multiply(someRect, 100, 200);\n * ```\n *\n * Multiplication applies to the first parameter's x/y fields, if present.\n */\n//eslint-disable-next-line func-style\nexport function multiply(\n  a: RectPositioned | Rect,\n  b: Rect | number,\n  c?: number\n): RectPositioned | Rect {\n  guard(a, `a`);\n  if (isRect(b)) {\n    return isRectPositioned(a) ? Object.freeze({\n      ...a,\n      x: a.x * b.width,\n      y: a.y * b.height,\n      width: a.width * b.width,\n      height: a.height * b.height,\n    }) : Object.freeze({\n      ...a,\n      width: a.width * b.width,\n      height: a.height * b.height,\n    });\n  } else {\n    if (typeof b !== `number`) {\n      throw new TypeError(\n        `Expected second parameter of type Rect or number. Got ${ JSON.stringify(\n          b\n        ) }`\n      );\n    }\n    if (c === undefined) c = b;\n\n    return isRectPositioned(a) ? Object.freeze({\n      ...a,\n      x: a.x * b,\n      y: a.y * c,\n      width: a.width * b,\n      height: a.height * c,\n    }) : Object.freeze({\n      ...a,\n      width: a.width * b,\n      height: a.height * c,\n    });\n  }\n}\n\n/**\n * Multiplies all components of `rect` by `amount`\n * @param rect\n * @param amount\n */\nexport function multiplyScalar(rect: Rect, amount: number): Rect;\n/**\n * Multiplies all components of `rect` by `amount`\n * @param rect\n * @param amount\n */\nexport function multiplyScalar(\n  rect: RectPositioned,\n  amount: number\n): RectPositioned;\n/**\n * Multiplies all components of `rect` by `amount`\n * @param rect\n * @param amount\n */\nexport function multiplyScalar(\n  rect: Rect | RectPositioned,\n  amount: number\n): Rect | RectPositioned {\n  return isPositioned(rect) ? Object.freeze({\n    ...rect,\n    x: rect.x * amount,\n    y: rect.y * amount,\n    width: rect.width * amount,\n    height: rect.height * amount,\n  }) : Object.freeze({\n    ...rect,\n    width: rect.width * amount,\n    height: rect.height * amount,\n  });\n}\n\n/**\n * Returns the center of a rectangle as a {@link Geometry.Points.Point}.\n *  If the rectangle lacks a position and `origin` parameter is not provided, 0,0 is used instead.\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n *\n * const p = Rects.center({x:10, y:20, width:100, height:50});\n * const p2 = Rects.center({width: 100, height: 50}); // Assumes 0,0 for rect x,y\n * ```\n * @param rect Rectangle\n * @param origin Optional origin. Overrides `rect` position if available. If no position is available 0,0 is used by default.\n * @returns\n */\nexport const center = (\n  rect: RectPositioned | Rect,\n  origin?: Points.Point\n): Points.Point => {\n  guard(rect);\n  if (origin === undefined && Points.isPoint(rect)) origin = rect;\n  else if (origin === undefined) origin = { x: 0, y: 0 }; // throw new Error(`Unpositioned rect needs origin param`);\n\n  return Object.freeze({\n    x: origin.x + rect.width / 2,\n    y: origin.y + rect.height / 2,\n  });\n};\n\n/**\n * Returns the length of each side of the rectangle (top, right, bottom, left)\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100, x: 100, y: 100 };\n * // Yields: array of length four\n * const lengths = Rects.lengths(rect);\n * ```\n * @param rect\n * @returns\n */\nexport const lengths = (rect: RectPositioned): ReadonlyArray<number> => {\n  guardPositioned(rect, `rect`);\n  return edges(rect).map((l) => Lines.length(l));\n};\n\n/**\n * Returns four lines based on each corner.\n * Lines are given in order: top, right, bottom, left\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100, x: 100, y: 100 };\n * // Yields: array of length four\n * const lines = Rects.lines(rect);\n * ```\n *\n * @param {(RectPositioned|Rect)} rect\n * @param {Points.Point} [origin]\n * @returns {Lines.Line[]}\n */\nexport const edges = (\n  rect: RectPositioned | Rect,\n  origin?: Points.Point\n): ReadonlyArray<Lines.Line> => {\n  const c = corners(rect, origin);\n\n  // Connect all the corners, back to first corner again\n  return Lines.joinPointsToLines(...c, c[ 0 ]);\n};\n\n/**\n * Returns the perimeter of `rect` (ie. sum of all edges)\n *  * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100, x: 100, y: 100 };\n * Rects.perimeter(rect);\n * ```\n * @param rect\n * @returns\n */\nexport const perimeter = (rect: Rect): number => {\n  guard(rect);\n  return rect.height + rect.height + rect.width + rect.width;\n};\n\n/**\n * Returns the area of `rect`\n *\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const rect = { width: 100, height: 100, x: 100, y: 100 };\n * Rects.area(rect);\n * ```\n * @param rect\n * @returns\n */\nexport const area = (rect: Rect): number => {\n  guard(rect);\n  return rect.height * rect.width;\n};\n\n/**\n * Returns true if `a` or `b` overlap, are equal, or `a` contains `b`.\n * A rectangle can be checked for intersections with another RectPositioned, CirclePositioned or Point.\n *\n */\nexport const isIntersecting = (\n  a: RectPositioned,\n  b: CirclePositioned | Points.Point\n): boolean => {\n  if (!isRectPositioned(a)) {\n    throw new Error(`a parameter should be RectPositioned`);\n  }\n\n  if (isCirclePositioned(b)) {\n    return Intersects.circleRect(b, a);\n  } else if (Points.isPoint(b)) {\n    return intersectsPoint(a, b);\n  }\n  throw new Error(`Unknown shape for b: ${ JSON.stringify(b) }`);\n};\n\n/**\n * Returns a random positioned Rect on a 0..1 scale.\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * const r = Rects.random(); // eg {x: 0.2549012, y:0.859301, width: 0.5212, height: 0.1423 }\n * ```\n *\n * A custom source of randomness can be provided:\n * ```js\n * import { Rects } from \"https://unpkg.com/ixfx/dist/geometry.js\";\n * import { weightedSource } from \"https://unpkg.com/ixfx/dist/random.js\"\n * const r = Rects.random(weightedSource(`quadIn`));\n * ```\n * @param rando\n * @returns\n */\nexport const random = (rando?: RandomSource): RectPositioned => {\n  if (rando === undefined) rando = defaultRandom;\n\n  return Object.freeze({\n    x: rando(),\n    y: rando(),\n    width: rando(),\n    height: rando(),\n  });\n};\n\nexport type RandomPointOpts = {\n  readonly strategy?: `naive`;\n  readonly randomSource?: RandomSource;\n  readonly margin?: { readonly x: number; readonly y: number };\n};\n\n/**\n * Returns a random point within a circle.\n *\n * By default creates a uniform distribution.\n *\n * ```js\n * const pt = randomPoint({width: 5, height: 10});\n * ```'\n * @param within Circle to generate a point within\n * @param opts Options\n * @returns\n */\nexport const randomPoint = (\n  within: Rect | RectPositioned,\n  opts: RandomPointOpts = {}\n): Points.Point => {\n  // TODO: Does not implement uniform distribution\n  // See: https://math.stackexchange.com/questions/366474/find-coordinates-of-n-points-uniformly-distributed-in-a-rectangle\n  const rand = opts.randomSource ?? defaultRandom;\n  const margin = opts.margin ?? { x: 0, y: 0 };\n\n  const x = rand() * (within.width - margin.x - margin.x);\n  const y = rand() * (within.height - margin.y - margin.y);\n\n  const pos = { x: x + margin.x, y: y + margin.y };\n  return isPositioned(within) ? Points.sum(pos, within) : Object.freeze(pos);\n};\n","import { guard as guardPoint } from './Point.js';\nimport { type Path } from './Path.js';\nimport { type Line } from './Line.js';\nimport { Points, Polar, Rects } from './index.js';\n//import { ShapePositioned } from './Shape.js';\nimport { Arrays } from '../collections/index.js';\nimport { defaultRandom, type RandomSource } from '../Random.js';\nimport * as Intersects from './Intersects.js';\nconst piPi = Math.PI * 2;\n\n/**\n * A circle\n */\nexport type Circle = {\n  readonly radius: number\n}\n\n/**\n * A {@link Circle} with position\n */\nexport type CirclePositioned = Points.Point & Circle;\n\nexport type CircularPath = Circle & Path & {\n  readonly kind: `circular`\n};\n\n// export type CircularShape = Circle & Shape & {\n//   readonly kind:`circular`\n// }\n\n\n/**\n * Returns true if parameter has x,y. Does not verify if parameter is a circle or not\n * \n * ```js\n * import { Circles } from \"https://unpkg.com/ixfx/dist/geometry.js\" \n * \n * const circleA = { radius: 5 };\n * Circles.isPositioned(circle); // false\n * \n * const circleB = { radius: 5, x: 10, y: 10 }\n * Circles.isPositioned(circle); // true\n * ```\n * @param p Circle\n * @returns \n */\nexport const isPositioned = (p: Circle | Points.Point): p is Points.Point => (p as Points.Point).x !== undefined && (p as Points.Point).y !== undefined;\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const isCircle = (p: Circle | CirclePositioned | any): p is Circle => (p as Circle).radius !== undefined;\n//eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport const isCirclePositioned = (p: Circle | CirclePositioned | any): p is CirclePositioned => isCircle(p) && isPositioned(p);\n\n/**\n * Returns a point on a circle at a specified angle in radians\n * \n * ```js\n * import { Circles } from \"https://unpkg.com/ixfx/dist/geometry.js\" \n * \n * // Circle without position\n * const circleA = { radius: 5 };\n * \n * // Get point at angle Math.PI, passing in a origin coordinate\n * const ptA = Circles.point(circleA, Math.PI, {x: 10, y: 10 });\n * \n * // Point on circle with position\n * const circleB = { radius: 5, x: 10, y: 10};\n * const ptB = Circles.point(circleB, Math.PI);\n * ```\n * @param circle\n * @param angleRadian Angle in radians\n * @param Origin or offset of calculated point. By default uses center of circle or 0,0 if undefined\n * @returns Point oo circle\n */\nexport const point = (circle: Circle | CirclePositioned, angleRadian: number, origin?: Points.Point): Points.Point => {\n  if (origin === undefined) {\n    if (isPositioned(circle)) {\n      origin = circle;\n    } else {\n      origin = { x: 0, y: 0 };\n    }\n  }\n  return {\n    x: (Math.cos(-angleRadian) * circle.radius) + origin.x,\n    y: (Math.sin(-angleRadian) * circle.radius) + origin.y\n  };\n};\n\n/**\n * Throws if radius is out of range. If x,y is present, these will be validated too.\n * @param circle \n * @param paramName \n */\nconst guard = (circle: CirclePositioned | Circle, paramName = `circle`) => {\n  if (isPositioned(circle)) {\n    guardPoint(circle, `circle`);\n  }\n\n  if (Number.isNaN(circle.radius)) throw new Error(`${ paramName }.radius is NaN`);\n  if (circle.radius <= 0) throw new Error(`${ paramName }.radius must be greater than zero`);\n};\n\n/**\n * Throws if `circle` is not positioned or has dodgy fields\n * @param circle \n * @param paramName \n * @returns \n */\nconst guardPositioned = (circle: CirclePositioned, paramName = `circle`) => {\n  if (!isPositioned(circle)) throw new Error(`Expected a positioned circle with x,y`);\n  return guard(circle, paramName);\n};\n\n/**\n * Returns the center of a circle\n * \n * If the circle has an x,y, that is the center.\n * If not, `radius` is used as the x and y.\n * \n * ```js\n * import { Circles } from \"https://unpkg.com/ixfx/dist/geometry.js\" \n * const circle = { radius: 5, x: 10, y: 10};\n * \n * // Yields: { x: 5, y: 10 }\n * Circles.center(circle);\n * ```\n * \n * It's a trivial function, but can make for more understandable code\n * @param circle \n * @returns Center of circle\n */\nexport const center = (circle: CirclePositioned | Circle) => {\n  if (isPositioned(circle)) return Object.freeze({ x: circle.x, y: circle.y });\n  else return Object.freeze({ x: circle.radius, y: circle.radius });\n};\n/**\n * Computes relative position along circle\n * \n * ```js\n * import { Circles } from \"https://unpkg.com/ixfx/dist/geometry.js\" \n * const circle = { radius: 100, x: 100, y: 100 };\n * \n * // Get a point halfway around circle\n * // Yields { x, y }\n * const pt = Circles.interpolate(circle, 0.5);\n * ```\n * @param circle \n * @param t Position, 0-1\n * @returns \n */\nexport const interpolate = (circle: CirclePositioned, t: number): Points.Point => point(circle, t * piPi);\n\n/**\n * Returns circumference of `circle` (alias of {@link circumference})\n * @param circle \n * @returns \n */\nexport const length = (circle: Circle): number => circumference(circle);\n\n/**\n * Returns circumference of `circle` (alias of {@link length})\n * @param circle \n * @returns \n */\nexport const circumference = (circle: Circle): number => {\n  guard(circle);\n  return piPi * circle.radius;\n};\n\n/**\n * Returns the area of `circle`.\n * @param circle \n * @returns \n */\nexport const area = (circle: Circle) => {\n  guard(circle);\n  return Math.PI * circle.radius * circle.radius;\n};\n\n/**\n * Computes a bounding box that encloses circle\n * @param circle\n * @returns \n */\nexport const bbox = (circle: CirclePositioned | Circle): Rects.RectPositioned | Rects.Rect => {\n  if (isPositioned(circle)) {\n    return Rects.fromCenter(circle, circle.radius * 2, circle.radius * 2);\n  } else {\n    return { width: circle.radius * 2, height: circle.radius * 2 };\n  }\n};\n\n/**\n * Returns true if `b` is completely contained by `a`\n *\n * ```js\n * // Compare two points\n * isContainedBy(circleA, circleB);\n * \n * // Compare a circle with a point\n * isContainedBy(circleA, {x: 10, y: 20});\n * \n * // Define radius as third parameter\n * isContainedBy(circleA, {x: 10, y: 20}, 20);\n * ```\n * @param a Circle\n * @param b Circle or point to compare to\n * @param c Radius to accompany parameter b if it's a point\n * @returns\n */\nexport const isContainedBy = (a: CirclePositioned, b: CirclePositioned | Points.Point, c?: number): boolean => {\n  const d = distanceCenter(a, b);\n  if (isCircle(b)) {\n    return (d < Math.abs(a.radius - b.radius));\n  } else if (Points.isPoint(b)) {\n    if (c !== undefined) {\n      // Defining a circle\n      return (d < Math.abs(a.radius - c));\n    } else {\n      return d <= a.radius;\n    }\n  } else throw new Error(`b parameter is expected to be CirclePositioned or Point`);\n};\n\n/***\n * Returns true if radius, x or y are NaN\n */\nexport const isNaN = (a: Circle | CirclePositioned): boolean => {\n  if (Number.isNaN(a.radius)) return true;\n  if (isPositioned(a)) {\n    if (Number.isNaN(a.x)) return true;\n    if (Number.isNaN(a.y)) return true;\n  }\n  return false;\n};\n/**\n * Returns true if `a` or `b` overlap, are equal, or `a` contains `b`.\n * A circle can be checked for intersections with another CirclePositioned, Point or RectPositioned.\n * \n * Use `intersections` to find the points of intersection.\n *\n * @param a Circle\n * @param b Circle or point to test\n * @returns True if circle overlap\n */\nexport const isIntersecting = (a: CirclePositioned, b: CirclePositioned | Points.Point | Rects.RectPositioned, c?: number): boolean => {\n  if (Points.isEqual(a, b)) return true;\n  if (isContainedBy(a, b, c)) return true;\n  if (isCircle(b)) {\n    return Intersects.circleCircle(a, b);\n  } else if (Rects.isRectPositioned(b)) {\n    return Intersects.circleRect(a, b);\n  } else if (Points.isPoint(b) && c !== undefined) {\n    return Intersects.circleCircle(a, { ...b, radius: c });\n  }\n  return false;\n};\n\n/**\n * \n * Returns the points of intersection betweeen `a` and `b`.\n * \n * Returns an empty array if circles are equal, one contains the other or if they don't touch at all.\n *\n * @param a Circle\n * @param b Circle\n * @returns Points of intersection, or an empty list if there are none\n */\nexport const intersections = (a: CirclePositioned, b: CirclePositioned): readonly Points.Point[] => {\n  const vector = Points.subtract(b, a);\n  const centerD = Math.sqrt((vector.y * vector.y) + (vector.x * vector.x));\n\n  // Do not intersect\n  if (centerD > a.radius + b.radius) return [];\n\n  // Circle contains another\n  if (centerD < Math.abs(a.radius - b.radius)) return [];\n\n  // Circles are the same\n  if (isEqual(a, b)) return [];\n\n  const centroidD = ((a.radius * a.radius) - (b.radius * b.radius) + (centerD * centerD)) / (2.0 * centerD);\n  const centroid = {\n    x: a.x + (vector.x * centroidD / centerD),\n    y: a.y + (vector.y * centroidD / centerD)\n  };\n\n  const centroidIntersectionD = Math.sqrt((a.radius * a.radius) - (centroidD * centroidD));\n\n  const intersection = {\n    x: -vector.y * (centroidIntersectionD / centerD),\n    y: vector.x * (centroidIntersectionD / centerD)\n  };\n  return [\n    Points.sum(centroid, intersection),\n    Points.subtract(centroid, intersection)\n  ];\n};\n\n/**\n * Returns true if the two objects have the same values\n *\n * ```js\n * const circleA = { radius: 10, x: 5, y: 5 };\n * const circleB = { radius: 10, x: 5, y: 5 };\n * \n * circleA === circleB; // false, because identity of objects is different\n * Circles.isEqual(circleA, circleB); // true, because values are the same\n * ```\n * \n * Circles must both be positioned or not.\n * @param a\n * @param b\n * @returns\n */\nexport const isEqual = (a: CirclePositioned | Circle, b: CirclePositioned | Circle): boolean => {\n  if (a.radius !== b.radius) return false;\n\n  if (isPositioned(a) && isPositioned(b)) {\n    if (a.x !== b.x) return false;\n    if (a.y !== b.y) return false;\n    if (a.z !== b.z) return false;\n    return true;\n  } else if (!isPositioned(a) && !isPositioned(b)) {\n    // no-op\n  } else return false; // one is positioned one not\n\n  return false;\n};\n\nexport type RandomPointOpts = {\n  readonly strategy?: `naive` | `uniform`\n  readonly randomSource?: RandomSource\n}\n\n/**\n * Returns a random point within a circle.\n * \n * By default creates a uniform distribution.\n * \n * ```js\n * const pt = randomPoint({radius: 5});\n * const pt = randomPoint({radius: 5, x: 10, y: 20});\n * ```'\n * \n * Generate points with a gaussian distribution\n * ```js\n * const pt = randomPoint(circle, {\n *  randomSource: Random.gaussian\n * })\n * ```\n * @param within Circle to generate a point within\n * @param opts Options\n * @returns \n */\nexport const randomPoint = (within: Circle | CirclePositioned, opts: RandomPointOpts = {}): Points.Point => {\n  const offset: Points.Point = isPositioned(within) ? within : { x: 0, y: 0 };\n  const strategy = opts.strategy ?? `uniform`;\n  const rand = opts.randomSource ?? defaultRandom;\n  switch (strategy) {\n    case `naive`:\n      return Points.sum(offset, Polar.toCartesian(rand() * within.radius, rand() * piPi));\n    case `uniform`:\n      return Points.sum(offset, Polar.toCartesian(Math.sqrt(rand()) * within.radius, rand() * piPi));\n    default:\n      throw new Error(`Unknown strategy ${ strategy }`);\n  }\n};\n\nexport function multiplyScalar(a: CirclePositioned, value: number): CirclePositioned;\n\nexport function multiplyScalar(a: Circle, value: number): Circle;\n\n/**\n * Multiplies a circle's radius and position (if provided) by `value`.\n * \n * ```js\n * multiplyScalar({ radius: 5 }, 5);\n * // Yields: { radius: 25 }\n * \n * multiplyScalar({ radius: 5, x: 10, y: 20 }, 5);\n * // Yields: { radius: 25, x: 50, y: 100 }\n * ```\n */\nexport function multiplyScalar(a: Circle | CirclePositioned, value: number): Circle | CirclePositioned {\n  if (isPositioned(a)) {\n    const pt = Points.multiplyScalar(a, value);\n    return Object.freeze({\n      ...a,\n      ...pt,\n      radius: a.radius * value\n    });\n  } else {\n    return Object.freeze({\n      ...a,\n      radius: a.radius * value\n    });\n  }\n}\n\n\n/**\n * Returns the distance between two circle centers.\n * \n * ```js\n * import { Circles } from \"https://unpkg.com/ixfx/dist/geometry.js\" \n * const circleA = { radius: 5, x: 5, y: 5 }\n * const circleB = { radius: 10, x: 20, y: 20 }\n * const distance = Circles.distanceCenter(circleA, circleB);\n * ```\n * Throws an error if either is lacking position.\n * @param a \n * @param b \n * @returns Distance\n */\nexport const distanceCenter = (a: CirclePositioned, b: CirclePositioned | Points.Point): number => {\n  guardPositioned(a, `a`);\n  if (isCirclePositioned(b)) {\n    guardPositioned(b, `b`);\n  }\n  return Points.distance(a, b);\n};\n\n/**\n * Returns the distance between the exterior of two circles, or between the exterior of a circle and point.\n * If `b` overlaps or is enclosed by `a`, distance is 0.\n * \n * ```js\n * import { Circles } from \"https://unpkg.com/ixfx/dist/geometry.js\" \n * const circleA = { radius: 5, x: 5, y: 5 }\n * const circleB = { radius: 10, x: 20, y: 20 }\n * const distance = Circles.distanceCenter(circleA, circleB);\n * ```\n * @param a\n * @param b \n */\nexport const distanceFromExterior = (a: CirclePositioned, b: CirclePositioned | Points.Point): number => {\n  guardPositioned(a, `a`);\n  if (isCirclePositioned(b)) {\n    return Math.max(0, distanceCenter(a, b) - a.radius - b.radius);\n  } else if (Points.isPoint(b)) {\n    const dist = Points.distance(a, b);\n    if (dist < a.radius) return 0;\n    return dist;\n  } else throw new Error(`Second parameter invalid type`);\n};\n\ntype ToSvg = {\n  (radius: number, sweep: boolean, origin: Points.Point): readonly string[];\n  (circle: Circle, sweep: boolean, origin: Points.Point): readonly string[];\n  (circle: CirclePositioned, sweep: boolean): readonly string[];\n};\n\n\n/**\n * Creates a SVG path segment.\n * @param a Circle or radius\n * @param sweep If true, path is 'outward'\n * @param origin Origin of path. Required if first parameter is just a radius or circle is non-positioned\n * @returns \n */\nexport const toSvg: ToSvg = (a: CirclePositioned | number | Circle, sweep: boolean, origin?: Points.Point): readonly string[] => {\n  if (isCircle(a)) {\n    if (origin !== undefined) {\n      return toSvgFull(a.radius, origin, sweep);\n    }\n    if (isPositioned(a)) {\n      return toSvgFull(a.radius, a, sweep);\n    } else throw new Error(`origin parameter needed for non-positioned circle`);\n  } else {\n    if (origin !== undefined) {\n      return toSvgFull(a, origin, sweep);\n    } else throw new Error(`origin parameter needed`);\n  }\n};\n\nconst toSvgFull = (radius: number, origin: Points.Point, sweep: boolean): readonly string[] => {\n  // https://stackoverflow.com/questions/5737975/circle-drawing-with-svgs-arc-path\n  const { x, y } = origin;\n  const s = sweep ? `1` : `0`;\n  return `\n    M ${ x }, ${ y }\n    m -${ radius }, 0\n    a ${ radius },${ radius } 0 1,${ s } ${ radius * 2 },0\n    a ${ radius },${ radius } 0 1,${ s } -${ radius * 2 },0\n  `.split(`\\n`);\n};\n\n/**\n * Returns the nearest point on `circle` closest to `point`.\n * \n * ```js\n * import { Circles } from 'https://unpkg.com/ixfx/dist/geometry.js'\n * const pt = Circles.nearest(circle, {x:10,y:10});\n * ```\n * \n * If an array of circles is provided, it will be the closest point amongst all the circles\n * @param circle Circle or array of circles\n * @param point\n * @returns Point `{ x, y }`\n */\nexport const nearest = (circle: CirclePositioned | readonly CirclePositioned[], b: Points.Point): Points.Point => {\n  const n = (a: CirclePositioned): Points.Point => {\n    const l = Math.sqrt(Math.pow(b.x - a.x, 2) + Math.pow(b.y - a.y, 2));\n    const x = a.x + (a.radius * ((b.x - a.x) / l));\n    const y = a.y + (a.radius * ((b.y - a.y) / l));\n    return { x, y };\n  };\n\n  if (Array.isArray(circle)) {\n    const pts = circle.map(l => n(l));\n    const dists = pts.map(p => Points.distance(p, b));\n    return Object.freeze<Points.Point>(pts[ Arrays.minIndex(...dists) ]);\n  } else {\n    return Object.freeze<Points.Point>(n(circle as CirclePositioned));\n  }\n};\n\n/**\n * Returns a positioned version of a circle.\n * If circle is already positioned, it is returned.\n * If no default position is supplied, 0,0 is used.\n * @param circle \n * @param defaultPositionOrX \n * @param y \n * @returns \n */\nexport const toPositioned = (circle: Circle | CirclePositioned, defaultPositionOrX?: Points.Point | number, y?: number): CirclePositioned => {\n  if (isPositioned(circle)) return circle;\n\n  // Returns 0,0 if params are undefined\n  const pt = Points.getPointParameter(defaultPositionOrX, y);\n  return Object.freeze({\n    ...circle,\n    ...pt\n  });\n};\n/**\n * Returns a `CircularPath` representation of a circle\n *\n * @param {CirclePositioned} circle\n * @returns {CircularPath}\n */\nexport const toPath = (circle: CirclePositioned): CircularPath => {\n  guard(circle);\n\n  return Object.freeze({\n    ...circle,\n    nearest: (point: Points.Point) => nearest(circle, point),\n    /**\n     * Returns a relative (0.0-1.0) point on a circle. 0=3 o'clock, 0.25=6 o'clock, 0.5=9 o'clock, 0.75=12 o'clock etc.\n     * @param {t} Relative (0.0-1.0) point\n     * @returns {Point} X,y\n     */\n    interpolate: (t: number) => interpolate(circle, t),\n    bbox: () => bbox(circle) as Rects.RectPositioned,\n    length: () => length(circle),\n    toSvgString: (sweep = true) => toSvg(circle, sweep),\n    kind: `circular`\n  });\n};\n\n/**\n * Returns the point(s) of intersection between a circle and line.\n * \n * ```js\n * import { Circles } from \"https://unpkg.com/ixfx/dist/geometry.js\" \n * const circle = { radius: 5, x: 5, y: 5 };\n * const line = { a: { x: 0, y: 0 }, b: { x: 10, y: 10 } };\n * const pts = Circles.intersectionLine(circle, line);\n * ```\n * @param circle \n * @param line \n * @returns Point(s) of intersection, or empty array\n */\nexport const intersectionLine = (circle: CirclePositioned, line: Line): readonly Points.Point[] => {\n  const v1 = {\n    x: line.b.x - line.a.x,\n    y: line.b.y - line.a.y\n  };\n  const v2 = {\n    x: line.a.x - circle.x,\n    y: line.a.y - circle.y\n  };\n\n  const b = (v1.x * v2.x + v1.y * v2.y) * -2;\n  const c = 2 * (v1.x * v1.x + v1.y * v1.y);\n\n  const d = Math.sqrt(b * b - 2 * c * (v2.x * v2.x + v2.y * v2.y - circle.radius * circle.radius));\n  if (Number.isNaN(d)) return []; // no intercept\n\n  const u1 = (b - d) / c;  // these represent the unit distance of point one and two on the line\n  const u2 = (b + d) / c;\n\n  const ret = [];\n  if (u1 <= 1 && u1 >= 0) {  // add point if on the line segment\n    //eslint-disable-next-line functional/immutable-data\n    ret.push({\n      x: line.a.x + v1.x * u1,\n      y: line.a.y + v1.y * u1\n    });\n  }\n  if (u2 <= 1 && u2 >= 0) {  // second add point if on the line segment\n    //eslint-disable-next-line functional/immutable-data\n    ret.push({\n      x: line.a.x + v1.x * u2,\n      y: line.a.y + v1.y * u2\n    });\n  }\n  return ret;\n};\n\n","import {type CirclePositioned, intersections as circleIntersections} from \"./Circle.js\";\nimport {type RectPositioned} from \"./Rect.js\";\n\nexport const circleRect = (a: CirclePositioned, b: RectPositioned) => {\n  // https://yal.cc/rectangle-circle-intersection-test/\n  const deltaX = a.x - Math.max(b.x, Math.min(a.x, b.x + b.width));\n  const deltaY = a.y - Math.max(b.y, Math.min(a.y, b.y + b.height));\n  return (deltaX * deltaX + deltaY * deltaY) < (a.radius * a.radius);\n};\n\nexport const circleCircle = (a: CirclePositioned, b: CirclePositioned) => circleIntersections(a, b).length === 2;","/**\n * Result from starting a camera\n */\n//eslint-disable-next-line functional/no-mixed-types\nexport type StartResult = {\n  /**\n   * Call dispose to stop the camera feed and remove any created resources,\n   * such as a VIDEO element\n   */\n  readonly dispose: () => void;\n  /**\n   * Video element camera is connected to\n   */\n  readonly videoEl: HTMLVideoElement;\n};\n\n/**\n * Starts video file playback, creating a VIDEO element automatically.\n * @param file File\n * @returns StartResult\n */\nexport const start = async (file: File): Promise<StartResult> => {\n  const videoEl = document.createElement(`VIDEO`) as HTMLVideoElement;\n  //eslint-disable-next-line functional/immutable-data\n  videoEl.style.display = `none`;\n  //eslint-disable-next-line functional/immutable-data\n  videoEl.playsInline = true;\n  //eslint-disable-next-line functional/immutable-data\n  videoEl.muted = true;\n\n  videoEl.classList.add(`ixfx-video`);\n\n  document.body.appendChild(videoEl);\n\n  //eslint-disable-next-line functional/no-let\n  let stopVideo = () => {\n    /* no-op */\n  };\n\n  const dispose = () => {\n    try {\n      // Stop source\n      stopVideo();\n    } catch {\n      /* no-op */\n    }\n\n    // Remove the element we created\n    videoEl.remove();\n  };\n\n  try {\n    // Attempt to start video\n    const r = await startWithVideoEl(videoEl, file);\n    stopVideo = r.dispose;\n    return { videoEl, dispose };\n  } catch (ex) {\n    // If it didn't work, delete the created element\n    console.error(ex);\n    dispose();\n    throw ex;\n  }\n};\n\n/**\n * Starts playback of a video file in the provided VIDEO element.\n * @param videoEl\n * @param file\n * @returns\n */\nconst startWithVideoEl = async (\n  videoEl: HTMLVideoElement,\n  file: File\n): Promise<StartResult> => {\n  if (videoEl === undefined) throw new Error(`videoEl undefined`);\n  if (videoEl === null) throw new Error(`videoEl null`);\n\n  const url = URL.createObjectURL(file);\n\n  //eslint-disable-next-line functional/immutable-data\n  videoEl.src = url;\n  //eslint-disable-next-line functional/immutable-data\n  videoEl.loop = true;\n\n  // Clean-up function\n  const dispose = () => {\n    videoEl.pause();\n  };\n\n  const ret = { videoEl, dispose };\n  const p = new Promise<StartResult>((resolve, reject) => {\n    videoEl.addEventListener(`loadedmetadata`, () => {\n      videoEl\n        .play()\n        .then(() => {\n          resolve(ret);\n        })\n        .catch((ex) => {\n          reject(ex);\n        });\n    });\n  });\n  return p;\n};\n","/* eslint-disable @typescript-eslint/no-non-null-assertion,functional/immutable-data */\nimport { continuously, delayLoop } from '../flow/index.js';\n\n//eslint-disable-next-line functional/no-mixed-types\nexport type Capturer = {\n  start(): void;\n  cancel(): void;\n  readonly canvasEl: HTMLCanvasElement;\n};\n\n//eslint-disable-next-line functional/no-mixed-types\nexport type ManualCapturer = {\n  capture(): ImageData;\n  readonly canvasEl: HTMLCanvasElement;\n  dispose(): void;\n};\n\n//eslint-disable-next-line functional/no-mixed-types\nexport type CaptureOpts = {\n  readonly maxIntervalMs?: number;\n  readonly showCanvas?: boolean;\n  readonly workerScript?: string;\n  readonly onFrame?: (pixels: ImageData) => void;\n};\n\n//eslint-disable-next-line functional/no-mixed-types\nexport type ManualCaptureOpts = {\n  /**\n   * If true, the intermediate canvas is shown\n   * The intermediate canvas is where captures from the source are put in order\n   * to get the ImageData\n   */\n  readonly showCanvas?: boolean;\n  /**\n   * If specified, this function will be called after ImageData is captured\n   * from the intermediate canvs. This allows for drawing on top of the\n   * captured image.\n   */\n  readonly postCaptureDraw?: (\n    ctx: CanvasRenderingContext2D,\n    width: number,\n    height: number\n  ) => void;\n\n  /**\n   * If specified, this is the canvas captured to\n   */\n  readonly canvasEl?: HTMLCanvasElement;\n};\n\n/**\n * Options for frames generator\n */\nexport type FramesOpts = {\n  /**\n   * Max frame rate (millis per frame), or 0 for animation speed\n   */\n  readonly maxIntervalMs?: number;\n  /**\n   * False by default, created canvas will be hidden\n   */\n  readonly showCanvas?: boolean;\n  /**\n   * If provided, this canvas will be used as the buffer rather than creating one.\n   */\n  readonly canvasEl?: HTMLCanvasElement;\n};\n\n/**\n * Generator that yields frames from a video element as [ImageData](https://developer.mozilla.org/en-US/docs/Web/API/ImageData).\n *\n * ```js\n * import {Video} from 'https://unpkg.com/ixfx/dist/visual.js'\n *\n * const ctx = canvasEl.getContext(`2d`);\n * for await (const frame of Video.frames(videoEl)) {\n *   // TODO: Some processing of pixels\n *\n *   // Draw image on to the visible canvas\n *   ctx.putImageData(frame, 0, 0);\n * }\n * ```\n *\n * Under the hood it creates a hidden canvas where frames are drawn to. This is necessary\n * to read back pixel data. An existing canvas can be used if it is passed in as an option.\n *\n * Options:\n * * `canvasEl`: CANVAS element to use as a buffer (optional)\n * * `maxIntervalMs`: Max frame rate (0 by default, ie runs as fast as possible)\n * * `showCanvas`: Whether buffer canvas will be shown (false by default)\n * @param sourceVideoEl\n * @param opts\n */\n//eslint-disable-next-line func-style\nexport async function* frames(\n  sourceVideoEl: HTMLVideoElement,\n  opts: FramesOpts = {}\n): AsyncIterable<ImageData> {\n  // TODO: Ideally use OffscreenCanvas when it has wider support?\n  // TODO: When ImageBitmap has possibility to get pixels, that might also help to avoid having to write to hidden canvas\n\n  const maxIntervalMs = opts.maxIntervalMs ?? 0;\n  \n  const showCanvas = opts.showCanvas ?? false;\n  //eslint-disable-next-line functional/no-let\n  let canvasEl = opts.canvasEl;\n  //eslint-disable-next-line functional/no-let\n  let w, h;\n  w = h = 0;\n\n  // Create & setup canvas\n  if (canvasEl === undefined) {\n    canvasEl = document.createElement(`CANVAS`) as HTMLCanvasElement;\n    canvasEl.classList.add(`ixfx-frames`);\n    if (!showCanvas) {\n      canvasEl.style.display = `none`;\n    }\n    document.body.appendChild(canvasEl);\n  }\n\n  // Update size of canvas based on video\n  const updateSize = () => {\n    if (canvasEl === undefined) return;\n    w = sourceVideoEl.videoWidth;\n    h = sourceVideoEl.videoHeight;\n    canvasEl.width = w;\n    canvasEl.height = h;\n  };\n\n  //eslint-disable-next-line functional/no-let\n  let c: CanvasRenderingContext2D | null = null;\n\n  const looper = delayLoop(maxIntervalMs);\n  for await (const _ of looper) {\n    // If we don't yet have the size of video, get it\n    if (w === 0 || h === 0) updateSize();\n\n    // If there is still no dimensions (ie stream has not started), there's nothing to do yet\n    if (w === 0 || h === 0) continue;\n\n    // Draw current frame from video element to hidden canvas\n    if (c === null) c = canvasEl.getContext(`2d`);\n    if (c === null) return;\n    c.drawImage(sourceVideoEl, 0, 0, w, h);\n\n    // Get pixels\n    const pixels = c.getImageData(0, 0, w, h);\n    yield pixels;\n  }\n}\n\n/**\n * Captures frames from a video element. It can send pixel data to a function or post to a worker script.\n *\n * @example Using a function\n * ```js\n * import {Video} from 'https://unpkg.com/ixfx/dist/visual.js'\n *\n * // Capture from a VIDEO element, handling frame data\n * // imageData is ImageData type: https://developer.mozilla.org/en-US/docs/Web/API/ImageData\n * Video.capture(sourceVideoEl, {\n *  onFrame(imageData => {\n *    // Do something with pixels...\n *  });\n * });\n * ```\n *\n * @example Using a worker\n * ```js\n * import {Video} from 'https://unpkg.com/ixfx/dist/visual.js'\n *\n * Video.capture(sourceVideoEl, {\n *  workerScript: `./frameProcessor.js`\n * });\n * ```\n *\n * In frameProcessor.js:\n * ```\n * const process = (frame) => {\n *  // ...process frame\n *\n *  // Send image back?\n *  self.postMessage({frame});\n * };\n *\n * self.addEventListener(`message`, evt => {\n *   const {pixels, width, height} = evt.data;\n *   const frame = new ImageData(new Uint8ClampedArray(pixels),\n *     width, height);\n *\n *   // Process it\n *   process(frame);\n * });\n * ```\n *\n * Options:\n * * `canvasEl`: CANVAS element to use as a buffer (optional)\n * * `maxIntervalMs`: Max frame rate (0 by default, ie runs as fast as possible)\n * * `showCanvas`: Whether buffer canvas will be shown (false by default)\n * * `workerScript`: If this specified, this URL will be loaded as a Worker, and frame data will be automatically posted to it\n *\n * Implementation: frames are captured using a animation-speed loop to a hidden canvas. From there\n * the pixel data is extracted and sent to either destination. In future the intermediate drawing to a\n * canvas could be skipped if it becomes possible to get pixel data from an ImageBitmap.\n * @param sourceVideoEl Source VIDEO element\n * @param opts\n * @returns\n */\nexport const capture = (\n  sourceVideoEl: HTMLVideoElement,\n  opts: CaptureOpts = {}\n): Capturer => {\n  const maxIntervalMs = opts.maxIntervalMs ?? 0;\n  const showCanvas = opts.showCanvas ?? false;\n  const onFrame = opts.onFrame;\n\n  // Ideally use OffscreenCanvas when it has support?\n  const w = sourceVideoEl.videoWidth;\n  const h = sourceVideoEl.videoHeight;\n\n  // Create canvas\n  const canvasEl = document.createElement(`CANVAS`) as HTMLCanvasElement;\n  canvasEl.classList.add(`ixfx-capture`);\n\n  if (!showCanvas) {\n    canvasEl.style.display = `none`;\n  }\n  canvasEl.width = w;\n  canvasEl.height = h;\n  //eslint-disable-next-line functional/no-let\n  let c: CanvasRenderingContext2D | null = null;\n  //eslint-disable-next-line functional/no-let\n  let worker: Worker | undefined;\n  if (opts.workerScript) {\n    worker = new Worker(opts.workerScript);\n  }\n\n  // Should we get image data?\n  const getPixels = worker || onFrame;\n  if (!getPixels && !showCanvas) {\n    console.warn(\n      `Video will be captured to hidden element without any processing. Is this what you want?`\n    );\n  }\n\n  const loop = continuously(() => {\n    // Draw current frame from video element to hidden canvas\n    if (c === null) c = canvasEl.getContext(`2d`);\n    if (c === null) return;\n    c.drawImage(sourceVideoEl, 0, 0, w, h);\n    //eslint-disable-next-line functional/no-let\n    let pixels: ImageData | undefined;\n\n    if (getPixels) {\n      // ImageData necessary\n      pixels = c.getImageData(0, 0, w, h);\n    }\n\n    if (worker) {\n      // Send to worker\n      worker.postMessage(\n        {\n          pixels: pixels!.data.buffer,\n          width: w,\n          height: h,\n          channels: 4,\n        },\n        [pixels!.data.buffer]\n      );\n    }\n    if (onFrame) {\n      // Send to callback\n      try {\n        onFrame(pixels!);\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  }, maxIntervalMs);\n\n  return {\n    start: () => loop.start(),\n    cancel: () => loop.cancel(),\n    canvasEl,\n  };\n};\n\nexport const manualCapture = (\n  sourceVideoEl: HTMLVideoElement,\n  opts: ManualCaptureOpts = {}\n): ManualCapturer => {\n  const showCanvas = opts.showCanvas ?? false;\n\n  // Ideally use OffscreenCanvas when it has support?\n  const w = sourceVideoEl.videoWidth;\n  const h = sourceVideoEl.videoHeight;\n\n  // Create canvas if necessary\n  const definedCanvasEl = opts.canvasEl !== undefined;\n  //eslint-disable-next-line functional/no-let\n  let canvasEl = opts.canvasEl;\n  if (!canvasEl) {\n    canvasEl = document.createElement(`CANVAS`) as HTMLCanvasElement;\n    canvasEl.classList.add(`ixfx-capture`);\n    document.body.append(canvasEl);\n    if (!showCanvas) canvasEl.style.display = `none`;\n  }\n\n  canvasEl.width = w;\n  canvasEl.height = h;\n\n  const capture = (): ImageData => {\n    //eslint-disable-next-line functional/no-let\n    let c: CanvasRenderingContext2D | undefined | null;\n\n    // Draw current frame from video element to canvas\n    if (!c) c = canvasEl?.getContext(`2d`, { willReadFrequently: true });\n    if (!c) throw new Error(`Could not create graphics context`);\n    c.drawImage(sourceVideoEl, 0, 0, w, h);\n\n    //eslint-disable-next-line functional/no-let\n    const pixels = c.getImageData(0, 0, w, h);\n\n    //eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (pixels as any).currentTime = sourceVideoEl.currentTime;\n\n    if (opts.postCaptureDraw) opts.postCaptureDraw(c, w, h);\n    return pixels;\n  };\n\n  const dispose = (): void => {\n    if (definedCanvasEl) return; // we didn't create it\n    try {\n      canvasEl?.remove();\n    } catch (_) {\n      // no-op\n    }\n  };\n\n  const c: ManualCapturer = {\n    canvasEl,\n    capture,\n    dispose,\n  };\n  return c;\n};\n","export type Sources = `` | `camera` | `video`;\nimport * as Camera from './Camera.js';\nimport * as VideoFile from './VideoFile.js';\nimport * as Video from '../visual/Video.js';\n\ntype State = `ready` | `initialised` | `disposed`;\n\n/**\n * Frame procesor options\n */\n//eslint-disable-next-line functional/no-mixed-types\nexport type FrameProcessorOpts = {\n  /**\n   * If true, capture canvas will be shown\n   */\n  readonly showCanvas?: boolean;\n  /**\n   * If true, raw source will be shown\n   */\n  readonly showPreview?: boolean;\n  /**\n   * If specified, this function will be called after ImageData is captured\n   * from the intermediate canvs. This allows for drawing on top of the\n   * captured image.\n   */\n  readonly postCaptureDraw?: (\n    ctx: CanvasRenderingContext2D,\n    width: number,\n    height: number\n  ) => void;\n\n  /**\n   * Default constraints to use for the camera source\n   */\n  readonly cameraConstraints?: Camera.Constraints;\n\n  /**\n   * If specified, this canvas will be used for capturing frames to\n   */\n  readonly captureCanvasEl?: HTMLCanvasElement;\n};\n\n/**\n * Frame Processor\n * Simplifies grabbing frames from a source\n */\nexport class FrameProcessor {\n  private _source: Sources;\n  private _state: State;\n  private _teardownNeeded = false;\n\n  private _cameraConstraints: Camera.Constraints | undefined;\n  private _cameraStartResult: Camera.StartResult | undefined;\n  private _videoSourceCapture: Video.ManualCapturer | undefined;\n\n  private _videoFile: File | undefined;\n  private _videoStartResult: VideoFile.StartResult | undefined;\n\n  private _showCanvas: boolean;\n  private _showPreview: boolean;\n  private _postCaptureDraw;\n  private _timer: number;\n  private _captureCanvasEl?: HTMLCanvasElement;\n\n  /**\n   * Create a new frame processor\n   * @param opts\n   */\n  constructor(opts: FrameProcessorOpts = {}) {\n    this._state = `ready`;\n    this._source = ``;\n    this._timer = performance.now();\n    this._showCanvas = opts.showCanvas ?? false;\n    this._showPreview = opts.showPreview ?? false;\n    this._cameraConstraints = opts.cameraConstraints ?? undefined;\n    this._captureCanvasEl = opts.captureCanvasEl ?? undefined;\n    this._postCaptureDraw = opts.postCaptureDraw;\n  }\n\n  /**\n   * Hides or shows the raw source in the DOM\n   * @param enabled Preview enabled\n   */\n  showPreview(enabled: boolean) {\n    if (this._state === `disposed`) throw new Error(`Disposed`);\n    //eslint-disable-next-line functional/no-let\n    let el: HTMLElement | undefined;\n\n    switch (this._source) {\n      case `camera`:\n        el = this._cameraStartResult?.videoEl;\n        if (el !== undefined) el.style.display = enabled ? `block` : `none`;\n        break;\n    }\n\n    this._showPreview = enabled;\n  }\n\n  /**\n   * Shows or hides the Canvas we're capturing to\n   * @param enabled\n   */\n  showCanvas(enabled: boolean) {\n    if (this._state === `disposed`) throw new Error(`Disposed`);\n    //eslint-disable-next-line functional/no-let\n    let el: HTMLElement | undefined;\n\n    if (this._source === `camera` || this._source === `video`) {\n      el = this._videoSourceCapture?.canvasEl;\n      if (el !== undefined) el.style.display = enabled ? `block` : `none`;\n    } else throw new Error(`Source not implemented: ${this._source}`);\n\n    this._showCanvas = enabled;\n  }\n\n  /**\n   * Returns the current capturer instance\n   * @returns\n   */\n  getCapturer(): Video.ManualCapturer | undefined {\n    if (this._state === `disposed`) throw new Error(`Disposed`);\n    if (this._source === `camera` || this._source === `video`) {\n      return this._videoSourceCapture;\n    }\n    throw new Error(`Source kind not supported ${this._source}`);\n  }\n\n  /**\n   * Grab frames from a video camera source and initialises\n   * frame processor.\n   *\n   * If `constraints` are not specified, it will use the ones\n   * provided when creating the class, or defaults.\n   *\n   * @param constraints Override of constraints when requesting camera access\n   */\n  async useCamera(constraints?: Camera.Constraints) {\n    if (this._state === `disposed`) throw new Error(`Disposed`);\n\n    this._source = `camera`;\n    if (this._teardownNeeded) this.teardown();\n    if (constraints) this._cameraConstraints;\n\n    await this.init();\n  }\n\n  async useVideo(file: File) {\n    if (this._state === `disposed`) throw new Error(`Disposed`);\n    this._source = `video`;\n    if (this._teardownNeeded) this.teardown();\n    this._videoFile = file;\n    await this.init();\n  }\n\n  /**\n   * Initialises camera\n   */\n  private async initCamera() {\n    const r = await Camera.start(this._cameraConstraints);\n    if (r === undefined) throw new Error(`Could not start camera`);\n    this._cameraStartResult = r;\n    this.postInit(r);\n  }\n\n  private async initVideo() {\n    if (!this._videoFile) throw new Error(`Video file not defined`);\n    const r = await VideoFile.start(this._videoFile);\n    this._videoStartResult = r;\n\n    this.postInit(r);\n  }\n\n  private async postInit(r: Camera.StartResult | VideoFile.StartResult) {\n    if (this._showPreview) r.videoEl.style.display = `block`;\n\n    // Set up manual capturer\n    this._videoSourceCapture = Video.manualCapture(r.videoEl, {\n      postCaptureDraw: this._postCaptureDraw,\n      showCanvas: this._showCanvas,\n      canvasEl: this._captureCanvasEl,\n    });\n\n    this._teardownNeeded = true;\n    this._cameraStartResult = r;\n  }\n\n  /**\n   * Closes down connections and removes created elements.\n   * Once disposed, the frame processor cannot be used\n   * @returns\n   */\n  dispose() {\n    if (this._state === `disposed`) return;\n    this.teardown();\n    this._state = `disposed`;\n  }\n\n  private async init() {\n    this._timer = performance.now();\n    switch (this._source) {\n      case `camera`:\n        await this.initCamera();\n        break;\n      case `video`:\n        await this.initVideo();\n        break;\n    }\n    this._state = `initialised`;\n  }\n\n  private teardown() {\n    if (!this._teardownNeeded) return;\n    if (this._source === `camera` || this._source === `video`) {\n      this._videoSourceCapture?.dispose();\n    }\n    switch (this._source) {\n      case `camera`:\n        this._cameraStartResult?.dispose();\n        break;\n      case `video`:\n        this._videoStartResult?.dispose();\n        break;\n    }\n    this._teardownNeeded = false;\n  }\n\n  /**\n   * Get the last frame\n   * @returns\n   */\n  getFrame(): ImageData | undefined {\n    if (this._state === `disposed`) throw new Error(`Disposed`);\n\n    switch (this._source) {\n      case `camera`:\n        return this.getFrameCamera();\n      case `video`:\n        return this.getFrameCamera();\n      default:\n        throw new Error(`source type unhandled ${this._source}`);\n    }\n  }\n\n  /**\n   * Get the timestamp of the processor (elapsed time since starting)\n   * @returns\n   */\n  getTimestamp(): number {\n    return performance.now() - this._timer;\n  }\n\n  private getFrameCamera(): ImageData | undefined {\n    return this._videoSourceCapture?.capture();\n  }\n}\n","import { throwIntegerTest, throwNumberTest } from './Guards.js';\nexport { pingPong, pingPongPercent } from './modulation/PingPong.js';\nexport * as Async from './IterableAsync.js';\nexport * as Sync from './IterableSync.js';\n\nexport { interval } from './flow/Interval.js';\nexport { delayLoop, type DelayOpts } from './flow/Delay.js';\n\n/**\n * Generates a range of numbers, starting from `start` and counting by `interval`.\n * If `end` is provided, generator stops when reached.\n *\n * Unlike {@link numericRange}, numbers might contain rounding errors\n *\n * ```js\n * for (const c of numericRangeRaw(10, 100)) {\n *  // 100, 110, 120 ...\n * }\n * ```\n * @param interval Interval between numbers\n * @param start Start\n * @param end End (if undefined, range never ends)\n */\nexport const numericRangeRaw = function* (\n  interval: number,\n  start = 0,\n  end?: number,\n  repeating = false\n) {\n  if (interval <= 0) throw new Error(`Interval is expected to be above zero`);\n  if (end === undefined) end = Number.MAX_SAFE_INTEGER;\n  let v = start;\n  do {\n    while (v < end) {\n      yield v;\n      v += interval;\n    }\n  } while (repeating);\n};\n\n/**\n * Generates a range of numbers, with a given interval.\n *\n * @example For-loop\n * ```\n * let loopForever = numericRange(0.1); // By default starts at 0 and counts upwards forever\n * for (v of loopForever) {\n *  console.log(v);\n * }\n * ```\n *\n * @example If you want more control over when/where incrementing happens...\n * ```js\n * let percent = numericRange(0.1, 0, 1);\n *\n * let percentResult = percent.next().value;\n * ```\n *\n * Note that computations are internally rounded to avoid floating point math issues. So if the `interval` is very small (eg thousandths), specify a higher rounding\n * number.\n *\n * @param interval Interval between numbers\n * @param start Start. Defaults to 0\n * @param end End (if undefined, range never ends)\n * @param repeating Range loops from start indefinately. Default _false_\n * @param rounding A rounding that matches the interval avoids floating-point math hikinks. Eg if the interval is 0.1, use a rounding of 10\n */\nexport const numericRange = function* (\n  interval: number,\n  start = 0,\n  end?: number,\n  repeating = false,\n  rounding?: number\n) {\n  throwNumberTest(interval, `nonZero`);\n\n  const negativeInterval = interval < 0;\n  if (end === undefined) {\n    /* no op */\n  } else {\n    if (negativeInterval && start < end) {\n      throw new Error(\n        `Interval of ${ interval } will never go from ${ start } to ${ end }`\n      );\n    }\n    if (!negativeInterval && start > end) {\n      throw new Error(\n        `Interval of ${ interval } will never go from ${ start } to ${ end }`\n      );\n    }\n  }\n\n  rounding = rounding ?? 1000;\n  if (end === undefined) end = Number.MAX_SAFE_INTEGER;\n  else end *= rounding;\n  interval = interval * rounding;\n\n  do {\n    let v = start * rounding;\n    while ((!negativeInterval && v <= end) || (negativeInterval && v >= end)) {\n      yield v / rounding;\n      v += interval;\n    }\n  } while (repeating);\n};\n\n/**\n * Yields `amount` integers, counting by one from zero. If a negative amount is used,\n * count decreases. If `offset` is provided, this is added to the return result.\n * @example\n * ```js\n * const a = [...count(5)]; // Yields five numbers: [0,1,2,3,4]\n * const b = [...count(-5)]; // Yields five numbers: [0,-1,-2,-3,-4]\n * for (const v of count(5, 5)) {\n *  // Yields: 5, 6, 7, 8, 9\n * }\n * const c = [...count(5,1)]; // Yields [1,2,3,4,5]\n * ```\n *\n * @example Used with forEach\n * ```js\n * // Prints `Hi` 5x\n * forEach(count(5), () => // do something);\n * ```\n *\n * If you want to accumulate return values, consider using\n * {@link Flow.repeat}.\n *\n * @example Run some code every 100ms, 10 times:\n * ```js\n * import { interval } from 'https://unpkg.com/ixfx/dist/flow.js'\n * import { count } from 'https://unpkg.com/ixfx/dist/generators.js'\n * const counter = count(10);\n * for await (const v of interval(counter, { fixedIntervalMs: 100 })) {\n *  // Do something\n * }\n * ```\n * @param amount Number of integers to yield\n * @param offset Added to result\n */\nexport const count = function* (amount: number, offset = 0) {\n  // Unit tested.\n  throwIntegerTest(amount, ``, `amount`);\n  throwIntegerTest(offset, ``, `offset`);\n\n  if (amount === 0) return;\n\n  let index = 0;\n  do {\n    yield (amount < 0 ? -index + offset : index + offset);\n  } while (index++ < Math.abs(amount) - 1);\n};\n\n/**\n * Returns a number range between 0.0-1.0.\n *\n * ```\n * // Yields: [0, 0.2, 0.4, 0.6, 0.8, 1]\n * const a = [...numericPercent(0.2)];\n *\n * // Repeating flag set to true:\n * for (const v of numericPercent(0.2, true)) {\n *  // Infinite loop. V loops back to 0 after hitting 1\n * }\n * ```\n *\n * If `repeating` is true, it loops back to 0 after reaching 1\n * @param interval Interval (default: 0.01, ie. 1%)\n * @param repeating Whether generator should loop (default: false)\n * @param start Start (default: 0)\n * @param end End (default: 1)\n * @returns\n */\nexport const numericPercent = function (\n  interval = 0.01,\n  repeating = false,\n  start = 0,\n  end = 1\n) {\n  throwNumberTest(interval, `percentage`, `interval`);\n  throwNumberTest(start, `percentage`, `start`);\n  throwNumberTest(end, `percentage`, `end`);\n  return numericRange(interval, start, end, repeating);\n};\n\nexport { integerUniqueGen as randomUniqueInteger } from './Random.js';","import { throwNumberTest } from '../Guards.js';\n\n/**\n * Continually loops up and down between 0 and 1 by a specified interval.\n * Looping returns start value, and is inclusive of 0 and 1.\n *\n * @example Usage\n * ```js\n * import {percentPingPong} from 'https://unpkg.com/ixfx/dist/modulation.js';\n * for (const v of percentPingPong(0.1)) {\n *  // v will go up and down. Make sure you have a break somewhere because it is infinite\n * }\n * ```\n *\n * @example Alternative:\n * ```js\n * const pp = pingPongPercent(0.1, 0.5); // Setup generator one time\n * const v = pp.next().value; // Call .next().value whenever a new value is needed\n * ```\n *\n * Because limits are capped to -1 to 1, using large intervals can produce uneven distribution. Eg an interval of 0.8 yields 0, 0.8, 1\n *\n * `upper` and `lower` define the percentage range. Eg to ping pong between 40-60%:\n * ```\n * const pp = pingPongPercent(0.1, 0.4, 0.6);\n * ```\n * @param interval Amount to increment by. Defaults to 10%\n * @param start Starting point within range. Defaults to 0 using a positive interval or 1 for negative intervals\n * @param rounding Rounding to apply. This avoids floating-point rounding errors.\n */\nexport const pingPongPercent = function (\n  interval: number = 0.1,\n  lower?: number,\n  upper?: number,\n  start?: number,\n  rounding?: number\n) {\n  if (lower === undefined) lower = 0;\n  if (upper === undefined) upper = 1;\n  if (start === undefined) start = lower;\n\n  throwNumberTest(interval, `bipolar`, `interval`);\n  throwNumberTest(upper, `bipolar`, `end`);\n  throwNumberTest(start, `bipolar`, `offset`);\n  throwNumberTest(lower, `bipolar`, `start`);\n  return pingPong(interval, lower, upper, start, rounding);\n};\n\n/**\n * Ping-pongs continually back and forth `start` and `end` with a given `interval`. Use `pingPongPercent` for 0-1 ping-ponging\n *\n * In a loop:\n * ```\n * for (const c of pingPong(10, 0, 100)) {\n *  // 0, 10, 20 .. 100, 90, 80, 70 ...\n * }\n * ```\n *\n * Manual:\n * ```\n * const pp = pingPong(10, 0, 100);\n * let v = pp.next().value; // Call .next().value whenever a new value is needed\n * ```\n * @param interval Amount to increment by. Use negative numbers to start counting down\n * @param lower Lower bound (inclusive)\n * @param upper Upper bound (inclusive, must be greater than start)\n * @param start Starting point within bounds (defaults to `lower`)\n * @param rounding Rounding is off by default. Use say 1000 if interval is a fractional amount to avoid rounding errors.\n */\nexport const pingPong = function* (\n  interval: number,\n  lower: number,\n  upper: number,\n  start?: number,\n  rounding?: number\n) {\n  if (lower === undefined) throw new Error(`Parameter 'lower' is undefined`);\n  if (interval === undefined) {\n    throw new Error(`Parameter 'interval' is undefined`);\n  }\n  if (upper === undefined) throw new Error(`Parameter 'upper' is undefined`);\n\n  if (rounding === undefined && interval <= 1 && interval >= 0) {\n    rounding = 10 / interval;\n  } else if (rounding === undefined) rounding = 1234;\n\n  if (Number.isNaN(interval)) throw new Error(`interval parameter is NaN`);\n  if (Number.isNaN(lower)) throw new Error(`lower parameter is NaN`);\n  if (Number.isNaN(upper)) throw new Error(`upper parameter is NaN`);\n  if (Number.isNaN(start)) throw new Error(`upper parameter is NaN`);\n\n  if (lower >= upper) throw new Error(`lower must be less than upper`);\n  if (interval === 0) throw new Error(`Interval cannot be zero`);\n  const distance = upper - lower;\n  if (Math.abs(interval) >= distance) {\n    throw new Error(`Interval should be between -${ distance } and ${ distance }`);\n  }\n\n  //eslint-disable-next-line functional/no-let\n  let incrementing = interval > 0;\n\n  // Scale up values by rounding factor\n  upper = Math.floor(upper * rounding);\n  lower = Math.floor(lower * rounding);\n  interval = Math.floor(Math.abs(interval * rounding));\n\n  if (interval === 0) {\n    throw new Error(`Interval is zero (rounding: ${ rounding })`);\n  }\n  if (start === undefined) start = lower;\n  else start = Math.floor(start * rounding);\n  if (start > upper || start < lower) {\n    throw new Error(\n      `Start (${ start / rounding }) must be within lower (${ lower / rounding\n      }) and upper (${ upper / rounding })`\n    );\n  }\n\n  //eslint-disable-next-line functional/no-let\n  let v = start;\n  yield v / rounding;\n  //eslint-disable-next-line functional/no-let\n  let firstLoop = true;\n  while (true) {\n    v = v + (incrementing ? interval : -interval);\n    if (incrementing && v >= upper) {\n      incrementing = false;\n      v = upper;\n      if (v === upper && firstLoop) {\n        // Edge case where we start at upper bound and increment\n        v = lower;\n        incrementing = true;\n      }\n    } else if (!incrementing && v <= lower) {\n      incrementing = true;\n      v = lower;\n      if (v === lower && firstLoop) {\n        // Edge case where we start at lower bound and decrement\n        v = upper;\n        incrementing = false;\n      }\n    }\n    yield v / rounding;\n    firstLoop = false;\n  }\n};\n","import { intervalToMs, type Interval } from './IntervalType.js';\nimport { sleep } from './Sleep.js';\n\nimport { type AsyncPromiseOrGenerator } from './index.js';\n\n\nexport type IntervalOpts = {\n  /**\n   * Sleep a fixed period of time regardless of how long each invocation of 'produce' takes\n   */\n  readonly fixed?: Interval;\n  /**\n   * Minimum interval. That is, only sleep if there is time left over after 'produce'\n   * is invoked.\n   */\n  readonly minimum?: Interval;\n  /**\n   * Optional signal to abort\n   */\n  readonly signal?: AbortSignal;\n  /**\n   * When to perform delay. Default is before 'produce' is invoked.\n   */\n  readonly delay?: `before` | `after`;\n};\n/**\n * Generates values from `produce` with a time delay.\n * `produce` can be a simple function that returns a value, an async function, or a generator.\n *\n * @example Produce a random number every 500ms:\n * ```\n * const randomGenerator = interval(() => Math.random(), 500);\n * for await (const r of randomGenerator) {\n *  // Random value every 1 second\n *  // Warning: does not end by itself, a `break` statement is needed\n * }\n * ```\n *\n * @example Return values from a generator every 500ms:\n * ```js\n * import { interval } from 'https://unpkg.com/ixfx/dist/flow.js'\n * import { count } from 'https://unpkg.com/ixfx/dist/generators.js'\n * for await (const v of interval(count(10), { fixed: 1000 })) {\n *  // Do something with `v`\n * }\n * ```\n *\n * Options allow either fixed interval (wait this long between iterations), or a minimum interval (wait at least this long).\n * The latter is useful if `produce` takes some time - it will only wait the remaining time or not at all.\n *\n * If you just want to loop at a certain speed, consider using {@link continuously} instead.\n *\n * If the AbortSignal is triggered, an exception will be thrown, stopping iteration.\n * @template V Returns value of `produce` function\n * @param produce Function, generator to use\n * @param opts Options\n * @template V Data type\n * @returns\n */\nexport const interval = async function* <V>(\n  produce: AsyncPromiseOrGenerator<V> | ArrayLike<V>,\n  optsOrFixedMs: IntervalOpts | number = {}\n): AsyncGenerator<V> {\n  //eslint-disable-next-line functional/no-let\n  let cancelled = false;\n  const opts =\n    typeof optsOrFixedMs === `number`\n      ? { fixed: optsOrFixedMs }\n      : optsOrFixedMs;\n\n  const signal = opts.signal;\n  const when = opts.delay ?? `before`;\n  //eslint-disable-next-line functional/no-let\n  let sleepMs = intervalToMs(opts.fixed) ?? intervalToMs(opts.minimum, 0);\n  //eslint-disable-next-line functional/no-let\n  let started = performance.now();\n\n  const minIntervalMs = opts.minimum ? intervalToMs(opts.minimum) : undefined;\n  const doDelay = async () => {\n    const elapsed = performance.now() - started;\n    if (typeof minIntervalMs !== `undefined`) {\n      sleepMs = Math.max(0, minIntervalMs - elapsed);\n    }\n    if (sleepMs) {\n      await sleep({ millis: sleepMs, signal });\n    }\n    started = performance.now();\n    if (signal?.aborted) throw new Error(`Signal aborted ${ signal.reason }`);\n  };\n\n  // Get an iterator over array\n  if (Array.isArray(produce)) produce = produce.values();\n\n  const isGenerator =\n    typeof produce === `object` &&\n    `next` in produce &&\n    typeof produce.next === `function`;\n\n  try {\n    while (!cancelled) {\n      if (when === `before`) await doDelay();\n      //if (cancelled) return;\n      if (typeof produce === `function`) {\n        // Returns V or Promise<V>\n        const result = await produce();\n        if (typeof result === `undefined`) return; // Done\n        yield result;\n      } else if (isGenerator) {\n        // Generator\n        const result = await (produce as AsyncGenerator<V>).next();\n        if (result.done) return;\n        yield result.value;\n      } else {\n        throw new Error(\n          `produce param does not seem to return a value/Promise and is not a generator?`\n        );\n      }\n\n      if (when === `after`) await doDelay();\n    }\n  } finally {\n    cancelled = true;\n  }\n};\n","import { intervalToMs, type Interval } from './IntervalType.js';\nimport { sleep } from './Sleep.js';\n\n/**\n * Delay options\n */\nexport type DelayOpts = Interval & {\n  /**\n   * Signal for cancelling delay\n   */\n  readonly signal?: AbortSignal;\n  /**\n   * When delay is applied. \"before\" is default.\n   */\n  readonly delay?: `before` | `after` | `both`;\n};\n\n/**\n * Pauses execution for interval after which the asynchronous `callback` is executed and awaited.\n * Must be called with `await` if you want the pause effect.\n *\n * @example Pause and wait for function\n * ```js\n * const result = await delay(async () => Math.random(), 1000);\n * console.log(result); // Prints out result after one second\n * ```\n *\n * If the `interval` option is a number its treated as milliseconds. {@link Interval} can also be used:\n * ```js\n * const result = await delay(async () => Math.random(), { mins: 1 });\n * ```\n *\n * If `await` is omitted, the function will run after the provided timeout, and code will continue to run.\n *\n * @example Schedule a function without waiting\n * ```js\n * await delay(async () => {\n *  console.log(Math.random())\n * }, 1000);\n * // Prints out a random number after 1 second.\n * ```\n *\n * {@link delay} and {@link sleep} are similar. `delay()` takes a parameter of what code to execute after the timeout, while `sleep()` just resolves after the timeout.\n *\n * Optionally takes an AbortSignal to cancel delay.\n * ```js\n * const ac = new AbortController();\n * // Super long wait\n * await delay(someFn, { signal: ac.signal, hours: 1 }}\n * ...\n * ac.abort(); // Cancels long delay\n * ```\n *\n * It also allows choice of when delay should happen.\n * If you want to be able to cancel or re-run a delayed function, consider using\n * {@link timeout} instead.\n *\n * @template V\n * @param callback What to run after interval\n * @param opts Options for delay. By default delay is before `callback` is executed.\n * @return Returns result of `callback`.\n */\nexport const delay = async <V>(\n  callback: () => Promise<V>,\n  //eslint-disable-next-line functional/prefer-immutable-types\n  optsOrMillis: DelayOpts | number\n): Promise<V> => {\n  const opts =\n    typeof optsOrMillis === `number` ? { millis: optsOrMillis } : optsOrMillis;\n  const delayWhen = opts.delay ?? `before`;\n  if (delayWhen === `before` || delayWhen === `both`) {\n    await sleep(opts);\n  }\n  const r = Promise.resolve(await callback());\n  if (delayWhen === `after` || delayWhen === `both`) {\n    await sleep(opts);\n  }\n  return r;\n};\n\n/**\n * Iterate over a source iterable with some delay between results.\n * Delay can be before, after or both before and after each result from the\n * source iterable.\n *\n * Since it's an async iterable, `for await ... of` is needed.\n *\n * ```js\n * const opts = { intervalMs: 1000, delay: 'before' };\n * const iterable = count(10);\n * for await (const i of delayIterable(iterable, opts)) {\n *  // Prints 0..9 with one second between\n * }\n * ```\n *\n * Use {@link delay} to return a result after some delay\n *\n * @param iter\n * @param opts\n */\n// export async function* delayIterable<V>(\n//   iter: AsyncIterable<V> | Iterable<V>,\n//   //eslint-disable-next-line functional/prefer-immutable-types\n//   opts: DelayOpts\n// ) {\n//   const intervalMs = intervalToMs(opts);\n//   const delayWhen = opts.delay;\n//   const signal = opts.signal;\n\n//   for await (const v of iter) {\n//     // Pre-delay\n//     if (delayWhen === 'before' || delayWhen === 'both') {\n//       await sleep({ millis: intervalMs, signal });\n//       if (signal?.aborted) break;\n//     }\n\n//     // Yield value\n//     yield v;\n\n//     // Post-delay\n//     if (delayWhen === 'after' || delayWhen === 'both') {\n//       await sleep({ millis: intervalMs, signal });\n//       if (signal?.aborted) break;\n//     }\n//   }\n// }\n\n/**\n * Async generator that loops via `requestAnimationFrame`.\n *\n * ```\n * // Loop forever\n * (async () => {\n *  const loop = delayAnimationLoop();\n *  while (true) {\n *    await loop.next();\n *\n *    // Do something...\n *    // Warning: loops forever\n *  }\n * })();\n * ```\n *\n * ```\n * const loop = delayAnimationLoop();\n * for await (const o of loop) {\n *  // Do something...\n *  // Warning: loops forever\n * }\n * ```\n */\n//eslint-disable-next-line func-style\nasync function* delayAnimationLoop() {\n  //eslint-disable-next-line functional/no-let,@typescript-eslint/no-explicit-any\n  let resolve: any;\n  //eslint-disable-next-line functional/no-let\n  let p = new Promise<undefined>((r) => (resolve = r));\n  //eslint-disable-next-line functional/no-let\n  let timer = 0;\n  const callback = () => {\n    resolve();\n    p = new Promise<undefined>((r) => (resolve = r));\n  };\n\n  try {\n    while (true) {\n      timer = window.requestAnimationFrame(callback);\n      yield await p;\n    }\n  } finally {\n    resolve();\n    window.cancelAnimationFrame(timer);\n  }\n}\n\n/**\n * Async generator that loops at a given interval.\n * Alternatives:\n * * {@link delay} to run a single function after a delay\n * * {@link sleep} pause execution\n * * {@link interval} iterate over an iterable with a given delay\n * * {@link continuously} to start/stop/adjust a constantly running loop\n *\n * @example Loop runs every second\n * ```\n * // Loop forever\n * (async () => {\n *  const loop = delayLoop(1000);\n *  // or: loop = delayLoop({ secs: 1 });\n *  while (true) {\n *    await loop.next();\n *\n *    // Do something...\n *    // Warning: loops forever\n *  }\n * })();\n * ```\n *\n * @example For Await loop every second\n * ```\n * const loop = delayLoop(1000);\n * // Or: const loop = delayLoop({ secs: 1 });\n * for await (const o of loop) {\n *  // Do something...\n *  // Warning: loops forever\n * }\n * ```\n * @param timeout Delay. If 0 is given, `requestAnimationFrame` is used over `setTimeout`.\n */\n//eslint-disable-next-line func-style\nexport async function* delayLoop(timeout: Interval) {\n  const timeoutMs = intervalToMs(timeout);\n  if (typeof timeoutMs === `undefined`) throw new Error(`timeout is undefined`);\n  if (timeoutMs < 0) throw new Error(`Timeout is less than zero`);\n  if (timeoutMs === 0) return yield* delayAnimationLoop();\n\n  //eslint-disable-next-line functional/no-let,@typescript-eslint/no-explicit-any\n  let resolve: any;\n  //eslint-disable-next-line functional/no-let\n  let p = new Promise<undefined>((r) => (resolve = r));\n  //eslint-disable-next-line functional/no-let\n  let timer = 0;\n  const callback = () => {\n    resolve();\n    p = new Promise<undefined>((r) => (resolve = r));\n  };\n\n  try {\n    while (true) {\n      timer = window.setTimeout(callback, timeoutMs);\n      yield await p;\n    }\n  } finally {\n    resolve();\n    window.clearTimeout(timer);\n  }\n}\n","import * as Drawing from './Drawing.js';\nimport * as Svg from './Svg.js';\n//import * as Plot from './Plot.js';\n\nimport * as Plot2 from './Plot2.js';\n\nimport * as Palette from './Palette.js';\nimport * as Colour from './Colour.js';\nimport * as SceneGraph from './SceneGraph.js';\nimport * as Video from './Video.js';\nimport { resolveEl } from '../dom/Util.js';\n\nexport * as ImageDataGrid from './ImageDataGrid.js';\nexport * as BipolarView from './BipolarView.js';\nexport * as Palette from './Palette.js';\nexport * as Drawing from './Drawing.js';\nexport * as Svg from './Svg.js';\n//export * as Plot from './Plot.js';\n\n\nexport * as Plot2 from './Plot2.js';\nexport * as PlotOld from './PlotOld.js';\nexport * as SceneGraph from './SceneGraph.js';\n\n/**\n * Colour interpolation, scale generation and parsing\n *\n * Overview\n * * {@link interpolate}: Blend colours\n * * {@link scale}: Produce colour scale\n * * {@link opacity}: Give a colour opacity\n * * {@link randomHue}: Generate a random hue\n * * {@link goldenAngleColour}: Pick perceptually different shades\n *\n * CSS\n * * {@link getCssVariable}: Parse a CSS-defined colour\n *\n * Conversions: convert from 'blue', 'rgb(255,0,0)',  'hsl(0, 100%, 50%)' etc:\n * * {@link toHex}: to a hex format string\n * * {@link toHsl}: to a `{h, s, l}` object\n * * {@link toRgb}: to a `{r, g, b}` object\n */\nexport * as Colour from './Colour.js';\n\n/**\n * Working with video, either playback from a file or stream from a video camera.\n *\n * Overview\n * * {@link frames}: Yields frames from a video camera\n * * {@link capture}: Capture frames from a VIDEO element\n *\n * @example Importing\n * ```js\n * // If library is stored two directories up under `ixfx/`\n * import {Video} from '../../ixfx/dist/visual.js';\n * // Import from web\n * import {Video} from 'https://unpkg.com/ixfx/dist/visual.js'\n * ```\n */\nexport * as Video from './Video.js';\n\ntry {\n  if (typeof window !== `undefined`) {\n    //eslint-disable-next-line functional/immutable-data,@typescript-eslint/no-explicit-any\n    (window as any).ixfx = {\n      ...(window as any).ixfx,\n      Visuals: {\n        SceneGraph,\n        Plot2,\n        Drawing,\n        Svg,\n        Palette,\n        Colour,\n        Video,\n      },\n    };\n  }\n} catch {\n  /* no-op */\n}\n\n/**\n * Scales a canvas to account for retina displays.\n * \n * ```js\n * const r = scaleCanvas(`#my-canvas`);\n * r.ctx;      // CanvasRendering2D\n * r.element;  // HTMLCanvasElement\n * r.bounds;   // {x:number,y:number,width:number,height:number}\n * ```\n * \n * Eg:\n * ```js\n * const { ctx } = scaleCanvas(`#my-canvas`);\n * ctx.fillStyle = `red`;\n * ctx.fillRect(0,0,100,100);\n * ```\n * \n * Throws an error if `domQueryOrElement` does not resolve.w\n * @param domQueryOrElement \n * @returns \n */\nexport const scaleCanvas = (domQueryOrElement: HTMLCanvasElement | string) => {\n  const canvasElement = resolveEl<HTMLCanvasElement>(domQueryOrElement);\n  const ratio = window.devicePixelRatio;\n  canvasElement.style.width = canvasElement.width + `px`;\n  canvasElement.style.height = canvasElement.height + `px`;\n  canvasElement.width *= devicePixelRatio;\n  canvasElement.height *= devicePixelRatio;\n\n  const getContext = () => {\n    const ctx = canvasElement.getContext(`2d`);\n\n    if (ctx === null) throw new Error(`Could not get drawing context`);\n    ctx.save();\n    ctx.scale(ratio, ratio);\n    return ctx;\n  }\n  return { ctx: getContext(), element: canvasElement, bounds: canvasElement.getBoundingClientRect() };\n}\n","import * as Points from '../geometry/Point.js';\nimport * as Paths from '../geometry/Path.js';\nimport * as Lines from '../geometry/Line.js';\nimport * as Triangles from '../geometry/Triangle.js';\nimport { throwArrayTest } from '../Guards.js';\nimport * as Circles from '../geometry/Circle.js';\nimport * as Arcs from '../geometry/Arc.js';\nimport * as Beziers from '../geometry/Bezier.js';\nimport * as Rects from '../geometry/Rect.js';\nimport * as Ellipses from '../geometry/Ellipse.js';\nimport * as Colours from '../visual/Colour.js';\nimport { resolveEl } from '../dom/Util.js';\nimport { roundUpToMultiple } from '../Util.js';\nimport type { IStackImmutable } from '../collections/stack/IStackImmutable.js';\nimport { StackImmutable } from '../collections/stack/StackImmutable.js';\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst PIPI = Math.PI * 2;\n\nexport type CanvasCtxQuery =\n  | null\n  | string\n  | CanvasRenderingContext2D\n  | HTMLCanvasElement;\n\n/**\n * Gets a 2d drawing context from canvas element or query, or throws an error\n * @param canvasElCtxOrQuery Canvas element reference or DOM query\n * @returns Drawing context.\n */\nexport const getContext = (\n  canvasElCtxOrQuery: CanvasCtxQuery\n): CanvasRenderingContext2D => {\n  if (canvasElCtxOrQuery === null) {\n    throw Error(\n      `canvasElCtxOrQuery null. Must be a 2d drawing context or Canvas element`\n    );\n  }\n  if (canvasElCtxOrQuery === undefined) {\n    throw Error(\n      `canvasElCtxOrQuery undefined. Must be a 2d drawing context or Canvas element`\n    );\n  }\n\n  const ctx =\n    canvasElCtxOrQuery instanceof CanvasRenderingContext2D\n      ? canvasElCtxOrQuery\n      : canvasElCtxOrQuery instanceof HTMLCanvasElement\n        ? canvasElCtxOrQuery.getContext(`2d`)\n        : typeof canvasElCtxOrQuery === `string`\n          ? resolveEl<HTMLCanvasElement>(canvasElCtxOrQuery).getContext(`2d`)\n          : canvasElCtxOrQuery;\n  if (ctx === null) throw new Error(`Could not create 2d context for canvas`);\n  return ctx;\n};\n\n/**\n * Makes a helper object that wraps together a bunch of drawing functions that all use the same drawing context\n * @param ctxOrCanvasEl Drawing context or canvs element reference\n * @param canvasBounds Bounds of drawing (optional). Used for limiting `textBlock`\n * @returns\n */\nexport const makeHelper = (\n  ctxOrCanvasEl: CanvasCtxQuery,\n  canvasBounds?: Rects.Rect\n) => {\n  // TODO: Is there a way of automagically defining makeHelper to avoid repetition and keep typesafety and JSDoc?\n  const ctx = getContext(ctxOrCanvasEl);\n  return {\n    paths(pathsToDraw: Paths.Path[], opts?: DrawingOpts): void {\n      paths(ctx, pathsToDraw, opts);\n    },\n    line(lineToDraw: Lines.Line | Lines.Line[], opts?: DrawingOpts): void {\n      line(ctx, lineToDraw, opts);\n    },\n    rect(\n      rectsToDraw: Rects.RectPositioned | Rects.RectPositioned[],\n      opts?: DrawingOpts & { filled?: boolean }\n    ): void {\n      rect(ctx, rectsToDraw, opts);\n    },\n    bezier(\n      bezierToDraw: Beziers.QuadraticBezier | Beziers.CubicBezier,\n      opts?: DrawingOpts\n    ): void {\n      bezier(ctx, bezierToDraw, opts);\n    },\n    connectedPoints(\n      pointsToDraw: Points.Point[],\n      opts?: DrawingOpts & { loop?: boolean }\n    ): void {\n      connectedPoints(ctx, pointsToDraw, opts);\n    },\n    pointLabels(pointsToDraw: Points.Point[], opts?: DrawingOpts): void {\n      pointLabels(ctx, pointsToDraw, opts);\n    },\n    dot(\n      dotPosition: Points.Point | Points.Point[],\n      opts?: DrawingOpts & {\n        radius: number;\n        outlined?: boolean;\n        filled?: boolean;\n      }\n    ): void {\n      dot(ctx, dotPosition, opts);\n    },\n    circle(\n      circlesToDraw: Circles.CirclePositioned | Circles.CirclePositioned[],\n      opts: DrawingOpts\n    ): void {\n      circle(ctx, circlesToDraw, opts);\n    },\n    arc(\n      arcsToDraw: Arcs.ArcPositioned | Arcs.ArcPositioned[],\n      opts: DrawingOpts\n    ): void {\n      arc(ctx, arcsToDraw, opts);\n    },\n    textBlock(\n      lines: string[],\n      opts: DrawingOpts & {\n        anchor: Points.Point;\n        anchorPadding?: number;\n        bounds?: Rects.RectPositioned;\n      }\n    ): void {\n      if (opts.bounds === undefined && canvasBounds !== undefined) {\n        opts = { ...opts, bounds: { ...canvasBounds, x: 0, y: 0 } };\n      }\n      textBlock(ctx, lines, opts);\n    },\n  };\n};\n\n/**\n * Drawing options\n */\nexport type DrawingOpts = {\n  /**\n   * Stroke style\n   */\n  readonly strokeStyle?: string;\n  /**\n   * Fill style\n   */\n  readonly fillStyle?: string;\n  /**\n   * If true, diagnostic helpers will be drawn\n   */\n  readonly debug?: boolean;\n};\n\nexport type LineOpts = {\n  readonly lineWidth?: number;\n  readonly lineCap?: CanvasLineCap;\n  readonly lineJoin?: CanvasLineJoin;\n};\n\n/**\n * Creates a drawing op to apply provided options\n * @param opts Drawing options that apply\n * @returns Stack\n */\nconst optsOp = (opts: DrawingOpts): StackOp =>\n  coloringOp(opts.strokeStyle, opts.fillStyle);\n\n/**\n * Applies drawing options to `ctx`, returning a {@link DrawingStack}\n * @param ctx Context\n * @param opts Options\n * @returns\n */\nconst applyOpts = (\n  ctx: CanvasRenderingContext2D,\n  opts: DrawingOpts = {},\n  ...additionalOps: readonly StackOp[]\n): DrawingStack => {\n  if (ctx === undefined) throw Error(`ctx undefined`);\n\n  // Create a drawing stack, pushing an op generated from drawing options\n  //eslint-disable-next-line functional/immutable-data\n  const stack = drawingStack(ctx).push(optsOp(opts), ...additionalOps);\n\n  // Apply stack to context\n  stack.apply();\n  return stack;\n};\n\n/**\n * Draws one or more arcs.\n * @param ctx\n * @param arcs\n * @param opts\n */\nexport const arc = (\n  ctx: CanvasRenderingContext2D,\n  arcs: Arcs.ArcPositioned | ReadonlyArray<Arcs.ArcPositioned>,\n  opts: DrawingOpts = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const draw = (arc: Arcs.ArcPositioned) => {\n    ctx.beginPath();\n    ctx.arc(arc.x, arc.y, arc.radius, arc.startRadian, arc.endRadian);\n    ctx.stroke();\n  };\n\n  if (Array.isArray(arcs)) {\n    arcs.forEach(draw);\n  } else draw(arcs as Arcs.ArcPositioned);\n};\n\n/**\n * A drawing stack operation\n */\nexport type StackOp = (ctx: CanvasRenderingContext2D) => void;\n\n/**\n * A drawing stack (immutable)\n */\nexport type DrawingStack = {\n  /**\n   * Push a new drawing op\n   * @param op Operation to add\n   * @returns stack with added op\n   */\n  push(...ops: readonly StackOp[]): DrawingStack;\n  /**\n   * Pops an operatiomn\n   * @returns Drawing stack with item popped\n   */\n  pop(): DrawingStack;\n  /**\n   * Applies drawing stack\n   */\n  apply(): DrawingStack;\n};\n\n/**\n * Colouring drawing op. Applies `fillStyle` and `strokeStyle`\n * @param strokeStyle\n * @param fillStyle\n * @returns\n */\nconst coloringOp = (\n  strokeStyle: string | CanvasGradient | CanvasPattern | undefined,\n  fillStyle: string | CanvasGradient | CanvasPattern | undefined\n): StackOp => {\n  const apply = (ctx: CanvasRenderingContext2D) => {\n    // eslint-disable-next-line functional/immutable-data\n    if (fillStyle) ctx.fillStyle = fillStyle;\n    // eslint-disable-next-line functional/immutable-data\n    if (strokeStyle) ctx.strokeStyle = strokeStyle;\n  };\n  return apply;\n};\n\nconst lineOp = (\n  lineWidth: number | undefined,\n  lineJoin: CanvasLineJoin | undefined,\n  lineCap: CanvasLineCap | undefined\n): StackOp => {\n  const apply = (ctx: CanvasRenderingContext2D) => {\n    // eslint-disable-next-line functional/immutable-data\n    if (lineWidth) ctx.lineWidth = lineWidth;\n    // eslint-disable-next-line functional/immutable-data\n    if (lineJoin) ctx.lineJoin = lineJoin;\n    // eslint-disable-next-line functional/immutable-data\n    if (lineCap) ctx.lineCap = lineCap;\n  };\n  return apply;\n};\n\n/**\n * Creates and returns an immutable drawing stack for a context\n * @param ctx Context\n * @param stk Initial stack operations\n * @returns\n */\nexport const drawingStack = (\n  ctx: CanvasRenderingContext2D,\n  stk?: IStackImmutable<StackOp>\n): DrawingStack => {\n  if (stk === undefined) stk = new StackImmutable<StackOp>();\n\n  const push = (...ops: StackOp[]): DrawingStack => {\n    if (stk === undefined) stk = new StackImmutable<StackOp>();\n    //eslint-disable-next-line functional/immutable-data\n    const s = stk.push(...ops);\n    ops.forEach((o) => o(ctx));\n    return drawingStack(ctx, s);\n  };\n\n  const pop = (): DrawingStack => {\n    //eslint-disable-next-line functional/immutable-data\n    const s = stk?.pop();\n    return drawingStack(ctx, s);\n  };\n\n  const apply = (): DrawingStack => {\n    if (stk === undefined) return drawingStack(ctx);\n    stk.forEach((op) => op(ctx));\n    return drawingStack(ctx, stk);\n  };\n\n  return { push, pop, apply };\n};\n\nexport const lineThroughPoints = (\n  ctx: CanvasRenderingContext2D,\n  points: readonly Points.Point[],\n  opts?: DrawingOpts\n): void => {\n  applyOpts(ctx, opts);\n\n  // https://stackoverflow.com/questions/7054272/how-to-draw-smooth-curve-through-n-points-using-javascript-html5-canvas\n  ctx.moveTo(points[ 0 ].x, points[ 0 ].y);\n\n  points.forEach((p, index) => {\n    if (index + 2 >= points.length) return;\n    const pNext = points[ index + 1 ];\n    const mid = {\n      x: (p.x + pNext.x) / 2,\n      y: (p.y + pNext.y) / 2,\n    };\n    const cpX1 = (mid.x + p.x) / 2;\n    const cpX2 = (mid.x + pNext.x) / 2;\n    ctx.quadraticCurveTo(cpX1, pNext.y, mid.x, mid.y);\n    ctx.quadraticCurveTo(cpX2, pNext.y, pNext.x, pNext.y);\n  });\n};\n\n/**\n * Draws one or more circles. Will draw outline/fill depending on\n * whether `strokeStyle` or `fillStyle` params are present in the drawing options.\n *\n * ```js\n * // Draw a circle with radius of 10 at 0,0\n * circle(ctx, {radius:10});\n *\n * // Draw a circle of radius 10 at 100,100\n * circle(ctx, {radius: 10, x: 100, y: 100});\n *\n * // Draw two blue outlined circles\n * circle(ctx, [ {radius: 5}, {radius: 10} ], {strokeStyle:`blue`});\n * ```\n * @param ctx Drawing context\n * @param circlesToDraw Circle(s) to draw\n * @param opts Drawing options\n */\nexport const circle = (\n  ctx: CanvasRenderingContext2D,\n  circlesToDraw: Circles.CirclePositioned | readonly Circles.CirclePositioned[],\n  opts: DrawingOpts = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const draw = (c: Circles.CirclePositioned) => {\n    ctx.beginPath();\n    ctx.arc(c.x, c.y, c.radius, 0, PIPI);\n    if (opts.strokeStyle) ctx.stroke();\n    //eslint-disable-next-line functional/immutable-data\n    if (opts.fillStyle) ctx.fill();\n  };\n  if (Array.isArray(circlesToDraw)) circlesToDraw.forEach(draw);\n  else draw(circlesToDraw as Circles.CirclePositioned);\n};\n\n/**\n * Draws one or more ellipses. Will draw outline/fill depending on\n * whether `strokeStyle` or `fillStyle` params are present in the drawing options.\n * @param ctx\n * @param ellipsesToDraw\n * @param opts\n */\nexport const ellipse = (\n  ctx: CanvasRenderingContext2D,\n  ellipsesToDraw:\n    | Ellipses.EllipsePositioned\n    | readonly Ellipses.EllipsePositioned[],\n  opts: DrawingOpts = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const draw = (e: Ellipses.EllipsePositioned) => {\n    ctx.beginPath();\n    const rotation = e.rotation ?? 0;\n    const startAngle = e.startAngle ?? 0;\n    const endAngle = e.endAngle ?? PIPI;\n    ctx.ellipse(e.x, e.y, e.radiusX, e.radiusY, rotation, startAngle, endAngle);\n    if (opts.strokeStyle) ctx.stroke();\n    //eslint-disable-next-line functional/immutable-data\n    if (opts.fillStyle) ctx.fill();\n  };\n  if (Array.isArray(ellipsesToDraw)) ellipsesToDraw.forEach(draw);\n  else draw(ellipsesToDraw as Ellipses.EllipsePositioned);\n};\n\n/**\n * Draws one or more paths.\n * supported paths are quadratic beziers and lines.\n * @param ctx\n * @param pathsToDraw\n * @param opts\n */\nexport const paths = (\n  ctx: CanvasRenderingContext2D,\n  pathsToDraw: readonly Paths.Path[] | Paths.Path,\n  opts: { readonly strokeStyle?: string; readonly debug?: boolean } = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const draw = (path: Paths.Path) => {\n    // Call appropriate drawing function depending on the type of path\n    if (Beziers.isQuadraticBezier(path)) quadraticBezier(ctx, path, opts);\n    else if (Lines.isLine(path)) line(ctx, path, opts);\n    else throw new Error(`Unknown path type ${ JSON.stringify(path) }`);\n  };\n\n  if (Array.isArray(pathsToDraw)) pathsToDraw.forEach(draw);\n  else draw(pathsToDraw as Paths.Path);\n};\n\n/**\n * Draws a line between all the given points.\n * If a fillStyle is specified, it will be filled.\n *\n * See also:\n * * {@link line}: Draw one or more lines\n *\n * @param ctx\n * @param pts\n */\nexport const connectedPoints = (\n  ctx: CanvasRenderingContext2D,\n  pts: readonly Points.Point[],\n  opts: {\n    readonly loop?: boolean;\n    readonly fillStyle?: string;\n    readonly strokeStyle?: string;\n  } = {}\n) => {\n  const shouldLoop = opts.loop ?? false;\n\n  throwArrayTest(pts);\n  if (pts.length === 0) return;\n\n  // Throw an error if any point is invalid\n  pts.forEach((pt, i) => Points.guard(pt, `Index ${ i }`));\n\n  applyOpts(ctx, opts);\n\n  // Draw points\n  ctx.beginPath();\n  ctx.moveTo(pts[ 0 ].x, pts[ 0 ].y);\n  pts.forEach((pt) => ctx.lineTo(pt.x, pt.y));\n\n  if (shouldLoop) ctx.lineTo(pts[ 0 ].x, pts[ 0 ].y);\n\n  // if (opts.strokeStyle) ctx.strokeStyle = opts.strokeStyle;\n  if (\n    opts.strokeStyle ||\n    (opts.strokeStyle === undefined && opts.fillStyle === undefined)\n  ) {\n    ctx.stroke();\n  }\n  if (opts.fillStyle) {\n    //eslint-disable-next-line functional/immutable-data\n    ctx.fill();\n  }\n};\n\n/**\n * Draws labels for a set of points\n * @param ctx\n * @param pts Points to draw\n * @param opts\n * @param labels Labels for points\n */\nexport const pointLabels = (\n  ctx: CanvasRenderingContext2D,\n  pts: readonly Points.Point[],\n  opts: { readonly fillStyle?: string } = {},\n  labels?: readonly string[]\n) => {\n  if (pts.length === 0) return;\n\n  // Throw an error if any point is invalid\n  pts.forEach((pt, i) => Points.guard(pt, `Index ${ i }`));\n\n  applyOpts(ctx, opts);\n\n  pts.forEach((pt, i) => {\n    const label =\n      labels !== undefined && i < labels.length ? labels[ i ] : i.toString();\n    ctx.fillText(label.toString(), pt.x, pt.y);\n  });\n};\n\n/**\n * Returns `point` with the canvas's translation matrix applied\n * @param ctx\n * @param point\n * @returns\n */\nexport const translatePoint = (\n  ctx: CanvasRenderingContext2D,\n  point: Points.Point\n): Points.Point => {\n  const m = ctx.getTransform();\n  return {\n    x: point.x * m.a + point.y * m.c + m.e,\n    y: point.x * m.b + point.y * m.d + m.f,\n  };\n};\n\n/**\n * Creates a new HTML IMG element with a snapshot of the\n * canvas. Element will need to be inserted into the document.\n *\n * ```\n * const myCanvas = document.getElementById('someCanvas');\n * const el = copyToImg(myCanvas);\n * document.getElementById('images').appendChild(el);\n * ```\n * @param canvasEl\n * @returns\n */\nexport const copyToImg = (canvasEl: HTMLCanvasElement): HTMLImageElement => {\n  const img = document.createElement(`img`);\n  //eslint-disable-next-line functional/immutable-data\n  img.src = canvasEl.toDataURL(`image/jpeg`);\n  return img;\n};\n\n/**\n * Draws filled circle(s) at provided point(s)\n * @param ctx\n * @param pos\n * @param opts\n */\nexport const dot = (\n  ctx: CanvasRenderingContext2D,\n  pos: Points.Point | readonly Points.Point[],\n  opts?: DrawingOpts & {\n    readonly radius?: number;\n    readonly outlined?: boolean;\n    readonly filled?: boolean;\n  }\n) => {\n  if (opts === undefined) opts = {};\n  const radius = opts.radius ?? 10;\n\n  applyOpts(ctx, opts);\n\n  ctx.beginPath();\n\n  // x&y for arc is the center of circle\n  if (Array.isArray(pos)) {\n    pos.forEach((p) => {\n      ctx.arc(p.x, p.y, radius, 0, 2 * Math.PI);\n    });\n  } else {\n    const p = pos as Points.Point;\n    ctx.arc(p.x, p.y, radius, 0, 2 * Math.PI);\n  }\n\n  //eslint-disable-next-line functional/immutable-data\n  if (opts.filled || !opts.outlined) ctx.fill();\n  if (opts.outlined) ctx.stroke();\n};\n\n/**\n * Draws a cubic or quadratic bezier\n * @param ctx\n * @param bezierToDraw\n * @param opts\n */\nexport const bezier = (\n  ctx: CanvasRenderingContext2D,\n  bezierToDraw: Beziers.QuadraticBezier | Beziers.CubicBezier,\n  opts?: DrawingOpts\n) => {\n  if (Beziers.isQuadraticBezier(bezierToDraw)) {\n    quadraticBezier(ctx, bezierToDraw, opts);\n  } else if (Beziers.isCubicBezier(bezierToDraw)) {\n    cubicBezier(ctx, bezierToDraw, opts);\n  }\n};\n\nconst cubicBezier = (\n  ctx: CanvasRenderingContext2D,\n  bezierToDraw: Beziers.CubicBezier,\n  opts: DrawingOpts = {}\n) => {\n  // eslint-disable-next-line functional/no-let\n  let stack = applyOpts(ctx, opts);\n\n  const { a, b, cubic1, cubic2 } = bezierToDraw;\n  const isDebug = opts.debug ?? false;\n\n  if (isDebug) {\n    /*\n     * const ss = ctx.strokeStyle;\n     * ctx.strokeStyle = ss;\n     */\n  }\n  ctx.beginPath();\n  ctx.moveTo(a.x, a.y);\n  ctx.bezierCurveTo(cubic1.x, cubic1.y, cubic2.x, cubic2.y, b.x, b.y);\n  ctx.stroke();\n\n  if (isDebug) {\n    //eslint-disable-next-line functional/immutable-data\n    stack = stack.push(\n      optsOp({\n        ...opts,\n        strokeStyle: Colours.opacity(opts.strokeStyle ?? `silver`, 0.6),\n        fillStyle: Colours.opacity(opts.fillStyle ?? `yellow`, 0.4),\n      })\n    );\n\n    stack.apply();\n    ctx.moveTo(a.x, a.y);\n    ctx.lineTo(cubic1.x, cubic1.y);\n    ctx.stroke();\n    ctx.moveTo(b.x, b.y);\n    ctx.lineTo(cubic2.x, cubic2.y);\n    ctx.stroke();\n\n    ctx.fillText(`a`, a.x + 5, a.y);\n    ctx.fillText(`b`, b.x + 5, b.y);\n    ctx.fillText(`c1`, cubic1.x + 5, cubic1.y);\n    ctx.fillText(`c2`, cubic2.x + 5, cubic2.y);\n\n    dot(ctx, cubic1, { radius: 3 });\n    dot(ctx, cubic2, { radius: 3 });\n    dot(ctx, a, { radius: 3 });\n    dot(ctx, b, { radius: 3 });\n    //eslint-disable-next-line functional/immutable-data\n    stack = stack.pop();\n    stack.apply();\n  }\n};\n\nconst quadraticBezier = (\n  ctx: CanvasRenderingContext2D,\n  bezierToDraw: Beziers.QuadraticBezier,\n  opts: DrawingOpts = {}\n) => {\n  const { a, b, quadratic } = bezierToDraw;\n  const isDebug = opts.debug ?? false;\n  // eslint-disable-next-line functional/no-let\n  let stack = applyOpts(ctx, opts);\n\n  ctx.beginPath();\n  ctx.moveTo(a.x, a.y);\n  ctx.quadraticCurveTo(quadratic.x, quadratic.y, b.x, b.y);\n  ctx.stroke();\n\n  if (isDebug) {\n    /*\n     * const fs = ctx.fillStyle;\n     * const ss = ctx.strokeStyle;\n     * ctx.fillStyle = opts.strokeStyle ?? `gray`;\n     * ctx.strokeStyle = opts.strokeStyle ?? `gray`;\n     */\n    //eslint-disable-next-line functional/immutable-data\n    stack = stack.push(\n      optsOp({\n        ...opts,\n        strokeStyle: Colours.opacity(opts.strokeStyle ?? `silver`, 0.6),\n        fillStyle: Colours.opacity(opts.fillStyle ?? `yellow`, 0.4),\n      })\n    );\n    connectedPoints(ctx, [ a, quadratic, b ]);\n\n    ctx.fillText(`a`, a.x + 5, a.y);\n    ctx.fillText(`b`, b.x + 5, b.y);\n    ctx.fillText(`h`, quadratic.x + 5, quadratic.y);\n    dot(ctx, quadratic, { radius: 3 });\n    dot(ctx, a, { radius: 3 });\n    dot(ctx, b, { radius: 3 });\n    /*\n     * ctx.fillStyle = fs;\n     * ctx.strokeStyle = ss;\n     */\n    //eslint-disable-next-line functional/immutable-data\n    stack = stack.pop();\n    stack.apply();\n  }\n};\n\n/**\n * Draws one or more lines.\n *\n * Each line is drawn independently, ie it's not assumed lines are connected.\n *\n * See also:\n * * {@link connectedPoints}: Draw a series of connected points\n * @param ctx\n * @param toDraw\n * @param opts\n */\nexport const line = (\n  ctx: CanvasRenderingContext2D,\n  toDraw: Lines.Line | readonly Lines.Line[],\n  opts: LineOpts & DrawingOpts = {}\n) => {\n  const isDebug = opts.debug ?? false;\n  const o = lineOp(opts.lineWidth, opts.lineJoin, opts.lineCap);\n  applyOpts(ctx, opts, o);\n\n  const draw = (d: Lines.Line) => {\n    const { a, b } = d;\n    ctx.beginPath();\n    ctx.moveTo(a.x, a.y);\n    ctx.lineTo(b.x, b.y);\n    if (isDebug) {\n      ctx.fillText(`a`, a.x, a.y);\n      ctx.fillText(`b`, b.x, b.y);\n      dot(ctx, a, { radius: 5, strokeStyle: `black` });\n      dot(ctx, b, { radius: 5, strokeStyle: `black` });\n    }\n    ctx.stroke();\n  };\n\n  if (Array.isArray(toDraw)) toDraw.forEach(draw);\n  else draw(toDraw as Lines.Line);\n};\n\n/**\n * Draws one or more triangles\n * @param ctx\n * @param toDraw\n * @param opts\n */\nexport const triangle = (\n  ctx: CanvasRenderingContext2D,\n  toDraw: Triangles.Triangle | readonly Triangles.Triangle[],\n  opts: DrawingOpts & { readonly filled?: boolean } = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const draw = (t: Triangles.Triangle) => {\n    connectedPoints(ctx, Triangles.corners(t), { ...opts, loop: true });\n\n    if (opts.debug) {\n      pointLabels(ctx, Triangles.corners(t), undefined, [ `a`, `b`, `c` ]);\n    }\n  };\n\n  if (Array.isArray(toDraw)) toDraw.forEach(draw);\n  else draw(toDraw as Triangles.Triangle);\n};\n\n// export const arrowFromTip = (ctx:CanvasRenderingContext2D, tipPos: Points.Point, tailLength:number, opts:DrawingOpts) => {\n//   if (opts.fillStyle) ctx.fillStyle = opts.fillStyle;\n//   if (opts.strokeStyle) ctx.strokeStyle = opts.strokeStyle;\n\n//   ctx.save();\n//   ctx.translate\n//   ctx.restore();\n// }\n\n/**\n * Draws one or more rectangles\n * @param ctx\n * @param toDraw\n * @param opts\n */\nexport const rect = (\n  ctx: CanvasRenderingContext2D,\n  toDraw: Rects.RectPositioned | readonly Rects.RectPositioned[],\n  opts: DrawingOpts & {\n    readonly filled?: boolean;\n    readonly stroked?: boolean;\n  } = {}\n) => {\n  applyOpts(ctx, opts);\n\n  const draw = (d: Rects.RectPositioned) => {\n    if (opts.filled) ctx.fillRect(d.x, d.y, d.width, d.height);\n    if (opts.stroked ?? true) ctx.strokeRect(d.x, d.y, d.width, d.height);\n\n    if (opts.debug) {\n      pointLabels(ctx, Rects.corners(d), undefined, [ `NW`, `NE`, `SE`, `SW` ]);\n    }\n  };\n\n  if (Array.isArray(toDraw)) toDraw.forEach(draw);\n  else draw(toDraw as Rects.RectPositioned);\n};\n\n/**\n * Returns the width of `text`. Rounds number up to nearest multiple if provided. If\n * text is empty or undefined, 0 is returned.\n * @param ctx\n * @param text\n * @param widthMultiple\n * @returns\n */\nexport const textWidth = (\n  ctx: CanvasRenderingContext2D,\n  text?: string | null,\n  padding = 0,\n  widthMultiple?: number\n): number => {\n  // if (text === undefined || text === null || text.length === 0) return 0;\n  // const m = ctx.measureText(text);\n  // if (widthMultiple) return roundUpToMultiple(m.width, widthMultiple) + padding;\n  // return m.width + padding;\n  const rect = textRect(ctx, text, padding, widthMultiple);\n  return rect.width;\n};\n\nexport const textRect = (ctx: CanvasRenderingContext2D,\n  text?: string | null,\n  padding = 0, widthMultiple?: number): Rects.Rect => {\n  if (text === undefined || text === null || text.length === 0) return Rects.empty;\n  const m = ctx.measureText(text);\n\n  const width = (widthMultiple) ? roundUpToMultiple(m.width, widthMultiple) + padding : m.width + padding;\n\n  return {\n    width: width,\n    height: m.actualBoundingBoxAscent + m.actualBoundingBoxDescent + padding + padding\n  }\n}\n\nexport const textHeight = (\n  ctx: CanvasRenderingContext2D,\n  text?: string | null,\n  padding = 0): number => {\n  const rect = textRect(ctx, text, padding);\n  return rect.height;\n  // if (text === undefined || text === null || text.length === 0) return 0;\n  // const m = ctx.measureText(text);\n  // return m.actualBoundingBoxAscent + m.actualBoundingBoxDescent + padding + padding;\n}\n\n\n/**\n * Draws a block of text. Each array item is considered a line.\n * @param ctx\n * @param lines\n * @param opts\n */\nexport const textBlock = (\n  ctx: CanvasRenderingContext2D,\n  lines: readonly string[],\n  opts: DrawingOpts & {\n    readonly anchor: Points.Point;\n    readonly anchorPadding?: number;\n    readonly bounds?: Rects.RectPositioned;\n  }\n) => {\n  applyOpts(ctx, opts);\n  const anchorPadding = opts.anchorPadding ?? 0;\n\n  const anchor = opts.anchor;\n  const bounds = opts.bounds ?? { x: 0, y: 0, width: 1000000, height: 1000000 };\n\n  // Measure each line\n  //eslint-disable-next-line functional/prefer-tacit\n  const blocks = lines.map((l) => ctx.measureText(l));\n\n  // Get width and height\n  const widths = blocks.map((tm) => tm.width);\n  const heights = blocks.map(\n    (tm) => tm.actualBoundingBoxAscent + tm.actualBoundingBoxDescent\n  );\n\n  // Find extremes\n  const maxWidth = Math.max(...widths);\n  const totalHeight = heights.reduce((acc, val) => acc + val, 0);\n\n  // eslint-disable-next-line functional/no-let\n  let { x, y } = anchor;\n\n  if (anchor.x + maxWidth > bounds.width) {\n    x = bounds.width - (maxWidth + anchorPadding);\n  } else x -= anchorPadding;\n\n  if (x < bounds.x) x = bounds.x + anchorPadding;\n\n  if (anchor.y + totalHeight > bounds.height) {\n    y = bounds.height - (totalHeight + anchorPadding);\n  } else y -= anchorPadding;\n\n  if (y < bounds.y) y = bounds.y + anchorPadding;\n\n  lines.forEach((line, i) => {\n    ctx.fillText(line, x, y);\n    y += heights[ i ];\n  });\n};\n\nexport type HorizAlign = `left` | `right` | `center`;\nexport type VertAlign = `top` | `center` | `bottom`;\n\n/**\n * Draws an aligned text block\n */\nexport const textBlockAligned = (\n  ctx: CanvasRenderingContext2D,\n  text: readonly string[] | string,\n  opts: DrawingOpts & {\n    readonly bounds: Rects.RectPositioned;\n    readonly horiz?: HorizAlign;\n    readonly vert?: VertAlign;\n  }\n) => {\n  const { bounds } = opts;\n  const { horiz = `left`, vert = `top` } = opts;\n\n  //eslint-disable-next-line functional/no-let\n  let lines: readonly string[];\n  if (typeof text === `string`) lines = [ text ];\n  else lines = text;\n\n  applyOpts(ctx, opts);\n\n  ctx.save();\n  ctx.translate(bounds.x, bounds.y);\n  //eslint-disable-next-line functional/immutable-data\n  ctx.textAlign = `left`;\n  //eslint-disable-next-line functional/immutable-data\n  ctx.textBaseline = `top`;\n  const middleX = bounds.width / 2;\n  const middleY = bounds.height / 2;\n\n  // Measure each line\n  //eslint-disable-next-line functional/prefer-tacit\n  const blocks = lines.map((l) => ctx.measureText(l));\n  const heights = blocks.map(\n    (tm) => tm.actualBoundingBoxAscent + tm.actualBoundingBoxDescent\n  );\n  const totalHeight = heights.reduce((acc, val) => acc + val, 0);\n\n  //eslint-disable-next-line functional/no-let\n  let y = 0;\n  if (vert === `center`) y = middleY - totalHeight / 2;\n  else if (vert === `bottom`) {\n    y = bounds.height - totalHeight;\n  }\n\n  lines.forEach((line, i) => {\n    //eslint-disable-next-line functional/no-let\n    let x = 0;\n    if (horiz === `center`) x = middleX - blocks[ i ].width / 2;\n    else if (horiz === `right`) x = bounds.width - blocks[ i ].width;\n    ctx.fillText(lines[ i ], x, y);\n    y += heights[ i ];\n  });\n\n  ctx.restore();\n};\n","import { Lines, radianToDegree, Polar, Circles, Rects } from './index.js';\nimport * as Points from './Point.js';\n\nimport { throwNumberTest } from '../Guards.js';\n\n/**\n * Functions for working with equilateral triangles, defined by length\n */\nexport * as Equilateral from './TriangleEquilateral.js';\n\n/**\n * Functions for working with right-angled triangles, defined by two of three edges\n */\nexport * as Right from './TriangleRight.js';\n\nexport * as Isosceles from './TriangleIsosceles.js';\n\nconst piPi = Math.PI * 2;\n\n/**\n * Triangle.\n *\n * Helpers for creating:\n *  - {@link fromFlatArray}: Create from [x1, y1, x2, y2, x3, y3]\n *  - {@link fromPoints}: Create from three `{x,y}` sets\n *  - {@link fromRadius}: Equilateral triangle of a given radius and center\n */\nexport type Triangle = {\n  readonly a: Points.Point;\n  readonly b: Points.Point;\n  readonly c: Points.Point;\n};\n\n/**\n * A triangle consisting of three empty points (Points.Empty)\n */\n//eslint-disable-next-line @typescript-eslint/naming-convention\nexport const Empty = Object.freeze({\n  a: { x: 0, y: 0 },\n  b: { x: 0, y: 0 },\n  c: { x: 0, y: 0 },\n});\n\n/**\n * A triangle consisting of three placeholder points (Points.Placeholder)\n */\n//eslint-disable-next-line @typescript-eslint/naming-convention\nexport const Placeholder = Object.freeze({\n  a: { x: NaN, y: NaN },\n  b: { x: NaN, y: NaN },\n  c: { x: NaN, y: NaN },\n});\n\n/**\n * Returns true if triangle is empty\n * @param t\n * @returns\n */\nexport const isEmpty = (t: Triangle): boolean =>\n  Points.isEmpty(t.a) && Points.isEmpty(t.b) && Points.isEmpty(t.c);\n\n/**\n * Returns true if triangle is a placeholder\n * @param t\n * @returns\n */\nexport const isPlaceholder = (t: Triangle): boolean =>\n  Points.isPlaceholder(t.a) &&\n  Points.isPlaceholder(t.b) &&\n  Points.isPlaceholder(t.c);\n\n/**\n * Applies `fn` to each of a triangle's corner points, returning the result.\n *\n * @example Add some random to the x of each corner\n * ```\n * const t = apply(tri, p => {\n *  const r = 10;\n *  return {\n *    x: p.x + (Math.random()*r*2) - r,\n *    y: p.y\n *  }\n * });\n * ```\n * @param t\n * @param fn\n * @returns\n */\nexport const apply = (\n  t: Triangle,\n  fn: (p: Points.Point, label?: string) => Points.Point\n) =>\n  Object.freeze<Triangle>({\n    ...t,\n    a: fn(t.a, `a`),\n    b: fn(t.b, `b`),\n    c: fn(t.c, `c`),\n  });\n\n/**\n * Throws an exception if the triangle is invalid\n * @param t\n * @param name\n */\nexport const guard = (t: Triangle, name: string = `t`) => {\n  if (t === undefined) throw Error(`{$name} undefined`);\n  Points.guard(t.a, name + `.a`);\n  Points.guard(t.b, name + `.b`);\n  Points.guard(t.c, name + `.c`);\n};\n\n/**\n * Returns true if the parameter appears to be a valid triangle\n * @param p\n * @returns\n */\nexport const isTriangle = (p: number | unknown): p is Triangle => {\n  if (p === undefined) return false;\n  const tri = p as Triangle;\n  if (!Points.isPoint(tri.a)) return false;\n  if (!Points.isPoint(tri.b)) return false;\n  if (!Points.isPoint(tri.c)) return false;\n  return true;\n};\n\n/**\n * Returns true if the two parameters have equal values\n * @param a\n * @param b\n * @returns\n */\nexport const isEqual = (a: Triangle, b: Triangle): boolean =>\n  Points.isEqual(a.a, b.a) &&\n  Points.isEqual(a.b, b.b) &&\n  Points.isEqual(a.c, b.c);\n\n/**\n * Returns the corners (vertices) of the triangle as an array of points\n * @param t\n * @returns Array of length three\n */\nexport const corners = (t: Triangle): readonly Points.Point[] => {\n  guard(t);\n  return [ t.a, t.b, t.c ];\n};\n\n/**\n * Returns the edges (ie sides) of the triangle as an array of lines\n * @param t\n * @returns Array of length three\n */\nexport const edges = (t: Triangle): Lines.PolyLine => {\n  guard(t);\n  return Lines.joinPointsToLines(t.a, t.b, t.c, t.a);\n};\n\n/**\n * Returns the lengths of the triangle sides\n * @param t\n * @returns Array of length three\n */\nexport const lengths = (t: Triangle): readonly number[] => {\n  guard(t);\n  return [\n    Points.distance(t.a, t.b),\n    Points.distance(t.b, t.c),\n    Points.distance(t.c, t.a),\n  ];\n};\n\n/**\n * Return the three interior angles of the triangle, in radians.\n * @param t\n * @returns\n */\nexport const angles = (t: Triangle): readonly number[] => {\n  guard(t);\n  return [\n    Points.angle(t.a, t.b),\n    Points.angle(t.b, t.c),\n    Points.angle(t.c, t.a),\n  ];\n};\n\n/**\n * Returns the three interior angles of the triangle, in degrees\n * @param t\n * @returns\n */\nexport const anglesDegrees = (t: Triangle): readonly number[] => {\n  guard(t);\n  return radianToDegree(angles(t));\n};\n\n/**\n * Returns true if it is an equilateral triangle\n * @param t\n * @returns\n */\nexport const isEquilateral = (t: Triangle): boolean => {\n  guard(t);\n  const [ a, b, c ] = lengths(t);\n  return a === b && b === c;\n};\n\n/**\n * Returns true if it is an isosceles triangle\n * @param t\n * @returns\n */\nexport const isIsosceles = (t: Triangle): boolean => {\n  const [ a, b, c ] = lengths(t);\n  if (a === b) return true;\n  if (b === c) return true;\n  if (c === a) return true;\n  return false;\n};\n\n/**\n * Returns true if at least one interior angle is 90 degrees\n * @param t\n * @returns\n */\nexport const isRightAngle = (t: Triangle): boolean =>\n  angles(t).some((v) => v === Math.PI / 2);\n\n/**\n * Returns true if triangle is oblique: No interior angle is 90 degrees\n * @param t\n * @returns\n */\nexport const isOblique = (t: Triangle): boolean => !isRightAngle(t);\n\n/**\n * Returns true if triangle is actue: all interior angles less than 90 degrees\n * @param t\n * @returns\n */\nexport const isAcute = (t: Triangle): boolean =>\n  !angles(t).some((v) => v >= Math.PI / 2);\n\n/**\n * Returns true if triangle is obtuse: at least one interior angle is greater than 90 degrees\n * @param t\n * @returns\n */\nexport const isObtuse = (t: Triangle): boolean =>\n  angles(t).some((v) => v > Math.PI / 2);\n\n/**\n * Returns simple centroid of triangle\n * @param t\n * @returns\n */\nexport const centroid = (t: Triangle): Points.Point => {\n  guard(t);\n  const total = Points.reduce(\n    [ t.a, t.b, t.c ],\n    (p: Points.Point, acc: Points.Point) => ({\n      x: p.x + acc.x,\n      y: p.y + acc.y,\n    })\n  );\n  const div = {\n    x: total.x / 3,\n    y: total.y / 3,\n  };\n  return div;\n};\n\n/**\n * Calculates perimeter of a triangle\n * @param t\n * @returns\n */\nexport const perimeter = (t: Triangle): number => {\n  guard(t);\n  return edges(t).reduce<number>((acc, v) => acc + Lines.length(v), 0);\n};\n\n/**\n * Calculates the area of a triangle\n * @param t\n * @returns\n */\nexport const area = (t: Triangle): number => {\n  guard(t, `t`);\n\n  // Get length of edges\n  const e = edges(t).map((l) => Lines.length(l));\n\n  // Add up length of edges, halve\n  const p = (e[ 0 ] + e[ 1 ] + e[ 2 ]) / 2;\n  return Math.sqrt(p * (p - e[ 0 ]) * (p - e[ 1 ]) * (p - e[ 2 ]));\n};\n\n/**\n * Returns the largest circle enclosed by triangle `t`.\n * @param t\n */\nexport const innerCircle = (t: Triangle): Circles.CirclePositioned => {\n  const c = centroid(t);\n  const p = perimeter(t) / 2;\n  const a = area(t);\n  const radius = a / p;\n  return { radius, ...c };\n};\n\n/**\n * Returns the largest circle touching the corners of triangle `t`.\n * @param t\n * @returns\n */\nexport const outerCircle = (t: Triangle): Circles.CirclePositioned => {\n  const [ a, b, c ] = edges(t).map((l) => Lines.length(l));\n  const cent = centroid(t);\n  const radius =\n    (a * b * c) /\n    Math.sqrt((a + b + c) * (-a + b + c) * (a - b + c) * (a + b - c));\n  return {\n    radius,\n    ...cent,\n  };\n};\n\n/**\n * Returns an equilateral triangle centered at the origin.\n *\n * ```js\n * // Create a triangle at 100,100 with radius of 60\n * const tri = fromRadius({x:100,y:100}, 60);\n *\n * // Triangle with point A upwards, B to the right, C to the left\n * constr tri2 = fromRadius({x:100,y:100}, 60, {initialAngleRadian: -Math.PI / 2});\n * ```\n *\n *\n * @param origin\n * @param length\n */\nexport const fromRadius = (\n  origin: Points.Point,\n  radius: number,\n  opts: { readonly initialAngleRadian?: number } = {}\n): Triangle => {\n  throwNumberTest(radius, `positive`, `radius`);\n  Points.guard(origin, `origin`);\n\n  const initialAngleRadian = opts.initialAngleRadian ?? 0;\n\n  const angles = [\n    initialAngleRadian,\n    initialAngleRadian + (piPi * 1) / 3,\n    initialAngleRadian + (piPi * 2) / 3,\n  ];\n  const points = angles.map((a) => Polar.toCartesian(radius, a, origin));\n  return fromPoints(points);\n};\n\n/**\n * Rotates the vertices of the triangle around one point (by default, `b`).\n * @param triangle Triangle\n * @param vertex Name of vertex: a, b or c.\n */\nexport const rotateByVertex = (\n  triangle: Triangle,\n  amountRadian: number,\n  vertex: `a` | `b` | `c` = `b`\n): Triangle => {\n  const origin =\n    vertex === `a` ? triangle.a : vertex === `b` ? triangle.b : triangle.c;\n  return Object.freeze({\n    a: Points.rotate(triangle.a, amountRadian, origin),\n    b: Points.rotate(triangle.b, amountRadian, origin),\n    c: Points.rotate(triangle.c, amountRadian, origin),\n  });\n};\n\n/**\n * Returns a triangle anchored at `origin` with a given `length` and `angleRadian`.\n * The origin will be point `b` of the triangle, and the angle will be the angle for b.\n * @param origin Origin\n * @param length Length\n * @param angleRadian Angle\n * @returns\n */\nexport const equilateralFromVertex = (\n  origin: Points.Point = { x: 0, y: 0 },\n  length: number = 10,\n  angleRadian: number = Math.PI / 2\n): Triangle => {\n  const a = Points.project(origin, length, Math.PI - -angleRadian / 2);\n  const c = Points.project(origin, length, Math.PI - angleRadian / 2);\n  return { a, b: origin, c };\n};\n\n/**\n * Returns the coordinates of triangle in a flat array form:\n * [xA, yA, xB, yB, xC, yC]\n * @param t\n * @returns\n */\nexport const toFlatArray = (t: Triangle): readonly number[] => {\n  guard(t);\n  return [ t.a.x, t.a.y, t.b.x, t.b.y, t.c.x, t.c.y ];\n};\n\n/**\n * Returns a triangle from a set of coordinates in a flat array form:\n * [xA, yA, xB, yB, xC, yC]\n * @param coords\n * @returns\n */\nexport const fromFlatArray = (coords: readonly number[]): Triangle => {\n  if (!Array.isArray(coords)) throw new Error(`coords expected as array`);\n  if (coords.length !== 6) {\n    throw new Error(\n      `coords array expected with 6 elements. Got ${ coords.length }`\n    );\n  }\n  return fromPoints(Points.fromNumbers(...coords));\n};\n\n/**\n * Returns a triangle from an array of three points\n * @param points\n * @returns\n */\nexport const fromPoints = (points: readonly Points.Point[]): Triangle => {\n  if (!Array.isArray(points)) throw new Error(`points expected as array`);\n  if (points.length !== 3) {\n    throw new Error(\n      `points array expected with 3 elements. Got ${ points.length }`\n    );\n  }\n  const t: Triangle = {\n    a: points[ 0 ],\n    b: points[ 1 ],\n    c: points[ 2 ],\n  };\n  return t;\n};\n\n/**\n * Returns the bounding box that encloses the triangle.\n * @param t\n * @param inflation If specified, box will be inflated by this much. Default: 0.\n * @returns\n */\nexport const bbox = (t: Triangle, inflation = 0): Rects.RectPositioned => {\n  const { a, b, c } = t;\n  const xMin = Math.min(a.x, b.x, c.x) - inflation;\n  const xMax = Math.max(a.x, b.x, c.x) + inflation;\n  const yMin = Math.min(a.y, b.y, c.y) - inflation;\n  const yMax = Math.max(a.y, b.y, c.y) + inflation;\n\n  const r: Rects.RectPositioned = {\n    x: xMin,\n    y: yMin,\n    width: xMax - xMin,\n    height: yMax - yMin,\n  };\n  return r;\n};\n\nexport type BarycentricCoord = {\n  readonly a: number;\n  readonly b: number;\n  readonly c: number;\n};\n\n/**\n * Returns the [Barycentric coordinate](https://en.wikipedia.org/wiki/Barycentric_coordinate_system) of a point within a triangle\n *\n * @param t\n * @param a\n * @param b\n * @returns\n */\nexport const barycentricCoord = (\n  t: Triangle,\n  a: Points.Point | number,\n  b?: number\n): BarycentricCoord => {\n  const pt = Points.getPointParameter(a, b);\n\n  const ab = (x: number, y: number, pa: Points.Point, pb: Points.Point) =>\n    (pa.y - pb.y) * x + (pb.x - pa.x) * y + pa.x * pb.y - pb.x * pa.y;\n\n  const alpha = ab(pt.x, pt.y, t.b, t.c) / ab(t.a.x, t.a.y, t.b, t.c);\n  const theta = ab(pt.x, pt.y, t.c, t.a) / ab(t.b.x, t.b.y, t.c, t.a);\n  const gamma = ab(pt.x, pt.y, t.a, t.b) / ab(t.c.x, t.c.y, t.a, t.b);\n\n  return {\n    a: alpha,\n    b: theta,\n    c: gamma,\n  };\n};\n\n/**\n * Convert Barycentric coordinate to Cartesian\n * @param t\n * @param bc\n * @returns\n */\nexport const barycentricToCartestian = (\n  t: Triangle,\n  bc: BarycentricCoord\n): Points.Point => {\n  guard(t);\n  const { a, b, c } = t;\n\n  const x = a.x * bc.a + b.x * bc.b + c.x * bc.c;\n  const y = a.y * bc.a + b.y * bc.b + c.y * bc.c;\n\n  if (a.z && b.z && c.z) {\n    const z = a.z * bc.a + b.z * bc.b + c.z * bc.c;\n    return Object.freeze({ x, y, z });\n  } else {\n    return Object.freeze({ x, y });\n  }\n};\n\n/**\n * Returns true if point is within or on the boundary of triangle\n * @param t\n * @param a\n * @param b\n */\nexport const intersectsPoint = (\n  t: Triangle,\n  a: Points.Point | number,\n  b?: number\n): boolean => {\n  const box = bbox(t);\n\n  const pt = Points.getPointParameter(a, b);\n\n  // If it's not in the bounding box, can return false straight away\n  if (!Rects.intersectsPoint(box, pt)) return false;\n\n  const bc = barycentricCoord(t, pt);\n\n  return (\n    0 <= bc.a && bc.a <= 1 && 0 <= bc.b && bc.b <= 1 && 0 <= bc.c && bc.c <= 1\n  );\n};\n\n/**\n * Returns a triangle that is rotated by `angleRad`. By default it rotates\n * around its center but an arbitrary `origin` point can be provided.\n *\n * ```js\n * // Rotate triangle by 5 degrees\n * rotate(triangle, degreeToRadian(5));\n *\n * // Rotate by 90 degrees\n * rotate(triangle, Math.PI / 2);\n * ```\n * @param line Line to rotate\n * @param amountRadian Angle in radians to rotate by\n * @param origin Point to rotate around. If undefined, middle of line will be used\n * @returns\n */\nexport const rotate = (\n  t: Triangle,\n  amountRadian?: number,\n  origin?: Points.Point\n): Triangle => {\n  if (amountRadian === undefined || amountRadian === 0) return t;\n  if (origin === undefined) origin = centroid(t);\n  return Object.freeze({\n    ...t,\n    a: Points.rotate(t.a, amountRadian, origin),\n    b: Points.rotate(t.b, amountRadian, origin),\n    c: Points.rotate(t.c, amountRadian, origin),\n  });\n};\n","import { type Circle } from './Circle.js';\nimport { type Point } from './Point.js';\nimport { type Triangle } from './Triangle.js';\n\nconst pi4over3 = (Math.PI * 4) / 3;\nconst pi2over3 = (Math.PI * 2) / 3;\n\nexport type TriangleEquilateral =\n  | {\n      readonly length: number;\n    }\n  | number;\n\nconst resolveLength = (t: TriangleEquilateral): number => {\n  if (typeof t === `number`) return t;\n  return t.length;\n};\n\n/**\n * Returns a positioned `Triangle` from an equilateral triangle definition.\n * By default the rotation is such that point `a` and `c` are lying on the horizontal,\n * and `b` is the upward-facing tip.\n *\n * Default is a triangle pointing upwards with b at the top, c to the left and b to right on the baseline.\n *\n * Example rotation values in radians:\n * * ▶️ 0: a and c on vertical, b at the tip\n * * ◀️ Math.PI: `c`and `a` are on vertical, with `b` at the tip.\n * * 🔽 Math.PI/2: `c` and `a` are on horizontal, `c` to the left. `b` at the bottom.\n * * 🔼 Math.PI*1.5: `c` and `a` are on horizontal, `c` to the right. `b` at the top. (default)\n * @param t\n * @param origin\n * @param rotationRad\n * @returns\n */\nexport const fromCenter = (\n  t: TriangleEquilateral,\n  origin: Point = { x: 0, y: 0 },\n  rotationRad?: number\n): Triangle => {\n  const r = resolveLength(t) / Math.sqrt(3);\n  const rot = rotationRad ?? Math.PI * 1.5;\n  const b = {\n    x: r * Math.cos(rot) + origin.x,\n    y: r * Math.sin(rot) + origin.y,\n  };\n  const a = {\n    x: r * Math.cos(rot + pi4over3) + origin.x,\n    y: r * Math.sin(rot + pi4over3) + origin.y,\n  };\n  const c = {\n    x: r * Math.cos(rot + pi2over3) + origin.x,\n    y: r * Math.sin(rot + pi2over3) + origin.y,\n  };\n\n  return Object.freeze({ a, b, c });\n};\n\n/**\n * Calculate center from the given point A\n * @param t\n * @param ptA\n * @returns\n */\nexport const centerFromA = (\n  t: TriangleEquilateral,\n  ptA: Point = { x: 0, y: 0 }\n): Point => {\n  const r = resolveLength(t);\n  const { radius } = incircle(t);\n  return {\n    x: ptA.x + r / 2,\n    y: ptA.y - radius,\n  };\n};\n\n/**\n * Calculate center from the given point B\n * @param t\n * @param ptB\n * @returns\n */\nexport const centerFromB = (\n  t: TriangleEquilateral,\n  ptB: Point = { x: 0, y: 0 }\n): Point => {\n  const { radius } = incircle(t);\n  return {\n    x: ptB.x,\n    y: ptB.y + radius * 2,\n  };\n};\n\n/**\n * Calculate center from the given point C\n * @param t\n * @param ptC\n * @returns\n */\nexport const centerFromC = (\n  t: TriangleEquilateral,\n  ptC: Point = { x: 0, y: 0 }\n): Point => {\n  const r = resolveLength(t);\n  const { radius } = incircle(t);\n\n  return {\n    x: ptC.x - r / 2,\n    y: ptC.y - radius,\n  };\n};\n\n/**\n * Returns the height (or rise) of an equilateral triangle.\n * Ie. from one vertex to the perpendicular edge.\n * (line marked x in the diagram below)\n *\n * ```\n *      .\n *     .x .\n *    . x  .\n *   .  x   .\n *  ..........\n * ```\n * @param t\n */\nexport const height = (t: TriangleEquilateral): number =>\n  (Math.sqrt(3) / 2) * resolveLength(t);\n\nexport const perimeter = (t: TriangleEquilateral): number =>\n  resolveLength(t) * 3;\n\nexport const area = (t: TriangleEquilateral): number =>\n  (Math.pow(resolveLength(t), 2) * Math.sqrt(3)) / 4;\n\n/**\n * Circle that encompasses all points of triangle\n * @param t\n */\nexport const circumcircle = (t: TriangleEquilateral): Circle => ({\n  radius: (Math.sqrt(3) / 3) * resolveLength(t),\n});\n\n/**\n * Circle that is inside the edges of the triangle\n * @param t\n * @returns\n */\nexport const incircle = (t: TriangleEquilateral): Circle => ({\n  radius: (Math.sqrt(3) / 6) * resolveLength(t),\n});\n","import { Points, Triangles } from './index.js';\nimport { type Circle } from './Circle.js';\n\nexport type Right = {\n  readonly adjacent?: number;\n  readonly hypotenuse?: number;\n  readonly opposite?: number;\n};\n\nexport type DefinedRight = {\n  readonly adjacent: number;\n  readonly hypotenuse: number;\n  readonly opposite: number;\n};\n\n/**\n * Returns a positioned triangle from a point for A.\n *\n * ```\n *             c (90 deg)\n *             .\n *          .   .\n *       .       .\n *    .           .\n * a .............. b\n * ```\n * @param t\n * @param origin\n * @returns\n */\nexport const fromA = (\n  t: Right,\n  origin: Points.Point = { x: 0, y: 0 }\n): Triangles.Triangle => {\n  const tt = resolveLengths(t);\n  const seg = hypotenuseSegments(t);\n  const h = height(t);\n  const a = { x: origin.x, y: origin.y };\n  const b = { x: origin.x + tt.hypotenuse, y: origin.y };\n  const c = { x: origin.x + seg[1], y: origin.y - h };\n  return { a, b, c };\n};\n\n/**\n * Returns a positioned triangle from a point for B.\n *\n * ```\n *             c (90 deg)\n *             .\n *          .   .\n *       .       .\n *    .           .\n * a .............. b\n * ```\n * @param t\n * @param origin\n * @returns\n */\nexport const fromB = (\n  t: Right,\n  origin: Points.Point = { x: 0, y: 0 }\n): Triangles.Triangle => {\n  const tt = resolveLengths(t);\n  const seg = hypotenuseSegments(t);\n  const h = height(t);\n  const b = { x: origin.x, y: origin.y };\n  const a = { x: origin.x - tt.hypotenuse, y: origin.y };\n  const c = { x: origin.x - seg[0], y: origin.y - h };\n  return { a, b, c };\n};\n\n/**\n * Returns a positioned triangle from a point for C.\n *\n * ```\n *             c (90 deg)\n *             .\n *          .   .\n *       .       .\n *    .           .\n * a .............. b\n * ```\n *\n *\n * ```js\n * // Triangle pointing up to 0,0 with sides of 15\n * Triangles.Right.fromC({ adjacent: 15, opposite:15 }, { x: 0, y: 0 });\n * ```\n * @param t\n * @param origin\n * @returns\n */\nexport const fromC = (\n  t: Right,\n  origin: Points.Point = { x: 0, y: 0 }\n): Triangles.Triangle => {\n  const seg = hypotenuseSegments(t);\n  const h = height(t);\n  const c = { x: origin.x, y: origin.y };\n  const a = { x: origin.x - seg[1], y: origin.y + h };\n  const b = { x: origin.x + seg[0], y: origin.y + h };\n  return { a, b, c };\n};\n\n/**\n * Returns a right triangle with all lengths defined.\n * At least two lengths must already exist\n * @param t\n * @returns\n */\nexport const resolveLengths = (t: Right): DefinedRight => {\n  const a = t.adjacent;\n  const o = t.opposite;\n  const h = t.hypotenuse;\n\n  if (a !== undefined && o !== undefined) {\n    return {\n      ...t,\n      adjacent: a,\n      opposite: o,\n      hypotenuse: Math.sqrt(a * a + o * o),\n    };\n  } else if (a && h) {\n    return {\n      ...t,\n      adjacent: a,\n      hypotenuse: h,\n      opposite: h * h - a * a,\n    };\n  } else if (o && h) {\n    return {\n      ...t,\n      hypotenuse: h,\n      opposite: o,\n      adjacent: h * h - o * o,\n    };\n  } else if (t.opposite && t.hypotenuse && t.adjacent) {\n    return t as DefinedRight;\n  }\n  throw new Error(`Missing at least two edges`);\n};\n\n/**\n * Height of right-triangle\n * @param t\n * @returns\n */\nexport const height = (t: Right): number => {\n  const tt = resolveLengths(t);\n  const p = (tt.opposite * tt.opposite) / tt.hypotenuse;\n  const q = (tt.adjacent * tt.adjacent) / tt.hypotenuse;\n  return Math.sqrt(p * q);\n};\n\n/**\n * Returns the lengths of the hypotenuse split into p and q segments.\n * In other words, if one makes a line from the right-angle vertex down to hypotenuse.\n *\n * [See here](https://rechneronline.de/pi/right-triangle.php)\n * @param t\n * @returns\n */\nexport const hypotenuseSegments = (\n  t: Right\n): readonly [p: number, q: number] => {\n  const tt = resolveLengths(t);\n  const p = (tt.opposite * tt.opposite) / tt.hypotenuse;\n  const q = (tt.adjacent * tt.adjacent) / tt.hypotenuse;\n  return [p, q];\n};\n\nexport const perimeter = (t: Right): number => {\n  const tt = resolveLengths(t);\n  return tt.adjacent + tt.hypotenuse + tt.opposite;\n};\n\nexport const area = (t: Right): number => {\n  const tt = resolveLengths(t);\n  return (tt.opposite * tt.adjacent) / 2;\n};\n\n/**\n * Angle (in radians) between hypotenuse and adjacent edge\n * @param t\n * @returns\n */\nexport const angleAtPointA = (t: Right): number => {\n  const tt = resolveLengths(t);\n  return Math.acos(\n    (tt.adjacent * tt.adjacent +\n      tt.hypotenuse * tt.hypotenuse -\n      tt.opposite * tt.opposite) /\n      (2 * tt.adjacent * tt.hypotenuse)\n  );\n};\n\n/**\n * Angle (in radians) between opposite edge and hypotenuse\n * @param t\n * @returns\n */\nexport const angleAtPointB = (t: Right): number => {\n  const tt = resolveLengths(t);\n  return Math.acos(\n    (tt.opposite * tt.opposite +\n      tt.hypotenuse * tt.hypotenuse -\n      tt.adjacent * tt.adjacent) /\n      (2 * tt.opposite * tt.hypotenuse)\n  );\n};\n\n/**\n * Returns the median line lengths a, b and c in an array.\n *\n * The median lines are the lines from each vertex to the center.\n *\n * @param t\n * @returns\n */\nexport const medians = (\n  t: Right\n): readonly [a: number, b: number, c: number] => {\n  const tt = resolveLengths(t);\n  const b = tt.adjacent * tt.adjacent;\n  const c = tt.hypotenuse * tt.hypotenuse;\n  const a = tt.opposite * tt.opposite;\n\n  return [\n    Math.sqrt(2 * (b + c) - a) / 2,\n    Math.sqrt(2 * (c + a) - b) / 2,\n    Math.sqrt(2 * (a + b) - c) / 2,\n  ];\n};\n\n/**\n * The circle which passes through the points of the triangle\n * @param t\n * @returns\n */\nexport const circumcircle = (t: Right): Circle => {\n  const tt = resolveLengths(t);\n  return { radius: tt.hypotenuse / 2 };\n};\n\n/**\n * Circle enclosed by triangle\n * @param t\n * @returns\n */\nexport const incircle = (t: Right): Circle => {\n  const tt = resolveLengths(t);\n  return {\n    radius: (tt.adjacent + tt.opposite - tt.hypotenuse) / 2,\n  };\n};\n\n/**\n * Returns the opposite length of a right-angle triangle,\n * marked here\n *\n * ```\n *    .  <\n *   ..  <\n * ....  <\n * ```\n *\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRad\n * @param adjacent\n * @returns\n */\nexport const oppositeFromAdjacent = (\n  angleRad: number,\n  adjacent: number\n): number => Math.tan(angleRad) * adjacent;\n\n/**\n * Returns the opposite length of a right-angle triangle,\n * marked here\n *\n * ```\n *    .  <\n *   ..  <\n * ....  <\n * ```\n *\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRad\n * @param hypotenuse\n * @returns\n */\nexport const oppositeFromHypotenuse = (\n  angleRad: number,\n  hypotenuse: number\n): number => Math.sin(angleRad) * hypotenuse;\n\n/**\n * Returns the adjecent length of a right-angle triangle,\n * marked here\n * ```\n *    .\n *   ..  o\n * ....\n * ^^^^\n * ```\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRad\n * @param adjacent\n * @returns\n */\nexport const adjacentFromHypotenuse = (\n  angleRad: number,\n  hypotenuse: number\n): number => Math.cos(angleRad) * hypotenuse;\n\n/**\n * Returns the adjecent length of a right-angle triangle,\n * marked here\n * ```\n *    .\n *   ..  o\n * ....\n * ^^^^\n * ```\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRad\n * @param opposite\n * @returns\n */\nexport const adjacentFromOpposite = (\n  angleRad: number,\n  opposite: number\n): number => opposite / Math.tan(angleRad);\n\n/**\n * Returns the hypotenuse length of a right-angle triangle,\n * marked here\n * ```\n *      .\n * >   ..\n * >  ...\n * > ....  opp\n *  .....\n *   adj\n * ```\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRad\n * @param adjacent\n * @returns\n */\nexport const hypotenuseFromOpposite = (\n  angleRad: number,\n  opposite: number\n): number => opposite / Math.sin(angleRad);\n\n/**\n * Returns the hypotenuse length of a right-angle triangle,\n * marked here\n * ```\n *      .\n * >   ..\n * >  ...\n * > ....  opp\n *  .....\n *   adj\n * ```\n * This is just:\n * ```js\n * opposite = Math.tan(angle) * adjacent\n * ```\n * @param angleRad\n * @param adjacent\n * @returns\n */\nexport const hypotenuseFromAdjacent = (\n  angleRad: number,\n  adjacent: number\n): number => adjacent / Math.cos(angleRad);\n","import { Points, Triangles } from './index.js';\nimport { type Circle } from './Circle.js';\n\nexport type Isosceles = {\n  readonly legs: number;\n  readonly base: number;\n};\n\nexport const baseAngle = (t: Isosceles): number =>\n  Math.acos(t.base / (2 * t.legs));\n\nexport const apexAngle = (t: Isosceles): number => {\n  const aa = t.legs * t.legs;\n  const cc = t.base * t.base;\n  return Math.acos((2 * aa - cc) / (2 * aa));\n};\n\nexport const height = (t: Isosceles): number => {\n  const aa = t.legs * t.legs;\n  const cc = t.base * t.base;\n  return Math.sqrt((4 * aa - cc) / 4);\n};\n\nexport const legHeights = (t: Isosceles): number => {\n  const b = baseAngle(t);\n  return t.base * Math.sin(b);\n};\n\nexport const perimeter = (t: Isosceles): number => 2 * t.legs + t.base;\n\nexport const area = (t: Isosceles): number => {\n  const h = height(t);\n  return (h * t.base) / 2;\n};\n\nexport const circumcircle = (t: Isosceles): Circle => {\n  const h = height(t);\n  const hh = h * h;\n  const cc = t.base * t.base;\n  return { radius: (4 * hh + cc) / (8 * h) };\n};\n\nexport const incircle = (t: Isosceles): Circle => {\n  const h = height(t);\n  return { radius: (t.base * h) / (2 * t.legs + t.base) };\n};\n\nexport const medians = (\n  t: Isosceles\n): readonly [a: number, b: number, c: number] => {\n  const aa = t.legs * t.legs;\n  const cc = t.base * t.base;\n  const medianAB = Math.sqrt(aa + 2 * cc) / 2;\n  const medianC = Math.sqrt(4 * aa - cc) / 2;\n  return [medianAB, medianAB, medianC];\n};\n\n/**\n * Returns a positioned `Triangle` based on a center origin.\n * Center is determined by the intesecting of the medians.\n *\n * See: https://rechneronline.de/pi/isosceles-triangle.php\n * @param t\n * @param origin\n * @returns\n */\nexport const fromCenter = (\n  t: Isosceles,\n  origin: Points.Point = { x: 0, y: 0 }\n): Triangles.Triangle => {\n  const h = height(t);\n  const incircleR = incircle(t).radius;\n  const verticalToApex = h - incircleR;\n\n  const a = { x: origin.x - t.base / 2, y: origin.y + incircleR };\n  const b = { x: origin.x + t.base / 2, y: origin.y + incircleR };\n  const c = { x: origin.x, y: origin.y - verticalToApex };\n  return { a, b, c };\n};\n\nexport const fromA = (\n  t: Isosceles,\n  origin: Points.Point = { x: 0, y: 0 }\n): Triangles.Triangle => {\n  const h = height(t);\n  const a = { x: origin.x, y: origin.y };\n  const b = { x: origin.x + t.base, y: origin.y };\n  const c = { x: origin.x + t.base / 2, y: origin.y - h };\n  return { a, b, c };\n};\n\nexport const fromB = (\n  t: Isosceles,\n  origin: Points.Point = { x: 0, y: 0 }\n): Triangles.Triangle => {\n  const h = height(t);\n  const b = { x: origin.x, y: origin.y };\n  const a = { x: origin.x - t.base, y: origin.y };\n  const c = { x: origin.x - t.base / 2, y: origin.y - h };\n  return { a, b, c };\n};\n\nexport const fromC = (\n  t: Isosceles,\n  origin: Points.Point = { x: 0, y: 0 }\n): Triangles.Triangle => {\n  const h = height(t);\n  const c = { x: origin.x, y: origin.y };\n  const a = { x: origin.x - t.base / 2, y: origin.y + h };\n  const b = { x: origin.x + t.base / 2, y: origin.y + h };\n  return { a, b, c };\n};\n","import { Bezier as BezierLib } from 'bezier-js';\nimport { Paths, Points, Rects, Lines } from './index.js';\n\nexport type QuadraticBezier = {\n  readonly a:Points.Point,\n  readonly b:Points.Point,\n  readonly quadratic:Points.Point\n}\n\nexport type QuadraticBezierPath = Paths.Path & QuadraticBezier;\nexport type CubicBezier = {\n  readonly a:Points.Point,\n  readonly b:Points.Point,\n  readonly cubic1:Points.Point,\n  readonly cubic2:Points.Point,\n}\n\nexport type CubicBezierPath = Paths.Path & CubicBezier;\n\nexport const isQuadraticBezier = (path:Paths.Path | QuadraticBezier | CubicBezier):path is QuadraticBezier => (path as QuadraticBezier).quadratic !== undefined;\nexport const isCubicBezier = (path:Paths.Path | CubicBezier | QuadraticBezier):path is CubicBezier => (path as CubicBezier).cubic1 !== undefined && (path as CubicBezier).cubic2 !== undefined;\n\n/**\n * Returns a new quadratic bezier with specified bend amount\n *\n * @param {QuadraticBezier} b Curve\n * @param {number} [bend=0] Bend amount, from -1 to 1\n * @returns {QuadraticBezier}\n */\nexport const quadraticBend = (a:Points.Point, b:Points.Point, bend = 0):QuadraticBezier => quadraticSimple(a, b, bend);\n\n/**\n * Creates a simple quadratic bezier with a specified amount of 'bend'.\n * Bend of -1 will pull curve down, 1 will pull curve up. 0 is no curve\n * @param {Points.Point} start Start of curve\n * @param {Points.Point} end End of curve\n * @param {number} [bend=0] Bend amount, -1 to 1\n * @returns {QuadraticBezier}\n */\nexport const quadraticSimple = (start:Points.Point, end:Points.Point, bend = 0):QuadraticBezier => {\n  if (isNaN(bend)) throw Error(`bend is NaN`);\n  if (bend < -1 || bend > 1) throw Error(`Expects bend range of -1 to 1`);\n\n  const middle = Lines.interpolate(0.5, start, end);\n  // eslint-disable-next-line functional/no-let\n  let target = middle;\n  if (end.y < start.y) {\n    // Upward slope\n    target = bend > 0 ? { x: Math.min(start.x, end.x), y: Math.min(start.y, end.y) } :\n      { x: Math.max(start.x, end.x), y: Math.max(start.y, end.y) };\n  } else {\n    // Downward slope\n    target = bend > 0 ? { x: Math.max(start.x, end.x), y: Math.min(start.y, end.y) } :\n      { x: Math.min(start.x, end.x), y: Math.max(start.y, end.y) };\n  }\n\n  const handle = Lines.interpolate(Math.abs(bend), middle, target,);\n  return quadratic(start, end, handle);\n};\n\n/**\n * Returns a relative point on a simple quadratic \n * @param start Start\n * @param end  End\n * @param bend Bend (-1 to 1)\n * @param amt Amount\n * @returns Point\n */\nexport const computeQuadraticSimple = (start:Points.Point, end:Points.Point, bend:number, amt:number):Points.Point => {\n  const q = quadraticSimple(start, end, bend);\n  const bzr = new BezierLib(q.a, q.quadratic, q.b);\n  return bzr.compute(amt);\n};\n\n//https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths\nexport const quadraticToSvgString = (start:Points.Point, end:Points.Point, handle:Points.Point):readonly string[] => [`M ${start.x} ${start.y} Q ${handle.x} ${handle.y} ${end.x} ${end.y}`];\n\nexport const toPath = (cubicOrQuadratic:CubicBezier|QuadraticBezier):CubicBezierPath|QuadraticBezierPath => {\n  if (isCubicBezier(cubicOrQuadratic)) {\n    return cubicToPath(cubicOrQuadratic);\n  } else if (isQuadraticBezier(cubicOrQuadratic)) {\n    return quadratictoPath(cubicOrQuadratic);\n  } else {\n    throw new Error(`Unknown bezier type`);\n  }\n};\n\nexport const cubic = (start:Points.Point, end:Points.Point, cubic1:Points.Point, cubic2:Points.Point):CubicBezier => (\n  {\n    a: Object.freeze(start),\n    b: Object.freeze(end),\n    cubic1: Object.freeze(cubic1),\n    cubic2: Object.freeze(cubic2) \n  });\n\nconst cubicToPath = (cubic:CubicBezier):CubicBezierPath => {\n  const { a, cubic1, cubic2, b } = cubic;\n\n  const bzr = new BezierLib(a, cubic1, cubic2, b);\n  return Object.freeze({\n    ...cubic,\n    length: () => bzr.length(),\n    interpolate: (t:number) => bzr.compute(t),\n    nearest: (_:Points.Point) => { throw new Error(`not implemented`); },\n    bbox: () => {\n      const { x, y } = bzr.bbox();\n      const xSize = x.size;\n      const ySize = y.size;\n      if (xSize === undefined) throw new Error(`x.size not present on calculated bbox`);\n      if (ySize === undefined) throw new Error(`x.size not present on calculated bbox`);\n\n      return Rects.fromTopLeft({ x: x.min, y: y.min }, xSize, ySize);\n    },\n    toString: () => bzr.toString(),\n    toSvgString: () => [`brrup`],\n    kind: `bezier/cubic`\n  });\n};\n\nexport const quadratic = (start:Points.Point, end:Points.Point, handle:Points.Point):QuadraticBezier => ({\n  a: Object.freeze(start),\n  b: Object.freeze(end),\n  quadratic: Object.freeze(handle)\n});\n\n\nconst quadratictoPath = (quadraticBezier:QuadraticBezier):QuadraticBezierPath => {\n  const { a, b, quadratic } = quadraticBezier;\n  const bzr = new BezierLib(a, quadratic, b);\n  return Object.freeze({\n    ...quadraticBezier,\n    length: () => bzr.length(),\n    interpolate: (t:number) => bzr.compute(t),\n    nearest: (_:Points.Point) => { throw new Error(`not implemented`); },\n    bbox: () => {\n      const { x, y } = bzr.bbox();\n      const xSize = x.size;\n      const ySize = y.size;\n      if (xSize === undefined) throw new Error(`x.size not present on calculated bbox`);\n      if (ySize === undefined) throw new Error(`x.size not present on calculated bbox`);\n      return Rects.fromTopLeft({ x: x.min, y: y.min }, xSize, ySize);\n    },\n    toString: () => bzr.toString(),\n    toSvgString: () => quadraticToSvgString(a, b, quadratic),\n    kind: `bezier/quadratic`\n  });\n};\n\n","import { Bezier } from \"./bezier.js\";\n\n// math-inlining.\nconst { abs, cos, sin, acos, atan2, sqrt, pow } = Math;\n\n// cube root function yielding real roots\nfunction crt(v) {\n  return v < 0 ? -pow(-v, 1 / 3) : pow(v, 1 / 3);\n}\n\n// trig constants\nconst pi = Math.PI,\n  tau = 2 * pi,\n  quart = pi / 2,\n  // float precision significant decimal\n  epsilon = 0.000001,\n  // extremas used in bbox calculation and similar algorithms\n  nMax = Number.MAX_SAFE_INTEGER || 9007199254740991,\n  nMin = Number.MIN_SAFE_INTEGER || -9007199254740991,\n  // a zero coordinate, which is surprisingly useful\n  ZERO = { x: 0, y: 0, z: 0 };\n\n// Bezier utility functions\nconst utils = {\n  // Legendre-Gauss abscissae with n=24 (x_i values, defined at i=n as the roots of the nth order Legendre polynomial Pn(x))\n  Tvalues: [\n    -0.0640568928626056260850430826247450385909,\n    0.0640568928626056260850430826247450385909,\n    -0.1911188674736163091586398207570696318404,\n    0.1911188674736163091586398207570696318404,\n    -0.3150426796961633743867932913198102407864,\n    0.3150426796961633743867932913198102407864,\n    -0.4337935076260451384870842319133497124524,\n    0.4337935076260451384870842319133497124524,\n    -0.5454214713888395356583756172183723700107,\n    0.5454214713888395356583756172183723700107,\n    -0.6480936519369755692524957869107476266696,\n    0.6480936519369755692524957869107476266696,\n    -0.7401241915785543642438281030999784255232,\n    0.7401241915785543642438281030999784255232,\n    -0.8200019859739029219539498726697452080761,\n    0.8200019859739029219539498726697452080761,\n    -0.8864155270044010342131543419821967550873,\n    0.8864155270044010342131543419821967550873,\n    -0.9382745520027327585236490017087214496548,\n    0.9382745520027327585236490017087214496548,\n    -0.9747285559713094981983919930081690617411,\n    0.9747285559713094981983919930081690617411,\n    -0.9951872199970213601799974097007368118745,\n    0.9951872199970213601799974097007368118745,\n  ],\n\n  // Legendre-Gauss weights with n=24 (w_i values, defined by a function linked to in the Bezier primer article)\n  Cvalues: [\n    0.1279381953467521569740561652246953718517,\n    0.1279381953467521569740561652246953718517,\n    0.1258374563468282961213753825111836887264,\n    0.1258374563468282961213753825111836887264,\n    0.121670472927803391204463153476262425607,\n    0.121670472927803391204463153476262425607,\n    0.1155056680537256013533444839067835598622,\n    0.1155056680537256013533444839067835598622,\n    0.1074442701159656347825773424466062227946,\n    0.1074442701159656347825773424466062227946,\n    0.0976186521041138882698806644642471544279,\n    0.0976186521041138882698806644642471544279,\n    0.086190161531953275917185202983742667185,\n    0.086190161531953275917185202983742667185,\n    0.0733464814110803057340336152531165181193,\n    0.0733464814110803057340336152531165181193,\n    0.0592985849154367807463677585001085845412,\n    0.0592985849154367807463677585001085845412,\n    0.0442774388174198061686027482113382288593,\n    0.0442774388174198061686027482113382288593,\n    0.0285313886289336631813078159518782864491,\n    0.0285313886289336631813078159518782864491,\n    0.0123412297999871995468056670700372915759,\n    0.0123412297999871995468056670700372915759,\n  ],\n\n  arcfn: function (t, derivativeFn) {\n    const d = derivativeFn(t);\n    let l = d.x * d.x + d.y * d.y;\n    if (typeof d.z !== \"undefined\") {\n      l += d.z * d.z;\n    }\n    return sqrt(l);\n  },\n\n  compute: function (t, points, _3d) {\n    // shortcuts\n    if (t === 0) {\n      points[0].t = 0;\n      return points[0];\n    }\n\n    const order = points.length - 1;\n\n    if (t === 1) {\n      points[order].t = 1;\n      return points[order];\n    }\n\n    const mt = 1 - t;\n    let p = points;\n\n    // constant?\n    if (order === 0) {\n      points[0].t = t;\n      return points[0];\n    }\n\n    // linear?\n    if (order === 1) {\n      const ret = {\n        x: mt * p[0].x + t * p[1].x,\n        y: mt * p[0].y + t * p[1].y,\n        t: t,\n      };\n      if (_3d) {\n        ret.z = mt * p[0].z + t * p[1].z;\n      }\n      return ret;\n    }\n\n    // quadratic/cubic curve?\n    if (order < 4) {\n      let mt2 = mt * mt,\n        t2 = t * t,\n        a,\n        b,\n        c,\n        d = 0;\n      if (order === 2) {\n        p = [p[0], p[1], p[2], ZERO];\n        a = mt2;\n        b = mt * t * 2;\n        c = t2;\n      } else if (order === 3) {\n        a = mt2 * mt;\n        b = mt2 * t * 3;\n        c = mt * t2 * 3;\n        d = t * t2;\n      }\n      const ret = {\n        x: a * p[0].x + b * p[1].x + c * p[2].x + d * p[3].x,\n        y: a * p[0].y + b * p[1].y + c * p[2].y + d * p[3].y,\n        t: t,\n      };\n      if (_3d) {\n        ret.z = a * p[0].z + b * p[1].z + c * p[2].z + d * p[3].z;\n      }\n      return ret;\n    }\n\n    // higher order curves: use de Casteljau's computation\n    const dCpts = JSON.parse(JSON.stringify(points));\n    while (dCpts.length > 1) {\n      for (let i = 0; i < dCpts.length - 1; i++) {\n        dCpts[i] = {\n          x: dCpts[i].x + (dCpts[i + 1].x - dCpts[i].x) * t,\n          y: dCpts[i].y + (dCpts[i + 1].y - dCpts[i].y) * t,\n        };\n        if (typeof dCpts[i].z !== \"undefined\") {\n          dCpts[i].z = dCpts[i].z + (dCpts[i + 1].z - dCpts[i].z) * t;\n        }\n      }\n      dCpts.splice(dCpts.length - 1, 1);\n    }\n    dCpts[0].t = t;\n    return dCpts[0];\n  },\n\n  computeWithRatios: function (t, points, ratios, _3d) {\n    const mt = 1 - t,\n      r = ratios,\n      p = points;\n\n    let f1 = r[0],\n      f2 = r[1],\n      f3 = r[2],\n      f4 = r[3],\n      d;\n\n    // spec for linear\n    f1 *= mt;\n    f2 *= t;\n\n    if (p.length === 2) {\n      d = f1 + f2;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y) / d,\n        z: !_3d ? false : (f1 * p[0].z + f2 * p[1].z) / d,\n        t: t,\n      };\n    }\n\n    // upgrade to quadratic\n    f1 *= mt;\n    f2 *= 2 * mt;\n    f3 *= t * t;\n\n    if (p.length === 3) {\n      d = f1 + f2 + f3;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x + f3 * p[2].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y + f3 * p[2].y) / d,\n        z: !_3d ? false : (f1 * p[0].z + f2 * p[1].z + f3 * p[2].z) / d,\n        t: t,\n      };\n    }\n\n    // upgrade to cubic\n    f1 *= mt;\n    f2 *= 1.5 * mt;\n    f3 *= 3 * mt;\n    f4 *= t * t * t;\n\n    if (p.length === 4) {\n      d = f1 + f2 + f3 + f4;\n      return {\n        x: (f1 * p[0].x + f2 * p[1].x + f3 * p[2].x + f4 * p[3].x) / d,\n        y: (f1 * p[0].y + f2 * p[1].y + f3 * p[2].y + f4 * p[3].y) / d,\n        z: !_3d\n          ? false\n          : (f1 * p[0].z + f2 * p[1].z + f3 * p[2].z + f4 * p[3].z) / d,\n        t: t,\n      };\n    }\n  },\n\n  derive: function (points, _3d) {\n    const dpoints = [];\n    for (let p = points, d = p.length, c = d - 1; d > 1; d--, c--) {\n      const list = [];\n      for (let j = 0, dpt; j < c; j++) {\n        dpt = {\n          x: c * (p[j + 1].x - p[j].x),\n          y: c * (p[j + 1].y - p[j].y),\n        };\n        if (_3d) {\n          dpt.z = c * (p[j + 1].z - p[j].z);\n        }\n        list.push(dpt);\n      }\n      dpoints.push(list);\n      p = list;\n    }\n    return dpoints;\n  },\n\n  between: function (v, m, M) {\n    return (\n      (m <= v && v <= M) ||\n      utils.approximately(v, m) ||\n      utils.approximately(v, M)\n    );\n  },\n\n  approximately: function (a, b, precision) {\n    return abs(a - b) <= (precision || epsilon);\n  },\n\n  length: function (derivativeFn) {\n    const z = 0.5,\n      len = utils.Tvalues.length;\n\n    let sum = 0;\n\n    for (let i = 0, t; i < len; i++) {\n      t = z * utils.Tvalues[i] + z;\n      sum += utils.Cvalues[i] * utils.arcfn(t, derivativeFn);\n    }\n    return z * sum;\n  },\n\n  map: function (v, ds, de, ts, te) {\n    const d1 = de - ds,\n      d2 = te - ts,\n      v2 = v - ds,\n      r = v2 / d1;\n    return ts + d2 * r;\n  },\n\n  lerp: function (r, v1, v2) {\n    const ret = {\n      x: v1.x + r * (v2.x - v1.x),\n      y: v1.y + r * (v2.y - v1.y),\n    };\n    if (v1.z !== undefined && v2.z !== undefined) {\n      ret.z = v1.z + r * (v2.z - v1.z);\n    }\n    return ret;\n  },\n\n  pointToString: function (p) {\n    let s = p.x + \"/\" + p.y;\n    if (typeof p.z !== \"undefined\") {\n      s += \"/\" + p.z;\n    }\n    return s;\n  },\n\n  pointsToString: function (points) {\n    return \"[\" + points.map(utils.pointToString).join(\", \") + \"]\";\n  },\n\n  copy: function (obj) {\n    return JSON.parse(JSON.stringify(obj));\n  },\n\n  angle: function (o, v1, v2) {\n    const dx1 = v1.x - o.x,\n      dy1 = v1.y - o.y,\n      dx2 = v2.x - o.x,\n      dy2 = v2.y - o.y,\n      cross = dx1 * dy2 - dy1 * dx2,\n      dot = dx1 * dx2 + dy1 * dy2;\n    return atan2(cross, dot);\n  },\n\n  // round as string, to avoid rounding errors\n  round: function (v, d) {\n    const s = \"\" + v;\n    const pos = s.indexOf(\".\");\n    return parseFloat(s.substring(0, pos + 1 + d));\n  },\n\n  dist: function (p1, p2) {\n    const dx = p1.x - p2.x,\n      dy = p1.y - p2.y;\n    return sqrt(dx * dx + dy * dy);\n  },\n\n  closest: function (LUT, point) {\n    let mdist = pow(2, 63),\n      mpos,\n      d;\n    LUT.forEach(function (p, idx) {\n      d = utils.dist(point, p);\n      if (d < mdist) {\n        mdist = d;\n        mpos = idx;\n      }\n    });\n    return { mdist: mdist, mpos: mpos };\n  },\n\n  abcratio: function (t, n) {\n    // see ratio(t) note on http://pomax.github.io/bezierinfo/#abc\n    if (n !== 2 && n !== 3) {\n      return false;\n    }\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    } else if (t === 0 || t === 1) {\n      return t;\n    }\n    const bottom = pow(t, n) + pow(1 - t, n),\n      top = bottom - 1;\n    return abs(top / bottom);\n  },\n\n  projectionratio: function (t, n) {\n    // see u(t) note on http://pomax.github.io/bezierinfo/#abc\n    if (n !== 2 && n !== 3) {\n      return false;\n    }\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    } else if (t === 0 || t === 1) {\n      return t;\n    }\n    const top = pow(1 - t, n),\n      bottom = pow(t, n) + top;\n    return top / bottom;\n  },\n\n  lli8: function (x1, y1, x2, y2, x3, y3, x4, y4) {\n    const nx =\n        (x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4),\n      ny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4),\n      d = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\n    if (d == 0) {\n      return false;\n    }\n    return { x: nx / d, y: ny / d };\n  },\n\n  lli4: function (p1, p2, p3, p4) {\n    const x1 = p1.x,\n      y1 = p1.y,\n      x2 = p2.x,\n      y2 = p2.y,\n      x3 = p3.x,\n      y3 = p3.y,\n      x4 = p4.x,\n      y4 = p4.y;\n    return utils.lli8(x1, y1, x2, y2, x3, y3, x4, y4);\n  },\n\n  lli: function (v1, v2) {\n    return utils.lli4(v1, v1.c, v2, v2.c);\n  },\n\n  makeline: function (p1, p2) {\n    return new Bezier(\n      p1.x,\n      p1.y,\n      (p1.x + p2.x) / 2,\n      (p1.y + p2.y) / 2,\n      p2.x,\n      p2.y\n    );\n  },\n\n  findbbox: function (sections) {\n    let mx = nMax,\n      my = nMax,\n      MX = nMin,\n      MY = nMin;\n    sections.forEach(function (s) {\n      const bbox = s.bbox();\n      if (mx > bbox.x.min) mx = bbox.x.min;\n      if (my > bbox.y.min) my = bbox.y.min;\n      if (MX < bbox.x.max) MX = bbox.x.max;\n      if (MY < bbox.y.max) MY = bbox.y.max;\n    });\n    return {\n      x: { min: mx, mid: (mx + MX) / 2, max: MX, size: MX - mx },\n      y: { min: my, mid: (my + MY) / 2, max: MY, size: MY - my },\n    };\n  },\n\n  shapeintersections: function (\n    s1,\n    bbox1,\n    s2,\n    bbox2,\n    curveIntersectionThreshold\n  ) {\n    if (!utils.bboxoverlap(bbox1, bbox2)) return [];\n    const intersections = [];\n    const a1 = [s1.startcap, s1.forward, s1.back, s1.endcap];\n    const a2 = [s2.startcap, s2.forward, s2.back, s2.endcap];\n    a1.forEach(function (l1) {\n      if (l1.virtual) return;\n      a2.forEach(function (l2) {\n        if (l2.virtual) return;\n        const iss = l1.intersects(l2, curveIntersectionThreshold);\n        if (iss.length > 0) {\n          iss.c1 = l1;\n          iss.c2 = l2;\n          iss.s1 = s1;\n          iss.s2 = s2;\n          intersections.push(iss);\n        }\n      });\n    });\n    return intersections;\n  },\n\n  makeshape: function (forward, back, curveIntersectionThreshold) {\n    const bpl = back.points.length;\n    const fpl = forward.points.length;\n    const start = utils.makeline(back.points[bpl - 1], forward.points[0]);\n    const end = utils.makeline(forward.points[fpl - 1], back.points[0]);\n    const shape = {\n      startcap: start,\n      forward: forward,\n      back: back,\n      endcap: end,\n      bbox: utils.findbbox([start, forward, back, end]),\n    };\n    shape.intersections = function (s2) {\n      return utils.shapeintersections(\n        shape,\n        shape.bbox,\n        s2,\n        s2.bbox,\n        curveIntersectionThreshold\n      );\n    };\n    return shape;\n  },\n\n  getminmax: function (curve, d, list) {\n    if (!list) return { min: 0, max: 0 };\n    let min = nMax,\n      max = nMin,\n      t,\n      c;\n    if (list.indexOf(0) === -1) {\n      list = [0].concat(list);\n    }\n    if (list.indexOf(1) === -1) {\n      list.push(1);\n    }\n    for (let i = 0, len = list.length; i < len; i++) {\n      t = list[i];\n      c = curve.get(t);\n      if (c[d] < min) {\n        min = c[d];\n      }\n      if (c[d] > max) {\n        max = c[d];\n      }\n    }\n    return { min: min, mid: (min + max) / 2, max: max, size: max - min };\n  },\n\n  align: function (points, line) {\n    const tx = line.p1.x,\n      ty = line.p1.y,\n      a = -atan2(line.p2.y - ty, line.p2.x - tx),\n      d = function (v) {\n        return {\n          x: (v.x - tx) * cos(a) - (v.y - ty) * sin(a),\n          y: (v.x - tx) * sin(a) + (v.y - ty) * cos(a),\n        };\n      };\n    return points.map(d);\n  },\n\n  roots: function (points, line) {\n    line = line || { p1: { x: 0, y: 0 }, p2: { x: 1, y: 0 } };\n\n    const order = points.length - 1;\n    const aligned = utils.align(points, line);\n    const reduce = function (t) {\n      return 0 <= t && t <= 1;\n    };\n\n    if (order === 2) {\n      const a = aligned[0].y,\n        b = aligned[1].y,\n        c = aligned[2].y,\n        d = a - 2 * b + c;\n      if (d !== 0) {\n        const m1 = -sqrt(b * b - a * c),\n          m2 = -a + b,\n          v1 = -(m1 + m2) / d,\n          v2 = -(-m1 + m2) / d;\n        return [v1, v2].filter(reduce);\n      } else if (b !== c && d === 0) {\n        return [(2 * b - c) / (2 * b - 2 * c)].filter(reduce);\n      }\n      return [];\n    }\n\n    // see http://www.trans4mind.com/personal_development/mathematics/polynomials/cubicAlgebra.htm\n    const pa = aligned[0].y,\n      pb = aligned[1].y,\n      pc = aligned[2].y,\n      pd = aligned[3].y;\n\n    let d = -pa + 3 * pb - 3 * pc + pd,\n      a = 3 * pa - 6 * pb + 3 * pc,\n      b = -3 * pa + 3 * pb,\n      c = pa;\n\n    if (utils.approximately(d, 0)) {\n      // this is not a cubic curve.\n      if (utils.approximately(a, 0)) {\n        // in fact, this is not a quadratic curve either.\n        if (utils.approximately(b, 0)) {\n          // in fact in fact, there are no solutions.\n          return [];\n        }\n        // linear solution:\n        return [-c / b].filter(reduce);\n      }\n      // quadratic solution:\n      const q = sqrt(b * b - 4 * a * c),\n        a2 = 2 * a;\n      return [(q - b) / a2, (-b - q) / a2].filter(reduce);\n    }\n\n    // at this point, we know we need a cubic solution:\n\n    a /= d;\n    b /= d;\n    c /= d;\n\n    const p = (3 * b - a * a) / 3,\n      p3 = p / 3,\n      q = (2 * a * a * a - 9 * a * b + 27 * c) / 27,\n      q2 = q / 2,\n      discriminant = q2 * q2 + p3 * p3 * p3;\n\n    let u1, v1, x1, x2, x3;\n    if (discriminant < 0) {\n      const mp3 = -p / 3,\n        mp33 = mp3 * mp3 * mp3,\n        r = sqrt(mp33),\n        t = -q / (2 * r),\n        cosphi = t < -1 ? -1 : t > 1 ? 1 : t,\n        phi = acos(cosphi),\n        crtr = crt(r),\n        t1 = 2 * crtr;\n      x1 = t1 * cos(phi / 3) - a / 3;\n      x2 = t1 * cos((phi + tau) / 3) - a / 3;\n      x3 = t1 * cos((phi + 2 * tau) / 3) - a / 3;\n      return [x1, x2, x3].filter(reduce);\n    } else if (discriminant === 0) {\n      u1 = q2 < 0 ? crt(-q2) : -crt(q2);\n      x1 = 2 * u1 - a / 3;\n      x2 = -u1 - a / 3;\n      return [x1, x2].filter(reduce);\n    } else {\n      const sd = sqrt(discriminant);\n      u1 = crt(-q2 + sd);\n      v1 = crt(q2 + sd);\n      return [u1 - v1 - a / 3].filter(reduce);\n    }\n  },\n\n  droots: function (p) {\n    // quadratic roots are easy\n    if (p.length === 3) {\n      const a = p[0],\n        b = p[1],\n        c = p[2],\n        d = a - 2 * b + c;\n      if (d !== 0) {\n        const m1 = -sqrt(b * b - a * c),\n          m2 = -a + b,\n          v1 = -(m1 + m2) / d,\n          v2 = -(-m1 + m2) / d;\n        return [v1, v2];\n      } else if (b !== c && d === 0) {\n        return [(2 * b - c) / (2 * (b - c))];\n      }\n      return [];\n    }\n\n    // linear roots are even easier\n    if (p.length === 2) {\n      const a = p[0],\n        b = p[1];\n      if (a !== b) {\n        return [a / (a - b)];\n      }\n      return [];\n    }\n\n    return [];\n  },\n\n  curvature: function (t, d1, d2, _3d, kOnly) {\n    let num,\n      dnm,\n      adk,\n      dk,\n      k = 0,\n      r = 0;\n\n    //\n    // We're using the following formula for curvature:\n    //\n    //              x'y\" - y'x\"\n    //   k(t) = ------------------\n    //           (x'² + y'²)^(3/2)\n    //\n    // from https://en.wikipedia.org/wiki/Radius_of_curvature#Definition\n    //\n    // With it corresponding 3D counterpart:\n    //\n    //          sqrt( (y'z\" - y\"z')² + (z'x\" - z\"x')² + (x'y\" - x\"y')²)\n    //   k(t) = -------------------------------------------------------\n    //                     (x'² + y'² + z'²)^(3/2)\n    //\n\n    const d = utils.compute(t, d1);\n    const dd = utils.compute(t, d2);\n    const qdsum = d.x * d.x + d.y * d.y;\n\n    if (_3d) {\n      num = sqrt(\n        pow(d.y * dd.z - dd.y * d.z, 2) +\n          pow(d.z * dd.x - dd.z * d.x, 2) +\n          pow(d.x * dd.y - dd.x * d.y, 2)\n      );\n      dnm = pow(qdsum + d.z * d.z, 3 / 2);\n    } else {\n      num = d.x * dd.y - d.y * dd.x;\n      dnm = pow(qdsum, 3 / 2);\n    }\n\n    if (num === 0 || dnm === 0) {\n      return { k: 0, r: 0 };\n    }\n\n    k = num / dnm;\n    r = dnm / num;\n\n    // We're also computing the derivative of kappa, because\n    // there is value in knowing the rate of change for the\n    // curvature along the curve. And we're just going to\n    // ballpark it based on an epsilon.\n    if (!kOnly) {\n      // compute k'(t) based on the interval before, and after it,\n      // to at least try to not introduce forward/backward pass bias.\n      const pk = utils.curvature(t - 0.001, d1, d2, _3d, true).k;\n      const nk = utils.curvature(t + 0.001, d1, d2, _3d, true).k;\n      dk = (nk - k + (k - pk)) / 2;\n      adk = (abs(nk - k) + abs(k - pk)) / 2;\n    }\n\n    return { k: k, r: r, dk: dk, adk: adk };\n  },\n\n  inflections: function (points) {\n    if (points.length < 4) return [];\n\n    // FIXME: TODO: add in inflection abstraction for quartic+ curves?\n\n    const p = utils.align(points, { p1: points[0], p2: points.slice(-1)[0] }),\n      a = p[2].x * p[1].y,\n      b = p[3].x * p[1].y,\n      c = p[1].x * p[2].y,\n      d = p[3].x * p[2].y,\n      v1 = 18 * (-3 * a + 2 * b + 3 * c - d),\n      v2 = 18 * (3 * a - b - 3 * c),\n      v3 = 18 * (c - a);\n\n    if (utils.approximately(v1, 0)) {\n      if (!utils.approximately(v2, 0)) {\n        let t = -v3 / v2;\n        if (0 <= t && t <= 1) return [t];\n      }\n      return [];\n    }\n\n    const d2 = 2 * v1;\n\n    if (utils.approximately(d2, 0)) return [];\n\n    const trm = v2 * v2 - 4 * v1 * v3;\n\n    if (trm < 0) return [];\n\n    const sq = Math.sqrt(trm);\n\n    return [(sq - v2) / d2, -(v2 + sq) / d2].filter(function (r) {\n      return 0 <= r && r <= 1;\n    });\n  },\n\n  bboxoverlap: function (b1, b2) {\n    const dims = [\"x\", \"y\"],\n      len = dims.length;\n\n    for (let i = 0, dim, l, t, d; i < len; i++) {\n      dim = dims[i];\n      l = b1[dim].mid;\n      t = b2[dim].mid;\n      d = (b1[dim].size + b2[dim].size) / 2;\n      if (abs(l - t) >= d) return false;\n    }\n    return true;\n  },\n\n  expandbox: function (bbox, _bbox) {\n    if (_bbox.x.min < bbox.x.min) {\n      bbox.x.min = _bbox.x.min;\n    }\n    if (_bbox.y.min < bbox.y.min) {\n      bbox.y.min = _bbox.y.min;\n    }\n    if (_bbox.z && _bbox.z.min < bbox.z.min) {\n      bbox.z.min = _bbox.z.min;\n    }\n    if (_bbox.x.max > bbox.x.max) {\n      bbox.x.max = _bbox.x.max;\n    }\n    if (_bbox.y.max > bbox.y.max) {\n      bbox.y.max = _bbox.y.max;\n    }\n    if (_bbox.z && _bbox.z.max > bbox.z.max) {\n      bbox.z.max = _bbox.z.max;\n    }\n    bbox.x.mid = (bbox.x.min + bbox.x.max) / 2;\n    bbox.y.mid = (bbox.y.min + bbox.y.max) / 2;\n    if (bbox.z) {\n      bbox.z.mid = (bbox.z.min + bbox.z.max) / 2;\n    }\n    bbox.x.size = bbox.x.max - bbox.x.min;\n    bbox.y.size = bbox.y.max - bbox.y.min;\n    if (bbox.z) {\n      bbox.z.size = bbox.z.max - bbox.z.min;\n    }\n  },\n\n  pairiteration: function (c1, c2, curveIntersectionThreshold) {\n    const c1b = c1.bbox(),\n      c2b = c2.bbox(),\n      r = 100000,\n      threshold = curveIntersectionThreshold || 0.5;\n\n    if (\n      c1b.x.size + c1b.y.size < threshold &&\n      c2b.x.size + c2b.y.size < threshold\n    ) {\n      return [\n        (((r * (c1._t1 + c1._t2)) / 2) | 0) / r +\n          \"/\" +\n          (((r * (c2._t1 + c2._t2)) / 2) | 0) / r,\n      ];\n    }\n\n    let cc1 = c1.split(0.5),\n      cc2 = c2.split(0.5),\n      pairs = [\n        { left: cc1.left, right: cc2.left },\n        { left: cc1.left, right: cc2.right },\n        { left: cc1.right, right: cc2.right },\n        { left: cc1.right, right: cc2.left },\n      ];\n\n    pairs = pairs.filter(function (pair) {\n      return utils.bboxoverlap(pair.left.bbox(), pair.right.bbox());\n    });\n\n    let results = [];\n\n    if (pairs.length === 0) return results;\n\n    pairs.forEach(function (pair) {\n      results = results.concat(\n        utils.pairiteration(pair.left, pair.right, threshold)\n      );\n    });\n\n    results = results.filter(function (v, i) {\n      return results.indexOf(v) === i;\n    });\n\n    return results;\n  },\n\n  getccenter: function (p1, p2, p3) {\n    const dx1 = p2.x - p1.x,\n      dy1 = p2.y - p1.y,\n      dx2 = p3.x - p2.x,\n      dy2 = p3.y - p2.y,\n      dx1p = dx1 * cos(quart) - dy1 * sin(quart),\n      dy1p = dx1 * sin(quart) + dy1 * cos(quart),\n      dx2p = dx2 * cos(quart) - dy2 * sin(quart),\n      dy2p = dx2 * sin(quart) + dy2 * cos(quart),\n      // chord midpoints\n      mx1 = (p1.x + p2.x) / 2,\n      my1 = (p1.y + p2.y) / 2,\n      mx2 = (p2.x + p3.x) / 2,\n      my2 = (p2.y + p3.y) / 2,\n      // midpoint offsets\n      mx1n = mx1 + dx1p,\n      my1n = my1 + dy1p,\n      mx2n = mx2 + dx2p,\n      my2n = my2 + dy2p,\n      // intersection of these lines:\n      arc = utils.lli8(mx1, my1, mx1n, my1n, mx2, my2, mx2n, my2n),\n      r = utils.dist(arc, p1);\n\n    // arc start/end values, over mid point:\n    let s = atan2(p1.y - arc.y, p1.x - arc.x),\n      m = atan2(p2.y - arc.y, p2.x - arc.x),\n      e = atan2(p3.y - arc.y, p3.x - arc.x),\n      _;\n\n    // determine arc direction (cw/ccw correction)\n    if (s < e) {\n      // if s<m<e, arc(s, e)\n      // if m<s<e, arc(e, s + tau)\n      // if s<e<m, arc(e, s + tau)\n      if (s > m || m > e) {\n        s += tau;\n      }\n      if (s > e) {\n        _ = e;\n        e = s;\n        s = _;\n      }\n    } else {\n      // if e<m<s, arc(e, s)\n      // if m<e<s, arc(s, e + tau)\n      // if e<s<m, arc(s, e + tau)\n      if (e < m && m < s) {\n        _ = e;\n        e = s;\n        s = _;\n      } else {\n        e += tau;\n      }\n    }\n    // assign and done.\n    arc.s = s;\n    arc.e = e;\n    arc.r = r;\n    return arc;\n  },\n\n  numberSort: function (a, b) {\n    return a - b;\n  },\n};\n\nexport { utils };\n","import { utils } from \"./utils.js\";\n\n/**\n * Poly Bezier\n * @param {[type]} curves [description]\n */\nclass PolyBezier {\n  constructor(curves) {\n    this.curves = [];\n    this._3d = false;\n    if (!!curves) {\n      this.curves = curves;\n      this._3d = this.curves[0]._3d;\n    }\n  }\n\n  valueOf() {\n    return this.toString();\n  }\n\n  toString() {\n    return (\n      \"[\" +\n      this.curves\n        .map(function (curve) {\n          return utils.pointsToString(curve.points);\n        })\n        .join(\", \") +\n      \"]\"\n    );\n  }\n\n  addCurve(curve) {\n    this.curves.push(curve);\n    this._3d = this._3d || curve._3d;\n  }\n\n  length() {\n    return this.curves\n      .map(function (v) {\n        return v.length();\n      })\n      .reduce(function (a, b) {\n        return a + b;\n      });\n  }\n\n  curve(idx) {\n    return this.curves[idx];\n  }\n\n  bbox() {\n    const c = this.curves;\n    var bbox = c[0].bbox();\n    for (var i = 1; i < c.length; i++) {\n      utils.expandbox(bbox, c[i].bbox());\n    }\n    return bbox;\n  }\n\n  offset(d) {\n    const offset = [];\n    this.curves.forEach(function (v) {\n      offset.push(...v.offset(d));\n    });\n    return new PolyBezier(offset);\n  }\n}\n\nexport { PolyBezier };\n","/**\n  A javascript Bezier curve library by Pomax.\n\n  Based on http://pomax.github.io/bezierinfo\n\n  This code is MIT licensed.\n**/\n\nimport { utils } from \"./utils.js\";\nimport { PolyBezier } from \"./poly-bezier.js\";\n\n// math-inlining.\nconst { abs, min, max, cos, sin, acos, sqrt } = Math;\nconst pi = Math.PI;\n// a zero coordinate, which is surprisingly useful\nconst ZERO = { x: 0, y: 0, z: 0 };\n\n/**\n * Bezier curve constructor.\n *\n * ...docs pending...\n */\nclass Bezier {\n  constructor(coords) {\n    let args =\n      coords && coords.forEach ? coords : Array.from(arguments).slice();\n    let coordlen = false;\n\n    if (typeof args[0] === \"object\") {\n      coordlen = args.length;\n      const newargs = [];\n      args.forEach(function (point) {\n        [\"x\", \"y\", \"z\"].forEach(function (d) {\n          if (typeof point[d] !== \"undefined\") {\n            newargs.push(point[d]);\n          }\n        });\n      });\n      args = newargs;\n    }\n\n    let higher = false;\n    const len = args.length;\n\n    if (coordlen) {\n      if (coordlen > 4) {\n        if (arguments.length !== 1) {\n          throw new Error(\n            \"Only new Bezier(point[]) is accepted for 4th and higher order curves\"\n          );\n        }\n        higher = true;\n      }\n    } else {\n      if (len !== 6 && len !== 8 && len !== 9 && len !== 12) {\n        if (arguments.length !== 1) {\n          throw new Error(\n            \"Only new Bezier(point[]) is accepted for 4th and higher order curves\"\n          );\n        }\n      }\n    }\n\n    const _3d = (this._3d =\n      (!higher && (len === 9 || len === 12)) ||\n      (coords && coords[0] && typeof coords[0].z !== \"undefined\"));\n\n    const points = (this.points = []);\n    for (let idx = 0, step = _3d ? 3 : 2; idx < len; idx += step) {\n      var point = {\n        x: args[idx],\n        y: args[idx + 1],\n      };\n      if (_3d) {\n        point.z = args[idx + 2];\n      }\n      points.push(point);\n    }\n    const order = (this.order = points.length - 1);\n\n    const dims = (this.dims = [\"x\", \"y\"]);\n    if (_3d) dims.push(\"z\");\n    this.dimlen = dims.length;\n\n    // is this curve, practically speaking, a straight line?\n    const aligned = utils.align(points, { p1: points[0], p2: points[order] });\n    const baselength = utils.dist(points[0], points[order]);\n    this._linear = aligned.reduce((t, p) => t + abs(p.y), 0) < baselength / 50;\n\n    this._lut = [];\n    this._t1 = 0;\n    this._t2 = 1;\n    this.update();\n  }\n\n  static quadraticFromPoints(p1, p2, p3, t) {\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    }\n    // shortcuts, although they're really dumb\n    if (t === 0) {\n      return new Bezier(p2, p2, p3);\n    }\n    if (t === 1) {\n      return new Bezier(p1, p2, p2);\n    }\n    // real fitting.\n    const abc = Bezier.getABC(2, p1, p2, p3, t);\n    return new Bezier(p1, abc.A, p3);\n  }\n\n  static cubicFromPoints(S, B, E, t, d1) {\n    if (typeof t === \"undefined\") {\n      t = 0.5;\n    }\n    const abc = Bezier.getABC(3, S, B, E, t);\n    if (typeof d1 === \"undefined\") {\n      d1 = utils.dist(B, abc.C);\n    }\n    const d2 = (d1 * (1 - t)) / t;\n\n    const selen = utils.dist(S, E),\n      lx = (E.x - S.x) / selen,\n      ly = (E.y - S.y) / selen,\n      bx1 = d1 * lx,\n      by1 = d1 * ly,\n      bx2 = d2 * lx,\n      by2 = d2 * ly;\n    // derivation of new hull coordinates\n    const e1 = { x: B.x - bx1, y: B.y - by1 },\n      e2 = { x: B.x + bx2, y: B.y + by2 },\n      A = abc.A,\n      v1 = { x: A.x + (e1.x - A.x) / (1 - t), y: A.y + (e1.y - A.y) / (1 - t) },\n      v2 = { x: A.x + (e2.x - A.x) / t, y: A.y + (e2.y - A.y) / t },\n      nc1 = { x: S.x + (v1.x - S.x) / t, y: S.y + (v1.y - S.y) / t },\n      nc2 = {\n        x: E.x + (v2.x - E.x) / (1 - t),\n        y: E.y + (v2.y - E.y) / (1 - t),\n      };\n    // ...done\n    return new Bezier(S, nc1, nc2, E);\n  }\n\n  static getUtils() {\n    return utils;\n  }\n\n  getUtils() {\n    return Bezier.getUtils();\n  }\n\n  static get PolyBezier() {\n    return PolyBezier;\n  }\n\n  valueOf() {\n    return this.toString();\n  }\n\n  toString() {\n    return utils.pointsToString(this.points);\n  }\n\n  toSVG() {\n    if (this._3d) return false;\n    const p = this.points,\n      x = p[0].x,\n      y = p[0].y,\n      s = [\"M\", x, y, this.order === 2 ? \"Q\" : \"C\"];\n    for (let i = 1, last = p.length; i < last; i++) {\n      s.push(p[i].x);\n      s.push(p[i].y);\n    }\n    return s.join(\" \");\n  }\n\n  setRatios(ratios) {\n    if (ratios.length !== this.points.length) {\n      throw new Error(\"incorrect number of ratio values\");\n    }\n    this.ratios = ratios;\n    this._lut = []; //  invalidate any precomputed LUT\n  }\n\n  verify() {\n    const print = this.coordDigest();\n    if (print !== this._print) {\n      this._print = print;\n      this.update();\n    }\n  }\n\n  coordDigest() {\n    return this.points\n      .map(function (c, pos) {\n        return \"\" + pos + c.x + c.y + (c.z ? c.z : 0);\n      })\n      .join(\"\");\n  }\n\n  update() {\n    // invalidate any precomputed LUT\n    this._lut = [];\n    this.dpoints = utils.derive(this.points, this._3d);\n    this.computedirection();\n  }\n\n  computedirection() {\n    const points = this.points;\n    const angle = utils.angle(points[0], points[this.order], points[1]);\n    this.clockwise = angle > 0;\n  }\n\n  length() {\n    return utils.length(this.derivative.bind(this));\n  }\n\n  static getABC(order = 2, S, B, E, t = 0.5) {\n    const u = utils.projectionratio(t, order),\n      um = 1 - u,\n      C = {\n        x: u * S.x + um * E.x,\n        y: u * S.y + um * E.y,\n      },\n      s = utils.abcratio(t, order),\n      A = {\n        x: B.x + (B.x - C.x) / s,\n        y: B.y + (B.y - C.y) / s,\n      };\n    return { A, B, C, S, E };\n  }\n\n  getABC(t, B) {\n    B = B || this.get(t);\n    let S = this.points[0];\n    let E = this.points[this.order];\n    return Bezier.getABC(this.order, S, B, E, t);\n  }\n\n  getLUT(steps) {\n    this.verify();\n    steps = steps || 100;\n    if (this._lut.length === steps + 1) {\n      return this._lut;\n    }\n    this._lut = [];\n    // n steps means n+1 points\n    steps++;\n    this._lut = [];\n    for (let i = 0, p, t; i < steps; i++) {\n      t = i / (steps - 1);\n      p = this.compute(t);\n      p.t = t;\n      this._lut.push(p);\n    }\n    return this._lut;\n  }\n\n  on(point, error) {\n    error = error || 5;\n    const lut = this.getLUT(),\n      hits = [];\n    for (let i = 0, c, t = 0; i < lut.length; i++) {\n      c = lut[i];\n      if (utils.dist(c, point) < error) {\n        hits.push(c);\n        t += i / lut.length;\n      }\n    }\n    if (!hits.length) return false;\n    return (t /= hits.length);\n  }\n\n  project(point) {\n    // step 1: coarse check\n    const LUT = this.getLUT(),\n      l = LUT.length - 1,\n      closest = utils.closest(LUT, point),\n      mpos = closest.mpos,\n      t1 = (mpos - 1) / l,\n      t2 = (mpos + 1) / l,\n      step = 0.1 / l;\n\n    // step 2: fine check\n    let mdist = closest.mdist,\n      t = t1,\n      ft = t,\n      p;\n    mdist += 1;\n    for (let d; t < t2 + step; t += step) {\n      p = this.compute(t);\n      d = utils.dist(point, p);\n      if (d < mdist) {\n        mdist = d;\n        ft = t;\n      }\n    }\n    ft = ft < 0 ? 0 : ft > 1 ? 1 : ft;\n    p = this.compute(ft);\n    p.t = ft;\n    p.d = mdist;\n    return p;\n  }\n\n  get(t) {\n    return this.compute(t);\n  }\n\n  point(idx) {\n    return this.points[idx];\n  }\n\n  compute(t) {\n    if (this.ratios) {\n      return utils.computeWithRatios(t, this.points, this.ratios, this._3d);\n    }\n    return utils.compute(t, this.points, this._3d, this.ratios);\n  }\n\n  raise() {\n    const p = this.points,\n      np = [p[0]],\n      k = p.length;\n    for (let i = 1, pi, pim; i < k; i++) {\n      pi = p[i];\n      pim = p[i - 1];\n      np[i] = {\n        x: ((k - i) / k) * pi.x + (i / k) * pim.x,\n        y: ((k - i) / k) * pi.y + (i / k) * pim.y,\n      };\n    }\n    np[k] = p[k - 1];\n    return new Bezier(np);\n  }\n\n  derivative(t) {\n    return utils.compute(t, this.dpoints[0], this._3d);\n  }\n\n  dderivative(t) {\n    return utils.compute(t, this.dpoints[1], this._3d);\n  }\n\n  align() {\n    let p = this.points;\n    return new Bezier(utils.align(p, { p1: p[0], p2: p[p.length - 1] }));\n  }\n\n  curvature(t) {\n    return utils.curvature(t, this.dpoints[0], this.dpoints[1], this._3d);\n  }\n\n  inflections() {\n    return utils.inflections(this.points);\n  }\n\n  normal(t) {\n    return this._3d ? this.__normal3(t) : this.__normal2(t);\n  }\n\n  __normal2(t) {\n    const d = this.derivative(t);\n    const q = sqrt(d.x * d.x + d.y * d.y);\n    return { t, x: -d.y / q, y: d.x / q };\n  }\n\n  __normal3(t) {\n    // see http://stackoverflow.com/questions/25453159\n    const r1 = this.derivative(t),\n      r2 = this.derivative(t + 0.01),\n      q1 = sqrt(r1.x * r1.x + r1.y * r1.y + r1.z * r1.z),\n      q2 = sqrt(r2.x * r2.x + r2.y * r2.y + r2.z * r2.z);\n    r1.x /= q1;\n    r1.y /= q1;\n    r1.z /= q1;\n    r2.x /= q2;\n    r2.y /= q2;\n    r2.z /= q2;\n    // cross product\n    const c = {\n      x: r2.y * r1.z - r2.z * r1.y,\n      y: r2.z * r1.x - r2.x * r1.z,\n      z: r2.x * r1.y - r2.y * r1.x,\n    };\n    const m = sqrt(c.x * c.x + c.y * c.y + c.z * c.z);\n    c.x /= m;\n    c.y /= m;\n    c.z /= m;\n    // rotation matrix\n    const R = [\n      c.x * c.x,\n      c.x * c.y - c.z,\n      c.x * c.z + c.y,\n      c.x * c.y + c.z,\n      c.y * c.y,\n      c.y * c.z - c.x,\n      c.x * c.z - c.y,\n      c.y * c.z + c.x,\n      c.z * c.z,\n    ];\n    // normal vector:\n    const n = {\n      t,\n      x: R[0] * r1.x + R[1] * r1.y + R[2] * r1.z,\n      y: R[3] * r1.x + R[4] * r1.y + R[5] * r1.z,\n      z: R[6] * r1.x + R[7] * r1.y + R[8] * r1.z,\n    };\n    return n;\n  }\n\n  hull(t) {\n    let p = this.points,\n      _p = [],\n      q = [],\n      idx = 0;\n    q[idx++] = p[0];\n    q[idx++] = p[1];\n    q[idx++] = p[2];\n    if (this.order === 3) {\n      q[idx++] = p[3];\n    }\n    // we lerp between all points at each iteration, until we have 1 point left.\n    while (p.length > 1) {\n      _p = [];\n      for (let i = 0, pt, l = p.length - 1; i < l; i++) {\n        pt = utils.lerp(t, p[i], p[i + 1]);\n        q[idx++] = pt;\n        _p.push(pt);\n      }\n      p = _p;\n    }\n    return q;\n  }\n\n  split(t1, t2) {\n    // shortcuts\n    if (t1 === 0 && !!t2) {\n      return this.split(t2).left;\n    }\n    if (t2 === 1) {\n      return this.split(t1).right;\n    }\n\n    // no shortcut: use \"de Casteljau\" iteration.\n    const q = this.hull(t1);\n    const result = {\n      left:\n        this.order === 2\n          ? new Bezier([q[0], q[3], q[5]])\n          : new Bezier([q[0], q[4], q[7], q[9]]),\n      right:\n        this.order === 2\n          ? new Bezier([q[5], q[4], q[2]])\n          : new Bezier([q[9], q[8], q[6], q[3]]),\n      span: q,\n    };\n\n    // make sure we bind _t1/_t2 information!\n    result.left._t1 = utils.map(0, 0, 1, this._t1, this._t2);\n    result.left._t2 = utils.map(t1, 0, 1, this._t1, this._t2);\n    result.right._t1 = utils.map(t1, 0, 1, this._t1, this._t2);\n    result.right._t2 = utils.map(1, 0, 1, this._t1, this._t2);\n\n    // if we have no t2, we're done\n    if (!t2) {\n      return result;\n    }\n\n    // if we have a t2, split again:\n    t2 = utils.map(t2, t1, 1, 0, 1);\n    return result.right.split(t2).left;\n  }\n\n  extrema() {\n    const result = {};\n    let roots = [];\n\n    this.dims.forEach(\n      function (dim) {\n        let mfn = function (v) {\n          return v[dim];\n        };\n        let p = this.dpoints[0].map(mfn);\n        result[dim] = utils.droots(p);\n        if (this.order === 3) {\n          p = this.dpoints[1].map(mfn);\n          result[dim] = result[dim].concat(utils.droots(p));\n        }\n        result[dim] = result[dim].filter(function (t) {\n          return t >= 0 && t <= 1;\n        });\n        roots = roots.concat(result[dim].sort(utils.numberSort));\n      }.bind(this)\n    );\n\n    result.values = roots.sort(utils.numberSort).filter(function (v, idx) {\n      return roots.indexOf(v) === idx;\n    });\n\n    return result;\n  }\n\n  bbox() {\n    const extrema = this.extrema(),\n      result = {};\n    this.dims.forEach(\n      function (d) {\n        result[d] = utils.getminmax(this, d, extrema[d]);\n      }.bind(this)\n    );\n    return result;\n  }\n\n  overlaps(curve) {\n    const lbbox = this.bbox(),\n      tbbox = curve.bbox();\n    return utils.bboxoverlap(lbbox, tbbox);\n  }\n\n  offset(t, d) {\n    if (typeof d !== \"undefined\") {\n      const c = this.get(t),\n        n = this.normal(t);\n      const ret = {\n        c: c,\n        n: n,\n        x: c.x + n.x * d,\n        y: c.y + n.y * d,\n      };\n      if (this._3d) {\n        ret.z = c.z + n.z * d;\n      }\n      return ret;\n    }\n    if (this._linear) {\n      const nv = this.normal(0),\n        coords = this.points.map(function (p) {\n          const ret = {\n            x: p.x + t * nv.x,\n            y: p.y + t * nv.y,\n          };\n          if (p.z && nv.z) {\n            ret.z = p.z + t * nv.z;\n          }\n          return ret;\n        });\n      return [new Bezier(coords)];\n    }\n    return this.reduce().map(function (s) {\n      if (s._linear) {\n        return s.offset(t)[0];\n      }\n      return s.scale(t);\n    });\n  }\n\n  simple() {\n    if (this.order === 3) {\n      const a1 = utils.angle(this.points[0], this.points[3], this.points[1]);\n      const a2 = utils.angle(this.points[0], this.points[3], this.points[2]);\n      if ((a1 > 0 && a2 < 0) || (a1 < 0 && a2 > 0)) return false;\n    }\n    const n1 = this.normal(0);\n    const n2 = this.normal(1);\n    let s = n1.x * n2.x + n1.y * n2.y;\n    if (this._3d) {\n      s += n1.z * n2.z;\n    }\n    return abs(acos(s)) < pi / 3;\n  }\n\n  reduce() {\n    // TODO: examine these var types in more detail...\n    let i,\n      t1 = 0,\n      t2 = 0,\n      step = 0.01,\n      segment,\n      pass1 = [],\n      pass2 = [];\n    // first pass: split on extrema\n    let extrema = this.extrema().values;\n    if (extrema.indexOf(0) === -1) {\n      extrema = [0].concat(extrema);\n    }\n    if (extrema.indexOf(1) === -1) {\n      extrema.push(1);\n    }\n\n    for (t1 = extrema[0], i = 1; i < extrema.length; i++) {\n      t2 = extrema[i];\n      segment = this.split(t1, t2);\n      segment._t1 = t1;\n      segment._t2 = t2;\n      pass1.push(segment);\n      t1 = t2;\n    }\n\n    // second pass: further reduce these segments to simple segments\n    pass1.forEach(function (p1) {\n      t1 = 0;\n      t2 = 0;\n      while (t2 <= 1) {\n        for (t2 = t1 + step; t2 <= 1 + step; t2 += step) {\n          segment = p1.split(t1, t2);\n          if (!segment.simple()) {\n            t2 -= step;\n            if (abs(t1 - t2) < step) {\n              // we can never form a reduction\n              return [];\n            }\n            segment = p1.split(t1, t2);\n            segment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);\n            segment._t2 = utils.map(t2, 0, 1, p1._t1, p1._t2);\n            pass2.push(segment);\n            t1 = t2;\n            break;\n          }\n        }\n      }\n      if (t1 < 1) {\n        segment = p1.split(t1, 1);\n        segment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);\n        segment._t2 = p1._t2;\n        pass2.push(segment);\n      }\n    });\n    return pass2;\n  }\n\n  translate(v, d1, d2) {\n    d2 = typeof d2 === \"number\" ? d2 : d1;\n\n    // TODO: make this take curves with control points outside\n    //       of the start-end interval into account\n\n    const o = this.order;\n    let d = this.points.map((_, i) => (1 - i / o) * d1 + (i / o) * d2);\n    return new Bezier(\n      this.points.map((p, i) => ({\n        x: p.x + v.x * d[i],\n        y: p.y + v.y * d[i],\n      }))\n    );\n  }\n\n  scale(d) {\n    const order = this.order;\n    let distanceFn = false;\n    if (typeof d === \"function\") {\n      distanceFn = d;\n    }\n    if (distanceFn && order === 2) {\n      return this.raise().scale(distanceFn);\n    }\n\n    // TODO: add special handling for non-linear degenerate curves.\n\n    const clockwise = this.clockwise;\n    const points = this.points;\n\n    if (this._linear) {\n      return this.translate(\n        this.normal(0),\n        distanceFn ? distanceFn(0) : d,\n        distanceFn ? distanceFn(1) : d\n      );\n    }\n\n    const r1 = distanceFn ? distanceFn(0) : d;\n    const r2 = distanceFn ? distanceFn(1) : d;\n    const v = [this.offset(0, 10), this.offset(1, 10)];\n    const np = [];\n    const o = utils.lli4(v[0], v[0].c, v[1], v[1].c);\n\n    if (!o) {\n      throw new Error(\"cannot scale this curve. Try reducing it first.\");\n    }\n\n    // move all points by distance 'd' wrt the origin 'o',\n    // and move end points by fixed distance along normal.\n    [0, 1].forEach(function (t) {\n      const p = (np[t * order] = utils.copy(points[t * order]));\n      p.x += (t ? r2 : r1) * v[t].n.x;\n      p.y += (t ? r2 : r1) * v[t].n.y;\n    });\n\n    if (!distanceFn) {\n      // move control points to lie on the intersection of the offset\n      // derivative vector, and the origin-through-control vector\n      [0, 1].forEach((t) => {\n        if (order === 2 && !!t) return;\n        const p = np[t * order];\n        const d = this.derivative(t);\n        const p2 = { x: p.x + d.x, y: p.y + d.y };\n        np[t + 1] = utils.lli4(p, p2, o, points[t + 1]);\n      });\n      return new Bezier(np);\n    }\n\n    // move control points by \"however much necessary to\n    // ensure the correct tangent to endpoint\".\n    [0, 1].forEach(function (t) {\n      if (order === 2 && !!t) return;\n      var p = points[t + 1];\n      var ov = {\n        x: p.x - o.x,\n        y: p.y - o.y,\n      };\n      var rc = distanceFn ? distanceFn((t + 1) / order) : d;\n      if (distanceFn && !clockwise) rc = -rc;\n      var m = sqrt(ov.x * ov.x + ov.y * ov.y);\n      ov.x /= m;\n      ov.y /= m;\n      np[t + 1] = {\n        x: p.x + rc * ov.x,\n        y: p.y + rc * ov.y,\n      };\n    });\n    return new Bezier(np);\n  }\n\n  outline(d1, d2, d3, d4) {\n    d2 = d2 === undefined ? d1 : d2;\n\n    if (this._linear) {\n      // TODO: find the actual extrema, because they might\n      //       be before the start, or past the end.\n\n      const n = this.normal(0);\n      const start = this.points[0];\n      const end = this.points[this.points.length - 1];\n      let s, mid, e;\n\n      if (d3 === undefined) {\n        d3 = d1;\n        d4 = d2;\n      }\n\n      s = { x: start.x + n.x * d1, y: start.y + n.y * d1 };\n      e = { x: end.x + n.x * d3, y: end.y + n.y * d3 };\n      mid = { x: (s.x + e.x) / 2, y: (s.y + e.y) / 2 };\n      const fline = [s, mid, e];\n\n      s = { x: start.x - n.x * d2, y: start.y - n.y * d2 };\n      e = { x: end.x - n.x * d4, y: end.y - n.y * d4 };\n      mid = { x: (s.x + e.x) / 2, y: (s.y + e.y) / 2 };\n      const bline = [e, mid, s];\n\n      const ls = utils.makeline(bline[2], fline[0]);\n      const le = utils.makeline(fline[2], bline[0]);\n      const segments = [ls, new Bezier(fline), le, new Bezier(bline)];\n      return new PolyBezier(segments);\n    }\n\n    const reduced = this.reduce(),\n      len = reduced.length,\n      fcurves = [];\n\n    let bcurves = [],\n      p,\n      alen = 0,\n      tlen = this.length();\n\n    const graduated = typeof d3 !== \"undefined\" && typeof d4 !== \"undefined\";\n\n    function linearDistanceFunction(s, e, tlen, alen, slen) {\n      return function (v) {\n        const f1 = alen / tlen,\n          f2 = (alen + slen) / tlen,\n          d = e - s;\n        return utils.map(v, 0, 1, s + f1 * d, s + f2 * d);\n      };\n    }\n\n    // form curve oulines\n    reduced.forEach(function (segment) {\n      const slen = segment.length();\n      if (graduated) {\n        fcurves.push(\n          segment.scale(linearDistanceFunction(d1, d3, tlen, alen, slen))\n        );\n        bcurves.push(\n          segment.scale(linearDistanceFunction(-d2, -d4, tlen, alen, slen))\n        );\n      } else {\n        fcurves.push(segment.scale(d1));\n        bcurves.push(segment.scale(-d2));\n      }\n      alen += slen;\n    });\n\n    // reverse the \"return\" outline\n    bcurves = bcurves\n      .map(function (s) {\n        p = s.points;\n        if (p[3]) {\n          s.points = [p[3], p[2], p[1], p[0]];\n        } else {\n          s.points = [p[2], p[1], p[0]];\n        }\n        return s;\n      })\n      .reverse();\n\n    // form the endcaps as lines\n    const fs = fcurves[0].points[0],\n      fe = fcurves[len - 1].points[fcurves[len - 1].points.length - 1],\n      bs = bcurves[len - 1].points[bcurves[len - 1].points.length - 1],\n      be = bcurves[0].points[0],\n      ls = utils.makeline(bs, fs),\n      le = utils.makeline(fe, be),\n      segments = [ls].concat(fcurves).concat([le]).concat(bcurves);\n\n    return new PolyBezier(segments);\n  }\n\n  outlineshapes(d1, d2, curveIntersectionThreshold) {\n    d2 = d2 || d1;\n    const outline = this.outline(d1, d2).curves;\n    const shapes = [];\n    for (let i = 1, len = outline.length; i < len / 2; i++) {\n      const shape = utils.makeshape(\n        outline[i],\n        outline[len - i],\n        curveIntersectionThreshold\n      );\n      shape.startcap.virtual = i > 1;\n      shape.endcap.virtual = i < len / 2 - 1;\n      shapes.push(shape);\n    }\n    return shapes;\n  }\n\n  intersects(curve, curveIntersectionThreshold) {\n    if (!curve) return this.selfintersects(curveIntersectionThreshold);\n    if (curve.p1 && curve.p2) {\n      return this.lineIntersects(curve);\n    }\n    if (curve instanceof Bezier) {\n      curve = curve.reduce();\n    }\n    return this.curveintersects(\n      this.reduce(),\n      curve,\n      curveIntersectionThreshold\n    );\n  }\n\n  lineIntersects(line) {\n    const mx = min(line.p1.x, line.p2.x),\n      my = min(line.p1.y, line.p2.y),\n      MX = max(line.p1.x, line.p2.x),\n      MY = max(line.p1.y, line.p2.y);\n    return utils.roots(this.points, line).filter((t) => {\n      var p = this.get(t);\n      return utils.between(p.x, mx, MX) && utils.between(p.y, my, MY);\n    });\n  }\n\n  selfintersects(curveIntersectionThreshold) {\n    // \"simple\" curves cannot intersect with their direct\n    // neighbour, so for each segment X we check whether\n    // it intersects [0:x-2][x+2:last].\n\n    const reduced = this.reduce(),\n      len = reduced.length - 2,\n      results = [];\n\n    for (let i = 0, result, left, right; i < len; i++) {\n      left = reduced.slice(i, i + 1);\n      right = reduced.slice(i + 2);\n      result = this.curveintersects(left, right, curveIntersectionThreshold);\n      results.push(...result);\n    }\n    return results;\n  }\n\n  curveintersects(c1, c2, curveIntersectionThreshold) {\n    const pairs = [];\n    // step 1: pair off any overlapping segments\n    c1.forEach(function (l) {\n      c2.forEach(function (r) {\n        if (l.overlaps(r)) {\n          pairs.push({ left: l, right: r });\n        }\n      });\n    });\n    // step 2: for each pairing, run through the convergence algorithm.\n    let intersections = [];\n    pairs.forEach(function (pair) {\n      const result = utils.pairiteration(\n        pair.left,\n        pair.right,\n        curveIntersectionThreshold\n      );\n      if (result.length > 0) {\n        intersections = intersections.concat(result);\n      }\n    });\n    return intersections;\n  }\n\n  arcs(errorThreshold) {\n    errorThreshold = errorThreshold || 0.5;\n    return this._iterate(errorThreshold, []);\n  }\n\n  _error(pc, np1, s, e) {\n    const q = (e - s) / 4,\n      c1 = this.get(s + q),\n      c2 = this.get(e - q),\n      ref = utils.dist(pc, np1),\n      d1 = utils.dist(pc, c1),\n      d2 = utils.dist(pc, c2);\n    return abs(d1 - ref) + abs(d2 - ref);\n  }\n\n  _iterate(errorThreshold, circles) {\n    let t_s = 0,\n      t_e = 1,\n      safety;\n    // we do a binary search to find the \"good `t` closest to no-longer-good\"\n    do {\n      safety = 0;\n\n      // step 1: start with the maximum possible arc\n      t_e = 1;\n\n      // points:\n      let np1 = this.get(t_s),\n        np2,\n        np3,\n        arc,\n        prev_arc;\n\n      // booleans:\n      let curr_good = false,\n        prev_good = false,\n        done;\n\n      // numbers:\n      let t_m = t_e,\n        prev_e = 1,\n        step = 0;\n\n      // step 2: find the best possible arc\n      do {\n        prev_good = curr_good;\n        prev_arc = arc;\n        t_m = (t_s + t_e) / 2;\n        step++;\n\n        np2 = this.get(t_m);\n        np3 = this.get(t_e);\n\n        arc = utils.getccenter(np1, np2, np3);\n\n        //also save the t values\n        arc.interval = {\n          start: t_s,\n          end: t_e,\n        };\n\n        let error = this._error(arc, np1, t_s, t_e);\n        curr_good = error <= errorThreshold;\n\n        done = prev_good && !curr_good;\n        if (!done) prev_e = t_e;\n\n        // this arc is fine: we can move 'e' up to see if we can find a wider arc\n        if (curr_good) {\n          // if e is already at max, then we're done for this arc.\n          if (t_e >= 1) {\n            // make sure we cap at t=1\n            arc.interval.end = prev_e = 1;\n            prev_arc = arc;\n            // if we capped the arc segment to t=1 we also need to make sure that\n            // the arc's end angle is correct with respect to the bezier end point.\n            if (t_e > 1) {\n              let d = {\n                x: arc.x + arc.r * cos(arc.e),\n                y: arc.y + arc.r * sin(arc.e),\n              };\n              arc.e += utils.angle({ x: arc.x, y: arc.y }, d, this.get(1));\n            }\n            break;\n          }\n          // if not, move it up by half the iteration distance\n          t_e = t_e + (t_e - t_s) / 2;\n        } else {\n          // this is a bad arc: we need to move 'e' down to find a good arc\n          t_e = t_m;\n        }\n      } while (!done && safety++ < 100);\n\n      if (safety >= 100) {\n        break;\n      }\n\n      // console.log(\"L835: [F] arc found\", t_s, prev_e, prev_arc.x, prev_arc.y, prev_arc.s, prev_arc.e);\n\n      prev_arc = prev_arc ? prev_arc : arc;\n      circles.push(prev_arc);\n      t_s = prev_e;\n    } while (t_e < 1);\n    return circles;\n  }\n}\n\nexport { Bezier };\n","import {type Path} from './Path.js';\nimport {degreeToRadian, Points} from './index.js';\n\n/**\n * An ellipse\n */\nexport type Ellipse = {\n  readonly radiusX: number\n  readonly radiusY: number\n  /**\n   * Rotation, in radians\n   */\n  readonly rotation?: number\n  readonly startAngle?: number\n  readonly endAngle?: number\n}\n\n/**\n * A {@link Ellipse} with position\n */\nexport type EllipsePositioned = Points.Point & Ellipse\n\n\nexport const fromDegrees = (radiusX: number, radiusY: number, rotationDeg: number = 0, startAngleDeg: number = 0, endAngleDeg: number = 360): Ellipse => ({\n  radiusX, radiusY,\n  rotation: degreeToRadian(rotationDeg),\n  startAngle: degreeToRadian(startAngleDeg),\n  endAngle: degreeToRadian(endAngleDeg)\n});\n\nexport type EllipticalPath = Ellipse & Path & {\n  readonly kind: `elliptical`\n};","/* eslint-disable */\nimport * as d3Colour from 'd3-color';\nimport * as d3Interpolate from 'd3-interpolate';\nimport { defaultRandom, type RandomSource } from '../Random.js';\nimport { throwNumberTest } from '../Guards.js';\n\nexport type Hsl = { h: number; s: number; l: number; opacity?: number };\nexport type Rgb = { r: number; g: number; b: number; opacity?: number };\nexport type Spaces = `hsl` | `rgb` | `lab` | `hcl` | `cubehelix`;\n/**\n * @private\n */\nexport type Colour = d3Colour.RGBColor | d3Colour.HSLColor;\n\n/**\n * A representation of colour. Eg: `blue`, `rgb(255,0,0)`, `hsl(20,100%,50%)`\n */\nexport type Colourish = string | d3Colour.ColorCommonInstance;\n\n/**\n * Options for interpolation\n */\nexport type InterpolationOpts = {\n  /**\n   * Gamma correction. Eg 4 brightens values. Only applies to rgb and cubehelix\n   * [Read more](https://github.com/d3/d3-interpolate#interpolate_gamma)\n   */\n  gamma?: number;\n  /**\n   * Colour space\n   */\n  space?: Spaces;\n  /**\n   * If true, interpolation happens the longer distance. Only applies to hsl, hcl and cubehelix\n   */\n  long?: boolean;\n};\n\n/**\n * Parses colour to `{ h, s, l }`. `opacity` field is added if it exists on source.\n * @param colour\n * @returns\n */\nexport const toHsl = (colour: Colourish): Hsl => {\n  const c = resolveColour(colour);\n  if (c === null) throw new Error(`Could not resolve colour ${ colour }`);\n\n  if (isHsl(c)) return c;\n  if (isRgb(c)) {\n    const asHsl = d3Colour.hsl(c);\n    if (c.opacity) return { ...asHsl, opacity: c.opacity };\n    return asHsl;\n  }\n  throw new Error(`Could not resolve colour ${ colour }`);\n};\n\n/**\n * Returns a full HSL colour string (eg `hsl(20,50%,75%)`) based on a index.\n * It's useful for generating perceptually different shades as the index increments.\n *\n * ```\n * el.style.backgroundColor = goldenAgeColour(10);\n * ```\n *\n * Saturation and lightness can be specified, as numeric ranges of 0-1.\n *\n * @param saturation Saturation (0-1), defaults to 0.5\n * @param lightness Lightness (0-1), defaults to 0.75\n * @param alpha Opacity (0-1), defaults to 1.0\n * @returns HSL colour string eg `hsl(20,50%,75%)`\n */\nexport const goldenAngleColour = (\n  index: number,\n  saturation = 0.5,\n  lightness = 0.75,\n  alpha = 1.0\n) => {\n  throwNumberTest(index, `positive`, `index`);\n  throwNumberTest(saturation, `percentage`, `saturation`);\n  throwNumberTest(lightness, `percentage`, `lightness`);\n  throwNumberTest(alpha, `percentage`, `alpha`);\n\n  // Via Stackoverflow\n  const hue = index * 137.508; // use golden angle approximation\n  if (alpha === 1)\n    return `hsl(${ hue },${ saturation * 100 }%,${ lightness * 100 }%)`;\n  else\n    return `hsl(${ hue },${ saturation * 100 }%,${ lightness * 100 }%,${ alpha * 100\n      }%)`;\n};\n\n/**\n * Returns a random hue component\n * ```\n * // Generate hue\n * const h =randomHue(); // 0-359\n *\n * // Generate hue and assign as part of a HSL string\n * el.style.backgroundColor = `hsl(${randomHue(), 50%, 75%})`;\n * ```\n * @param rand\n * @returns\n */\nexport const randomHue = (rand: RandomSource = defaultRandom): number => {\n  const r = rand();\n  return r * 360;\n};\n\n/**\n * Parses colour to `{ r, g, b }`. `opacity` field is added if it exists on source.\n * [Named colours](https://html-color-codes.info/color-names/)\n * @param colour\n * @returns\n */\nexport const toRgb = (colour: Colourish): Rgb => {\n  const c = resolveColour(colour);\n  const rgb = c.rgb();\n  if (c.opacity < 1)\n    return { r: rgb.r, g: rgb.g, b: rgb.b, opacity: c.opacity };\n  else return { r: rgb.r, g: rgb.g, b: rgb.b };\n};\n\nconst resolveColour = (c: Colourish): Colour => {\n  if (typeof c === `string`) {\n    const css = d3Colour.color(c);\n    if (css !== null) return css;\n    if (c.startsWith(`hsl`) && c.indexOf('%') <= 0) throw new Error(`Could not resolve CSS colour ${ c }. HSL values should be in the form: hsl(0, 50%, 50%)`);\n    else throw new Error(`Could not resolve CSS colour ${ c }`);\n  } else {\n    if (isHsl(c)) return d3Colour.hsl(c.h, c.s, c.l);\n    if (isRgb(c)) return d3Colour.rgb(c.r, c.g, c.b);\n  }\n  throw new Error(`Could not resolve colour ${ JSON.stringify(c) }`);\n};\n\n/**\n * Returns a colour in hex format `#000000`\n * @param colour\n * @returns Hex format, including #\n */\nexport const toHex = (colour: Colourish): string => {\n  const c = resolveColour(colour);\n  return c.formatHex();\n};\n\n/**\n * Returns a variation of colour with its opacity multiplied by `amt`.\n *\n * ```js\n * // Return a colour string for blue that is 50% opaque\n * opacity(`blue`, 0.5);\n * // eg: `rgba(0,0,255,0.5)`\n *\n * // Returns a colour string that is 50% more opaque\n * opacity(`hsla(200,100%,50%,50%`, 0.5);\n * // eg: `hsla(200,100%,50%,25%)`\n * ```\n *\n * [Named colours](https://html-color-codes.info/color-names/)\n * @param colour A valid CSS colour\n * @param amt Amount to multiply opacity by\n * @returns String representation of colour\n */\nexport const opacity = (colour: Colourish, amt: number): string => {\n  const c = resolveColour(colour);\n  c.opacity *= amt;\n  return c.toString();\n};\n\n/**\n * Gets a CSS variable.\n * @example Fetch --accent variable, or use `yellow` if not found.\n * ```\n * getCssVariable(`accent`, `yellow`);\n * ```\n * @param name Name of variable. Omit the `--`\n * @param fallbackColour Fallback colour if not found\n * @param root  Element to search variable from\n * @returns Colour or fallback.\n */\nexport const getCssVariable = (\n  name: string,\n  fallbackColour: string = `black`,\n  root?: HTMLElement\n): string => {\n  if (root === undefined) root = document.body;\n  const fromCss = getComputedStyle(root).getPropertyValue(`--${ name }`).trim();\n  if (fromCss === undefined || fromCss.length === 0) return fallbackColour;\n  return fromCss;\n};\n\n/**\n * Interpolates between two colours, returning a string in the form `rgb(r,g,b)`\n *\n * @example\n * ```js\n * // Get 50% between blue and red\n * interpolate(0.5, `blue`, `red`);\n *\n * // Get midway point, with specified colour space\n * interpolate(0.5, `hsl(200, 100%, 50%)`, `pink`, {space: `hcl`});\n * ```\n *\n * [Named colours](https://html-color-codes.info/color-names/)\n * @param amount Amount (0 = from, 0.5 halfway, 1= to)\n * @param from Starting colour\n * @param to Final colour\n * @param optsOrSpace Options for interpolation, or string name for colour space, eg `hsl`.\n * @returns String representation of colour, eg. `rgb(r,g,b)`\n */\nexport const interpolate = (\n  amount: number,\n  from: Colourish,\n  to: Colourish,\n  optsOrSpace?: string | InterpolationOpts\n): string => {\n  throwNumberTest(amount, `percentage`, `amount`);\n  if (typeof from !== `string`)\n    throw new Error(`Expected string for 'from' param`);\n  if (typeof to !== `string`) throw new Error(`Expected string for 'to' param`);\n\n  let opts: InterpolationOpts;\n  if (typeof optsOrSpace === `undefined`) opts = {};\n  else if (typeof optsOrSpace === `string`)\n    opts = { space: optsOrSpace as Spaces };\n  else opts = optsOrSpace as InterpolationOpts;\n\n  const inter = getInterpolator(opts, [ from, to ]);\n  if (inter === undefined) throw new Error(`Could not handle colour/space`);\n  return inter(amount);\n};\n\nconst getInterpolator = (\n  optsOrSpace: InterpolationOpts | string,\n  colours: Colourish[]\n): ((t: number) => string) | undefined => {\n  if (!Array.isArray(colours))\n    throw new Error(`Expected one or more colours as parameters`);\n\n  let opts: InterpolationOpts;\n  if (typeof optsOrSpace === `undefined`) opts = {};\n  else if (typeof optsOrSpace === `string`)\n    opts = { space: optsOrSpace as Spaces };\n  else opts = optsOrSpace as InterpolationOpts;\n\n  if (!Array.isArray(colours))\n    throw new Error(`Expected array for colours parameter`);\n  if (colours.length < 2)\n    throw new Error(`Interpolation expects at least two colours`);\n  const { space = `rgb`, long = false } = opts;\n  let inter;\n\n  switch (space) {\n    case `lab`:\n      inter = d3Interpolate.interpolateLab;\n      break;\n    case `hsl`:\n      inter = long\n        ? d3Interpolate.interpolateHslLong\n        : d3Interpolate.interpolateHsl;\n      break;\n    case `hcl`:\n      inter = long\n        ? d3Interpolate.interpolateHclLong\n        : d3Interpolate.interpolateHcl;\n      break;\n    case `cubehelix`:\n      inter = long\n        ? d3Interpolate.interpolateCubehelixLong\n        : d3Interpolate.interpolateCubehelix;\n      break;\n    case `rgb`:\n      inter = d3Interpolate.interpolateRgb;\n    default:\n      inter = d3Interpolate.interpolateRgb;\n  }\n\n  if (opts.gamma) {\n    if (space === `rgb` || space === `cubehelix`) {\n      inter = (inter as d3Interpolate.ColorGammaInterpolationFactory).gamma(\n        opts.gamma\n      );\n    }\n  }\n\n  if (colours.length > 2) {\n    return d3Interpolate.piecewise(inter, colours);\n  } else return inter(colours[ 0 ], colours[ 1 ]);\n};\n\n/**\n * Produces a scale of colours as a string array\n *\n * @example\n * ```js\n * // Yields array of 5 colour strings\n * const s = scale(5, {space:`hcl`}, `blue`, `red`);\n * // Produces scale between three colours\n * const s = scale(5, {space:`hcl`}, `blue`, `yellow`, `red`);\n * ```\n * @param steps Number of colours\n * @param opts Options for interpolation, or string colour space eg `hsl`\n * @param colours From/end colours (or more)\n * @returns\n */\nexport const scale = (\n  steps: number,\n  opts: InterpolationOpts | string,\n  ...colours: Colourish[]\n): string[] => {\n  throwNumberTest(steps, `aboveZero`, `steps`);\n  if (!Array.isArray(colours))\n    throw new Error(`Expected one or more colours as parameters`);\n  const inter = getInterpolator(opts, colours);\n  if (inter === undefined) throw new Error(`Could not handle colour/space`);\n\n  const perStep = 1 / (steps - 1);\n  const r = [];\n  //eslint-disable-next-line functional/no-let\n  let amt = 0;\n  //eslint-disable-next-line functional/no-let\n  for (let i = 0; i < steps; i++) {\n    //eslint-disable-next-line functional/immutable-data\n    r.push(inter(amt));\n    amt += perStep;\n    if (amt > 1) amt = 1;\n  }\n  return r;\n};\n\nconst isHsl = (p: Colour | d3Colour.ColorCommonInstance | Hsl): p is Hsl => {\n  if ((p as Hsl).h === undefined) return false;\n  if ((p as Hsl).s === undefined) return false;\n  if ((p as Hsl).l === undefined) return false;\n  return true;\n};\n\nconst isRgb = (p: Colour | d3Colour.ColorCommonInstance | Rgb): p is Rgb => {\n  if ((p as Rgb).r === undefined) return false;\n  if ((p as Rgb).g === undefined) return false;\n  if ((p as Rgb).b === undefined) return false;\n  return true;\n};\n\n// const rgbToHsl = (r: number, g: number, b: number): Hsl => {\n//   r /= 255;\n//   g /= 255;\n//   b /= 255;\n\n//   var min = Math.min(r, g, b),\n//     max = Math.max(r, g, b),\n//     delta = max - min,\n//     h,\n//     s,\n//     l;\n\n//   h = 0;\n//   if (max === min) {\n//     h = 0;\n//   } else if (r === max) {\n//     h = (g - b) / delta;\n//   } else if (g === max) {\n//     h = 2 + (b - r) / delta;\n//   } else if (b === max) {\n//     h = 4 + (r - g) / delta;\n//   }\n\n//   h = Math.min(h * 60, 360);\n\n//   if (h < 0) {\n//     h += 360;\n//   }\n\n//   l = (min + max) / 2;\n\n//   if (max === min) {\n//     s = 0;\n//   } else if (l <= 0.5) {\n//     s = delta / (max + min);\n//   } else {\n//     s = delta / (2 - max - min);\n//   }\n\n//   return {h, s, l};\n// };\n","export default function(constructor, factory, prototype) {\n  constructor.prototype = factory.prototype = prototype;\n  prototype.constructor = constructor;\n}\n\nexport function extend(parent, definition) {\n  var prototype = Object.create(parent.prototype);\n  for (var key in definition) prototype[key] = definition[key];\n  return prototype;\n}\n","import define, {extend} from \"./define.js\";\n\nexport function Color() {}\n\nexport var darker = 0.7;\nexport var brighter = 1 / darker;\n\nvar reI = \"\\\\s*([+-]?\\\\d+)\\\\s*\",\n    reN = \"\\\\s*([+-]?(?:\\\\d*\\\\.)?\\\\d+(?:[eE][+-]?\\\\d+)?)\\\\s*\",\n    reP = \"\\\\s*([+-]?(?:\\\\d*\\\\.)?\\\\d+(?:[eE][+-]?\\\\d+)?)%\\\\s*\",\n    reHex = /^#([0-9a-f]{3,8})$/,\n    reRgbInteger = new RegExp(`^rgb\\\\(${reI},${reI},${reI}\\\\)$`),\n    reRgbPercent = new RegExp(`^rgb\\\\(${reP},${reP},${reP}\\\\)$`),\n    reRgbaInteger = new RegExp(`^rgba\\\\(${reI},${reI},${reI},${reN}\\\\)$`),\n    reRgbaPercent = new RegExp(`^rgba\\\\(${reP},${reP},${reP},${reN}\\\\)$`),\n    reHslPercent = new RegExp(`^hsl\\\\(${reN},${reP},${reP}\\\\)$`),\n    reHslaPercent = new RegExp(`^hsla\\\\(${reN},${reP},${reP},${reN}\\\\)$`);\n\nvar named = {\n  aliceblue: 0xf0f8ff,\n  antiquewhite: 0xfaebd7,\n  aqua: 0x00ffff,\n  aquamarine: 0x7fffd4,\n  azure: 0xf0ffff,\n  beige: 0xf5f5dc,\n  bisque: 0xffe4c4,\n  black: 0x000000,\n  blanchedalmond: 0xffebcd,\n  blue: 0x0000ff,\n  blueviolet: 0x8a2be2,\n  brown: 0xa52a2a,\n  burlywood: 0xdeb887,\n  cadetblue: 0x5f9ea0,\n  chartreuse: 0x7fff00,\n  chocolate: 0xd2691e,\n  coral: 0xff7f50,\n  cornflowerblue: 0x6495ed,\n  cornsilk: 0xfff8dc,\n  crimson: 0xdc143c,\n  cyan: 0x00ffff,\n  darkblue: 0x00008b,\n  darkcyan: 0x008b8b,\n  darkgoldenrod: 0xb8860b,\n  darkgray: 0xa9a9a9,\n  darkgreen: 0x006400,\n  darkgrey: 0xa9a9a9,\n  darkkhaki: 0xbdb76b,\n  darkmagenta: 0x8b008b,\n  darkolivegreen: 0x556b2f,\n  darkorange: 0xff8c00,\n  darkorchid: 0x9932cc,\n  darkred: 0x8b0000,\n  darksalmon: 0xe9967a,\n  darkseagreen: 0x8fbc8f,\n  darkslateblue: 0x483d8b,\n  darkslategray: 0x2f4f4f,\n  darkslategrey: 0x2f4f4f,\n  darkturquoise: 0x00ced1,\n  darkviolet: 0x9400d3,\n  deeppink: 0xff1493,\n  deepskyblue: 0x00bfff,\n  dimgray: 0x696969,\n  dimgrey: 0x696969,\n  dodgerblue: 0x1e90ff,\n  firebrick: 0xb22222,\n  floralwhite: 0xfffaf0,\n  forestgreen: 0x228b22,\n  fuchsia: 0xff00ff,\n  gainsboro: 0xdcdcdc,\n  ghostwhite: 0xf8f8ff,\n  gold: 0xffd700,\n  goldenrod: 0xdaa520,\n  gray: 0x808080,\n  green: 0x008000,\n  greenyellow: 0xadff2f,\n  grey: 0x808080,\n  honeydew: 0xf0fff0,\n  hotpink: 0xff69b4,\n  indianred: 0xcd5c5c,\n  indigo: 0x4b0082,\n  ivory: 0xfffff0,\n  khaki: 0xf0e68c,\n  lavender: 0xe6e6fa,\n  lavenderblush: 0xfff0f5,\n  lawngreen: 0x7cfc00,\n  lemonchiffon: 0xfffacd,\n  lightblue: 0xadd8e6,\n  lightcoral: 0xf08080,\n  lightcyan: 0xe0ffff,\n  lightgoldenrodyellow: 0xfafad2,\n  lightgray: 0xd3d3d3,\n  lightgreen: 0x90ee90,\n  lightgrey: 0xd3d3d3,\n  lightpink: 0xffb6c1,\n  lightsalmon: 0xffa07a,\n  lightseagreen: 0x20b2aa,\n  lightskyblue: 0x87cefa,\n  lightslategray: 0x778899,\n  lightslategrey: 0x778899,\n  lightsteelblue: 0xb0c4de,\n  lightyellow: 0xffffe0,\n  lime: 0x00ff00,\n  limegreen: 0x32cd32,\n  linen: 0xfaf0e6,\n  magenta: 0xff00ff,\n  maroon: 0x800000,\n  mediumaquamarine: 0x66cdaa,\n  mediumblue: 0x0000cd,\n  mediumorchid: 0xba55d3,\n  mediumpurple: 0x9370db,\n  mediumseagreen: 0x3cb371,\n  mediumslateblue: 0x7b68ee,\n  mediumspringgreen: 0x00fa9a,\n  mediumturquoise: 0x48d1cc,\n  mediumvioletred: 0xc71585,\n  midnightblue: 0x191970,\n  mintcream: 0xf5fffa,\n  mistyrose: 0xffe4e1,\n  moccasin: 0xffe4b5,\n  navajowhite: 0xffdead,\n  navy: 0x000080,\n  oldlace: 0xfdf5e6,\n  olive: 0x808000,\n  olivedrab: 0x6b8e23,\n  orange: 0xffa500,\n  orangered: 0xff4500,\n  orchid: 0xda70d6,\n  palegoldenrod: 0xeee8aa,\n  palegreen: 0x98fb98,\n  paleturquoise: 0xafeeee,\n  palevioletred: 0xdb7093,\n  papayawhip: 0xffefd5,\n  peachpuff: 0xffdab9,\n  peru: 0xcd853f,\n  pink: 0xffc0cb,\n  plum: 0xdda0dd,\n  powderblue: 0xb0e0e6,\n  purple: 0x800080,\n  rebeccapurple: 0x663399,\n  red: 0xff0000,\n  rosybrown: 0xbc8f8f,\n  royalblue: 0x4169e1,\n  saddlebrown: 0x8b4513,\n  salmon: 0xfa8072,\n  sandybrown: 0xf4a460,\n  seagreen: 0x2e8b57,\n  seashell: 0xfff5ee,\n  sienna: 0xa0522d,\n  silver: 0xc0c0c0,\n  skyblue: 0x87ceeb,\n  slateblue: 0x6a5acd,\n  slategray: 0x708090,\n  slategrey: 0x708090,\n  snow: 0xfffafa,\n  springgreen: 0x00ff7f,\n  steelblue: 0x4682b4,\n  tan: 0xd2b48c,\n  teal: 0x008080,\n  thistle: 0xd8bfd8,\n  tomato: 0xff6347,\n  turquoise: 0x40e0d0,\n  violet: 0xee82ee,\n  wheat: 0xf5deb3,\n  white: 0xffffff,\n  whitesmoke: 0xf5f5f5,\n  yellow: 0xffff00,\n  yellowgreen: 0x9acd32\n};\n\ndefine(Color, color, {\n  copy(channels) {\n    return Object.assign(new this.constructor, this, channels);\n  },\n  displayable() {\n    return this.rgb().displayable();\n  },\n  hex: color_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: color_formatHex,\n  formatHex8: color_formatHex8,\n  formatHsl: color_formatHsl,\n  formatRgb: color_formatRgb,\n  toString: color_formatRgb\n});\n\nfunction color_formatHex() {\n  return this.rgb().formatHex();\n}\n\nfunction color_formatHex8() {\n  return this.rgb().formatHex8();\n}\n\nfunction color_formatHsl() {\n  return hslConvert(this).formatHsl();\n}\n\nfunction color_formatRgb() {\n  return this.rgb().formatRgb();\n}\n\nexport default function color(format) {\n  var m, l;\n  format = (format + \"\").trim().toLowerCase();\n  return (m = reHex.exec(format)) ? (l = m[1].length, m = parseInt(m[1], 16), l === 6 ? rgbn(m) // #ff0000\n      : l === 3 ? new Rgb((m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), ((m & 0xf) << 4) | (m & 0xf), 1) // #f00\n      : l === 8 ? rgba(m >> 24 & 0xff, m >> 16 & 0xff, m >> 8 & 0xff, (m & 0xff) / 0xff) // #ff000000\n      : l === 4 ? rgba((m >> 12 & 0xf) | (m >> 8 & 0xf0), (m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), (((m & 0xf) << 4) | (m & 0xf)) / 0xff) // #f000\n      : null) // invalid hex\n      : (m = reRgbInteger.exec(format)) ? new Rgb(m[1], m[2], m[3], 1) // rgb(255, 0, 0)\n      : (m = reRgbPercent.exec(format)) ? new Rgb(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, 1) // rgb(100%, 0%, 0%)\n      : (m = reRgbaInteger.exec(format)) ? rgba(m[1], m[2], m[3], m[4]) // rgba(255, 0, 0, 1)\n      : (m = reRgbaPercent.exec(format)) ? rgba(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, m[4]) // rgb(100%, 0%, 0%, 1)\n      : (m = reHslPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, 1) // hsl(120, 50%, 50%)\n      : (m = reHslaPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, m[4]) // hsla(120, 50%, 50%, 1)\n      : named.hasOwnProperty(format) ? rgbn(named[format]) // eslint-disable-line no-prototype-builtins\n      : format === \"transparent\" ? new Rgb(NaN, NaN, NaN, 0)\n      : null;\n}\n\nfunction rgbn(n) {\n  return new Rgb(n >> 16 & 0xff, n >> 8 & 0xff, n & 0xff, 1);\n}\n\nfunction rgba(r, g, b, a) {\n  if (a <= 0) r = g = b = NaN;\n  return new Rgb(r, g, b, a);\n}\n\nexport function rgbConvert(o) {\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Rgb;\n  o = o.rgb();\n  return new Rgb(o.r, o.g, o.b, o.opacity);\n}\n\nexport function rgb(r, g, b, opacity) {\n  return arguments.length === 1 ? rgbConvert(r) : new Rgb(r, g, b, opacity == null ? 1 : opacity);\n}\n\nexport function Rgb(r, g, b, opacity) {\n  this.r = +r;\n  this.g = +g;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Rgb, rgb, extend(Color, {\n  brighter(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  darker(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  rgb() {\n    return this;\n  },\n  clamp() {\n    return new Rgb(clampi(this.r), clampi(this.g), clampi(this.b), clampa(this.opacity));\n  },\n  displayable() {\n    return (-0.5 <= this.r && this.r < 255.5)\n        && (-0.5 <= this.g && this.g < 255.5)\n        && (-0.5 <= this.b && this.b < 255.5)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  hex: rgb_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: rgb_formatHex,\n  formatHex8: rgb_formatHex8,\n  formatRgb: rgb_formatRgb,\n  toString: rgb_formatRgb\n}));\n\nfunction rgb_formatHex() {\n  return `#${hex(this.r)}${hex(this.g)}${hex(this.b)}`;\n}\n\nfunction rgb_formatHex8() {\n  return `#${hex(this.r)}${hex(this.g)}${hex(this.b)}${hex((isNaN(this.opacity) ? 1 : this.opacity) * 255)}`;\n}\n\nfunction rgb_formatRgb() {\n  const a = clampa(this.opacity);\n  return `${a === 1 ? \"rgb(\" : \"rgba(\"}${clampi(this.r)}, ${clampi(this.g)}, ${clampi(this.b)}${a === 1 ? \")\" : `, ${a})`}`;\n}\n\nfunction clampa(opacity) {\n  return isNaN(opacity) ? 1 : Math.max(0, Math.min(1, opacity));\n}\n\nfunction clampi(value) {\n  return Math.max(0, Math.min(255, Math.round(value) || 0));\n}\n\nfunction hex(value) {\n  value = clampi(value);\n  return (value < 16 ? \"0\" : \"\") + value.toString(16);\n}\n\nfunction hsla(h, s, l, a) {\n  if (a <= 0) h = s = l = NaN;\n  else if (l <= 0 || l >= 1) h = s = NaN;\n  else if (s <= 0) h = NaN;\n  return new Hsl(h, s, l, a);\n}\n\nexport function hslConvert(o) {\n  if (o instanceof Hsl) return new Hsl(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Hsl;\n  if (o instanceof Hsl) return o;\n  o = o.rgb();\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      min = Math.min(r, g, b),\n      max = Math.max(r, g, b),\n      h = NaN,\n      s = max - min,\n      l = (max + min) / 2;\n  if (s) {\n    if (r === max) h = (g - b) / s + (g < b) * 6;\n    else if (g === max) h = (b - r) / s + 2;\n    else h = (r - g) / s + 4;\n    s /= l < 0.5 ? max + min : 2 - max - min;\n    h *= 60;\n  } else {\n    s = l > 0 && l < 1 ? 0 : h;\n  }\n  return new Hsl(h, s, l, o.opacity);\n}\n\nexport function hsl(h, s, l, opacity) {\n  return arguments.length === 1 ? hslConvert(h) : new Hsl(h, s, l, opacity == null ? 1 : opacity);\n}\n\nfunction Hsl(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Hsl, hsl, extend(Color, {\n  brighter(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb() {\n    var h = this.h % 360 + (this.h < 0) * 360,\n        s = isNaN(h) || isNaN(this.s) ? 0 : this.s,\n        l = this.l,\n        m2 = l + (l < 0.5 ? l : 1 - l) * s,\n        m1 = 2 * l - m2;\n    return new Rgb(\n      hsl2rgb(h >= 240 ? h - 240 : h + 120, m1, m2),\n      hsl2rgb(h, m1, m2),\n      hsl2rgb(h < 120 ? h + 240 : h - 120, m1, m2),\n      this.opacity\n    );\n  },\n  clamp() {\n    return new Hsl(clamph(this.h), clampt(this.s), clampt(this.l), clampa(this.opacity));\n  },\n  displayable() {\n    return (0 <= this.s && this.s <= 1 || isNaN(this.s))\n        && (0 <= this.l && this.l <= 1)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  formatHsl() {\n    const a = clampa(this.opacity);\n    return `${a === 1 ? \"hsl(\" : \"hsla(\"}${clamph(this.h)}, ${clampt(this.s) * 100}%, ${clampt(this.l) * 100}%${a === 1 ? \")\" : `, ${a})`}`;\n  }\n}));\n\nfunction clamph(value) {\n  value = (value || 0) % 360;\n  return value < 0 ? value + 360 : value;\n}\n\nfunction clampt(value) {\n  return Math.max(0, Math.min(1, value || 0));\n}\n\n/* From FvD 13.37, CSS Color Module Level 3 */\nfunction hsl2rgb(h, m1, m2) {\n  return (h < 60 ? m1 + (m2 - m1) * h / 60\n      : h < 180 ? m2\n      : h < 240 ? m1 + (m2 - m1) * (240 - h) / 60\n      : m1) * 255;\n}\n","export const radians = Math.PI / 180;\nexport const degrees = 180 / Math.PI;\n","import define, {extend} from \"./define.js\";\nimport {Color, rgbConvert, Rgb} from \"./color.js\";\nimport {degrees, radians} from \"./math.js\";\n\n// https://observablehq.com/@mbostock/lab-and-rgb\nconst K = 18,\n    Xn = 0.96422,\n    Yn = 1,\n    Zn = 0.82521,\n    t0 = 4 / 29,\n    t1 = 6 / 29,\n    t2 = 3 * t1 * t1,\n    t3 = t1 * t1 * t1;\n\nfunction labConvert(o) {\n  if (o instanceof Lab) return new Lab(o.l, o.a, o.b, o.opacity);\n  if (o instanceof Hcl) return hcl2lab(o);\n  if (!(o instanceof Rgb)) o = rgbConvert(o);\n  var r = rgb2lrgb(o.r),\n      g = rgb2lrgb(o.g),\n      b = rgb2lrgb(o.b),\n      y = xyz2lab((0.2225045 * r + 0.7168786 * g + 0.0606169 * b) / Yn), x, z;\n  if (r === g && g === b) x = z = y; else {\n    x = xyz2lab((0.4360747 * r + 0.3850649 * g + 0.1430804 * b) / Xn);\n    z = xyz2lab((0.0139322 * r + 0.0971045 * g + 0.7141733 * b) / Zn);\n  }\n  return new Lab(116 * y - 16, 500 * (x - y), 200 * (y - z), o.opacity);\n}\n\nexport function gray(l, opacity) {\n  return new Lab(l, 0, 0, opacity == null ? 1 : opacity);\n}\n\nexport default function lab(l, a, b, opacity) {\n  return arguments.length === 1 ? labConvert(l) : new Lab(l, a, b, opacity == null ? 1 : opacity);\n}\n\nexport function Lab(l, a, b, opacity) {\n  this.l = +l;\n  this.a = +a;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Lab, lab, extend(Color, {\n  brighter(k) {\n    return new Lab(this.l + K * (k == null ? 1 : k), this.a, this.b, this.opacity);\n  },\n  darker(k) {\n    return new Lab(this.l - K * (k == null ? 1 : k), this.a, this.b, this.opacity);\n  },\n  rgb() {\n    var y = (this.l + 16) / 116,\n        x = isNaN(this.a) ? y : y + this.a / 500,\n        z = isNaN(this.b) ? y : y - this.b / 200;\n    x = Xn * lab2xyz(x);\n    y = Yn * lab2xyz(y);\n    z = Zn * lab2xyz(z);\n    return new Rgb(\n      lrgb2rgb( 3.1338561 * x - 1.6168667 * y - 0.4906146 * z),\n      lrgb2rgb(-0.9787684 * x + 1.9161415 * y + 0.0334540 * z),\n      lrgb2rgb( 0.0719453 * x - 0.2289914 * y + 1.4052427 * z),\n      this.opacity\n    );\n  }\n}));\n\nfunction xyz2lab(t) {\n  return t > t3 ? Math.pow(t, 1 / 3) : t / t2 + t0;\n}\n\nfunction lab2xyz(t) {\n  return t > t1 ? t * t * t : t2 * (t - t0);\n}\n\nfunction lrgb2rgb(x) {\n  return 255 * (x <= 0.0031308 ? 12.92 * x : 1.055 * Math.pow(x, 1 / 2.4) - 0.055);\n}\n\nfunction rgb2lrgb(x) {\n  return (x /= 255) <= 0.04045 ? x / 12.92 : Math.pow((x + 0.055) / 1.055, 2.4);\n}\n\nfunction hclConvert(o) {\n  if (o instanceof Hcl) return new Hcl(o.h, o.c, o.l, o.opacity);\n  if (!(o instanceof Lab)) o = labConvert(o);\n  if (o.a === 0 && o.b === 0) return new Hcl(NaN, 0 < o.l && o.l < 100 ? 0 : NaN, o.l, o.opacity);\n  var h = Math.atan2(o.b, o.a) * degrees;\n  return new Hcl(h < 0 ? h + 360 : h, Math.sqrt(o.a * o.a + o.b * o.b), o.l, o.opacity);\n}\n\nexport function lch(l, c, h, opacity) {\n  return arguments.length === 1 ? hclConvert(l) : new Hcl(h, c, l, opacity == null ? 1 : opacity);\n}\n\nexport function hcl(h, c, l, opacity) {\n  return arguments.length === 1 ? hclConvert(h) : new Hcl(h, c, l, opacity == null ? 1 : opacity);\n}\n\nexport function Hcl(h, c, l, opacity) {\n  this.h = +h;\n  this.c = +c;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\nfunction hcl2lab(o) {\n  if (isNaN(o.h)) return new Lab(o.l, 0, 0, o.opacity);\n  var h = o.h * radians;\n  return new Lab(o.l, Math.cos(h) * o.c, Math.sin(h) * o.c, o.opacity);\n}\n\ndefine(Hcl, hcl, extend(Color, {\n  brighter(k) {\n    return new Hcl(this.h, this.c, this.l + K * (k == null ? 1 : k), this.opacity);\n  },\n  darker(k) {\n    return new Hcl(this.h, this.c, this.l - K * (k == null ? 1 : k), this.opacity);\n  },\n  rgb() {\n    return hcl2lab(this).rgb();\n  }\n}));\n","import define, {extend} from \"./define.js\";\nimport {Color, rgbConvert, Rgb, darker, brighter} from \"./color.js\";\nimport {degrees, radians} from \"./math.js\";\n\nvar A = -0.14861,\n    B = +1.78277,\n    C = -0.29227,\n    D = -0.90649,\n    E = +1.97294,\n    ED = E * D,\n    EB = E * B,\n    BC_DA = B * C - D * A;\n\nfunction cubehelixConvert(o) {\n  if (o instanceof Cubehelix) return new Cubehelix(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Rgb)) o = rgbConvert(o);\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      l = (BC_DA * b + ED * r - EB * g) / (BC_DA + ED - EB),\n      bl = b - l,\n      k = (E * (g - l) - C * bl) / D,\n      s = Math.sqrt(k * k + bl * bl) / (E * l * (1 - l)), // NaN if l=0 or l=1\n      h = s ? Math.atan2(k, bl) * degrees - 120 : NaN;\n  return new Cubehelix(h < 0 ? h + 360 : h, s, l, o.opacity);\n}\n\nexport default function cubehelix(h, s, l, opacity) {\n  return arguments.length === 1 ? cubehelixConvert(h) : new Cubehelix(h, s, l, opacity == null ? 1 : opacity);\n}\n\nexport function Cubehelix(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Cubehelix, cubehelix, extend(Color, {\n  brighter(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Cubehelix(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Cubehelix(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb() {\n    var h = isNaN(this.h) ? 0 : (this.h + 120) * radians,\n        l = +this.l,\n        a = isNaN(this.s) ? 0 : this.s * l * (1 - l),\n        cosh = Math.cos(h),\n        sinh = Math.sin(h);\n    return new Rgb(\n      255 * (l + a * (A * cosh + B * sinh)),\n      255 * (l + a * (C * cosh + D * sinh)),\n      255 * (l + a * (E * cosh)),\n      this.opacity\n    );\n  }\n}));\n","export function basis(t1, v0, v1, v2, v3) {\n  var t2 = t1 * t1, t3 = t2 * t1;\n  return ((1 - 3 * t1 + 3 * t2 - t3) * v0\n      + (4 - 6 * t2 + 3 * t3) * v1\n      + (1 + 3 * t1 + 3 * t2 - 3 * t3) * v2\n      + t3 * v3) / 6;\n}\n\nexport default function(values) {\n  var n = values.length - 1;\n  return function(t) {\n    var i = t <= 0 ? (t = 0) : t >= 1 ? (t = 1, n - 1) : Math.floor(t * n),\n        v1 = values[i],\n        v2 = values[i + 1],\n        v0 = i > 0 ? values[i - 1] : 2 * v1 - v2,\n        v3 = i < n - 1 ? values[i + 2] : 2 * v2 - v1;\n    return basis((t - i / n) * n, v0, v1, v2, v3);\n  };\n}\n","import {basis} from \"./basis.js\";\n\nexport default function(values) {\n  var n = values.length;\n  return function(t) {\n    var i = Math.floor(((t %= 1) < 0 ? ++t : t) * n),\n        v0 = values[(i + n - 1) % n],\n        v1 = values[i % n],\n        v2 = values[(i + 1) % n],\n        v3 = values[(i + 2) % n];\n    return basis((t - i / n) * n, v0, v1, v2, v3);\n  };\n}\n","export default x => () => x;\n","import constant from \"./constant.js\";\n\nfunction linear(a, d) {\n  return function(t) {\n    return a + t * d;\n  };\n}\n\nfunction exponential(a, b, y) {\n  return a = Math.pow(a, y), b = Math.pow(b, y) - a, y = 1 / y, function(t) {\n    return Math.pow(a + t * b, y);\n  };\n}\n\nexport function hue(a, b) {\n  var d = b - a;\n  return d ? linear(a, d > 180 || d < -180 ? d - 360 * Math.round(d / 360) : d) : constant(isNaN(a) ? b : a);\n}\n\nexport function gamma(y) {\n  return (y = +y) === 1 ? nogamma : function(a, b) {\n    return b - a ? exponential(a, b, y) : constant(isNaN(a) ? b : a);\n  };\n}\n\nexport default function nogamma(a, b) {\n  var d = b - a;\n  return d ? linear(a, d) : constant(isNaN(a) ? b : a);\n}\n","import {rgb as colorRgb} from \"d3-color\";\nimport basis from \"./basis.js\";\nimport basisClosed from \"./basisClosed.js\";\nimport nogamma, {gamma} from \"./color.js\";\n\nexport default (function rgbGamma(y) {\n  var color = gamma(y);\n\n  function rgb(start, end) {\n    var r = color((start = colorRgb(start)).r, (end = colorRgb(end)).r),\n        g = color(start.g, end.g),\n        b = color(start.b, end.b),\n        opacity = nogamma(start.opacity, end.opacity);\n    return function(t) {\n      start.r = r(t);\n      start.g = g(t);\n      start.b = b(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n\n  rgb.gamma = rgbGamma;\n\n  return rgb;\n})(1);\n\nfunction rgbSpline(spline) {\n  return function(colors) {\n    var n = colors.length,\n        r = new Array(n),\n        g = new Array(n),\n        b = new Array(n),\n        i, color;\n    for (i = 0; i < n; ++i) {\n      color = colorRgb(colors[i]);\n      r[i] = color.r || 0;\n      g[i] = color.g || 0;\n      b[i] = color.b || 0;\n    }\n    r = spline(r);\n    g = spline(g);\n    b = spline(b);\n    color.opacity = 1;\n    return function(t) {\n      color.r = r(t);\n      color.g = g(t);\n      color.b = b(t);\n      return color + \"\";\n    };\n  };\n}\n\nexport var rgbBasis = rgbSpline(basis);\nexport var rgbBasisClosed = rgbSpline(basisClosed);\n","export default function(a, b) {\n  if (!b) b = [];\n  var n = a ? Math.min(b.length, a.length) : 0,\n      c = b.slice(),\n      i;\n  return function(t) {\n    for (i = 0; i < n; ++i) c[i] = a[i] * (1 - t) + b[i] * t;\n    return c;\n  };\n}\n\nexport function isNumberArray(x) {\n  return ArrayBuffer.isView(x) && !(x instanceof DataView);\n}\n","import value from \"./value.js\";\nimport numberArray, {isNumberArray} from \"./numberArray.js\";\n\nexport default function(a, b) {\n  return (isNumberArray(b) ? numberArray : genericArray)(a, b);\n}\n\nexport function genericArray(a, b) {\n  var nb = b ? b.length : 0,\n      na = a ? Math.min(nb, a.length) : 0,\n      x = new Array(na),\n      c = new Array(nb),\n      i;\n\n  for (i = 0; i < na; ++i) x[i] = value(a[i], b[i]);\n  for (; i < nb; ++i) c[i] = b[i];\n\n  return function(t) {\n    for (i = 0; i < na; ++i) c[i] = x[i](t);\n    return c;\n  };\n}\n","export default function(a, b) {\n  var d = new Date;\n  return a = +a, b = +b, function(t) {\n    return d.setTime(a * (1 - t) + b * t), d;\n  };\n}\n","export default function(a, b) {\n  return a = +a, b = +b, function(t) {\n    return a * (1 - t) + b * t;\n  };\n}\n","import value from \"./value.js\";\n\nexport default function(a, b) {\n  var i = {},\n      c = {},\n      k;\n\n  if (a === null || typeof a !== \"object\") a = {};\n  if (b === null || typeof b !== \"object\") b = {};\n\n  for (k in b) {\n    if (k in a) {\n      i[k] = value(a[k], b[k]);\n    } else {\n      c[k] = b[k];\n    }\n  }\n\n  return function(t) {\n    for (k in i) c[k] = i[k](t);\n    return c;\n  };\n}\n","import number from \"./number.js\";\n\nvar reA = /[-+]?(?:\\d+\\.?\\d*|\\.?\\d+)(?:[eE][-+]?\\d+)?/g,\n    reB = new RegExp(reA.source, \"g\");\n\nfunction zero(b) {\n  return function() {\n    return b;\n  };\n}\n\nfunction one(b) {\n  return function(t) {\n    return b(t) + \"\";\n  };\n}\n\nexport default function(a, b) {\n  var bi = reA.lastIndex = reB.lastIndex = 0, // scan index for next number in b\n      am, // current match in a\n      bm, // current match in b\n      bs, // string preceding current number in b, if any\n      i = -1, // index in s\n      s = [], // string constants and placeholders\n      q = []; // number interpolators\n\n  // Coerce inputs to strings.\n  a = a + \"\", b = b + \"\";\n\n  // Interpolate pairs of numbers in a & b.\n  while ((am = reA.exec(a))\n      && (bm = reB.exec(b))) {\n    if ((bs = bm.index) > bi) { // a string precedes the next number in b\n      bs = b.slice(bi, bs);\n      if (s[i]) s[i] += bs; // coalesce with previous string\n      else s[++i] = bs;\n    }\n    if ((am = am[0]) === (bm = bm[0])) { // numbers in a & b match\n      if (s[i]) s[i] += bm; // coalesce with previous string\n      else s[++i] = bm;\n    } else { // interpolate non-matching numbers\n      s[++i] = null;\n      q.push({i: i, x: number(am, bm)});\n    }\n    bi = reB.lastIndex;\n  }\n\n  // Add remains of b.\n  if (bi < b.length) {\n    bs = b.slice(bi);\n    if (s[i]) s[i] += bs; // coalesce with previous string\n    else s[++i] = bs;\n  }\n\n  // Special optimization for only a single match.\n  // Otherwise, interpolate each of the numbers and rejoin the string.\n  return s.length < 2 ? (q[0]\n      ? one(q[0].x)\n      : zero(b))\n      : (b = q.length, function(t) {\n          for (var i = 0, o; i < b; ++i) s[(o = q[i]).i] = o.x(t);\n          return s.join(\"\");\n        });\n}\n","import {color} from \"d3-color\";\nimport rgb from \"./rgb.js\";\nimport {genericArray} from \"./array.js\";\nimport date from \"./date.js\";\nimport number from \"./number.js\";\nimport object from \"./object.js\";\nimport string from \"./string.js\";\nimport constant from \"./constant.js\";\nimport numberArray, {isNumberArray} from \"./numberArray.js\";\n\nexport default function(a, b) {\n  var t = typeof b, c;\n  return b == null || t === \"boolean\" ? constant(b)\n      : (t === \"number\" ? number\n      : t === \"string\" ? ((c = color(b)) ? (b = c, rgb) : string)\n      : b instanceof color ? rgb\n      : b instanceof Date ? date\n      : isNumberArray(b) ? numberArray\n      : Array.isArray(b) ? genericArray\n      : typeof b.valueOf !== \"function\" && typeof b.toString !== \"function\" || isNaN(b) ? object\n      : number)(a, b);\n}\n","import {hsl as colorHsl} from \"d3-color\";\nimport color, {hue} from \"./color.js\";\n\nfunction hsl(hue) {\n  return function(start, end) {\n    var h = hue((start = colorHsl(start)).h, (end = colorHsl(end)).h),\n        s = color(start.s, end.s),\n        l = color(start.l, end.l),\n        opacity = color(start.opacity, end.opacity);\n    return function(t) {\n      start.h = h(t);\n      start.s = s(t);\n      start.l = l(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n}\n\nexport default hsl(hue);\nexport var hslLong = hsl(color);\n","import {lab as colorLab} from \"d3-color\";\nimport color from \"./color.js\";\n\nexport default function lab(start, end) {\n  var l = color((start = colorLab(start)).l, (end = colorLab(end)).l),\n      a = color(start.a, end.a),\n      b = color(start.b, end.b),\n      opacity = color(start.opacity, end.opacity);\n  return function(t) {\n    start.l = l(t);\n    start.a = a(t);\n    start.b = b(t);\n    start.opacity = opacity(t);\n    return start + \"\";\n  };\n}\n","import {hcl as colorHcl} from \"d3-color\";\nimport color, {hue} from \"./color.js\";\n\nfunction hcl(hue) {\n  return function(start, end) {\n    var h = hue((start = colorHcl(start)).h, (end = colorHcl(end)).h),\n        c = color(start.c, end.c),\n        l = color(start.l, end.l),\n        opacity = color(start.opacity, end.opacity);\n    return function(t) {\n      start.h = h(t);\n      start.c = c(t);\n      start.l = l(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n}\n\nexport default hcl(hue);\nexport var hclLong = hcl(color);\n","import {cubehelix as colorCubehelix} from \"d3-color\";\nimport color, {hue} from \"./color.js\";\n\nfunction cubehelix(hue) {\n  return (function cubehelixGamma(y) {\n    y = +y;\n\n    function cubehelix(start, end) {\n      var h = hue((start = colorCubehelix(start)).h, (end = colorCubehelix(end)).h),\n          s = color(start.s, end.s),\n          l = color(start.l, end.l),\n          opacity = color(start.opacity, end.opacity);\n      return function(t) {\n        start.h = h(t);\n        start.s = s(t);\n        start.l = l(Math.pow(t, y));\n        start.opacity = opacity(t);\n        return start + \"\";\n      };\n    }\n\n    cubehelix.gamma = cubehelixGamma;\n\n    return cubehelix;\n  })(1);\n}\n\nexport default cubehelix(hue);\nexport var cubehelixLong = cubehelix(color);\n","import {default as value} from \"./value.js\";\n\nexport default function piecewise(interpolate, values) {\n  if (values === undefined) values = interpolate, interpolate = value;\n  var i = 0, n = values.length - 1, v = values[0], I = new Array(n < 0 ? 0 : n);\n  while (i < n) I[i] = interpolate(v, v = values[++i]);\n  return function(t) {\n    var i = Math.max(0, Math.min(n - 1, Math.floor(t *= n)));\n    return I[i](t - i);\n  };\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n","/**\n * Returns true if the object is a function.\n * @param value The value to check\n */\nexport function isFunction(value: any): value is (...args: any[]) => any {\n  return typeof value === 'function';\n}\n","/**\n * Used to create Error subclasses until the community moves away from ES5.\n *\n * This is because compiling from TypeScript down to ES5 has issues with subclassing Errors\n * as well as other built-in types: https://github.com/Microsoft/TypeScript/issues/12123\n *\n * @param createImpl A factory function to create the actual constructor implementation. The returned\n * function should be a named function that calls `_super` internally.\n */\nexport function createErrorClass<T>(createImpl: (_super: any) => any): T {\n  const _super = (instance: any) => {\n    Error.call(instance);\n    instance.stack = new Error().stack;\n  };\n\n  const ctorFunc = createImpl(_super);\n  ctorFunc.prototype = Object.create(Error.prototype);\n  ctorFunc.prototype.constructor = ctorFunc;\n  return ctorFunc;\n}\n","import { createErrorClass } from './createErrorClass';\n\nexport interface UnsubscriptionError extends Error {\n  readonly errors: any[];\n}\n\nexport interface UnsubscriptionErrorCtor {\n  /**\n   * @deprecated Internal implementation detail. Do not construct error instances.\n   * Cannot be tagged as internal: https://github.com/ReactiveX/rxjs/issues/6269\n   */\n  new (errors: any[]): UnsubscriptionError;\n}\n\n/**\n * An error thrown when one or more errors have occurred during the\n * `unsubscribe` of a {@link Subscription}.\n */\nexport const UnsubscriptionError: UnsubscriptionErrorCtor = createErrorClass(\n  (_super) =>\n    function UnsubscriptionErrorImpl(this: any, errors: (Error | string)[]) {\n      _super(this);\n      this.message = errors\n        ? `${errors.length} errors occurred during unsubscription:\n${errors.map((err, i) => `${i + 1}) ${err.toString()}`).join('\\n  ')}`\n        : '';\n      this.name = 'UnsubscriptionError';\n      this.errors = errors;\n    }\n);\n","/**\n * Removes an item from an array, mutating it.\n * @param arr The array to remove the item from\n * @param item The item to remove\n */\nexport function arrRemove<T>(arr: T[] | undefined | null, item: T) {\n  if (arr) {\n    const index = arr.indexOf(item);\n    0 <= index && arr.splice(index, 1);\n  }\n}\n","import { isFunction } from './util/isFunction';\nimport { UnsubscriptionError } from './util/UnsubscriptionError';\nimport { SubscriptionLike, TeardownLogic, Unsubscribable } from './types';\nimport { arrRemove } from './util/arrRemove';\n\n/**\n * Represents a disposable resource, such as the execution of an Observable. A\n * Subscription has one important method, `unsubscribe`, that takes no argument\n * and just disposes the resource held by the subscription.\n *\n * Additionally, subscriptions may be grouped together through the `add()`\n * method, which will attach a child Subscription to the current Subscription.\n * When a Subscription is unsubscribed, all its children (and its grandchildren)\n * will be unsubscribed as well.\n *\n * @class Subscription\n */\nexport class Subscription implements SubscriptionLike {\n  /** @nocollapse */\n  public static EMPTY = (() => {\n    const empty = new Subscription();\n    empty.closed = true;\n    return empty;\n  })();\n\n  /**\n   * A flag to indicate whether this Subscription has already been unsubscribed.\n   */\n  public closed = false;\n\n  private _parentage: Subscription[] | Subscription | null = null;\n\n  /**\n   * The list of registered finalizers to execute upon unsubscription. Adding and removing from this\n   * list occurs in the {@link #add} and {@link #remove} methods.\n   */\n  private _finalizers: Exclude<TeardownLogic, void>[] | null = null;\n\n  /**\n   * @param initialTeardown A function executed first as part of the finalization\n   * process that is kicked off when {@link #unsubscribe} is called.\n   */\n  constructor(private initialTeardown?: () => void) {}\n\n  /**\n   * Disposes the resources held by the subscription. May, for instance, cancel\n   * an ongoing Observable execution or cancel any other type of work that\n   * started when the Subscription was created.\n   * @return {void}\n   */\n  unsubscribe(): void {\n    let errors: any[] | undefined;\n\n    if (!this.closed) {\n      this.closed = true;\n\n      // Remove this from it's parents.\n      const { _parentage } = this;\n      if (_parentage) {\n        this._parentage = null;\n        if (Array.isArray(_parentage)) {\n          for (const parent of _parentage) {\n            parent.remove(this);\n          }\n        } else {\n          _parentage.remove(this);\n        }\n      }\n\n      const { initialTeardown: initialFinalizer } = this;\n      if (isFunction(initialFinalizer)) {\n        try {\n          initialFinalizer();\n        } catch (e) {\n          errors = e instanceof UnsubscriptionError ? e.errors : [e];\n        }\n      }\n\n      const { _finalizers } = this;\n      if (_finalizers) {\n        this._finalizers = null;\n        for (const finalizer of _finalizers) {\n          try {\n            execFinalizer(finalizer);\n          } catch (err) {\n            errors = errors ?? [];\n            if (err instanceof UnsubscriptionError) {\n              errors = [...errors, ...err.errors];\n            } else {\n              errors.push(err);\n            }\n          }\n        }\n      }\n\n      if (errors) {\n        throw new UnsubscriptionError(errors);\n      }\n    }\n  }\n\n  /**\n   * Adds a finalizer to this subscription, so that finalization will be unsubscribed/called\n   * when this subscription is unsubscribed. If this subscription is already {@link #closed},\n   * because it has already been unsubscribed, then whatever finalizer is passed to it\n   * will automatically be executed (unless the finalizer itself is also a closed subscription).\n   *\n   * Closed Subscriptions cannot be added as finalizers to any subscription. Adding a closed\n   * subscription to a any subscription will result in no operation. (A noop).\n   *\n   * Adding a subscription to itself, or adding `null` or `undefined` will not perform any\n   * operation at all. (A noop).\n   *\n   * `Subscription` instances that are added to this instance will automatically remove themselves\n   * if they are unsubscribed. Functions and {@link Unsubscribable} objects that you wish to remove\n   * will need to be removed manually with {@link #remove}\n   *\n   * @param teardown The finalization logic to add to this subscription.\n   */\n  add(teardown: TeardownLogic): void {\n    // Only add the finalizer if it's not undefined\n    // and don't add a subscription to itself.\n    if (teardown && teardown !== this) {\n      if (this.closed) {\n        // If this subscription is already closed,\n        // execute whatever finalizer is handed to it automatically.\n        execFinalizer(teardown);\n      } else {\n        if (teardown instanceof Subscription) {\n          // We don't add closed subscriptions, and we don't add the same subscription\n          // twice. Subscription unsubscribe is idempotent.\n          if (teardown.closed || teardown._hasParent(this)) {\n            return;\n          }\n          teardown._addParent(this);\n        }\n        (this._finalizers = this._finalizers ?? []).push(teardown);\n      }\n    }\n  }\n\n  /**\n   * Checks to see if a this subscription already has a particular parent.\n   * This will signal that this subscription has already been added to the parent in question.\n   * @param parent the parent to check for\n   */\n  private _hasParent(parent: Subscription) {\n    const { _parentage } = this;\n    return _parentage === parent || (Array.isArray(_parentage) && _parentage.includes(parent));\n  }\n\n  /**\n   * Adds a parent to this subscription so it can be removed from the parent if it\n   * unsubscribes on it's own.\n   *\n   * NOTE: THIS ASSUMES THAT {@link _hasParent} HAS ALREADY BEEN CHECKED.\n   * @param parent The parent subscription to add\n   */\n  private _addParent(parent: Subscription) {\n    const { _parentage } = this;\n    this._parentage = Array.isArray(_parentage) ? (_parentage.push(parent), _parentage) : _parentage ? [_parentage, parent] : parent;\n  }\n\n  /**\n   * Called on a child when it is removed via {@link #remove}.\n   * @param parent The parent to remove\n   */\n  private _removeParent(parent: Subscription) {\n    const { _parentage } = this;\n    if (_parentage === parent) {\n      this._parentage = null;\n    } else if (Array.isArray(_parentage)) {\n      arrRemove(_parentage, parent);\n    }\n  }\n\n  /**\n   * Removes a finalizer from this subscription that was previously added with the {@link #add} method.\n   *\n   * Note that `Subscription` instances, when unsubscribed, will automatically remove themselves\n   * from every other `Subscription` they have been added to. This means that using the `remove` method\n   * is not a common thing and should be used thoughtfully.\n   *\n   * If you add the same finalizer instance of a function or an unsubscribable object to a `Subscription` instance\n   * more than once, you will need to call `remove` the same number of times to remove all instances.\n   *\n   * All finalizer instances are removed to free up memory upon unsubscription.\n   *\n   * @param teardown The finalizer to remove from this subscription\n   */\n  remove(teardown: Exclude<TeardownLogic, void>): void {\n    const { _finalizers } = this;\n    _finalizers && arrRemove(_finalizers, teardown);\n\n    if (teardown instanceof Subscription) {\n      teardown._removeParent(this);\n    }\n  }\n}\n\nexport const EMPTY_SUBSCRIPTION = Subscription.EMPTY;\n\nexport function isSubscription(value: any): value is Subscription {\n  return (\n    value instanceof Subscription ||\n    (value && 'closed' in value && isFunction(value.remove) && isFunction(value.add) && isFunction(value.unsubscribe))\n  );\n}\n\nfunction execFinalizer(finalizer: Unsubscribable | (() => void)) {\n  if (isFunction(finalizer)) {\n    finalizer();\n  } else {\n    finalizer.unsubscribe();\n  }\n}\n","import { Subscriber } from './Subscriber';\nimport { ObservableNotification } from './types';\n\n/**\n * The {@link GlobalConfig} object for RxJS. It is used to configure things\n * like how to react on unhandled errors.\n */\nexport const config: GlobalConfig = {\n  onUnhandledError: null,\n  onStoppedNotification: null,\n  Promise: undefined,\n  useDeprecatedSynchronousErrorHandling: false,\n  useDeprecatedNextContext: false,\n};\n\n/**\n * The global configuration object for RxJS, used to configure things\n * like how to react on unhandled errors. Accessible via {@link config}\n * object.\n */\nexport interface GlobalConfig {\n  /**\n   * A registration point for unhandled errors from RxJS. These are errors that\n   * cannot were not handled by consuming code in the usual subscription path. For\n   * example, if you have this configured, and you subscribe to an observable without\n   * providing an error handler, errors from that subscription will end up here. This\n   * will _always_ be called asynchronously on another job in the runtime. This is because\n   * we do not want errors thrown in this user-configured handler to interfere with the\n   * behavior of the library.\n   */\n  onUnhandledError: ((err: any) => void) | null;\n\n  /**\n   * A registration point for notifications that cannot be sent to subscribers because they\n   * have completed, errored or have been explicitly unsubscribed. By default, next, complete\n   * and error notifications sent to stopped subscribers are noops. However, sometimes callers\n   * might want a different behavior. For example, with sources that attempt to report errors\n   * to stopped subscribers, a caller can configure RxJS to throw an unhandled error instead.\n   * This will _always_ be called asynchronously on another job in the runtime. This is because\n   * we do not want errors thrown in this user-configured handler to interfere with the\n   * behavior of the library.\n   */\n  onStoppedNotification: ((notification: ObservableNotification<any>, subscriber: Subscriber<any>) => void) | null;\n\n  /**\n   * The promise constructor used by default for {@link Observable#toPromise toPromise} and {@link Observable#forEach forEach}\n   * methods.\n   *\n   * @deprecated As of version 8, RxJS will no longer support this sort of injection of a\n   * Promise constructor. If you need a Promise implementation other than native promises,\n   * please polyfill/patch Promise as you see appropriate. Will be removed in v8.\n   */\n  Promise?: PromiseConstructorLike;\n\n  /**\n   * If true, turns on synchronous error rethrowing, which is a deprecated behavior\n   * in v6 and higher. This behavior enables bad patterns like wrapping a subscribe\n   * call in a try/catch block. It also enables producer interference, a nasty bug\n   * where a multicast can be broken for all observers by a downstream consumer with\n   * an unhandled error. DO NOT USE THIS FLAG UNLESS IT'S NEEDED TO BUY TIME\n   * FOR MIGRATION REASONS.\n   *\n   * @deprecated As of version 8, RxJS will no longer support synchronous throwing\n   * of unhandled errors. All errors will be thrown on a separate call stack to prevent bad\n   * behaviors described above. Will be removed in v8.\n   */\n  useDeprecatedSynchronousErrorHandling: boolean;\n\n  /**\n   * If true, enables an as-of-yet undocumented feature from v5: The ability to access\n   * `unsubscribe()` via `this` context in `next` functions created in observers passed\n   * to `subscribe`.\n   *\n   * This is being removed because the performance was severely problematic, and it could also cause\n   * issues when types other than POJOs are passed to subscribe as subscribers, as they will likely have\n   * their `this` context overwritten.\n   *\n   * @deprecated As of version 8, RxJS will no longer support altering the\n   * context of next functions provided as part of an observer to Subscribe. Instead,\n   * you will have access to a subscription or a signal or token that will allow you to do things like\n   * unsubscribe and test closed status. Will be removed in v8.\n   */\n  useDeprecatedNextContext: boolean;\n}\n","import type { TimerHandle } from './timerHandle';\ntype SetTimeoutFunction = (handler: () => void, timeout?: number, ...args: any[]) => TimerHandle;\ntype ClearTimeoutFunction = (handle: TimerHandle) => void;\n\ninterface TimeoutProvider {\n  setTimeout: SetTimeoutFunction;\n  clearTimeout: ClearTimeoutFunction;\n  delegate:\n    | {\n        setTimeout: SetTimeoutFunction;\n        clearTimeout: ClearTimeoutFunction;\n      }\n    | undefined;\n}\n\nexport const timeoutProvider: TimeoutProvider = {\n  // When accessing the delegate, use the variable rather than `this` so that\n  // the functions can be called without being bound to the provider.\n  setTimeout(handler: () => void, timeout?: number, ...args) {\n    const { delegate } = timeoutProvider;\n    if (delegate?.setTimeout) {\n      return delegate.setTimeout(handler, timeout, ...args);\n    }\n    return setTimeout(handler, timeout, ...args);\n  },\n  clearTimeout(handle) {\n    const { delegate } = timeoutProvider;\n    return (delegate?.clearTimeout || clearTimeout)(handle as any);\n  },\n  delegate: undefined,\n};\n","import { config } from '../config';\nimport { timeoutProvider } from '../scheduler/timeoutProvider';\n\n/**\n * Handles an error on another job either with the user-configured {@link onUnhandledError},\n * or by throwing it on that new job so it can be picked up by `window.onerror`, `process.on('error')`, etc.\n *\n * This should be called whenever there is an error that is out-of-band with the subscription\n * or when an error hits a terminal boundary of the subscription and no error handler was provided.\n *\n * @param err the error to report\n */\nexport function reportUnhandledError(err: any) {\n  timeoutProvider.setTimeout(() => {\n    const { onUnhandledError } = config;\n    if (onUnhandledError) {\n      // Execute the user-configured error handler.\n      onUnhandledError(err);\n    } else {\n      // Throw so it is picked up by the runtime's uncaught error mechanism.\n      throw err;\n    }\n  });\n}\n","/* tslint:disable:no-empty */\nexport function noop() { }\n","import { CompleteNotification, NextNotification, ErrorNotification } from './types';\n\n/**\n * A completion object optimized for memory use and created to be the\n * same \"shape\" as other notifications in v8.\n * @internal\n */\nexport const COMPLETE_NOTIFICATION = (() => createNotification('C', undefined, undefined) as CompleteNotification)();\n\n/**\n * Internal use only. Creates an optimized error notification that is the same \"shape\"\n * as other notifications.\n * @internal\n */\nexport function errorNotification(error: any): ErrorNotification {\n  return createNotification('E', undefined, error) as any;\n}\n\n/**\n * Internal use only. Creates an optimized next notification that is the same \"shape\"\n * as other notifications.\n * @internal\n */\nexport function nextNotification<T>(value: T) {\n  return createNotification('N', value, undefined) as NextNotification<T>;\n}\n\n/**\n * Ensures that all notifications created internally have the same \"shape\" in v8.\n *\n * TODO: This is only exported to support a crazy legacy test in `groupBy`.\n * @internal\n */\nexport function createNotification(kind: 'N' | 'E' | 'C', value: any, error: any) {\n  return {\n    kind,\n    value,\n    error,\n  };\n}\n","import { config } from '../config';\n\nlet context: { errorThrown: boolean; error: any } | null = null;\n\n/**\n * Handles dealing with errors for super-gross mode. Creates a context, in which\n * any synchronously thrown errors will be passed to {@link captureError}. Which\n * will record the error such that it will be rethrown after the call back is complete.\n * TODO: Remove in v8\n * @param cb An immediately executed function.\n */\nexport function errorContext(cb: () => void) {\n  if (config.useDeprecatedSynchronousErrorHandling) {\n    const isRoot = !context;\n    if (isRoot) {\n      context = { errorThrown: false, error: null };\n    }\n    cb();\n    if (isRoot) {\n      const { errorThrown, error } = context!;\n      context = null;\n      if (errorThrown) {\n        throw error;\n      }\n    }\n  } else {\n    // This is the general non-deprecated path for everyone that\n    // isn't crazy enough to use super-gross mode (useDeprecatedSynchronousErrorHandling)\n    cb();\n  }\n}\n\n/**\n * Captures errors only in super-gross mode.\n * @param err the error to capture\n */\nexport function captureError(err: any) {\n  if (config.useDeprecatedSynchronousErrorHandling && context) {\n    context.errorThrown = true;\n    context.error = err;\n  }\n}\n","import { isFunction } from './util/isFunction';\nimport { Observer, ObservableNotification } from './types';\nimport { isSubscription, Subscription } from './Subscription';\nimport { config } from './config';\nimport { reportUnhandledError } from './util/reportUnhandledError';\nimport { noop } from './util/noop';\nimport { nextNotification, errorNotification, COMPLETE_NOTIFICATION } from './NotificationFactories';\nimport { timeoutProvider } from './scheduler/timeoutProvider';\nimport { captureError } from './util/errorContext';\n\n/**\n * Implements the {@link Observer} interface and extends the\n * {@link Subscription} class. While the {@link Observer} is the public API for\n * consuming the values of an {@link Observable}, all Observers get converted to\n * a Subscriber, in order to provide Subscription-like capabilities such as\n * `unsubscribe`. Subscriber is a common type in RxJS, and crucial for\n * implementing operators, but it is rarely used as a public API.\n *\n * @class Subscriber<T>\n */\nexport class Subscriber<T> extends Subscription implements Observer<T> {\n  /**\n   * A static factory for a Subscriber, given a (potentially partial) definition\n   * of an Observer.\n   * @param next The `next` callback of an Observer.\n   * @param error The `error` callback of an\n   * Observer.\n   * @param complete The `complete` callback of an\n   * Observer.\n   * @return A Subscriber wrapping the (partially defined)\n   * Observer represented by the given arguments.\n   * @nocollapse\n   * @deprecated Do not use. Will be removed in v8. There is no replacement for this\n   * method, and there is no reason to be creating instances of `Subscriber` directly.\n   * If you have a specific use case, please file an issue.\n   */\n  static create<T>(next?: (x?: T) => void, error?: (e?: any) => void, complete?: () => void): Subscriber<T> {\n    return new SafeSubscriber(next, error, complete);\n  }\n\n  /** @deprecated Internal implementation detail, do not use directly. Will be made internal in v8. */\n  protected isStopped: boolean = false;\n  /** @deprecated Internal implementation detail, do not use directly. Will be made internal in v8. */\n  protected destination: Subscriber<any> | Observer<any>; // this `any` is the escape hatch to erase extra type param (e.g. R)\n\n  /**\n   * @deprecated Internal implementation detail, do not use directly. Will be made internal in v8.\n   * There is no reason to directly create an instance of Subscriber. This type is exported for typings reasons.\n   */\n  constructor(destination?: Subscriber<any> | Observer<any>) {\n    super();\n    if (destination) {\n      this.destination = destination;\n      // Automatically chain subscriptions together here.\n      // if destination is a Subscription, then it is a Subscriber.\n      if (isSubscription(destination)) {\n        destination.add(this);\n      }\n    } else {\n      this.destination = EMPTY_OBSERVER;\n    }\n  }\n\n  /**\n   * The {@link Observer} callback to receive notifications of type `next` from\n   * the Observable, with a value. The Observable may call this method 0 or more\n   * times.\n   * @param {T} [value] The `next` value.\n   * @return {void}\n   */\n  next(value?: T): void {\n    if (this.isStopped) {\n      handleStoppedNotification(nextNotification(value), this);\n    } else {\n      this._next(value!);\n    }\n  }\n\n  /**\n   * The {@link Observer} callback to receive notifications of type `error` from\n   * the Observable, with an attached `Error`. Notifies the Observer that\n   * the Observable has experienced an error condition.\n   * @param {any} [err] The `error` exception.\n   * @return {void}\n   */\n  error(err?: any): void {\n    if (this.isStopped) {\n      handleStoppedNotification(errorNotification(err), this);\n    } else {\n      this.isStopped = true;\n      this._error(err);\n    }\n  }\n\n  /**\n   * The {@link Observer} callback to receive a valueless notification of type\n   * `complete` from the Observable. Notifies the Observer that the Observable\n   * has finished sending push-based notifications.\n   * @return {void}\n   */\n  complete(): void {\n    if (this.isStopped) {\n      handleStoppedNotification(COMPLETE_NOTIFICATION, this);\n    } else {\n      this.isStopped = true;\n      this._complete();\n    }\n  }\n\n  unsubscribe(): void {\n    if (!this.closed) {\n      this.isStopped = true;\n      super.unsubscribe();\n      this.destination = null!;\n    }\n  }\n\n  protected _next(value: T): void {\n    this.destination.next(value);\n  }\n\n  protected _error(err: any): void {\n    try {\n      this.destination.error(err);\n    } finally {\n      this.unsubscribe();\n    }\n  }\n\n  protected _complete(): void {\n    try {\n      this.destination.complete();\n    } finally {\n      this.unsubscribe();\n    }\n  }\n}\n\n/**\n * This bind is captured here because we want to be able to have\n * compatibility with monoid libraries that tend to use a method named\n * `bind`. In particular, a library called Monio requires this.\n */\nconst _bind = Function.prototype.bind;\n\nfunction bind<Fn extends (...args: any[]) => any>(fn: Fn, thisArg: any): Fn {\n  return _bind.call(fn, thisArg);\n}\n\n/**\n * Internal optimization only, DO NOT EXPOSE.\n * @internal\n */\nclass ConsumerObserver<T> implements Observer<T> {\n  constructor(private partialObserver: Partial<Observer<T>>) {}\n\n  next(value: T): void {\n    const { partialObserver } = this;\n    if (partialObserver.next) {\n      try {\n        partialObserver.next(value);\n      } catch (error) {\n        handleUnhandledError(error);\n      }\n    }\n  }\n\n  error(err: any): void {\n    const { partialObserver } = this;\n    if (partialObserver.error) {\n      try {\n        partialObserver.error(err);\n      } catch (error) {\n        handleUnhandledError(error);\n      }\n    } else {\n      handleUnhandledError(err);\n    }\n  }\n\n  complete(): void {\n    const { partialObserver } = this;\n    if (partialObserver.complete) {\n      try {\n        partialObserver.complete();\n      } catch (error) {\n        handleUnhandledError(error);\n      }\n    }\n  }\n}\n\nexport class SafeSubscriber<T> extends Subscriber<T> {\n  constructor(\n    observerOrNext?: Partial<Observer<T>> | ((value: T) => void) | null,\n    error?: ((e?: any) => void) | null,\n    complete?: (() => void) | null\n  ) {\n    super();\n\n    let partialObserver: Partial<Observer<T>>;\n    if (isFunction(observerOrNext) || !observerOrNext) {\n      // The first argument is a function, not an observer. The next\n      // two arguments *could* be observers, or they could be empty.\n      partialObserver = {\n        next: (observerOrNext ?? undefined) as (((value: T) => void) | undefined),\n        error: error ?? undefined,\n        complete: complete ?? undefined,\n      };\n    } else {\n      // The first argument is a partial observer.\n      let context: any;\n      if (this && config.useDeprecatedNextContext) {\n        // This is a deprecated path that made `this.unsubscribe()` available in\n        // next handler functions passed to subscribe. This only exists behind a flag\n        // now, as it is *very* slow.\n        context = Object.create(observerOrNext);\n        context.unsubscribe = () => this.unsubscribe();\n        partialObserver = {\n          next: observerOrNext.next && bind(observerOrNext.next, context),\n          error: observerOrNext.error && bind(observerOrNext.error, context),\n          complete: observerOrNext.complete && bind(observerOrNext.complete, context),\n        };\n      } else {\n        // The \"normal\" path. Just use the partial observer directly.\n        partialObserver = observerOrNext;\n      }\n    }\n\n    // Wrap the partial observer to ensure it's a full observer, and\n    // make sure proper error handling is accounted for.\n    this.destination = new ConsumerObserver(partialObserver);\n  }\n}\n\nfunction handleUnhandledError(error: any) {\n  if (config.useDeprecatedSynchronousErrorHandling) {\n    captureError(error);\n  } else {\n    // Ideal path, we report this as an unhandled error,\n    // which is thrown on a new call stack.\n    reportUnhandledError(error);\n  }\n}\n\n/**\n * An error handler used when no error handler was supplied\n * to the SafeSubscriber -- meaning no error handler was supplied\n * do the `subscribe` call on our observable.\n * @param err The error to handle\n */\nfunction defaultErrorHandler(err: any) {\n  throw err;\n}\n\n/**\n * A handler for notifications that cannot be sent to a stopped subscriber.\n * @param notification The notification being sent\n * @param subscriber The stopped subscriber\n */\nfunction handleStoppedNotification(notification: ObservableNotification<any>, subscriber: Subscriber<any>) {\n  const { onStoppedNotification } = config;\n  onStoppedNotification && timeoutProvider.setTimeout(() => onStoppedNotification(notification, subscriber));\n}\n\n/**\n * The observer used as a stub for subscriptions where the user did not\n * pass any arguments to `subscribe`. Comes with the default error handling\n * behavior.\n */\nexport const EMPTY_OBSERVER: Readonly<Observer<any>> & { closed: true } = {\n  closed: true,\n  next: noop,\n  error: defaultErrorHandler,\n  complete: noop,\n};\n","/**\n * Symbol.observable or a string \"@@observable\". Used for interop\n *\n * @deprecated We will no longer be exporting this symbol in upcoming versions of RxJS.\n * Instead polyfill and use Symbol.observable directly *or* use https://www.npmjs.com/package/symbol-observable\n */\nexport const observable: string | symbol = (() => (typeof Symbol === 'function' && Symbol.observable) || '@@observable')();\n","/**\n * This function takes one parameter and just returns it. Simply put,\n * this is like `<T>(x: T): T => x`.\n *\n * ## Examples\n *\n * This is useful in some cases when using things like `mergeMap`\n *\n * ```ts\n * import { interval, take, map, range, mergeMap, identity } from 'rxjs';\n *\n * const source$ = interval(1000).pipe(take(5));\n *\n * const result$ = source$.pipe(\n *   map(i => range(i)),\n *   mergeMap(identity) // same as mergeMap(x => x)\n * );\n *\n * result$.subscribe({\n *   next: console.log\n * });\n * ```\n *\n * Or when you want to selectively apply an operator\n *\n * ```ts\n * import { interval, take, identity } from 'rxjs';\n *\n * const shouldLimit = () => Math.random() < 0.5;\n *\n * const source$ = interval(1000);\n *\n * const result$ = source$.pipe(shouldLimit() ? take(5) : identity);\n *\n * result$.subscribe({\n *   next: console.log\n * });\n * ```\n *\n * @param x Any value that is returned by this function\n * @returns The value passed as the first parameter to this function\n */\nexport function identity<T>(x: T): T {\n  return x;\n}\n","import { identity } from './identity';\nimport { UnaryFunction } from '../types';\n\nexport function pipe(): typeof identity;\nexport function pipe<T, A>(fn1: UnaryFunction<T, A>): UnaryFunction<T, A>;\nexport function pipe<T, A, B>(fn1: UnaryFunction<T, A>, fn2: UnaryFunction<A, B>): UnaryFunction<T, B>;\nexport function pipe<T, A, B, C>(fn1: UnaryFunction<T, A>, fn2: UnaryFunction<A, B>, fn3: UnaryFunction<B, C>): UnaryFunction<T, C>;\nexport function pipe<T, A, B, C, D>(\n  fn1: UnaryFunction<T, A>,\n  fn2: UnaryFunction<A, B>,\n  fn3: UnaryFunction<B, C>,\n  fn4: UnaryFunction<C, D>\n): UnaryFunction<T, D>;\nexport function pipe<T, A, B, C, D, E>(\n  fn1: UnaryFunction<T, A>,\n  fn2: UnaryFunction<A, B>,\n  fn3: UnaryFunction<B, C>,\n  fn4: UnaryFunction<C, D>,\n  fn5: UnaryFunction<D, E>\n): UnaryFunction<T, E>;\nexport function pipe<T, A, B, C, D, E, F>(\n  fn1: UnaryFunction<T, A>,\n  fn2: UnaryFunction<A, B>,\n  fn3: UnaryFunction<B, C>,\n  fn4: UnaryFunction<C, D>,\n  fn5: UnaryFunction<D, E>,\n  fn6: UnaryFunction<E, F>\n): UnaryFunction<T, F>;\nexport function pipe<T, A, B, C, D, E, F, G>(\n  fn1: UnaryFunction<T, A>,\n  fn2: UnaryFunction<A, B>,\n  fn3: UnaryFunction<B, C>,\n  fn4: UnaryFunction<C, D>,\n  fn5: UnaryFunction<D, E>,\n  fn6: UnaryFunction<E, F>,\n  fn7: UnaryFunction<F, G>\n): UnaryFunction<T, G>;\nexport function pipe<T, A, B, C, D, E, F, G, H>(\n  fn1: UnaryFunction<T, A>,\n  fn2: UnaryFunction<A, B>,\n  fn3: UnaryFunction<B, C>,\n  fn4: UnaryFunction<C, D>,\n  fn5: UnaryFunction<D, E>,\n  fn6: UnaryFunction<E, F>,\n  fn7: UnaryFunction<F, G>,\n  fn8: UnaryFunction<G, H>\n): UnaryFunction<T, H>;\nexport function pipe<T, A, B, C, D, E, F, G, H, I>(\n  fn1: UnaryFunction<T, A>,\n  fn2: UnaryFunction<A, B>,\n  fn3: UnaryFunction<B, C>,\n  fn4: UnaryFunction<C, D>,\n  fn5: UnaryFunction<D, E>,\n  fn6: UnaryFunction<E, F>,\n  fn7: UnaryFunction<F, G>,\n  fn8: UnaryFunction<G, H>,\n  fn9: UnaryFunction<H, I>\n): UnaryFunction<T, I>;\nexport function pipe<T, A, B, C, D, E, F, G, H, I>(\n  fn1: UnaryFunction<T, A>,\n  fn2: UnaryFunction<A, B>,\n  fn3: UnaryFunction<B, C>,\n  fn4: UnaryFunction<C, D>,\n  fn5: UnaryFunction<D, E>,\n  fn6: UnaryFunction<E, F>,\n  fn7: UnaryFunction<F, G>,\n  fn8: UnaryFunction<G, H>,\n  fn9: UnaryFunction<H, I>,\n  ...fns: UnaryFunction<any, any>[]\n): UnaryFunction<T, unknown>;\n\n/**\n * pipe() can be called on one or more functions, each of which can take one argument (\"UnaryFunction\")\n * and uses it to return a value.\n * It returns a function that takes one argument, passes it to the first UnaryFunction, and then\n * passes the result to the next one, passes that result to the next one, and so on.  \n */\nexport function pipe(...fns: Array<UnaryFunction<any, any>>): UnaryFunction<any, any> {\n  return pipeFromArray(fns);\n}\n\n/** @internal */\nexport function pipeFromArray<T, R>(fns: Array<UnaryFunction<T, R>>): UnaryFunction<T, R> {\n  if (fns.length === 0) {\n    return identity as UnaryFunction<any, any>;\n  }\n\n  if (fns.length === 1) {\n    return fns[0];\n  }\n\n  return function piped(input: T): R {\n    return fns.reduce((prev: any, fn: UnaryFunction<T, R>) => fn(prev), input as any);\n  };\n}\n","import { Operator } from './Operator';\nimport { SafeSubscriber, Subscriber } from './Subscriber';\nimport { isSubscription, Subscription } from './Subscription';\nimport { TeardownLogic, OperatorFunction, Subscribable, Observer } from './types';\nimport { observable as Symbol_observable } from './symbol/observable';\nimport { pipeFromArray } from './util/pipe';\nimport { config } from './config';\nimport { isFunction } from './util/isFunction';\nimport { errorContext } from './util/errorContext';\n\n/**\n * A representation of any set of values over any amount of time. This is the most basic building block\n * of RxJS.\n *\n * @class Observable<T>\n */\nexport class Observable<T> implements Subscribable<T> {\n  /**\n   * @deprecated Internal implementation detail, do not use directly. Will be made internal in v8.\n   */\n  source: Observable<any> | undefined;\n\n  /**\n   * @deprecated Internal implementation detail, do not use directly. Will be made internal in v8.\n   */\n  operator: Operator<any, T> | undefined;\n\n  /**\n   * @constructor\n   * @param {Function} subscribe the function that is called when the Observable is\n   * initially subscribed to. This function is given a Subscriber, to which new values\n   * can be `next`ed, or an `error` method can be called to raise an error, or\n   * `complete` can be called to notify of a successful completion.\n   */\n  constructor(subscribe?: (this: Observable<T>, subscriber: Subscriber<T>) => TeardownLogic) {\n    if (subscribe) {\n      this._subscribe = subscribe;\n    }\n  }\n\n  // HACK: Since TypeScript inherits static properties too, we have to\n  // fight against TypeScript here so Subject can have a different static create signature\n  /**\n   * Creates a new Observable by calling the Observable constructor\n   * @owner Observable\n   * @method create\n   * @param {Function} subscribe? the subscriber function to be passed to the Observable constructor\n   * @return {Observable} a new observable\n   * @nocollapse\n   * @deprecated Use `new Observable()` instead. Will be removed in v8.\n   */\n  static create: (...args: any[]) => any = <T>(subscribe?: (subscriber: Subscriber<T>) => TeardownLogic) => {\n    return new Observable<T>(subscribe);\n  };\n\n  /**\n   * Creates a new Observable, with this Observable instance as the source, and the passed\n   * operator defined as the new observable's operator.\n   * @method lift\n   * @param operator the operator defining the operation to take on the observable\n   * @return a new observable with the Operator applied\n   * @deprecated Internal implementation detail, do not use directly. Will be made internal in v8.\n   * If you have implemented an operator using `lift`, it is recommended that you create an\n   * operator by simply returning `new Observable()` directly. See \"Creating new operators from\n   * scratch\" section here: https://rxjs.dev/guide/operators\n   */\n  lift<R>(operator?: Operator<T, R>): Observable<R> {\n    const observable = new Observable<R>();\n    observable.source = this;\n    observable.operator = operator;\n    return observable;\n  }\n\n  subscribe(observerOrNext?: Partial<Observer<T>> | ((value: T) => void)): Subscription;\n  /** @deprecated Instead of passing separate callback arguments, use an observer argument. Signatures taking separate callback arguments will be removed in v8. Details: https://rxjs.dev/deprecations/subscribe-arguments */\n  subscribe(next?: ((value: T) => void) | null, error?: ((error: any) => void) | null, complete?: (() => void) | null): Subscription;\n  /**\n   * Invokes an execution of an Observable and registers Observer handlers for notifications it will emit.\n   *\n   * <span class=\"informal\">Use it when you have all these Observables, but still nothing is happening.</span>\n   *\n   * `subscribe` is not a regular operator, but a method that calls Observable's internal `subscribe` function. It\n   * might be for example a function that you passed to Observable's constructor, but most of the time it is\n   * a library implementation, which defines what will be emitted by an Observable, and when it be will emitted. This means\n   * that calling `subscribe` is actually the moment when Observable starts its work, not when it is created, as it is often\n   * the thought.\n   *\n   * Apart from starting the execution of an Observable, this method allows you to listen for values\n   * that an Observable emits, as well as for when it completes or errors. You can achieve this in two\n   * of the following ways.\n   *\n   * The first way is creating an object that implements {@link Observer} interface. It should have methods\n   * defined by that interface, but note that it should be just a regular JavaScript object, which you can create\n   * yourself in any way you want (ES6 class, classic function constructor, object literal etc.). In particular, do\n   * not attempt to use any RxJS implementation details to create Observers - you don't need them. Remember also\n   * that your object does not have to implement all methods. If you find yourself creating a method that doesn't\n   * do anything, you can simply omit it. Note however, if the `error` method is not provided and an error happens,\n   * it will be thrown asynchronously. Errors thrown asynchronously cannot be caught using `try`/`catch`. Instead,\n   * use the {@link onUnhandledError} configuration option or use a runtime handler (like `window.onerror` or\n   * `process.on('error)`) to be notified of unhandled errors. Because of this, it's recommended that you provide\n   * an `error` method to avoid missing thrown errors.\n   *\n   * The second way is to give up on Observer object altogether and simply provide callback functions in place of its methods.\n   * This means you can provide three functions as arguments to `subscribe`, where the first function is equivalent\n   * of a `next` method, the second of an `error` method and the third of a `complete` method. Just as in case of an Observer,\n   * if you do not need to listen for something, you can omit a function by passing `undefined` or `null`,\n   * since `subscribe` recognizes these functions by where they were placed in function call. When it comes\n   * to the `error` function, as with an Observer, if not provided, errors emitted by an Observable will be thrown asynchronously.\n   *\n   * You can, however, subscribe with no parameters at all. This may be the case where you're not interested in terminal events\n   * and you also handled emissions internally by using operators (e.g. using `tap`).\n   *\n   * Whichever style of calling `subscribe` you use, in both cases it returns a Subscription object.\n   * This object allows you to call `unsubscribe` on it, which in turn will stop the work that an Observable does and will clean\n   * up all resources that an Observable used. Note that cancelling a subscription will not call `complete` callback\n   * provided to `subscribe` function, which is reserved for a regular completion signal that comes from an Observable.\n   *\n   * Remember that callbacks provided to `subscribe` are not guaranteed to be called asynchronously.\n   * It is an Observable itself that decides when these functions will be called. For example {@link of}\n   * by default emits all its values synchronously. Always check documentation for how given Observable\n   * will behave when subscribed and if its default behavior can be modified with a `scheduler`.\n   *\n   * #### Examples\n   *\n   * Subscribe with an {@link guide/observer Observer}\n   *\n   * ```ts\n   * import { of } from 'rxjs';\n   *\n   * const sumObserver = {\n   *   sum: 0,\n   *   next(value) {\n   *     console.log('Adding: ' + value);\n   *     this.sum = this.sum + value;\n   *   },\n   *   error() {\n   *     // We actually could just remove this method,\n   *     // since we do not really care about errors right now.\n   *   },\n   *   complete() {\n   *     console.log('Sum equals: ' + this.sum);\n   *   }\n   * };\n   *\n   * of(1, 2, 3) // Synchronously emits 1, 2, 3 and then completes.\n   *   .subscribe(sumObserver);\n   *\n   * // Logs:\n   * // 'Adding: 1'\n   * // 'Adding: 2'\n   * // 'Adding: 3'\n   * // 'Sum equals: 6'\n   * ```\n   *\n   * Subscribe with functions ({@link deprecations/subscribe-arguments deprecated})\n   *\n   * ```ts\n   * import { of } from 'rxjs'\n   *\n   * let sum = 0;\n   *\n   * of(1, 2, 3).subscribe(\n   *   value => {\n   *     console.log('Adding: ' + value);\n   *     sum = sum + value;\n   *   },\n   *   undefined,\n   *   () => console.log('Sum equals: ' + sum)\n   * );\n   *\n   * // Logs:\n   * // 'Adding: 1'\n   * // 'Adding: 2'\n   * // 'Adding: 3'\n   * // 'Sum equals: 6'\n   * ```\n   *\n   * Cancel a subscription\n   *\n   * ```ts\n   * import { interval } from 'rxjs';\n   *\n   * const subscription = interval(1000).subscribe({\n   *   next(num) {\n   *     console.log(num)\n   *   },\n   *   complete() {\n   *     // Will not be called, even when cancelling subscription.\n   *     console.log('completed!');\n   *   }\n   * });\n   *\n   * setTimeout(() => {\n   *   subscription.unsubscribe();\n   *   console.log('unsubscribed!');\n   * }, 2500);\n   *\n   * // Logs:\n   * // 0 after 1s\n   * // 1 after 2s\n   * // 'unsubscribed!' after 2.5s\n   * ```\n   *\n   * @param {Observer|Function} observerOrNext (optional) Either an observer with methods to be called,\n   * or the first of three possible handlers, which is the handler for each value emitted from the subscribed\n   * Observable.\n   * @param {Function} error (optional) A handler for a terminal event resulting from an error. If no error handler is provided,\n   * the error will be thrown asynchronously as unhandled.\n   * @param {Function} complete (optional) A handler for a terminal event resulting from successful completion.\n   * @return {Subscription} a subscription reference to the registered handlers\n   * @method subscribe\n   */\n  subscribe(\n    observerOrNext?: Partial<Observer<T>> | ((value: T) => void) | null,\n    error?: ((error: any) => void) | null,\n    complete?: (() => void) | null\n  ): Subscription {\n    const subscriber = isSubscriber(observerOrNext) ? observerOrNext : new SafeSubscriber(observerOrNext, error, complete);\n\n    errorContext(() => {\n      const { operator, source } = this;\n      subscriber.add(\n        operator\n          ? // We're dealing with a subscription in the\n            // operator chain to one of our lifted operators.\n            operator.call(subscriber, source)\n          : source\n          ? // If `source` has a value, but `operator` does not, something that\n            // had intimate knowledge of our API, like our `Subject`, must have\n            // set it. We're going to just call `_subscribe` directly.\n            this._subscribe(subscriber)\n          : // In all other cases, we're likely wrapping a user-provided initializer\n            // function, so we need to catch errors and handle them appropriately.\n            this._trySubscribe(subscriber)\n      );\n    });\n\n    return subscriber;\n  }\n\n  /** @internal */\n  protected _trySubscribe(sink: Subscriber<T>): TeardownLogic {\n    try {\n      return this._subscribe(sink);\n    } catch (err) {\n      // We don't need to return anything in this case,\n      // because it's just going to try to `add()` to a subscription\n      // above.\n      sink.error(err);\n    }\n  }\n\n  /**\n   * Used as a NON-CANCELLABLE means of subscribing to an observable, for use with\n   * APIs that expect promises, like `async/await`. You cannot unsubscribe from this.\n   *\n   * **WARNING**: Only use this with observables you *know* will complete. If the source\n   * observable does not complete, you will end up with a promise that is hung up, and\n   * potentially all of the state of an async function hanging out in memory. To avoid\n   * this situation, look into adding something like {@link timeout}, {@link take},\n   * {@link takeWhile}, or {@link takeUntil} amongst others.\n   *\n   * #### Example\n   *\n   * ```ts\n   * import { interval, take } from 'rxjs';\n   *\n   * const source$ = interval(1000).pipe(take(4));\n   *\n   * async function getTotal() {\n   *   let total = 0;\n   *\n   *   await source$.forEach(value => {\n   *     total += value;\n   *     console.log('observable -> ' + value);\n   *   });\n   *\n   *   return total;\n   * }\n   *\n   * getTotal().then(\n   *   total => console.log('Total: ' + total)\n   * );\n   *\n   * // Expected:\n   * // 'observable -> 0'\n   * // 'observable -> 1'\n   * // 'observable -> 2'\n   * // 'observable -> 3'\n   * // 'Total: 6'\n   * ```\n   *\n   * @param next a handler for each value emitted by the observable\n   * @return a promise that either resolves on observable completion or\n   *  rejects with the handled error\n   */\n  forEach(next: (value: T) => void): Promise<void>;\n\n  /**\n   * @param next a handler for each value emitted by the observable\n   * @param promiseCtor a constructor function used to instantiate the Promise\n   * @return a promise that either resolves on observable completion or\n   *  rejects with the handled error\n   * @deprecated Passing a Promise constructor will no longer be available\n   * in upcoming versions of RxJS. This is because it adds weight to the library, for very\n   * little benefit. If you need this functionality, it is recommended that you either\n   * polyfill Promise, or you create an adapter to convert the returned native promise\n   * to whatever promise implementation you wanted. Will be removed in v8.\n   */\n  forEach(next: (value: T) => void, promiseCtor: PromiseConstructorLike): Promise<void>;\n\n  forEach(next: (value: T) => void, promiseCtor?: PromiseConstructorLike): Promise<void> {\n    promiseCtor = getPromiseCtor(promiseCtor);\n\n    return new promiseCtor<void>((resolve, reject) => {\n      const subscriber = new SafeSubscriber<T>({\n        next: (value) => {\n          try {\n            next(value);\n          } catch (err) {\n            reject(err);\n            subscriber.unsubscribe();\n          }\n        },\n        error: reject,\n        complete: resolve,\n      });\n      this.subscribe(subscriber);\n    }) as Promise<void>;\n  }\n\n  /** @internal */\n  protected _subscribe(subscriber: Subscriber<any>): TeardownLogic {\n    return this.source?.subscribe(subscriber);\n  }\n\n  /**\n   * An interop point defined by the es7-observable spec https://github.com/zenparsing/es-observable\n   * @method Symbol.observable\n   * @return {Observable} this instance of the observable\n   */\n  [Symbol_observable]() {\n    return this;\n  }\n\n  /* tslint:disable:max-line-length */\n  pipe(): Observable<T>;\n  pipe<A>(op1: OperatorFunction<T, A>): Observable<A>;\n  pipe<A, B>(op1: OperatorFunction<T, A>, op2: OperatorFunction<A, B>): Observable<B>;\n  pipe<A, B, C>(op1: OperatorFunction<T, A>, op2: OperatorFunction<A, B>, op3: OperatorFunction<B, C>): Observable<C>;\n  pipe<A, B, C, D>(\n    op1: OperatorFunction<T, A>,\n    op2: OperatorFunction<A, B>,\n    op3: OperatorFunction<B, C>,\n    op4: OperatorFunction<C, D>\n  ): Observable<D>;\n  pipe<A, B, C, D, E>(\n    op1: OperatorFunction<T, A>,\n    op2: OperatorFunction<A, B>,\n    op3: OperatorFunction<B, C>,\n    op4: OperatorFunction<C, D>,\n    op5: OperatorFunction<D, E>\n  ): Observable<E>;\n  pipe<A, B, C, D, E, F>(\n    op1: OperatorFunction<T, A>,\n    op2: OperatorFunction<A, B>,\n    op3: OperatorFunction<B, C>,\n    op4: OperatorFunction<C, D>,\n    op5: OperatorFunction<D, E>,\n    op6: OperatorFunction<E, F>\n  ): Observable<F>;\n  pipe<A, B, C, D, E, F, G>(\n    op1: OperatorFunction<T, A>,\n    op2: OperatorFunction<A, B>,\n    op3: OperatorFunction<B, C>,\n    op4: OperatorFunction<C, D>,\n    op5: OperatorFunction<D, E>,\n    op6: OperatorFunction<E, F>,\n    op7: OperatorFunction<F, G>\n  ): Observable<G>;\n  pipe<A, B, C, D, E, F, G, H>(\n    op1: OperatorFunction<T, A>,\n    op2: OperatorFunction<A, B>,\n    op3: OperatorFunction<B, C>,\n    op4: OperatorFunction<C, D>,\n    op5: OperatorFunction<D, E>,\n    op6: OperatorFunction<E, F>,\n    op7: OperatorFunction<F, G>,\n    op8: OperatorFunction<G, H>\n  ): Observable<H>;\n  pipe<A, B, C, D, E, F, G, H, I>(\n    op1: OperatorFunction<T, A>,\n    op2: OperatorFunction<A, B>,\n    op3: OperatorFunction<B, C>,\n    op4: OperatorFunction<C, D>,\n    op5: OperatorFunction<D, E>,\n    op6: OperatorFunction<E, F>,\n    op7: OperatorFunction<F, G>,\n    op8: OperatorFunction<G, H>,\n    op9: OperatorFunction<H, I>\n  ): Observable<I>;\n  pipe<A, B, C, D, E, F, G, H, I>(\n    op1: OperatorFunction<T, A>,\n    op2: OperatorFunction<A, B>,\n    op3: OperatorFunction<B, C>,\n    op4: OperatorFunction<C, D>,\n    op5: OperatorFunction<D, E>,\n    op6: OperatorFunction<E, F>,\n    op7: OperatorFunction<F, G>,\n    op8: OperatorFunction<G, H>,\n    op9: OperatorFunction<H, I>,\n    ...operations: OperatorFunction<any, any>[]\n  ): Observable<unknown>;\n  /* tslint:enable:max-line-length */\n\n  /**\n   * Used to stitch together functional operators into a chain.\n   * @method pipe\n   * @return {Observable} the Observable result of all of the operators having\n   * been called in the order they were passed in.\n   *\n   * ## Example\n   *\n   * ```ts\n   * import { interval, filter, map, scan } from 'rxjs';\n   *\n   * interval(1000)\n   *   .pipe(\n   *     filter(x => x % 2 === 0),\n   *     map(x => x + x),\n   *     scan((acc, x) => acc + x)\n   *   )\n   *   .subscribe(x => console.log(x));\n   * ```\n   */\n  pipe(...operations: OperatorFunction<any, any>[]): Observable<any> {\n    return pipeFromArray(operations)(this);\n  }\n\n  /* tslint:disable:max-line-length */\n  /** @deprecated Replaced with {@link firstValueFrom} and {@link lastValueFrom}. Will be removed in v8. Details: https://rxjs.dev/deprecations/to-promise */\n  toPromise(): Promise<T | undefined>;\n  /** @deprecated Replaced with {@link firstValueFrom} and {@link lastValueFrom}. Will be removed in v8. Details: https://rxjs.dev/deprecations/to-promise */\n  toPromise(PromiseCtor: typeof Promise): Promise<T | undefined>;\n  /** @deprecated Replaced with {@link firstValueFrom} and {@link lastValueFrom}. Will be removed in v8. Details: https://rxjs.dev/deprecations/to-promise */\n  toPromise(PromiseCtor: PromiseConstructorLike): Promise<T | undefined>;\n  /* tslint:enable:max-line-length */\n\n  /**\n   * Subscribe to this Observable and get a Promise resolving on\n   * `complete` with the last emission (if any).\n   *\n   * **WARNING**: Only use this with observables you *know* will complete. If the source\n   * observable does not complete, you will end up with a promise that is hung up, and\n   * potentially all of the state of an async function hanging out in memory. To avoid\n   * this situation, look into adding something like {@link timeout}, {@link take},\n   * {@link takeWhile}, or {@link takeUntil} amongst others.\n   *\n   * @method toPromise\n   * @param [promiseCtor] a constructor function used to instantiate\n   * the Promise\n   * @return A Promise that resolves with the last value emit, or\n   * rejects on an error. If there were no emissions, Promise\n   * resolves with undefined.\n   * @deprecated Replaced with {@link firstValueFrom} and {@link lastValueFrom}. Will be removed in v8. Details: https://rxjs.dev/deprecations/to-promise\n   */\n  toPromise(promiseCtor?: PromiseConstructorLike): Promise<T | undefined> {\n    promiseCtor = getPromiseCtor(promiseCtor);\n\n    return new promiseCtor((resolve, reject) => {\n      let value: T | undefined;\n      this.subscribe(\n        (x: T) => (value = x),\n        (err: any) => reject(err),\n        () => resolve(value)\n      );\n    }) as Promise<T | undefined>;\n  }\n}\n\n/**\n * Decides between a passed promise constructor from consuming code,\n * A default configured promise constructor, and the native promise\n * constructor and returns it. If nothing can be found, it will throw\n * an error.\n * @param promiseCtor The optional promise constructor to passed by consuming code\n */\nfunction getPromiseCtor(promiseCtor: PromiseConstructorLike | undefined) {\n  return promiseCtor ?? config.Promise ?? Promise;\n}\n\nfunction isObserver<T>(value: any): value is Observer<T> {\n  return value && isFunction(value.next) && isFunction(value.error) && isFunction(value.complete);\n}\n\nfunction isSubscriber<T>(value: any): value is Subscriber<T> {\n  return (value && value instanceof Subscriber) || (isObserver(value) && isSubscription(value));\n}\n","import { Observable } from '../Observable';\nimport { Subscriber } from '../Subscriber';\nimport { OperatorFunction } from '../types';\nimport { isFunction } from './isFunction';\n\n/**\n * Used to determine if an object is an Observable with a lift function.\n */\nexport function hasLift(source: any): source is { lift: InstanceType<typeof Observable>['lift'] } {\n  return isFunction(source?.lift);\n}\n\n/**\n * Creates an `OperatorFunction`. Used to define operators throughout the library in a concise way.\n * @param init The logic to connect the liftedSource to the subscriber at the moment of subscription.\n */\nexport function operate<T, R>(\n  init: (liftedSource: Observable<T>, subscriber: Subscriber<R>) => (() => void) | void\n): OperatorFunction<T, R> {\n  return (source: Observable<T>) => {\n    if (hasLift(source)) {\n      return source.lift(function (this: Subscriber<R>, liftedSource: Observable<T>) {\n        try {\n          return init(liftedSource, this);\n        } catch (err) {\n          this.error(err);\n        }\n      });\n    }\n    throw new TypeError('Unable to lift unknown Observable type');\n  };\n}\n","import { Subscriber } from '../Subscriber';\n\n/**\n * Creates an instance of an `OperatorSubscriber`.\n * @param destination The downstream subscriber.\n * @param onNext Handles next values, only called if this subscriber is not stopped or closed. Any\n * error that occurs in this function is caught and sent to the `error` method of this subscriber.\n * @param onError Handles errors from the subscription, any errors that occur in this handler are caught\n * and send to the `destination` error handler.\n * @param onComplete Handles completion notification from the subscription. Any errors that occur in\n * this handler are sent to the `destination` error handler.\n * @param onFinalize Additional teardown logic here. This will only be called on teardown if the\n * subscriber itself is not already closed. This is called after all other teardown logic is executed.\n */\nexport function createOperatorSubscriber<T>(\n  destination: Subscriber<any>,\n  onNext?: (value: T) => void,\n  onComplete?: () => void,\n  onError?: (err: any) => void,\n  onFinalize?: () => void\n): Subscriber<T> {\n  return new OperatorSubscriber(destination, onNext, onComplete, onError, onFinalize);\n}\n\n/**\n * A generic helper for allowing operators to be created with a Subscriber and\n * use closures to capture necessary state from the operator function itself.\n */\nexport class OperatorSubscriber<T> extends Subscriber<T> {\n  /**\n   * Creates an instance of an `OperatorSubscriber`.\n   * @param destination The downstream subscriber.\n   * @param onNext Handles next values, only called if this subscriber is not stopped or closed. Any\n   * error that occurs in this function is caught and sent to the `error` method of this subscriber.\n   * @param onError Handles errors from the subscription, any errors that occur in this handler are caught\n   * and send to the `destination` error handler.\n   * @param onComplete Handles completion notification from the subscription. Any errors that occur in\n   * this handler are sent to the `destination` error handler.\n   * @param onFinalize Additional finalization logic here. This will only be called on finalization if the\n   * subscriber itself is not already closed. This is called after all other finalization logic is executed.\n   * @param shouldUnsubscribe An optional check to see if an unsubscribe call should truly unsubscribe.\n   * NOTE: This currently **ONLY** exists to support the strange behavior of {@link groupBy}, where unsubscription\n   * to the resulting observable does not actually disconnect from the source if there are active subscriptions\n   * to any grouped observable. (DO NOT EXPOSE OR USE EXTERNALLY!!!)\n   */\n  constructor(\n    destination: Subscriber<any>,\n    onNext?: (value: T) => void,\n    onComplete?: () => void,\n    onError?: (err: any) => void,\n    private onFinalize?: () => void,\n    private shouldUnsubscribe?: () => boolean\n  ) {\n    // It's important - for performance reasons - that all of this class's\n    // members are initialized and that they are always initialized in the same\n    // order. This will ensure that all OperatorSubscriber instances have the\n    // same hidden class in V8. This, in turn, will help keep the number of\n    // hidden classes involved in property accesses within the base class as\n    // low as possible. If the number of hidden classes involved exceeds four,\n    // the property accesses will become megamorphic and performance penalties\n    // will be incurred - i.e. inline caches won't be used.\n    //\n    // The reasons for ensuring all instances have the same hidden class are\n    // further discussed in this blog post from Benedikt Meurer:\n    // https://benediktmeurer.de/2018/03/23/impact-of-polymorphism-on-component-based-frameworks-like-react/\n    super(destination);\n    this._next = onNext\n      ? function (this: OperatorSubscriber<T>, value: T) {\n          try {\n            onNext(value);\n          } catch (err) {\n            destination.error(err);\n          }\n        }\n      : super._next;\n    this._error = onError\n      ? function (this: OperatorSubscriber<T>, err: any) {\n          try {\n            onError(err);\n          } catch (err) {\n            // Send any errors that occur down stream.\n            destination.error(err);\n          } finally {\n            // Ensure finalization.\n            this.unsubscribe();\n          }\n        }\n      : super._error;\n    this._complete = onComplete\n      ? function (this: OperatorSubscriber<T>) {\n          try {\n            onComplete();\n          } catch (err) {\n            // Send any errors that occur down stream.\n            destination.error(err);\n          } finally {\n            // Ensure finalization.\n            this.unsubscribe();\n          }\n        }\n      : super._complete;\n  }\n\n  unsubscribe() {\n    if (!this.shouldUnsubscribe || this.shouldUnsubscribe()) {\n      const { closed } = this;\n      super.unsubscribe();\n      // Execute additional teardown if we have any and we didn't already do so.\n      !closed && this.onFinalize?.();\n    }\n  }\n}\n","import { TimestampProvider } from '../types';\n\ninterface DateTimestampProvider extends TimestampProvider {\n  delegate: TimestampProvider | undefined;\n}\n\nexport const dateTimestampProvider: DateTimestampProvider = {\n  now() {\n    // Use the variable rather than `this` so that the function can be called\n    // without being bound to the provider.\n    return (dateTimestampProvider.delegate || Date).now();\n  },\n  delegate: undefined,\n};\n","import { Scheduler } from '../Scheduler';\nimport { Subscription } from '../Subscription';\nimport { SchedulerAction } from '../types';\n\n/**\n * A unit of work to be executed in a `scheduler`. An action is typically\n * created from within a {@link SchedulerLike} and an RxJS user does not need to concern\n * themselves about creating and manipulating an Action.\n *\n * ```ts\n * class Action<T> extends Subscription {\n *   new (scheduler: Scheduler, work: (state?: T) => void);\n *   schedule(state?: T, delay: number = 0): Subscription;\n * }\n * ```\n *\n * @class Action<T>\n */\nexport class Action<T> extends Subscription {\n  constructor(scheduler: Scheduler, work: (this: SchedulerAction<T>, state?: T) => void) {\n    super();\n  }\n  /**\n   * Schedules this action on its parent {@link SchedulerLike} for execution. May be passed\n   * some context object, `state`. May happen at some point in the future,\n   * according to the `delay` parameter, if specified.\n   * @param {T} [state] Some contextual data that the `work` function uses when\n   * called by the Scheduler.\n   * @param {number} [delay] Time to wait before executing the work, where the\n   * time unit is implicit and defined by the Scheduler.\n   * @return {void}\n   */\n  public schedule(state?: T, delay: number = 0): Subscription {\n    return this;\n  }\n}\n","import type { TimerHandle } from './timerHandle';\ntype SetIntervalFunction = (handler: () => void, timeout?: number, ...args: any[]) => TimerHandle;\ntype ClearIntervalFunction = (handle: TimerHandle) => void;\n\ninterface IntervalProvider {\n  setInterval: SetIntervalFunction;\n  clearInterval: ClearIntervalFunction;\n  delegate:\n    | {\n        setInterval: SetIntervalFunction;\n        clearInterval: ClearIntervalFunction;\n      }\n    | undefined;\n}\n\nexport const intervalProvider: IntervalProvider = {\n  // When accessing the delegate, use the variable rather than `this` so that\n  // the functions can be called without being bound to the provider.\n  setInterval(handler: () => void, timeout?: number, ...args) {\n    const { delegate } = intervalProvider;\n    if (delegate?.setInterval) {\n      return delegate.setInterval(handler, timeout, ...args);\n    }\n    return setInterval(handler, timeout, ...args);\n  },\n  clearInterval(handle) {\n    const { delegate } = intervalProvider;\n    return (delegate?.clearInterval || clearInterval)(handle as any);\n  },\n  delegate: undefined,\n};\n","import { Action } from './Action';\nimport { SchedulerAction } from '../types';\nimport { Subscription } from '../Subscription';\nimport { AsyncScheduler } from './AsyncScheduler';\nimport { intervalProvider } from './intervalProvider';\nimport { arrRemove } from '../util/arrRemove';\nimport { TimerHandle } from './timerHandle';\n\nexport class AsyncAction<T> extends Action<T> {\n  public id: TimerHandle | undefined;\n  public state?: T;\n  // @ts-ignore: Property has no initializer and is not definitely assigned\n  public delay: number;\n  protected pending: boolean = false;\n\n  constructor(protected scheduler: AsyncScheduler, protected work: (this: SchedulerAction<T>, state?: T) => void) {\n    super(scheduler, work);\n  }\n\n  public schedule(state?: T, delay: number = 0): Subscription {\n    if (this.closed) {\n      return this;\n    }\n\n    // Always replace the current state with the new state.\n    this.state = state;\n\n    const id = this.id;\n    const scheduler = this.scheduler;\n\n    //\n    // Important implementation note:\n    //\n    // Actions only execute once by default, unless rescheduled from within the\n    // scheduled callback. This allows us to implement single and repeat\n    // actions via the same code path, without adding API surface area, as well\n    // as mimic traditional recursion but across asynchronous boundaries.\n    //\n    // However, JS runtimes and timers distinguish between intervals achieved by\n    // serial `setTimeout` calls vs. a single `setInterval` call. An interval of\n    // serial `setTimeout` calls can be individually delayed, which delays\n    // scheduling the next `setTimeout`, and so on. `setInterval` attempts to\n    // guarantee the interval callback will be invoked more precisely to the\n    // interval period, regardless of load.\n    //\n    // Therefore, we use `setInterval` to schedule single and repeat actions.\n    // If the action reschedules itself with the same delay, the interval is not\n    // canceled. If the action doesn't reschedule, or reschedules with a\n    // different delay, the interval will be canceled after scheduled callback\n    // execution.\n    //\n    if (id != null) {\n      this.id = this.recycleAsyncId(scheduler, id, delay);\n    }\n\n    // Set the pending flag indicating that this action has been scheduled, or\n    // has recursively rescheduled itself.\n    this.pending = true;\n\n    this.delay = delay;\n    // If this action has already an async Id, don't request a new one.\n    this.id = this.id ?? this.requestAsyncId(scheduler, this.id, delay);\n\n    return this;\n  }\n\n  protected requestAsyncId(scheduler: AsyncScheduler, _id?: TimerHandle, delay: number = 0): TimerHandle {\n    return intervalProvider.setInterval(scheduler.flush.bind(scheduler, this), delay);\n  }\n\n  protected recycleAsyncId(_scheduler: AsyncScheduler, id?: TimerHandle, delay: number | null = 0): TimerHandle | undefined {\n    // If this action is rescheduled with the same delay time, don't clear the interval id.\n    if (delay != null && this.delay === delay && this.pending === false) {\n      return id;\n    }\n    // Otherwise, if the action's delay time is different from the current delay,\n    // or the action has been rescheduled before it's executed, clear the interval id\n    if (id != null) {\n      intervalProvider.clearInterval(id);\n    }\n\n    return undefined;\n  }\n\n  /**\n   * Immediately executes this action and the `work` it contains.\n   * @return {any}\n   */\n  public execute(state: T, delay: number): any {\n    if (this.closed) {\n      return new Error('executing a cancelled action');\n    }\n\n    this.pending = false;\n    const error = this._execute(state, delay);\n    if (error) {\n      return error;\n    } else if (this.pending === false && this.id != null) {\n      // Dequeue if the action didn't reschedule itself. Don't call\n      // unsubscribe(), because the action could reschedule later.\n      // For example:\n      // ```\n      // scheduler.schedule(function doWork(counter) {\n      //   /* ... I'm a busy worker bee ... */\n      //   var originalAction = this;\n      //   /* wait 100ms before rescheduling the action */\n      //   setTimeout(function () {\n      //     originalAction.schedule(counter + 1);\n      //   }, 100);\n      // }, 1000);\n      // ```\n      this.id = this.recycleAsyncId(this.scheduler, this.id, null);\n    }\n  }\n\n  protected _execute(state: T, _delay: number): any {\n    let errored: boolean = false;\n    let errorValue: any;\n    try {\n      this.work(state);\n    } catch (e) {\n      errored = true;\n      // HACK: Since code elsewhere is relying on the \"truthiness\" of the\n      // return here, we can't have it return \"\" or 0 or false.\n      // TODO: Clean this up when we refactor schedulers mid-version-8 or so.\n      errorValue = e ? e : new Error('Scheduled action threw falsy error');\n    }\n    if (errored) {\n      this.unsubscribe();\n      return errorValue;\n    }\n  }\n\n  unsubscribe() {\n    if (!this.closed) {\n      const { id, scheduler } = this;\n      const { actions } = scheduler;\n\n      this.work = this.state = this.scheduler = null!;\n      this.pending = false;\n\n      arrRemove(actions, this);\n      if (id != null) {\n        this.id = this.recycleAsyncId(scheduler, id, null);\n      }\n\n      this.delay = null!;\n      super.unsubscribe();\n    }\n  }\n}\n","import { Action } from './scheduler/Action';\nimport { Subscription } from './Subscription';\nimport { SchedulerLike, SchedulerAction } from './types';\nimport { dateTimestampProvider } from './scheduler/dateTimestampProvider';\n\n/**\n * An execution context and a data structure to order tasks and schedule their\n * execution. Provides a notion of (potentially virtual) time, through the\n * `now()` getter method.\n *\n * Each unit of work in a Scheduler is called an `Action`.\n *\n * ```ts\n * class Scheduler {\n *   now(): number;\n *   schedule(work, delay?, state?): Subscription;\n * }\n * ```\n *\n * @class Scheduler\n * @deprecated Scheduler is an internal implementation detail of RxJS, and\n * should not be used directly. Rather, create your own class and implement\n * {@link SchedulerLike}. Will be made internal in v8.\n */\nexport class Scheduler implements SchedulerLike {\n  public static now: () => number = dateTimestampProvider.now;\n\n  constructor(private schedulerActionCtor: typeof Action, now: () => number = Scheduler.now) {\n    this.now = now;\n  }\n\n  /**\n   * A getter method that returns a number representing the current time\n   * (at the time this function was called) according to the scheduler's own\n   * internal clock.\n   * @return {number} A number that represents the current time. May or may not\n   * have a relation to wall-clock time. May or may not refer to a time unit\n   * (e.g. milliseconds).\n   */\n  public now: () => number;\n\n  /**\n   * Schedules a function, `work`, for execution. May happen at some point in\n   * the future, according to the `delay` parameter, if specified. May be passed\n   * some context object, `state`, which will be passed to the `work` function.\n   *\n   * The given arguments will be processed an stored as an Action object in a\n   * queue of actions.\n   *\n   * @param {function(state: ?T): ?Subscription} work A function representing a\n   * task, or some unit of work to be executed by the Scheduler.\n   * @param {number} [delay] Time to wait before executing the work, where the\n   * time unit is implicit and defined by the Scheduler itself.\n   * @param {T} [state] Some contextual data that the `work` function uses when\n   * called by the Scheduler.\n   * @return {Subscription} A subscription in order to be able to unsubscribe\n   * the scheduled work.\n   */\n  public schedule<T>(work: (this: SchedulerAction<T>, state?: T) => void, delay: number = 0, state?: T): Subscription {\n    return new this.schedulerActionCtor<T>(this, work).schedule(state, delay);\n  }\n}\n","import { Scheduler } from '../Scheduler';\nimport { Action } from './Action';\nimport { AsyncAction } from './AsyncAction';\nimport { TimerHandle } from './timerHandle';\n\nexport class AsyncScheduler extends Scheduler {\n  public actions: Array<AsyncAction<any>> = [];\n  /**\n   * A flag to indicate whether the Scheduler is currently executing a batch of\n   * queued actions.\n   * @type {boolean}\n   * @internal\n   */\n  public _active: boolean = false;\n  /**\n   * An internal ID used to track the latest asynchronous task such as those\n   * coming from `setTimeout`, `setInterval`, `requestAnimationFrame`, and\n   * others.\n   * @type {any}\n   * @internal\n   */\n  public _scheduled: TimerHandle | undefined;\n\n  constructor(SchedulerAction: typeof Action, now: () => number = Scheduler.now) {\n    super(SchedulerAction, now);\n  }\n\n  public flush(action: AsyncAction<any>): void {\n    const { actions } = this;\n\n    if (this._active) {\n      actions.push(action);\n      return;\n    }\n\n    let error: any;\n    this._active = true;\n\n    do {\n      if ((error = action.execute(action.state, action.delay))) {\n        break;\n      }\n    } while ((action = actions.shift()!)); // exhaust the scheduler queue\n\n    this._active = false;\n\n    if (error) {\n      while ((action = actions.shift()!)) {\n        action.unsubscribe();\n      }\n      throw error;\n    }\n  }\n}\n","import { AsyncAction } from './AsyncAction';\nimport { AsyncScheduler } from './AsyncScheduler';\n\n/**\n *\n * Async Scheduler\n *\n * <span class=\"informal\">Schedule task as if you used setTimeout(task, duration)</span>\n *\n * `async` scheduler schedules tasks asynchronously, by putting them on the JavaScript\n * event loop queue. It is best used to delay tasks in time or to schedule tasks repeating\n * in intervals.\n *\n * If you just want to \"defer\" task, that is to perform it right after currently\n * executing synchronous code ends (commonly achieved by `setTimeout(deferredTask, 0)`),\n * better choice will be the {@link asapScheduler} scheduler.\n *\n * ## Examples\n * Use async scheduler to delay task\n * ```ts\n * import { asyncScheduler } from 'rxjs';\n *\n * const task = () => console.log('it works!');\n *\n * asyncScheduler.schedule(task, 2000);\n *\n * // After 2 seconds logs:\n * // \"it works!\"\n * ```\n *\n * Use async scheduler to repeat task in intervals\n * ```ts\n * import { asyncScheduler } from 'rxjs';\n *\n * function task(state) {\n *   console.log(state);\n *   this.schedule(state + 1, 1000); // `this` references currently executing Action,\n *                                   // which we reschedule with new state and delay\n * }\n *\n * asyncScheduler.schedule(task, 3000, 0);\n *\n * // Logs:\n * // 0 after 3s\n * // 1 after 4s\n * // 2 after 5s\n * // 3 after 6s\n * ```\n */\n\nexport const asyncScheduler = new AsyncScheduler(AsyncAction);\n\n/**\n * @deprecated Renamed to {@link asyncScheduler}. Will be removed in v8.\n */\nexport const async = asyncScheduler;\n","export const isArrayLike = (<T>(x: any): x is ArrayLike<T> => x && typeof x.length === 'number' && typeof x !== 'function');","import { isFunction } from \"./isFunction\";\n\n/**\n * Tests to see if the object is \"thennable\".\n * @param value the object to test\n */\nexport function isPromise(value: any): value is PromiseLike<any> {\n  return isFunction(value?.then);\n}\n","import { InteropObservable } from '../types';\nimport { observable as Symbol_observable } from '../symbol/observable';\nimport { isFunction } from './isFunction';\n\n/** Identifies an input as being Observable (but not necessary an Rx Observable) */\nexport function isInteropObservable(input: any): input is InteropObservable<any> {\n  return isFunction(input[Symbol_observable]);\n}\n","import { isFunction } from './isFunction';\n\nexport function isAsyncIterable<T>(obj: any): obj is AsyncIterable<T> {\n  return Symbol.asyncIterator && isFunction(obj?.[Symbol.asyncIterator]);\n}\n","/**\n * Creates the TypeError to throw if an invalid object is passed to `from` or `scheduled`.\n * @param input The object that was passed.\n */\nexport function createInvalidObservableTypeError(input: any) {\n  // TODO: We should create error codes that can be looked up, so this can be less verbose.\n  return new TypeError(\n    `You provided ${\n      input !== null && typeof input === 'object' ? 'an invalid object' : `'${input}'`\n    } where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`\n  );\n}\n","export function getSymbolIterator(): symbol {\n  if (typeof Symbol !== 'function' || !Symbol.iterator) {\n    return '@@iterator' as any;\n  }\n\n  return Symbol.iterator;\n}\n\nexport const iterator = getSymbolIterator();\n","import { iterator as Symbol_iterator } from '../symbol/iterator';\nimport { isFunction } from './isFunction';\n\n/** Identifies an input as being an Iterable */\nexport function isIterable(input: any): input is Iterable<any> {\n  return isFunction(input?.[Symbol_iterator]);\n}\n","import { ReadableStreamLike } from '../types';\nimport { isFunction } from './isFunction';\n\nexport async function* readableStreamLikeToAsyncGenerator<T>(readableStream: ReadableStreamLike<T>): AsyncGenerator<T> {\n  const reader = readableStream.getReader();\n  try {\n    while (true) {\n      const { value, done } = await reader.read();\n      if (done) {\n        return;\n      }\n      yield value!;\n    }\n  } finally {\n    reader.releaseLock();\n  }\n}\n\nexport function isReadableStreamLike<T>(obj: any): obj is ReadableStreamLike<T> {\n  // We don't want to use instanceof checks because they would return\n  // false for instances from another Realm, like an <iframe>.\n  return isFunction(obj?.getReader);\n}\n","import { isArrayLike } from '../util/isArrayLike';\nimport { isPromise } from '../util/isPromise';\nimport { Observable } from '../Observable';\nimport { ObservableInput, ObservedValueOf, ReadableStreamLike } from '../types';\nimport { isInteropObservable } from '../util/isInteropObservable';\nimport { isAsyncIterable } from '../util/isAsyncIterable';\nimport { createInvalidObservableTypeError } from '../util/throwUnobservableError';\nimport { isIterable } from '../util/isIterable';\nimport { isReadableStreamLike, readableStreamLikeToAsyncGenerator } from '../util/isReadableStreamLike';\nimport { Subscriber } from '../Subscriber';\nimport { isFunction } from '../util/isFunction';\nimport { reportUnhandledError } from '../util/reportUnhandledError';\nimport { observable as Symbol_observable } from '../symbol/observable';\n\nexport function innerFrom<O extends ObservableInput<any>>(input: O): Observable<ObservedValueOf<O>>;\nexport function innerFrom<T>(input: ObservableInput<T>): Observable<T> {\n  if (input instanceof Observable) {\n    return input;\n  }\n  if (input != null) {\n    if (isInteropObservable(input)) {\n      return fromInteropObservable(input);\n    }\n    if (isArrayLike(input)) {\n      return fromArrayLike(input);\n    }\n    if (isPromise(input)) {\n      return fromPromise(input);\n    }\n    if (isAsyncIterable(input)) {\n      return fromAsyncIterable(input);\n    }\n    if (isIterable(input)) {\n      return fromIterable(input);\n    }\n    if (isReadableStreamLike(input)) {\n      return fromReadableStreamLike(input);\n    }\n  }\n\n  throw createInvalidObservableTypeError(input);\n}\n\n/**\n * Creates an RxJS Observable from an object that implements `Symbol.observable`.\n * @param obj An object that properly implements `Symbol.observable`.\n */\nexport function fromInteropObservable<T>(obj: any) {\n  return new Observable((subscriber: Subscriber<T>) => {\n    const obs = obj[Symbol_observable]();\n    if (isFunction(obs.subscribe)) {\n      return obs.subscribe(subscriber);\n    }\n    // Should be caught by observable subscribe function error handling.\n    throw new TypeError('Provided object does not correctly implement Symbol.observable');\n  });\n}\n\n/**\n * Synchronously emits the values of an array like and completes.\n * This is exported because there are creation functions and operators that need to\n * make direct use of the same logic, and there's no reason to make them run through\n * `from` conditionals because we *know* they're dealing with an array.\n * @param array The array to emit values from\n */\nexport function fromArrayLike<T>(array: ArrayLike<T>) {\n  return new Observable((subscriber: Subscriber<T>) => {\n    // Loop over the array and emit each value. Note two things here:\n    // 1. We're making sure that the subscriber is not closed on each loop.\n    //    This is so we don't continue looping over a very large array after\n    //    something like a `take`, `takeWhile`, or other synchronous unsubscription\n    //    has already unsubscribed.\n    // 2. In this form, reentrant code can alter that array we're looping over.\n    //    This is a known issue, but considered an edge case. The alternative would\n    //    be to copy the array before executing the loop, but this has\n    //    performance implications.\n    for (let i = 0; i < array.length && !subscriber.closed; i++) {\n      subscriber.next(array[i]);\n    }\n    subscriber.complete();\n  });\n}\n\nexport function fromPromise<T>(promise: PromiseLike<T>) {\n  return new Observable((subscriber: Subscriber<T>) => {\n    promise\n      .then(\n        (value) => {\n          if (!subscriber.closed) {\n            subscriber.next(value);\n            subscriber.complete();\n          }\n        },\n        (err: any) => subscriber.error(err)\n      )\n      .then(null, reportUnhandledError);\n  });\n}\n\nexport function fromIterable<T>(iterable: Iterable<T>) {\n  return new Observable((subscriber: Subscriber<T>) => {\n    for (const value of iterable) {\n      subscriber.next(value);\n      if (subscriber.closed) {\n        return;\n      }\n    }\n    subscriber.complete();\n  });\n}\n\nexport function fromAsyncIterable<T>(asyncIterable: AsyncIterable<T>) {\n  return new Observable((subscriber: Subscriber<T>) => {\n    process(asyncIterable, subscriber).catch((err) => subscriber.error(err));\n  });\n}\n\nexport function fromReadableStreamLike<T>(readableStream: ReadableStreamLike<T>) {\n  return fromAsyncIterable(readableStreamLikeToAsyncGenerator(readableStream));\n}\n\nasync function process<T>(asyncIterable: AsyncIterable<T>, subscriber: Subscriber<T>) {\n  for await (const value of asyncIterable) {\n    subscriber.next(value);\n    // A side-effect may have closed our subscriber,\n    // check before the next iteration.\n    if (subscriber.closed) {\n      return;\n    }\n  }\n  subscriber.complete();\n}\n","import { Subscription } from '../Subscription';\nimport { SchedulerAction, SchedulerLike } from '../types';\n\nexport function executeSchedule(\n  parentSubscription: Subscription,\n  scheduler: SchedulerLike,\n  work: () => void,\n  delay: number,\n  repeat: true\n): void;\nexport function executeSchedule(\n  parentSubscription: Subscription,\n  scheduler: SchedulerLike,\n  work: () => void,\n  delay?: number,\n  repeat?: false\n): Subscription;\n\nexport function executeSchedule(\n  parentSubscription: Subscription,\n  scheduler: SchedulerLike,\n  work: () => void,\n  delay = 0,\n  repeat = false\n): Subscription | void {\n  const scheduleSubscription = scheduler.schedule(function (this: SchedulerAction<any>) {\n    work();\n    if (repeat) {\n      parentSubscription.add(this.schedule(null, delay));\n    } else {\n      this.unsubscribe();\n    }\n  }, delay);\n\n  parentSubscription.add(scheduleSubscription);\n\n  if (!repeat) {\n    // Because user-land scheduler implementations are unlikely to properly reuse\n    // Actions for repeat scheduling, we can't trust that the returned subscription\n    // will control repeat subscription scenarios. So we're trying to avoid using them\n    // incorrectly within this library.\n    return scheduleSubscription;\n  }\n}\n","import { OperatorFunction } from '../types';\nimport { operate } from '../util/lift';\nimport { createOperatorSubscriber } from './OperatorSubscriber';\n\nexport function map<T, R>(project: (value: T, index: number) => R): OperatorFunction<T, R>;\n/** @deprecated Use a closure instead of a `thisArg`. Signatures accepting a `thisArg` will be removed in v8. */\nexport function map<T, R, A>(project: (this: A, value: T, index: number) => R, thisArg: A): OperatorFunction<T, R>;\n\n/**\n * Applies a given `project` function to each value emitted by the source\n * Observable, and emits the resulting values as an Observable.\n *\n * <span class=\"informal\">Like [Array.prototype.map()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map),\n * it passes each source value through a transformation function to get\n * corresponding output values.</span>\n *\n * ![](map.png)\n *\n * Similar to the well known `Array.prototype.map` function, this operator\n * applies a projection to each value and emits that projection in the output\n * Observable.\n *\n * ## Example\n *\n * Map every click to the `clientX` position of that click\n *\n * ```ts\n * import { fromEvent, map } from 'rxjs';\n *\n * const clicks = fromEvent<PointerEvent>(document, 'click');\n * const positions = clicks.pipe(map(ev => ev.clientX));\n *\n * positions.subscribe(x => console.log(x));\n * ```\n *\n * @see {@link mapTo}\n * @see {@link pluck}\n *\n * @param {function(value: T, index: number): R} project The function to apply\n * to each `value` emitted by the source Observable. The `index` parameter is\n * the number `i` for the i-th emission that has happened since the\n * subscription, starting from the number `0`.\n * @param {any} [thisArg] An optional argument to define what `this` is in the\n * `project` function.\n * @return A function that returns an Observable that emits the values from the\n * source Observable transformed by the given `project` function.\n */\nexport function map<T, R>(project: (value: T, index: number) => R, thisArg?: any): OperatorFunction<T, R> {\n  return operate((source, subscriber) => {\n    // The index of the value from the source. Used with projection.\n    let index = 0;\n    // Subscribe to the source, all errors and completions are sent along\n    // to the consumer.\n    source.subscribe(\n      createOperatorSubscriber(subscriber, (value: T) => {\n        // Call the projection function with the appropriate this context,\n        // and send the resulting value to the consumer.\n        subscriber.next(project.call(thisArg, value, index++));\n      })\n    );\n  });\n}\n","import { OperatorFunction } from \"../types\";\nimport { map } from \"../operators/map\";\n\nconst { isArray } = Array;\n\nfunction callOrApply<T, R>(fn: ((...values: T[]) => R), args: T|T[]): R {\n    return isArray(args) ? fn(...args) : fn(args);\n}\n\n/**\n * Used in several -- mostly deprecated -- situations where we need to \n * apply a list of arguments or a single argument to a result selector.\n */\nexport function mapOneOrManyArgs<T, R>(fn: ((...values: T[]) => R)): OperatorFunction<T|T[], R> {\n    return map(args => callOrApply(fn, args))\n}","import { Observable } from '../Observable';\nimport { innerFrom } from '../observable/innerFrom';\nimport { Subscriber } from '../Subscriber';\nimport { ObservableInput, SchedulerLike } from '../types';\nimport { executeSchedule } from '../util/executeSchedule';\nimport { createOperatorSubscriber } from './OperatorSubscriber';\n\n/**\n * A process embodying the general \"merge\" strategy. This is used in\n * `mergeMap` and `mergeScan` because the logic is otherwise nearly identical.\n * @param source The original source observable\n * @param subscriber The consumer subscriber\n * @param project The projection function to get our inner sources\n * @param concurrent The number of concurrent inner subscriptions\n * @param onBeforeNext Additional logic to apply before nexting to our consumer\n * @param expand If `true` this will perform an \"expand\" strategy, which differs only\n * in that it recurses, and the inner subscription must be schedule-able.\n * @param innerSubScheduler A scheduler to use to schedule inner subscriptions,\n * this is to support the expand strategy, mostly, and should be deprecated\n */\nexport function mergeInternals<T, R>(\n  source: Observable<T>,\n  subscriber: Subscriber<R>,\n  project: (value: T, index: number) => ObservableInput<R>,\n  concurrent: number,\n  onBeforeNext?: (innerValue: R) => void,\n  expand?: boolean,\n  innerSubScheduler?: SchedulerLike,\n  additionalFinalizer?: () => void\n) {\n  // Buffered values, in the event of going over our concurrency limit\n  const buffer: T[] = [];\n  // The number of active inner subscriptions.\n  let active = 0;\n  // An index to pass to our accumulator function\n  let index = 0;\n  // Whether or not the outer source has completed.\n  let isComplete = false;\n\n  /**\n   * Checks to see if we can complete our result or not.\n   */\n  const checkComplete = () => {\n    // If the outer has completed, and nothing is left in the buffer,\n    // and we don't have any active inner subscriptions, then we can\n    // Emit the state and complete.\n    if (isComplete && !buffer.length && !active) {\n      subscriber.complete();\n    }\n  };\n\n  // If we're under our concurrency limit, just start the inner subscription, otherwise buffer and wait.\n  const outerNext = (value: T) => (active < concurrent ? doInnerSub(value) : buffer.push(value));\n\n  const doInnerSub = (value: T) => {\n    // If we're expanding, we need to emit the outer values and the inner values\n    // as the inners will \"become outers\" in a way as they are recursively fed\n    // back to the projection mechanism.\n    expand && subscriber.next(value as any);\n\n    // Increment the number of active subscriptions so we can track it\n    // against our concurrency limit later.\n    active++;\n\n    // A flag used to show that the inner observable completed.\n    // This is checked during finalization to see if we should\n    // move to the next item in the buffer, if there is on.\n    let innerComplete = false;\n\n    // Start our inner subscription.\n    innerFrom(project(value, index++)).subscribe(\n      createOperatorSubscriber(\n        subscriber,\n        (innerValue) => {\n          // `mergeScan` has additional handling here. For example\n          // taking the inner value and updating state.\n          onBeforeNext?.(innerValue);\n\n          if (expand) {\n            // If we're expanding, then just recurse back to our outer\n            // handler. It will emit the value first thing.\n            outerNext(innerValue as any);\n          } else {\n            // Otherwise, emit the inner value.\n            subscriber.next(innerValue);\n          }\n        },\n        () => {\n          // Flag that we have completed, so we know to check the buffer\n          // during finalization.\n          innerComplete = true;\n        },\n        // Errors are passed to the destination.\n        undefined,\n        () => {\n          // During finalization, if the inner completed (it wasn't errored or\n          // cancelled), then we want to try the next item in the buffer if\n          // there is one.\n          if (innerComplete) {\n            // We have to wrap this in a try/catch because it happens during\n            // finalization, possibly asynchronously, and we want to pass\n            // any errors that happen (like in a projection function) to\n            // the outer Subscriber.\n            try {\n              // INNER SOURCE COMPLETE\n              // Decrement the active count to ensure that the next time\n              // we try to call `doInnerSub`, the number is accurate.\n              active--;\n              // If we have more values in the buffer, try to process those\n              // Note that this call will increment `active` ahead of the\n              // next conditional, if there were any more inner subscriptions\n              // to start.\n              while (buffer.length && active < concurrent) {\n                const bufferedValue = buffer.shift()!;\n                // Particularly for `expand`, we need to check to see if a scheduler was provided\n                // for when we want to start our inner subscription. Otherwise, we just start\n                // are next inner subscription.\n                if (innerSubScheduler) {\n                  executeSchedule(subscriber, innerSubScheduler, () => doInnerSub(bufferedValue));\n                } else {\n                  doInnerSub(bufferedValue);\n                }\n              }\n              // Check to see if we can complete, and complete if so.\n              checkComplete();\n            } catch (err) {\n              subscriber.error(err);\n            }\n          }\n        }\n      )\n    );\n  };\n\n  // Subscribe to our source observable.\n  source.subscribe(\n    createOperatorSubscriber(subscriber, outerNext, () => {\n      // Outer completed, make a note of it, and check to see if we can complete everything.\n      isComplete = true;\n      checkComplete();\n    })\n  );\n\n  // Additional finalization (for when the destination is torn down).\n  // Other finalization is added implicitly via subscription above.\n  return () => {\n    additionalFinalizer?.();\n  };\n}\n","import { ObservableInput, OperatorFunction, ObservedValueOf } from '../types';\nimport { map } from './map';\nimport { innerFrom } from '../observable/innerFrom';\nimport { operate } from '../util/lift';\nimport { mergeInternals } from './mergeInternals';\nimport { isFunction } from '../util/isFunction';\n\n/* tslint:disable:max-line-length */\nexport function mergeMap<T, O extends ObservableInput<any>>(\n  project: (value: T, index: number) => O,\n  concurrent?: number\n): OperatorFunction<T, ObservedValueOf<O>>;\n/** @deprecated The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector */\nexport function mergeMap<T, O extends ObservableInput<any>>(\n  project: (value: T, index: number) => O,\n  resultSelector: undefined,\n  concurrent?: number\n): OperatorFunction<T, ObservedValueOf<O>>;\n/** @deprecated The `resultSelector` parameter will be removed in v8. Use an inner `map` instead. Details: https://rxjs.dev/deprecations/resultSelector */\nexport function mergeMap<T, R, O extends ObservableInput<any>>(\n  project: (value: T, index: number) => O,\n  resultSelector: (outerValue: T, innerValue: ObservedValueOf<O>, outerIndex: number, innerIndex: number) => R,\n  concurrent?: number\n): OperatorFunction<T, R>;\n/* tslint:enable:max-line-length */\n\n/**\n * Projects each source value to an Observable which is merged in the output\n * Observable.\n *\n * <span class=\"informal\">Maps each value to an Observable, then flattens all of\n * these inner Observables using {@link mergeAll}.</span>\n *\n * ![](mergeMap.png)\n *\n * Returns an Observable that emits items based on applying a function that you\n * supply to each item emitted by the source Observable, where that function\n * returns an Observable, and then merging those resulting Observables and\n * emitting the results of this merger.\n *\n * ## Example\n *\n * Map and flatten each letter to an Observable ticking every 1 second\n *\n * ```ts\n * import { of, mergeMap, interval, map } from 'rxjs';\n *\n * const letters = of('a', 'b', 'c');\n * const result = letters.pipe(\n *   mergeMap(x => interval(1000).pipe(map(i => x + i)))\n * );\n *\n * result.subscribe(x => console.log(x));\n *\n * // Results in the following:\n * // a0\n * // b0\n * // c0\n * // a1\n * // b1\n * // c1\n * // continues to list a, b, c every second with respective ascending integers\n * ```\n *\n * @see {@link concatMap}\n * @see {@link exhaustMap}\n * @see {@link merge}\n * @see {@link mergeAll}\n * @see {@link mergeMapTo}\n * @see {@link mergeScan}\n * @see {@link switchMap}\n *\n * @param {function(value: T, ?index: number): ObservableInput} project A function\n * that, when applied to an item emitted by the source Observable, returns an\n * Observable.\n * @param {number} [concurrent=Infinity] Maximum number of input\n * Observables being subscribed to concurrently.\n * @return A function that returns an Observable that emits the result of\n * applying the projection function (and the optional deprecated\n * `resultSelector`) to each item emitted by the source Observable and merging\n * the results of the Observables obtained from this transformation.\n */\nexport function mergeMap<T, R, O extends ObservableInput<any>>(\n  project: (value: T, index: number) => O,\n  resultSelector?: ((outerValue: T, innerValue: ObservedValueOf<O>, outerIndex: number, innerIndex: number) => R) | number,\n  concurrent: number = Infinity\n): OperatorFunction<T, ObservedValueOf<O> | R> {\n  if (isFunction(resultSelector)) {\n    // DEPRECATED PATH\n    return mergeMap((a, i) => map((b: any, ii: number) => resultSelector(a, b, i, ii))(innerFrom(project(a, i))), concurrent);\n  } else if (typeof resultSelector === 'number') {\n    concurrent = resultSelector;\n  }\n\n  return operate((source, subscriber) => mergeInternals(source, subscriber, project, concurrent));\n}\n","import { innerFrom } from '../observable/innerFrom';\nimport { Observable } from '../Observable';\nimport { mergeMap } from '../operators/mergeMap';\nimport { isArrayLike } from '../util/isArrayLike';\nimport { isFunction } from '../util/isFunction';\nimport { mapOneOrManyArgs } from '../util/mapOneOrManyArgs';\n\n// These constants are used to create handler registry functions using array mapping below.\nconst nodeEventEmitterMethods = ['addListener', 'removeListener'] as const;\nconst eventTargetMethods = ['addEventListener', 'removeEventListener'] as const;\nconst jqueryMethods = ['on', 'off'] as const;\n\nexport interface NodeStyleEventEmitter {\n  addListener(eventName: string | symbol, handler: NodeEventHandler): this;\n  removeListener(eventName: string | symbol, handler: NodeEventHandler): this;\n}\n\nexport type NodeEventHandler = (...args: any[]) => void;\n\n// For APIs that implement `addListener` and `removeListener` methods that may\n// not use the same arguments or return EventEmitter values\n// such as React Native\nexport interface NodeCompatibleEventEmitter {\n  addListener(eventName: string, handler: NodeEventHandler): void | {};\n  removeListener(eventName: string, handler: NodeEventHandler): void | {};\n}\n\n// Use handler types like those in @types/jquery. See:\n// https://github.com/DefinitelyTyped/DefinitelyTyped/blob/847731ba1d7fa6db6b911c0e43aa0afe596e7723/types/jquery/misc.d.ts#L6395\nexport interface JQueryStyleEventEmitter<TContext, T> {\n  on(eventName: string, handler: (this: TContext, t: T, ...args: any[]) => any): void;\n  off(eventName: string, handler: (this: TContext, t: T, ...args: any[]) => any): void;\n}\n\nexport interface EventListenerObject<E> {\n  handleEvent(evt: E): void;\n}\n\nexport interface HasEventTargetAddRemove<E> {\n  addEventListener(\n    type: string,\n    listener: ((evt: E) => void) | EventListenerObject<E> | null,\n    options?: boolean | AddEventListenerOptions\n  ): void;\n  removeEventListener(\n    type: string,\n    listener: ((evt: E) => void) | EventListenerObject<E> | null,\n    options?: EventListenerOptions | boolean\n  ): void;\n}\n\nexport interface EventListenerOptions {\n  capture?: boolean;\n  passive?: boolean;\n  once?: boolean;\n}\n\nexport interface AddEventListenerOptions extends EventListenerOptions {\n  once?: boolean;\n  passive?: boolean;\n}\n\nexport function fromEvent<T>(target: HasEventTargetAddRemove<T> | ArrayLike<HasEventTargetAddRemove<T>>, eventName: string): Observable<T>;\nexport function fromEvent<T, R>(\n  target: HasEventTargetAddRemove<T> | ArrayLike<HasEventTargetAddRemove<T>>,\n  eventName: string,\n  resultSelector: (event: T) => R\n): Observable<R>;\nexport function fromEvent<T>(\n  target: HasEventTargetAddRemove<T> | ArrayLike<HasEventTargetAddRemove<T>>,\n  eventName: string,\n  options: EventListenerOptions\n): Observable<T>;\nexport function fromEvent<T, R>(\n  target: HasEventTargetAddRemove<T> | ArrayLike<HasEventTargetAddRemove<T>>,\n  eventName: string,\n  options: EventListenerOptions,\n  resultSelector: (event: T) => R\n): Observable<R>;\n\nexport function fromEvent(target: NodeStyleEventEmitter | ArrayLike<NodeStyleEventEmitter>, eventName: string): Observable<unknown>;\n/** @deprecated Do not specify explicit type parameters. Signatures with type parameters that cannot be inferred will be removed in v8. */\nexport function fromEvent<T>(target: NodeStyleEventEmitter | ArrayLike<NodeStyleEventEmitter>, eventName: string): Observable<T>;\nexport function fromEvent<R>(\n  target: NodeStyleEventEmitter | ArrayLike<NodeStyleEventEmitter>,\n  eventName: string,\n  resultSelector: (...args: any[]) => R\n): Observable<R>;\n\nexport function fromEvent(\n  target: NodeCompatibleEventEmitter | ArrayLike<NodeCompatibleEventEmitter>,\n  eventName: string\n): Observable<unknown>;\n/** @deprecated Do not specify explicit type parameters. Signatures with type parameters that cannot be inferred will be removed in v8. */\nexport function fromEvent<T>(target: NodeCompatibleEventEmitter | ArrayLike<NodeCompatibleEventEmitter>, eventName: string): Observable<T>;\nexport function fromEvent<R>(\n  target: NodeCompatibleEventEmitter | ArrayLike<NodeCompatibleEventEmitter>,\n  eventName: string,\n  resultSelector: (...args: any[]) => R\n): Observable<R>;\n\nexport function fromEvent<T>(\n  target: JQueryStyleEventEmitter<any, T> | ArrayLike<JQueryStyleEventEmitter<any, T>>,\n  eventName: string\n): Observable<T>;\nexport function fromEvent<T, R>(\n  target: JQueryStyleEventEmitter<any, T> | ArrayLike<JQueryStyleEventEmitter<any, T>>,\n  eventName: string,\n  resultSelector: (value: T, ...args: any[]) => R\n): Observable<R>;\n\n/**\n * Creates an Observable that emits events of a specific type coming from the\n * given event target.\n *\n * <span class=\"informal\">Creates an Observable from DOM events, or Node.js\n * EventEmitter events or others.</span>\n *\n * ![](fromEvent.png)\n *\n * `fromEvent` accepts as a first argument event target, which is an object with methods\n * for registering event handler functions. As a second argument it takes string that indicates\n * type of event we want to listen for. `fromEvent` supports selected types of event targets,\n * which are described in detail below. If your event target does not match any of the ones listed,\n * you should use {@link fromEventPattern}, which can be used on arbitrary APIs.\n * When it comes to APIs supported by `fromEvent`, their methods for adding and removing event\n * handler functions have different names, but they all accept a string describing event type\n * and function itself, which will be called whenever said event happens.\n *\n * Every time resulting Observable is subscribed, event handler function will be registered\n * to event target on given event type. When that event fires, value\n * passed as a first argument to registered function will be emitted by output Observable.\n * When Observable is unsubscribed, function will be unregistered from event target.\n *\n * Note that if event target calls registered function with more than one argument, second\n * and following arguments will not appear in resulting stream. In order to get access to them,\n * you can pass to `fromEvent` optional project function, which will be called with all arguments\n * passed to event handler. Output Observable will then emit value returned by project function,\n * instead of the usual value.\n *\n * Remember that event targets listed below are checked via duck typing. It means that\n * no matter what kind of object you have and no matter what environment you work in,\n * you can safely use `fromEvent` on that object if it exposes described methods (provided\n * of course they behave as was described above). So for example if Node.js library exposes\n * event target which has the same method names as DOM EventTarget, `fromEvent` is still\n * a good choice.\n *\n * If the API you use is more callback then event handler oriented (subscribed\n * callback function fires only once and thus there is no need to manually\n * unregister it), you should use {@link bindCallback} or {@link bindNodeCallback}\n * instead.\n *\n * `fromEvent` supports following types of event targets:\n *\n * **DOM EventTarget**\n *\n * This is an object with `addEventListener` and `removeEventListener` methods.\n *\n * In the browser, `addEventListener` accepts - apart from event type string and event\n * handler function arguments - optional third parameter, which is either an object or boolean,\n * both used for additional configuration how and when passed function will be called. When\n * `fromEvent` is used with event target of that type, you can provide this values\n * as third parameter as well.\n *\n * **Node.js EventEmitter**\n *\n * An object with `addListener` and `removeListener` methods.\n *\n * **JQuery-style event target**\n *\n * An object with `on` and `off` methods\n *\n * **DOM NodeList**\n *\n * List of DOM Nodes, returned for example by `document.querySelectorAll` or `Node.childNodes`.\n *\n * Although this collection is not event target in itself, `fromEvent` will iterate over all Nodes\n * it contains and install event handler function in every of them. When returned Observable\n * is unsubscribed, function will be removed from all Nodes.\n *\n * **DOM HtmlCollection**\n *\n * Just as in case of NodeList it is a collection of DOM nodes. Here as well event handler function is\n * installed and removed in each of elements.\n *\n *\n * ## Examples\n *\n * Emit clicks happening on the DOM document\n *\n * ```ts\n * import { fromEvent } from 'rxjs';\n *\n * const clicks = fromEvent(document, 'click');\n * clicks.subscribe(x => console.log(x));\n *\n * // Results in:\n * // MouseEvent object logged to console every time a click\n * // occurs on the document.\n * ```\n *\n * Use `addEventListener` with capture option\n *\n * ```ts\n * import { fromEvent } from 'rxjs';\n *\n * const div = document.createElement('div');\n * div.style.cssText = 'width: 200px; height: 200px; background: #09c;';\n * document.body.appendChild(div);\n *\n * // note optional configuration parameter which will be passed to addEventListener\n * const clicksInDocument = fromEvent(document, 'click', { capture: true });\n * const clicksInDiv = fromEvent(div, 'click');\n *\n * clicksInDocument.subscribe(() => console.log('document'));\n * clicksInDiv.subscribe(() => console.log('div'));\n *\n * // By default events bubble UP in DOM tree, so normally\n * // when we would click on div in document\n * // \"div\" would be logged first and then \"document\".\n * // Since we specified optional `capture` option, document\n * // will catch event when it goes DOWN DOM tree, so console\n * // will log \"document\" and then \"div\".\n * ```\n *\n * @see {@link bindCallback}\n * @see {@link bindNodeCallback}\n * @see {@link fromEventPattern}\n *\n * @param {FromEventTarget<T>} target The DOM EventTarget, Node.js\n * EventEmitter, JQuery-like event target, NodeList or HTMLCollection to attach the event handler to.\n * @param {string} eventName The event name of interest, being emitted by the\n * `target`.\n * @param {EventListenerOptions} [options] Options to pass through to addEventListener\n * @return {Observable<T>}\n */\nexport function fromEvent<T>(\n  target: any,\n  eventName: string,\n  options?: EventListenerOptions | ((...args: any[]) => T),\n  resultSelector?: (...args: any[]) => T\n): Observable<T> {\n  if (isFunction(options)) {\n    resultSelector = options;\n    options = undefined;\n  }\n  if (resultSelector) {\n    return fromEvent<T>(target, eventName, options as EventListenerOptions).pipe(mapOneOrManyArgs(resultSelector));\n  }\n\n  // Figure out our add and remove methods. In order to do this,\n  // we are going to analyze the target in a preferred order, if\n  // the target matches a given signature, we take the two \"add\" and \"remove\"\n  // method names and apply them to a map to create opposite versions of the\n  // same function. This is because they all operate in duplicate pairs,\n  // `addListener(name, handler)`, `removeListener(name, handler)`, for example.\n  // The call only differs by method name, as to whether or not you're adding or removing.\n  const [add, remove] =\n    // If it is an EventTarget, we need to use a slightly different method than the other two patterns.\n    isEventTarget(target)\n      ? eventTargetMethods.map((methodName) => (handler: any) => target[methodName](eventName, handler, options as EventListenerOptions))\n      : // In all other cases, the call pattern is identical with the exception of the method names.\n      isNodeStyleEventEmitter(target)\n      ? nodeEventEmitterMethods.map(toCommonHandlerRegistry(target, eventName))\n      : isJQueryStyleEventEmitter(target)\n      ? jqueryMethods.map(toCommonHandlerRegistry(target, eventName))\n      : [];\n\n  // If add is falsy, it's because we didn't match a pattern above.\n  // Check to see if it is an ArrayLike, because if it is, we want to\n  // try to apply fromEvent to all of it's items. We do this check last,\n  // because there are may be some types that are both ArrayLike *and* implement\n  // event registry points, and we'd rather delegate to that when possible.\n  if (!add) {\n    if (isArrayLike(target)) {\n      return mergeMap((subTarget: any) => fromEvent(subTarget, eventName, options as EventListenerOptions))(\n        innerFrom(target)\n      ) as Observable<T>;\n    }\n  }\n\n  // If add is falsy and we made it here, it's because we didn't\n  // match any valid target objects above.\n  if (!add) {\n    throw new TypeError('Invalid event target');\n  }\n\n  return new Observable<T>((subscriber) => {\n    // The handler we are going to register. Forwards the event object, by itself, or\n    // an array of arguments to the event handler, if there is more than one argument,\n    // to the consumer.\n    const handler = (...args: any[]) => subscriber.next(1 < args.length ? args : args[0]);\n    // Do the work of adding the handler to the target.\n    add(handler);\n    // When we finalize, we want to remove the handler and free up memory.\n    return () => remove!(handler);\n  });\n}\n\n/**\n * Used to create `add` and `remove` functions to register and unregister event handlers\n * from a target in the most common handler pattern, where there are only two arguments.\n * (e.g.  `on(name, fn)`, `off(name, fn)`, `addListener(name, fn)`, or `removeListener(name, fn)`)\n * @param target The target we're calling methods on\n * @param eventName The event name for the event we're creating register or unregister functions for\n */\nfunction toCommonHandlerRegistry(target: any, eventName: string) {\n  return (methodName: string) => (handler: any) => target[methodName](eventName, handler);\n}\n\n/**\n * Checks to see if the target implements the required node-style EventEmitter methods\n * for adding and removing event handlers.\n * @param target the object to check\n */\nfunction isNodeStyleEventEmitter(target: any): target is NodeStyleEventEmitter {\n  return isFunction(target.addListener) && isFunction(target.removeListener);\n}\n\n/**\n * Checks to see if the target implements the required jQuery-style EventEmitter methods\n * for adding and removing event handlers.\n * @param target the object to check\n */\nfunction isJQueryStyleEventEmitter(target: any): target is JQueryStyleEventEmitter<any, any> {\n  return isFunction(target.on) && isFunction(target.off);\n}\n\n/**\n * Checks to see if the target implements the required EventTarget methods\n * for adding and removing event handlers.\n * @param target the object to check\n */\nfunction isEventTarget(target: any): target is HasEventTargetAddRemove<any> {\n  return isFunction(target.addEventListener) && isFunction(target.removeEventListener);\n}\n","import { asyncScheduler } from '../scheduler/async';\nimport { Subscription } from '../Subscription';\nimport { MonoTypeOperatorFunction, SchedulerAction, SchedulerLike } from '../types';\nimport { operate } from '../util/lift';\nimport { createOperatorSubscriber } from './OperatorSubscriber';\n\n/**\n * Emits a notification from the source Observable only after a particular time span\n * has passed without another source emission.\n *\n * <span class=\"informal\">It's like {@link delay}, but passes only the most\n * recent notification from each burst of emissions.</span>\n *\n * ![](debounceTime.png)\n *\n * `debounceTime` delays notifications emitted by the source Observable, but drops\n * previous pending delayed emissions if a new notification arrives on the source\n * Observable. This operator keeps track of the most recent notification from the\n * source Observable, and emits that only when `dueTime` has passed\n * without any other notification appearing on the source Observable. If a new value\n * appears before `dueTime` silence occurs, the previous notification will be dropped\n * and will not be emitted and a new `dueTime` is scheduled.\n * If the completing event happens during `dueTime` the last cached notification\n * is emitted before the completion event is forwarded to the output observable.\n * If the error event happens during `dueTime` or after it only the error event is\n * forwarded to the output observable. The cache notification is not emitted in this case.\n *\n * This is a rate-limiting operator, because it is impossible for more than one\n * notification to be emitted in any time window of duration `dueTime`, but it is also\n * a delay-like operator since output emissions do not occur at the same time as\n * they did on the source Observable. Optionally takes a {@link SchedulerLike} for\n * managing timers.\n *\n * ## Example\n *\n * Emit the most recent click after a burst of clicks\n *\n * ```ts\n * import { fromEvent, debounceTime } from 'rxjs';\n *\n * const clicks = fromEvent(document, 'click');\n * const result = clicks.pipe(debounceTime(1000));\n * result.subscribe(x => console.log(x));\n * ```\n *\n * @see {@link audit}\n * @see {@link auditTime}\n * @see {@link debounce}\n * @see {@link sample}\n * @see {@link sampleTime}\n * @see {@link throttle}\n * @see {@link throttleTime}\n *\n * @param {number} dueTime The timeout duration in milliseconds (or the time\n * unit determined internally by the optional `scheduler`) for the window of\n * time required to wait for emission silence before emitting the most recent\n * source value.\n * @param {SchedulerLike} [scheduler=async] The {@link SchedulerLike} to use for\n * managing the timers that handle the timeout for each value.\n * @return A function that returns an Observable that delays the emissions of\n * the source Observable by the specified `dueTime`, and may drop some values\n * if they occur too frequently.\n */\nexport function debounceTime<T>(dueTime: number, scheduler: SchedulerLike = asyncScheduler): MonoTypeOperatorFunction<T> {\n  return operate((source, subscriber) => {\n    let activeTask: Subscription | null = null;\n    let lastValue: T | null = null;\n    let lastTime: number | null = null;\n\n    const emit = () => {\n      if (activeTask) {\n        // We have a value! Free up memory first, then emit the value.\n        activeTask.unsubscribe();\n        activeTask = null;\n        const value = lastValue!;\n        lastValue = null;\n        subscriber.next(value);\n      }\n    };\n    function emitWhenIdle(this: SchedulerAction<unknown>) {\n      // This is called `dueTime` after the first value\n      // but we might have received new values during this window!\n\n      const targetTime = lastTime! + dueTime;\n      const now = scheduler.now();\n      if (now < targetTime) {\n        // On that case, re-schedule to the new target\n        activeTask = this.schedule(undefined, targetTime - now);\n        subscriber.add(activeTask);\n        return;\n      }\n\n      emit();\n    }\n\n    source.subscribe(\n      createOperatorSubscriber(\n        subscriber,\n        (value: T) => {\n          lastValue = value;\n          lastTime = scheduler.now();\n\n          // Only set up a task if it's not already up\n          if (!activeTask) {\n            activeTask = scheduler.schedule(emitWhenIdle, dueTime);\n            subscriber.add(activeTask);\n          }\n        },\n        () => {\n          // Source completed.\n          // Emit any pending debounced values then complete\n          emit();\n          subscriber.complete();\n        },\n        // Pass all errors through to consumer.\n        undefined,\n        () => {\n          // Finalization.\n          lastValue = activeTask = null;\n        }\n      )\n    );\n  });\n}\n","import { Observable, debounceTime, fromEvent } from 'rxjs';\nimport * as Points from '../geometry/Point.js';\nimport JSON5 from 'json5';\nimport { Rects, Scaler } from '../geometry/index.js';\nimport type { CardinalDirection } from '../geometry/Grid.js';\nimport { cardinal } from '../geometry/Rect.js';\n\n// eslint-disable-next-line unicorn/prevent-abbreviations\nexport type ElementResizeArgs<V extends HTMLElement | SVGSVGElement> = {\n  readonly el: V;\n  readonly bounds: {\n    readonly width: number;\n    readonly height: number;\n    readonly center: Points.Point;\n    readonly min: number;\n    readonly max: number;\n  };\n};\n\n// eslint-disable-next-line unicorn/prevent-abbreviations\nexport type CanvasResizeArgs = ElementResizeArgs<HTMLCanvasElement> & {\n  readonly ctx: CanvasRenderingContext2D;\n};\n\nexport type PointSpaces = `viewport` | `screen` | `document`;\n\n/**\n * Convert an absolute point to relative, in different coordinate spaces.\n *\n * When calling the returned function, the input value must be in the same\n * scale as the intended output scale.\n *\n * Viewport-relative is used by default.\n *\n * @example Get relative position of click in screen coordinates\n * ```js\n * const f = pointScaler({ to: 'screen' });\n * document.addEventListener('click', evt => {\n *  const screenRelative = f(evt.screenX, evt.screenY);\n *  // Yields {x,y} on 0..1 scale\n * });\n * ```\n *\n * @example Get relative position of click in viewport coordinates\n * ```js\n * const f = pointScaler({ to: 'viewport' });\n * document.addEventListener('click', evt => {\n *  const viewportRelative = f(evt.clientX, evt.clientY);\n *  // Yields {x,y} on 0..1 scale\n * });\n * ```\n *\n * @example Get relative position of click in document coordinates\n * ```js\n * const f = pointScaler({ to: 'document' });\n * document.addEventListener('click', evt => {\n *  const documentRelative = f(evt.pageX, evt.pageY);\n *  // Yields {x,y} on 0..1 scale\n * });\n * ```\n *\n * @param opts\n * @returns\n */\nexport const pointScaler = (reference: PointSpaces = `viewport`) => {\n  switch (reference) {\n    case `viewport`: {\n      return (a: Readonly<Points.Point | number | Array<number>>, b?: number) => {\n        const pt = Points.getPointParameter(a, b);\n        return Object.freeze({\n          x: pt.x / window.innerWidth,\n          y: pt.y / window.innerHeight,\n        });\n      };\n    }\n    case `screen`: {\n      return (a: Readonly<Points.Point | number | Array<number>>, b?: number) => {\n        const pt = Points.getPointParameter(a, b);\n        return Object.freeze({\n          x: pt.x / screen.width,\n          y: pt.y / screen.height,\n        });\n      };\n    }\n    case `document`: {\n      return (a: Readonly<Points.Point | number | Array<number>>, b?: number) => {\n        const pt = Points.getPointParameter(a, b);\n        return Object.freeze({\n          x: pt.x / document.body.scrollWidth,\n          y: pt.y / document.body.scrollHeight,\n        });\n      };\n    }\n    default: {\n      throw new Error(\n        `Unknown 'reference' parameter: ${ JSON.stringify(reference) }`\n      );\n    }\n  }\n};\n\nexport type ElPositionOpts = {\n  readonly target?: PointSpaces;\n  readonly relative?: boolean;\n  readonly anchor?: CardinalDirection | `center`;\n};\n\n/**\n * Returns a function which yields element position in target coordinate space with optional scaling.\n * Live position is calculated when the function is invoked.\n * Use {@link positionRelative} to simply get relative position of element in given coordinate space.\n *\n * @example Absolute position of #blah in viewport coordinate space\n * ```js\n * const f = positionFn('#blah');\n * f(); // Yields: {x,y}\n * // Or:\n * positionFn('#blah')(); // Immediately invoke\n * ```\n *\n * @example Relative position of element in viewport-space\n * ```js\n * const f = positionFn(evt.target, { relative: true });\n * f(); // Yields: {x,y}\n * ```\n *\n * @example Relative position of #blah in screen-space\n * ```js\n * const f = positionFn('#blah', { target: 'screen', relative: true });\n * f(); // Yields: {x,y}\n * ```\n *\n * By default, top-left corner (north west) is used. Other cardinal points or 'center' can be specified:\n * ```js\n * // Relative position by center\n * positionFn('#blah', { relative: true, anchor: 'center' });\n *\n * // ...by bottom-right corner\n * positionFn('#blah', { relative: true, anchor: 'se' });\n * ```\n *\n * This function is useful if you have a stable DOM element and conversion target.\n * If the DOM element is changing continually, consider using {@link viewportToSpace} to\n * convert from viewport coordinates to target coordinates:\n *\n * ```js\n * // Eg.1 Absolute coords in screen space\n * const vpToScreen = viewportToSpace('screen');\n * vpToScreen(el.getBoundingClientRect());\n *\n * // Eg.2 Relative coords in viewport space\n * const vpRelative = pointScaler(); // Re-usable scaler. Default uses viewport\n * vpRelative(el.getBoundingClientRect()); // Yields: { x,y }\n *\n * // Eg.3 Relative coords in screen space\n * const vpToScreen = viewportToSpace('screen'); // Map viewport->screen\n * const screenRelative = pointScaler('screen'); // Scale screen units\n *\n * // Combine into a resuable function that takes an element\n * const mapAndScale = (el) => screenRelative(vpToScreen(el.getBoundingClientRect()));\n *\n * // Call\n * mapAndScale(document.getElementById('blah')); // Yields: { x,y }\n * ```\n * @param domQueryOrEl\n * @param coordinateSpace\n * @param scaled\n * @returns\n */\n// eslint-disable-next-line unicorn/prevent-abbreviations\nexport const positionFn = (\n  domQueryOrEl: Readonly<string | HTMLElement>,\n  opts: ElPositionOpts = {}\n): (() => Points.Point) => {\n  const targetSpace = opts.target ?? `viewport`;\n  const relative = opts.relative ?? false;\n  const anchor = opts.anchor ?? `nw`;\n\n  const el = resolveEl(domQueryOrEl);\n  const vpToSpace = viewportToSpace(targetSpace);\n\n  if (relative) {\n    const s = pointScaler(targetSpace);\n    return () => s(vpToSpace(cardinal(el.getBoundingClientRect(), anchor)));\n  } else {\n    return () => vpToSpace(cardinal(el.getBoundingClientRect(), anchor));\n  }\n};\n\nexport const cardinalPosition = (\n  domQueryOrEl: Readonly<string | HTMLElement>,\n  anchor: CardinalDirection | `center` = `nw`\n): Points.Point => {\n  const el = resolveEl(domQueryOrEl);\n  return cardinal(el.getBoundingClientRect(), anchor);\n};\n/**\n * Returns relative position of element in target coordinate space, or viewport by default.\n * Relative means that { x:0.5, y: 0.5 } is the middle of the target space. Eg for viewport, that means its the middle of the browser window.\n * ```js\n * // These all yield { x, y }\n * elPositionRelative('#blah');\n * elPositionRelative(evt.target, 'screen');\n * ```\n * @param domQueryOrEl DOM query or element\n * @param target Target coordinate space, or viewport by default\n * @returns Point\n */\nexport const positionRelative = (\n  domQueryOrEl: Readonly<string | HTMLElement>,\n  target: PointSpaces = `viewport`\n): Points.Point => {\n  const f = positionFn(domQueryOrEl, { relative: true, target });\n  return f();\n};\n\n/**\n * Returns a function that converts input viewport coordinate space\n * to an output coordinate space.\n *\n * ```js\n * // f() will convert from viewport to document coordinate space\n * const f = viewportToSpace('document');\n *\n * // {x:100,y:100} is viewport coordinate space\n * f(100,100); // Yields: { x, y } converted to document space\n * ```\n *\n * Or immediately invoke for one-off use:\n * ```js\n * viewportToSpace('document')(100,100); // Yields: { x, y }\n * ```\n * @param targetSpace\n * @returns\n */\nexport const viewportToSpace = (targetSpace: PointSpaces = `viewport`) => {\n  switch (targetSpace) {\n    case `screen`: {\n      return (a: Readonly<Points.Point | Array<number> | number>, b?: number) => {\n        const pt = Points.getPointParameter(a, b);\n        return Object.freeze({\n          x: pt.x + window.screenX,\n          y: pt.y + window.screenY,\n        });\n      };\n    }\n    case `document`: {\n      return (a: Readonly<Points.Point | Array<number> | number>, b?: number) => {\n        const pt = Points.getPointParameter(a, b);\n        return Object.freeze({\n          x: pt.x + window.scrollX,\n          y: pt.y + window.scrollY,\n        });\n      };\n    }\n    case `viewport`: {\n      return (a: Readonly<Points.Point | Array<number> | number>, b?: number) => {\n        const pt = Points.getPointParameter(a, b);\n        return Object.freeze({\n          x: pt.x,\n          y: pt.y,\n        });\n      };\n    }\n    default: {\n      throw new Error(\n        // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n        `Unexpected target coordinate space: ${ targetSpace }. Expected: viewport, document or screen`\n      );\n    }\n  }\n};\n\n/**\n * Position element by relative coordinate. Relative to window dimensions by default\n * @param element DOM element to position, or query\n * @param relativePos Window-relative coordinate. 0.5/0.5 is middle of window.\n */\nexport const positionFromMiddle = (\n  domQueryOrEl: string | HTMLElement,\n  relativePos: Points.Point,\n  relativeTo: `window` | `screen` = `window`\n) => {\n  if (!domQueryOrEl) throw new Error(`domQueryOrEl is null or undefined`);\n  const el = resolveEl<HTMLElement>(domQueryOrEl);\n\n  // Convert relative to absolute units\n  const absPosition = Points.multiply(\n    relativePos,\n    window.innerWidth,\n    window.innerHeight\n  );\n\n  const thingRect = el.getBoundingClientRect();\n  const offsetPos = Points.subtract(\n    absPosition,\n    thingRect.width / 2,\n    thingRect.height / 2\n  );\n\n  // Apply via CSS\n  el.style.transform = `translate(${ offsetPos.x }px, ${ offsetPos.y }px)`;\n};\n\nexport const fullSizeElement = <V extends HTMLElement>(\n  domQueryOrEl: string | V,\n  onResized?: (args: ElementResizeArgs<V>) => void\n) => {\n  const el = resolveEl<V>(domQueryOrEl);\n\n  const r = windowResize();\n  const update = () => {\n    const width = window.innerWidth;\n    const height = window.innerHeight;\n\n    el.setAttribute(`width`, width.toString());\n    el.setAttribute(`height`, height.toString());\n\n    if (onResized !== undefined) {\n      const bounds = {\n        min: Math.min(width, height),\n        max: Math.max(width, height),\n        width,\n        height,\n        center: {\n          x: width / 2,\n          y: height / 2,\n        },\n      };\n      onResized({ el, bounds });\n    }\n  };\n  r.subscribe(update);\n\n  update();\n  return r;\n};\n\nexport type CanvasOpts = {\n  readonly skipCss?: boolean;\n  readonly fullSize?: boolean;\n  readonly scaleBy?: `both` | `width` | `height` | `min` | `max`;\n};\n\nexport const canvasHelper = (\n  domQueryOrEl: Readonly<string | HTMLCanvasElement | undefined | null>,\n  opts: CanvasOpts\n) => {\n  if (!domQueryOrEl) throw new Error(`domQueryOrEl is null or undefined`);\n  const el = resolveEl<HTMLCanvasElement>(domQueryOrEl);\n  if (el.nodeName !== `CANVAS`) {\n    throw new Error(`Expected CANVAS HTML element. Got: ${ el.nodeName }`);\n  }\n  const fullSize = opts.fullSize ?? true;\n  const ratio = Math.round(window.devicePixelRatio) || 1;\n  const scaleBy = opts.scaleBy ?? `both`;\n\n  let scaler: Scaler.Scaler = Scaler.scaler(`both`);\n\n  const updateDimensions = (rect: Rects.Rect) => {\n    // Create a new scaler\n    scaler = Scaler.scaler(scaleBy, rect);\n\n    const pixelScaled = Rects.multiply(rect, ratio, ratio);\n\n    el.width = pixelScaled.width;\n    el.height = pixelScaled.height;\n    el.style.width = rect.width + `px`;\n    el.style.height = rect.height + `px`;\n  };\n\n  // Window has resized\n  const onWindowResize = () => {\n    const innerWindow = {\n      width: window.innerWidth,\n      height: window.innerHeight,\n    };\n    updateDimensions(innerWindow);\n  };\n\n  const getContext = () => {\n    const ctx = el.getContext(`2d`);\n    if (ctx === null) throw new Error(`Could not create drawing context`);\n\n    ctx.scale(ratio, ratio);\n  };\n\n  if (fullSize) {\n    const r = windowResize();\n    r.subscribe(onWindowResize);\n  }\n\n  return {\n    abs: scaler.abs,\n    rel: scaler.rel,\n    getContext,\n  };\n};\n\n/**\n * Resizes given canvas element to match window size.\n * To resize canvas to match its parent, use {@link parentSizeCanvas}.\n *\n * To make the canvas appear propery, it sets the following CSS:\n * ```css\n * {\n *  top: 0;\n *  left: 0;\n *  zIndex: -1;\n *  position: fixed;\n * }\n * ```\n * Pass _true_ for `skipCss` to avoid this.\n *\n * Provide a callback for when resize happens.\n * @param domQueryOrEl Query string or reference to canvas element\n * @param onResized Callback for when resize happens, eg for redrawing canvas\n * @param skipCss if true, style are not added\n * @returns Observable\n */\nexport const fullSizeCanvas = (\n  domQueryOrEl: Readonly<string | HTMLCanvasElement | undefined | null>,\n  onResized?: (args: CanvasResizeArgs) => void,\n  skipCss = false\n) => {\n  if (domQueryOrEl === null || domQueryOrEl === undefined) {\n    throw new Error(`domQueryOrEl is null or undefined`);\n  }\n  const el = resolveEl<HTMLCanvasElement>(domQueryOrEl);\n  if (el.nodeName !== `CANVAS`) {\n    throw new Error(\n      `Expected HTML element with node name CANVAS, not ${ el.nodeName }`\n    );\n  }\n  const ctx = el.getContext(`2d`);\n  if (ctx === null) throw new Error(`Could not create drawing context`);\n\n  const update = () => {\n    const width = window.innerWidth;\n    const height = window.innerHeight;\n\n    el.width = width;\n    el.height = height;\n\n    if (onResized !== undefined) {\n      const bounds = {\n        min: Math.min(width, height),\n        max: Math.max(width, height),\n        width,\n        height,\n        center: { x: width / 2, y: height / 2 },\n      };\n      onResized({ ctx, el, bounds });\n    }\n  };\n\n  // Setup\n  if (!skipCss) {\n    el.style.top = `0`;\n    el.style.left = `0`;\n    el.style.zIndex = `-100`;\n    el.style.position = `fixed`;\n  }\n\n  const r = windowResize();\n  r.subscribe(update);\n\n  update();\n  return r;\n};\n\n/**\n * Given an array of class class names, this will cycle between them each time\n * it is called.\n *\n * Eg, assume `list` is: [ `a`, `b`, `c` ]\n *\n * If `el` already has the class `a`, the first time it is called, class `a`\n * is removed, and `b` added. The next time `b` is swapped for `c`. Once again,\n * `c` will swap with `a` and so on.\n *\n * If `el` is undefined or null, function silently returns.\n * @param el Element\n * @param list List of class names\n * @returns\n */\nexport const cycleCssClass = (\n  el: Readonly<HTMLElement>,\n  list: ReadonlyArray<string>\n) => {\n  if (el === null || !el) return;\n  if (!Array.isArray(list)) {\n    throw new TypeError(`List should be an array of strings`);\n  }\n\n  for (let index = 0; index < list.length; index++) {\n    if (el.classList.contains(list[ index ])) {\n      el.classList.remove(list[ index ]);\n      if (index + 1 < list.length) {\n        el.classList.add(list[ index + 1 ]);\n      } else {\n        el.classList.add(list[ 0 ]);\n      }\n      return;\n    }\n  }\n  el.classList.add(list[ 0 ]);\n};\n\n/**\n * Sets width/height atributes on the given element according to the size of its parent.\n * @param domQueryOrEl Elememnt to resize\n * @param onResized Callback when resize happens\n * @param timeoutMs Timeout for debouncing events\n * @returns\n */\nexport const parentSize = <V extends HTMLElement | SVGSVGElement>(\n  domQueryOrEl: string | V,\n  onResized?: (args: ElementResizeArgs<V>) => void,\n  timeoutMs = 100\n) => {\n  const el = resolveEl<V>(domQueryOrEl);\n  const parent = el.parentElement;\n  if (parent === null) throw new Error(`Element has no parent`);\n\n  const ro = resizeObservable(parent, timeoutMs).subscribe(\n    (entries: ReadonlyArray<ResizeObserverEntry>) => {\n      const entry = entries.find((v) => v.target === parent);\n      if (entry === undefined) return;\n\n      const width = entry.contentRect.width;\n      const height = entry.contentRect.height;\n\n      el.setAttribute(`width`, width + `px`);\n      el.setAttribute(`height`, height + `px`);\n      if (onResized !== undefined) {\n        const bounds = {\n          min: Math.min(width, height),\n          max: Math.max(width, height),\n          width,\n          height,\n          center: { x: width / 2, y: height / 2 },\n        };\n        onResized({ el, bounds });\n      }\n    }\n  );\n\n  return ro;\n};\n\n/**\n * Source: https://zellwk.com/blog/translate-in-javascript\n * @param domQueryOrEl\n */\nexport const getTranslation = (\n  domQueryOrEl: Readonly<string | HTMLElement>\n): Points.Point => {\n  // Source:\n  // https://raw.githubusercontent.com/zellwk/javascript/master/src/browser/dom/translate-values.js\n\n  const el = resolveEl<HTMLElement>(domQueryOrEl);\n  const style = window.getComputedStyle(el);\n  const matrix = style.transform;\n\n  // No transform property. Simply return 0 values.\n  if (matrix === `none` || typeof matrix === `undefined`) {\n    return {\n      x: 0,\n      y: 0,\n      z: 0,\n    };\n  }\n\n  // Can either be 2d or 3d transform\n  const matrixType = matrix.includes(`3d`) ? `3d` : `2d`;\n  // @ts-expect-error\n  const matrixValues = matrix.match(/matrix.*\\((.+)\\)/)[ 1 ].split(`, `);\n\n  // 2d Matrixes have 6 values\n  // Last 2 values are X and Y.\n  // 2d Matrixes does not have Z value.\n  if (matrixType === `2d`) {\n    return {\n      x: Number.parseFloat(matrixValues[ 4 ]),\n      y: Number.parseFloat(matrixValues[ 5 ]),\n      z: 0,\n    };\n  }\n\n  // 3d Matrixes have 16 values\n  // The 13th, 14th, and 15th values are X, Y, and Z\n  if (matrixType === `3d`) {\n    return {\n      x: Number.parseFloat(matrixValues[ 12 ]),\n      y: Number.parseFloat(matrixValues[ 13 ]),\n      z: Number.parseFloat(matrixValues[ 14 ]),\n    };\n  }\n\n  return { x: 0, y: 0, z: 0 };\n};\n\n/**\n * Resizes given canvas to its parent element.\n * To resize canvas to match the viewport, use {@link fullSizeCanvas}.\n *\n * Provide a callback for when resize happens.\n * @param domQueryOrEl Query string or reference to canvas element\n * @param onResized Callback for when resize happens, eg for redrawing canvas\n * @returns Observable\n */\nexport const parentSizeCanvas = (\n  domQueryOrEl: Readonly<string | HTMLCanvasElement>,\n  onResized?: (args: CanvasResizeArgs) => void,\n  timeoutMs = 100\n) => {\n  const el = resolveEl<HTMLCanvasElement>(domQueryOrEl);\n  if (el.nodeName !== `CANVAS`) {\n    throw new Error(\n      `Expected HTML element with node name CANVAS, not ${ el.nodeName }`\n    );\n  }\n  const parent = el.parentElement;\n  if (parent === null) throw new Error(`Element has no parent`);\n\n  const ctx = (el).getContext(`2d`);\n  if (ctx === null) throw new Error(`Could not create drawing context`);\n\n  //const safetyMargin = 4;\n\n  el.style.width = `100%`;\n  el.style.height = `100%`;\n\n\n  const ro = resizeObservable(parent, timeoutMs).subscribe(\n    (entries: ReadonlyArray<ResizeObserverEntry>) => {\n      const entry = entries.find((v) => v.target === parent);\n      if (entry === undefined) return;\n\n      const width = entry.contentRect.width;\n      const height = entry.contentRect.height;\n      //console.log(`contentH: ${e.contentRect.height} current: ${el.getBoundingClientRect().height}`);\n\n      // el.setAttribute(`width`, width-safetyMargin + `px`);\n      // el.setAttribute(`height`, height-safetyMargin + `px`);\n      el.setAttribute(`width`, el.offsetWidth + `px`);\n      el.setAttribute(`height`, el.offsetHeight + `px`);\n\n      if (onResized !== undefined) {\n        const bounds = {\n          min: Math.min(width, height),\n          max: Math.max(width, height),\n          width,\n          height,\n          center: { x: width / 2, y: height / 2 },\n        };\n        onResized({ ctx, el, bounds });\n      }\n    }\n  );\n\n  return ro;\n};\n\n/**\n * Returns an Observable for window resize. Default 100ms debounce.\n * @param timeoutMs\n * @returns\n */\nexport const windowResize = (timeoutMs = 100) =>\n  fromEvent(window, `resize`).pipe(debounceTime(timeoutMs));\n\n/**\n * Resolves either a string or HTML element to an element.\n * Useful when an argument is either an HTML element or query.\n *\n * ```js\n * resolveEl(`#someId`);\n * resolveEl(someElement);\n * ```\n * @param domQueryOrEl\n * @returns\n */\nexport const resolveEl = <V extends Element>(domQueryOrEl: string | V | null | undefined): V => {\n  if (typeof domQueryOrEl === `string`) {\n    const d = document.querySelector(domQueryOrEl);\n    if (d === null) {\n      const error = domQueryOrEl.startsWith(`#`) ? new Error(\n        `Query '${ domQueryOrEl }' did not match anything. Try '#id', 'div', or '.class'`\n      ) : new Error(\n        `Query '${ domQueryOrEl }' did not match anything. Did you mean '#${ domQueryOrEl }?`\n      );\n      throw error;\n    }\n    domQueryOrEl = d as V;\n  } else if (domQueryOrEl === null) {\n    throw new Error(`domQueryOrEl ${ domQueryOrEl } is null`);\n  } else if (domQueryOrEl === undefined) {\n    throw new Error(`domQueryOrEl ${ domQueryOrEl } is undefined`);\n  }\n  const el = domQueryOrEl;\n  return el;\n};\n\n/**\n * Creates an element after `sibling`\n * ```\n * const el = createAfter(siblingEl, `DIV`);\n * ```\n * @param sibling Element\n * @param tagName Element to create\n * @returns New element\n */\nexport const createAfter = (\n  sibling: Readonly<HTMLElement>,\n  tagName: string\n): HTMLElement => {\n  const el = document.createElement(tagName);\n  sibling.parentElement?.insertBefore(el, sibling.nextSibling);\n  return el;\n};\n\n/**\n * Creates an element inside of `parent`\n * ```\n * const newEl = createIn(parentEl, `DIV`);\n * ```\n * @param parent Parent element\n * @param tagName Tag to create\n * @returns New element\n */\nexport const createIn = (\n  parent: Readonly<HTMLElement>,\n  tagName: string\n): HTMLElement => {\n  const el = document.createElement(tagName);\n  parent.append(el);\n  return el;\n};\n\n/**\n * Remove all child nodes from `parent`\n * @param parent\n */\nexport const clear = (parent: Readonly<HTMLElement>) => {\n  let c = parent.lastElementChild;\n\n  while (c) {\n    c.remove();\n    c = parent.lastElementChild;\n  }\n};\n\n/**\n * Observer when document's class changes\n *\n * ```js\n * const c = themeChangeObservable();\n * c.subscribe(() => {\n *  // Class has changed...\n * });\n * ```\n * @returns\n */\nexport const themeChangeObservable = (): Observable<\n  ReadonlyArray<MutationRecord>\n> => {\n  const o = new Observable<Array<MutationRecord>>((subscriber) => {\n    const ro = new MutationObserver((entries) => {\n      subscriber.next(entries);\n    });\n\n    const opts: MutationObserverInit = {\n      attributeFilter: [ `class` ],\n      attributes: true,\n    };\n\n    ro.observe(document.documentElement, opts);\n    return function unsubscribe() {\n      ro.disconnect();\n    };\n  });\n  return o;\n};\n\n/**\n * Observer when element resizes. Specify `timeoutMs` to debounce.\n *\n * ```\n * const o = resizeObservable(myEl, 500);\n * o.subscribe(() => {\n *  // called 500ms after last resize\n * });\n * ```\n * @param elem\n * @param timeoutMs Tiemout before event gets triggered\n * @returns\n */\nexport const resizeObservable = (\n  elem: Readonly<Element>,\n  timeoutMs = 1000\n): Observable<ReadonlyArray<ResizeObserverEntry>> => {\n  if (elem === null) {\n    throw new Error(`elem parameter is null. Expected element to observe`);\n  }\n  if (elem === undefined) {\n    throw new Error(`elem parameter is undefined. Expected element to observe`);\n  }\n  const o = new Observable<Array<ResizeObserverEntry>>((subscriber) => {\n    const ro = new ResizeObserver((entries) => {\n      subscriber.next(entries);\n    });\n\n    ro.observe(elem);\n    return function unsubscribe() {\n      ro.unobserve(elem);\n    };\n  });\n  return o.pipe(debounceTime(timeoutMs));\n};\n\n/**\n * Copies string representation of object to clipboard\n * @param obj\n * @returns Promise\n */\nexport const copyToClipboard = (object: object) => {\n  const p = new Promise((resolve, reject) => {\n    //const json = JSON.stringify(obj, null, 2);\n    const string_ = JSON5.stringify(object);\n    navigator.clipboard.writeText(JSON.stringify(string_)).then(\n      () => {\n        resolve(true);\n      },\n      (error) => {\n        console.warn(`Could not copy to clipboard`);\n        console.log(string_);\n        reject(error);\n      }\n    );\n  });\n  return p;\n};\n\nexport type CreateUpdateElement<V> = (\n  item: V,\n  //eslint-disable-next-line functional/prefer-readonly-type\n  el: HTMLElement | null\n) => HTMLElement;\n\nexport const reconcileChildren = <V>(\n  parentEl: HTMLElement,\n  //eslint-disable-next-line functional/prefer-readonly-type\n  list: Map<string, V>,\n  createUpdate: CreateUpdateElement<V>\n) => {\n  if (parentEl === null) throw new Error(`parentEl is null`);\n  if (parentEl === undefined) throw new Error(`parentEl is undefined`);\n\n  const seen = new Set<string>();\n\n  for (const [ key, value ] of list) {\n    const id = `c-${ key }`;\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const el = parentEl.querySelector(`#${ id }`);\n    const finalEl = createUpdate(value, el as HTMLElement);\n    if (el !== finalEl) {\n      finalEl.id = id;\n      parentEl.append(finalEl);\n    }\n    seen.add(id);\n  }\n\n  const prune: Array<HTMLElement> = [];\n  for (const child of parentEl.children) {\n    if (!seen.has(child.id)) {\n      prune.push(child as HTMLElement);\n    }\n  }\n\n  // for (let index = 0; index < parentEl.children.length; index++) {\n  //   const c = parentEl.children[ index ] as HTMLElement;\n  //   if (!seen.has(c.id)) {\n  //     prune.push(c);\n  //   }\n  // }\n\n  for (const p of prune) p.remove();\n};\n\n/**\n * Adds `cssClass` to element(s) if `value` is true.\n * ```js\n * setClass(`#someId`, true, `activated`);\n * ```\n * @param query \n * @param value \n * @param cssClass \n * @returns \n */\nexport const setCssClass = (selectors: QueryOrElements, value: boolean, cssClass: string) => {\n  const elements = resolveEls(selectors);\n  if (elements.length === 0) return;\n\n  for (const element of elements) {\n    if (value) element.classList.add(cssClass);\n    else element.classList.remove(cssClass);\n  }\n};\n\n/**\n * Toggles a CSS class on all elements that match selector\n * @param selectors \n * @param cssClass \n * @returns \n */\nexport const setCssToggle = (selectors: QueryOrElements, cssClass: string) => {\n  const elements = resolveEls(selectors);\n  if (elements.length === 0) return;\n  for (const element of elements) {\n    element.classList.toggle(cssClass);\n  }\n}\n\nexport const setCssDisplay = (selectors: QueryOrElements, value: string) => {\n  const elements = resolveEls(selectors);\n  if (elements.length === 0) return;\n  for (const element of elements) {\n    (element).style.display = value;\n  }\n};\n\n/**\n * Gets a HTML element by id, throwing an error if not found\n * @param id \n * @returns \n */\nexport const byId = <V extends HTMLElement>(id: string): HTMLElement => {\n  // eslint-disable-next-line unicorn/prefer-query-selector\n  const element = document.getElementById(id);\n  if (element === null) throw new Error(`HTML element with id '${ id }' not found`);\n  return element as V;\n}\n\nexport type QueryOrElements = string | Array<Element> | Array<HTMLElement> | HTMLElement | Element\n\nexport const resolveEls = (selectors: QueryOrElements): Array<HTMLElement> => {\n  if (selectors === undefined) return [];\n  if (selectors === null) return [];\n  if (Array.isArray(selectors)) return selectors as Array<HTMLElement>;\n  if (typeof selectors === `string`) {\n    const elements = [ ...document.querySelectorAll(selectors) ]\n    return elements as Array<HTMLElement>\n  }\n  return [ selectors as HTMLElement ];\n}\n\nexport const setHtml = (selectors: QueryOrElements, value: string | number) => {\n  const elements = resolveEls(selectors);\n  if (elements.length === 0) return;\n  if (typeof value === `number`) {\n    value = value.toString();\n  }\n  for (const element of elements) {\n    element.innerHTML = value;\n  }\n};\n\nexport const setText = (selectors: QueryOrElements, value: string | number) => {\n  const elements = resolveEls(selectors);\n  if (elements.length === 0) return;\n  if (typeof value === `number`) {\n    value = value.toString();\n  }\n  for (const element of elements) {\n    element.textContent = value;\n  }\n};\n\nexport const elRequery = (selectors: string) => {\n  ({\n    text: (value: string | number) => { setText(selectors, value); },\n    html: (value: string | number) => { setHtml(selectors, value); },\n    cssDisplay: (value: string) => { setCssDisplay(selectors, value); },\n    cssClass: (value: boolean, cssClass: string) => { setCssClass(selectors, value, cssClass); },\n    cssToggle: (cssClass: string) => { setCssToggle(selectors, cssClass); },\n    el: () => resolveEl(selectors),\n    els: () => resolveEls(selectors)\n  });\n}\n\nexport const el = (selectors: QueryOrElements) => {\n  const elements = resolveEls(selectors);\n  return {\n    text: (value: string | number) => { setText(elements, value); },\n    html: (value: string | number) => { setHtml(elements, value); },\n    cssDisplay: (value: string) => { setCssDisplay(elements, value); },\n    cssClass: (value: boolean, cssClass: string) => { setCssClass(elements, value, cssClass); },\n    cssToggle: (cssClass: string) => { setCssToggle(elements, cssClass); },\n    el: () => elements[ 0 ],\n    els: () => elements\n  }\n}","import { type CirclePositioned } from '../geometry/Circle.js';\nimport { markerPrebuilt } from './SvgMarkers.js';\nimport * as Lines from '../geometry/Line.js';\nimport * as Points from '../geometry/Point.js';\nimport * as Elements from './SvgElements.js';\nimport * as Rects from '../geometry/Rect.js';\n\nexport { Elements };\n\nexport type MarkerOpts = StrokeOpts &\n  DrawingOpts & {\n    readonly id: string;\n    readonly markerWidth?: number;\n    readonly markerHeight?: number;\n    readonly orient?: string;\n    readonly viewBox?: string;\n    readonly refX?: number;\n    readonly refY?: number;\n  };\n\n/**\n * Drawing options\n */\nexport type DrawingOpts = {\n  /**\n   * Style for fill. Eg `black`.\n   * @see [fill](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/fill)\n   */\n  readonly fillStyle?: string;\n\n  /**\n   * Opacity (0..1)\n   */\n  readonly opacity?: number;\n  /**\n   * If true, debug helpers are drawn\n   */\n  readonly debug?: boolean;\n};\n\nexport type StrokeOpts = {\n  /**\n   * Line cap\n   * @see [stroke-linecap](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-linecap)\n   */\n  readonly strokeLineCap?: `butt` | `round` | `square`;\n  /**\n   * Width of stroke, eg `2`\n   * @see [stroke-width](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-width)\n   */\n  readonly strokeWidth?: number;\n  /**\n   * Stroke dash pattern, eg `5`\n   * @see [stroke-dasharray](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-dasharray)\n   */\n  readonly strokeDash?: string;\n  /**\n   * Style for lines. Eg `white`.\n   * @see [stroke](https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke)\n   */\n  readonly strokeStyle?: string;\n};\n\n/**\n * Line drawing options\n */\nexport type LineDrawingOpts = DrawingOpts & MarkerDrawingOpts & StrokeOpts;\n\nexport type CircleDrawingOpts = DrawingOpts & StrokeOpts & MarkerDrawingOpts;\n\nexport type PathDrawingOpts = DrawingOpts & StrokeOpts & MarkerDrawingOpts;\n\nexport type MarkerDrawingOpts = {\n  readonly markerEnd?: MarkerOpts;\n  readonly markerStart?: MarkerOpts;\n  readonly markerMid?: MarkerOpts;\n};\n\n/**\n * Text drawing options\n */\nexport type TextDrawingOpts = StrokeOpts &\n  DrawingOpts & {\n    readonly anchor?: `start` | `middle` | `end`;\n    readonly align?:\n      | `text-bottom`\n      | `text-top`\n      | `baseline`\n      | `top`\n      | `hanging`\n      | `middle`;\n    readonly userSelect?: boolean;\n  };\n\n/**\n * Text path drawing options\n */\nexport type TextPathDrawingOpts = TextDrawingOpts & {\n  readonly method?: `align` | `stretch`;\n  readonly side?: `left` | `right`;\n  readonly spacing?: `auto` | `exact`;\n  readonly startOffset?: number;\n  readonly textLength?: number;\n};\n\n/**\n * Creates and appends a SVG element.\n *\n * ```js\n * // Create a circle\n * const circleEl = createOrResolve(parentEl, `SVGCircleElement`);\n * ```\n *\n * If `queryOrExisting` is specified, it is used as a query to find an existing element. If\n * query starts with `#`, this will be set as the element id, if created.\n *\n * ```js\n * // Creates an element with id 'myCircle' if it doesn't exist\n * const circleEl = createOrResolve(parentEl, `SVGCircleElement`, `#myCircle`);\n * ```\n * @param parent Parent element\n * @param type Type of SVG element\n * @param queryOrExisting Query, eg `#id`\n * @returns\n */\nexport const createOrResolve = <V extends SVGElement>(\n  parent: SVGElement,\n  type: string,\n  queryOrExisting?: string | V\n): V => {\n  //eslint-disable-next-line functional/no-let\n  let existing = null;\n  if (queryOrExisting !== undefined) {\n    if (typeof queryOrExisting === `string`) {\n      existing = parent.querySelector(queryOrExisting);\n    } else existing = queryOrExisting;\n  }\n  if (existing === null) {\n    const p = document.createElementNS(`http://www.w3.org/2000/svg`, type) as V;\n    parent.appendChild(p);\n    if (queryOrExisting && typeof queryOrExisting === `string`) {\n      //eslint-disable-next-line functional/immutable-data\n      if (queryOrExisting.startsWith(`#`)) p.id = queryOrExisting.substring(1);\n    }\n    return p;\n  }\n  return existing as V;\n};\n\nexport const remove = <V extends SVGElement>(\n  parent: SVGElement,\n  queryOrExisting: string | V\n) => {\n  if (typeof queryOrExisting === `string`) {\n    const e = parent.querySelector(queryOrExisting);\n    if (e === null) return;\n    e.remove();\n  } else {\n    queryOrExisting.remove();\n  }\n};\n\nexport const clear = (parent: SVGElement) => {\n  //eslint-disable-next-line functional/no-let\n  let c = parent.lastElementChild;\n  while (c) {\n    parent.removeChild(c);\n    c = parent.lastElementChild;\n  }\n};\n\n/**\n * Creates an element of `type` and with `id` (if specified)\n * @param type Element type, eg `circle`\n * @param id Optional id to assign to element\n * @returns Element\n */\nexport const createEl = <V extends SVGElement>(\n  type: string,\n  id?: string\n): V => {\n  const m = document.createElementNS(`http://www.w3.org/2000/svg`, type) as V;\n  if (id) {\n    //eslint-disable-next-line functional/immutable-data\n    m.id = id;\n  }\n  return m;\n};\n\n/**\n * Applies path drawing options to given element\n * Applies: markerEnd, markerStart, markerMid\n * @param elem Element (presumed path)\n * @param opts Options\n */\nexport const applyPathOpts = (elem: SVGElement, opts: PathDrawingOpts) => {\n  if (opts.markerEnd) {\n    elem.setAttribute(\n      `marker-end`,\n      markerPrebuilt(elem, opts.markerEnd, opts as DrawingOpts)\n    );\n  }\n  if (opts.markerStart) {\n    elem.setAttribute(\n      `marker-start`,\n      markerPrebuilt(elem, opts.markerStart, opts as DrawingOpts)\n    );\n  }\n  if (opts.markerMid) {\n    elem.setAttribute(\n      `marker-mid`,\n      markerPrebuilt(elem, opts.markerMid, opts as DrawingOpts)\n    );\n  }\n};\n\n/**\n * Applies drawing options to given SVG element.\n * Applies: fillStyle\n * @param elem Element\n * @param opts Drawing options\n */\nexport const applyOpts = (elem: SVGElement, opts: DrawingOpts) => {\n  if (opts.fillStyle) elem.setAttributeNS(null, `fill`, opts.fillStyle);\n  if (opts.opacity) {\n    elem.setAttributeNS(null, `opacity`, opts.opacity.toString());\n  }\n};\n\n/**\n * Applies drawing options to given SVG element.\n * Applies: strokeStyle, strokeWidth, strokeDash, strokeLineCap\n * @param elem Element\n * @param opts\n */\nexport const applyStrokeOpts = (elem: SVGElement, opts: StrokeOpts) => {\n  if (opts.strokeStyle) elem.setAttributeNS(null, `stroke`, opts.strokeStyle);\n  if (opts.strokeWidth) {\n    elem.setAttributeNS(null, `stroke-width`, opts.strokeWidth.toString());\n  }\n  if (opts.strokeDash) elem.setAttribute(`stroke-dasharray`, opts.strokeDash);\n  if (opts.strokeLineCap) {\n    elem.setAttribute(`stroke-linecap`, opts.strokeLineCap);\n  }\n};\n\n/**\n * Helper to make SVG elements with a common parent.\n *\n * Create with {@link makeHelper}.\n */\nexport type SvgHelper = {\n  remove(queryOrExisting: string | SVGElement): void;\n  /**\n   * Creates a text element\n   * @param text Text\n   * @param pos Position\n   * @param opts Drawing options\n   * @param queryOrExisting DOM query to look up existing element, or the element instance\n   */\n  text(\n    text: string,\n    pos: Points.Point,\n    opts?: TextDrawingOpts,\n    queryOrExisting?: string | SVGTextElement\n  ): SVGTextElement;\n  /**\n   * Creates text on a path\n   * @param pathRef Reference to path element\n   * @param text Text\n   * @param opts Drawing options\n   * @param queryOrExisting DOM query to look up existing element, or the element instance\n   */\n  textPath(\n    pathRef: string,\n    text: string,\n    opts?: TextDrawingOpts,\n    queryOrExisting?: string | SVGTextPathElement\n  ): SVGTextPathElement;\n  /**\n   * Creates a line\n   * @param line Line\n   * @param opts Drawing options\n   * @param queryOrExisting DOM query to look up existing element, or the element instance\n   */\n  line(\n    line: Lines.Line,\n    opts?: LineDrawingOpts,\n    queryOrExisting?: string | SVGLineElement\n  ): SVGLineElement;\n  /**\n   * Creates a circle\n   * @param circle Circle\n   * @param opts Drawing options\n   * @param queryOrExisting DOM query to look up existing element, or the element instance\n   */\n  circle(\n    circle: CirclePositioned,\n    opts?: CircleDrawingOpts,\n    queryOrExisting?: string | SVGCircleElement\n  ): SVGCircleElement;\n  /**\n   * Creates a path\n   * @param svgStr Path description, or empty string\n   * @param opts Drawing options\n   * @param queryOrExisting DOM query to look up existing element, or the element instance\n   */\n  path(\n    svgStr: string | readonly string[],\n    opts?: PathDrawingOpts,\n    queryOrExisting?: string | SVGPathElement\n  ): SVGPathElement;\n  /**\n   * Creates a grid of horizontal and vertical lines inside of a group\n   * @param center Grid origin\n   * @param spacing Cell size\n   * @param width Width of grid\n   * @param height Height of grid\n   * @param opts Drawing options\n   */\n  grid(\n    center: Points.Point,\n    spacing: number,\n    width: number,\n    height: number,\n    opts?: LineDrawingOpts\n  ): SVGGElement;\n  /**\n   * Returns an element if it exists in parent\n   * @param selectors Eg `#path`\n   */\n  query<V extends SVGElement>(selectors: string): V | null;\n  /**\n   * Gets/sets the width of the parent\n   */\n  get width(): number;\n  set width(width: number);\n  /**\n   * Gets the parent\n   */\n  get parent(): SVGElement;\n  /**\n   * Gets/sets the height of the parent\n   */\n  get height(): number;\n  set height(height: number);\n  /**\n   * Deletes all child elements\n   */\n  clear(): void;\n};\n\n/**\n * Get the bounds of an SVG element (determined by its width/height attribs)\n * @param svg\n * @returns\n */\nexport const getBounds = (svg: SVGElement): Rects.Rect => {\n  const w = svg.getAttributeNS(null, `width`);\n  const width = w === null ? 0 : parseFloat(w);\n  const h = svg.getAttributeNS(null, `height`);\n  const height = h === null ? 0 : parseFloat(h);\n  return { width, height };\n};\n\n/**\n * Set the bounds of an element, using its width/height attribs.\n * @param svg\n * @param bounds\n */\nexport const setBounds = (svg: SVGElement, bounds: Rects.Rect): void => {\n  svg.setAttributeNS(null, `width`, bounds.width.toString());\n  svg.setAttributeNS(null, `height`, bounds.height.toString());\n};\n\n/**\n * Creates a {@link SvgHelper} for the creating and management of SVG elements.\n * @param parent\n * @param parentOpts\n * @returns\n */\nexport const makeHelper = (\n  parent: SVGElement,\n  parentOpts?: DrawingOpts & StrokeOpts\n): SvgHelper => {\n  if (parentOpts) {\n    applyOpts(parent, parentOpts);\n    applyStrokeOpts(parent, parentOpts);\n  }\n\n  const o: SvgHelper = {\n    remove: (queryOrExisting: string | SVGElement) =>\n      remove(parent, queryOrExisting),\n    text: (\n      text: string,\n      pos: Points.Point,\n      opts?: TextDrawingOpts,\n      queryOrExisting?: string | SVGTextElement\n    ) => Elements.text(text, parent, pos, opts, queryOrExisting),\n    textPath: (\n      pathRef: string,\n      text: string,\n      opts?: TextDrawingOpts,\n      queryOrExisting?: string | SVGTextPathElement\n    ) => Elements.textPath(pathRef, text, parent, opts, queryOrExisting),\n    line: (\n      line: Lines.Line,\n      opts?: LineDrawingOpts,\n      queryOrExisting?: string | SVGLineElement\n    ) => Elements.line(line, parent, opts, queryOrExisting),\n    circle: (\n      circle: CirclePositioned,\n      opts?: CircleDrawingOpts,\n      queryOrExisting?: string | SVGCircleElement\n    ) => Elements.circle(circle, parent, opts, queryOrExisting),\n    path: (\n      svgStr: string | readonly string[],\n      opts?: PathDrawingOpts,\n      queryOrExisting?: string | SVGPathElement\n    ) => Elements.path(svgStr, parent, opts, queryOrExisting),\n    grid: (\n      center: Points.Point,\n      spacing: number,\n      width: number,\n      height: number,\n      opts?: LineDrawingOpts\n    ) => Elements.grid(parent, center, spacing, width, height, opts),\n    query: <V extends SVGElement>(selectors: string): V | null =>\n      parent.querySelector(selectors),\n    get width(): number {\n      const w = parent.getAttributeNS(null, `width`);\n      if (w === null) return 0;\n      return parseFloat(w);\n    },\n    set width(width: number) {\n      parent.setAttributeNS(null, `width`, width.toString());\n    },\n    get parent(): SVGElement {\n      return parent;\n    },\n    get height(): number {\n      const w = parent.getAttributeNS(null, `height`);\n      if (w === null) return 0;\n      return parseFloat(w);\n    },\n    set height(height: number) {\n      parent.setAttributeNS(null, `height`, height.toString());\n    },\n    clear: () => {\n      while (parent.firstChild) {\n        parent.removeChild(parent.lastChild as HTMLElement);\n      }\n    },\n  };\n  return o;\n};\n","import {\n  createOrResolve,\n  type MarkerOpts,\n  createEl,\n  type DrawingOpts,\n  applyOpts,\n} from './Svg.js';\n\nexport const createMarker = (\n  id: string,\n  opts: MarkerOpts,\n  childCreator?: () => SVGElement\n): SVGMarkerElement => {\n  const m = createEl<SVGMarkerElement>(`marker`, id);\n\n  if (opts.markerWidth) {\n    m.setAttribute(`markerWidth`, opts.markerWidth?.toString());\n  }\n  if (opts.markerHeight) {\n    m.setAttribute(`markerHeight`, opts.markerHeight?.toString());\n  }\n  if (opts.orient) m.setAttribute(`orient`, opts.orient.toString());\n  else m.setAttribute(`orient`, `auto-start-reverse`);\n\n  if (opts.viewBox) m.setAttribute(`viewBox`, opts.viewBox.toString());\n  if (opts.refX) m.setAttribute(`refX`, opts.refX.toString());\n  if (opts.refY) m.setAttribute(`refY`, opts.refY.toString());\n\n  if (childCreator) {\n    const c = childCreator();\n    m.appendChild(c);\n  }\n  return m;\n};\n\nexport const markerPrebuilt = (\n  elem: SVGElement | null,\n  opts: MarkerOpts,\n  _context: DrawingOpts\n): string => {\n  if (elem === null) return `(elem null)`;\n\n  const parent = elem.ownerSVGElement;\n  if (parent === null) throw new Error(`parent for elem is null`);\n  const defsEl = createOrResolve<SVGDefsElement>(parent, `defs`, `defs`);\n\n  //eslint-disable-next-line functional/no-let\n  let defEl = defsEl.querySelector(`#${opts.id}`) as SVGElement | null;\n\n  if (defEl !== null) {\n    return `url(#${opts.id})`;\n  }\n\n  if (opts.id === `triangle`) {\n    opts = { ...opts, strokeStyle: `transparent` };\n    if (!opts.markerHeight) opts = { ...opts, markerHeight: 6 };\n    if (!opts.markerWidth) opts = { ...opts, markerWidth: 6 };\n    if (!opts.refX) opts = { ...opts, refX: opts.markerWidth };\n    if (!opts.refY) opts = { ...opts, refY: opts.markerHeight };\n    if (!opts.fillStyle || opts.fillStyle === `none`) {\n      opts = { ...opts, fillStyle: `black` };\n    }\n    if (!opts.viewBox) opts = { ...opts, viewBox: `0 0 10 10` };\n\n    defEl = createMarker(opts.id, opts, () => {\n      const tri = createEl<SVGPathElement>(`path`);\n      tri.setAttribute(`d`, `M 0 0 L 10 5 L 0 10 z`);\n      if (opts) applyOpts(tri, opts);\n      return tri;\n    });\n  } else throw new Error(`Do not know how to make ${opts.id}`);\n\n  //eslint-disable-next-line functional/immutable-data\n  defEl.id = opts.id;\n  defsEl.appendChild(defEl);\n\n  return `url(#${opts.id})`;\n};\n","import { type CirclePositioned } from '../geometry/Circle.js';\nimport * as Lines from '../geometry/Line.js';\nimport * as Points from '../geometry/Point.js';\nimport * as Svg from './Svg.js';\nimport { getCssVariable } from './Colour.js';\n//import {Palette} from \".\";\n\nconst numOrPercentage = (v: number): string => {\n  if (v >= 0 && v <= 1) return v * 100 + `%`;\n  return v.toString();\n};\n\n/**\n * Creates and adds an SVG path element\n * @example\n * ```js\n * const paths = [\n *  `M300,200`,\n *  `a25,25 -30 0,1 50, -25 l 50,-25`\n * ]\n * const pathEl = path(paths, parentEl);\n * ```\n * @param svgOrArray Path syntax, or array of paths. Can be empty if path data will be added later\n * @param parent SVG parent element\n * @param opts Options Drawing options\n * @returns\n */\nexport const path = (\n  svgOrArray: string | readonly string[],\n  parent: SVGElement,\n  opts?: Svg.PathDrawingOpts,\n  queryOrExisting?: string | SVGPathElement\n): SVGPathElement => {\n  const elem = Svg.createOrResolve<SVGPathElement>(\n    parent,\n    `path`,\n    queryOrExisting\n  );\n  const svg =\n    typeof svgOrArray === `string` ? svgOrArray : svgOrArray.join(`\\n`);\n\n  elem.setAttributeNS(null, `d`, svg);\n  parent.appendChild(elem);\n  return pathUpdate(elem, opts);\n};\n\nexport const pathUpdate = (\n  elem: SVGPathElement,\n  opts?: Svg.PathDrawingOpts\n) => {\n  if (opts) Svg.applyOpts(elem, opts);\n  if (opts) Svg.applyStrokeOpts(elem, opts);\n  return elem;\n};\n\n/**\n * Updates an existing `SVGCircleElement` with potentially updated circle data and drawing options\n * @param elem Element\n * @param circle Circle\n * @param opts Drawing options\n * @returns SVGCircleElement\n */\nexport const circleUpdate = (\n  elem: SVGCircleElement,\n  circle: CirclePositioned,\n  opts?: Svg.CircleDrawingOpts\n) => {\n  elem.setAttributeNS(null, `cx`, circle.x.toString());\n  elem.setAttributeNS(null, `cy`, circle.y.toString());\n  elem.setAttributeNS(null, `r`, circle.radius.toString());\n  if (opts) Svg.applyOpts(elem, opts);\n  if (opts) Svg.applyStrokeOpts(elem, opts);\n\n  return elem;\n};\n\n/**\n * Creates or reuses a `SVGCircleElement`.\n *\n * To update an existing element, use `circleUpdate`\n * @param circle\n * @param parent\n * @param opts\n * @param queryOrExisting\n * @returns\n */\nexport const circle = (\n  circle: CirclePositioned,\n  parent: SVGElement,\n  opts?: Svg.CircleDrawingOpts,\n  queryOrExisting?: string | SVGCircleElement\n): SVGCircleElement => {\n  const p = Svg.createOrResolve<SVGCircleElement>(\n    parent,\n    `circle`,\n    queryOrExisting\n  );\n  return circleUpdate(p, circle, opts);\n};\n\n/**\n * Creates or resuses a `SVGGElement` (group)\n *\n * To update an existing elemnet, use `groupUpdate`\n * @param children\n * @param parent\n * @param queryOrExisting\n * @returns\n */\nexport const group = (\n  children: readonly SVGElement[],\n  parent: SVGElement,\n  queryOrExisting?: string | SVGGElement\n): SVGGElement => {\n  const p = Svg.createOrResolve<SVGGElement>(parent, `g`, queryOrExisting);\n  return groupUpdate(p, children);\n};\n\nexport const groupUpdate = (\n  elem: SVGGElement,\n  children: readonly SVGElement[]\n) => {\n  for (const c of children) {\n    if (c.parentNode !== elem) {\n      elem.appendChild(c);\n    }\n  }\n\n  return elem;\n};\n\n/**\n * Creates or reuses a SVGLineElement.\n *\n * @param line\n * @param parent\n * @param opts\n * @param queryOrExisting\n * @returns\n */\nexport const line = (\n  line: Lines.Line,\n  parent: SVGElement,\n  opts?: Svg.LineDrawingOpts,\n  queryOrExisting?: string | SVGLineElement\n): SVGLineElement => {\n  const lineEl = Svg.createOrResolve<SVGLineElement>(\n    parent,\n    `line`,\n    queryOrExisting\n  );\n  return lineUpdate(lineEl, line, opts);\n};\n\n/**\n * Updates a SVGLineElement instance with potentially changed line and drawing data\n * @param lineEl\n * @param line\n * @param opts\n * @returns\n */\nexport const lineUpdate = (\n  lineEl: SVGLineElement,\n  line: Lines.Line,\n  opts?: Svg.LineDrawingOpts\n) => {\n  lineEl.setAttributeNS(null, `x1`, line.a.x.toString());\n  lineEl.setAttributeNS(null, `y1`, line.a.y.toString());\n  lineEl.setAttributeNS(null, `x2`, line.b.x.toString());\n  lineEl.setAttributeNS(null, `y2`, line.b.y.toString());\n  if (opts) Svg.applyOpts(lineEl, opts);\n  if (opts) Svg.applyPathOpts(lineEl, opts);\n  if (opts) Svg.applyStrokeOpts(lineEl, opts);\n  return lineEl;\n};\n\n/**\n * Updates an existing SVGTextPathElement instance with text and drawing options\n * @param el\n * @param text\n * @param opts\n * @returns\n */\nexport const textPathUpdate = (\n  el: SVGTextPathElement,\n  text?: string,\n  opts?: Svg.TextPathDrawingOpts\n) => {\n  if (opts?.method) el.setAttributeNS(null, `method`, opts.method);\n  if (opts?.side) el.setAttributeNS(null, `side`, opts.side);\n  if (opts?.spacing) el.setAttributeNS(null, `spacing`, opts.spacing);\n  if (opts?.startOffset) {\n    el.setAttributeNS(null, `startOffset`, numOrPercentage(opts.startOffset));\n  }\n  if (opts?.textLength) {\n    el.setAttributeNS(null, `textLength`, numOrPercentage(opts.textLength));\n  }\n\n  if (text) {\n    //eslint-disable-next-line functional/immutable-data\n    el.textContent = text;\n  }\n  if (opts) Svg.applyOpts(el, opts);\n  if (opts) Svg.applyStrokeOpts(el, opts);\n  return el;\n};\n\n/**\n * Creates or reuses a SVGTextPathElement.\n * @param pathRef\n * @param text\n * @param parent\n * @param opts\n * @param queryOrExisting\n * @returns\n */\nexport const textPath = (\n  pathRef: string,\n  text: string,\n  parent: SVGElement,\n  opts?: Svg.TextPathDrawingOpts,\n  queryOrExisting?: string | SVGTextPathElement\n): SVGTextPathElement => {\n  const textEl = Svg.createOrResolve<SVGTextElement>(\n    parent,\n    `text`,\n    queryOrExisting + `-text`\n  );\n  // Update text properties, but don't pass in position or text\n  textUpdate(textEl, undefined, undefined, opts);\n\n  const p = Svg.createOrResolve<SVGTextPathElement>(\n    textEl,\n    `textPath`,\n    queryOrExisting\n  );\n  p.setAttributeNS(null, `href`, pathRef);\n  return textPathUpdate(p, text, opts);\n};\n\n/**\n * Updates an existing SVGTextElement instance with position, text and drawing options\n * @param el\n * @param pos\n * @param text\n * @param opts\n * @returns\n */\nexport const textUpdate = (\n  el: SVGTextElement,\n  pos?: Points.Point,\n  text?: string,\n  opts?: Svg.TextDrawingOpts\n) => {\n  if (pos) {\n    el.setAttributeNS(null, `x`, pos.x.toString());\n    el.setAttributeNS(null, `y`, pos.y.toString());\n  }\n  if (text) {\n    //eslint-disable-next-line functional/immutable-data\n    el.textContent = text;\n  }\n\n  if (opts) {\n    Svg.applyOpts(el, opts);\n    if (opts) Svg.applyStrokeOpts(el, opts);\n\n    if (opts.anchor) el.setAttributeNS(null, `text-anchor`, opts.anchor);\n    if (opts.align) el.setAttributeNS(null, `alignment-baseline`, opts.align);\n\n    const userSelect = opts.userSelect ?? true;\n\n    if (!userSelect) {\n      //eslint-disable-next-line functional/immutable-data\n      el.style.userSelect = `none`;\n      //eslint-disable-next-line functional/immutable-data\n      el.style.webkitUserSelect = `none`;\n    }\n  }\n  return el;\n};\n\n/**\n * Creates or reuses a SVGTextElement\n * @param pos Position of text\n * @param text Text\n * @param parent\n * @param opts\n * @param queryOrExisting\n * @returns\n */\nexport const text = (\n  text: string,\n  parent: SVGElement,\n  pos?: Points.Point,\n  opts?: Svg.TextDrawingOpts,\n  queryOrExisting?: string | SVGTextElement\n): SVGTextElement => {\n  const p = Svg.createOrResolve<SVGTextElement>(\n    parent,\n    `text`,\n    queryOrExisting\n  );\n  return textUpdate(p, pos, text, opts);\n};\n\n/**\n * Creates a square grid based at a center point, with cells having `spacing` height and width.\n *\n * It fits in as many cells as it can within `width` and `height`.\n *\n * Returns a SVG group, consisting of horizontal and vertical lines\n * @param parent Parent element\n * @param center Center point of grid\n * @param spacing Width/height of cells\n * @param width How wide grid should be\n * @param height How high grid should be\n * @param opts\n */\nexport const grid = (\n  parent: SVGElement,\n  center: Points.Point,\n  spacing: number,\n  width: number,\n  height: number,\n  opts: Svg.LineDrawingOpts = {}\n) => {\n  if (!opts.strokeStyle) {\n    opts = { ...opts, strokeStyle: getCssVariable(`bg-dim`, `silver`) };\n  }\n  if (!opts.strokeWidth) opts = { ...opts, strokeWidth: 1 };\n\n  const g = Svg.createEl<SVGGElement>(`g`);\n  Svg.applyOpts(g, opts);\n  Svg.applyPathOpts(g, opts);\n  Svg.applyStrokeOpts(g, opts);\n\n  // Horizontals\n  //eslint-disable-next-line functional/no-let\n  let y = 0;\n  while (y < height) {\n    const horiz = Lines.fromNumbers(0, y, width, y);\n    line(horiz, g);\n    y += spacing;\n  }\n\n  // Verticals\n  //eslint-disable-next-line functional/no-let\n  let x = 0;\n  while (x < width) {\n    const vert = Lines.fromNumbers(x, 0, x, height);\n    line(vert, g);\n    x += spacing;\n  }\n  parent.appendChild(g);\n  return g;\n};\n","import { minIndex } from '../collections/NumericArrays.js';\nimport { type PointCalculableShape } from '../geometry/Point.js';\nimport { Arrays } from '../collections/index.js';\nimport { Points, Rects } from '../geometry/index.js';\nimport { clamp, flip, scale } from '../data/index.js';\nimport { parentSizeCanvas } from '../dom/Util.js';\nimport * as Sg from './SceneGraph.js';\n\nimport { textRect, textWidth } from './Drawing.js';\nimport { ifNaN } from '../Util.js'\nimport { getPaths, getField } from '../Immutable.js';\nimport { throwNumberTest } from '../Guards.js';\nimport type { RectPositioned } from 'src/geometry/Rect.js';\nimport { scaleCanvas } from './index.js';\n\n/**\n * \n *  const dataStream = new DataStream();\n *  dataStream.in({ key: `x`, value: 0.5 }); \n *  const label = (obj:any) => {\n *    if (`key` in obj) return obj;\n *    return { key: randomKey(), ...obj }\n *  }\n *  const stream = pipeline(dataStream, label);\n *  // Actively compute size of window based on window width\n *  const windowSize = ops.divide(rxWindow.innerWidth, pointSize);\n *  const dataWindow = window(stream, windowSize);\n *  const dataToPoints = (value);\n * \n *  const drawPlot = (dataWindow) => {\n *    for (const dataPoint in dataWindow) {\n *    }\n *  }\n */\n\n/**\n * A data source\n */\nexport type DataSource = {\n  dirty: boolean;\n  type: string;\n  get range(): DataRange;\n  add(value: number): void;\n  clear(): void;\n}\n\n/**\n * Plot options\n */\nexport type Opts = {\n  /**\n   * If true, Canvas will be resized to fit parent\n   */\n  autoSize?: boolean;\n  /**\n   * Colour for axis lines & labels\n   */\n  axisStrokeColour?: string;\n\n  axisTextColour?: string\n\n  legendTextColour?: string\n  /**\n   * Width for axis lines\n   */\n  axisStrokeWidth?: number;\n};\n\n/**\n * Series options\n */\nexport type SeriesOpts = {\n  /**\n   * Colour for series\n   */\n  colour: string;\n  /**\n   * Visual width/height (depends on drawingStyle)\n   */\n  width?: number;\n  /**\n   * How series should be rendered\n   */\n  drawingStyle?: `line` | `dotted` | `bar`;\n  /**\n   * Preferred data range\n   */\n  axisRange?: DataRange;\n  /**\n   * If true, range will stay at min/max, rather than continuously adapting\n   * to the current data range.\n   */\n  visualRangeStretch?: boolean;\n};\n\nexport type DataPoint = {\n  value: number;\n  index: number;\n  title?: string;\n};\n\nexport type DataHitPoint = (\n  pt: Points.Point\n) => [ point: DataPoint | undefined, distance: number ];\n\nclass ArrayDataSource implements DataSource {\n  data: Array<number>;\n  series: Series;\n  dirty = false;\n  type = `array`;\n\n  private _range: Arrays.MinMaxAvgTotal | undefined;\n\n  constructor(series: Series) {\n    this.series = series;\n    this.data = [];\n    this.dirty = true;\n  }\n\n  clear() {\n    this.set([]);\n    this._range = undefined;\n  }\n\n  set(data: Array<number>) {\n    this.data = data;\n    this.dirty = true;\n  }\n\n  get length(): number {\n    return this.data.length;\n  }\n\n  get range(): DataRange {\n    if (!this.dirty && this._range !== undefined) return this._range;\n    this.dirty = false;\n    const updatedRange = Arrays.minMaxAvg(this.data);\n    if (this._range === undefined || updatedRange.max !== this._range.max || updatedRange.min !== this._range.min) {\n      this._range = updatedRange;\n      return { ...this._range, changed: true };\n    } else {\n      return { ...this._range, changed: false };\n\n    }\n  }\n\n  add(value: number) {\n    this.data = [ ...this.data, value ];\n    this.dirty = true;\n  }\n}\n\nclass StreamingDataSource extends ArrayDataSource {\n  desiredDataPointMinWidth = 5;\n\n  add(value: number) {\n    const lastWidth = this.series.lastPxPerPt;\n    if (lastWidth > -1 && lastWidth < this.desiredDataPointMinWidth) {\n      // Remove older data\n      const pts = Math.floor(this.desiredDataPointMinWidth / lastWidth);\n      const d = [ ...this.data.slice(pts), value ];\n      super.set(d);\n    } else super.add(value);\n  }\n}\n\nexport type DataRange = {\n  min: number;\n  max: number;\n  changed?: boolean;\n};\n\nexport class Series {\n  name: string;\n  colour: string;\n  source: DataSource;\n  drawingStyle: `line` | `dotted` | `bar`;\n  width = 3;\n  dataHitPoint: DataHitPoint | undefined;\n  tooltip?: string;\n  precision = 2;\n\n  readonly axisRange: DataRange;\n\n  // How many pixels wide per data point on last draw\n  lastPxPerPt = -1;\n\n  protected _visualRange: DataRange;\n  protected _visualRangeStretch: boolean;\n\n  constructor(\n    name: string,\n    sourceType: `array` | `stream`,\n    private plot: Plot,\n    opts: SeriesOpts\n  ) {\n    this.name = name;\n\n    this.drawingStyle = opts.drawingStyle ?? `line`;\n    this.colour = opts.colour;\n    this.width = opts.width ?? 3;\n    this.axisRange = opts.axisRange ?? { min: Number.NaN, max: Number.NaN };\n    this._visualRange = { ...this.axisRange };\n    this._visualRangeStretch = opts.visualRangeStretch ?? true;\n\n    if (sourceType === `array`) {\n      this.source = new ArrayDataSource(this);\n    } else if (sourceType === `stream`) {\n      this.source = new StreamingDataSource(this);\n    } else throw new Error(`Unknown sourceType. Expected array|stream`);\n  }\n\n  formatValue(v: number) {\n    return v.toFixed(this.precision);\n  }\n\n  get visualRange(): DataRange {\n    let vr = this._visualRange;\n    const sourceRange = this.source.range;\n    let changed = false;\n\n    if (sourceRange.changed) {\n      if (this._visualRangeStretch) {\n        // Stretch range to lowest/highest-seen min/max\n        const rmin = Math.min(ifNaN(vr.min, sourceRange.min), sourceRange.min);\n        const rmax = Math.max(ifNaN(vr.max, sourceRange.max), sourceRange.max);\n        if (rmin !== vr.min || rmax !== vr.max) {\n          // Changed\n          vr = { min: rmin, max: rmax };\n          changed = true;\n        }\n      } else {\n        // Use actual range of data\n        if (!isRangeEqual(sourceRange, vr)) {\n          vr = sourceRange;\n          changed = true;\n        }\n      }\n    }\n    this._visualRange = vr;\n    return { ...vr, changed };\n  }\n\n  scaleValue(value: number): number {\n    if (this.source === undefined) return value;\n    const r = this.visualRange;\n    if (r.changed) {\n      this.plot.notify(`range-change`, this.plot.plotArea);\n    }\n    if (r.min == r.max) {\n      // No real scale - only received the same value for this series\n      return 0.5;\n    }\n    return scale(value, r.min, r.max);\n  }\n\n  add(value: number) {\n    throwNumberTest(value, ``, `value`);\n    this.source.add(value);\n    //this.plot.plotArea.layoutInvalidated(`Series.add`);\n    this.plot.plotArea.drawingInvalidated(`Series.add`);\n  }\n\n  /**\n   * Clears the underlying source\n   * and sets a flag that the plot area needs redrawing\n   */\n  clear() {\n    this.source.clear();\n    this._visualRange = { ...this.axisRange };\n    this.plot.plotArea.layoutInvalidated(`Series.clear`);\n  }\n}\n\nexport class PlotArea extends Sg.CanvasBox {\n  paddingPx = 5;\n  piPi = Math.PI * 2;\n  // If pointer is more than this distance away from a data point, it's ignored\n  pointerDistanceThreshold = 20;\n  lastRangeChange = 0;\n  pointer: Points.Point | undefined;\n\n  constructor(private plot: Plot, region: Rects.RectPositioned) {\n    super(plot, `PlotArea`, region);\n\n  }\n\n  clear() {\n    this.lastRangeChange = 0;\n    this.pointer = undefined;\n  }\n\n  protected measureSelf(\n    opts: Sg.MeasureState,\n    _parent?: Sg.Measurement\n  ): Rects.Rect | string {\n\n    const axisY = opts.getActualSize(`AxisY`);\n    const padding = this.paddingPx;\n    const legend = opts.getActualSize(`Legend`);\n    const legendHeight = legend?.height ?? 0;\n\n    const axisX = opts.getActualSize(`AxisX`);\n    const axisXHeight = axisX?.height ?? 0;\n\n    if (!axisY) return `No AxisY. Measured: ${ opts.whatIsMeasured().join(`, `) }`;\n    if (!legend) return `No Legend`;\n    if (!axisX) return `No AxisX`;\n\n    return {\n      width: opts.bounds.width - axisY.width - this.paddingPx,\n      height: opts.bounds.height - legendHeight - axisXHeight - padding,\n    };\n  }\n\n  protected layoutSelf(measureState: Sg.MeasureState, _layoutState: Sg.LayoutState, _parent: Sg.Layout) {\n    const axisY = measureState.getActualSize(`AxisY`);\n    //const axisX = measureState.getActualSize(`AxisX`);\n    const padding = this.paddingPx;\n\n    //const legend = measureState.getActualSize(`Legend`);\n    //const legendHeight = legend?.height ?? 0;\n\n    //const axisXHeight = axisX?.height ?? 0;\n    const axisYWidth = axisY?.width ?? 0;\n\n    //const height = this._measuredSize?.height ?? 0;\n\n    return {\n      x: axisYWidth,\n      y: padding // layoutState.bounds.height - height - axisXHeight - legendHeight\n    }\n  }\n\n  protected onNotify(message: string, source: Sg.Box): void {\n    //this.debugLog(`onNotify message: ${ message } source: ${ source.id }`);\n    if (message === `measureApplied` && source === this.plot.axisY)\n      this.layoutInvalidated(`PlotArea.onNotify measureApplied to axisY`);\n    if (message === `laidout` && source === this.plot.legend)\n      this.layoutInvalidated(`PlotArea.onNotify laidout to legend`);\n  }\n\n  // protected onClick(p: Points.Point): void {\n  //   this.plot.frozen = !this.plot.frozen;\n  // }\n\n  protected onPointerLeave(): void {\n    for (const series of this.plot.series.values()) {\n      series.tooltip = undefined;\n    }\n    this.pointer = undefined;\n    (this.plot.legend as Sg.CanvasBox).drawingInvalidated(`PlotArea.onPointerLeave`);\n  }\n\n  protected onPointerMove(p: Points.Point): void {\n    this.pointer = p;\n    this.plot.legend.drawingInvalidated(`PlotArea.onPointerMove`);\n  }\n\n  protected measurePreflight(): void {\n    this.updateTooltip();\n  }\n\n  updateTooltip() {\n    const p = this.pointer;\n    if (p === undefined) return;\n\n    for (const series of this.plot.series.values()) {\n      if (p === undefined) {\n        series.tooltip = undefined;\n        return;\n      }\n      if (series.dataHitPoint === undefined) return;\n      const v = series.dataHitPoint(p);\n      if (v[ 0 ] === undefined) return;\n      if (v[ 1 ] > this.pointerDistanceThreshold) return; // too far away\n      series.tooltip = series.formatValue(v[ 0 ].value);\n      //this.plot.legend.onLayoutNeeded();\n    }\n    this.plot.legend.drawingInvalidated(`PlotArea.updateTooltip`);\n  }\n\n  protected drawSelf(ctx: CanvasRenderingContext2D): void {\n    if (this.plot.frozen) return;\n    const seriesCopy = this.plot.seriesArray(); // [...this.plot.series.values()];\n    //ctx.fillStyle = `hsla(10,50%,50%,0.5)`;\n    //ctx.fillRect(0, 0, this.canvasRegion.width, this.canvasRegion.height);\n\n    // Using -1 for y to catch a few random peaks from sharp lines\n    ctx.clearRect(0, -1, this.canvasRegion.width, this.canvasRegion.height);\n\n    for (const series of seriesCopy) {\n      if (series.source.type === `array` || series.source.type === `stream`) {\n        const arraySeries = series.source as ArrayDataSource;\n        if (arraySeries.data === undefined) return;\n        const d = [ ...arraySeries.data ];\n        this.drawDataSet(series, d, ctx);\n      } else console.warn(`Unknown data source type ${ series.source.type }`);\n    }\n  }\n\n  computeY(series: Series, rawValue: number) {\n    const s = series.scaleValue(rawValue);\n    return flip(s) * this.canvasRegion.height + this.paddingPx;\n  }\n\n  drawDataSet(\n    series: Series,\n    d: Array<number>,\n    ctx: CanvasRenderingContext2D\n  ): void {\n    const padding = this.paddingPx + series.width;\n    const v = Rects.subtract(this.canvasRegion, padding * 2, padding * 3.5);\n    const pxPerPt = v.width / d.length;\n\n    series.lastPxPerPt = pxPerPt;\n    let x = padding;\n\n    ctx.strokeStyle = series.colour;\n    ctx.lineWidth = series.width;\n    const shapes: Array<DataPoint & PointCalculableShape> = [];\n\n    series.dataHitPoint = (pt: Points.Point): [ DataPoint, number ] => {\n      const distances = shapes.map((v) => Points.distanceToExterior(pt, v));\n      const index = minIndex(...distances);\n      const closest = shapes[ index ];\n      if (closest === undefined) [ undefined, 0 ];\n      return [ closest, distances[ index ] ];\n    };\n\n    // eslint-disable-next-line unicorn/prefer-switch\n    if (series.drawingStyle === `line`) {\n      let y = 0;\n      ctx.beginPath();\n\n      // eslint-disable-next-line unicorn/no-for-loop\n      for (let index = 0; index < d.length; index++) {\n        const scaled = clamp(series.scaleValue(d[ index ]));\n        y = padding + this.paddingPx + v.height * flip(scaled);\n        shapes.push({ x, y, index: index, value: d[ index ] });\n\n        if (index == 0) ctx.moveTo(x + pxPerPt / 2, y);\n        else ctx.lineTo(x + pxPerPt / 2, y);\n\n        if (y > this.canvasRegion.height)\n          console.warn(`${ y } h: ${ this.canvasRegion.height }`);\n        x += pxPerPt;\n      }\n      ctx.strokeStyle = series.colour;\n      ctx.stroke();\n    } else if (series.drawingStyle === `dotted`) {\n      let y = 0;\n      ctx.fillStyle = series.colour;\n      // eslint-disable-next-line unicorn/no-for-loop\n      for (let index = 0; index < d.length; index++) {\n        const scaled = series.scaleValue(d[ index ]);\n        y = padding + v.height * flip(scaled);\n        ctx.beginPath();\n        ctx.arc(x + pxPerPt / 2, y, series.width, 0, this.piPi);\n        ctx.fill();\n        shapes.push({ radius: series.width, x, y, index: index, value: d[ index ] });\n        x += pxPerPt;\n      }\n    } else if (series.drawingStyle === `bar`) {\n      ctx.fillStyle = series.colour;\n      const interBarPadding = Math.ceil(pxPerPt * 0.1);\n      // eslint-disable-next-line unicorn/no-for-loop\n      for (let index = 0; index < d.length; index++) {\n        const scaled = series.scaleValue(d[ index ]);\n        const h = v.height * scaled;\n        const r = {\n          x: x + interBarPadding,\n          y: v.height - h + padding,\n          width: pxPerPt - interBarPadding,\n          height: h,\n          index: index,\n          value: d[ index ],\n        };\n        ctx.fillRect(r.x, r.y, r.width, r.height);\n        shapes.push(r);\n        x += pxPerPt;\n      }\n    }\n  }\n}\n\nexport class Legend extends Sg.CanvasBox {\n  sampleSize = { width: 10, height: 10 };\n  padding = 3;\n  widthSnapping = 20;\n\n  labelMeasurements = new Map<string, Rects.RectPositioned>();\n\n  constructor(private plot: Plot, region: Rects.RectPositioned) {\n    super(plot, `Legend`, region);\n  }\n\n  clear() {\n    /** no-op */\n  }\n\n  protected layoutSelf(measureState: Sg.MeasureState, layoutState: Sg.LayoutState, _parent: Sg.Layout) {\n    const axisY = measureState.getActualSize(`AxisY`);\n    const axisYWidth = axisY?.width ?? 0;\n\n    const height = this._measuredSize?.height ?? 0;\n    return {\n      x: axisYWidth,\n      y: layoutState.bounds.height - height\n    }\n  }\n\n  protected measureSelf(\n    opts: Sg.CanvasMeasureState,\n    _parent?: Sg.Measurement\n  ): Rects.Rect | Rects.RectPositioned | string {\n    const series = this.plot.seriesArray();\n    const sample = this.sampleSize;\n    const padding = this.padding;\n    const widthSnapping = this.widthSnapping;\n    const ctx = opts.ctx;\n\n    const yAxis = opts.measurements.get(`AxisY`);\n    const yAxisWidth = yAxis?.actual.width ?? 0;\n\n    let x = padding;\n    let y = padding;\n    const availableWidth = opts.bounds.width - yAxisWidth - padding;\n\n    //let rows = 1;\n    let rowHeight = 0;\n    for (const s of series) {\n      const startX = x;\n      x += sample.width + padding;\n      ctx.textBaseline = `middle`;\n\n      const text = textRect(ctx, s.name, padding, widthSnapping);\n\n      x += textWidth(ctx, s.name, padding, widthSnapping);\n\n      if (s.tooltip) {\n        x += textWidth(ctx, s.tooltip, padding, widthSnapping);\n      }\n      const r = { width: 10, height: 10, x: startX, y };\n\n      this.labelMeasurements.set(s.name, r)\n      rowHeight = Math.min(sample.height + padding + padding, text.height + padding + padding);\n      x += padding;\n      if (x > availableWidth) {\n        x = padding;\n        y += rowHeight;\n        //rows++;\n\n      }\n    }\n\n    return {\n      width: availableWidth,\n      height: y + rowHeight\n    }\n    // const ctx = (opts as Sg.CanvasMeasureState).ctx;\n\n    // const usableWidth = opts.bounds.width - yAxisWidth;\n\n    // let width = padding;\n    // for (const s of series) {\n    //   width += sample.width + padding;\n    //   width += textWidth(ctx, s.name, padding, widthSnapping);\n    //   width += textWidth(ctx, s.tooltip, padding, widthSnapping);\n    // }\n\n    // const rows = Math.max(1, Math.ceil(width / usableWidth));\n    // console.log(`rows: ${ rows }`);\n    // const h = rows * (this.sampleSize.height + this.padding + this.padding);\n    // return {\n    //   x: yAxisWidth,\n    //   y: opts.bounds.height - h,\n    //   width: usableWidth,\n    //   height: h,\n    // };\n  }\n\n  protected drawSelf(ctx: CanvasRenderingContext2D): void {\n    const series = this.plot.seriesArray();\n    const sample = this.sampleSize;\n    const padding = this.padding;\n    this.debugLog(`drawSelf`);\n\n    ctx.clearRect(0, 0, this.canvasRegion.width, this.canvasRegion.height);\n    for (const s of series) {\n      const r = this.labelMeasurements.get(s.name);\n      if (r === undefined) continue;\n      let x = r.x;\n\n      // Draw colour chip\n      ctx.fillStyle = s.colour;\n      ctx.fillRect(x, r.y, sample.width, sample.height);\n      x += sample.width + padding;\n\n      // Label\n      ctx.textBaseline = `middle`;\n      ctx.fillStyle = this.plot.legendTextColour;\n      ctx.fillText(s.name, x, r.y + sample.height / 2);\n\n      if (s.tooltip) {\n        ctx.fillStyle = this.plot.legendTextColour;\n        ctx.fillText(s.tooltip, r.x, r.y + sample.height / 2);\n      }\n    }\n    // const series = this.plot.seriesArray();\n    // const sample = this.sampleSize;\n    // const padding = this.padding;\n    // const widthSnapping = this.widthSnapping;\n\n    // let x = padding;\n    // let y = padding;\n\n    // ctx.clearRect(0, 0, this.canvasRegion.width, this.canvasRegion.height);\n    // let rows = 1;\n    // for (const s of series) {\n    //   ctx.fillStyle = s.colour;\n    //   ctx.fillRect(x, y, sample.width, sample.height);\n    //   x += sample.width + padding;\n    //   ctx.textBaseline = `middle`;\n    //   ctx.fillStyle = this.plot.legendTextColour;\n    //   ctx.fillText(s.name, x, y + sample.height / 2);\n    //   x += textWidth(ctx, s.name, padding, widthSnapping);\n\n    //   if (s.tooltip) {\n    //     ctx.fillStyle = this.plot.legendTextColour;\n    //     ctx.fillText(s.tooltip, x, y + sample.height / 2);\n    //     x += textWidth(ctx, s.tooltip, padding, widthSnapping);\n    //   }\n    //   x += padding;\n    //   if (x > this.canvasRegion.width - 100) {\n    //     x = padding;\n    //     y += sample.height + padding + padding;\n    //     rows++;\n    //     this.debugLog(`drawSelf rows: ${ rows }`);\n    //   }\n    // }\n  }\n\n  protected onNotify(message: string, source: Sg.Box): void {\n    this.debugLog(`onNotify ${ message } source: ${ source.id }`);\n    if (message === `measureApplied` && source === (this._parent as Plot).axisY) {\n      this.layoutInvalidated(`Legend.onNotify measureApplied to axisY`);\n\n    } else if (message == `range-change`) {\n      //this.layoutInvalidated(`Legend.onNotify range-change`);\n    }\n  }\n}\n\nexport class AxisX extends Sg.CanvasBox {\n  paddingPx = 2;\n  colour?: string;\n\n  constructor(private plot: Plot, region: RectPositioned) {\n    super(plot, `AxisX`, region);\n  }\n\n  clear() {\n    /** no-op */\n  }\n\n  protected onNotify(message: string, source: Sg.Box): void {\n    //this.debugLog(message);\n    if (message === `measureApplied` && source === this.plot.axisY) {\n      this.layoutInvalidated(`AxisX.onNotify measureApplied to axisY`);\n    }\n    // if (message === `measureApplied` && source === this.plot.legend) {\n    //   this.layoutInvalidated(`AxisX.onNotify measureApplied to legend`);\n    // }\n  }\n\n  protected drawSelf(ctx: CanvasRenderingContext2D): void {\n    const plot = this.plot;\n    const v = this.canvasRegion;\n    const strokeWidth = plot.axisStrokeWidth;\n\n    const colour = this.colour ?? plot.axisStrokeColour;\n    ctx.strokeStyle = colour;\n\n    ctx.clearRect(0, 0, v.width, v.height);\n    //ctx.fillStyle = `hsla(200,50%,50%,0.5)`;\n    //ctx.fillRect(0, 0, v.width, v.height);\n    //this.debugLog(`drawSelf: ${ v.width } x ${ v.height } padding: ${ this.paddingPx }`);\n    ctx.beginPath();\n    ctx.lineWidth = strokeWidth;\n    ctx.moveTo(0, strokeWidth / 2);\n    ctx.lineTo(v.width, strokeWidth / 2);\n    ctx.stroke();\n  }\n\n  protected measureSelf(\n    opts: Sg.CanvasMeasureState,\n    _parent?: Sg.Measurement\n  ): Rects.Rect | Rects.RectPositioned | string {\n    const plot = this.plot;\n    const padding = this.paddingPx;\n    const yAxis = opts.measurements.get(`AxisY`);\n    const yAxisWidth = yAxis?.actual.width ?? 0;\n\n    // TODO: If we start using x-axis labels\n    const heightOfText = 0;//textHeight(opts.ctx, `100`, padding);\n    const h = plot.axisStrokeWidth + heightOfText + padding + padding;\n\n    return {\n      width: opts.bounds.width - yAxisWidth - padding,\n      height: h,\n    };\n  }\n\n  protected layoutSelf(measureState: Sg.MeasureState, _layoutState: Sg.LayoutState, _parent?: Sg.Layout | undefined): Points.Point | undefined {\n    const yAxis = measureState.measurements.get(`AxisY`);\n    const legend = measureState.getActualSize(`Legend`);\n    const legendHeight = legend?.height ?? 0;\n\n    const yAxisWidth = yAxis?.actual.width ?? 0;\n\n    const height = this._measuredSize?.height ?? 0;\n    return {\n      x: yAxisWidth,\n      y: measureState.bounds.height - height - legendHeight\n    }\n  }\n}\n\nconst isRangeEqual = (a: DataRange, b: DataRange) =>\n  a.max === b.max && a.min === b.min;\nconst isRangeSinglePoint = (a: DataRange) => a.max === a.min;\n\nexport class AxisY extends Sg.CanvasBox {\n  // Number of digits axis will be expected to show as a data legend\n  private _maxDigits = 1;\n\n  seriesToShow: string | undefined;\n  paddingPx = 2;\n  colour?: string;\n\n  lastRange: DataRange;\n  lastPlotAreaHeight = 0;\n\n  constructor(private plot: Plot, region: RectPositioned) {\n    super(plot, `AxisY`, region);\n    this.lastRange = { min: 0, max: 0 };\n  }\n\n  clear() {\n    this.lastRange = { min: 0, max: 0 };\n    this.lastPlotAreaHeight = 0;\n  }\n\n  protected measurePreflight(): void {\n    //this.debugLog(`measurePreflight`);\n    // const series = this.getSeries();\n    // if (\n    //   series !== undefined &&\n    //   !isRangeEqual(series.visualRange, this.lastRange)\n    // ) {\n    //   this.layoutInvalidated(`AxisY.measurePreflight`);\n    // }\n  }\n\n  protected onNotify(message: string, source: Sg.Box): void {\n    //this.debugLog(message);\n    const pa = this.plot.plotArea;\n    if (message === `range-change`) {\n      // Notification that series range has changed\n      this.drawingInvalidated(`range-change`);\n      return;\n    }\n\n    if (message === `measureApplied` && source === pa && (pa.canvasRegion.height !== this.lastPlotAreaHeight)) {\n      this.lastPlotAreaHeight = pa.canvasRegion.height;\n      this.drawingInvalidated(`AxisY.onNotify height change`);\n    }\n  }\n\n  protected measureSelf(copts: Sg.CanvasMeasureState): Rects.Rect {\n    //this.debugLog(`measureSelf. needsLayout: ${ this._needsLayoutX } needsDrawing: ${ this._needsDrawing }`);\n\n    if (copts.ctx === undefined) throw new Error(`opts.ctx is undefined`);\n\n    const paddingPx = this.paddingPx;\n    let width = this.plot.axisStrokeWidth + paddingPx;\n\n    const series = this.getSeries();\n    if (series !== undefined) {\n      const r = series.visualRange;\n      this._maxDigits =\n        Math.ceil(r.max).toString().length + series.precision + 1;\n\n      const textToMeasure = `9`.repeat(this._maxDigits);\n      width += textWidth(copts.ctx, textToMeasure, paddingPx * 2);\n    }\n    const w = copts.resolveToPx(this.desiredRegion?.width, width, width);\n    return {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      width: w!,\n      height: copts.bounds.height,\n    };\n  }\n\n  protected layoutSelf(_measureState: Sg.MeasureState, _layoutState: Sg.LayoutState, _parent?: Sg.Layout | undefined): Points.Point {\n    return { x: 0, y: 0 }\n  }\n\n  protected drawSelf(ctx: CanvasRenderingContext2D): void {\n    const s = this.getSeries();\n    if (s === undefined) {\n      if (this.seriesToShow === undefined) return;\n      console.warn(`Plot AxisY series '${ this.seriesToShow }' is missing.`);\n    } else {\n      this.seriesAxis(s, ctx);\n    }\n  }\n\n  getSeries(): Series | undefined {\n    return this.seriesToShow === undefined ?\n      // Pick first series\n      this.plot.seriesArray()[ 0 ] :\n      // Try designated series name\n      this.plot.series.get(this.seriesToShow);\n  }\n\n  seriesAxis(series: Series, ctx: CanvasRenderingContext2D) {\n    const plot = this.plot;\n    const plotArea = plot.plotArea;\n    const v = this.canvasRegion;\n    const paddingPx = this.paddingPx;\n    const r = series.visualRange;\n    const strokeWidth = plot.axisStrokeWidth;\n\n    const colour = this.colour ?? plot.axisStrokeColour;\n    ctx.strokeStyle = colour;\n    ctx.fillStyle = colour;\n\n    if (Number.isNaN(r.min) && Number.isNaN(r.max)) return; // Empty\n    this.lastRange = r;\n    ctx.clearRect(0, 0, v.width, v.height);\n\n    // ctx.fillStyle = `yellow`;\n    // ctx.fillRect(0, 0, this.canvasRegion.width, this.canvasRegion.height);\n\n    ctx.beginPath();\n    ctx.lineWidth = strokeWidth;\n    const lineX = v.width - strokeWidth / 2;\n    ctx.moveTo(lineX, plotArea.paddingPx + strokeWidth);\n    ctx.lineTo(lineX, plotArea.canvasRegion.height + paddingPx + strokeWidth + strokeWidth);\n    ctx.stroke();\n\n    ctx.textBaseline = `top`;\n    const fromRight = v.width - paddingPx * 4;\n\n    ctx.fillStyle = plot.axisTextColour;\n    if (isRangeSinglePoint(r)) {\n      this.debugLog(`rangeSinglePoint`);\n      drawText(ctx, series.formatValue(r.max), (size) => [\n        fromRight - size.width,\n        plotArea.computeY(series, r.max) - paddingPx * 4,\n      ]);\n    } else {\n      // Draw min/max data labels\n      drawText(ctx, series.formatValue(r.max), (size) => [\n        fromRight - size.width,\n        plotArea.computeY(series, r.max) + strokeWidth / 2,\n      ]);\n      drawText(ctx, series.formatValue(r.min), (size) => [\n        fromRight - size.width,\n        plotArea.computeY(series, r.min) - 5,\n      ]);\n    }\n  }\n}\n\nconst drawText = (\n  ctx: CanvasRenderingContext2D,\n  text: string,\n  position: (size: TextMetrics) => [ x: number, y: number ]\n) => {\n  if (ctx === undefined) throw new Error(`ctx is undefined`);\n  const size = ctx.measureText(text);\n  const xy = position(size);\n  ctx.fillText(text, xy[ 0 ], xy[ 1 ]);\n};\n\n/**\n * Canvas-based data plotter.\n *\n * ```\n * const p = new Plot(document.getElementById(`myCanvas`), opts);\n *\n * // Plot 1-5 as series  test'\n * p.createSeries(`test`, `array`, [1,2,3,4,5]);\n *\n * // Create a streaming series, add a random number\n * const s = p.createSeries(`test2`, `stream`);\n * s.add(Math.random());\n * ```\n * `createSeries` returns the {@link Series} instance with properties for fine-tuning\n *\n * For simple usage, use `plot(someData)` which automatically creates\n * series for the properties of an object.\n */\nexport class Plot extends Sg.CanvasBox {\n  plotArea: PlotArea;\n  legend: Legend;\n  axisX: AxisX;\n  axisY: AxisY;\n  axisStrokeColour: string;\n  axisTextColour: string;\n  legendTextColour: string;\n\n  axisStrokeWidth: number;\n  series: Map<string, Series>;\n  private _frozen = false;\n  private _canvasEl: HTMLCanvasElement;\n  private _ctx: CanvasRenderingContext2D;\n\n  defaultSeriesOpts?: SeriesOpts;\n  constructor(canvasElementOrQuery: HTMLCanvasElement | string, opts: Opts = {}) {\n    const { ctx, element, bounds } = scaleCanvas(canvasElementOrQuery);\n    super(undefined, `Plot`);//bounds);\n    this._canvasEl = element;\n    this._ctx = ctx;\n\n    if (opts.autoSize) {\n      parentSizeCanvas(element, (event) => {\n        this.drawingInvalidated(`resize`);\n        this.layoutInvalidated(`resize`);\n        this.update(event.ctx, true);\n      });\n    }\n\n    this.axisStrokeColour = opts.axisStrokeColour ?? `black`;\n    this.axisTextColour = opts.axisTextColour ?? `black`;\n    this.legendTextColour = opts.legendTextColour ?? `black`;\n\n    this.axisStrokeWidth = opts.axisStrokeWidth ?? 3;\n    this.series = new Map();\n    this.plotArea = new PlotArea(this, bounds);\n    this.legend = new Legend(this, bounds);\n    this.axisX = new AxisX(this, bounds);\n    this.axisY = new AxisY(this, bounds);\n\n    // this.plotArea.debugLayout = true;\n    // this.axisX.debugLayout = true;\n    // this.axisY.debugLayout = true;\n    // this.legend.debugLayout = true;\n    // this.debugLayout = true;\n  }\n\n  update(ctx?: CanvasRenderingContext2D, force = false) {\n    if (ctx === undefined) ctx = this._ctx;\n    super.update(ctx, force);\n    // this.plotArea.update(ctx, force);\n    // this.axisX.update(ctx, force);\n    // this.axisY.update(ctx, force);\n    // this.legend.update(ctx, force);\n  }\n\n  /**\n   * Calls 'clear()' on each of the series\n   */\n  clearSeries() {\n    for (const series of this.series.values()) {\n      series.clear();\n    }\n    this.update();\n  }\n\n  /**\n   * Removes all series, plot, legend\n   * and axis data.\n   */\n  clear() {\n    this.series = new Map();\n    this.plotArea.clear();\n    this.legend.clear();\n    this.axisX.clear();\n    this.axisY.clear();\n    this.layoutInvalidated(`Plot.clear`);\n    this.drawingInvalidated(`Plot.clear`);\n    this.update();\n  }\n\n  get frozen(): boolean {\n    return this._frozen;\n  }\n\n  set frozen(v: boolean) {\n    this._frozen = v;\n    if (v) {\n      this._canvasEl.classList.add(`frozen`);\n      this._canvasEl.title = `Plot frozen. Tap to unfreeze`;\n    } else {\n      this._canvasEl.title = ``;\n      this._canvasEl.classList.remove(`frozen`);\n    }\n  }\n\n  seriesArray(): Array<Series> {\n    return [ ...this.series.values() ];\n  }\n\n  get seriesLength(): number {\n    return this.series.size;\n  }\n\n  /**\n   * Plots a simple object, eg `{ x: 10, y: 20, z: 300 }`\n   * Series are automatically created for each property of `o`\n   *\n   * Be sure to call `update()` to visually refresh.\n   * @param o\n   */\n  plot(o: any) {\n    const paths = getPaths(o, true);\n    let seriesCreated = false;\n    for (const p of paths) {\n      let s = this.series.get(p);\n      if (s === undefined) {\n        s = this.createSeries(p, `stream`);\n        s.drawingStyle = `line`;\n        seriesCreated = true;\n      }\n      s.add(getField(o, p));\n    }\n    if (seriesCreated) this.legend.layoutInvalidated(`new series`);\n    this.update();\n  }\n\n  createSeriesFromObject(o: any, prefix = ``): Array<Series> {\n    const keys = Object.keys(o);\n    const create = (key: string): Array<Series> => {\n      const v = o[ key ];\n      if (typeof v === `object`) {\n        return this.createSeriesFromObject(v, `${ prefix }${ key }.`);\n      } else if (typeof v === `number`) {\n        return [ this.createSeries(key, `stream`) ];\n      } else {\n        return [];\n      }\n    };\n    return keys.flatMap(k => create(k));\n  }\n\n  createSeries(\n    name?: string,\n    type: `stream` | `array` = `array`,\n    seriesOpts?: SeriesOpts\n  ): Series {\n    const seriesLength = this.seriesLength;\n\n    if (name === undefined) name = `series-${ seriesLength }`;\n    if (this.series.has(name))\n      throw new Error(`Series name '${ name }' already in use`);\n\n    let opts: SeriesOpts = {\n      colour: `hsl(${ (seriesLength * 25) % 360 }, 70%,50%)`,\n      ...seriesOpts,\n    };\n    if (this.defaultSeriesOpts) opts = { ...this.defaultSeriesOpts, ...opts };\n\n    const s = new Series(name, type, this, opts);\n    // if (type === `array` && initialData !== undefined) {\n    //   (s.source as ArrayDataSource).set(initialData);\n    // }\n\n    this.series.set(name, s);\n    this.setReady(true, true);\n    this.plotArea.drawingInvalidated(`Plot.createSeries`);\n    return s;\n  }\n}\n","import { Arrays } from '../collections/index.js';\nimport { Points } from '../geometry/index.js';\nimport * as Rects from '../geometry/Rect.js';\nimport { hue as randomHue } from '../Random.js';\n\nexport type Measurement = {\n  actual: Rects.Rect;\n  ref: Box;\n  children: Array<Measurement | undefined>;\n};\n\nexport type Layout = {\n  actual: Points.Point;\n  ref: Box;\n  children: Array<Layout | undefined>;\n};\n\nexport type PxUnit = {\n  value: number;\n  type: `px`;\n};\n\nexport type PcUnit = {\n  value: number;\n  type: `pc`;\n};\n\nexport type BoxUnit = PxUnit | PcUnit;\n\nexport type BoxRect = {\n  x?: BoxUnit;\n  y?: BoxUnit;\n  width?: BoxUnit;\n  height?: BoxUnit;\n};\n\nexport const boxUnitFromPx = (v: number): PxUnit => {\n  return { type: `px`, value: v };\n}\nexport const boxRectFromPx = (x: number, y: number, width: number, height: number): BoxRect => {\n  return {\n    x: boxUnitFromPx(x),\n    y: boxUnitFromPx(y),\n    width: boxUnitFromPx(width),\n    height: boxUnitFromPx(height)\n  }\n}\nexport const boxRectFromRectPx = (r: Rects.RectPositioned): BoxRect => {\n  return {\n    x: boxUnitFromPx(r.x),\n    y: boxUnitFromPx(r.y),\n    width: boxUnitFromPx(r.width),\n    height: boxUnitFromPx(r.height)\n  }\n}\n\nconst unitIsEqual = (a: BoxUnit, b: BoxUnit): boolean => {\n  if (a.type === `px` && b.type === `px`) {\n    return a.value === b.value;\n  }\n  return false;\n};\n\nconst boxRectIsEqual = (\n  a: BoxRect | undefined,\n  b: BoxRect | undefined\n): boolean => {\n  if (a === undefined && b === undefined) return true;\n  if (a === undefined) return false;\n  if (b === undefined) return false;\n  if (a.x && b.x && !unitIsEqual(a.x, b.x)) return false;\n  if (a.y && b.y && !unitIsEqual(a.y, b.y)) return false;\n  if (a.width && b.width && !unitIsEqual(a.width, b.width)) return false;\n  if (a.height && b.height && !unitIsEqual(a.height, b.height)) return false;\n  return true;\n};\n\nclass BaseState {\n  bounds: Rects.RectPositioned;\n  pass: number;\n  constructor(bounds: Rects.RectPositioned) {\n    this.bounds = bounds;\n    this.pass = 0;\n  }\n\n  resolveToPx(u: BoxUnit | undefined, maxValue: number, defaultValue?: number): number | undefined {\n    if (u === undefined && defaultValue !== undefined) return defaultValue;\n    if (u === undefined) return; //throw new Error(`unit undefined`);\n    if (u.type === undefined) throw new TypeError(`Expected 'type' and 'value' fields. Type is missing`);\n    if (u.value === undefined) throw new TypeError(`Expected 'type' and 'value' fields. Value is missing`);\n\n\n    if (u.type === `px`) return u.value;\n    if (u.type === `pc`) return u.value * maxValue;\n    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n    // @ts-expect-error\n    throw new Error(`Unknown unit type: ${ u.type }`);\n  }\n\n  resolveBox(box: BoxRect | undefined): Rects.Rect | Rects.RectPositioned | undefined {\n    if (box === undefined) return undefined;\n    const x = this.resolveToPx(box.x, this.bounds.width);\n    const y = this.resolveToPx(box.y, this.bounds.height);\n    const width = this.resolveToPx(box.width, this.bounds.width);\n    const height = this.resolveToPx(box.height, this.bounds.height);\n    if (!width || !height) throw new TypeError(`Expected width and height`);\n    if (x === undefined && y === undefined) {\n      return Object.freeze({ width, height });\n    } else {\n      if (!x || !y) throw new TypeError(`Expected x and y`);\n      return Object.freeze({\n        x, y, width, height\n      });\n    }\n  }\n}\n\nexport class MeasureState extends BaseState {\n  measurements: Map<string, Measurement>;\n\n  constructor(bounds: Rects.RectPositioned) {\n    super(bounds);\n    this.measurements = new Map<string, Measurement>();\n  }\n\n  getActualSize(id: string): Rects.Rect | undefined {\n    const s = this.measurements.get(id);\n    if (s === undefined) return;\n    if (Rects.isPlaceholder(s.actual)) return;\n    return s.actual;\n  }\n\n  whatIsMeasured(): Array<string> {\n    return [ ...this.measurements.keys() ]\n  }\n}\n\nexport class LayoutState extends BaseState {\n  layouts: Map<string, Layout>;\n\n  constructor(bounds: Rects.RectPositioned) {\n    super(bounds);\n    this.layouts = new Map<string, Layout>();\n  }\n}\n/**\n * Box\n */\nexport abstract class Box {\n\n  /** Rectangle Box occupies in canvas/etc */\n  canvasRegion: Rects.RectPositioned = Rects.placeholderPositioned;\n\n  private _desiredRect: BoxRect | undefined;\n\n  protected _measuredSize: Rects.Rect | undefined;\n  protected _layoutPosition: Points.Point | undefined;\n\n  protected children: Array<Box> = [];\n  protected readonly _parent: Box | undefined;\n  private _idMap = new Map<string, Box>();\n\n  debugLayout = false;\n\n  private _visible = true;\n  protected _ready = true;\n\n  takesSpaceWhenInvisible = false;\n\n  protected _needsMeasuring = true;\n  protected _needsLayoutX = true;\n  protected _needsDrawing = true;\n\n  debugHue = randomHue();\n  readonly id: string;\n\n  /**\n   * Constructor.\n   * \n   * If `parent` is provided, `parent.onChildAdded(this)` is called.\n   * @param parent parent box \n   * @param id id of this box\n   */\n  constructor(parent: Box | undefined, id: string) {\n    this.id = id;\n    this._parent = parent;\n\n    parent?.onChildAdded(this);\n  }\n\n  /**\n   * Returns _true_ if `box` is a child\n   * @param box \n   * @returns \n   */\n  hasChild(box: Box): boolean {\n    const byReference = this.children.find((c) => c === box);\n    const byId = this.children.find((c) => c.id === box.id);\n    return byReference !== undefined || byId !== undefined;\n  }\n\n  /**\n   * Sends a message to all child boxes.\n   * \n   * This first calls `onNotify` on this instance,\n   * before calling `notify()` on each child.\n   * @param message \n   * @param source \n   */\n  notify(message: string, source: Box) {\n    this.onNotify(message, source);\n    for (const c of this.children) c.notify(message, source);\n  }\n\n  *getChildren() {\n    return this.children.entries();\n  }\n\n  /**\n   * Handles a received message\n   * @param _message \n   * @param _source \n   */\n  protected onNotify(_message: string, _source: Box) {\n    /** no-op */\n  }\n\n  /**\n   * Notification a child box has been added\n   * \n   * Throws if\n   * - child has parent as its own child\n   * - child is same as this\n   * - child is already child of this\n   * @param child \n   */\n  protected onChildAdded(child: Box) {\n    if (child.hasChild(this)) throw new Error(`Recursive`);\n    if (child === this) throw new Error(`Cannot add self as child`);\n    if (this.hasChild(child)) throw new Error(`Child already present`);\n\n    this.children.push(child);\n    this._idMap.set(child.id, child);\n\n    this.layoutInvalidated(`Box.onChildAdded`);\n  }\n\n  /**\n   * Sets `_ready` to `ready`. If `includeChildren` is _true_,\n   * `setReady` is called on each child\n   * @param ready \n   * @param includeChildren \n   */\n  setReady(ready: boolean, includeChildren = false) {\n    this._ready = ready;\n    if (includeChildren) {\n      for (const c of this.children) c.setReady(ready, includeChildren);\n    }\n  }\n\n  /**\n   * Gets visible state\n   */\n  get visible(): boolean {\n    return this._visible;\n  }\n\n  /**\n   * Sets visible state\n   */\n  set visible(v: boolean) {\n    if (this._visible === v) return;\n    this._visible = v;\n\n    // Invalidated because we skip measuring when it is invisible\n    this.layoutInvalidated(`Box.set visible`);\n  }\n\n  /**\n   * Gets the box's desired region, or _undefined_\n   */\n  get desiredRegion(): BoxRect | undefined {\n    return this._desiredRect;\n  }\n\n  /**\n   * Sets the box's desired region.\n   * Calls `onLayoutNeeded()`\n   */\n  set desiredRegion(v: BoxRect | undefined) {\n    if (boxRectIsEqual(v, this._desiredRect)) return;\n    this._desiredRect = v;\n    this.layoutInvalidated(`set desiredRegion`);\n  }\n\n  /**\n   * Calls `notifyChildLayoutNeeded`\n   */\n  layoutInvalidated(reason: string) {\n    if (reason === undefined) debugger;\n    this.debugLog(`layoutInvalidated ${ reason }`);\n    this._needsMeasuring = true;\n    this._needsLayoutX = true;\n    // TODO: Only set to true during measuring if it actually changes\n    this._needsDrawing = true;\n    this.notifyChildLayoutNeeded();\n  }\n\n  drawingInvalidated(_reason: string): void {\n    this._needsDrawing = true;\n    //this.debugLog(`drawingInvalidated ${ reason }`);\n  }\n\n  /**\n   * Called from a child, notifying us that\n   * its layout has changed\n   * @returns \n   */\n  private notifyChildLayoutNeeded() {\n    // TODO: Not all layout changes require re-layout higher up\n    this._needsDrawing = true;\n    this._needsLayoutX = true;\n    this._needsMeasuring = true;\n    if (this._parent === undefined) return;\n    this._parent.notifyChildLayoutNeeded();\n  }\n\n  /**\n   * Returns the root box\n   */\n  get root(): Box {\n    if (this._parent === undefined) return this;\n    return this._parent.root;\n  }\n\n  /**\n   * Prepare for measuring\n   */\n  protected measurePreflight() {\n    /** no-up */\n  }\n\n  /**\n   * Applies actual size, returning _true_ if size is different than before\n   * \n   * 1. Sets `_needsLayout` to _false_.\n   * 2. Sets `visual` to `m`\n   * 3. Calls `measureApply` on each child\n   * 4. If there's a change or `force`, sets `needsDrawing` to _true_, and notifies root of `measureApplied`\n   * @param m Measurement for box\n   * @param force If true forces `measureApplied` notify\n   * @returns \n   */\n  protected measureApply(m: Measurement) {\n    this._needsMeasuring = false;\n\n    const different = this._measuredSize === undefined ? true : !Rects.isEqualSize(m.actual, this._measuredSize);\n    if (different) {\n      //this.debugLog(`measureApply: Size is different than previous. Actual: ${ JSON.stringify(m.actual) } current: ${ JSON.stringify(this._measuredSize) }`);\n      this._needsLayoutX = true;\n    }\n\n    this._measuredSize = { width: m.actual.width, height: m.actual.height };\n\n    for (const c of m.children) {\n      if (c !== undefined) c.ref.measureApply(c);\n    }\n\n    if (different) {\n      this.root.notify(`measureApplied`, this);\n    }\n    return different;\n  }\n\n  protected layoutApply(l: Layout) {\n    this._needsLayoutX = false;\n\n    const different = this._layoutPosition === undefined ? true : !Points.isEqual(l.actual, this._layoutPosition);\n    // if (different) {\n    //   this.debugLog(`layoutApply. Position different than previous. ${ JSON.stringify(l.actual) }`);\n    // }\n    this._layoutPosition = { x: l.actual.x, y: l.actual.y };\n\n    for (const c of l.children) {\n      if (c !== undefined) c.ref.layoutApply(c);\n    }\n\n    if (different) {\n      this.root.notify(`layoutApplied`, this);\n    }\n    return different;\n  }\n\n  /**\n   * Debug log from this box context\n   * @param m \n   */\n  debugLog(m: any) {\n    if (!this.debugLayout) return;\n    console.log(this.id, m);\n\n  }\n\n  layoutStart(measureState: MeasureState, layoutState: LayoutState, force: boolean, parent?: Layout): Layout | undefined {\n    const m: Layout = {\n      ref: this,\n      actual: Points.Empty,\n      children: [],\n    };\n    // Stash away measurement by id\n    layoutState.layouts.set(this.id, m);\n\n    const currentPosition = this.layoutSelf(measureState, layoutState, parent);\n    this.root.notify(`laidout`, this);\n\n    // For some reason we can't measure\n    if (currentPosition === undefined) return;\n\n    // Assign\n    m.actual = currentPosition;\n\n    m.children = this.children.map((c) => c.layoutStart(measureState, layoutState, force, m));\n    if (Arrays.withoutUndefined(m.children).length < this.children.length) {\n      return undefined; // One of the children did not resolve\n    }\n    return m;\n  }\n\n  protected layoutSelf(\n    measureState: MeasureState,\n    layoutState: LayoutState,\n    _parent?: Layout\n  ): Points.Point | undefined {\n    // TODO: Proper layout\n    const box = layoutState.resolveBox(this._desiredRect);\n    const x = box === undefined ? 0 : (`x` in box ? box.x : 0);\n    const y = box === undefined ? 0 : (`y` in box ? box.y : 0);\n    if (x === undefined) debugger;\n    if (y === undefined) debugger;\n    return { x, y }\n  }\n\n  /**\n   * Start of measuring\n   * 1. Keeps track of measurements in `opts.measurements`\n   * 2. If this box takes space\n   * 2.1. Measure itself if needed\n   * 2.2. Use size\n   * 2. Calls `measureStart` on each child\n   * @param opts Options\n   * @param force \n   * @param parent Parent's measurement \n   * @returns Measurement\n   */\n  measureStart(\n    opts: MeasureState,\n    force: boolean,\n    parent?: Measurement\n  ): Measurement | undefined {\n    this.measurePreflight();\n\n    const m: Measurement = {\n      ref: this,\n      // So far no known measurement\n      actual: Rects.placeholder,\n      children: [],\n    };\n    // Stash away measurement by id\n    opts.measurements.set(this.id, m);\n\n    if (!this._visible && !this.takesSpaceWhenInvisible) {\n      // If we're not visible, there's no actual size\n      m.actual = Rects.emptyPositioned;\n    } else {\n      let currentMeasurement: Rects.Rect | string | undefined = this._measuredSize;\n\n      // If we need to, measure how big it actually is\n      if (this._needsMeasuring || this._measuredSize === undefined) {\n        currentMeasurement = this.measureSelf(opts, parent);\n        this.root.notify(`measured`, this);\n      }\n\n      // For some reason we can't measure\n      if (typeof currentMeasurement === `string`) {\n        //this.debugLog(`measureStart: measureSelf failed: ${ currentMeasurement }`);\n        return;\n      } else if (currentMeasurement === undefined) {\n        //this.debugLog(`measureStart: measureSelf failed for some other reason`);\n        return;\n      }\n\n      // Assign\n      m.actual = currentMeasurement;\n    }\n\n    m.children = this.children.map((c) => c.measureStart(opts, force, m));\n    if (Arrays.withoutUndefined(m.children).length < this.children.length) {\n      //this.debugLog(`measureStart: Child failed measureStart`);\n      return undefined; // One of the children did not resolve\n    }\n\n    return m;\n  }\n\n  /**\n   * Measure the box\n   * 1. Uses desired rectangle, if possible\n   * 2. Otherwise uses parent's size\n   * @param opts Measure state\n   * @param parent Parent size\n   * @returns \n   */\n  protected measureSelf(\n    opts: MeasureState,\n    parent?: Measurement\n  ): Rects.Rect | string {\n    let size = Rects.placeholder;\n\n    const context = parent ? parent.actual : opts.bounds;\n    const desired = opts.resolveBox(this._desiredRect);\n\n    size = desired ? Rects.clamp(desired, context) : context;\n\n    if (Rects.isPlaceholder(size)) {\n      return `Box.measureSelf - No size for box?`;\n    }\n    return size;\n  }\n\n\n  /**\n   * Gets initial state for a run of measurements & layout.\n   * \n   * Called when update() is called\n   * @param force\n   */\n  protected abstract updateBegin(context: any): [ MeasureState, LayoutState ];\n\n  protected abstract updateComplete(measureChanged: boolean, layoutChanged: boolean): void;\n\n  // protected updateDone(state: MeasureState, force: boolean): void {\n  //   this.onUpdateDone(state, force);\n  //   for (const c of this.children) c.updateDone(state, force);\n  // }\n\n  /**\n   * Update has completed\n   * @param state \n   * @param force \n   */\n  //abstract onUpdateDone(state: MeasureState, force: boolean): void;\n\n  /**\n   * Update\n   * 1. Calls `this.updateBegin()` to initialise measurement state\n   * 2. In a loop, run `measureStart()` and then `measureApply` if possible\n   * 3. Call `updateDone` when finished\n   * @param force \n   * @returns \n   */\n  update(context: object, force = false) {\n    if (context === undefined) throw new Error(`context is undefined`);\n\n    if (!this._needsMeasuring && !this._needsLayoutX && !force) return;\n    const [ measureState, layoutState ] = this.updateBegin(context);\n    let attempts = 5;\n    let measureApplied = false;\n    let layoutApplied = false;\n\n    // Measure everything\n    if (this._needsMeasuring || force) {\n      //this.debugLog(`update: needs measuring (force: ${ force }) bounds: ${ JSON.stringify(measureState.bounds) }`);\n      while (attempts--) {\n        const m = this.measureStart(measureState, force);\n        if (m !== undefined) {\n          // Apply measurements\n          this.measureApply(m);\n          if (!this._ready) return;\n          measureApplied = true;\n        }\n      }\n      //this.updateDone(state, force);\n      if (!measureApplied) this.debugLog(`Ran out of measurement attempts`);\n    }\n\n    // Lay it out\n    if (this._needsLayoutX || force) {\n      const p = this.layoutStart(measureState, layoutState, force);\n      if (p === undefined) {\n        this.debugLog(`Warning: could not layout`);\n      } else {\n        this.layoutApply(p);\n        layoutApplied = true;\n      }\n    }\n    this.updateComplete(measureApplied, layoutApplied);\n  }\n}\n\n/**\n * Canvas measure state\n */\nexport class CanvasMeasureState extends MeasureState {\n  readonly ctx: CanvasRenderingContext2D;\n  constructor(bounds: Rects.RectPositioned, ctx: CanvasRenderingContext2D) {\n    super(bounds);\n    this.ctx = ctx;\n    if (ctx === undefined) throw new Error(`ctx is undefined`);\n  }\n}\n\nexport class CanvasLayoutState extends LayoutState {\n  readonly ctx: CanvasRenderingContext2D;\n  constructor(bounds: Rects.RectPositioned, ctx: CanvasRenderingContext2D) {\n    super(bounds);\n    this.ctx = ctx;\n    if (ctx === undefined) throw new Error(`ctx is undefined`);\n\n  }\n}\n\n/**\n * A Box that exists on a HTMLCanvasElement\n */\nexport class CanvasBox extends Box {\n  readonly bounds: Rects.RectPositioned | undefined;\n  constructor(\n    parent: CanvasBox | undefined,\n    //canvasElement: HTMLCanvasElement,\n    id: string,\n    bounds?: Rects.RectPositioned\n  ) {\n    super(parent, id);\n    this.bounds = bounds;\n    this.debugLog(`CanvasBox ctor bounds: ${ JSON.stringify(bounds) }`);\n  }\n\n  static fromCanvas(canvasElement: HTMLCanvasElement): CanvasBox {\n    const box = new CanvasBox(undefined, `canvas-box`, canvasElement.getBoundingClientRect());\n    return box;\n  }\n\n  /**\n   * Called if this is the parent Box\n   */\n  public addEventHandlers(element: HTMLElement) {\n    element.addEventListener(`pointermove`, (event) => {\n      const p = { x: event.offsetX, y: event.offsetY };\n      this.notifyPointerMove(p);\n    });\n\n    element.addEventListener(`pointerleave`, (_event) => {\n      this.notifyPointerLeave();\n    });\n\n    element.addEventListener(`click`, (event) => {\n      const p = { x: event.offsetX, y: event.offsetY };\n      this.notifyClick(p);\n    });\n  }\n\n  protected onClick(_p: Points.Point) {\n    /** no-up */\n  }\n\n  /**\n   * Click event has happened on canvas\n   * 1. If it's within our range, call `onClick` and pass to all children via `notifyClick`\n   * @param p \n   * @returns \n   */\n  private notifyClick(p: Points.Point) {\n    if (Rects.isPlaceholder(this.canvasRegion)) return;\n    if (Rects.intersectsPoint(this.canvasRegion, p)) {\n      const pp = Points.subtract(p, this.canvasRegion.x, this.canvasRegion.y);\n      this.onClick(pp);\n      // TODO: Only call `notifyClick` if child is within range?\n      for (const c of this.children) (c as CanvasBox).notifyClick(pp);\n    }\n  }\n\n  /**\n   * Pointer has left\n   * 1. Pass notification to all children via `notifyPointerLeave`\n   */\n  private notifyPointerLeave() {\n    this.onPointerLeave();\n    for (const c of this.children) (c as CanvasBox).notifyPointerLeave();\n  }\n\n  /**\n   * Pointer has moved\n   * 1. If it's within range `onPointerMove` is called, and pass on to all children via `notifyPointerMove`\n   * @param p \n   * @returns \n   */\n  private notifyPointerMove(p: Points.Point) {\n    if (Rects.isPlaceholder(this.canvasRegion)) return;\n    if (Rects.intersectsPoint(this.canvasRegion, p)) {\n      const pp = Points.subtract(p, this.canvasRegion.x, this.canvasRegion.y);\n      this.onPointerMove(pp);\n      for (const c of this.children) (c as CanvasBox).notifyPointerMove(pp);\n    }\n  }\n\n  /**\n   * Handler when pointer has left\n   */\n  protected onPointerLeave() {\n    /** no-up */\n  }\n\n  /**\n   * Handler when pointer moves within our region\n   * @param _p \n   */\n  protected onPointerMove(_p: Points.Point) {\n    /** no-up */\n\n  }\n\n  /**\n   * Performs recalculations and drawing as necessary\n   * If nothing needs to happen, function returns.\n   * @param context \n   * @param force \n   */\n  update(context: CanvasRenderingContext2D, force = false) {\n    super.update(context, force);\n    this.draw(context, force);\n  }\n\n  getBounds(): Rects.RectPositioned | undefined {\n    return this.bounds === undefined && this._parent ? (this._parent as CanvasBox).bounds : this.bounds;\n  }\n\n  /**\n   * Update begins.\n   * @returns MeasureState\n   */\n  protected updateBegin(context: CanvasRenderingContext2D): [ MeasureState, LayoutState ] {\n    if (context === undefined) throw new Error(`Context is undefined`);\n    let bounds = this.getBounds();\n    //this.debugLog(`updateBegin bounds: ${ JSON.stringify(bounds) } measured: ${ JSON.stringify(this._measuredSize) }`);\n\n    if (bounds === undefined) {\n      this.debugLog(`No bounds for element or parent, using canvas bounds`);\n      bounds = { x: 0, y: 0, width: context.canvas.width, height: context.canvas.height }\n    }\n    return [\n      new CanvasMeasureState(bounds, context),\n      new CanvasLayoutState(bounds, context)\n    ]\n    // if (this.region) {\n    //   return new CanvasMeasureState(this.region);\n    // } else {\n    //   const s = this.canvasEl.getBoundingClientRect();\n\n    //   return new CanvasMeasureState(\n    //     {\n    //       x: 0,\n    //       y: 0,\n    //       width: s.width,\n    //       height: s.height,\n    //     },\n    //     ctx\n    //   );\n    // }\n  }\n\n  protected updateComplete(_measureChanged: boolean, _layoutChanged: boolean): void {\n    //this.debugLog(`updateComplete. measureChanged: ${ _measureChanged } layoutChanged: ${ _layoutChanged } pos: ${ JSON.stringify(this._layoutPosition) }`);\n    this.canvasRegion = Rects.placeholderPositioned;\n  }\n\n  protected measureApply(m: Measurement): boolean {\n    const different = super.measureApply(m);\n    if (different) this.canvasRegion = Rects.placeholderPositioned;\n    return different;\n  }\n\n  protected layoutApply(l: Layout): boolean {\n    const different = super.layoutApply(l);\n    if (different) this.canvasRegion = Rects.placeholderPositioned;\n    return different;\n  }\n\n  public draw(ctx: CanvasRenderingContext2D, force = false) {\n    //this.debugLog(`draw. needs drawing: ${ this._needsDrawing } force: ${ force } pos: ${ JSON.stringify(this._layoutPosition) } size: ${ JSON.stringify(this._measuredSize) }`);\n\n    // if (!this._needsDrawing && !force) return;\n\n    if (this._needsDrawing || force) {\n      if (Rects.isPlaceholder(this.canvasRegion)) {\n        if (this._layoutPosition === undefined) return;\n        if (this._measuredSize === undefined) return;\n        this.canvasRegion = {\n          x: this._layoutPosition.x,\n          y: this._layoutPosition.y,\n          width: this._measuredSize.width,\n          height: this._measuredSize.height\n        }\n      }\n\n      //this.debugLog(`draw: canvasRegion: ${ JSON.stringify(this.canvasRegion) }`);\n      if (this._needsLayoutX || this._needsMeasuring) {\n        //this.debugLog(`draw: warning: drawing with outdated layout / measurements`);\n      }\n      ctx.save();\n      const v = this.canvasRegion;\n      ctx.translate(v.x, v.y);\n\n      if (this.debugLayout) {\n        //ctx.clearRect(0,0,v.width,v.height);\n\n        ctx.lineWidth = 1;\n        ctx.strokeStyle = `hsl(${ this.debugHue }, 100%, 50%)`;\n\n        //ctx.fillStyle = ctx.strokeStyle;\n        //ctx.fillRect(0,0,v.width,v.height);\n\n        ctx.strokeRect(0, 0, v.width, v.height);\n\n        ctx.fillStyle = ctx.strokeStyle;\n        ctx.fillText(this.id, 10, 10, v.width);\n\n        ctx.beginPath();\n        ctx.moveTo(0, 0);\n        ctx.lineTo(v.width, v.height);\n        ctx.stroke();\n      }\n\n      this.drawSelf(ctx);\n\n      this._needsDrawing = false;\n      ctx.restore();\n    }\n    for (const c of this.children) {\n      (c as CanvasBox).draw(ctx, force)\n    }\n  }\n\n  /**\n   * Draw this object\n   * @param _ctx \n   */\n  protected drawSelf(_ctx: CanvasRenderingContext2D): void {\n    /** no-up */\n  }\n}\n","/** Utilities for working with immutable objects */\n\nimport { untilMatch } from \"./Text.js\"\nimport JSON5 from 'json5';\nimport { isPlainObjectOrPrimitive } from \"./Util.js\";\n/**\n * Return _true_ if `a` and `b` ought to be considered equal\n * at a given path\n */\nexport type IsEqualContext<V> = (a: V, b: V, path: string) => boolean\n\n/**\n * Returns _true_ if `a` and `b are equal based on their JSON representations.\n * `path` is ignored.\n * @param a \n * @param b \n * @param path \n * @returns \n */\nexport const isEqualContextString: IsEqualContext<any> = (a: any, b: any, _path: string): boolean => {\n  // if (!isPlainObject(a)) throw new Error(`Parameter 'a' is not a plain object`);\n  // if (!isPlainObject(b)) throw new Error(`Parameter 'b' is not a plain object`);\n\n  return JSON5.stringify(a) === JSON5.stringify(b);\n}\n\nexport type Change<V> = {\n  path: string\n  previous?: V\n  value: V\n}\n\nexport type CompareDataOptions<V> = {\n  /**\n   * Comparison function for values. By default uses\n   * JSON.stringify() to compare by value.\n   */\n  eq: IsEqualContext<V>\n  /**\n   * If true, inherited fields are also compared.\n   * This is necessary for events, for example.\n   * \n   * Only plain-object values are used, the other keys are ignored.\n   */\n  deepEntries: boolean\n}\n\n/**\n * Scans object, producing a list of changed fields.\n * \n * @param a \n * @param b \n * @param pathPrefix \n * @returns \n */\nexport const compareData = <V extends Record<string, any>>(a: V, b: V, pathPrefix = ``, options: Partial<CompareDataOptions<V>> = {}): Array<Change<any>> => {\n\n  const deepProbe = options.deepEntries ?? false;\n  const eq = options.eq ?? isEqualContextString;\n  const changes: Array<Change<any>> = [];\n\n  let entries: Array<[ key: string, value: any ]> = [];\n  if (deepProbe) {\n    for (const field in a) {\n      const value = (a as any)[ field ];\n      if (isPlainObjectOrPrimitive(value as unknown)) {\n        entries.push([ field, value ]);\n      }\n    }\n  } else {\n    entries = Object.entries(a);\n  }\n  const isArray = Array.isArray(a);\n\n  for (const [ key, valueA ] of entries) {\n    if (typeof valueA === `object`) {\n      changes.push(...compareData(valueA, b[ key ], key + `.`, options));\n    } else {\n      const valueB = b[ key ];\n      const sub = isArray ? untilMatch(pathPrefix, `.`, { fromEnd: true }) + `[${ key }]` : pathPrefix + key;\n\n      if (!eq(valueA, valueB, sub)) {\n        changes.push({ path: sub, previous: valueA, value: valueB });\n      }\n    }\n  }\n  return changes;\n}\n\n/**\n * Returns a copy of `a` with changes applied.\n * @param a \n * @param changes \n */\nexport const applyChanges = <V extends Record<string, any>>(a: V, changes: Array<Change<any>>): V => {\n  for (const change of changes) {\n    a = updateByPath(a, change.path, change.value);\n  }\n  return a;\n}\n\n/**\n * Returns a copy of an object with a specified path changed to `value`.\n * \n * ```js\n * const a = {\n *  message: `Hello`,\n *  position: { x: 10, y: 20 }\n * }\n * \n * const a1 = updateByPath(a, `message`, `new message`);\n * const a2 = updateByPath(a, `position.x`, 20);\n * ```\n * \n * If the path cannot be resolved, an exception is thrown\n * @param o \n * @param path \n * @param value \n * @returns \n */\nexport const updateByPath = <V extends Record<string, any>>(o: V, path: string, value: any, createIfNecessary = false): V => {\n  if (path === undefined) throw new Error(`Parameter 'path' is undefined`);\n  if (typeof path !== `string`) throw new Error(`Parameter 'path' should be a string. Got: ${ typeof path }`);\n  if (o === undefined) throw new Error(`Parameter 'o' is undefined`);\n  if (o === null) throw new Error(`Parameter 'o' is null`);\n\n  const split = path.split(`.`);\n  const r = updateByPathImpl(o, split, value, createIfNecessary);\n  return r as V;\n}\n\nconst updateByPathImpl = (o: any, split: Array<string>, value: any, createIfNecessary: boolean): any => {\n  if (split.length === 0) return value;\n\n  const start = split.shift();\n  if (!start) return value;\n\n  const arrayStart = start.indexOf(`[`);\n  const arrayEnd = start.indexOf(`]`, arrayStart);\n  if (arrayStart > 0 && arrayEnd > arrayStart) {\n    const field = start.slice(0, arrayStart);\n    const index = start.slice(arrayStart, arrayEnd + 1);\n    split.unshift(index);\n    const copy = { ...o };\n    copy[ field ] = updateByPathImpl(copy[ field ], split, value, createIfNecessary);\n    return copy;\n  }\n\n  if (start.startsWith(`[`) && start.endsWith(`]`) && Array.isArray(o)) {\n    const index = Number.parseInt(start.slice(1, -1));\n    const copy = [ ...o ];\n    copy[ index ] = updateByPathImpl(copy[ index ], split, value, createIfNecessary);\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return copy;\n  } else if (start in o) {\n    const copy = { ...o };\n    copy[ start ] = updateByPathImpl(copy[ start ], split, value, createIfNecessary);\n    return copy;\n  } else {\n    throw new Error(`Path ${ start } not found in data`);\n  }\n}\n\nexport const getField = <V>(o: Record<string, any>, path: string): V => {\n  if (typeof path !== `string`) throw new Error(`Path ought to be a string`);\n  if (path.length === 0) throw new Error(`Path is empty`);\n  if (o === undefined) throw new Error(`Parameter 'o' is undefined`);\n  if (o === null) throw new Error(`Parameter 'o' is null`);\n\n  const split = path.split(`.`);\n  const v = getFieldImpl<V>(o, split);\n  return v;\n}\n\nconst getFieldImpl = <V>(o: Record<string, any>, split: Array<string>): V => {\n  if (split.length === 0) throw new Error(`Path run out`);\n  const start = split.shift();\n  if (!start) throw new Error(`Unexpected empty split`);\n  const arrayStart = start.indexOf(`[`);\n  const arrayEnd = start.indexOf(`]`, arrayStart);\n  if (arrayStart > 0 && arrayEnd > arrayStart) {\n    // Only look for 'field[X]', not '[X]', which is caught later...\n    const field = start.slice(0, arrayStart);\n    const index = start.slice(arrayStart, arrayEnd + 1);\n    split.unshift(index);\n\n    return getFieldImpl(o[ field ], split);\n  }\n\n  if (arrayStart === 0 && arrayEnd === start.length - 1 && Array.isArray(o)) {\n    const index = Number.parseInt(start.slice(1, -1));\n    // eslint-disable-next-line unicorn/prefer-ternary\n    if (split.length === 0) {\n      return o[ index ] as V;\n    } else {\n      return getFieldImpl(o[ index ], split);\n    }\n  } else if (start in o) {\n    // eslint-disable-next-line unicorn/prefer-ternary\n    if (split.length === 0) {\n      return o[ start ] as V;\n    } else {\n      return getFieldImpl(o[ start ], split);\n    }\n  } else {\n    throw new Error(`Path ${ start } not found in data`);\n  }\n}\n\n/**\n * Maps the properties of an object through a map function.\n * That is, run each of the values of an object through a function, an return\n * the result.\n *\n * @example Double the value of all fields\n * ```js\n * const rect = { width: 100, height: 250 };\n * const doubled = mapObject(rect, (fieldValue) => {\n *  return fieldValue*2;\n * });\n * // Yields: { width: 200, height: 500 }\n * ```\n *\n * Since the map callback gets the name of the property, it can do context-dependent things.\n * ```js\n * const rect = { width: 100, height: 250, colour: 'red' }\n * const doubled = mapObject(rect, (fieldValue, fieldName) => {\n *  if (fieldName === 'width') return fieldValue*3;\n *  else if (typeof fieldValue === 'number') return fieldValue*2;\n *  return fieldValue;\n * });\n * // Yields: { width: 300, height: 500, colour: 'red' }\n * ```\n * In addition to bulk processing, it allows remapping of property types.\n *\n * In terms of typesafety, the mapped properties are assumed to have the\n * same type.\n *\n * ```js\n * const o = {\n *  x: 10,\n *  y: 20,\n *  width: 200,\n *  height: 200\n * }\n *\n * // Make each property use an averager instead\n * const oAvg = mapObject(o, (value, key) => {\n *  return movingAverage(10);\n * });\n *\n * // Add a value to the averager\n * oAvg.x.add(20);\n * ```\n */\nexport const map = <\n  SourceType extends Record<string, any>,\n  DestinationFieldType,\n>(\n  // eslint-disable-next-line indent\n  object: SourceType,\n  // eslint-disable-next-line indent\n  mapFunction: (fieldValue: any, field: string, index: number) => DestinationFieldType\n  // eslint-disable-next-line indent\n): RemapObjectPropertyType<SourceType, DestinationFieldType> => {\n  type MapResult = [ field: string, value: DestinationFieldType ];\n  const entries = Object.entries(object);\n  const mapped = entries.map(([ sourceField, sourceFieldValue ], index) => [\n    sourceField,\n    mapFunction(sourceFieldValue, sourceField, index),\n  ]) as Array<MapResult>;\n  // @ts-expect-error\n  return Object.fromEntries(mapped);\n};\n\nexport type RemapObjectPropertyType<OriginalType, PropertyType> = {\n  readonly [ Property in keyof OriginalType ]: PropertyType;\n};\n\n/**\n * Returns a list of paths for all the fields on `o`\n * ```\n * const d = {\n *  accel: {x: 1, y: 2, z: 3},\n *  gyro:  {x: 4, y: 5, z: 6}\n * };\n * const paths = getFieldPaths(d);\n * // Yields [ `accel`, `gyro`, `accel.x`, `accel.y`,`accel.z`,`gyro.x`,`gyro.y`,`gyro.z` ]\n * ```\n *\n * Use {@link getFieldByPath} to fetch data by this 'path' string.\n *\n * If object is _null_, and empty array is returned.\n * \n * If `onlyLeaves` is _true_, only leaf nodes are included. _False_ by default.\n * If it was set to _true_, 'accel' and 'gyro' would not be included.\n *\n * @param o\n * @returns\n */\nexport const getPaths = (o: object | null, onlyLeaves = false): ReadonlyArray<string> => {\n  if (o === null) return [];\n  if (typeof o !== `object`) {\n    throw new TypeError(`Parameter 'o' should be an object. Got: ${ typeof o }`);\n  }\n\n  // Probe a given object, with a set of initial paths and prefix\n  const probe = (o: object, initialPaths: ReadonlyArray<string>, prefix: string): ReadonlyArray<string> => {\n    if (typeof o !== `object`) {\n      return [ ...initialPaths, prefix ];\n    } else if (prefix.length > 0 && !onlyLeaves) {\n      initialPaths = [ ...initialPaths, prefix ];\n    }\n\n    const prefixToUse = (prefix.length > 0) ? prefix + `.` : prefix;\n    const keys = Object.keys(o);\n    const x = keys.map(key => {\n      const value = (o as any)[ key ];\n      const keyName = Array.isArray(o) ? untilMatch(prefixToUse, `.`, { fromEnd: true }) + `[${ key }]` : prefixToUse + key\n      return probe(value, [], keyName)\n    });\n\n    //eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return [ ...x, initialPaths ].flat();\n  };\n  return probe(o, [], ``);\n};\n\n/**\n * Returns a representation of the object\n * @param o \n * @returns \n */\nexport const getPathsAndData = (o: object): Array<Change<any>> => {\n  if (o === null) return [];\n  if (o === undefined) return [];\n  const result: Array<Change<any>> = [];\n  getPathsAndDataImpl(o, ``, result);\n  return result;\n}\n\n// something.value = 10\n// something.deep.colour = `red`\n// something.deep.array[0] = 1\n// something.deep.array[1] = 2\n// export const fromChanges = (changes: Array<Change<any>>): Record<string, any> => {\n//   const paths = changes.map(change => ({ path: change.path, split: change.path.split(`.`), value: change.value }));\n//   const maxPathLength = Math.max(...paths.map(p => p.split.length));\n\n//   const getArrayIndex = (segment: string): number => {\n//     if (segment.endsWith(`]`)) {\n//       const bracketStart = segment.indexOf(`[`);\n//       if (bracketStart <= 0) throw new Error(`Segment contains closing ] but not starting. Segment: ${ segment }`);\n//       const index = Number.parseInt(segment.slice(bracketStart, -1));\n//       return index;\n//     }\n//     return -1;\n//   }\n\n//   let index = maxPathLength - 1;\n//   let returnData: Record<string, any> = {};\n//   while (index >= 0) {\n//     const addingTo: Record<string, any> = {};\n//     const currentArray = [];\n//     for (const path of paths) {\n//       // This particular change doesn't have a path so deep\n//       if (path.split.length < index) continue;\n\n//       if (path.split.length === index + 1) {\n//         // We're at the end of the split -- must be a value to set\n//         const arrayIndex = getArrayIndex(path.split[ index ]);\n//         if (arrayIndex >= 0) {\n//           currentArray[ arrayIndex ] = path.value;\n//         } else {\n//           // Plain field\n//           // addingTo[`colour`] = red\n//           addingTo[ path.split[ index ] ] = path.value;\n//         }\n//       } else {\n//         // A value to carry forward from previously\n\n//       }\n//     }\n//     if (currentArray.length > 0) {\n//       // addingTo[`array`] = [...]\n//       addingTo[ paths[ 0 ].split[ index ] ] = currentArray;\n//     }\n//     index--;\n//     if (index >= 0) {\n//       returnData\n//     }\n//   }\n// }\n\nconst getPathsAndDataImpl = (o: object, prefix: string, result: Array<Change<any>>) => {\n  const isArray = Array.isArray(o);\n  if (typeof o === `object`) {\n    for (const entries of Object.entries(o)) {\n      let sub = prefix + (!isArray && prefix.length > 0 ? `.` : ``);\n      if (isArray) sub += `[`;\n      sub += entries[ 0 ];\n      if (isArray) sub += `]`;\n\n      result.push({ path: sub, value: entries[ 1 ] });\n      getPathsAndDataImpl(entries[ 1 ], sub, result);\n    }\n  } else {\n    //result.push({ path: prefix, value: o });\n  }\n  return result;\n}","/**\n * Manage a set of colours. Uses CSS variables as a fallback if colour is not added\n *\n */\nexport type Palette = {\n  setElementBase(el: Element): void;\n  has(key: string): boolean;\n\n  /**\n   * Returns a colour by name.\n   *\n   * If the colour is not found:\n   *  1. Try to use a CSS variable `--key`, or\n   *  2. The next fallback colour is used (array cycles)\n   *\n   * @param key\n   * @returns\n   */\n  get(key: string, fallback?: string): string;\n\n  /**\n   * Gets a colour by key, adding and returning fallback if not present\n   * @param key Key of colour\n   * @param fallback Fallback colour if key is not found\n   */\n  getOrAdd(key: string, fallback?: string): string;\n\n  /**\n   * Adds a colour with a given key\n   *\n   * @param key\n   * @param colour\n   */\n  add(key: string, value: string): void;\n\n  alias(from: string, to: string): void;\n};\n\nexport const create = (fallbacks?: readonly string[]): Palette =>\n  new PaletteImpl(fallbacks);\n\nclass PaletteImpl {\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  readonly #store: Map<string, string> = new Map();\n  /* eslint-disable-next-line functional/prefer-readonly-type */\n  readonly #aliases: Map<string, string> = new Map();\n\n  readonly fallbacks: readonly string[];\n  #lastFallback = 0;\n\n  #elementBase: Element;\n\n  constructor(fallbacks?: readonly string[]) {\n    if (fallbacks !== undefined) this.fallbacks = fallbacks;\n    else this.fallbacks = [`red`, `blue`, `green`, `orange`];\n    this.#elementBase = document.body;\n  }\n\n  setElementBase(el: Element) {\n    this.#elementBase = el;\n  }\n\n  add(key: string, colour: string) {\n    this.#store.set(key, colour);\n  }\n\n  alias(from: string, to: string) {\n    this.#aliases.set(from, to);\n  }\n\n  get(key: string, fallback?: string): string {\n    const alias = this.#aliases.get(key);\n    if (alias !== undefined) key = alias;\n\n    const c = this.#store.get(key);\n    if (c !== undefined) return c;\n\n    const varName = `--` + key;\n    // eslint-disable-next-line functional/no-let\n    let fromCss = getComputedStyle(this.#elementBase)\n      .getPropertyValue(varName)\n      .trim();\n\n    // Not found\n    if (fromCss === undefined || fromCss.length === 0) {\n      if (fallback !== undefined) return fallback;\n      fromCss = this.fallbacks[this.#lastFallback];\n      this.#lastFallback++;\n      if (this.#lastFallback === this.fallbacks.length) this.#lastFallback = 0;\n    }\n    return fromCss;\n  }\n\n  getOrAdd(key: string, fallback?: string): string {\n    if (this.has(key)) return this.get(key);\n    const c = this.get(key, fallback);\n    this.add(key, c);\n    return c;\n  }\n\n  has(key: string): boolean {\n    return this.#store.has(key);\n  }\n}\n","import * as Grids from '../geometry/Grid.js';\nimport type { Rgb } from './Colour.js';\n\nexport const accessor = (image: ImageData): Grids.CellAccessor<Rgb> => {\n  const grid = { rows: image.width, cols: image.height };\n  const data = image.data;\n\n  const fn: Grids.CellAccessor<Rgb> = (cell: Grids.Cell, bounds) => {\n    const index = Grids.indexFromCell(grid, cell, bounds);\n    if (index === undefined) {\n      return undefined;\n    }\n    const pxIndex = index * 4;\n    return {\n      r: data[pxIndex],\n      g: data[pxIndex + 1],\n      b: data[pxIndex + 2],\n      opacity: data[pxIndex + 3],\n    };\n  };\n  return fn;\n};\n","import { Rects, Points } from './index.js';\nimport { throwIntegerTest, throwNumberTest } from '../Guards.js';\nimport { clampIndex } from '../data/Clamp.js';\nimport { randomElement } from '../collections/Arrays.js';\nimport { type ISetMutable, mutable } from '../collections/set/index.js';\nimport { zipKeyValue } from '../collections/map/index.js';\n\nexport type GridVisual = Grid & {\n  readonly size: number;\n};\n\nexport type Grid = {\n  readonly rows: number;\n  readonly cols: number;\n};\n\nexport type Cell = {\n  readonly x: number;\n  readonly y: number;\n};\n\nexport type Neighbours = {\n  readonly n: Cell | undefined;\n  readonly e: Cell | undefined;\n  readonly s: Cell | undefined;\n  readonly w: Cell | undefined;\n  readonly ne: Cell | undefined;\n  readonly nw: Cell | undefined;\n  readonly se: Cell | undefined;\n  readonly sw: Cell | undefined;\n};\n\nexport type CardinalDirection =\n  | `n`\n  | `ne`\n  | `e`\n  | `se`\n  | `s`\n  | `sw`\n  | `w`\n  | `nw`;\nexport type CardinalDirectionOptional = CardinalDirection | ``;\n\nexport type BoundsLogic = `unbounded` | `undefined` | `stop` | `wrap`;\n\nexport type VisitorLogic = {\n  readonly options?: IdentifyNeighbours;\n  readonly select: NeighbourSelector;\n};\nexport type VisitGenerator = Generator<Readonly<Cell>, void, unknown>;\nexport type VisitorOpts = {\n  readonly visited?: ISetMutable<Cell>;\n  readonly reversed?: boolean;\n  readonly debug?: boolean;\n  readonly boundsWrap?: BoundsLogic;\n};\n\n/**\n * Visitor function.\n *\n * Implementations:\n * * {@link cells}: left-to-right, top-to-bottom. Same as {@link visitorRow}\n * * {@link visitorBreadth}, {@link visitorDepth}\n * * {@link visitorColumn}: top-to-bottom, left-to-right.\n * * {@link visitorRandom}: Any unvisited location\n * * {@link visitorRandomContiguous}: A random direct neighbour of current cell\n */\nexport type Visitor = (\n  grid: Grid,\n  start: Cell,\n  opts?: VisitorOpts\n) => VisitGenerator;\n\nexport type NeighbourMaybe = readonly [ keyof Neighbours, Cell | undefined ];\nexport type Neighbour = readonly [ keyof Neighbours, Cell ];\n\n/**\n * A function that returns a value (or _undefined_) based on a _cell_\n *\n * Implementations:\n * * {@link access1dArray}: For accessing a single-dimension array as a grid\n */\nexport type CellAccessor<V> = (cell: Cell, wrap: BoundsLogic) => V | undefined;\n\n/**\n * Neighbour selector logic. For a given set of `neighbours` pick one to visit next.\n */\nexport type NeighbourSelector = (\n  neighbours: ReadonlyArray<Neighbour>\n) => Neighbour | undefined;\n\n/**\n * Identify neighbours logic. For a given `grid` and `origin`, return a list of neighbours\n */\nexport type IdentifyNeighbours = (\n  grid: Grid,\n  origin: Cell\n) => ReadonlyArray<Neighbour>;\n\n/**\n * Returns true if `cell` parameter is a cell with x,y fields.\n * Does not check validity of fields.\n *\n * @param cell\n * @return True if parameter is a cell\n */\nconst isCell = (cell: Cell | undefined): cell is Cell => {\n  if (cell === undefined) return false;\n  return `x` in cell && `y` in cell;\n};\n\n/**\n * Returns true if `n` is a Neighbour type, eliminating NeighbourMaybe possibility\n *\n * @param n\n * @return\n */\nconst isNeighbour = (\n  n: Neighbour | NeighbourMaybe | undefined\n): n is Neighbour => {\n  if (n === undefined) return false;\n  if (n[ 1 ] === undefined) return false;\n  return true;\n};\n\n/**\n * Returns _true_ if grids `a` and `b` are equal in value.\n * Returns _false_ if either parameter is undefined.\n *\n * @param a\n * @param b\n * @return\n */\nexport const isEqual = (\n  a: Grid | GridVisual,\n  b: Grid | GridVisual\n): boolean => {\n  if (b === undefined) return false;\n  if (a === undefined) return false;\n  if (`rows` in a && `cols` in a) {\n    if (`rows` in b && `cols` in b) {\n      if (a.rows !== b.rows || a.cols !== b.cols) return false;\n    } else return false;\n  }\n  if (`size` in a) {\n    if (`size` in b) {\n      if (a.size !== b.size) return false;\n    } else return false;\n  }\n  return true;\n};\n\n/**\n * Returns a key string for a cell instance\n * A key string allows comparison of instances by value rather than reference\n *\n * ```js\n * cellKeyString({x:10,y:20});\n * // Yields: \"Cell{10,20}\";\n * ```\n * @param v\n * @returns\n */\nexport const cellKeyString = (v: Cell): string => `Cell{${ v.x },${ v.y }}`;\n\n/**\n * Returns _true_ if two cells equal.\n * Returns _false_ if either cell are undefined\n *\n * @param a\n * @param b\n * @returns\n */\nexport const cellEquals = (\n  a: Cell | undefined,\n  b: Cell | undefined\n): boolean => {\n  if (b === undefined) return false;\n  if (a === undefined) return false;\n  return a.x === b.x && a.y === b.y;\n};\n\n/**\n * Throws an exception if any of the cell's parameters are invalid\n * @private\n * @param cell\n * @param paramName\n * @param grid\n */\nexport const guardCell = (\n  cell: Cell,\n  paramName: string = `Param`,\n  grid?: Grid\n) => {\n  if (cell === undefined) {\n    throw new Error(paramName + ` is undefined. Expecting {x,y}`);\n  }\n  if (cell.x === undefined) throw new Error(paramName + `.x is undefined`);\n  if (cell.y === undefined) throw new Error(paramName + `.y is undefined`);\n  if (Number.isNaN(cell.x)) throw new Error(paramName + `.x is NaN`);\n  if (Number.isNaN(cell.y)) throw new Error(paramName + `.y is NaN`);\n  if (!Number.isInteger(cell.x)) {\n    throw new TypeError(paramName + `.x is non-integer`);\n  }\n  if (!Number.isInteger(cell.y)) {\n    throw new TypeError(paramName + `.y is non-integer`);\n  }\n  if (grid !== undefined) {\n    if (!inside(grid, cell)) {\n      throw new Error(\n        `${ paramName } is outside of grid. Cell: ${ cell.x },${ cell.y } Grid: ${ grid.cols }, ${ grid.rows }`\n      );\n    }\n  }\n};\n\n/**\n * Throws an exception if any of the grid's parameters are invalid\n * @param grid\n * @param paramName\n */\nconst guardGrid = (grid: Grid, paramName: string = `Param`) => {\n  if (grid === undefined) {\n    throw new Error(`${ paramName } is undefined. Expecting grid.`);\n  }\n  if (!(`rows` in grid)) throw new Error(`${ paramName }.rows is undefined`);\n  if (!(`cols` in grid)) throw new Error(`${ paramName }.cols is undefined`);\n\n  if (!Number.isInteger(grid.rows)) {\n    throw new TypeError(`${ paramName }.rows is not an integer`);\n  }\n  if (!Number.isInteger(grid.cols)) {\n    throw new TypeError(`${ paramName }.cols is not an integer`);\n  }\n};\n\n/**\n * Returns _true_ if cell coordinates are above zero and within bounds of grid\n *\n * @param grid\n * @param cell\n * @return\n */\nexport const inside = (grid: Grid, cell: Cell): boolean => {\n  if (cell.x < 0 || cell.y < 0) return false;\n  if (cell.x >= grid.cols || cell.y >= grid.rows) return false;\n  return true;\n};\n\n/**\n * Returns a visual rectangle of the cell, positioned from the top-left corner\n *\n * ```js\n * const cell = { x: 1, y: 0 };\n *\n * // 5x5 grid, each cell 5px in size\n * const grid = { rows: 5, cols: 5, size: 5 }\n *\n * const r = rectangleForCell(grid, cell,);\n *\n * // Yields: { x: 5, y: 0, width: 5, height: 5 }\n * ```\n * @param cell\n * @param grid\n * @return\n */\nexport const rectangleForCell = (\n  grid: GridVisual,\n  cell: Cell\n): Rects.RectPositioned => {\n  guardCell(cell);\n  const size = grid.size;\n  const x = cell.x * size;\n  const y = cell.y * size;\n  const r = Rects.fromTopLeft({ x: x, y: y }, size, size);\n  return r;\n};\n\n/**\n * Generator that returns rectangles for each cell in a grid\n *\n * @example Draw rectangles\n * ```js\n * import { Drawing } from 'visuals.js'\n * const rects = [...Grids.asRectangles(grid)];\n * Drawing.rect(ctx, rects, { strokeStyle: `silver`});\n * ```\n * @param grid\n */\nexport function* asRectangles(\n  grid: GridVisual\n): IterableIterator<Rects.RectPositioned> {\n  for (const c of cells(grid)) {\n    yield rectangleForCell(grid, c);\n  }\n}\n\n/**\n * Returns a two-dimensional array according to `grid`\n * size.\n *\n * ```js\n * const a = Grids.toArray({ rows: 3, cols: 2 });\n * Yields:\n * [ [_,_] ]\n * [ [_,_] ]\n * [ [_,_] ]\n * ```\n *\n * `initialValue` can be provided to set the value\n * for all cells.\n * @param grid\n * @param initialValue\n * @returns\n */\n//eslint-disable-next-line functional/prefer-readonly-type\nexport const toArray = <V>(grid: Grid, initialValue?: V): V[][] => {\n  const ret = [];\n  //eslint-disable-next-line functional/no-let\n  for (let row = 0; row < grid.rows; row++) {\n    //eslint-disable-next-line functional/immutable-data\n    ret[ row ] = new Array<V>(grid.cols);\n    if (initialValue) {\n      //eslint-disable-next-line functional/no-let\n      for (let col = 0; col < grid.cols; col++) {\n        //eslint-disable-next-line functional/immutable-data\n        ret[ row ][ col ] = initialValue;\n      }\n    }\n  }\n  return ret;\n};\n\n/**\n * Returns the cell at a specified visual coordinate\n * or _undefined_ if the position is outside of the grid.\n *\n * `position` must be in same coordinate/scale as the grid.\n *\n * @param position Position, eg in pixels\n * @param grid Grid\n * @return Cell at position or undefined if outside of the grid\n */\nexport const cellAtPoint = (\n  grid: GridVisual,\n  position: Points.Point\n): Cell | undefined => {\n  const size = grid.size;\n  throwNumberTest(size, `positive`, `grid.size`);\n  if (position.x < 0 || position.y < 0) return;\n  const x = Math.floor(position.x / size);\n  const y = Math.floor(position.y / size);\n  if (x >= grid.cols) return;\n  if (y >= grid.rows) return;\n  return { x, y };\n};\n\n/**\n * Returns a list of all cardinal directions: n, ne, nw, e, s, se, sw, w\n */\nexport const allDirections = Object.freeze([\n  `n`,\n  `ne`,\n  `nw`,\n  `e`,\n  `s`,\n  `se`,\n  `sw`,\n  `w`,\n]) as ReadonlyArray<CardinalDirection>;\n\n/**\n * Returns a list of + shaped directions: n, e, s, w\n */\nexport const crossDirections = Object.freeze([\n  `n`,\n  `e`,\n  `s`,\n  `w`,\n]) as ReadonlyArray<CardinalDirection>;\n\n/**\n * Returns neighbours for a cell. If no `directions` are provided, it defaults to {@link allDirections}.\n *\n * ```js\n * const grid = { rows: 5, cols: 5 };\n * const cell = { x:2, y:2 };\n *\n * // Get n,ne,nw,e,s,se,sw and w neighbours\n * const n = Grids.neighbours(grid, cell, `wrap`);\n *\n * Yields:\n * {\n *  n: {x: 2, y: 1}\n *  s: {x: 2, y: 3}\n *  ....\n * }\n * ```\n *\n * Returns neighbours without diagonals (ie n, e, s, w):\n * ```js\n * const n = Grids.neighbours(grid, cell, `stop`, Grids.crossDirections);\n * ```\n * @returns Returns a map of cells, keyed by cardinal direction\n * @param grid Grid\n * @param cell Cell\n * @param bounds How to handle edges of grid\n * @param directions Directions to return\n */\nexport const neighbours = (\n  grid: Grid,\n  cell: Cell,\n  bounds: BoundsLogic = `undefined`,\n  directions?: ReadonlyArray<CardinalDirection>\n): Neighbours => {\n  const dirs = directions ?? allDirections;\n  const points = dirs.map((c) =>\n    offset(grid, cell, getVectorFromCardinal(c), bounds)\n  );\n  return zipKeyValue<Cell>(dirs, points) as Neighbours;\n};\n\nexport function* visitNeigbours(\n  grid: Grid,\n  cell: Cell,\n  bounds: BoundsLogic = `undefined`,\n  directions?: ReadonlyArray<CardinalDirection>\n) {\n  const dirs = directions ?? allDirections;\n  const points = dirs.map((c) =>\n    offset(grid, cell, getVectorFromCardinal(c), bounds)\n  );\n  for (const pt of points) {\n    if (pt !== undefined) yield pt;\n  }\n}\n\n/**\n * Returns the visual midpoint of a cell (eg. pixel coordinate)\n *\n * @param cell\n * @param grid\n * @return\n */\nexport const cellMiddle = (grid: GridVisual, cell: Cell): Points.Point => {\n  guardCell(cell);\n\n  const size = grid.size;\n  const x = cell.x * size; // + (grid.spacing ? cell.x * grid.spacing : 0);\n  const y = cell.y * size; // + (grid.spacing ? cell.y * grid.spacing : 0);\n  return Object.freeze({ x: x + size / 2, y: y + size / 2 });\n};\n\n/**\n * Returns the cells on the line of `start` and `end`, inclusive\n *\n * ```js\n * // Get cells that connect 0,0 and 10,10\n * const cells = Grids.getLine({x:0,y:0}, {x:10,y:10});\n * ```\n *\n * This function does not handle wrapped coordinates.\n * @param start Starting cell\n * @param end End cell\n * @returns\n */\nexport const getLine = (start: Cell, end: Cell): ReadonlyArray<Cell> => {\n  // https://stackoverflow.com/a/4672319\n  guardCell(start);\n  guardCell(end);\n\n  // eslint-disable-next-line functional/no-let\n  let startX = start.x;\n  // eslint-disable-next-line functional/no-let\n  let startY = start.y;\n  const dx = Math.abs(end.x - startX);\n  const dy = Math.abs(end.y - startY);\n  const sx = startX < end.x ? 1 : -1;\n  const sy = startY < end.y ? 1 : -1;\n  // eslint-disable-next-line functional/no-let\n  let err = dx - dy;\n\n  const cells = [];\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    // eslint-disable-next-line functional/immutable-data\n    cells.push(Object.freeze({ x: startX, y: startY }));\n    if (startX === end.x && startY === end.y) break;\n    const e2 = 2 * err;\n    if (e2 > -dy) {\n      err -= dy;\n      startX += sx;\n    }\n    if (e2 < dx) {\n      err += dx;\n      startY += sy;\n    }\n  }\n  return cells;\n};\n\n/**\n * Returns cells that correspond to the cardinal directions at a specified distance\n * i.e. it projects a line from `start` cell in all cardinal directions and returns the cells at `steps` distance.\n * @param grid Grid\n * @param steps Distance\n * @param start Start poiint\n * @param bound Logic for if bounds of grid are exceeded\n * @returns Cells corresponding to cardinals\n */\nexport const offsetCardinals = (\n  grid: Grid,\n  start: Cell,\n  steps: number,\n  bounds: BoundsLogic = `stop`\n): Neighbours => {\n  guardGrid(grid, `grid`);\n  guardCell(start, `start`);\n  throwIntegerTest(steps, `aboveZero`, `steps`);\n\n  const directions = allDirections;\n  const vectors = directions.map((d) => getVectorFromCardinal(d, steps));\n  const cells = directions.map((d, i) =>\n    offset(grid, start, vectors[ i ], bounds)\n  );\n\n  return zipKeyValue(directions, cells) as Neighbours;\n};\n\n/**\n * Returns an `{ x, y }` signed vector corresponding to the provided cardinal direction.\n * ```js\n * const n = getVectorFromCardinal(`n`); // {x: 0, y: -1}\n * ```\n *\n * Optional `multiplier` can be applied to vector\n * ```js\n * const n = getVectorFromCardinal(`n`, 10); // {x: 0, y: -10}\n * ```\n *\n * Blank direction returns `{ x: 0, y: 0 }`\n * @param cardinal Direction\n * @param multiplier Multipler\n * @returns Signed vector in the form of `{ x, y }`\n */\nexport const getVectorFromCardinal = (\n  cardinal: CardinalDirectionOptional,\n  multiplier: number = 1\n): Cell => {\n  // eslint-disable-next-line functional/no-let\n  let v;\n  switch (cardinal) {\n    case `n`: {\n      v = { x: 0, y: -1 * multiplier };\n      break;\n    }\n    case `ne`: {\n      v = { x: 1 * multiplier, y: -1 * multiplier };\n      break;\n    }\n    case `e`: {\n      v = { x: 1 * multiplier, y: 0 };\n      break;\n    }\n    case `se`: {\n      v = { x: 1 * multiplier, y: 1 * multiplier };\n      break;\n    }\n    case `s`: {\n      v = { x: 0, y: 1 * multiplier };\n      break;\n    }\n    case `sw`: {\n      v = { x: -1 * multiplier, y: 1 * multiplier };\n      break;\n    }\n    case `w`: {\n      v = { x: -1 * multiplier, y: 0 };\n      break;\n    }\n    case `nw`: {\n      v = { x: -1 * multiplier, y: -1 * multiplier };\n      break;\n    }\n    default: {\n      v = { x: 0, y: 0 };\n    }\n  }\n  return Object.freeze(v);\n};\n\n/**\n * Returns a list of cells from `start` to `end`.\n *\n * Throws an error if start and end are not on same row or column.\n *\n * @param start Start cell\n * @param end end clel\n * @param endInclusive\n * @return Array of cells\n */\nexport const simpleLine = function (\n  start: Cell,\n  end: Cell,\n  endInclusive: boolean = false\n): ReadonlyArray<Cell> {\n  // eslint-disable-next-line functional/prefer-readonly-type\n  const cells: Cell[] = [];\n  if (start.x === end.x) {\n    // Vertical\n    const lastY = endInclusive ? end.y + 1 : end.y;\n    // eslint-disable-next-line functional/no-let\n    for (let y = start.y; y < lastY; y++) {\n      // eslint-disable-next-line functional/immutable-data\n      cells.push({ x: start.x, y: y });\n    }\n  } else if (start.y === end.y) {\n    // Horizontal\n    const lastX = endInclusive ? end.x + 1 : end.x;\n    // eslint-disable-next-line functional/no-let\n    for (let x = start.x; x < lastX; x++) {\n      // eslint-disable-next-line functional/immutable-data\n      cells.push({ x: x, y: start.y });\n    }\n  } else {\n    throw new Error(\n      `Only does vertical and horizontal: ${ start.x },${ start.y } - ${ end.x },${ end.y }`\n    );\n  }\n  return cells;\n};\n\n/**\n *\n * Returns a coordinate offset from `start` by `vector` amount.\n *\n * Different behaviour can be specified for how to handle when coordinates exceed the bounds of the grid\n *\n *\n * Note: x and y wrapping are calculated independently. A large wrapping of x, for example won't shift up/down a line\n * @param grid Grid to traverse\n * @param vector Offset in x/y\n * @param start Start point\n * @param bounds\n * @returns Cell\n */\nexport const offset = function (\n  grid: Grid,\n  start: Cell,\n  vector: Cell,\n  bounds: BoundsLogic = `undefined`\n): Cell | undefined {\n  guardCell(start, `start`, grid);\n  guardCell(vector);\n  guardGrid(grid, `grid`);\n\n  // eslint-disable-next-line functional/no-let\n  let x = start.x;\n  // eslint-disable-next-line functional/no-let\n  let y = start.y;\n  switch (bounds) {\n    case `wrap`: {\n      x += vector.x % grid.cols;\n      y += vector.y % grid.rows;\n      if (x < 0) x = grid.cols + x;\n      else if (x >= grid.cols) {\n        x -= grid.cols;\n      }\n      if (y < 0) y = grid.rows + y;\n      else if (y >= grid.rows) {\n        y -= grid.rows;\n      }\n      break;\n    }\n    case `stop`: {\n      x += vector.x;\n      y += vector.y;\n      x = clampIndex(x, grid.cols);\n      y = clampIndex(y, grid.rows);\n      break;\n    }\n    case `undefined`: {\n      x += vector.x;\n      y += vector.y;\n      if (x < 0 || y < 0) return;\n      if (x >= grid.cols || y >= grid.rows) return;\n      break;\n    }\n    case `unbounded`: {\n      x += vector.x;\n      y += vector.y;\n      break;\n    }\n    default: {\n      throw new Error(`Unknown BoundsLogic case ${ bounds }`);\n    }\n  }\n  return Object.freeze({ x, y });\n};\n\nconst neighbourList = (\n  grid: Grid,\n  cell: Cell,\n  directions: ReadonlyArray<CardinalDirection>,\n  bounds: BoundsLogic\n): ReadonlyArray<Neighbour> => {\n  // Get neighbours for cell\n  const cellNeighbours = neighbours(grid, cell, bounds, directions);\n\n  // Filter out undefined cells\n  const entries = Object.entries(cellNeighbours);\n  return (entries as Array<NeighbourMaybe>).filter(isNeighbour);\n};\n\n/**\n * Visits every cell in grid using supplied selection function\n * In-built functions to use: visitorDepth, visitorBreadth, visitorRandom,\n * visitorColumn, visitorRow.\n *\n * Usage example:\n * ```js\n *  let visitor = Grids.visitor(Grids.visitorRandom, grid, startCell);\n *  for (let cell of visitor) {\n *   // do something with cell\n *  }\n * ```\n *\n * If you want to keep tabs on the visitor, pass in a MutableValueSet. This is\n * updated with visited cells (and is used internally anyway)\n * ```js\n *  let visited = new mutableValueSet<Grids.Cell>(c => Grids.cellKeyString(c));\n *  let visitor = Grids.visitor(Grids.visitorRandom, grid, startCell, visited);\n * ```\n *\n * To visit with some delay, try this pattern\n * ```js\n *  const delayMs = 100;\n *  const run = () => {\n *   let cell = visitor.next().value;\n *   if (cell === undefined) return;\n *   // Do something with cell\n *   setTimeout(run, delayMs);\n *  }\n *  setTimeout(run, delayMs);\n * ```\n * @param neighbourSelect Select neighbour to visit\n * @param grid Grid to visit\n * @param start Starting cell\n * @param visited Optional tracker of visited cells\n * @returns Cells\n */\n// eslint-disable-next-line functional/prefer-readonly-type\nexport const visitor = function* (\n  logic: VisitorLogic,\n  grid: Grid,\n  start: Cell,\n  opts: VisitorOpts = {}\n): VisitGenerator {\n  guardGrid(grid, `grid`);\n  guardCell(start, `start`, grid);\n\n  const v = opts.visited ?? mutable<Cell>(cellKeyString);\n  const possibleNeighbours = logic.options\n    ? logic.options\n    : (g: Grid, c: Cell) => neighbourList(g, c, crossDirections, `undefined`);\n\n  if (!isCell(start)) {\n    throw new Error(`'start' parameter is undefined or not a cell`);\n  }\n\n  // eslint-disable-next-line functional/no-let\n  let cellQueue: Cell[] = [ start ];\n  // eslint-disable-next-line functional/no-let\n  let moveQueue: Neighbour[] = [];\n  // eslint-disable-next-line functional/no-let\n  let current: Cell | null = null;\n\n  while (cellQueue.length > 0) {\n    if (current === null) {\n      // eslint-disable-next-line functional/immutable-data\n      const nv = cellQueue.pop();\n      if (nv === undefined) {\n        break;\n      }\n      current = nv;\n    }\n\n    if (!v.has(current)) {\n      v.add(current);\n      yield current;\n\n      const nextSteps = possibleNeighbours(grid, current).filter(\n        (step) => !v.has(step[ 1 ])\n      );\n\n      if (nextSteps.length === 0) {\n        // No more moves for this cell\n        if (current !== null) {\n          cellQueue = cellQueue.filter((cq) => cellEquals(cq, current as Cell));\n        }\n      } else {\n        // eslint-disable-next-line functional/immutable-data\n        moveQueue.push(...nextSteps);\n      }\n    }\n\n    // Remove steps already made\n    moveQueue = moveQueue.filter((step) => !v.has(step[ 1 ]));\n\n    if (moveQueue.length === 0) {\n      current = null;\n    } else {\n      // Pick move\n      const potential = logic.select(moveQueue);\n      if (potential !== undefined) {\n        // eslint-disable-next-line functional/immutable-data\n        cellQueue.push(potential[ 1 ]);\n        current = potential[ 1 ];\n      }\n    }\n  }\n};\n\nexport const visitorDepth = (grid: Grid, start: Cell, opts: VisitorOpts = {}) =>\n  visitor(\n    {\n      select: (nbos) => nbos[ nbos.length - 1 ],\n    },\n    grid,\n    start,\n    opts\n  );\n\nexport const visitorBreadth = (\n  grid: Grid,\n  start: Cell,\n  opts: VisitorOpts = {}\n) =>\n  visitor(\n    {\n      select: (nbos) => nbos[ 0 ],\n    },\n    grid,\n    start,\n    opts\n  );\n\nconst randomNeighbour = (nbos: readonly Neighbour[]) => randomElement(nbos); // .filter(isNeighbour));\n\nexport const visitorRandomContiguous = (\n  grid: Grid,\n  start: Cell,\n  opts: VisitorOpts = {}\n) =>\n  visitor(\n    {\n      select: randomNeighbour,\n    },\n    grid,\n    start,\n    opts\n  );\n\n/**\n * Visit by following rows. Normal order is left-to-right, top-to-bottom.\n * @param grid\n * @param start\n * @param opts\n * @returns\n */\nexport const visitorRandom = (\n  grid: Grid,\n  start: Cell,\n  opts: VisitorOpts = {}\n) =>\n  visitor(\n    {\n      options: (grid, cell) => {\n        const t: Neighbour[] = [];\n        for (const c of cells(grid, cell)) {\n          // eslint-disable-next-line functional/immutable-data\n          t.push([ `n`, c ]);\n        }\n        return t;\n      },\n      select: randomNeighbour,\n    },\n    grid,\n    start,\n    opts\n  );\n\nexport const visitorRow = (\n  grid: Grid,\n  start: Cell = { x: 0, y: 0 },\n  opts: VisitorOpts = {}\n) => {\n  const { reversed = false } = opts;\n\n  const neighbourSelect = (nbos: readonly Neighbour[]) =>\n    nbos.find((n) => n[ 0 ] === (reversed ? `w` : `e`));\n\n  const possibleNeighbours = (\n    grid: Grid,\n    cell: Cell\n  ): ReadonlyArray<Neighbour> => {\n    if (reversed) {\n      // WALKING BACKWARD ALONG ROW\n      if (cell.x > 0) {\n        // All fine, step to the left\n        cell = { x: cell.x - 1, y: cell.y };\n      } else {\n        // At the beginning of a row\n        if (cell.y > 0) {\n          // Wrap to next row up\n          cell = { x: grid.cols - 1, y: cell.y - 1 };\n        } else {\n          // Wrap to end of grid\n          cell = { x: grid.cols - 1, y: grid.rows - 1 };\n        }\n      }\n    } else {\n      /*\n       * WALKING FORWARD ALONG ROWS\n       */\n      if (cell.x < grid.rows - 1) {\n        // All fine, step to the right\n        cell = { x: cell.x + 1, y: cell.y };\n      } else {\n        // At the end of a row\n        if (cell.y < grid.rows - 1) {\n          // More rows available, wrap to next row down\n          cell = { x: 0, y: cell.y + 1 };\n        } else {\n          // No more rows available, wrap to start of the grid\n          cell = { x: 0, y: 0 };\n        }\n      }\n    }\n    return [ [ reversed ? `w` : `e`, cell ] ];\n  };\n\n  const logic: VisitorLogic = {\n    select: neighbourSelect,\n    options: possibleNeighbours,\n  };\n\n  return visitor(logic, grid, start, opts);\n};\n\n/**\n * Runs the provided `visitor` for `steps`, returning the cell we end at\n *\n * ```js\n * // Get a cell 10 steps away (row-wise) from start\n * const cell = visitFor(grid, start, 10, visitorRow);\n * ```\n * @param grid Grid to traverse\n * @param start Start point\n * @param steps Number of steps\n * @param visitor Visitor function\n * @returns\n */\nexport const visitFor = (\n  grid: Grid,\n  start: Cell,\n  steps: number,\n  visitor: Visitor\n): Cell => {\n  throwIntegerTest(steps, ``, `steps`);\n\n  const opts: VisitorOpts = {\n    reversed: steps < 0,\n  };\n  steps = Math.abs(steps);\n\n  // eslint-disable-next-line functional/no-let\n  let c = start;\n  // eslint-disable-next-line functional/no-let\n  let v = visitor(grid, start, opts);\n  v.next(); // Burn up starting cell\n\n  // eslint-disable-next-line functional/no-let\n  let stepsMade = 0;\n\n  while (stepsMade < steps) {\n    stepsMade++;\n    const { value } = v.next();\n    if (value) {\n      c = value;\n      if (opts.debug) {\n        console.log(\n          `stepsMade: ${ stepsMade } cell: ${ c.x }, ${ c.y } reverse: ${ opts.reversed }`\n        );\n      }\n    } else {\n      if (steps >= grid.cols * grid.rows) {\n        steps -= grid.cols * grid.rows;\n        stepsMade = 0;\n        v = visitor(grid, start, opts);\n        v.next();\n        c = start;\n        if (opts.debug) console.log(`resetting visitor to ${ steps }`);\n      } else throw new Error(`Value not received by visitor`);\n    }\n  }\n  return c;\n};\n\n/**\n * Visits cells running down columns, left-to-right.\n * @param grid Grid to traverse\n * @param start Start cell\n * @param opts Options\n * @returns Visitor generator\n */\nexport const visitorColumn = (\n  grid: Grid,\n  start: Cell,\n  opts: VisitorOpts = {}\n): VisitGenerator => {\n  const { reversed = false } = opts;\n  const logic: VisitorLogic = {\n    select: (nbos) => nbos.find((n) => n[ 0 ] === (reversed ? `n` : `s`)),\n    options: (grid, cell): ReadonlyArray<Neighbour> => {\n      if (reversed) {\n        // WALK UP COLUMN, RIGHT-TO-LEFT\n        if (cell.y > 0) {\n          // Easy case\n          cell = { x: cell.x, y: cell.y - 1 };\n        } else {\n          // Top of column\n          if (cell.x === 0) {\n            // Top-left corner, need to wrap\n            cell = { x: grid.cols - 1, y: grid.rows - 1 };\n          } else {\n            cell = { x: cell.x - 1, y: grid.rows - 1 };\n          }\n        }\n      } else {\n        // WALK DOWN COLUMNS, LEFT-TO-RIGHT\n        if (cell.y < grid.rows - 1) {\n          // Easy case, move down by one\n          cell = { x: cell.x, y: cell.y + 1 };\n        } else {\n          // End of column\n          if (cell.x < grid.cols - 1) {\n            // Move to next column and start at top\n            cell = { x: cell.x + 1, y: 0 };\n          } else {\n            // Move to start of grid\n            cell = { x: 0, y: 0 };\n          }\n        }\n      }\n      return [ [ reversed ? `n` : `s`, cell ] ];\n    },\n  };\n  return visitor(logic, grid, start, opts);\n};\n\n/**\n * Enumerate rows of grid, returning all the cells in the row\n * as an array\n *\n * ```js\n * for (const row of Grid.rows(shape)) {\n *  // row is an array of Cells.\n *  // [ {x:0, y:0}, {x:1, y:0} ... ]\n * }\n * ```\n * @param grid\n * @param start\n */\nexport const rows = function* (grid: Grid, start: Cell = { x: 0, y: 0 }) {\n  //eslint-disable-next-line functional/no-let\n  let row = start.y;\n  //eslint-disable-next-line functional/no-let\n  let rowCells: Cell[] = [];\n\n  for (const c of cells(grid, start)) {\n    if (c.y !== row) {\n      yield rowCells;\n      rowCells = [ c ];\n      row = c.y;\n    } else {\n      //eslint-disable-next-line functional/immutable-data\n      rowCells.push(c);\n    }\n  }\n  if (rowCells.length > 0) yield rowCells;\n};\n\n/**\n * Enumerate all cells in an efficient manner. Runs left-to-right, top-to-bottom.\n * If end of grid is reached, iterator will wrap to ensure all are visited.\n *\n * @param grid\n * @param start\n */\nexport const cells = function* (grid: Grid, start: Cell = { x: 0, y: 0 }) {\n  guardGrid(grid, `grid`);\n  guardCell(start, `start`, grid);\n\n  // eslint-disable-next-line functional/no-let\n  let { x, y } = start;\n  // eslint-disable-next-line functional/no-let\n  let canMove = true;\n  do {\n    yield { x, y };\n    x++;\n    if (x === grid.cols) {\n      y++;\n      x = 0;\n    }\n    if (y === grid.rows) {\n      y = 0;\n      x = 0;\n    }\n    if (x === start.x && y === start.y) canMove = false; // Complete\n  } while (canMove);\n};\n\nexport const access1dArray = <V>(\n  array: readonly V[],\n  cols: number\n): CellAccessor<V> => {\n  const grid = { cols, rows: Math.ceil(array.length / cols) };\n  const fn: CellAccessor<V> = (\n    cell: Cell,\n    wrap: BoundsLogic\n  ): V | undefined => {\n    const index = indexFromCell(grid, cell, wrap);\n    if (index === undefined) return undefined;\n    return array[ index ];\n  };\n  return fn;\n};\n\n/**\n * Returns a function that updates a 2D array representation\n * of a grid. Array is mutated.\n *\n * ```js\n * const m = Grids.array2dUpdater(grid, array);\n * m(someValue, { x:2, y:3 });\n * ```\n * @param grid\n * @param array\n * @returns\n */\n//eslint-disable-next-line functional/prefer-readonly-type\nexport const array2dUpdater = <V>(grid: GridVisual, array: V[][]) => {\n  const fn = (v: V, position: Points.Point) => {\n    const pos = cellAtPoint(grid, position);\n    if (pos === undefined) {\n      throw new Error(\n        `Position does not exist. Pos: ${ JSON.stringify(\n          position\n        ) } Grid: ${ JSON.stringify(grid) }`\n      );\n    }\n    //eslint-disable-next-line functional/immutable-data\n    array[ pos.y ][ pos.x ] = v;\n  };\n  return fn;\n};\n\n/**\n * Visits a grid packed into an array.\n *\n * @example By default visits left-to-right, top-to-bottom:\n * ```js\n * const data = [1, 2, 3, 4, 5, 6];\n * const cols = 2;\n * for (const [value,index] of visitArray(data, cols)) {\n *  // Yields: 1, 2, 3, 4, 5, 6\n * }\n * ```\n *\n * @example\n * ```js\n * ```\n * @param array\n * @param cols\n * @param iteratorFn\n */\nexport function* visitArray<V>(\n  array: readonly V[],\n  cols: number,\n  iteratorFn?: Visitor,\n  opts?: VisitorOpts\n): IterableIterator<readonly [ data: V, index: number ]> {\n  if (typeof array === `undefined`) {\n    throw Error(`First parameter is undefined, expected an array`);\n  }\n  if (array === null) throw Error(`First parameter is null, expected an array`);\n  if (!Array.isArray(array)) throw Error(`First parameter should be an array`);\n\n  throwIntegerTest(cols, `aboveZero`, `cols`);\n  if (array.length === 0) return;\n\n  const wrap = opts?.boundsWrap ?? `stop`;\n  const rows = Math.ceil(array.length / cols);\n  const grid: Grid = {\n    cols,\n    rows,\n  };\n\n  if (iteratorFn === undefined) iteratorFn = cells;\n  const iter = iteratorFn(grid, { x: 0, y: 0 }, opts);\n  for (const cell of iter) {\n    const index = indexFromCell(grid, cell, wrap);\n    if (index === undefined) return undefined;\n    yield [ array[ index ], index ];\n  }\n}\n\n/**\n * Returns the index for a given cell.\n * This is useful if a grid is stored in an array.\n *\n * ```js\n * const data = [\n *  1, 2,\n *  3, 4,\n *  5, 6 ];\n * const cols = 2; // Grid of 2 columns wide\n * const index = indexFromCell(cols, {x: 1, y: 1});\n * // Yields an index of 3\n * console.log(data[index]); // Yields 4\n * ```\n *\n * Bounds logic is applied to cell.x/y separately. Wrapping\n * only ever happens in same col/row.\n * @see cellFromIndex\n * @param colsOrGrid\n * @param cell\n * @returns\n */\nexport const indexFromCell = (\n  grid: Grid,\n  cell: Cell,\n  wrap: BoundsLogic\n): number | undefined => {\n  guardGrid(grid, `grid`);\n\n  //eslint-disable-next-line functional/no-let\n\n  if (cell.x < 0) {\n    switch (wrap) {\n      case `stop`: {\n        cell = { ...cell, x: 0 };\n        break;\n      }\n      case `unbounded`: {\n        throw new Error(`unbounded not supported`);\n      }\n      case `undefined`: {\n        return undefined;\n      }\n      case `wrap`: {\n        //cell = { ...cell, x: grid.cols + cell.x };\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        cell = offset(grid, { x: 0, y: cell.y }, { x: cell.x, y: 0 }, `wrap`)!;\n        break;\n      }\n    }\n  }\n  if (cell.y < 0) {\n    switch (wrap) {\n      case `stop`: {\n        cell = { ...cell, y: 0 };\n        break;\n      }\n      case `unbounded`: {\n        throw new Error(`unbounded not supported`);\n      }\n      case `undefined`: {\n        return undefined;\n      }\n      case `wrap`: {\n        cell = { ...cell, y: grid.rows + cell.y };\n        break;\n      }\n    }\n  }\n  if (cell.x >= grid.cols) {\n    switch (wrap) {\n      case `stop`: {\n        cell = { ...cell, x: grid.cols - 1 };\n        break;\n      }\n      case `unbounded`: {\n        throw new Error(`unbounded not supported`);\n      }\n      case `undefined`: {\n        return undefined;\n      }\n      case `wrap`: {\n        cell = { ...cell, x: cell.x % grid.cols };\n        break;\n      }\n    }\n  }\n  if (cell.y >= grid.rows) {\n    switch (wrap) {\n      case `stop`: {\n        cell = { ...cell, y: grid.rows - 1 };\n        break;\n      }\n      case `unbounded`: {\n        throw new Error(`unbounded not supported`);\n      }\n      case `undefined`: {\n        return undefined;\n      }\n      case `wrap`: {\n        cell = { ...cell, y: cell.y % grid.rows };\n        break;\n      }\n    }\n  }\n\n  const index = cell.y * grid.cols + cell.x;\n\n  return index;\n};\n\n/**\n * Returns x,y from an array index.\n *\n * ```js\n *  const data = [\n *   1, 2,\n *   3, 4,\n *   5, 6 ];\n *\n * // Cols of 2, index 2 (ie. data[2] == 3)\n * const cell = cellFromIndex(2, 2);\n * // Yields: {x: 0, y: 1}\n * ```\n * @see indexFromCell\n * @param colsOrGrid\n * @param index\n * @returns\n */\nexport const cellFromIndex = (\n  colsOrGrid: number | Grid,\n  index: number\n): Cell => {\n  //eslint-disable-next-line functional/no-let\n  let cols = 0;\n  if (typeof colsOrGrid === `number`) {\n    cols = colsOrGrid;\n  } else {\n    cols = colsOrGrid.cols;\n  }\n  throwIntegerTest(cols, `aboveZero`, `colsOrGrid`);\n\n  return {\n    x: index % cols,\n    y: Math.floor(index / cols),\n  };\n};\n","import { Drawing } from \"./index.js\";\nimport * as Bipolar from \"../data/Bipolar.js\";\n\n/**\n * Options\n */\nexport type BipolarViewOptions = Readonly<{\n  width?: number,\n  height?: number,\n  labelPrecision?: number\n  labels?: [ string, string ],\n  axisColour?: string,\n  bgColour?: string,\n  whiskerColour?: string,\n  whiskerSize?: number,\n  dotColour?: string,\n  dotRadius?: number,\n  showWhiskers?: boolean,\n  showDot?: boolean,\n  showLabels?: boolean,\n  padding?: number,\n  labelColour?: string,\n  axisWidth?: number,\n  asPercentages?: boolean,\n  /**\n   * Custom rendering for background\n   */\n  renderBackground?: Render\n}>\n\nfunction getNumericAttribute(el: HTMLElement, name: string, defaultValue: number) {\n  const a = el.getAttribute(name);\n  if (a === null) return defaultValue;\n  return Number.parseInt(a);\n}\n\nexport type Render = (ctx: CanvasRenderingContext2D, width: number, height: number) => void;\n/**\n * A function that plots a point on the graph\n */\nexport type BipolarView = (x: number, y: number) => void;\n\n/**\n * Initialises a plotter for bipolar values (-1...1)\n * \n * ```js\n * const p = BipolarView.init(`#my-canvas`);\n * // Shows the dot at 1, 0.5\n * p(1, 0.5);\n * ```\n * @param elementQuery \n * @param opts \n * @returns \n */\nexport const init = (elementQuery: string, opts: BipolarViewOptions = {}): BipolarView => {\n  const element = document.querySelector<HTMLCanvasElement>(elementQuery);\n  if (!element) throw new Error(`Element query could not be found (${ elementQuery })`);\n  const labels = opts.labels ?? [ `x`, `y` ];\n  const labelPrecision = opts.labelPrecision ?? 2;\n  const asPercentages = opts.asPercentages ?? false;\n  // Flags\n  const showWhiskers = opts.showWhiskers ?? true;\n  const showDot = opts.showDot ?? true;\n  const showLabels = opts.showLabels ?? true;\n  // Colours\n  const axisColour = opts.axisColour ?? `silver`;\n  const bgColour = opts.bgColour ?? `white`;\n  const whiskerColour = opts.whiskerColour ?? `black`;\n  const dotColour = opts.dotColour ?? whiskerColour;\n  const labelColour = opts.labelColour ?? axisColour;\n  // Sizes\n  const axisWidth = (opts.axisWidth ?? 1 * window.devicePixelRatio);\n  const dotRadius = (opts.dotRadius ?? 5 * window.devicePixelRatio);\n  const pad = (opts.padding ?? 10 * window.devicePixelRatio);\n  const whiskerSize = (opts.whiskerSize ?? 5 * window.devicePixelRatio);\n  const width = (opts.width ?? getNumericAttribute(element, `width`, 200) * window.devicePixelRatio);\n  const height = (opts.height ?? getNumericAttribute(element, `height`, 200) * window.devicePixelRatio);\n\n  element.width = width;// * window.devicePixelRatio;\n  element.height = height;// * window.devicePixelRatio;\n  element.style.width = width / window.devicePixelRatio + `px`;\n  element.style.height = height / window.devicePixelRatio + `px`;\n\n  const midY = height / 2;\n  const midX = width / 2;\n  const ctx = element.getContext(`2d`);\n  if (!ctx) throw new Error(`Could not create drawing context`);\n\n  if (window.devicePixelRatio >= 2) {\n    ctx.font = `20px sans-serif`;\n  }\n  const percentageFormat = (v: number) => Math.round(v * 100) + `%`;\n  const fixedFormat = (v: number) => v.toFixed(labelPrecision);\n\n  const valueFormat = asPercentages ? percentageFormat : fixedFormat;\n  if (showLabels) {\n    labels[ 0 ] = labels[ 0 ] + `:`;\n    labels[ 1 ] = labels[ 1 ] + `:`;\n  } else {\n    labels[ 0 ] = ``;\n    labels[ 1 ] = ``;\n  }\n\n  const renderBackground: Render = opts.renderBackground ?? ((ctx, width, height): void => {\n    ctx.fillStyle = bgColour;\n    ctx.fillRect(0, 0, width, height);\n  });\n\n  return (x: number, y: number) => {\n    x = Bipolar.clamp(x);\n    y = Bipolar.clamp(y);\n\n    renderBackground(ctx, width, height);\n\n    // Labels\n    ctx.fillStyle = labelColour;\n    ctx.textBaseline = `top`;\n    ctx.save();\n    ctx.translate(midX, midY);\n    ctx.rotate(-Math.PI / 2);\n    ctx.fillText((labels[ 1 ] + ` ` + valueFormat(y)).trim(), -midX + pad, 1);\n    ctx.restore();\n    ctx.fillText((labels[ 0 ] + ` ` + valueFormat(x)).trim(), pad, midX + 2);\n\n    // Axes\n    ctx.strokeStyle = axisColour;\n    ctx.lineWidth = axisWidth;\n    ctx.beginPath();\n    ctx.moveTo(pad, midY);\n    ctx.lineTo(width - pad, midY);\n    ctx.moveTo(midX, pad);\n    ctx.lineTo(midX, height - pad);\n    ctx.stroke();\n    ctx.closePath();\n\n    const yy = (height - pad - pad) / 2 * -y;\n    const xx = (width - pad - pad) / 2 * x;\n\n    ctx.save();\n    ctx.translate(midX, midY);\n\n    // Dot\n    if (showDot) {\n      Drawing.circle(ctx, { radius: dotRadius, x: xx, y: yy }, { fillStyle: dotColour });\n    }\n\n    // Whiskers\n    if (showWhiskers) {\n      ctx.strokeStyle = whiskerColour;\n\n      // y line\n      ctx.beginPath();\n      ctx.moveTo(0, yy - whiskerSize);\n      ctx.lineTo(0, yy + whiskerSize);\n\n      // x line\n      ctx.moveTo(xx - whiskerSize, 0);\n      ctx.lineTo(xx + whiskerSize, 0);\n      ctx.stroke();\n      ctx.closePath();\n\n\n    }\n\n    // Restore transform\n    ctx.restore();\n  }\n}\n","\nimport { floatSource, type RandomOptions, type RandomSource } from '../Random.js';\nimport { throwNumberTest } from '../Guards.js';\nimport { interpolate } from './Interpolate.js';\nimport { scaler as numberScaler } from './Scale.js';\n\n/**\n * Wrapper around a bipolar value. Immutable.\n * \n * ```js\n * let b = Bipolar.immutable();\n * let b = Bipolar.immutable(0.5);\n * b = b.add(0.1);\n * ```\n */\nexport type BipolarWrapper = {\n  value: number\n  towardZero: (amt: number) => BipolarWrapper\n  add: (amt: number) => BipolarWrapper\n  multiply: (amt: number) => BipolarWrapper\n  inverse: () => BipolarWrapper\n  asScalar: () => number\n  interpolate: (amt: number, b: number) => BipolarWrapper\n  [ Symbol.toPrimitive ]: (hint: string) => number | string | boolean\n}\n\n/**\n * Wrapper for bipolar-based values. Immutable.\n * All functions will clamp to keep it in legal range.\n * \n * ```js\n * let v = immutable(); // Starts with 0 by default\n * v = v.add(0.1);      // v.value is 0.1\n * v = v.inverse();     // v.value is -0.1\n * v = v.multiply(0.2); // v.value is -0.02\n * \n * v = immutable(1);\n * v = v.towardZero(0.1); // 0.9\n * v = v.interpolate(0.1, 1);\n * ```\n * \n * Wrapped values can be coerced into number:\n * ```js\n * const v = immutable(1);\n * const x = +v+10;\n * // x = 11\n * ```\n * @param startingValue \n * @returns \n */\nexport const immutable = (startingValueOrBipolar: number | BipolarWrapper = 0): BipolarWrapper => {\n  const startingValue = (typeof startingValueOrBipolar === `number`) ? startingValueOrBipolar : startingValueOrBipolar.value;\n\n  if (startingValue > 1) throw new Error(`Cannot be larger than 1`);\n  if (startingValue < -1) throw new Error(`Cannot be smaller than -1`);\n  if (Number.isNaN(startingValue)) throw new Error(`startingValue is NaN`);\n\n  const v = startingValue;\n  return {\n    [ Symbol.toPrimitive ](hint: string) {\n      if (hint === `number`) return v;\n      else if (hint === `string`) return v.toString();\n      return true;\n    },\n    value: v,\n    towardZero: (amt: number) => {\n      return immutable(towardZero(v, amt));\n    },\n    add: (amt: number) => {\n      return immutable(clamp(v + amt));\n    },\n    multiply: (amt: number) => {\n      return immutable(clamp(v * amt));\n    },\n    inverse: () => {\n      return immutable(-v);\n    },\n    interpolate: (amt: number, b: number) => {\n      return immutable(clamp(interpolate(amt, v, b)));\n    },\n    asScalar: () => {\n      return toScalar(v);\n    }\n  }\n}\n\n/**\n * Converts bipolar value to a scalar\n * ```js\n * import { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n * Bipolar.toScalar(-1); // 0.0\n * Bipolar.toScalar( 0); // 0.5\n * Bipolar.toScalar( 1); // 1.0\n * ```\n * \n * Throws an error if `bipolarValue` is not a number or NaN\n * @param bipolarValue Value to convert to scalar\n * @returns Scalar value on 0..1 range.\n */\nexport const toScalar = (bipolarValue: number) => {\n  if (typeof bipolarValue !== `number`) throw new Error(`Expected v to be a number. Got: ${ typeof bipolarValue }`);\n  if (Number.isNaN(bipolarValue)) throw new Error(`Parameter is NaN`);\n  return (bipolarValue + 1) / 2;\n}\n\n/**\n * Makes a scalar into a bipolar value.\n * \n * That is, input range is 0..1, output range is -1...1\n *\n * ```js\n * import { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n * Bipolar.fromScalar(1);   // 1\n * Bipolar.fromScalar(0);   // -1\n * Bipolar.fromScalar(0.5); // 0\n * ```\n * \n * Throws an error if `scalarValue` is not on 0..1 scale.\n * @param scalarValue Scalar value to convert\n * @returns Bipolar value on -1..1 scale\n */\nexport const fromScalar = (scalarValue: number) => {\n  throwNumberTest(scalarValue, `percentage`, `v`);\n  return (scalarValue * 2) - 1;\n};\n\n/**\n * Scale a number to -1..1 range\n * ```js\n * import { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n * \n * // Scale 100 on 0..100 scale\n * Bipolar.scale(100, 0, 100); // 1\n * Bipolar.scale(50, 0, 100);  // 0\n * Bipolar.scale(0, 0, 100);   // -1\n * ```\n * \n * Return value is clamped.\n * @param inputValue Value to scale\n * @param inMin Minimum of scale\n * @param inMax Maximum of scale\n * @returns Bipolar value on -1..1 scale\n */\nexport const scale = (inputValue: number, inMin: number, inMax: number) => {\n  return clamp(numberScaler(inMin, inMax, -1, 1)(inputValue));\n}\n\n/**\n * Scale a number, clamped to -1..1 range\n * ```js\n * import { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n * \n * // Scale 100 on 0..100 scale\n * Bipolar.scale(100, 0, 100); // 1\n * Bipolar.scale(50, 0, 100);  // 0\n * Bipolar.scale(0, 0, 100);   // -1\n * ```\n * \n * Return value is clamped.\n * @param inputValue Value to scale\n * @param inMin Minimum of scale\n * @param inMax Maximum of scale\n * @returns Bipolar value on -1..1 scale\n */\nexport const scaleClamped = (inputValue: number, inMin: number, inMax: number) => {\n  return numberScaler(inMin, inMax, -1, 1)(inputValue);\n}\n\n/**\n * Source for random bipolar values\n * ```js\n * const r = Bipolar.randomSource();\n * r(); // Produce random value on -1...1 scale\n * ```\n * \n * Options can be provided, for example\n * ```js\n * // -0.5 to 0.5 range\n * Bipolar.randomSource({ max: 0.5 });\n * ```\n * \n * Consider using {@link random} if you just want a one-off random\n * value.\n * @param source \n * @returns \n */\nexport const randomSource = (maxOrOptions?: number | RandomOptions): RandomSource => {\n  const source = floatSource(maxOrOptions);\n  return () => (source() * 2) - 1;\n}\n\n/**\n * Returns a random bipolar value\n * ```js\n * const r = Bipolar.random(); // -1...1 random\n * ```\n * \n * Options can be provided, eg.\n * ```js\n * Bipolar.random({ max: 0.5 }); // -0.5..0.5 random\n * ```\n * \n * Use {@link randomSource} if you want to generate random\n * values with same settings repeatedly.\n * @param maxOrOptions \n * @returns \n */\nexport const random = (maxOrOptions?: number | RandomOptions): number => {\n  const source = randomSource(maxOrOptions);\n  return source();\n}\n/**\n * Clamp a bipolar value\n * ```js\n * import { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n * Bipolar.clamp(-1);   // -1\n * Bipolar.clamp(-1.1); // -1\n * ```\n * \n * Throws an error if `bipolarValue` is not a number or NaN.\n * @param bipolarValue Value to clamp\n * @returns Clamped value on -1..1 scale\n */\nexport const clamp = (bipolarValue: number): number => {\n  if (typeof bipolarValue !== `number`) throw new Error(`Parameter must be a number. Got: ${ typeof bipolarValue }`);\n  if (Number.isNaN(bipolarValue)) throw new Error(`v parameter is NaN`);\n  if (bipolarValue > 1) return 1;\n  if (bipolarValue < -1) return -1;\n  return bipolarValue;\n}\n\n/**\n * Pushes a bipolar value toward zero by `amount`.\n * Return value is clamped on bipolar range of -1..1\n * \n * ```js\n * import { Bipolar } from 'https://unpkg.com/ixfx/dist/data.js';\n * Bipolar.towardZero(-1, 0.1); // -0.9\n * Bipolar.towardZero( 1, 0.1); //  0.9\n * Bipolar.towardZero( 0, 0.1); //  0.0\n * Bipolar.towardZero( 1, 1.1); //  0.0\n * ```\n * \n * If `amount` is greater than 1, 0 is returned.\n * Throws an error if `bipolarValue` or `amount` are not numbers.\n * Throws an error if `amount` is below zero.\n * @param bipolarValue Bipolar value to nudge toward zero\n * @param amount Amount to nudge by\n * @returns Bipolar value -1...1\n */\nexport const towardZero = (bipolarValue: number, amount: number): number => {\n  if (typeof bipolarValue !== `number`) throw new Error(`Parameter 'v' must be a number. Got: ${ typeof bipolarValue }`);\n  if (typeof amount !== `number`) throw new Error(`Parameter 'amt' must be a number. Got: ${ typeof amount }`);\n  if (amount < 0) throw new Error(`Parameter 'amt' must be positive`);\n  if (bipolarValue < 0) {\n    bipolarValue += amount;\n    if (bipolarValue > 0) bipolarValue = 0;\n  } else if (bipolarValue > 0) {\n    bipolarValue -= amount;\n    if (bipolarValue < 0) bipolarValue = 0;\n  }\n  return bipolarValue;\n}","/* eslint-disable */\nimport { minMaxAvg } from '../collections/NumericArrays.js';\nimport { type ICircularArray } from '../collections/CircularArray.js';\n\nimport { type Point, subtract as pointSubtract } from '../geometry/Point.js';\nimport { resolveEl, parentSizeCanvas } from '../dom/Util.js';\nimport { type Rect } from '../geometry/Rect.js';\nimport { Colour, Drawing } from './index.js';\nimport {\n  ofArrayMutable,\n  ofCircularMutable,\n  type IMapOfMutableExtended,\n} from '../collections/map/index.js';\n\nexport type Plotter = {\n  add(value: number, series?: string, skipDrawing?: boolean): void;\n  drawValue(index: number): void;\n  /**\n   * Draws current data. Useful if skipDrawing was true for earlier add() calls.\n   */\n  draw(): void;\n  clear(): void;\n  dispose(): void;\n};\n\n/**\n * Series\n */\nexport type Series = {\n  min: number;\n  max: number;\n  range: number;\n  name: string;\n  colour: string;\n  lastValue?: number;\n  hoverValue?: number;\n};\n\n/**\n * Drawing options\n */\nexport type DrawingOpts = PlotOpts & {\n  x: Axis;\n  y: Axis;\n  ctx: CanvasRenderingContext2D;\n  textHeight: number;\n  capacity: number;\n  coalesce: boolean;\n  margin: number;\n  canvasSize: Rect;\n  clearCanvas: boolean;\n  translucentPlot?: boolean;\n  highlightIndex?: number;\n  leadingEdgeDot: boolean;\n  debug: boolean;\n  digitsPrecision: number;\n  lineWidth: number;\n  defaultSeriesColour: string;\n  defaultSeriesVariable?: string;\n  showLegend: boolean;\n  pointer: { x: number; y: number };\n};\n\n/**\n * Properties for an axis\n */\nexport type Axis = {\n  allowedSeries?: string[];\n  /**\n   * Name of axis, eg `x`\n   */\n  name: string;\n  /**\n   * Colour to use for axis labels\n   */\n  colour?: string;\n  /**\n   * Forced scale for values\n   */\n  scaleRange?: [number, number];\n  /**\n   * Forced range for labelling, by default\n   * uses scaleRange\n   */\n  labelRange?: [number, number];\n  /**\n   * Width of axis line\n   */\n  lineWidth: number;\n  /**\n   * How line ends\n   */\n  endWith: `none` | `arrow`;\n  /**\n   * Where to place the name of the axis\n   */\n  namePosition: `none` | `end` | `side`;\n  /**\n   * Width for y axis, height for x axis\n   */\n  textSize: number;\n  /**\n   * If true, axis labels (ie numeric scale) are shown. Default: true\n   */\n  showLabels: boolean;\n  /**\n   * If true, a line is drawn to represent axis. Default: true\n   */\n  showLine: boolean;\n};\n\nexport type SeriesColours = {\n  [id: string]: string | undefined;\n};\n\n/**\n * Plotter options\n */\nexport type PlotOpts = {\n  debug?: boolean;\n  seriesColours?: SeriesColours;\n  /**\n   * Default: 2\n   */\n  digitsPrecision?: number;\n  x?: Axis;\n  y?: Axis;\n  plotSize?: Rect;\n  autoSizeCanvas?: boolean;\n  style?: `connected` | `dots` | `none`;\n  //palette?: Palette.Palette\n  /**\n   * Number of items to keep in the circular array\n   * Default: 10\n   */\n  capacity?: number;\n  //showYAxis?:boolean\n  //showXAxis?:boolean\n  //yAxes?: string[]|string\n  textHeight?: number;\n  /**\n   * Width of plotted line\n   */\n  lineWidth?: number;\n  /**\n   * If true, sub-pixel data points are ignored\n   */\n  coalesce?: boolean;\n  /**\n   * Fixed range to scale Y values. By default normalises values\n   * as they come in. This will also determine the y-axis labels and drawing\n   */\n  //fixedRange?:[number,number]\n  /**\n   * How many horizontal pixels per data point. If unspecified,\n   * it will scale based on width of canvas and capacity.\n   */\n  //dataXScale?:number\n  defaultSeriesColour?: string;\n  defaultSeriesVariable?: string;\n  showLegend?: boolean;\n};\n\nconst piPi = Math.PI * 2;\n\nexport const defaultAxis = (name: string): Axis => ({\n  endWith: `none`,\n  lineWidth: 1,\n  namePosition: 'none',\n  name: name,\n  showLabels: name === `y`,\n  showLine: true,\n  // For y axis, it's the width, for x axis it's the text height\n  textSize: name === `y` ? 20 : 10,\n});\n\nexport const calcScale = (\n  buffer: BufferType,\n  drawingOpts: DrawingOpts,\n  seriesColours?: SeriesColours\n) => {\n  //const seriesNames = buffer.keys();\n  const scales: Series[] = [];\n\n  for (const s of buffer.keys()) {\n    //seriesNames.forEach(s => {\n\n    const series = [...buffer.get(s)];\n    if (series.length === 0) break;\n\n    let { min, max } = minMaxAvg(series);\n    let range = max - min;\n\n    let colour;\n    if (seriesColours !== undefined) {\n      colour = seriesColours[s];\n    }\n    if (colour == undefined) {\n      if (drawingOpts.defaultSeriesVariable)\n        colour = Colour.getCssVariable(\n          `accent`,\n          drawingOpts.defaultSeriesColour\n        );\n      else colour = drawingOpts.defaultSeriesColour;\n    }\n\n    if (range === 0) {\n      range = min;\n      min = min - range / 2;\n      max = max + range / 2;\n    }\n    scales.push({\n      min,\n      max,\n      range,\n      name: s,\n      colour: colour,\n    });\n  }\n  return scales;\n};\n\nexport const add = (buffer: BufferType, value: number, series: string = '') => {\n  buffer.addKeyedValues(series, value);\n};\n\nexport type BufferType =\n  | IMapOfMutableExtended<number, ICircularArray<number>>\n  | IMapOfMutableExtended<number, ReadonlyArray<number>>;\n\nexport const drawValue = (\n  index: number,\n  buffer: BufferType,\n  drawing: DrawingOpts\n) => {\n  const c = {\n    ...drawing,\n    translucentPlot: true,\n    leadingEdgeDot: false,\n  };\n  draw(buffer, c);\n\n  drawing = {\n    ...drawing,\n    highlightIndex: index,\n    leadingEdgeDot: true,\n    translucentPlot: false,\n    style: `none`,\n    clearCanvas: false,\n  };\n  draw(buffer, drawing);\n};\n\nconst scaleWithFixedRange = (\n  buffer: BufferType,\n  range: [number, number],\n  drawing: DrawingOpts\n) =>\n  calcScale(buffer, drawing, drawing.seriesColours).map((s) => ({\n    ...s,\n    range: range[1] - range[0],\n    min: range[0],\n    max: range[1],\n  }));\n\n/**\n * Draws a `buffer` of data with `drawing` options.\n *\n * @param buffer\n * @param drawing\n */\nexport const draw = (buffer: BufferType, drawing: DrawingOpts) => {\n  const { x: xAxis, y: yAxis, ctx, canvasSize } = drawing;\n  const margin = drawing.margin;\n  // const cap = drawing.capacity === 0 ? buffer.lengthMax : drawing.capacity;\n  const series = drawing.y.scaleRange\n    ? scaleWithFixedRange(buffer, drawing.y.scaleRange, drawing)\n    : calcScale(buffer, drawing, drawing.seriesColours);\n\n  if (drawing.clearCanvas)\n    ctx.clearRect(0, 0, canvasSize.width, canvasSize.height);\n\n  if (drawing.debug) {\n    ctx.strokeStyle = `orange`;\n    ctx.strokeRect(0, 0, canvasSize.width, canvasSize.height);\n  }\n\n  // Move in for margin\n  ctx.translate(margin, margin);\n\n  // Calculate/use plot area\n  const plotSize = drawing.plotSize ?? plotSizeFromBounds(canvasSize, drawing);\n\n  // Draw vertical axes\n  const axisSize = {\n    height: plotSize.height + margin + margin,\n    width: plotSize.width,\n  };\n\n  if (yAxis.showLabels || yAxis.showLine) {\n    // Draw the labels for each series\n    series.forEach((s) => {\n      if (yAxis.allowedSeries !== undefined) {\n        if (!yAxis.allowedSeries.includes(s.name)) return;\n      }\n      drawYSeriesScale(s, axisSize, drawing);\n    });\n\n    // Draw vertical line\n    if (series.length > 0 && yAxis.showLine)\n      drawYLine(axisSize, series[0], drawing);\n  }\n\n  // Draw x/horizontal axis if needed\n  if ((xAxis.showLabels || xAxis.showLine) && series.length > 0) {\n    const yPos = yAxis.labelRange ? yAxis.labelRange[0] : series[0].min;\n    drawXAxis(\n      plotSize.width,\n      calcYForValue(yPos, series[0], plotSize.height) +\n        margin +\n        xAxis.lineWidth,\n      drawing\n    );\n  }\n\n  const plotDrawing = {\n    ...drawing,\n    plotSize,\n  };\n\n  const ptr = Drawing.translatePoint(ctx, drawing.pointer);\n  // Draw data for each series\n  series.forEach((s) => {\n    const data = buffer.getSource(s.name);\n    if (data === undefined) return;\n\n    let leadingEdgeIndex =\n      buffer.typeName === `circular`\n        ? (data as ICircularArray<number>).pointer - 1\n        : data.length - 1;\n    if (drawing.highlightIndex !== undefined)\n      leadingEdgeIndex = drawing.highlightIndex;\n    ctx.save();\n    ctx.translate(0, margin + margin);\n\n    drawSeriesData(s, data, plotSize, plotDrawing, leadingEdgeIndex);\n    ctx.restore();\n  });\n\n  if (drawing.showLegend) {\n    ctx.save();\n    ctx.translate(0, plotSize.height + margin + margin + margin);\n    const legendSize = {\n      width: plotSize.width,\n      height: drawing.x.textSize + margin + margin,\n    };\n    drawLegend(series, drawing, legendSize);\n    ctx.restore();\n  }\n  ctx.resetTransform();\n};\n\n/**\n * Draw vertical axis\n * @param series\n * @param height\n * @param drawing\n */\nconst drawYSeriesScale = (\n  series: Series,\n  plotSize: Rect,\n  drawing: DrawingOpts\n) => {\n  const { ctx, y, digitsPrecision, margin } = drawing;\n  const { height } = plotSize;\n\n  if (drawing.debug) {\n    ctx.strokeStyle = `purple`;\n    ctx.strokeRect(0, 0, y.textSize, height + margin);\n  }\n\n  ctx.fillStyle = series.colour.length > 0 ? series.colour : `white`;\n\n  // Override colour with axis-defined colour\n  if (y.colour) ctx.fillStyle = y.colour;\n\n  // Draw labels\n  const min = y.labelRange ? y.labelRange[0] : series.min;\n  const max = y.labelRange ? y.labelRange[1] : series.max;\n  const range = y.labelRange ? max - min : series.range;\n  const mid = min + range / 2;\n  const halfHeight = drawing.textHeight / 2;\n\n  ctx.textBaseline = `top`;\n  ctx.fillText(\n    min.toFixed(digitsPrecision),\n    0,\n    calcYForValue(min, series, height) - halfHeight\n  );\n  ctx.fillText(\n    mid.toFixed(digitsPrecision),\n    0,\n    calcYForValue(mid, series, height) - halfHeight\n  );\n  ctx.fillText(\n    max.toFixed(digitsPrecision),\n    0,\n    calcYForValue(max, series, height) - margin\n  );\n\n  ctx.translate(y.textSize + margin, 0);\n};\n\nconst drawYLine = (plotSize: Rect, series: Series, drawing: DrawingOpts) => {\n  if (series === undefined) throw new Error(`series undefined`);\n  const { ctx, y } = drawing;\n  const { height } = plotSize;\n\n  const min = y.labelRange ? y.labelRange[0] : series.min;\n  const max = y.labelRange ? y.labelRange[1] : series.max;\n\n  const minPos = calcYForValue(min, series, height);\n  const maxPos = calcYForValue(max, series, height);\n\n  // Draw line\n  ctx.translate(y.lineWidth, 0);\n  ctx.lineWidth = y.lineWidth;\n  ctx.beginPath();\n  ctx.moveTo(0, minPos);\n  ctx.lineTo(0, maxPos);\n  ctx.strokeStyle = series.colour;\n  if (y.colour) ctx.strokeStyle = y.colour;\n  ctx.stroke();\n  ctx.translate(y.lineWidth, 0);\n};\n\nconst drawLegend = (\n  series: Series[],\n  drawing: DrawingOpts,\n  size: { width: number; height: number }\n) => {\n  const { ctx } = drawing;\n  const lineSampleWidth = 10;\n\n  let x = 0;\n  const lineY = drawing.margin * 3;\n  const textY = drawing.margin;\n\n  ctx.lineWidth = drawing.lineWidth;\n\n  series.forEach((s) => {\n    ctx.moveTo(x, lineY);\n    ctx.strokeStyle = s.colour;\n    ctx.lineTo(x + lineSampleWidth, lineY);\n    ctx.stroke();\n    x += lineSampleWidth + drawing.margin;\n\n    let label = s.name;\n    if (s.lastValue)\n      label += ' ' + s.lastValue.toFixed(drawing.digitsPrecision);\n    const labelSize = ctx.measureText(label);\n\n    ctx.fillStyle = s.colour;\n    ctx.fillText(label, x, textY);\n    x += labelSize.width;\n  });\n};\n\nconst drawXAxis = (width: number, yPos: number, drawing: DrawingOpts) => {\n  const { ctx, x, y } = drawing;\n\n  if (!x.showLine) return;\n\n  if (x.colour) ctx.strokeStyle = x.colour;\n  ctx.lineWidth = x.lineWidth;\n  ctx.beginPath();\n\n  // Assumes ctx is translated after drawing Y axis\n  ctx.moveTo(0, yPos);\n  ctx.lineTo(width, yPos);\n  ctx.stroke();\n};\n\n/**\n * Draw series data\n * @param series\n * @param values\n * @param plotSize\n * @param drawing\n */\nconst drawSeriesData = (\n  series: Series,\n  values: ArrayLike<number>,\n  plotSize: Rect,\n  drawing: DrawingOpts,\n  leadingEdgeIndex: number\n) => {\n  const { ctx, lineWidth, translucentPlot = false, margin, x: xAxis } = drawing;\n  const style = drawing.style ?? `connected`;\n  const height = plotSize.height - margin;\n\n  let dataXScale = 1;\n  if (xAxis.scaleRange) {\n    const xAxisRange = xAxis.scaleRange[1] - xAxis.scaleRange[0];\n    dataXScale = plotSize.width / xAxisRange;\n  } else {\n    if (drawing.capacity === 0) dataXScale = plotSize.width / values.length;\n    else dataXScale = plotSize.width / drawing.capacity;\n  }\n\n  // Step through data faster if per-pixel density is above one\n  const incrementBy = drawing.coalesce\n    ? dataXScale! < 0\n      ? Math.floor(1 / dataXScale!)\n      : 1\n    : 1;\n\n  let x = 0;\n  let leadingEdge: Point | undefined;\n\n  if (drawing.debug) {\n    ctx.strokeStyle = `green`;\n    ctx.strokeRect(0, 0, plotSize.width, plotSize.height);\n  }\n\n  const colourTransform = (c: string) => {\n    if (translucentPlot) return Colour.opacity(c, 0.2);\n    return c;\n  };\n\n  if (style === `dots`) {\n    ctx.fillStyle = colourTransform(series.colour);\n  } else if (style === `none`) {\n  } else {\n    ctx.beginPath();\n    ctx.lineWidth = lineWidth;\n    ctx.strokeStyle = colourTransform(series.colour);\n  }\n\n  for (let i = 0; i < values.length; i += incrementBy) {\n    let y = calcYForValue(values[i], series, height) - 1;\n\n    if (style === `dots`) {\n      ctx.beginPath();\n      ctx.arc(x, y, lineWidth, 0, piPi);\n      ctx.fill();\n    } else if (style === `none`) {\n    } else {\n      if (i == 0) ctx.moveTo(x, y);\n      ctx.lineTo(x, y);\n    }\n\n    if (i === leadingEdgeIndex) {\n      leadingEdge = { x, y };\n      series.lastValue = values[i];\n    }\n    x += dataXScale;\n  }\n\n  if (style === `connected`) {\n    ctx.stroke();\n  }\n\n  // Draw a circle at latest data point\n  if (leadingEdge !== undefined && drawing.leadingEdgeDot) {\n    ctx.beginPath();\n    ctx.fillStyle = colourTransform(series.colour); // drawing.palette.getOrAdd(`series${series.name}`));\n    ctx.arc(leadingEdge.x, leadingEdge.y, 3, 0, 2 * Math.PI);\n    ctx.fill();\n  }\n};\n\nconst calcYForValue = (v: number, series: Series, height: number) =>\n  (1 - (v - series.min) / series.range) * height;\n\n/**\n * Calculates lost area, given a margin value, axis settings.\n * @param margin\n * @param x\n * @param y\n * @param showLegend\n * @returns\n */\nconst calcSizing = (margin: number, x: Axis, y: Axis, showLegend: boolean) => {\n  let fromLeft = margin;\n  if (y.showLabels) fromLeft += y.textSize;\n  if (y.showLine) fromLeft += y.lineWidth;\n  if (y.showLabels || y.showLine) fromLeft += margin + margin;\n  let fromRight = margin;\n\n  let fromTop = margin + margin;\n  let fromBottom = margin + margin;\n  if (x.showLabels) fromBottom += x.textSize;\n  else fromBottom += margin;\n  if (x.showLine) fromBottom += x.lineWidth;\n  if (x.showLabels || x.showLine) fromBottom += margin;\n\n  if (showLegend) fromBottom += x.textSize;\n\n  return {\n    left: fromLeft,\n    right: fromRight,\n    top: fromTop,\n    bottom: fromBottom,\n  };\n};\n\nconst plotSizeFromBounds = (\n  bounds: Rect,\n  opts: { margin: number; y: Axis; x: Axis; showLegend: boolean }\n): Rect => {\n  const { width, height } = bounds;\n  const sizing = calcSizing(opts.margin, opts.x, opts.y, opts.showLegend);\n  return {\n    width: width - sizing.left - sizing.right,\n    height: height - sizing.top - sizing.bottom,\n  };\n};\n\nconst canvasSizeFromPlot = (\n  plot: Rect,\n  opts: { margin: number; y: Axis; x: Axis; showLegend: boolean }\n): Rect => {\n  const { width, height } = plot;\n  const sizing = calcSizing(opts.margin, opts.x, opts.y, opts.showLegend);\n  return {\n    width: width + sizing.left + sizing.right,\n    height: height + sizing.top + sizing.bottom,\n  };\n};\n\n/**\n * Creates a simple horizontal data plot within a DIV.\n *\n * ```\n * const p = plot(`#parentDiv`);\n * p.add(10);\n * p.clear();\n *\n * // Plot data using series\n * p.add(-1, `temp`);\n * p.add(0.4, `humidty`);\n * ```\n *\n * Options can be specified to customise plot\n * ```\n * const p = plot(`#parentDiv`, {\n *  capacity: 100,     // How many data points to store (default: 10)\n *  showYAxis: false,  // Toggle whether y axis is shown (default: true)\n *  lineWidth: 2,      // Width of plot line (default: 2)\n *  yAxes:  [`temp`],  // Only show these y axes (by default all are shown)\n *  coalesce: true,    // If true, sub-pixel data points are skipped, improving performance for dense plots at the expense of plot precision\n * });\n * ```\n *\n * For all `capacity` values other than `0`, a circular array is used to track data. Otherwise an array is used that will\n * grow infinitely.\n *\n * By default, will attempt to use CSS variable `--series[seriesName]` for axis colours.\n *  `--series[name]-axis` for titles. Eg `--seriesX`. For data added without a named series,\n * it will use `--series` and `--series-axis`.\n * @param parentElOrQuery\n * @param opts\n * @return Plotter instance\n */\nexport const plot = (\n  parentElOrQuery: string | HTMLElement,\n  opts: PlotOpts\n): Plotter => {\n  if (parentElOrQuery === null)\n    throw new Error(`parentElOrQuery is null. Expected string or element`);\n\n  const parentEl = resolveEl(parentElOrQuery);\n  let canvasEl: HTMLCanvasElement;\n  let destroyCanvasEl = true;\n  let plotSize: Rect | undefined = opts.plotSize;\n  let canvasSize: Rect;\n  if (parentEl.nodeName === `CANVAS`) {\n    // Use provided canvas\n    canvasEl = parentEl as HTMLCanvasElement;\n    destroyCanvasEl = false;\n    canvasSize = { width: canvasEl.width, height: canvasEl.height };\n  } else {\n    // Create a CANVAS that fills parent\n    canvasEl = document.createElement(`CANVAS`) as HTMLCanvasElement;\n    parentEl.append(canvasEl);\n    plotSize = opts.plotSize;\n    canvasSize = { width: canvasEl.width, height: canvasEl.height };\n  }\n\n  const pointer = { x: 0, y: 0 };\n\n  const onPointerMove = (evt: PointerEvent) => {\n    pointer.x = evt.offsetX;\n    pointer.y = evt.offsetY;\n  };\n\n  canvasEl.addEventListener(`pointermove`, onPointerMove);\n\n  const ctx = canvasEl.getContext(`2d`)!;\n\n  const capacity = opts.capacity ?? 10;\n  const buffer =\n    capacity > 0\n      ? ofCircularMutable<number>({ capacity })\n      : ofArrayMutable<number>();\n  const metrics = ctx.measureText('Xy');\n  const coalesce = opts.coalesce ?? true;\n\n  // Sanity-check\n  if (ctx === null) throw new Error(`Drawing context not available`);\n\n  let xAxis = defaultAxis(`x`);\n  if (opts.x) xAxis = { ...xAxis, ...opts.x };\n  let yAxis = defaultAxis(`y`);\n  if (opts.y) yAxis = { ...yAxis, ...opts.y };\n\n  let drawingOpts: DrawingOpts = {\n    ...opts,\n    y: yAxis,\n    x: xAxis,\n    pointer: pointer,\n    capacity,\n    coalesce,\n    plotSize,\n    canvasSize,\n    ctx,\n    textHeight:\n      opts.textHeight ??\n      metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent,\n    style: opts.style ?? `connected`,\n    defaultSeriesColour: opts.defaultSeriesColour ?? `yellow`,\n    margin: 3,\n    clearCanvas: true,\n    leadingEdgeDot: true,\n    debug: opts.debug ?? false,\n    digitsPrecision: opts.digitsPrecision ?? 2,\n    lineWidth: opts.lineWidth ?? 2,\n    showLegend: opts.showLegend ?? false,\n  };\n\n  if (plotSize) {\n    // Size canvas based on given plot size\n    const canvasSize = canvasSizeFromPlot(plotSize, drawingOpts);\n    canvasEl.width = canvasSize.width;\n    canvasEl.height = canvasSize.height;\n\n    drawingOpts.canvasSize = canvasSize;\n  }\n\n  if (opts.autoSizeCanvas) {\n    parentSizeCanvas(canvasEl, (args) => {\n      const bounds = args.bounds;\n      drawingOpts = {\n        ...drawingOpts,\n        plotSize: plotSizeFromBounds(bounds, drawingOpts),\n        canvasSize: bounds,\n      };\n      draw(buffer, drawingOpts);\n    });\n  }\n\n  return {\n    drawValue: (index: number) => {\n      drawValue(index, buffer, drawingOpts);\n    },\n    dispose: () => {\n      canvasEl.removeEventListener(`pointermove`, onPointerMove);\n      if (destroyCanvasEl) canvasEl.remove();\n    },\n    add: (value: number, series = '', skipDrawing = false) => {\n      add(buffer, value, series);\n      if (skipDrawing) return;\n      draw(buffer, drawingOpts);\n    },\n    draw: () => {\n      draw(buffer, drawingOpts);\n    },\n    clear: () => {\n      buffer.clear();\n    },\n  };\n};\n","export * from './Log.js';\n\nexport * from './DomRx.js';\nexport * from './Util.js';\nexport * as DataTable from './DataTable.js';\nexport { DataDisplay } from './DataDisplay.js';\n\n/**\n * Functions for working with DOM elements\n */\nexport * as Forms from './Forms.js';\n\nexport * from './PointerVisualise.js';\n\nexport * from './ErrorHandler.js';\n\nexport * as DragDrop from './DragDrop.js';\n\nexport * from './InlineConsole.js';","export const addShadowCss = (\n  parentEl: Readonly<HTMLElement>,\n  styles: string\n): ShadowRoot => {\n  const styleEl = document.createElement(`style`);\n\n  //eslint-disable-next-line functional/immutable-data\n  styleEl.textContent = styles;\n  //eslint-disable-next-line functional/no-let\n  let shadowRoot;\n  if (parentEl.shadowRoot) {\n    shadowRoot = parentEl.shadowRoot;\n    //eslint-disable-next-line functional/immutable-data\n    shadowRoot.innerHTML = ``;\n  } else {\n    shadowRoot = parentEl.attachShadow({ mode: `open` });\n  }\n  shadowRoot.append(styleEl);\n  return shadowRoot;\n};\n","import { resolveEl } from './Util.js';\nimport { addShadowCss } from './ShadowDom.js';\n\nexport type LogOpts = {\n  readonly reverse?: boolean;\n  readonly capacity?: number;\n  readonly timestamp?: boolean;\n  readonly collapseDuplicates?: boolean;\n  readonly monospaced?: boolean;\n  readonly minIntervalMs?: number;\n  readonly css?: string;\n};\n\n//eslint-disable-next-line functional/no-mixed-types\nexport type Log = {\n  clear(): void;\n  error(messageOrError: unknown): void;\n  log(message?: string | object | number): HTMLElement | undefined;\n  warn(message?: string | object | number): HTMLElement | undefined;\n  //eslint-disable-next-line functional/prefer-immutable-types\n  append(el: HTMLElement): void;\n  dispose(): void;\n  readonly isEmpty: boolean;\n};\n\n/**\n * Allows writing to a DOM element in console.log style. Element grows in size, so use\n * something like `overflow-y: scroll` on its parent\n *\n * ```\n * const l = log(`#dataStream`); // Assumes HTML element with id `dataStream` exists\n * l.log(`Hi`);\n * l.log(); // Displays a horizontal rule\n *\n * const l = log(document.getElementById(`dataStream`), {\n *  timestamp: true,\n *  truncateEntries: 20\n * });\n * l.log(`Hi`);\n * l.error(`Some error`); // Adds class `error` to line\n * ```\n *\n * For logging high-throughput streams:\n * ```\n * // Silently drop log if it was less than 5ms since the last\n * const l = log(`#dataStream`, { minIntervalMs: 5 });\n *\n * // Only the last 100 entries are kept\n * const l = log(`#dataStream`, { capacity: 100 });\n * ```\n *\n * @param {(HTMLElement | string | undefined)} elOrId Element or id of element\n * @param {LogOpts} opts\n * @returns {Log}\n */\nexport const log = (\n  //eslint-disable-next-line functional/prefer-immutable-types\n  domQueryOrElement: HTMLElement | string,\n  opts: LogOpts = {}\n): Log => {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  const {\n    capacity = 0,\n    monospaced = true,\n    timestamp = false,\n    collapseDuplicates = true,\n    css = ``,\n  } = opts;\n\n  // eslint-disable-next-line functional/no-let\n  let added = 0;\n  // eslint-disable-next-line functional/no-let\n  let lastLog: string | undefined;\n  // eslint-disable-next-line functional/no-let\n  let lastLogRepeats = 0;\n\n  const parentElement = resolveEl<HTMLElement>(domQueryOrElement);\n  const fontFamily = monospaced\n    ? `Consolas, \"Andale Mono WT\", \"Andale Mono\", \"Lucida Console\", \"Lucida Sans Typewriter\", \"DejaVu Sans Mono\", \"Bitstream Vera Sans Mono\", \"Liberation Mono\", Monaco, \"Courier New\", Courier, monospace`\n    : `normal`;\n  const shadowRoot = addShadowCss(\n    parentElement,\n    `\n  .log {\n    font-family: ${ fontFamily };\n    background-color: var(--code-background-color);\n    padding: var(--padding1, 0.2em);\n    overflow-y: auto;\n    height:100%;\n  }\n  .timestamp {\n    margin-right: 0.5em;\n    opacity: 0.5;\n    font-size: 70%;\n    align-self: center;\n  }\n  .line {\n    display: flex;\n    padding-bottom: 0.1em;\n    padding-top: 0.1em;\n  }\n  .line:hover {\n  \n  }\n  .error {\n    color: red;\n  }\n  .badge {\n    border: 1px solid currentColor;\n    align-self: center;\n    font-size: 70%;\n    padding-left: 0.2em;\n    padding-right: 0.2em;\n    border-radius: 1em;\n    margin-left: 0.5em;\n    margin-right: 0.5em;\n  }\n  .msg {\n    flex: 1;\n    word-break: break-word;\n  }\n  ${ css }\n  `\n  );\n\n  const el = document.createElement(`div`);\n  // eslint-disable-next-line functional/immutable-data,unicorn/no-keyword-prefix\n  el.className = `log`;\n  shadowRoot.append(el);\n\n  const error = (messageOrError: string | Error | unknown) => {\n    const line = document.createElement(`div`);\n\n    if (typeof messageOrError === `string`) {\n      // eslint-disable-next-line functional/immutable-data\n      line.innerHTML = messageOrError;\n    } else if (messageOrError instanceof Error) {\n      const stack = messageOrError.stack;\n      line.innerHTML = stack === undefined ? messageOrError.toString() : stack.toString();\n    } else {\n      // eslint-disable-next-line functional/immutable-data\n      line.innerHTML = messageOrError as string;\n    }\n    line.classList.add(`error`);\n    append(line);\n    lastLog = undefined;\n    lastLogRepeats = 0;\n  };\n\n  //eslint-disable-next-line functional/no-let\n  let lastLogTime = 0;\n\n  const warn = (whatToLog: unknown = ``): HTMLElement | undefined => {\n    const element = log(whatToLog);\n    if (!element) return element;\n    element.classList.add(`warning`);\n    return element;\n  }\n  const log = (whatToLog: unknown = ``): HTMLElement | undefined => {\n    // eslint-disable-next-line functional/no-let\n    let message: string | undefined;\n    const interval = window.performance.now() - lastLogTime;\n    if (opts.minIntervalMs && interval < opts.minIntervalMs) return;\n    lastLogTime = window.performance.now();\n\n    if (typeof whatToLog === `object`) {\n      message = JSON.stringify(whatToLog);\n    } else if (whatToLog === undefined) {\n      message = `(undefined)`;\n    } else if (whatToLog === null) {\n      message = `(null)`;\n    } else if (typeof whatToLog === `number`) {\n      if (Number.isNaN(message)) message = `(NaN)`;\n      message = whatToLog.toString();\n    } else {\n      message = whatToLog as string;\n    }\n\n    if (message.length === 0) {\n      const rule = document.createElement(`hr`);\n      lastLog = undefined;\n      append(rule);\n    } else if (message === lastLog && collapseDuplicates) {\n      const lastElement = el.firstElementChild as HTMLElement;\n      // eslint-disable-next-line functional/no-let\n      let lastBadge = lastElement.querySelector(`.badge`);\n      if (lastBadge === null) {\n        lastBadge = document.createElement(`div`);\n        // eslint-disable-next-line functional/immutable-data,unicorn/no-keyword-prefix\n        lastBadge.className = `badge`;\n        lastElement.insertAdjacentElement(`beforeend`, lastBadge);\n      }\n      if (lastElement !== null) {\n        // eslint-disable-next-line functional/immutable-data\n        lastBadge.textContent = (++lastLogRepeats).toString();\n      }\n      return lastElement;\n    } else {\n      const line = document.createElement(`div`);\n      // eslint-disable-next-line functional/immutable-data\n      line.textContent = message;\n      append(line);\n      lastLog = message;\n      return line;\n    }\n  };\n\n\n  //eslint-disable-next-line functional/prefer-immutable-types\n  const append = (line: HTMLElement) => {\n    if (timestamp) {\n      const wrapper = document.createElement(`div`);\n      const timestamp = document.createElement(`div`);\n      // eslint-disable-next-line functional/immutable-data,unicorn/no-keyword-prefix\n      timestamp.className = `timestamp`;\n      // eslint-disable-next-line functional/immutable-data\n      timestamp.textContent = new Date().toLocaleTimeString();\n      wrapper.append(timestamp, line);\n      line.classList.add(`msg`);\n      wrapper.classList.add(`line`);\n      line = wrapper;\n    } else {\n      line.classList.add(`line`, `msg`);\n    }\n\n    if (opts.reverse) {\n      el.append(line);\n    } else {\n      el.insertBefore(line, el.firstChild);\n    }\n\n    if (capacity > 0 && ++added > capacity * 2) {\n      while (added > capacity) {\n        el.lastChild?.remove();\n        added--;\n      }\n    }\n\n    if (opts.reverse) {\n      // Scroll to bottom\n      //eslint-disable-next-line functional/immutable-data\n      el.scrollTop = el.scrollHeight;\n    }\n    lastLogRepeats = 0;\n  };\n\n  const clear = () => {\n    // eslint-disable-next-line functional/immutable-data\n    el.innerHTML = ``;\n    lastLog = undefined;\n    lastLogRepeats = 0;\n    added = 0;\n  };\n\n  const dispose = () => {\n    el.remove();\n  };\n\n  return {\n    error,\n    log,\n    warn,\n    append,\n    clear,\n    dispose,\n    get isEmpty() {\n      return added === 0;\n    },\n  };\n};\n","import { fromEvent, Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { resolveEl } from './Util.js';\n\nexport type PluckOpts = {\n  readonly pluck: string;\n};\n\nexport type TransformOpts = {\n  //eslint-disable-next-line @typescript-eslint/no-explicit-any,functional/prefer-immutable-types\n  transform(ev: Event): any;\n};\n\n/**\n * Responsive value\n */\n// eslint-disable-next-line functional/no-mixed-types\nexport type Rx<V> = {\n  /**\n   * Last value\n   */\n  readonly value: V;\n  /**\n   * Clears last value\n   */\n  readonly clear: () => void;\n};\n\nexport type DomRxOpts = PluckOpts | TransformOpts;\n\n/**\n * Keeps track of last event data\n *\n * ```js\n * const pointer = rx(`#myDiv`, `pointermove`).value;\n *\n * if (pointer.clientX > ...)\n * ```\n *\n * Pluck a field:\n * ```js\n * const pointerX = rx(`#myDiv`, `pointermove`, { pluck: `clientX` }).value;\n *\n * if (pointerX > ...)\n * ```\n * @template V Event type\n * @param opts\n * @return\n */\nexport const rx = <V extends object>(\n  //eslint-disable-next-line functional/prefer-immutable-types\n  elOrQuery: HTMLElement | string,\n  event: string,\n  opts?: DomRxOpts\n): Rx<V> => {\n  const el = resolveEl<HTMLElement>(elOrQuery);\n  const ev = fromEvent(el, event);\n  // @ts-ignore\n  const value: V = {};\n\n  const clear = () => {\n    const keys = Object.keys(value);\n    keys.forEach((key) => {\n      // eslint-disable-next-line functional/immutable-data, @typescript-eslint/no-explicit-any\n      delete (value as any)[key];\n    });\n  };\n  //eslint-disable-next-line functional/prefer-immutable-types\n  const setup = (sub: Observable<Event>): Rx<V> => {\n    sub.subscribe({\n      next: (newValue) => {\n        // eslint-disable-next-line functional/immutable-data, @typescript-eslint/no-explicit-any\n        Object.assign(value, newValue);\n      },\n    });\n    return {\n      value,\n      clear,\n    };\n  };\n\n  if (opts === undefined) return setup(ev);\n\n  if ((opts as PluckOpts).pluck) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return setup(ev.pipe(map((x) => (x as any)[(opts as PluckOpts).pluck])));\n  } else if ((opts as TransformOpts).transform) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    return setup(ev.pipe(map((x) => (opts as TransformOpts).transform(x))));\n  }\n\n  return setup(ev);\n};\n","import { round } from '../Numbers.js';\nimport { resolveEl as resolveElement } from './Util.js';\nimport JSON5 from 'json5';\n\nexport type FormattingOptions = {\n  readonly precision?: number\n  readonly roundNumbers?: number\n}\nexport type DataTableOpts = FormattingOptions & {\n  readonly formatter?: DataFormatter\n  readonly objectsAsTables?: boolean\n  readonly idPrefix?: string\n};\n\nexport type DataTable<V> = {\n  update(data: V): void;\n  remove(): boolean;\n};\n\nconst toHtmlSimple = (v: any, options: FormattingOptions): string => {\n  if (v === null) return `(null)`;\n  if (v === undefined) return `(undefined)`;\n  if (typeof v === `boolean`) return v ? `true` : `false`;\n  if (typeof v === `string`) return `\"${ v }\"`;\n  if (typeof v === `number`) {\n    let vAsNumber = v;\n    if (options.roundNumbers !== undefined) vAsNumber = round(options.roundNumbers, v)\n    if (options.precision !== undefined) return vAsNumber.toFixed(options.precision);\n    return vAsNumber.toString();\n  }\n  if (typeof v === `object`) return toTableSimple(v, options);\n  return JSON5.stringify(v);\n}\n\nconst toTableSimple = (v: object, options: FormattingOptions): string => {\n  let html = `<div style=\"display:grid; grid-template-columns: repeat(2, 1fr)\">`;\n  for (const entry of Object.entries(v)) {\n    const value = toHtmlSimple(entry[ 1 ], options);\n    html += `<div class=\"label\" style=\"display:table-cell\">${ entry[ 0 ] }</div>\n      <div class=\"data\" style=\"display:table-cell\">${ value }</div>`\n  }\n  html += `</div>`;\n  return html;\n}\n\n/**\n * Creates a table of data points for each object in the map\n * ```\n * const t = DataTable.fromList(parentEl, map);\n * t.update(newMap);\n * ```\n */\nexport const fromList = (\n  parentOrQuery: HTMLElement | string,\n  //eslint-disable-next-line functional/prefer-readonly-type\n  data: Map<string, object>\n): DataTable<Map<string, object>> => {\n  const parent = resolveElement(parentOrQuery);\n  let container: HTMLDivElement | undefined = document.createElement(\n    `DIV`\n  ) as HTMLDivElement;\n  parent.append(container);\n\n  const remove = () => {\n    if (!container) return false;\n    container.remove();\n    container = undefined;\n    return true;\n  };\n\n  const update = (data: ReadonlyMap<string, object>) => {\n    const seenTables = new Set();\n\n    for (const [ key, value ] of data) {\n      const tKey = `table-${ key }`;\n      seenTables.add(tKey);\n      let t: HTMLElement | null = parent.querySelector(`#${ tKey }`);\n      if (t === null) {\n        t = document.createElement(`table`);\n        if (!t) throw new Error(`Could not create table element`);\n        //eslint-disable-next-line functional/immutable-data\n        t.id = tKey;\n        parent.append(t);\n      }\n\n      updateElement(t as HTMLTableElement, value);\n    }\n\n    // Remove tables that aren't present in map\n    // eslint-disable-next-line unicorn/prefer-spread\n    const tables = Array.from(parent.querySelectorAll(`table`));\n    for (const t of tables) {\n      if (!seenTables.has(t.id)) {\n        t.remove();\n      }\n    }\n  };\n\n  if (data) update(data);\n  return { update, remove };\n  // return (d: ReadonlyMap<string, object>) => {\n  //   update(d);\n  // };\n};\n\n/**\n * Format data. Return _undefined_ to signal that\n * data was not handled.\n */\nexport type DataFormatter = (data: object, path: string) => string | undefined;\n\n/**\n * Updates the given table element so each entry in the map is a\n * row in the table.\n *\n * Rows are keyed by the map key. Rows with keys not found in the map are deleted.\n * @param t Table\n * @param data Map of data\n * @param opts Options\n * @returns\n */\nconst updateElement = (\n  //eslint-disable-next-line functional/prefer-immutable-types\n  t: HTMLTableElement,\n  data: object,\n  opts: DataTableOpts = {}\n) => {\n  const precision = opts.precision ?? 2;\n  const idPrefix = opts.idPrefix ?? ``;\n  const objectsAsTables = opts.objectsAsTables ?? false;\n\n  if (data === undefined) {\n    //eslint-disable-next-line functional/immutable-data\n    t.innerHTML = ``;\n    return;\n  }\n  const seenRows = new Set();\n\n  for (const [ key, value ] of Object.entries(data)) {\n    const domKey = `${ idPrefix }-row-${ key }`;\n    // Keep track of keys currently in object\n    seenRows.add(domKey);\n\n    // Is there already a row for this key?\n    let rowEl = t.querySelector(`tr[data-key='${ domKey }']`);\n    if (rowEl === null) {\n      // No row, add it\n      rowEl = document.createElement(`tr`);\n      t.append(rowEl);\n      rowEl.setAttribute(`data-key`, domKey);\n\n      const keyEl = document.createElement(`td`);\n      keyEl.textContent = key;\n      keyEl.classList.add(`label`);\n      rowEl.append(keyEl);\n    }\n\n    // Is there already a cell for the value?\n    let valEl = rowEl.querySelector(`td[data-key='${ domKey }-val']`);\n\n    if (valEl === null) {\n      // No, create the cell\n      valEl = document.createElement(`td`);\n      valEl.classList.add(`data`);\n      valEl.setAttribute(`data-key`, `${ domKey }-val`);\n      rowEl.append(valEl);\n    }\n\n    // Format the value as HTML\n    let valueHTML: string | undefined;\n    if (opts.formatter) {\n      valueHTML = opts.formatter(value, key);\n    }\n\n    // If there's no formatter, or not handled...\n    if (valueHTML === undefined) {\n      if (typeof value === `object`) {\n        valueHTML = objectsAsTables ? toTableSimple(value, opts) : JSON5.stringify(value);\n      } else if (typeof value === `number`) {\n        valueHTML = opts.roundNumbers ? Math.round(value).toString() : value.toFixed(precision);\n      } else if (typeof value === `boolean`) {\n        valueHTML = value ? `true` : `false`;\n      } else if (typeof value === `string`) {\n        valueHTML = `\"${ value }\"`;\n      } else {\n        valueHTML = JSON.stringify(value);\n      }\n    }\n\n    // Set the cell value\n    (valEl as HTMLElement).innerHTML = valueHTML;\n  }\n\n  // Remove rows that aren't present in data\n  // eslint-disable-next-line unicorn/prefer-spread\n  const rows = Array.from(t.querySelectorAll(`tr`));\n  for (const r of rows) {\n    const key = r.getAttribute(`data-key`);\n    if (!seenRows.has(key)) {\n      r.remove();\n    }\n  }\n};\n\n/**\n * Creates a HTML table where each row is a key-value pair from `data`.\n * First column is the key, second column data.\n *\n * ```js\n * const dt = fromObject(`#hostDiv`);\n * ```\n *\n * `dt` is a function to call when you want to update data:\n *\n * ```js\n * dt({\n *  name: `Blerg`,\n *  height: 120\n * });\n * ```\n */\nexport const fromObject = (\n  parentOrQuery: HTMLElement | string,\n  data?: object,\n  opts?: DataTableOpts\n): DataTable<object> => {\n  const parent = resolveElement(parentOrQuery);\n  const idPrefix = opts?.idPrefix ?? Math.floor(Math.random() * 1000).toString();\n\n  let t: HTMLTableElement | undefined = document.createElement(`table`);\n  parent.append(t);\n\n  const remove = () => {\n    if (!t) return false;\n    t.remove();\n    t = undefined;\n    return true;\n  };\n\n  // Update already if there's initial data\n  if (data) updateElement(t, data, opts);\n\n  const update = (d: object) => {\n    if (!t) throw new Error(`Table disposed`);\n    updateElement(t, d, { ...opts, idPrefix });\n  };\n\n  return { remove, update };\n};\n","import { fromObject } from \"./DataTable.js\";\n\nexport type DataDisplayOptions = {\n  theme?: `dark` | `light`\n}\n\n// TODO Visually show data which has changed since last update\n// TODO Click on a field to show a sparkline for it\n/**\n * Creates a simple display for data. Designed to show ixfx state data\n * \n * ```js\n * // Create once\n * const display = new DataDisplay();\n * \n * // Call .update to show state\n * display.update(state);\n * ```\n */\nexport class DataDisplay {\n\n  dataTable;\n\n  /**\n   * Constructor\n   * @param darkMode \n   */\n  constructor(options: DataDisplayOptions = {}) {\n    const theme = options.theme ?? `dark`;\n\n    const existing = document.querySelector(`#ixfx-data-display`);\n    if (existing !== null) throw new Error(`DataDisplay already loaded on this page`);\n\n    const container = document.createElement(`div`);\n    container.id = `ixfx-data-display`;\n    container.classList.add(`theme-${ theme }`);\n\n    const css = document.createElement(`style`);\n    css.textContent = `\n    #ixfx-data-display {\n      background: white;\n      color: black;\n      border: 2px solid hsl(0deg 0.61% 90%);\n      border-radius: 4px;\n      z-index: 1000;\n      opacity: 40%;\n      padding: 1em;\n      font-family: monospace;\n      position: fixed;\n      right: 1em;\n      top: 1em;\n    }\n    #ixfx-data-display.theme-dark {\n      background: black;\n      color: white;\n      border: 2px solid hsl(0deg 0.61% 10%);\n    }\n    #ixfx-data-display:hover {\n      opacity: 100%;\n    }\n    #ixfx-data-display table {\n      border-collapse: collapse;\n    }\n    #ixfx-data-display tr:not(:last-child) {\n      border-bottom: 2px solid hsl(0deg 0.61% 90%);\n    }\n    #ixfx-data-display.dark tr:not(:last-child) {\n      border-bottom: 2px solid hsl(0deg 0.61% 10%);\n    }\n    #ixfx-data-display td {\n      padding-bottom: 0.4em;\n      padding-top: 0.4em;\n    }\n    #ixfx-data-display .label {\n      color: hsl(0deg 0.61% 60%);\n      text-align: right;\n      padding-right: 0.5em;\n    }\n    #ixfx-data-display.theme-dark .label {\n      color: gray;\n    }\n    `\n\n    container.style.display = `inline-block`;\n    document.body.append(css);\n    document.body.append(container);\n\n    this.dataTable = fromObject(container, undefined, {\n      objectsAsTables: true,\n      roundNumbers: 2\n    });\n  }\n\n  update(data: object) {\n    this.dataTable.update(data);\n  }\n}","import { resolveEl } from './Util.js';\n\n/**\n * Adds tab and shift+tab to TEXTAREA\n * @param el\n */\n//eslint-disable-next-line functional/prefer-immutable-types\nexport const textAreaKeyboard = (el: HTMLTextAreaElement) => {\n  el.addEventListener(`keydown`, (evt) => {\n    const val = el.value;\n    const start = el.selectionStart;\n    const end = el.selectionEnd;\n\n    if (evt.key === `Tab` && evt.shiftKey) {\n      if (el.value.substring(start - 2, start) === `  `) {\n        //eslint-disable-next-line functional/immutable-data\n        el.value = val.substring(0, start - 2) + val.substring(end);\n      }\n      //eslint-disable-next-line functional/immutable-data\n      el.selectionStart = el.selectionEnd = start - 2;\n      evt.preventDefault();\n      return false;\n    } else if (evt.key === `Tab`) {\n      //eslint-disable-next-line functional/immutable-data\n      el.value = val.substring(0, start) + `  ` + val.substring(end);\n      //eslint-disable-next-line functional/immutable-data\n      el.selectionStart = el.selectionEnd = start + 2;\n      evt.preventDefault();\n      return false;\n    }\n  });\n};\n\n/**\n * Quick access to <input type=\"checkbox\"> value.\n * Provide a checkbox by string id or object reference. If a callback is\n * supplied, it will be called when the checkbox changes value.\n *\n * ```\n * const opt = checkbox(`#chkMate`);\n * opt.checked; // Gets/sets\n *\n * const opt = checkbox(document.getElementById(`#chkMate`), newVal => {\n *  if (newVal) ...\n * });\n * ```\n * @param {(string | HTMLInputElement)} domIdOrEl\n * @param {(currentVal:boolean) => void} [onChanged]\n * @returns\n */\nexport const checkbox = (\n  //eslint-disable-next-line functional/prefer-immutable-types\n  domIdOrEl: string | HTMLInputElement,\n  onChanged?: (currentVal: boolean) => void\n) => {\n  const el = resolveEl<HTMLInputElement>(domIdOrEl);\n\n  if (onChanged) {\n    el.addEventListener(`change`, () => {\n      onChanged(el.checked);\n    });\n  }\n  return {\n    get checked(): boolean {\n      return el.checked;\n    },\n    set checked(val: boolean) {\n      // eslint-disable-next-line functional/immutable-data\n      el.checked = val;\n    },\n  };\n};\n\n/**\n * Numeric INPUT\n *\n * ```\n * const el = numeric(`#num`, (currentValue) => {\n *  // Called when input changes\n * })\n * ```\n *\n * Get/set value\n * ```\n * el.value = 10;\n * ```\n * @param domIdOrEl\n * @param onChanged\n * @param live If true, event handler fires based on `input` event, rather than `change`\n * @returns\n */\nexport const numeric = (\n  //eslint-disable-next-line functional/prefer-immutable-types\n  domIdOrEl: string | HTMLInputElement,\n  onChanged?: (currentVal: number) => void,\n  live?: boolean\n) => {\n  const el = resolveEl<HTMLInputElement>(domIdOrEl) as HTMLInputElement;\n  const evt = live ? `change` : `input`;\n  if (onChanged) {\n    el.addEventListener(evt, () => {\n      onChanged(parseInt(el.value));\n    });\n  }\n  return {\n    get value(): number {\n      return parseInt(el.value);\n    },\n    set value(val: number) {\n      // eslint-disable-next-line functional/immutable-data\n      el.value = val.toString();\n    },\n  };\n};\n\n/**\n * SELECT options\n */\nexport type SelectOpts = {\n  /**\n   * Placeholder item\n   */\n  readonly placeholderOpt?: string;\n  /**\n   * If true, a placeholder option 'Choose' is added to the list\n   */\n  readonly shouldAddChoosePlaceholder?: boolean;\n  /**\n   * Item to choose after a selection is made\n   */\n  readonly autoSelectAfterChoice?: number;\n};\n\n/**\n * Button\n *\n * ```\n * const b = button(`#myButton`, () => {\n *  console.log(`Button clicked`);\n * });\n * ```\n *\n * ```\n * b.click(); // Call the click handler\n * b.disabled = true / false;\n * ```\n * @param domQueryOrEl Query string or element instance\n * @param onClick Callback when button is clicked\n * @returns\n */\nexport const button = (\n  //eslint-disable-next-line functional/prefer-immutable-types\n  domQueryOrEl: string | HTMLButtonElement,\n  onClick?: () => void\n) => {\n  const el = resolveEl(domQueryOrEl) as HTMLButtonElement;\n\n  if (onClick) {\n    el.addEventListener(`click`, (_ev) => {\n      onClick();\n    });\n  }\n  return {\n    click() {\n      if (onClick) onClick();\n    },\n    set disabled(val: boolean) {\n      // eslint-disable-next-line functional/immutable-data\n      el.disabled = val;\n    },\n  };\n};\n\n/**\n * SELECT handler\n */\nexport interface SelectHandler {\n  /**\n   * Gets/Sets disabled\n   */\n  set disabled(value: boolean);\n\n  get disabled(): boolean;\n  /**\n   * Gets value\n   */\n  get value(): string;\n  /**\n   * Sets selected index\n   */\n  get index(): number;\n  /**\n   * _True_ if currently selected item is the placeholder\n   */\n  get isSelectedPlaceholder(): boolean;\n  /**\n   * Set options\n   * @param opts Options\n   * @param preSelect Item to preselect\n   */\n  setOpts(opts: readonly string[], preSelect?: string): void;\n  /**\n   * Select item by index\n   * @param index Index\n   * @param trigger If true, triggers change event\n   */\n  select(index?: number, trigger?: boolean): void;\n}\n\n/**\n * SELECT element.\n *\n * Handle changes in value:\n * ```\n * const mySelect = select(`#mySelect`, (newValue) => {\n *  console.log(`Value is now ${newValue}`);\n * });\n * ```\n *\n * Enable/disable:\n * ```\n * mySelect.disabled = true / false;\n * ```\n *\n * Get currently selected index or value:\n * ```\n * mySelect.value / mySelect.index\n * ```\n *\n * Is the currently selected value a placeholder?\n * ```\n * mySelect.isSelectedPlaceholder\n * ```\n *\n * Set list of options\n * ```\n * // Adds options, preselecting `opt2`.\n * mySelect.setOpts([`opt1`, `opt2 ...], `opt2`);\n * ```\n *\n * Select an element\n * ```\n * mySelect.select(1); // Select second item\n * mySelect.select(1, true); // If true is added, change handler fires as well\n * ```\n * @param domQueryOrEl Query (eg `#id`) or element\n * @param onChanged Callback when a selection is made\n * @param opts Options\n * @return\n */\nexport const select = (\n  //eslint-disable-next-line functional/prefer-immutable-types\n  domQueryOrEl: string | HTMLSelectElement,\n  onChanged?: (currentVal: string) => void,\n  opts: SelectOpts = {}\n): SelectHandler => {\n  const el = resolveEl(domQueryOrEl) as HTMLSelectElement;\n  const {\n    placeholderOpt,\n    shouldAddChoosePlaceholder = false,\n    autoSelectAfterChoice = -1,\n  } = opts;\n\n  const change = () => {\n    if (onChanged !== undefined) onChanged(el.value);\n    // eslint-disable-next-line functional/immutable-data\n    if (autoSelectAfterChoice >= 0) el.selectedIndex = autoSelectAfterChoice;\n  };\n\n  if (onChanged) {\n    el.addEventListener(`change`, (_ev) => {\n      change();\n    });\n  }\n  return {\n    set disabled(val: boolean) {\n      // eslint-disable-next-line functional/immutable-data\n      el.disabled = val;\n    },\n    get value(): string {\n      return el.value;\n    },\n    get index(): number {\n      return el.selectedIndex;\n    },\n    get isSelectedPlaceholder(): boolean {\n      return (\n        (shouldAddChoosePlaceholder || opts.placeholderOpt !== undefined) &&\n        el.selectedIndex === 0\n      );\n    },\n    //eslint-disable-next-line functional/prefer-immutable-types\n    setOpts(opts: string[], preSelect?: string): void {\n      // eslint-disable-next-line functional/immutable-data\n      el.options.length = 0;\n\n      if (shouldAddChoosePlaceholder) opts = [`-- Choose --`, ...opts];\n      else if (placeholderOpt !== undefined) opts = [placeholderOpt, ...opts];\n      // eslint-disable-next-line functional/no-let\n      let toSelect = 0;\n\n      opts.forEach((o, index) => {\n        const optEl = document.createElement(`option`);\n        // eslint-disable-next-line functional/immutable-data\n        optEl.value = o;\n        // eslint-disable-next-line functional/immutable-data\n        optEl.innerHTML = o;\n        if (preSelect !== undefined && o === preSelect) toSelect = index;\n        el.options.add(optEl);\n      });\n      // eslint-disable-next-line functional/immutable-data\n      el.selectedIndex = toSelect;\n    },\n    select(index: number = 0, trigger: boolean = false): void {\n      // eslint-disable-next-line functional/immutable-data\n      el.selectedIndex = index;\n      if (trigger && onChanged) {\n        change();\n      }\n    },\n  };\n};\n","import type { TimestampedObject, TrackedValueOpts } from './TrackedValue.js';\nimport { TrackerBase } from './TrackerBase.js';\n\n/**\n * A tracked value of type `V`.\n */\nexport abstract class ObjectTracker<V extends object, SeenResultType> extends TrackerBase<V, SeenResultType> {\n  //abstract onSeen(_p: Array<V>): SeenResultType;\n\n  values: Array<TimestampedObject<V>>;\n\n  constructor(opts: TrackedValueOpts = {}) {\n    super(opts);\n    this.values = [];\n  }\n\n  onTrimmed() {\n    // no-op\n  }\n\n  /**\n   * Reduces size of value store to `limit`. \n   * Returns number of remaining items\n   * @param limit\n   */\n  trimStore(limit: number): number {\n    if (limit >= this.values.length) return this.values.length;\n    // Index 0 will be the oldest\n    this.values = this.values.slice(-limit);\n    return this.values.length;\n  }\n\n  /**\n   * Allows sub-classes to be notified when a reset happens\n   * @ignore\n   */\n  onReset() {\n    this.values = [];\n  }\n\n  /**\n   * Tracks a value\n   * @ignore\n   */\n  filterData(p: Array<V> | Array<TimestampedObject<V>>): Array<TimestampedObject<V>> {\n    // Make sure values have a timestamp\n    const ts = p.map((v) =>\n      `at` in v\n        ? v\n        : {\n          ...v,\n          at: Date.now(),\n        }\n    );\n\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const last = ts.at(-1)!;\n\n    if (this.storeIntermediate) this.values.push(...ts);\n    else switch (this.values.length) {\n      case 0: {\n        // Add as initial value\n        this.values.push(last);\n        break;\n      }\n      case 1: {\n        // Add last value\n        this.values.push(last);\n        break;\n      }\n      case 2: {\n        // Replace last value\n        this.values[ 1 ] = last;\n        break;\n      }\n    }\n    return ts;\n  }\n\n  /**\n   * Last seen value. If no values have been added, it will return the initial value\n   */\n  get last() {\n    if (this.values.length === 1) return this.values[ 0 ];\n    //eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    return this.values.at(-1)!;\n  }\n\n  /**\n   * Returns the initial value\n   */\n  get initial() {\n    return this.values.at(0);\n  }\n\n  /**\n   * Returns number of recorded values (includes the initial value in the count)\n   */\n  get size() {\n    return this.values.length;\n  }\n\n  /**\n   * Returns the elapsed time, in milliseconds since the initial value\n   */\n  get elapsed(): number {\n    return Date.now() - this.values[ 0 ].at;\n  }\n\n}\n","import * as Points from '../geometry/Point.js';\nimport {\n  TrackedValueMap,\n  type TrackedValueOpts as TrackOpts,\n  type TimestampedObject,\n} from './TrackedValue.js';\nimport { ObjectTracker } from './ObjectTracker.js';\nimport { Lines, Polar, Vectors } from '../geometry/index.js';\n\n/**\n * Information about seen points\n */\nexport type PointTrack = Points.PointRelationResult & {\n  // readonly speedFromInitial:number\n};\n\n/**\n * Results of point tracking\n */\nexport type PointTrackerResults = {\n  /**\n   * Relation of last point to previous point\n   */\n  readonly fromLast: PointTrack;\n  /**\n   * Relation of last point to initial point.\n   * \n   * When the tracker is reset or resizes (eg. if it reaches its capacity), the\n   * initial point will be the first new point. Thus, the initial point\n   * always maintains some time horizon\n   */\n  readonly fromInitial: PointTrack;\n  readonly values: ReadonlyArray<Points.Point>;\n};\n\n/**\n * Point tracker. Create via `pointTracker()`.\n *\n */\nexport class PointTracker extends ObjectTracker<Points.Point, PointTrackerResults> {\n  /**\n   * Function that yields the relation from initial point\n   */\n  initialRelation: Points.PointRelation | undefined;\n\n  /**\n   * Last result\n   */\n  lastResult: PointTrackerResults | undefined;\n\n  constructor(opts: TrackOpts = {}) {\n    super(opts);\n  }\n\n  onTrimmed(): void {\n    // Force new relation calculations\n    this.initialRelation = undefined;\n  }\n\n  /**\n   * Returns the last x coord\n   */\n  get x() {\n    return this.last.x;\n  }\n\n  /**\n   * Returns the last y coord\n   */\n  get y() {\n    return this.last.y;\n  }\n\n  /**\n   * @ignore\n   */\n  onReset(): void {\n    super.onReset();\n    this.lastResult = undefined;\n    this.initialRelation = undefined;\n  }\n\n  seenEvent(p: PointerEvent): PointTrackerResults {\n    if (`getCoalescedEvents` in p) {\n      const events = p.getCoalescedEvents();\n      const asPoints = events.map(event => ({ x: event.clientX, y: event.clientY }));\n      return this.seen(...asPoints);\n    } else {\n      // @ts-expect-error\n      return this.seen({ x: p.clientX, y: p.clientY });\n    }\n  }\n\n  /**\n   * Tracks a point, returning data on its relation to the\n   * initial point and the last received point.\n   * \n   * Use {@link seenEvent} to track a raw `PointerEvent`.\n   * \n   * @param p Point\n   */\n  computeResults(\n    _p: Array<TimestampedObject<Points.Point>>\n  ): PointTrackerResults {\n    const currentLast = this.last;\n\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const previousLast = this.values.at(-2);\n\n    if (this.initialRelation === undefined && this.initial) {\n      // Don't yet have an initial relation function\n      this.initialRelation = Points.relation(this.initial);\n    } else if (this.initialRelation === undefined) {\n      // Don't have an initial relation, but also don't have an initial point :()\n      throw new Error(`Bug: No initialRelation, and this.inital is undefined?`);\n    }\n\n    // Make a new relator based on previous point\n    const lastRelation = previousLast === undefined ? Points.relation(currentLast) : Points.relation(previousLast);\n\n    // Compute relation from initial point to latest\n    const initialRel: PointTrack = this.initialRelation(currentLast);\n\n    const speed = previousLast === undefined ? 0 : Lines.length(previousLast, currentLast) / (currentLast.at - previousLast.at);\n\n    // Compute relation from current point to the previous\n    const lastRel: PointTrack = {\n      ...lastRelation(currentLast),\n      speed,\n    };\n\n    const r: PointTrackerResults = {\n      fromInitial: initialRel,\n      fromLast: lastRel,\n      values: [ ...this.values ],\n    };\n    this.lastResult = r;\n    return r;\n  }\n\n  /**\n   * Returns a polyline representation of stored points.\n   * Returns an empty array if points were not saved, or there's only one.\n   */\n  get line(): Lines.PolyLine {\n    if (this.values.length === 1) return [];\n    return Lines.joinPointsToLines(...this.values);\n  }\n\n  /**\n   * Returns a vector of the initial/last points of the tracker.\n   * Returns as a polar coordinate\n   */\n  get vectorPolar(): Polar.Coord {\n    return Vectors.fromLinePolar(this.lineStartEnd);\n  }\n\n  /**\n   * Returns a vector of the initial/last points of the tracker.\n   * Returns as a Cartesian coordinate\n   */\n  get vectorCartesian(): Points.Point {\n    return Vectors.fromLineCartesian(this.lineStartEnd);\n  }\n\n  /**\n   * Returns a line from initial point to last point.\n   *\n   * If there are less than two points, Lines.Empty is returned\n   */\n  get lineStartEnd(): Lines.Line {\n    const initial = this.initial;\n    if (this.values.length < 2 || !initial) return Lines.Empty;\n    return {\n      a: initial,\n      b: this.last,\n    };\n  }\n\n  /**\n   * Returns distance from latest point to initial point.\n   * If there are less than two points, zero is returned.\n   *\n   * This is the direct distance from initial to last,\n   * not the accumulated length.\n   * @returns Distance\n   */\n  distanceFromStart(): number {\n    const initial = this.initial;\n    return this.values.length >= 2 && initial !== undefined ? Points.distance(initial, this.last) : 0;\n  }\n\n  /**\n   * Difference between last point and the initial point, calculated\n   * as a simple subtraction of x & y.\n   *\n   * `Points.Placeholder` is returned if there's only one point so far.\n   */\n  difference(): Points.Point {\n    const initial = this.initial;\n    return this.values.length >= 2 && initial !== undefined ? Points.subtract(this.last, initial) : Points.Placeholder;\n  }\n\n  /**\n   * Returns angle (in radians) from latest point to the initial point\n   * If there are less than two points, undefined is return.\n   * @returns Angle in radians\n   */\n  angleFromStart(): number | undefined {\n    const initial = this.initial;\n    if (initial !== undefined && this.values.length > 2) {\n      return Points.angle(initial, this.last);\n    }\n  }\n\n  /**\n   * Returns the total length of accumulated points.\n   * Returns 0 if points were not saved, or there's only one\n   */\n  get length(): number {\n    if (this.values.length === 1) return 0;\n    const l = this.line;\n    return Lines.length(l);\n  }\n}\n\n/**\n * A {@link TrackedValueMap} for points. Uses {@link PointTracker} to\n * track added values.\n */\nexport class TrackedPointMap extends TrackedValueMap<\n  Points.Point,\n  PointTracker,\n  PointTrackerResults\n> {\n  constructor(opts: TrackOpts = {}) {\n    super((key, start) => {\n      if (start === undefined) throw new Error(`Requires start point`);\n      const p = new PointTracker({\n        ...opts,\n        id: key,\n      });\n      p.seen(start);\n      return p;\n    });\n  }\n\n  /**\n   * Track a PointerEvent\n   * @param event\n   */\n  seenEvent(event: PointerEvent): Promise<Array<PointTrackerResults>> {\n    if (`getCoalescedEvents` in event) {\n      const events = event.getCoalescedEvents();\n      const seens = events.map(subEvent => super.seen(subEvent.pointerId.toString(), subEvent));\n      return Promise.all(seens);\n    } else {\n      return Promise.all([ super.seen((event as PointerEvent).pointerId.toString(), event) ]);\n    }\n  }\n}\n\n/**\n * Track several named points over time, eg a TensorFlow body pose point.\n * Call `seen()` to track a point. Mutable. If you want to compare\n * a single coordinate with a reference coordinate,  may be a better choice.\n *\n * See also:\n * * [Geometry.Points.relation](Geometry.Points.relation.html): Compute relation info between two points\n * * [Data.pointTracker](Data.pointTracker-1.html): Track relation between points over time\n * * [Guide to Trackers](https://clinth.github.io/ixfx-docs/data/trackers/)\n * \n * Basic usage\n * ```js\n * import { pointsTracker } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * const pt = pointsTracker();\n *\n * // Track a point under a given id\n * document.addEventListener(`pointermove`, e => {\n *  const info = await pt.seen(e.pointerId, { x: e.x, y: e.y });\n *  // Yields some info on relation of the point to initial value\n * });\n * ```\n *\n * Do something with last values for all points\n * ```js\n * const c = Points.centroid(...Array.from(pt.last()));\n * ```\n *\n * More functions...\n * ```js\n * pt.size;       // How many named points are being tracked\n * pt.delete(id); // Delete named point\n * pt.reset();    // Clear data\n * ```\n *\n * Accessing by id:\n *\n * ```js\n * pt.get(id);  // Get named point (or _undefined_)\n * pt.has(id);  // Returns true if id exists\n * ```\n *\n * Iterating over data\n *\n * ```js\n * pt.trackedByAge(); // Iterates over tracked points, sorted by age (oldest first)\n * pt.tracked(); // Tracked values\n * pt.ids();     // Iterator over ids\n *\n * // Last received value for each named point\n * pt.last();\n *\n * pt.initialValues(); // Iterator over initial values for each point\n * ```\n *\n * You can work with 'most recently updated' points:\n *\n * ```js\n * // Iterates over points, sorted by age (oldest first)\n * pt.valuesByAge();\n * ```\n *\n * Options:\n * * `id`: Id of this tracker. Optional\n * * `sampleLimit`: How many samples to store\n * * `storeIntermediate`: If _true_, all points are stored internally\n * * `resetAfterSamples`: If set above 0, it will automatically reset after the given number of samples have been seen\n * @param opts\n * @returns\n */\nexport const pointsTracker = (opts: TrackOpts = {}) =>\n  new TrackedPointMap(opts);\n\n/**\n * A tracked point. Create via {@link pointTracker}. Mutable. Useful for monitoring how\n * it changes over time. Eg. when a pointerdown event happens, to record the start position and then\n * track the pointer as it moves until pointerup.\n *\n * See also\n * * [Playground](https://clinth.github.io/ixfx-play/data/point-tracker/index.html)\n * * {@link pointsTracker}: Track several points, useful for multi-touch.\n * * [Guide to Trackers](https://clinth.github.io/ixfx-docs/data/trackers/)\n * \n * ```js\n * import { pointTracker } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * // Create a tracker on a pointerdown\n * const t = pointTracker();\n *\n * // ...and later, tell it when a point is seen (eg. pointermove)\n * const nfo = t.seen({x: evt.x, y:evt.y});\n * // nfo gives us some details on the relation between the seen point, the start, and points inbetween\n * // nfo.angle, nfo.centroid, nfo.speed etc.\n * ```\n *\n * Compute based on last seen point\n * ```js\n * t.angleFromStart();\n * t.distanceFromStart();\n * t.x / t.y\n * t.length; // Total length of accumulated points\n * t.elapsed; // Total duration since start\n * t.lastResult; // The PointSeenInfo for last seen point\n * ```\n *\n * Housekeeping\n * ```js\n * t.reset(); // Reset tracker\n * ```\n *\n * By default, the tracker only keeps track of the initial point and\n * does not store intermediate 'seen' points. To use the tracker as a buffer,\n * set `storeIntermediate` option to _true_.\n *\n * ```js\n * // Keep only the last 10 points\n * const t = pointTracker({\n *  sampleLimit: 10\n * });\n *\n * // Store all 'seen' points\n * const t = pointTracker({\n *  storeIntermediate: true\n * });\n *\n * // In this case, the whole tracker is automatically\n * // reset after 10 samples\n * const t = pointTracker({\n *  resetAfterSamples: 10\n * })\n * ```\n *\n * When using a buffer limited by `sampleLimit`, the 'initial' point will be the oldest in the\n * buffer, not actually the very first point seen.\n */\nexport const pointTracker = (opts: TrackOpts = {}) => new PointTracker(opts);\n","import {\n  pointsTracker,\n} from '../data/PointTracker.js';\nimport { fullSizeElement, resolveEl as resolveElement } from './Util.js';\nimport * as Svg from '../visual/Svg.js';\n\nexport type Opts = {\n  readonly touchRadius?: number;\n  readonly mouseRadius?: number;\n  readonly trace?: boolean;\n  readonly hue?: number;\n};\n\n/**\n * Visualises pointer events within a given element.\n *\n * ```js\n * // Show pointer events for whole document\n * pointerVis(document);\n * ```\n *\n * Note you may need to set the following CSS properties on the target element:\n *\n * ```css\n * touch-action: none;\n * user-select: none;\n * overscroll-behavior: none;\n * ```\n *\n * Options\n * * touchRadius/mouseRadius: size of circle for these kinds of pointer events\n * * trace: if true, intermediate events are captured and displayed\n * @param elOrQuery\n * @param opts\n */\nexport const pointerVisualise = (\n  //eslint-disable-next-line functional/prefer-immutable-types\n  elOrQuery: HTMLElement | string,\n  opts: Opts = {}\n) => {\n  const touchRadius = opts.touchRadius ?? 45;\n  const mouseRadius = opts.touchRadius ?? 20;\n  const trace = opts.trace ?? false;\n  const hue = opts.hue ?? 100;\n\n  const startFillStyle = `hsla(${ hue }, 100%, 10%, 10%)`;\n\n  //eslint-disable-next-line functional/no-let\n  let currentHue = hue;\n\n  const el = resolveElement(elOrQuery);\n  const tracker = pointsTracker({\n    storeIntermediate: trace,\n  });\n\n  //eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const svg = document.createElementNS(\n    `http://www.w3.org/2000/svg`,\n    `svg`\n  ) as any as SVGElement & HTMLElement;\n  //eslint-disable-next-line functional/immutable-data\n  svg.id = `pointerVis`;\n  svg.style.zIndex = `-1000`;\n  svg.style.position = `fixed`;\n  svg.style.top = `0`;\n  svg.style.left = `0`;\n  svg.style.width = `100%`;\n  svg.style.height = `100%`;\n  svg.style.boxSizing = `border-box`;\n  svg.style.border = `3px solid red`;\n  svg.style.pointerEvents = `none`;\n  svg.style.touchAction = `none`;\n\n  fullSizeElement(svg);\n  let pointerCount = 0;\n\n  //eslint-disable-next-line functional/prefer-immutable-types\n  const lostPointer = (event: PointerEvent) => {\n    const id = event.pointerId.toString();\n    tracker.delete(id);\n    currentHue = hue;\n    svg.querySelector(`#pv-start-${ id }`)?.remove();\n\n    for (let index = 0; index < pointerCount + 10; index++) {\n      svg.querySelector(`#pv-progress-${ id }-${ index }`)?.remove();\n    }\n    pointerCount = 0;\n  };\n\n  const trackPointer = async (event: PointerEvent) => {\n    const id = event.pointerId.toString();\n    const pt = { x: event.x, y: event.y };\n    const type = event.pointerType;\n    if (event.type === `pointermove` && !tracker.has(id)) {\n      return;\n    }\n    const info = (await tracker.seen(event.pointerId.toString(), { x: event.clientX, y: event.clientY }));\n\n    if (info.values.length === 1) {\n      const el = Svg.Elements.circle(\n        {\n          ...info.values[ 0 ],\n          radius: type === `touch` ? touchRadius : mouseRadius,\n        },\n        svg,\n        {\n          fillStyle: startFillStyle,\n        },\n        `#pv-start-${ id }`\n      );\n      el.style.pointerEvents = `none`;\n      el.style.touchAction = `none`;\n    }\n\n    const fillStyle = `hsla(${ currentHue }, 100%, 50%, 50%)`;\n\n    const el2 = Svg.Elements.circle(\n      { ...pt, radius: type === `touch` ? touchRadius : mouseRadius },\n      svg,\n      {\n        fillStyle,\n      },\n      `#pv-progress-${ id }-${ info.values.length }`\n    );\n    el2.style.pointerEvents = `none`;\n    el2.style.touchAction = `none`;\n    currentHue += 1;\n    pointerCount = info.values.length;\n  };\n\n  document.body.append(svg);\n\n  // eslint-disable-next-line @typescript-eslint/no-misused-promises\n  el.addEventListener(`pointerdown`, trackPointer);\n  // eslint-disable-next-line @typescript-eslint/no-misused-promises\n  el.addEventListener(`pointermove`, trackPointer);\n  el.addEventListener(`pointerup`, lostPointer);\n  el.addEventListener(`pointerleave`, lostPointer);\n  el.addEventListener(`contextmenu`, (event) => {\n    event.preventDefault();\n  });\n};\n","/**\n * Creates an error handler to show errors on-screen.\n * This is useful when testing on mobile devices that lack access to the console.\n *\n * ```js\n * const e = defaultErrorHandler();\n * ```\n *\n * Manual control:\n * ```js\n * const e = defaultErrorHandler();\n * e.show(someError);\n * e.hide();\n * ```\n * @returns\n */\nexport const defaultErrorHandler = () => {\n  //eslint-disable-next-line functional/no-let\n  let enabled = true;\n  const container = document.createElement(`div`);\n  container.style.color = `black`;\n  container.style.border = `2px solid red`;\n  container.style.backgroundColor = `hsl(0, 80%, 90%)`;\n  container.style.padding = `1em`;\n  container.style.display = `none`;\n  container.style.top = `1em`;\n  container.style.left = `1em`;\n  container.style.position = `absolute`;\n\n  container.style.fontFamily = `monospace`;\n\n  const messageElement = document.createElement(`div`);\n  messageElement.style.maxWidth = `50vw`;\n  messageElement.style.maxHeight = `50vh`;\n  messageElement.style.overflowY = `scroll`;\n\n  container.innerHTML = `<h1>Error</h1>`;\n  container.append(messageElement);\n\n  const styleButton = (b: HTMLButtonElement) => {\n    b.style.padding = `0.3em`;\n    b.style.marginTop = `1em`;\n  };\n\n  const buttonClose = document.createElement(`button`);\n  buttonClose.textContent = `Close`;\n  buttonClose.addEventListener(`click`, () => {\n    hide();\n  });\n\n  const buttonStop = document.createElement(`button`);\n  buttonStop.textContent = `Stop displaying errors`;\n  buttonStop.addEventListener(`click`, () => {\n    enabled = false;\n    hide();\n  });\n\n  styleButton(buttonClose);\n  styleButton(buttonStop);\n\n  container.append(buttonClose);\n  container.append(buttonStop);\n  document.body.append(container);\n\n  const show = (ex: Error | string | Event) => {\n    container.style.display = `inline`;\n    messageElement.innerHTML += (ex as any).stack ? `<pre>${ (ex as any).stack }</pre>` : `<p>${ ex.toString() }</p>`;\n  };\n\n  const hide = () => {\n    container.style.display = `none`;\n  };\n\n  window.onerror = (message, url, lineNo, colNo, error) => {\n    if (enabled) {\n      if (error) {\n        console.log(error);\n        show(error);\n      } else {\n        console.log(message);\n        show(message);\n      }\n    }\n  };\n\n  window.addEventListener(`unhandledrejection`, (event) => {\n    console.log(event.reason);\n    if (enabled) {\n      show(event.reason);\n    }\n  });\n  return { show, hide };\n};\n","import { Points } from '../geometry/index.js';\n\nexport type DragState = {\n  readonly token?: object;\n  readonly initial: Points.Point;\n  readonly delta: Points.Point;\n};\n\nexport type DragStart = {\n  readonly allow: boolean;\n  readonly token: object;\n};\nexport type DragListener = {\n  readonly start?: () => DragStart;\n  readonly progress?: (state: DragState) => boolean;\n  readonly abort?: (reason: string, state: DragState) => void;\n  readonly success?: (state: DragState) => void;\n};\n\n//eslint-disable-next-line functional/prefer-immutable-types\nexport const draggable = (elem: SVGElement, listener: DragListener) => {\n  //eslint-disable-next-line functional/no-let\n  let initial = Points.Placeholder;\n  //eslint-disable-next-line functional/no-let\n  let token: object;\n\n  // De-select if there's a click elsewhere\n  const onParentClick = () => {\n    const selected = elem.classList.contains(`drag-sel`);\n    if (selected) {\n      elem.classList.remove(`drag-sel`);\n    }\n  };\n\n  // Click to select\n  //eslint-disable-next-line functional/prefer-immutable-types\n  const onElementClick = (evt: MouseEvent) => {\n    const selected = elem.classList.contains(`drag-sel`);\n    if (selected) {\n      elem.classList.remove(`drag-sel`);\n    } else {\n      elem.classList.add(`drag-sel`);\n    }\n    evt.stopPropagation();\n  };\n\n  elem.ownerDocument.addEventListener(`click`, onParentClick);\n  elem.addEventListener(`click`, onElementClick);\n\n  // Remove event handlers\n  const dragCleanup = () => {\n    elem.classList.remove(`drag-progress`);\n\n    elem.ownerDocument.removeEventListener(`pointermove`, onPointerMove);\n    elem.ownerDocument.removeEventListener(`pointerup`, onPointerUp);\n    elem.ownerDocument.removeEventListener(`pointercancel`, onDragCancel);\n  };\n\n  const dispose = () => {\n    console.log(`drag dispose`);\n    if (elem.classList.contains(`drag-progress`)) {\n      onDragCancel(null, `dispose`);\n    } else {\n      dragCleanup();\n    }\n    elem.ownerDocument.removeEventListener(`click`, onParentClick);\n    elem.removeEventListener(`click`, onElementClick);\n  };\n\n  // Dragging\n  //eslint-disable-next-line functional/prefer-immutable-types\n  const onPointerMove = (e: PointerEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    const offset = Points.isPlaceholder(initial)\n      ? { x: e.offsetX, y: e.offsetY }\n      : {\n          x: e.x - initial.x,\n          y: e.y - initial.y,\n        };\n    const state: DragState = {\n      delta: offset,\n      initial: initial,\n      token,\n    };\n    if (typeof listener.progress !== `undefined` && !listener.progress(state)) {\n      onDragCancel(null, `discontinued`);\n    }\n  };\n\n  // Done dragging\n  //eslint-disable-next-line functional/prefer-immutable-types\n  const onPointerUp = (e: PointerEvent) => {\n    dragCleanup();\n    const offset = {\n      x: e.x - initial.x,\n      y: e.y - initial.y,\n    };\n    const state: DragState = {\n      initial: initial,\n      token,\n      delta: offset,\n    };\n    if (typeof listener.success !== `undefined`) {\n      listener.success(state);\n    }\n  };\n\n  // Drag is cancelled\n  const onDragCancel = (\n    //eslint-disable-next-line functional/prefer-immutable-types\n    evt: PointerEvent | MouseEvent | null,\n    reason: string = `pointercancel`\n  ) => {\n    dragCleanup();\n    const state: DragState = {\n      token,\n      initial: initial,\n      delta: { x: -1, y: -1 },\n    };\n    if (typeof listener.abort !== `undefined`) {\n      listener.abort(reason, state);\n    }\n  };\n\n  elem.addEventListener(`pointerdown`, (evt) => {\n    const selected = elem.classList.contains(`drag-sel`);\n    if (!selected) return;\n\n    initial = { x: evt.x, y: evt.y };\n    const s =\n      typeof listener.start !== `undefined`\n        ? listener.start()\n        : { allow: true, token };\n    if (!s.allow) return;\n\n    token = s.token;\n\n    elem.classList.add(`drag-progress`);\n    elem.ownerDocument.addEventListener(`pointermove`, onPointerMove);\n    elem.ownerDocument.addEventListener(`pointerup`, onPointerUp);\n    elem.ownerDocument.addEventListener(`pointercancel`, onDragCancel);\n  });\n\n  return dispose;\n};\n","import { afterMatch } from '../Text.js';\nimport { log, type LogOpts } from './Log.js';\n\nexport type InlineConsoleOptions = LogOpts;\n\n/**\n * Adds an inline console to the page. A DIV is added to display log messages.\n * \n * Captures all console.log, console.warn and console.error calls, as well as unhandled exceptions.\n * \n * ```js\n * // Adds the DIV and intercepts console logs\n * inlineConsole();\n * \n * console.log(`Hello`); // message is displayed in the inline console\n * ```\n * @param opts \n */\nexport const inlineConsole = (opts: InlineConsoleOptions = {}) => {\n  const original = {\n    log: console.log,\n    error: console.error,\n    warn: console.warn\n  };\n\n  const logElement = document.createElement(`DIV`);\n  logElement.id = `ixfx-log`;\n  logElement.style.position = `fixed`;\n  logElement.style.left = `0px`;\n  logElement.style.top = `0px`;\n  logElement.style.pointerEvents = `none`;\n  logElement.style.display = `none`;\n\n  document.body.prepend(logElement);\n\n  const logger = log(logElement, opts);\n\n  const visibility = (show: boolean) => {\n    logElement.style.display = show ? `block` : `none`;\n  }\n\n  console.error = (message?: any, ...optionalParameters: Array<any>) => {\n    logger.error(message);\n    if (optionalParameters.length > 0) {\n      logger.error(optionalParameters);\n    }\n    original.error(message, ...optionalParameters);\n    visibility(true);\n  }\n\n  console.warn = (message?: any, ...optionalParameters: Array<any>) => {\n    logger.warn(message);\n    if (optionalParameters.length > 0) {\n      logger.warn(optionalParameters);\n    }\n    visibility(true);\n  }\n\n  console.log = (message?: any, ...optionalParameters: Array<any>) => {\n    logger.log(message);\n    if (optionalParameters.length > 0) {\n      logger.log(optionalParameters);\n    }\n    original.log(message, ...optionalParameters);\n    visibility(true);\n  }\n\n  //eslint-disable-next-line unicorn/prefer-add-event-listener\n  window.onerror = (event, source, lineno, _colno, error) => {\n    const abbreviatedSource = source === undefined ? `` : afterMatch(source, `/`, { fromEnd: true });\n    const eventString = typeof event === `string` ? event : event.toString();\n    //const errorString = error === undefined ? `` : error.message;\n\n    logger.error(eventString + ` (${ abbreviatedSource }:${ lineno })`);\n    visibility(true);\n  }\n}","/// ✔ Unit tested!\n\nimport { type ToString } from '../Util.js';\nimport { SimpleEventEmitter } from '../Events.js';\nimport * as KeyValueUtil from '../KeyValue.js';\nimport { KeyValues } from '../index.js';\n\nexport type FrequencyEventMap = {\n  readonly change: void;\n};\n\nexport class FrequencyMutable<V> extends SimpleEventEmitter<FrequencyEventMap> {\n  readonly #store: Map<string, number>;\n  readonly #keyString: ToString<V>;\n\n  /**\n   * Constructor\n   * @param keyString Function to key items. Uses JSON.stringify by default\n   */\n  constructor(keyString: ToString<V> | undefined = undefined) {\n    super();\n    this.#store = new Map();\n\n    if (keyString === undefined) {\n      keyString = (a) => {\n        if (a === undefined) throw new Error(`Cannot create key for undefined`);\n        if (typeof a === `string`) {\n          return a;\n        } else {\n          return JSON.stringify(a);\n        }\n      };\n    }\n    this.#keyString = keyString;\n  }\n\n  /**\n   * Clear data. Fires `change` event\n   */\n  clear() {\n    this.#store.clear();\n    this.fireEvent(`change`, undefined);\n  }\n\n  /**\n   * @returns Iterator over keys (ie. groups)\n   */\n  keys(): IterableIterator<string> {\n    return this.#store.keys();\n  }\n\n  /**\n   * @returns Iterator over frequency counts\n   */\n  values(): IterableIterator<number> {\n    return this.#store.values();\n  }\n\n  /**\n   * @returns Copy of entries as an array of `[key, count]`\n   */\n  toArray(): [key: string, count: number][] {\n    return Array.from(this.#store.entries());\n  }\n\n  /**\n   * Returns a string with keys and counts, useful for debugging.\n   * @returns\n   */\n  debugString(): string {\n    //eslint-disable-next-line functional/no-let\n    let t = ``;\n    for (const [key, count] of this.#store.entries()) {\n      t += `${key}: ${count}, `;\n    }\n    if (t.endsWith(`, `)) return t.substring(0, t.length - 2);\n    return t;\n  }\n\n  /**\n   *\n   * @param value Value to count\n   * @returns Frequency of value, or _undefined_ if it does not exist\n   */\n  frequencyOf(value: V | string): number | undefined {\n    if (typeof value === `string`) return this.#store.get(value);\n\n    const key = this.#keyString(value);\n    return this.#store.get(key);\n  }\n\n  /**\n   *\n   * @param value Value to count\n   * @returns Relative frequency of `value`, or _undefined_ if it does not exist\n   */\n  relativeFrequencyOf(value: V | string): number | undefined {\n    //eslint-disable-next-line functional/no-let\n    let freq: number | undefined;\n    if (typeof value === `string`) freq = this.#store.get(value);\n    else {\n      const key = this.#keyString(value);\n      freq = this.#store.get(key);\n    }\n    if (freq === undefined) return;\n\n    const mma = this.minMaxAvg();\n    return freq / mma.total;\n  }\n\n  /**\n   * @returns Copy of entries as an array\n   */\n  entries(): Array<KeyValueUtil.KeyValue> {\n    return Array.from(this.#store.entries());\n  }\n\n  /**\n   *\n   * @returns Returns `{min,max,avg,total}`\n   */\n  minMaxAvg() {\n    return KeyValues.minMaxAvg(this.entries());\n  }\n\n  /**\n   *\n   * @param sortStyle Sorting style (default: _value_, ie. count)\n   * @returns Sorted array of [key,frequency]\n   */\n  entriesSorted(\n    sortStyle: `value` | `valueReverse` | `key` | `keyReverse` = `value`\n  ): ReadonlyArray<KeyValues.KeyValue> {\n    const s = KeyValueUtil.getSorter(sortStyle);\n    return s(this.entries());\n  }\n\n  /**\n   *\n   * @param values Values to add. Fires _change_ event after adding item(s)\n   */\n  //eslint-disable-next-line functional/prefer-immutable-types\n  add(...values: V[]) {\n    if (values === undefined) throw new Error(`value parameter is undefined`);\n\n    const keys = values.map(this.#keyString);\n\n    //const key = this.#keyString(value);\n    keys.forEach((key) => {\n      const score = this.#store.get(key) ?? 0;\n      this.#store.set(key, score + 1);\n    });\n    this.fireEvent(`change`, undefined);\n  }\n}\n\n/**\n * Frequency keeps track of how many times a particular value is seen, but\n * unlike a Map it does not store the data. By default compares\n * items by value (via JSON.stringify).\n *\n * Create with {@link frequencyMutable}.\n *\n * Fires `change` event when items are added or it is cleared.\n *\n * Overview\n * ```\n * const fh = frequencyMutable();\n * fh.add(value); // adds a value\n * fh.clear();    // clears all data\n * fh.keys() / .values() // returns an iterator for keys and values\n * fh.toArray();  //  returns an array of data in the shape [[key,freq],[key,freq]...]\n * ```\n *\n * Usage\n * ```\n * const fh = frequencyMutable();\n * fh.add(`apples`); // Count an occurence of `apples`\n * fh.add(`oranges)`;\n * fh.add(`apples`);\n *\n * const fhData = fh.toArray(); // Expect result [[`apples`, 2], [`oranges`, 1]]\n * fhData.forEach((d) => {\n *  const [key,freq] = d;\n *  console.log(`Key '${key}' occurred ${freq} time(s).`);\n * })\n * ```\n *\n * Custom key string\n * ```\n * const fh = frequencyMutable( person => person.name);\n * // All people with name `Samantha` will be counted in same group\n * fh.add({name:`Samantha`, city:`Brisbane`});\n * ```\n * @template V Type of items\n */\nexport const frequencyMutable = <V>(keyString?: ToString<V> | undefined) =>\n  new FrequencyMutable<V>(keyString);\n","import { average, averageWeighted } from '../collections/NumericArrays.js';\nimport { QueueMutable } from '../collections/queue/QueueMutable.js';\nimport { throwNumberTest } from '../Guards.js';\n\n/**\n * A moving average calculator (exponential weighted moving average) which does not keep track of\n * previous samples. Less accurate, but uses less system resources.\n *\n * The `scaling` parameter determines smoothing. A value of `1` means that\n * the latest value is used as the average - that is, no smoothing. Higher numbers\n * introduce progressively more smoothing by weighting the accumulated prior average more heavily.\n *\n * `add()` adds a new value and returns the calculated average.\n *\n * ```\n * const ma = movingAverageLight(); // default scaling of 3\n * ma.add(50);  // 50\n * ma.add(100); // 75\n * ma.add(75);  // 75\n * ma.add(0);   // 50\n * ```\n *\n * Note that the final average of 50 is pretty far from the last value of 0. To make it more responsive,\n * we could use a lower scaling factor: `movingAverageLight(2)`. This yields a final average of `37.5` instead.\n *\n * Use `clear()` to reset the moving average, or `compute()` to get the current value without adding.\n * @param scaling Scaling factor. 1 is no smoothing. Default: 3\n * @returns {@link MovingAverage}\n */\nexport const movingAverageLight = (scaling = 3): MovingAverage => {\n  throwNumberTest(scaling, `aboveZero`, `scaling`);\n  //eslint-disable-next-line functional/no-let\n  let average = 0;\n  //eslint-disable-next-line functional/no-let\n  let count = 0;\n\n  //eslint-disable-next-line functional/no-let\n  let disposed = false;\n  const ma: MovingAverage = {\n    dispose() {\n      disposed = true;\n    },\n    get isDisposed() {\n      return disposed;\n    },\n    add(v: number) {\n      if (disposed) throw new Error(`MovingAverage disposed, cannot add`);\n      count++;\n      average = average + (v - average) / Math.min(count, scaling);\n      return average;\n    },\n    clear() {\n      if (disposed) throw new Error(`MovingAverage disposed, cannot clear`);\n      average = 0;\n      count = 0;\n    },\n    compute() {\n      return average;\n    },\n  };\n  return ma;\n};\n\n/**\n * Uses the same algorithm as {@link movingAverageLight}, but adds values automatically if\n * nothing has been manually added.\n *\n * This is useful if you are averaging something based on events. For example calculating the\n * average speed of the pointer. If there is no speed, there is no pointer move event. Using\n * this function, `value` is added at a rate of `updateRateMs`. This timer is reset\n * every time a value is added, a bit like the `debounce` function.\n * @param updateRateMs\n * @param value\n * @param scaling\n * @returns\n */\nexport const movingAverageTimed = (\n  updateRateMs = 200,\n  value = 0,\n  scaling = 3\n): MovingAverage => {\n  throwNumberTest(scaling, `aboveZero`, `scaling`);\n  throwNumberTest(updateRateMs, `aboveZero`, `decayRateMs`);\n\n  const mal = movingAverageLight(scaling);\n\n  //eslint-disable-next-line functional/no-let\n  let timer = 0;\n\n  const reschedule = () => {\n    if (timer !== 0) clearTimeout(timer);\n    // eslint-disable-next-line @typescript-eslint/prefer-ts-expect-error\n    // @ts-ignore\n    timer = setTimeout(decay, updateRateMs) as number;\n  };\n\n  const decay = () => {\n    mal.add(value);\n    if (!mal.isDisposed) setTimeout(decay, updateRateMs);\n  };\n\n  const ma: MovingAverage = {\n    add(v: number) {\n      reschedule();\n      return mal.add(v);\n    },\n\n    dispose() {\n      mal.dispose();\n    },\n    clear: function (): void {\n      mal.clear();\n    },\n    compute: function (): number {\n      return mal.compute();\n    },\n    isDisposed: false,\n  };\n\n  return ma;\n};\n\n/**\n * Creates a moving average for a set number of `samples`.\n *\n * Moving average are useful for computing the average over a recent set of numbers.\n * A lower number of samples produces a computed value that is lower-latency yet more jittery.\n * A higher number of samples produces a smoother computed value which takes longer to respond to\n * changes in data.\n *\n * Sample size is considered with respect to the level of latency/smoothness trade-off, and also\n * the rate at which new data is added to the moving average.\n *\n * `add` adds a number and returns the computed average. Call `compute` to\n * get the average without adding a new value.\n *\n * ```js\n * import { movingAverage } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * const ma = movingAverage(10);\n * ma.add(10); // 10\n * ma.add(5);  // 7.5\n * ```\n *\n * `clear` clears the average.\n *\n * A weighting function can be provided to shape how the average is\n * calculated - eg privileging the most recent data over older data.\n * It uses `Arrays.averageWeighted` under the hood.\n *\n * ```js\n * import { movingAverage } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * // Give more weight to data in middle of sampling window\n * const ma = movingAverage(100, Easings.gaussian());\n * ```\n *\n * Because it keeps track of `samples` previous data, there is a memory impact. A lighter version is {@link movingAverageLight} which does not keep a buffer of prior data, but can't be as easily fine-tuned.\n * @param samples Number of samples to compute average from\n * @param weighter Optional weighting function\n * @returns\n */\nexport const movingAverage = (\n  samples = 100,\n  weighter?: (v: number) => number\n): MovingAverage => {\n  //eslint-disable-next-line functional/no-let\n  let disposed = false;\n\n  //eslint-disable-next-line functional/no-let\n  let q = new QueueMutable<number>({\n    capacity: samples,\n    discardPolicy: `older`,\n  });\n\n  const clear = () => {\n    q = new QueueMutable<number>({\n      capacity: samples,\n      discardPolicy: `older`,\n    });\n  };\n\n  const compute = () => {\n    return weighter === undefined ? average(q.data) : averageWeighted(q.data, weighter);\n  };\n\n  const add = (v: number) => {\n    q.enqueue(v);\n    return compute();\n  };\n\n  const dispose = () => {\n    disposed = true;\n  };\n\n  return { add, compute, clear, dispose, isDisposed: disposed };\n};\n\n/**\n * Moving average.\n * Create via {@link movingAverage} or {@link movingAverageLight}.\n */\nexport type MovingAverage = {\n  /**\n   * Clear data\n   */\n  clear(): void;\n  /**\n   * Returns current average\n   */\n  compute(): number;\n  /**\n   * Adds a value, returning new average\n   * @param v Value to add\n   */\n  add(v: number): number;\n\n  dispose(): void;\n  get isDisposed(): boolean;\n};\n\nconst PiPi = Math.PI * 2;\n\nconst smoothingFactor = (timeDelta: number, cutoff: number): number => {\n  const r = PiPi * cutoff * timeDelta;\n  return r / (r + 1);\n}\n\nconst exponentialSmoothing = (smoothingFactor: number, value: number, previous: number): number => {\n  return smoothingFactor * value + (1 - smoothingFactor) * previous\n}\n\n/**\n * Noise filtering\n * \n * Algorithm: https://gery.casiez.net/1euro/\n * \n * Based on [Jaan Tollander de Balsch's implementation](https://jaantollander.com/post/noise-filtering-using-one-euro-filter/)\n * @param cutoffMin \n * @param speedCoefficient \n * @param cutoffDefault \n */\nexport const noiseFilter = (cutoffMin = 1, speedCoefficient = 0, cutoffDefault = 1) => {\n  let previousValue = 0;\n  let derivativeLast = 0;\n  let timestampLast = 0;\n\n  const compute = (value: number, timestamp?: number) => {\n    if (timestamp === undefined) timestamp = performance.now();\n    const timeDelta = timestamp - timestampLast;\n\n    // Filtered derivative\n    const s = smoothingFactor(timeDelta, cutoffDefault);\n    const valueDelta = (value - previousValue) / timeDelta;\n    const derivative = exponentialSmoothing(s, valueDelta, derivativeLast);\n\n    // Filtered signal\n    const cutoff = cutoffMin + speedCoefficient * Math.abs(derivative);\n    const a = smoothingFactor(timeDelta, cutoff);\n    const smoothed = exponentialSmoothing(a, value, previousValue);\n\n    previousValue = smoothed;\n    derivativeLast = derivative;\n    timestampLast = timestamp;\n\n    return smoothed;\n  }\n  return compute;\n}","import { NumberTracker } from './NumberTracker.js';\nimport { type TrackedValueOpts as TrackOpts } from './TrackedValue.js';\n\n/**\n * A `Tracker` that tracks interval between calls to `mark()`\n *\n * @export\n * @class IntervalTracker\n * @extends {ValueTracker}\n */\nexport class IntervalTracker extends NumberTracker {\n  lastMark = 0;\n\n  mark() {\n    if (this.lastMark > 0) {\n      this.seen(window.performance.now() - this.lastMark);\n    }\n    this.lastMark = window.performance.now();\n  }\n}\n\n/**\n * Returns a new {@link IntervalTracker} instance. IntervalTracker\n * records the interval between each call to `mark`.\n *\n * ```js\n * import { intervalTracker } from 'https://unpkg.com/ixfx/dist/data.js';\n *\n * const t = intervalTracker();\n *\n * // Call `mark` to record an interval\n * t.mark();\n * ...\n * t.mark();\n *\n * // Get average time in milliseconds between calls to `mark`\n * t.avg;\n *\n * // Longest and shortest times are available too...\n * t.min / t.max\n * ```\n *\n * Interval tracker can automatically reset after a given number of samples:\n *\n * ```\n * // Reset after 100 samples\n * const t = intervalTracker({ resetAfterSamples: 100} );\n * ```\n * @param opts Options for tracker\n * @returns New interval tracker\n */\nexport const intervalTracker = (opts?: TrackOpts) => new IntervalTracker(opts);\n","import { type NumberFunction } from './index.js';\nimport { throwNumberTest } from '../Guards.js';\n\n/**\n * Flips a percentage-scale number: `1 - v`.\n *\n * The utility of this function is that it sanity-checks\n * that `v` is in 0..1 scale.\n *\n * ```js\n * flip(1);   // 0\n * flip(0.5); // 0.5\n * flip(0);   // 1\n * ```\n * @param v\n * @returns\n */\nexport const flip = (v: number | NumberFunction) => {\n  if (typeof v === `function`) v = v();\n  throwNumberTest(v, `percentage`, `v`);\n  return 1 - v;\n};\n","import { intervalToMs, type Interval } from \"../flow/IntervalType.js\";\nimport { DispatchList, type Dispatch } from \"../flow/DispatchList.js\"\nimport * as Immutable from '../Immutable.js';\nimport { QueueMutable } from \"../collections/index.js\";\nimport * as DiGraph from \"./graphs/DirectedGraph.js\";\n\ntype Optional<T, K extends keyof T> = Pick<Partial<T>, K> & Omit<T, K>;\n\nexport type SignalKinds = `done`;\nexport type Passed<V> = {\n  value: V | undefined\n  signal?: SignalKinds\n  context?: string\n}\n\nexport type PassedSignal = Passed<any> & {\n  value: undefined\n  signal: `done`\n  context: string\n}\n\nexport type PassedValue<V> = Passed<V> & {\n  value: V\n}\n\nexport function isSignal<V>(v: Passed<V> | PassedSignal): v is PassedSignal {\n  if (v.value !== undefined) return false;\n  if (`signal` in v && v.signal !== undefined) return true;\n  return false;\n}\n\n/**\n * Returns _true_ if `v` has a non-undefined value. Note that sometimes\n * _undefined_ is a legal value to pass\n * @param v \n * @returns \n */\nexport function hasValue<V>(v: Passed<V> | PassedSignal): v is PassedValue<V> {\n  if (v.value !== undefined) return true;\n  return false;\n}\n\nexport type Reactive<V> = {\n  /**\n   * Subscribes to a reactive.\n   * Return result unsubscribes.\n   * @param handler \n   */\n  on(handler: (value: Passed<V>) => void): () => void\n}\n\nexport type ReactiveNonInitial<V> = Reactive<V> & {\n  last(): V | undefined\n}\n\nexport type ReactiveWritable<V> = {\n  set(value: V): void\n}\n\nexport type ReactiveInitial<V> = Reactive<V> & {\n  last(): V\n}\n\nexport type ReactiveDisposable = {\n  dispose(reason: string): void\n  isDisposed(): boolean\n}\n\nexport type ReactiveFinite = {\n  isDone(): boolean\n\n}\n\n// export type ReactiveCloseable = ReactiveFinite & {\n//   close(reason: string): void\n// }\n\nexport type ReactiveDiff<V> = ReactiveDisposable & ReactiveWritable<V> & {\n  onDiff(handler: (changes: Passed<Array<Immutable.Change<any>>>) => void): void\n  update(changedPart: Record<string, any>): void\n  updateField(field: string, value: any): void\n}\n\n// export function readable<V>(): ReactiveDisposable & Reactive<V> {\n//   const events = initEvent<V>();\n//   let disposed = false;\n//   return {\n//     dispose(reason) {\n//       if (disposed) return;\n//       disposed = true;\n//       events.signal(`done`, `Closed: ${ reason }`);\n//     },\n//     isDisposed() {\n//       return disposed;\n//     },\n//     on: events.on\n//   }\n// }\n\nexport function number(initialValue: number): ReactiveDisposable & ReactiveWritable<number> & ReactiveInitial<number>;\nexport function number(): ReactiveDisposable & ReactiveWritable<number> & ReactiveNonInitial<number>;\nexport function number(initialValue?: number): ReactiveDisposable & ReactiveWritable<number> & (ReactiveNonInitial<number> | ReactiveInitial<number>) {\n  let value = initialValue;\n  const events = initEvent<number>();\n\n  const set = (v: number) => {\n    value = v;\n    events.notify(v);\n  }\n\n  return {\n    dispose: events.dispose,\n    isDisposed: events.isDisposed,\n    last: () => value,\n    on: events.on,\n    set\n  }\n}\n\n/**\n * Monitors input reactive values, storing values as they happen to an array.\n * Whenever a new value is emitted, the whole array is sent out, containing current\n * values from each source.\n * \n * @param values \n * @returns \n */\nexport function mergeAsArray<V>(...values: Array<Reactive<V>>): Reactive<Array<V | undefined>> {\n  const event = initEvent<Array<V | undefined>>();\n  const data: Array<V | undefined> = [];\n\n  for (const [ index, v ] of values.entries()) {\n    data[ index ] = undefined;\n    v.on(valueChanged => {\n      if (!isSignal(valueChanged)) {\n        data[ index ] = valueChanged.value;\n      }\n      event.notify(data);\n    });\n  }\n\n  return {\n    on: event.on\n  }\n}\n\n/**\n * Waits for all sources to produce a value, sending the combined results as an array.\n * After sending, it waits again for each source to send a value.\n * \n * Each source's latest value is returned, in the case of some sources producing results\n * faster than others.\n * \n * If a value completes, we won't wait for it and the result set gets smaller.\n * @param sources \n * @returns \n */\nexport function synchronise<V>(...sources: Array<Reactive<V>>): Reactive<Array<V | undefined>> {\n  const event = initEvent<Array<V>>();\n  let data: Array<V | undefined> = [];\n\n  for (const [ index, v ] of sources.entries()) {\n    data[ index ] = undefined;\n    v.on(valueChanged => {\n      if (isSignal(valueChanged)) {\n        if (valueChanged.signal === `done`) {\n          sources.splice(index, 1);\n        }\n        return;\n      }\n      data[ index ] = valueChanged.value;\n\n      if (!data.includes(undefined)) {\n        // All array elements contain values\n        event.notify(data as Array<V>);\n        data = [];\n      }\n    });\n  }\n\n  return {\n    on: event.on\n  }\n}\n\n\n\nexport type ResolveAfterOptions = {\n  loops?: number\n  infinite?: boolean\n}\n\nexport function resolveAfter<V extends Record<string, any>>(interval: Interval, callbackOrValue: V | (() => V), options: ResolveAfterOptions = {}): Reactive<V> {\n  const intervalMs = intervalToMs(interval, 0);\n  const event = initEvent<V>();\n  const loops = options.infinite ? Number.MAX_SAFE_INTEGER : options.loops ?? 1;\n  let remaining = loops;\n\n  const run = () => {\n    if (typeof callbackOrValue === `function`) {\n      const value = callbackOrValue();\n      event.notify(value);\n    } else {\n      event.notify(callbackOrValue);\n    }\n    remaining--;\n    if (remaining > 0) {\n      setTimeout(run, intervalMs);\n    }\n  }\n  setTimeout(run, intervalMs);\n\n  const r: Reactive<V> = {\n    on: event.on\n  }\n  return r;\n}\n\nexport type EventOptions<V> = {\n  process: (args?: Event | undefined) => V\n  lazy?: boolean\n}\n\nexport function event<V extends Record<string, any>, EventName extends string>(target: EventTarget, name: EventName, options: EventOptions<V>): ReactiveInitial<V> & ReactiveDisposable;\n\nexport function event<V extends Record<string, any>, EventName extends string>(target: EventTarget, name: EventName, options?: Optional<EventOptions<V>, `process`>): ReactiveNonInitial<V> & ReactiveDisposable;\n\n/**\n * Subscribes to an event, emitting data\n * @param target Event emitter\n * @param name Event name\n * @param options Options\n * @returns \n */\nexport function event<V extends Record<string, any>, EventName extends string>(target: EventTarget, name: EventName, options: Partial<EventOptions<V>> = {}): (ReactiveInitial<V> | ReactiveNonInitial<V>) & ReactiveDisposable {\n  const process = options.process;\n  const initialValue = process ? process() : undefined;\n\n  const rxObject = initialValue ? object<V>(initialValue, { deepEntries: true }) : object<V>(undefined, { deepEntries: true });\n  const lazy = options.lazy ?? false;\n  let eventAdded = false;\n  let disposed = false;\n\n  const callback = (args: any) => {\n    rxObject.set(process ? process(args) : args);\n  }\n\n  const remove = () => {\n    if (!eventAdded) return;\n    eventAdded = false;\n    target.removeEventListener(name, callback);\n  }\n\n  const add = () => {\n    if (eventAdded) return;\n    eventAdded = true;\n    target.addEventListener(name, callback);\n  }\n\n  if (!lazy) add();\n\n  return {\n    last: () => {\n      if (lazy) add();\n      return rxObject.last();\n    },\n    dispose: (reason: string) => {\n      if (disposed) return;\n      disposed = true;\n      remove();\n      rxObject.dispose(reason);\n    },\n    isDisposed() {\n      return disposed;\n    },\n    on: (handler: (v: Passed<V>) => void) => {\n      if (lazy) add();\n      return rxObject.on(handler);\n    }\n  }\n  // const result = {\n  //   dispose: () => {\n  //     target.removeEventListener(name, callback)\n  //   },\n  //   [ `${ name }` ]: rxObject\n  // }\n\n  // return result as {\n  //   [ key in EventName ]: typeof rxObject\n  // } & {\n  //   dispose: () => void\n  // };\n}\n\nexport function manual<V>(): Reactive<V> & ReactiveWritable<V> {\n  const events = initEvent<V>();\n  return {\n    set(value: V) {\n      events.notify(value);\n    },\n    on: events.on\n  };\n}\n\nexport type ObjectOptions<V> = {\n  deepEntries: boolean\n  eq: Immutable.IsEqualContext<V>\n}\n\n//export function object<V extends Record<string, any>>(options?: Partial<ObjectOptions<V>>): ReactiveDiff<V> & ReactiveNonInitial<V>;\n\nexport function object<V extends Record<string, any>>(initialValue: V, options?: Partial<ObjectOptions<V>>): ReactiveDiff<V> & ReactiveInitial<V>;\n\nexport function object<V extends Record<string, any>>(initialValue: undefined, options?: Partial<ObjectOptions<V>>): ReactiveDiff<V> & ReactiveNonInitial<V>;\n\n\n/**\n * Emits when fields of the object change.\n * * `set()` updates the whole object\n * * `update()` changes a particular field\n * \n * `on` gets the whole object when it changes.\n * ```js\n * const o = object({ name: `bob`, level: 2 });\n * o.on(value => {\n *  const changed = value.value;\n * });\n * o.set({ name: `mary`, level: 3 });\n * \n * // `on` will get called, with `changed` having a value of:\n * // { name: `mary`, level: 3 }\n * ```\n * \n * Use `last()` to get the last set value.\n * \n * `onDiff` subscribes to a rough diff of the object.\n * \n * ```js\n * const o = object({ name: `bob`, level: 2 });\n * o.onDiff(diffValue => {\n *  const diff = diffValue.value;\n * })\n * o.set({ name: `mary`, level: 3 });\n * \n * // onDiff would fire with `diff` of:\n * [\n *  { path: `name`, previous: `bob`, value: `mary` },\n *  { path: `level`, previous: 2, value: 3 }\n * ]\n * ```\n * @param initialValue \n * @param eq \n * @returns \n */\nexport function object<V extends Record<string, any>>(initialValue?: V, options: Partial<ObjectOptions<V>> = {}): ReactiveDisposable & ReactiveDiff<V> & (ReactiveInitial<V> | ReactiveNonInitial<V>) {\n  const eq = options.eq ?? Immutable.isEqualContextString;\n  const setEvent = initEvent<V>();\n  const diffEvent = initEvent<Array<Immutable.Change<any>>>();\n\n  let value: V | undefined = initialValue;\n  let disposed = false;\n\n  const set = (v: V) => {\n    if (value !== undefined) {\n      const diff = Immutable.compareData(value, v, ``, options);\n      if (diff.length === 0) return;\n      diffEvent.notify(diff);\n    }\n\n    value = v;\n    setEvent.notify(v);\n  }\n\n\n  const update = (toMerge: Partial<V>) => {\n    const pd = Immutable.getPathsAndData(toMerge);\n    // eslint-disable-next-line unicorn/prefer-ternary\n    if (value === undefined) {\n      value = toMerge as V;\n    } else {\n      const diff = Immutable.compareData(toMerge, value);\n      if (diff.length === 0) return; // No changes\n      value = {\n        ...value,\n        ...toMerge\n      }\n      diffEvent.notify(pd);\n    }\n    setEvent.notify(value);\n  }\n\n  const updateField = (path: string, valueForField: any) => {\n    if (value === undefined) throw new Error(`Cannot update value when it has not already been set`);\n    const existing = Immutable.getField<any>(value, path);\n    if (eq(existing, valueForField, path)) return;\n    const o = Immutable.updateByPath(value, path, valueForField);\n    value = o;\n    diffEvent.notify([ { path, value: valueForField, previous: existing } ]);\n    setEvent.notify(o);\n  }\n\n  const dispose = (reason: string) => {\n    if (disposed) return;\n    diffEvent.dispose(reason);\n    setEvent.dispose(reason);\n    disposed = true;\n  }\n\n  return {\n    dispose,\n    isDisposed() {\n      return disposed\n    },\n    /**\n     * Update a field.\n     * Exception is thrown if field does not exist\n     */\n    updateField,\n    last: () => value,\n    on: setEvent.on,\n    onDiff: diffEvent.on,\n    /**\n     * Set the whole object\n     */\n    set,\n    /**\n     * Update the object with a partial set of fields and values\n     */\n    update\n  }\n}\n\nexport type InitEventOptions = {\n  onFirstSubscribe: () => void\n  onNoSubscribers: () => void\n}\n\nfunction initEvent<V>(options: Partial<InitEventOptions> = {}) {\n  let dispatcher: DispatchList<Passed<V>> | undefined;\n  let disposed = false;\n  let firstSubscribe = false;\n  let emptySubscriptions = true;\n  const onFirstSubscribe = options.onFirstSubscribe ?? undefined;\n  const onNoSubscribers = options.onNoSubscribers ?? undefined;\n\n  const isEmpty = () => {\n    if (dispatcher === undefined) return;\n    if (!dispatcher.isEmpty) return;\n    if (!emptySubscriptions) {\n      emptySubscriptions = true;\n      firstSubscribe = false;\n      if (onNoSubscribers) onNoSubscribers();\n    }\n  }\n  return {\n    dispose: (reason: string) => {\n      if (disposed) return;\n      //console.log(`initEvent dispose ${ reason }`);\n      dispatcher?.notify({ value: undefined, signal: `done`, context: `Disposed: ${ reason }` });\n      disposed = true;\n    },\n    isDisposed: () => {\n      return disposed\n    },\n    clear: () => {\n      dispatcher?.clear();\n      isEmpty();\n    },\n    notify: (v: V) => {\n      if (disposed) throw new Error(`Disposed`);\n      dispatcher?.notify({ value: v });\n    },\n    through: (pass: Passed<V>) => {\n      if (disposed) throw new Error(`Disposed`);\n      dispatcher?.notify(pass)\n    },\n    signal: (signal: SignalKinds, context?: string) => {\n      if (disposed) throw new Error(`Disposed`);\n      dispatcher?.notify({ signal, value: undefined, context });\n    },\n    on: (handler: Dispatch<Passed<V>>) => {\n      if (disposed) throw new Error(`Disposed`);\n      if (dispatcher === undefined) dispatcher = new DispatchList();\n      const id = dispatcher.add(handler);\n      if (!firstSubscribe) {\n        firstSubscribe = true;\n        if (onFirstSubscribe) setTimeout(() => { onFirstSubscribe() }, 10);\n      }\n      return () => {\n        dispatcher?.remove(id);\n        isEmpty();\n      }\n    }\n  }\n}\n\nexport type UpstreamOptions<In> = {\n  lazy: boolean\n  /**\n   * If _true_ (default), we dispose the underlying stream if the upstream closes. This happens after onStop() is called.\n   */\n  disposeIfSourceDone: boolean\n  onValue: (v: In) => void\n  /**\n   * Called just before we subscribe to source\n   * @returns \n   */\n  onStart: () => void\n  /**\n   * Called after we unsubscribe from source\n   * @returns\n   */\n  onStop: () => void\n}\n\nconst initUpstream = <In, Out>(upstreamSource: ReactiveOrSource<In>, options: Partial<UpstreamOptions<In>>) => {\n  const lazy = options.lazy ?? true;\n  const disposeIfSourceDone = options.disposeIfSourceDone ?? true;\n  const onValue = options.onValue ?? ((_v: In) => {/** no-op */ })\n  const source = resolveSource(upstreamSource);\n  let unsub: undefined | (() => void);\n\n  const start = () => {\n    if (unsub !== undefined) return;\n\n    if (options.onStart) options.onStart();\n    unsub = source.on(value => {\n      if (isSignal(value)) {\n        if (value.signal === `done`) {\n          stop();\n          if (disposeIfSourceDone) events.dispose(`Source is completed`);\n        } else {\n          events.through(value);\n        }\n      } else if (hasValue(value)) {\n        onValue(value.value);\n      }\n    });\n  }\n\n  const stop = () => {\n    if (unsub === undefined) return;\n    unsub();\n    unsub = undefined;\n    if (options.onStop) options.onStop();\n  }\n\n  const initOpts: InitEventOptions = {\n    onFirstSubscribe() {\n      if (lazy) start();\n    },\n    onNoSubscribers() {\n      if (lazy) stop();\n    },\n  }\n  if (!lazy) start();\n  const events = initEvent<Out>(initOpts);\n  return events;\n}\n\nexport type FieldOptions<V> = InitEventOptions & {\n  /**\n   * If `field` is missing on a value, this value is used in its place.\n   * If not set, the value is skipped.\n   */\n  missingFieldDefault: V\n};\n/**\n * From a source value, yields a field from it.\n * \n * If a source value doesn't have that field, it is skipped.\n * \n * @param source \n * @param field \n * @returns \n */\nexport function field<In, Out>(fieldSource: ReactiveOrSource<In>, field: keyof In, options: Partial<FieldOptions<Out>> = {}): Reactive<Out> {\n  const upstream = initUpstream<In, Out>(fieldSource, {\n    disposeIfSourceDone: true,\n    ...options,\n    onValue(value) {\n      let t = (value as any)[ field ];\n      if (t === undefined && options.missingFieldDefault !== undefined) {\n        t = options.missingFieldDefault as Out;\n      }\n      upstream.notify(t as Out);\n    },\n  })\n\n  return {\n    on: upstream.on\n  }\n  // const source = resolveSource(fieldSource);\n  // const events = initEvent<Out>();\n  // source.on(value => {\n  //   if (isSignal(value)) {\n  //     if (value.signal === `done`) {\n  //       events.dispose(`Source stream closed`);\n  //     }\n  //     return;\n  //   }\n  //   if (value.value) {\n  //     const t = value.value[ field ];\n  //     events.notify(t as Out);\n  //   }\n  // })\n\n  // return {\n  //   on: events.on,\n  //   dispose: events.dispose,\n  //   isDisposed() {\n  //     return events.isDisposed();\n  //   },\n  // }\n}\n\nexport type TransformOpts = InitEventOptions;\n\n/**\n * Transforms values from `source` using the `transformer` function.\n * @param source \n * @param transformer \n * @returns \n */\nexport function transform<In, Out>(input: ReactiveOrSource<In>, transformer: (value: In) => Out, options: Partial<TransformOpts> = {}): Reactive<Out> {\n  const upstream = initUpstream<In, Out>(input, {\n    ...options,\n    onValue(value) {\n      const t = transformer(value);\n      upstream.notify(t);\n    },\n  })\n\n  return {\n    on: upstream.on\n  }\n}\n\nexport type BatchOptions = InitEventOptions & {\n  /**\n   * If _true_ (default) remaining results are yielded\n   * if source closes. If _false_, only 'complete' batches are yielded.\n   */\n  returnRemainder: boolean\n  elapsed: Interval\n  limit: number\n  logic: `or` | `and`\n}\n\nexport type GeneratorOptions = {\n  /**\n   * By default (true) only accesses the generator if there is a subscriber.\n   */\n  lazy: boolean\n}\n/**\n * Creates a readable reactive based on a generator\n * ```js\n * // Generators that makes a random value every 5 seconds\n * const valuesOverTime = Flow.interval(() => Math.random(), 5000);\n * // Wrap the generator\n * const r = Reactive.generator(time);\n * // Get notified when there is a new value\n * r.on(v => {\n *   console.log(v.value);\n * });\n * ```\n * @param generator \n */\nexport function generator<V>(generator: IterableIterator<V> | AsyncIterableIterator<V> | Generator<V> | AsyncGenerator<V>, options: Partial<GeneratorOptions> = {}): ReactiveDisposable & Reactive<V> {\n  const lazy = options.lazy ?? true;\n  let reading = false;\n\n  const eventOpts: InitEventOptions = {\n    onFirstSubscribe() {\n      if (lazy && !reading) {\n        readingStart();\n      }\n    },\n    onNoSubscribers() {\n      if (lazy && reading) {\n        reading = false;\n      }\n    },\n  }\n  const events = initEvent<V>(eventOpts);\n\n  const read = async () => {\n    try {\n      const v = await generator.next();\n      if (v.done) {\n        events.dispose(`Generator complete`);\n        return;\n      }\n      if (!reading) return;\n      events.notify(v.value);\n    } catch (error) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n      events.dispose(`Generator error: ${ (error as any).toString() }`);\n      return;\n    }\n    if (events.isDisposed()) return;\n    if (!reading) return;\n    // eslint-disable-next-line @typescript-eslint/no-misused-promises\n    setTimeout(read);\n  }\n\n  const readingStart = () => {\n    if (reading) return;\n    reading = true;\n    void read();\n  }\n  if (!lazy) readingStart();\n\n  return {\n    on: events.on,\n    dispose: events.dispose,\n    isDisposed: events.isDisposed\n  }\n}\n\nexport type ReactiveOrSource<V> = Reactive<V> | IterableIterator<V> | AsyncIterableIterator<V> | Generator<V> | AsyncGenerator<V> | Array<V>\n\n/**\n * Resolves various kinds of sources into a Reactive.\n * If `source` is an iterable/generator, it gets wrapped via `generator()`.\n * @param source \n * @returns \n */\nexport const resolveSource = <V>(source: ReactiveOrSource<V>): Reactive<V> => {\n  if (`on` in source) return source;\n  // eslint-disable-next-line unicorn/prefer-ternary\n  if (Array.isArray(source)) {\n    return generator(source.values(), { lazy: true });\n  } else {\n    return generator(source, { lazy: true });\n  }\n}\n/**\n * Queue from `source`, emitting when thresholds are reached.\n * Can use a combination of elapsed time or number of data items.\n * \n * By default options are ORed\n *\n * ```js\n * // Emit data in batches of 5 items\n * batch(source, { limit: 5 });\n * // Emit data every second\n * batch(source, { elapsed: 1000 });\n * ```\n * @param source \n * @param options \n * @returns \n */\nexport function batch<V>(batchSource: ReactiveOrSource<V>, options: Partial<BatchOptions> = {}): Reactive<Array<V>> {\n  //const source = resolveSource(batchSource);\n  const elapsed = intervalToMs(options.elapsed, 0);\n  const queue = new QueueMutable<V>();\n  const limit = options.limit ?? 0;\n  const logic = options.logic ?? `or`;\n  const returnRemainder = options.returnRemainder ?? true;\n\n  let lastFire = performance.now();\n  const upstreamOpts = {\n    ...options,\n    onStop() {\n      if (returnRemainder && !queue.isEmpty) {\n        const data = queue.toArray();\n        queue.clear();\n        upstream.notify(data);\n      }\n    },\n    onValue(value: V) {\n      queue.enqueue(value);\n      trigger();\n    },\n  }\n  const upstream = initUpstream<V, Array<V>>(batchSource, upstreamOpts);\n\n  // let off: undefined | (() => void);\n\n  // const close = (reason: string) => {\n  //   console.log(`batch.close queue: ${ queue.length } returnRemainer: ${ returnRemainder }`);\n  //   if (off !== undefined) off();\n  //   if (returnRemainder && !queue.isEmpty) {\n  //     const data = queue.data;\n  //     queue.clear();\n  //     events.notify(data as Array<V>);\n  //   }\n  //   events.dispose(reason);\n  // }\n\n  // const initOpts: InitEventOptions = {\n  //   onFirstSubscribe() {\n  //     console.log(`batch onFirstSub`);\n  //     off = source.on(value => {\n  //       console.log(`batch value ${ JSON.stringify(value) }`);\n  //       if (isValue(value)) {\n  //         queue.enqueue(value.value);\n  //         trigger();\n  //       } else if (isSignal(value) && value.signal === `done`) {\n  //         close(`batch source closed`);\n  //       }\n  //     });\n  //   },\n  //   onNoSubscribers() {\n  //     close(`batch onNoSubscribers`);\n  //   },\n  // }\n  //const events = initEvent<Array<V>>(initOpts);\n\n  const trigger = () => {\n    const now = performance.now();\n    let byElapsed = false;\n    let byLimit = false;\n    if (elapsed > 0 && (now - lastFire > elapsed)) {\n      lastFire = now;\n      byElapsed = true;\n    }\n    if (limit > 0 && queue.length >= limit) {\n      byLimit = true;\n    }\n    if (logic === `or` && (!byElapsed && !byLimit)) return;\n    if (logic === `and` && (!byElapsed || !byLimit)) return;\n\n    // Fire queued data\n    const data = queue.toArray();\n    queue.clear();\n    upstream.notify(data);\n  }\n\n  const r: Reactive<Array<V>> = {\n    on: upstream.on\n  }\n  return r;\n}\n\nexport type ToArrayOptions = {\n  limit: number\n  elapsed: number\n}\n\n/**\n * Reads the values of a reactive into an array.\n * Use the `limit` or `elapsed` to limit how many\n * items to read, and/or for how long.\n * @param reactive \n * @param options \n * @returns \n */\nexport const toArray = async <V>(reactiveSource: ReactiveOrSource<V>, options: Partial<ToArrayOptions> = {}): Promise<Array<V>> => {\n  const source = resolveSource(reactiveSource);\n  const maxValues = options.limit ?? Number.MAX_SAFE_INTEGER;\n  const maxDuration = options.elapsed ?? Number.MAX_SAFE_INTEGER;\n  let buffer: Array<V> = [];\n\n  let start = -1;\n  const promise = new Promise<Array<V>>((resolve, _reject) => {\n    const done = () => {\n      off();\n      resolve(buffer);\n      buffer = []\n    }\n\n    const off = source.on(value => {\n      if (start === -1) start = Date.now();\n      if (isSignal(value) && value.signal === `done`) {\n        done();\n      } else if (hasValue(value)) {\n        buffer.push(value.value);\n        if (buffer.length >= maxValues) {\n          done();\n        }\n      }\n      if (Date.now() - start > maxDuration) {\n        done();\n      }\n    });\n  })\n  return promise;\n}\n\nexport type ThrottleOptions = InitEventOptions & {\n  elapsed: Interval\n}\n\nexport function throttle<V>(throttleSource: ReactiveOrSource<V>, options: Partial<ThrottleOptions> = {}): Reactive<V> {\n  const elapsed = intervalToMs(options.elapsed, 0);\n  let lastFire = performance.now();\n  let lastValue: V | undefined;\n\n  const upstream = initUpstream<V, V>(throttleSource, {\n    ...options,\n    onValue(value) {\n      lastValue = value;\n      trigger();\n    },\n  });\n\n  const trigger = () => {\n    const now = performance.now();\n    let byElapsed = false;\n    if (elapsed > 0 && (now - lastFire > elapsed)) {\n      lastFire = now;\n      byElapsed = true;\n    }\n    if (!byElapsed) return;\n\n    if (lastValue !== undefined) {\n      upstream.notify(lastValue);\n    }\n  }\n\n  const r: Reactive<V> = {\n    on: upstream.on\n  }\n  return r;\n}\n\nexport function win() {\n  const generateRect = () => ({ width: window.innerWidth, height: window.innerHeight });\n\n  const size = event(window, `resize`, {\n    lazy: true,\n    process: () => generateRect(),\n  });\n  const pointer = event(window, `pointermove`, {\n    lazy: true,\n    process: (args: Event | undefined) => {\n      if (args === undefined) return { x: 0, y: 0 };\n      const pe = args as PointerEvent;\n      return { x: pe.x, y: pe.y }\n    }\n  });\n  const dispose = (reason = `Reactive.win.dispose`) => {\n    size.dispose(reason);\n    pointer.dispose(reason);\n  }\n  return { dispose, size, pointer };\n}\n\n\ntype RxNodeBase = {\n  type: `primitive` | `rx` | `object`\n}\n\ntype RxNodeRx = RxNodeBase & {\n  type: `rx`,\n  value: Reactive<any>\n}\n\ntype RxNodePrimitive = RxNodeBase & {\n  type: `primitive`,\n  value: any\n}\n\ntype RxNode = RxNodeRx | RxNodePrimitive;\n\nfunction isReactive(o: object): o is Reactive<any> {\n  if (typeof o !== `object`) return false;\n  if (`on` in o) {\n    return (typeof o.on === `function`);\n  }\n  return false;\n}\n\n/**\n * Build a graph of reactive dependencies for `rx`\n * @param rx \n */\nexport function prepare<V extends Record<string, any>>(rx: V): Reactive<V> {\n  let g = DiGraph.graph();\n  const nodes = new Map<string, RxNode>();\n  const events = initEvent<V>();\n\n  const process = (o: object, path: string) => {\n    for (const [ key, value ] of Object.entries(o)) {\n      const subPath = path + `.` + key;\n      g = DiGraph.connect(g, {\n        from: path,\n        to: subPath\n      });\n      if (isReactive(value)) {\n        nodes.set(subPath, { value, type: `rx` });\n        value.on(v => {\n          console.log(`Reactive.prepare value: ${ JSON.stringify(v) } path: ${ subPath }`);\n        });\n      } else {\n        const valueType = typeof value;\n        // eslint-disable-next-line unicorn/prefer-switch\n        if (valueType === `bigint` || valueType === `boolean` || valueType === `number` || valueType === `string`) {\n          nodes.set(subPath, { type: `primitive`, value });\n        } else if (valueType === `object`) {\n          process(value, subPath)\n        } else if (valueType === `function`) {\n          console.log(`Reactive.process - not handling functions`);\n        }\n      }\n    }\n  }\n\n  // const produce = () => {\n  //   Object.fromEntries(entries);\n  // }\n\n  // process(rx, `_root`);\n  // console.log(DiGraph.dumpGraph(g));\n\n  // console.log(`--- Map ---`);\n\n  // for (const entries of nodes.entries()) {\n  //   console.log(entries[ 0 ]);\n  //   console.log(entries[ 1 ]);\n  //   console.log(``)\n  // }\n\n\n  const returnValue = {\n    graph: g,\n    on: events.on\n  }\n  return returnValue;\n}\n\n","export type Dispatch<V> = (value: V) => void;\n\ntype Wrap<V> = {\n  readonly handler: Dispatch<V>\n  readonly id: string\n  readonly once: boolean\n}\n\nexport class DispatchList<V> {\n  #handlers: Array<Wrap<V>>\n  #counter = 0;\n  readonly #id = Math.floor(Math.random() * 100);\n  constructor() {\n\n    this.#handlers = [];\n  }\n\n  /**\n   * Returns _true_ if list is empty\n   * @returns \n   */\n  isEmpty() {\n    return this.#handlers.length === 0;\n  }\n\n  /**\n   * Adds a handler\n   * @param handler \n   * @param options \n   * @returns \n   */\n  add(handler: Dispatch<V>, options: { once?: boolean } = {}): string {\n    this.#counter++;\n    const once = options.once ?? false;\n    const wrap: Wrap<V> = {\n      id: this.#id + `-` + this.#counter,\n      handler,\n      once\n    }\n    this.#handlers.push(wrap);\n    return wrap.id;\n  }\n\n  remove(id: string): boolean {\n    const length = this.#handlers.length;\n    this.#handlers = this.#handlers.filter(handler => handler.id !== id);\n    return this.#handlers.length !== length;\n  }\n\n  notify(value: V) {\n    for (const handler of this.#handlers) {\n      handler.handler(value);\n      if (handler.once) {\n        this.remove(handler.id);\n      }\n    }\n  }\n\n  clear() {\n    this.#handlers = [];\n  }\n}","/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport { QueueMutable, StackMutable } from \"../../collections/index.js\"\nimport { PriorityMutable } from \"../../collections/queue/PriorityMutable.js\"\nimport { immutable as immutableMap, type IMapImmutable } from \"../../collections/map/Map.js\"\nimport { NumberMap } from \"../../collections/map/NumberMap.js\"\nimport { Sync } from \"../../Generators.js\"\nimport { Table } from \"../Table.js\"\n\nexport type DistanceCompute = (graph: DirectedGraph, edge: Edge) => number;\n\n/**\n * Vertex. These are the _nodes_ of the graph. Immutable.\n * \n * They keep track of all of their outgoing edges, and\n * a unique id.\n * \n * Ids are used for accessing/updating vertices as well as in the\n * {@link Edge} type. They must be unique.\n */\nexport type Vertex = Readonly<{\n  out: ReadonlyArray<Edge>\n  id: string\n}>\n\n/**\n * Edge. Immutable.\n * \n * Only encodes the destination vertex. The from\n * is known since edges are stored on the from vertex.\n */\nexport type Edge = Readonly<{\n  /**\n   * Vertex id edge connects to (ie. destination)\n   */\n  id: string,\n  /**\n   * Optional weight of edge\n   */\n  weight?: number\n}>\n\n/**\n * Create a vertex with given id\n * @param id \n * @returns \n */\nexport const createVertex = (id: string): Vertex => {\n  return {\n    id,\n    out: []\n  }\n}\n\n/**\n * Options for connecting vertices\n */\nexport type ConnectOptions = Readonly<{\n  /**\n   * From, or source of connection\n   */\n  from: string\n  /**\n   * To, or destination of connection. Can be multiple vertices for quick use\n   */\n  to: string | Array<string>\n  /**\n   * If true, edges in opposite direction are made as well\n   */\n  bidi?: boolean\n  /**\n   * Weight for this connection (optional)\n   */\n  weight?: number\n}>\n\n/**\n * Directed graph. Immutable\n * \n * Consists of {@link Vertex|vertices}, which all have zero or more outgoing {@link Edge|Edges}.\n */\nexport type DirectedGraph = Readonly<{\n  vertices: IMapImmutable<string, Vertex>\n}>\n\n// export function fromAdjacenyMatrix(m: Array<Array<boolean>>): DirectedGraph {\n//   let g = graph();\n//   for (const row of m) {\n//     connect(g, { from, to })\n//   }\n//   return g;\n// }\n\n/**\n * Returns the graph connections as an adjacency matrix\n * @param graph \n * @returns \n */\nexport function toAdjacencyMatrix(graph: DirectedGraph): Table<boolean> {\n  const v = [ ...graph.vertices.values() ];\n  //const m: Array<Array<boolean>> = [];\n  const table = new Table<boolean>();\n  table.labelColumns(...v.map(vv => vv.id));\n  table.labelRows(...v.map(vv => vv.id));\n\n  // const row: Array<boolean> = [];\n  // for (let index = 0; index < v.length; index++) {\n  //   row[ index ] = false;\n  // }\n\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of, unicorn/prevent-abbreviations\n  for (let i = 0; i < v.length; i++) {\n    //m[ i ] = [ ...row ];\n    table.setRow(i, v.length, false);\n    const ii = v[ i ];\n    // eslint-disable-next-line unicorn/prevent-abbreviations\n    for (const [ j, jj ] of v.entries()) {\n      if (ii.out.some(o => o.id === jj.id)) {\n        //m[ i ][ j ] = true;\n        table.set(i, j, true);\n      }\n    }\n  }\n  return table;\n}\n\n/**\n * Return a string representation of the graph for debug inspection\n * @param graph \n * @returns \n */\nexport const dumpGraph = (graph: DirectedGraph | Iterable<Vertex>): string => {\n  const lines = debugGraphToArray(graph);\n  return lines.join(`\\n`);\n}\n\n/**\n * Return an array of a debug-print of every vertex.\n * @param graph \n * @returns \n */\nconst debugGraphToArray = (graph: DirectedGraph | Iterable<Vertex>): Array<string> => {\n  const r: Array<string> = [];\n  const vertices = (`vertices` in graph) ? graph.vertices.values() : graph;\n\n  for (const v of vertices) {\n    // eslint-disable-next-line unicorn/prevent-abbreviations\n    const str = debugDumpVertex(v);\n    r.push(...str.map(line => ` ${ line }`));\n  }\n  return r;\n}\n\n\nexport const distance = (graph: DirectedGraph, edge: Edge): number => {\n  if (edge.weight !== undefined) return edge.weight;\n  return 1;\n}\n\n/**\n * Iterate over all the edges in the graph\n * @param graph \n */\nexport function* edges(graph: DirectedGraph) {\n  const vertices = [ ...graph.vertices.values() ];\n  for (const vertex of vertices) {\n    for (const edge of vertex.out) {\n      yield edge;\n    }\n  }\n}\n\n/**\n * Iterate over all the vertices of the graph\n * @param graph \n */\nexport function* vertices(graph: DirectedGraph) {\n  const vertices = [ ...graph.vertices.values() ];\n  for (const vertex of vertices) {\n    yield vertex;\n  }\n}\n\n/**\n * Iterate over all the vertices connectd to `context` vertex\n * @param graph Graph\n * @param context id or Vertex\n * @returns \n */\nexport function* adjacentVertices(graph: DirectedGraph, context: Vertex | string | undefined) {\n  if (context === undefined) return;\n  const vertex = typeof context === `string` ? graph.vertices.get(context) : context;\n  if (vertex === undefined) throw new Error(`Vertex not found ${ JSON.stringify(context) }`);\n\n  for (const edge of vertex.out) {\n    const edgeV = graph.vertices.get(edge.id);\n    if (edgeV === undefined) throw new Error(`Could not find vertex: ${ edge.id }`);\n    yield edgeV;\n  }\n}\n\n/**\n * Returns _true_ if `vertex` has an outgoing connection to\n * the supplied id or vertex.\n * \n * If `vertex` is undefined, _false_ is returned.\n * @param vertex From vertex\n * @param outIdOrVertex To vertex\n * @returns \n */\nexport const vertexHasOut = (vertex: Vertex, outIdOrVertex: string | Vertex): boolean => {\n  if (vertex === undefined) return false;\n  const outId = typeof outIdOrVertex === `string` ? outIdOrVertex : outIdOrVertex.id;\n  return vertex.out.some(edge => edge.id === outId);\n}\n\n/**\n * Returns _true_ if `vertex` has no outgoing connections\n * @param graph \n * @param vertex \n * @returns \n */\nexport const hasNoOuts = (graph: DirectedGraph, vertex: string | Vertex): boolean => {\n  const context = typeof vertex === `string` ? graph.vertices.get(vertex) : vertex;\n  if (context === undefined) return false;\n  return context.out.length === 0;\n}\n\n/**\n * Returns _true_ if `vertex` only has the given list of vertices.\n * Returns _false_ early if the length of the list does not match up with `vertex.out`\n * @param graph \n * @param vertex \n * @param outIdOrVertex \n * @returns \n */\nexport const hasOnlyOuts = (graph: DirectedGraph, vertex: string | Vertex, ...outIdOrVertex: Array<string | Vertex>): boolean => {\n  const context = resolveVertex(graph, vertex);\n  const outs = outIdOrVertex.map(o => resolveVertex(graph, o));\n\n  if (outs.length !== context.out.length) {\n    //console.log(`length mismatch. context: ${ JSON.stringify(context.out) } out ${ JSON.stringify(outIdOrVertex) }`);\n    return false;\n  }\n  for (const out of outs) {\n    //console.log(`Testing ${ context.id } -> ${ out.id }`);\n    if (!hasOut(graph, context, out)) {\n      //console.log(`  no`);\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Returns _true_ if `vertex` has an outgoing connection to the given vertex.\n * @param graph \n * @param vertex \n * @param outIdOrVertex \n * @returns \n */\nexport const hasOut = (graph: DirectedGraph, vertex: string | Vertex, outIdOrVertex: string | Vertex): boolean => {\n  const context = resolveVertex(graph, vertex);\n  const outId = typeof outIdOrVertex === `string` ? outIdOrVertex : outIdOrVertex.id;\n  return context.out.some(edge => edge.id === outId);\n}\n\n// export const hasIn = (graph: Graph, contextIdOrVertex: string | Vertex, id: string): boolean => {\n//   const context = typeof contextIdOrVertex === `string` ? graph.vertices.get(contextIdOrVertex) : contextIdOrVertex;\n\n//   if (context === undefined) return false;\n//   if (context.in === undefined) return false;\n//   return context.in.some(edge => edge.id === id);\n// }\n\n/**\n * Gets a vertex by id, creating it if it does not exist.\n * @param graph \n * @param id \n * @returns \n */\nexport const getOrCreate = (graph: DirectedGraph, id: string): Readonly<{ graph: DirectedGraph, vertex: Vertex }> => {\n  const v = graph.vertices.get(id);\n  if (v !== undefined) return { graph, vertex: v };\n\n  const vv = createVertex(id);\n  const gg = updateGraphVertex(graph, vv);\n  return { graph: gg, vertex: vv };\n}\n\n/**\n * Gets a vertex by id, throwing an error if it does not exist\n * @param graph \n * @param id \n * @returns \n */\nexport const getOrFail = (graph: DirectedGraph, id: string): Vertex => {\n  const v = graph.vertices.get(id);\n  if (v === undefined) throw new Error(`Vertex '${ id }' not found in graph`);\n  return v;\n}\n\n/**\n * Updates a vertex by returning a mutated graph\n * @param graph Graph\n * @param vertex Newly changed vertex\n * @returns \n */\nexport const updateGraphVertex = (graph: DirectedGraph, vertex: Vertex): DirectedGraph => {\n  const gr = {\n    ...graph,\n    vertices: graph.vertices.set(vertex.id, vertex)\n  }\n  return gr;\n}\n\n/**\n * Default distance computer. Uses `weight` property of edge, or `1` if not found.\n * @param graph \n * @param edge \n * @returns \n */\nexport const distanceDefault = (graph: DirectedGraph, edge: Edge): number => {\n  if (edge.weight !== undefined) return edge.weight;\n  return 1;\n}\n\n/**\n * Returns a mutation of `graph`, with a given edge removed.\n * \n * If edge was not there, original graph is returned.\n * @param graph \n * @param from \n * @param to \n * @returns \n */\nexport function disconnect(graph: DirectedGraph, from: string | Vertex, to: string | Vertex): DirectedGraph {\n  const fromV = resolveVertex(graph, from);\n  const toV = resolveVertex(graph, to);\n\n  return hasOut(graph, fromV, toV) ? updateGraphVertex(graph, {\n    ...fromV,\n    out: fromV.out.filter(t => t.id !== toV.id)\n  }) : graph;\n}\n\n/**\n * Make a connection between two vertices with a given weight.\n * It returns the new graph as wll as the created edge.\n * @param graph \n * @param from \n * @param to \n * @param weight \n * @returns \n */\nexport function connectTo(graph: DirectedGraph, from: string, to: string, weight?: number): { graph: DirectedGraph, edge: Edge } {\n  const fromResult = getOrCreate(graph, from);\n  graph = fromResult.graph;\n  const toResult = getOrCreate(graph, to);\n  graph = toResult.graph;\n\n  const edge: Edge = {\n    id: to,\n    weight\n  }\n\n  if (!hasOut(graph, fromResult.vertex, toResult.vertex)) {\n    graph = updateGraphVertex(graph, {\n      ...fromResult.vertex,\n      // Add new edge to list of edges for this node\n      out: [ ...fromResult.vertex.out, edge ]\n    });\n  }\n  return { graph, edge }\n}\n\n/**\n * Connect from -> to. By default unidirectional.\n * Returns a new graph with the connection\n * @param graph \n * @param options \n * @returns \n */\nexport function connect(graph: DirectedGraph, options: ConnectOptions): DirectedGraph {\n  const { to, weight, from } = options;\n  const bidi = options.bidi ?? false;\n  const toList = Array.isArray(to) ? to : [ to ];\n\n  // Connect from -> to\n  for (const toSingle of toList) {\n    const result = connectTo(graph, from, toSingle, weight);\n    graph = result.graph;\n  }\n\n  if (!bidi) return graph;\n\n  // Bidirectional connection\n  // Connect to -> from\n  for (const toSingle of toList) {\n    const result = connectTo(graph, toSingle, from, weight);\n    graph = result.graph;\n  }\n  return graph;\n}\n\n/**\n * Returns an array of debug-representations for the given vertex.\n * @param v \n * @returns \n */\nconst debugDumpVertex = (v: Vertex): Array<string> => {\n  const r = [\n    `${ v.id }`\n  ]\n  const stringForEdge = (edge: Edge) => edge.weight === undefined ? edge.id : `${ edge.id } (${ edge.weight })`\n\n  // for (const edge of v.in) {\n  //   r.push(` <- ${ stringForEdge(edge) }`);\n  // }\n  for (const edge of v.out) {\n    r.push(` -> ${ stringForEdge(edge) }`);\n  }\n  if (v.out.length === 0) r[ 0 ] += ` (terminal)`;\n\n  return r;\n}\n\n/**\n * Returns _true_ if a->b or b->a\n * @param graph \n * @param a \n * @param b \n * @returns \n */\nexport function areAdjacent(graph: DirectedGraph, a: Vertex, b: Vertex) {\n  if (hasOut(graph, a, b.id)) return true;\n  if (hasOut(graph, b, a.id)) return true;\n}\n\n/**\n * Resolves the id or vertex into a Vertex.\n * throws an error if vertex is not found\n * @param graph \n * @param idOrVertex \n * @returns \n */\nfunction resolveVertex(graph: DirectedGraph, idOrVertex: string | Vertex): Vertex {\n  const v = typeof idOrVertex === `string` ? graph.vertices.get(idOrVertex) : idOrVertex;\n  if (v === undefined) throw new Error(`Id not found ${ idOrVertex as string }`);\n  return v;\n}\n\n/**\n * Iterates over vertices from a starting vertex in an bread-first-search\n * @param graph \n * @param startIdOrVertex \n * @param targetIdOrVertex \n * @returns \n */\nexport function* bfs(graph: DirectedGraph, startIdOrVertex: string | Vertex, targetIdOrVertex?: string | Vertex) {\n  const start = resolveVertex(graph, startIdOrVertex);\n  const target = targetIdOrVertex === undefined ? undefined : resolveVertex(graph, targetIdOrVertex);\n\n  const queue = new QueueMutable<Vertex>();\n  const seen = new Set<string>();\n  queue.enqueue(start);\n  while (!queue.isEmpty) {\n    const v = queue.dequeue()!;\n    yield v;\n    if (target !== undefined && target === v) return;\n    for (const edge of adjacentVertices(graph, v)) {\n      if (!seen.has(edge.id)) {\n        seen.add(edge.id);\n        queue.enqueue(resolveVertex(graph, edge.id));\n      }\n    }\n  }\n}\n\n/**\n * Iterates over vertices from a starting vertex in an depth-first-search\n * @param graph \n * @param startIdOrVertex \n */\nexport function* dfs(graph: DirectedGraph, startIdOrVertex: string | Vertex) {\n  const source = resolveVertex(graph, startIdOrVertex);\n\n  const s = new StackMutable<Vertex>();\n  const seen = new Set<string>();\n  s.push(source);\n  while (!s.isEmpty) {\n    const v = s.pop();\n    if (v === undefined) continue;\n    if (!seen.has(v.id)) {\n      seen.add(v.id);\n      yield v;\n      for (const edge of v.out) {\n        const destination = graph.vertices.get(edge.id);\n        if (destination) {\n          s.push(destination);\n        }\n      }\n    }\n  }\n}\n\n/**\n * Compute shortest distance from the source vertex to the rest of the graph.\n * @param graph \n * @param sourceOrId \n * @returns \n */\nexport const pathDijkstra = (graph: DirectedGraph, sourceOrId: Vertex | string) => {\n  const source = typeof sourceOrId === `string` ? graph.vertices.get(sourceOrId) : sourceOrId;\n  if (source === undefined) throw new Error(`source vertex not found`);\n\n  const distances = new Map<string, number>();\n  const previous = new Map<string, Vertex | null>();\n\n  distances.set(source.id, 0);\n\n  const pq = new PriorityMutable<string>();\n\n  const vertices = [ ...graph.vertices.values() ];\n  for (const v of vertices) {\n    if (v.id !== source.id) {\n      distances.set(v.id, Number.MAX_SAFE_INTEGER);\n      // eslint-disable-next-line unicorn/no-null\n      previous.set(v.id, null);\n    }\n    pq.enqueueWithPriority(v.id, Number.MAX_SAFE_INTEGER);\n  }\n\n  while (!pq.isEmpty) {\n    const u = pq.dequeueMin();\n    if (u === undefined) throw new Error(`Bug. Queue unexpectedly empty`);\n    const vertexU = graph.vertices.get(u)!;\n    for (const neighbour of vertexU.out) {\n      //const vertexNeigbour = graph.vertices.get(neighbour.to)!;\n      const alt = distances.get(u)! + distance(graph, neighbour);\n      if (alt < distances.get(neighbour.id)!) {\n        distances.set(neighbour.id, alt);\n        previous.set(neighbour.id, vertexU);\n        pq.changePriority(neighbour.id, alt, true);\n      }\n    }\n  }\n\n  const pathTo = (id: string): Array<Edge> => {\n    const path: Array<Edge> = [];\n    while (true) {\n      if (id === source.id) break;\n      const v = previous.get(id);\n      if (v === undefined || v === null) throw new Error(`Id not present: ${ id }`);\n      path.push({ id, weight: distances.get(id) });\n      id = v.id;\n    }\n    return path;\n  }\n  return {\n    distances, previous, pathTo\n  }\n}\n\n/**\n * Clones the graph. Uses shallow clone, because it's all immutable\n * @param graph \n * @returns \n */\nexport const clone = (graph: DirectedGraph): DirectedGraph => {\n  const g: DirectedGraph = {\n    vertices: immutableMap<string, Vertex>([ ...graph.vertices.entries() ])\n  }\n  return g;\n}\n\n/**\n * Create a graph\n * @param initialConnections \n * @returns \n */\nexport const graph = (...initialConnections: Array<ConnectOptions>): DirectedGraph => {\n  let g: DirectedGraph = {\n    vertices: immutableMap()\n  }\n  for (const ic of initialConnections) {\n    g = connect(g, ic);\n  }\n  return g;\n}\n\n/**\n * Internal type for Tarjan algorithm\n */\ntype TarjanVertex = Vertex & {\n  lowlink: number\n  index: number\n  onStack: boolean\n}\n\n/**\n * Returns _true_ if the graph contains is acyclic - that is, it has no loops\n * @param graph \n */\nexport function isAcyclic(graph: DirectedGraph): boolean {\n  const cycles = getCycles(graph);\n  return cycles.length === 0;\n}\n\n/**\n * Topological sort using Kahn's algorithm.\n * Returns a new graph that is sorted\n * @param graph \n */\nexport function topologicalSort(graph: DirectedGraph): DirectedGraph {\n  const indegrees = new NumberMap(0);\n\n  // Increment indegrees for each edge leading to a vertex\n  for (const edge of edges(graph)) {\n    indegrees.add(edge.id, 1);\n  }\n\n  // Enqueue all vertices with an indegree of 0\n  const queue = new QueueMutable<Vertex>();\n  let vertexCount = 0;\n  for (const vertex of vertices(graph)) {\n    if (indegrees.get(vertex.id) === 0) {\n      queue.enqueue(vertex);\n    }\n    vertexCount++;\n  }\n\n  const topOrder: Array<Vertex> = [];\n  while (!queue.isEmpty) {\n    // Add to topological order\n    const u = queue.dequeue()!;\n    topOrder.push(u);\n\n    // Iterate through neighbours\n    for (const neighbour of u.out) {\n      const result = indegrees.subtract(neighbour.id, 1);\n      if (result === 0) {\n        queue.enqueue(graph.vertices.get(neighbour.id)!);\n      }\n    }\n  }\n\n  if (topOrder.length !== vertexCount) {\n    throw new Error(`Graph contains cycles`);\n  }\n  return graphFromVertices(topOrder);\n}\n\n/**\n * Create a graph from an iterable of vertices\n * @param vertices \n * @returns \n */\nexport function graphFromVertices(vertices: Iterable<Vertex>): DirectedGraph {\n  // eslint-disable-next-line unicorn/no-array-callback-reference, unicorn/no-array-method-this-argument\n  const keyValues = Sync.map(vertices, f => {\n    return [ f.id, f ] as [ string, Vertex ]\n  });\n  const m = immutableMap<string, Vertex>([ ...keyValues ]);\n  return {\n    vertices: m\n  }\n}\n\n/**\n * Get all the cycles ('strongly-connected-components') within the graph\n * [Read more](https://en.wikipedia.org/wiki/Strongly_connected_component)\n * @param graph \n * @returns \n */\nexport function getCycles(graph: DirectedGraph): Array<Array<Vertex>> {\n  let index = 0;\n  const stack = new StackMutable<TarjanVertex>();\n  const vertices = new Map<string, TarjanVertex>();\n  const scc: Array<Array<Vertex>> = [];\n\n  for (const v of graph.vertices.values()) {\n    vertices.set(v.id, {\n      ...v,\n      lowlink: Number.NaN,\n      index: Number.NaN,\n      onStack: false\n    });\n  }\n\n  const strongConnect = (vertex: TarjanVertex) => {\n    vertex.index = index;\n    vertex.lowlink = index;\n    index++;\n    stack.push(vertex);\n    vertex.onStack = true;\n\n    for (const edge of vertex.out) {\n      const edgeV = vertices.get(edge.id)!;\n      if (Number.isNaN(edgeV.index)) {\n        strongConnect(edgeV);\n        vertex.lowlink = Math.min(vertex.lowlink, edgeV.lowlink);\n      } else if (edgeV.onStack) {\n        vertex.lowlink = Math.min(vertex.lowlink, edgeV.lowlink);\n      }\n    }\n\n    if (vertex.lowlink === vertex.index) {\n      const stronglyConnected: Array<Vertex> = [];\n      let w: TarjanVertex | undefined;\n      while (vertex !== w) {\n        w = stack.pop()!;\n        w.onStack = false;\n        stronglyConnected.push({ id: w.id, out: w.out });\n\n      }\n      if (stronglyConnected.length > 1)\n        scc.push(stronglyConnected);\n    }\n  }\n\n  for (const v of vertices.values()) {\n    if (Number.isNaN(v.index)) {\n      strongConnect(v);\n    }\n  }\n  return scc;\n}\n\n/**\n * Returns a new graph which is transitively reduced.\n * That is, redundant edges are removed\n * @param graph \n * @returns \n */\nexport function transitiveReduction(graph: DirectedGraph) {\n  for (const u of vertices(graph)) {\n    for (const v of adjacentVertices(graph, u)) {\n      for (const v1 of dfs(graph, v)) {\n        if (v.id === v1.id) continue;\n        if (hasOut(graph, u, v1)) {\n          const g = disconnect(graph, u, v1);\n          return transitiveReduction(g);\n        }\n      }\n    }\n  }\n  return graph;\n}","\nexport class Table<V> {\n  rows: Array<Array<V | undefined>> = [];\n  rowLabels: Array<string> = [];\n  colLabels: Array<string> = [];\n\n  labelColumns(...labels: Array<string>) {\n    this.colLabels = labels;\n  }\n\n  labelColumn(columnNumber: number, label: string) {\n    this.colLabels[ columnNumber ] = label;\n  }\n\n  getColumnLabelIndex(label: string): number | undefined {\n    for (const [ index, l ] of this.colLabels.entries()) {\n      if (l === label) return index;\n    }\n  }\n\n  print() {\n    console.table([ ...this.rowsWithLabelsObject() ]);\n  }\n\n  *rowsWithLabelsArray() {\n    for (let index = 0; index < this.rows.length; index++) {\n      const labelledRow = this.getRowWithLabelsArray(index);\n      yield labelledRow;\n    }\n  }\n\n  /**\n   * Return a copy of table as nested array\n   * ```js\n   * const t = new Table();\n   * // add stuff\n   * // ...\n   * const m = t.asArray();\n   * for (const row of m) {\n   *  for (const colValue of row) {\n   *    // iterate over all column values for this row\n   *  }\n   * }\n   * ```\n   * \n   * Alternative: get value at row Y and column X\n   * ```js\n   * const value = m[y][x];\n   * ```\n   * @returns \n   */\n  asArray(): Array<Array<V | undefined>> {\n    const r: Array<Array<V | undefined>> = [];\n    for (const row of this.rows) {\n      if (row === undefined) r.push([]);\n      else r.push([ ...row ]);\n    }\n    return r;\n  }\n\n  /**\n   * Return the number of rows\n   */\n  get rowCount() {\n    return this.rows.length;\n  }\n\n  /**\n   * Return the maximum number of columns in any row\n   */\n  get columnCount() {\n    const lengths = this.rows.map(row => row.length);\n    return Math.max(...lengths);\n  }\n\n  *rowsWithLabelsObject() {\n    for (let index = 0; index < this.rows.length; index++) {\n      const labelledRow = this.getRowWithLabelsObject(index);\n      yield labelledRow;\n    }\n  }\n\n  labelRows(...labels: Array<string>) {\n    this.rowLabels = labels;\n  }\n\n  appendRow(...data: Array<V | undefined>) {\n    this.rows.push(data);\n  }\n\n  getRowWithLabelsArray(rowNumber: number): Array<[ label: string | undefined, value: V | undefined ]> | undefined {\n    const row = this.rows.at(rowNumber);\n    if (row === undefined) return undefined;\n    return row.map((value, index) => [ this.colLabels.at(index), value ]);\n  }\n\n  /**\n   * Return a row of objects. Keys use the column labels.\n   * \n   * ```js\n   * const row = table.getRowWithLabelsObject(10);\n   * // eg:\n   * // [{ colour: red, size: 10}, { colour: blue, size: 20 }]\n   * ```\n   * @param rowNumber \n   * @returns \n   */\n  getRowWithLabelsObject(rowNumber: number): object | undefined {\n    const row = this.rows.at(rowNumber);\n    if (row === undefined) return undefined;\n    const object = {};\n    for (let index = 0; index < this.colLabels.length; index++) {\n      const label = this.colLabels.at(index) ?? index.toString();\n      // @ts-expect-error\n      object[ label ] = row[ index ];\n    }\n    return object;\n  }\n\n  /**\n   * Gets or creates a row at `rowNumber`.\n   * @param rowNumber \n   * @returns \n   */\n  private getOrCreateRow(rowNumber: number): Array<V | undefined> {\n    let row = this.rows.at(rowNumber);\n    if (row === undefined) {\n      row = [];\n      this.rows[ rowNumber ] = row;\n    }\n    return row;\n  }\n\n  /**\n   * Gets the values at `rowNumber`\n   * @param rowNumber \n   * @returns \n   */\n  row(rowNumber: number): Array<V | undefined> | undefined {\n    return this.rows.at(rowNumber);\n  }\n\n  /**\n   * Set the value of row,column to `value`\n   * @param rowNumber \n   * @param columnNumber \n   * @param value \n   */\n  set(rowNumber: number, columnNumber: number, value: V | undefined) {\n    const row = this.getOrCreateRow(rowNumber);\n    row[ columnNumber ] = value;\n  }\n\n  get(rowNumber: number, column: number | string) {\n    const row = this.getOrCreateRow(rowNumber);\n    const index = typeof column === `number` ? column : this.getColumnLabelIndex(column);\n    if (index === undefined) throw new Error(`Column not found: ${ column }`);\n    return row[ index ];\n  }\n\n  /**\n   * For a given row number, set all the columns to `value`.\n   * `cols` gives the number of columns to set\n   * @param rowNumber \n   * @param cols \n   * @param value \n   */\n  setRow(rowNumber: number, cols: number, value: V | undefined) {\n    const row = this.getOrCreateRow(rowNumber);\n    for (let columnNumber = 0; columnNumber < cols; columnNumber++) {\n      row[ columnNumber ] = value;\n    }\n  }\n}","/* eslint-disable @typescript-eslint/require-await */\n/* eslint-disable unicorn/prefer-ternary */\nimport { Async } from \"../Generators.js\";\nimport { Elapsed } from \"../flow/index.js\";\nimport { intervalToMs, type Interval } from \"../flow/IntervalType.js\";\nimport { sleep } from \"../flow/Sleep.js\";\nimport { isAsyncIterable } from \"../Iterable.js\";\nimport { Queues } from \"../collections/index.js\";\nimport { throwIntegerTest } from \"../Guards.js\";\n\n/**\n * A Generator, AsyncGenerator or IterableIterator\n */\nexport type Gen<V> = Generator<V> | AsyncGenerator<V> | IterableIterator<V>;\nexport type GenOrData<V> = Array<V> | Gen<V>;\n\nexport type Link<In, Out> = (input: GenOrData<In>) => AsyncGenerator<Out>;\n\nexport type GenFactoryNoInput<Out> = () => AsyncGenerator<Out>;\n\n/**\n * An array of chain links where first one is a source\n */\nexport type LinksWithSource<In, Out> = [\n  Link<In, any> | GenOrData<In> | GenFactoryNoInput<In>,\n  ...Array<Link<any, any>>,\n  Link<any, Out>\n]\n\n\n/**\n * An array of chain links without a source\n */\nexport type Links<In, Out> = [\n  Link<In, any>,\n  ...Array<Link<any, any>>,\n  Link<any, Out>\n]\n\n/**\n * Wrap the primitive value as generator\n * @param value \n */\nfunction* primitiveToGenerator(value: number | boolean | string) {\n  yield value;\n}\n\n/**\n * Wrap the primitive value as an async generator\n * @param value \n */\nasync function* primitiveToAsyncGenerator(value: number | boolean | string) {\n  yield value;\n  await sleep(1);\n}\n\n/**\n * Resolve the data, primitive or function to an AsyncGenerator\n * @param input \n * @returns \n */\nfunction resolveToAsyncGen<V>(input: GenOrData<V> | GenFactoryNoInput<V> | undefined): AsyncGenerator<V> | undefined {\n  if (input === undefined) return;\n  if (Array.isArray(input)) {\n    return Async.fromArray(input);\n  } else if (typeof input === `number` || typeof input === `boolean` || typeof input === `string`) {\n    // Assumes V is primitive\n    return primitiveToAsyncGenerator(input) as AsyncGenerator<V>;\n  } else if (typeof input === `function`) {\n    return input();\n  } else if (isAsyncIterable(input)) {\n    return input;\n  }\n  return Async.fromIterable(input);\n}\n\n/**\n * Resolve the array, data or function to a Generator\n * @param input \n * @returns \n */\nfunction resolveToGen<V>(input: GenOrData<V> | GenFactoryNoInput<V>): Gen<V> {\n  if (Array.isArray(input)) {\n    const a = input.values();\n    (a as any)._name = `arrayInput`;\n    return a;\n  } else if (typeof input === `number` || typeof input === `boolean` || typeof input === `string`) {\n    // Assumes V is primitive\n    return primitiveToGenerator(input) as Gen<V>;\n  } else if (typeof input === `function`) {\n    return input();\n  }\n  return input;\n}\n\n/**\n * Delay options\n */\nexport type DelayOptions = {\n  /**\n   * Time before yielding\n   */\n  before?: Interval,\n  /**\n   * Time after yielding\n   */\n  after?: Interval\n}\n\n/**\n * Add delay before/after values are emitted from the input stream.\n * @param options \n * @returns \n */\nexport function delay<In>(options: DelayOptions): Link<In, In> {\n  const before = intervalToMs(options.before, 0);\n  const after = intervalToMs(options.after, 0);\n\n  async function* delay(input: GenOrData<In>): AsyncGenerator<In> {\n    input = resolveToGen(input);\n    for await (const value of input) {\n      if (before > 0) {\n        await sleep(before);\n      }\n      yield value;\n      if (after > 0) {\n        await sleep(after);\n      }\n    }\n  }\n  delay._name = `delay`;\n  return delay;\n}\n\nfunction isNoInput<Out>(c: Link<any, any>): c is GenFactoryNoInput<Out> {\n  if (`_allowNoInput` in c) return true;\n  return false;\n}\n\nexport type LazyChain<In, Out> = {\n  /**\n   * Return the chain as a regular generator, \n   * optionally providing the starting data\n   * @param data \n   * @returns \n   */\n  asGenerator: (data?: GenOrData<In>) => AsyncGenerator<Out>\n  asArray: (data?: GenOrData<In>) => Promise<Array<Out>>\n  lastOutput: (data?: GenOrData<In>) => Promise<Out | undefined>\n  firstOutput: (data?: GenOrData<In>) => Promise<Out | undefined>\n  fromFunction: (callback: () => any) => LazyChain<any, any>\n  take: (limit: number) => LazyChain<In, Out>\n  debounce: (duration: Interval) => LazyChain<In, Out>\n  delay: (options: DelayOptions) => LazyChain<In, Out>\n  chunk: (size: number, returnRemainers?: boolean) => LazyChain<In, Out>\n  filter: (predicate: (input: any) => boolean) => LazyChain<In, Out>\n  min: () => LazyChain<any, number>\n  max: () => LazyChain<any, number>\n  average: () => LazyChain<any, number>\n  total: () => LazyChain<In, number>\n  tally: () => LazyChain<In, number>\n  input: (data: GenOrData<In>) => LazyChain<In, Out>\n  drop: (predicate: (value: In) => boolean) => LazyChain<In, Out>\n  duration: (period: Interval) => LazyChain<In, Out>\n  flatten: (flattener: (values: Array<any>) => any) => LazyChain<In, Out>\n  transform: (transformer: (v: any) => any) => LazyChain<In, Out>\n}\n\nexport function lazy<In, Out>(): LazyChain<In, Out> {\n  const chained: Array<Link<any, any>> = [];\n  let dataToUse: GenOrData<In> | undefined;\n\n  const asGenerator = <V>(data?: GenOrData<In>) => {\n    if (data === undefined) data = dataToUse;\n    let d = resolveToAsyncGen(data);\n    for (const c of chained) {\n      if (d === undefined) {\n        if (isNoInput<In>(c)) {\n          d = c();\n        } else {\n          throw new Error(`Function '${ getName(c) }' requires input. Provide it to the function, or call 'input' earlier.`)\n        }\n      } else {\n        d = c(d);\n      }\n    }\n    return d as AsyncGenerator<V>\n  }\n\n  const w = {\n    asGenerator,\n    transform: (transformer: (v: any) => any) => {\n      chained.push(transform(transformer));\n      return w;\n    },\n    flatten: (flattener: (values: Array<any>) => any) => {\n      chained.push(flatten(flattener));\n      return w;\n    },\n    drop: (predicate: (v: In) => boolean) => {\n      chained.push(drop(predicate));\n      return w;\n    },\n    delay: (options: DelayOptions) => {\n      chained.push(delay(options));\n      return w;\n    },\n    duration: (elapsed: Interval) => {\n      chained.push(duration(elapsed));\n      return w;\n    },\n    debounce: (rate: Interval) => {\n      chained.push(debounce(rate));\n      return w;\n    },\n    fromFunction: (callback: () => any) => {\n      chained.push(fromFunction(callback));\n      return w;\n    },\n    take: (limit: number) => {\n      chained.push(take(limit));\n      return w;\n    },\n    chunk: (size: number, returnRemainders = true) => {\n      chained.push(chunk(size, returnRemainders))\n      return w;\n    },\n    filter: (predicate: (input: any) => boolean) => {\n      chained.push(filter(predicate));\n      return w;\n    },\n    min: (): LazyChain<any, number> => {\n      chained.push(min());\n      return w as unknown as LazyChain<any, number>;\n    },\n    max: (): LazyChain<any, number> => {\n      chained.push(max());\n      return w as unknown as LazyChain<any, number>;\n    },\n    average: (): LazyChain<any, number> => {\n      chained.push(average());\n      return w as unknown as LazyChain<any, number>;\n    },\n    total: (): LazyChain<any, number> => {\n      chained.push(total());\n      return w as unknown as LazyChain<any, number>;\n    },\n    tally: (): LazyChain<any, number> => {\n      chained.push(tally());\n      return w as unknown as LazyChain<any, number>;\n    },\n    input(data: GenOrData<In>) {\n      dataToUse = data;\n      return w\n    },\n    asAsync(data?: GenOrData<In>) {\n      let d = data ?? dataToUse;\n      for (const c of chained) {\n        if (d === undefined && isNoInput<In>(c)) {\n          d = c();\n        } else if (d === undefined) {\n          throw new Error(`Function '${ getName(c) }' needs input. Pass in data calling 'asAsync', or call 'input' earlier`);\n        } else {\n          d = c(d);\n        }\n      }\n      return w;\n    },\n    asArray: async (data?: GenOrData<In>): Promise<Array<Out>> => {\n      const g = asGenerator<Out>(data);\n      return await Async.toArray<Out>(g);\n    },\n    firstOutput: async (data?: GenOrData<In>): Promise<Out | undefined> => {\n      const g = asGenerator<Out>(data);\n      const v = await g.next();\n      return v.value as Out;\n    },\n    lastOutput: async (data?: GenOrData<In>): Promise<Out | undefined> => {\n      const g = asGenerator<Out>(data);\n      let lastValue: Out | undefined;\n      for await (const v of g) {\n        lastValue = v as Out;\n      }\n      return lastValue;\n    },\n  }\n  return w as unknown as LazyChain<In, Out>;\n}\n\n/**\n * Ensure a minimum length of time between values.\n * Values being produced too quickly are dropped.\n * \n * In the following example, only three values will be let through.\n * ```js\n * const chain = Chains.chain(\n *  // Produce values every 10ms for 350ms\n *  Chains.tick({ interval: 10, elapsed: 350 }),\n *  // Only let a value through every 100ms\n *  Chains.debounce(100)\n * );\n * ```\n * @param rate \n * @returns \n */\nexport function debounce<In>(rate: Interval): Link<In, In> {\n  const rateMs = intervalToMs(rate, 0);\n\n  async function* debounce(input: GenOrData<In>): AsyncGenerator<In> {\n    input = resolveToGen(input);\n    let elapsed = Elapsed.since();\n    for await (const value of input) {\n      if (elapsed() < rateMs) continue;\n      yield value;\n      elapsed = Elapsed.since();\n    }\n  }\n  debounce._name = `debounce`;\n  return debounce;\n}\n\n/**\n * Allow values through until a duration has elapsed. After\n * that, the chain stops.\n * @param duration \n * @returns \n */\nexport function duration<In>(elapsed: Interval): Link<In, In> {\n  const durationMs = intervalToMs(elapsed, 0);\n\n  async function* duration(input: GenOrData<In>): AsyncGenerator<In> {\n    input = resolveToGen(input);\n    const elapsed = Elapsed.since();\n    for await (const value of input) {\n      if (elapsed() > durationMs) break;\n      yield value;\n    }\n  }\n  duration._name = `duration`;\n  return duration;\n}\n\nexport type TickOptions = {\n  interval: Interval\n  loops?: number\n  elapsed?: Interval\n  asClockTime?: boolean\n}\n\n/**\n * Generate timestamp values\n * By default it runs forever. \n * Use `loops` or `elapsed` to set upper limits.\n * \n * Options:\n * - `asClockTime`: If true, yielded value will be clock time rather than elapsed\n * @param options \n * @returns \n */\nexport function tick(options: TickOptions): GenFactoryNoInput<number> {\n  const intervalMs = intervalToMs(options.interval, 0);\n  const asClockTime = options.asClockTime ?? false;\n  const loops = options.loops ?? Number.MAX_SAFE_INTEGER;\n  let looped = 0;\n  const durationTime = intervalToMs(options.elapsed, Number.MAX_SAFE_INTEGER);\n\n  async function* ts(): AsyncGenerator<number> {\n    const elapsed = Elapsed.since();\n    while (looped < loops && elapsed() < durationTime) {\n      yield asClockTime ? Date.now() : elapsed();\n\n      // Adjust sleep period so timing errors don't accumulate\n      const expectedTimeDiff = (looped * intervalMs) - elapsed();\n      await sleep(Math.max(0, intervalMs + expectedTimeDiff));\n      looped++;\n    }\n  }\n  ts._name = `timestamp`;\n  return ts;\n}\n\n/**\n * Produce a value from a callback. When\n * the callback returns _undefined_ it is considered done.\n * \n * ```js\n * const callback = () => Math.random();\n * \n * const f = Chains.fromFunction(callback);\n * f(); // New random number\n * ```\n * \n * In the context of a chain:\n * ```js\n * let produced = 0;\n * const chain = Chains.chain<number, string>(\n *  // Produce incrementing numbers\n *  Chains.fromFunction(() => produced++),\n *  // Convert to `x:0`, `x:1` ...\n *  Chains.transform(v => `x:${ v }`),\n *  // Take first 5 results\n *  Chains.cap(5)\n * );\n * const data = await Chains.asArray(chain);\n * ```\n * @param callback \n * @returns \n */\nexport function fromFunction<Out>(callback: () => Promise<Out> | Out): GenFactoryNoInput<Out> {\n  async function* fromFunction(): AsyncGenerator<Out> {\n    while (true) {\n      const v = await callback();\n      if (v === undefined) break;\n      yield v;\n    }\n  }\n  fromFunction._name = `fromFunction`;\n  return fromFunction;\n}\n\nconst oncePromise = (target: EventTarget, name: string): Promise<any> => {\n  return new Promise(resolve => {\n    const handler = (...args: Array<any>) => {\n      target.removeEventListener(name, handler);\n      resolve(args);\n    };\n    target.addEventListener(name, handler);\n  });\n};\n\nexport function fromEvent<Out>(target: EventTarget, name: string) {\n  async function* fromEvent(): AsyncGenerator<Out> {\n    while (true) {\n      yield await oncePromise(target, name) as Out;\n    }\n  }\n  fromEvent._name = `fromEvent`;\n  return fromEvent;\n}\n\n/**\n * Treats the chain/generator as a promise\n * \n * ```js\n * const ticker = asPromise(tick({ interval: 1000 }));\n * const x = await ticker(); //  Waits for 1000ms before giving a value\n * ```\n * \n * This will only ever return one value. To return multiple values, it's necessary\n * to call `asPromise` and `await` the result in a loop.\n * @param valueToWrap \n * @returns \n */\nexport function asPromise<V>(valueToWrap: AsyncGenerator<V> | GenFactoryNoInput<V>) {\n  let lastValue: V | undefined;\n\n  const outputType = (typeof valueToWrap === `function`) ? valueToWrap() : valueToWrap;\n\n  async function asPromise(): Promise<V | undefined> {\n    const v = await outputType.next();\n    if (v.done) return;\n    lastValue = v.value;\n    return lastValue;\n  }\n  return asPromise;\n}\n\n/**\n * Returns the most recent value from the chain/generator, or\n * `initialValue` (defaulting to _undefined_) if no value\n * has been emitted yet.\n * \n * ```js\n * const ticker = asValue(tick({ interval: 1000 }));\n * x = ticker(); // Get the most recent value\n * ```\n * \n * Every time it's called, it fetches a new value from the generator, assuming\n * it isn't already awaiting a result.\n * \n * In the meantime, the last value (or `initialValue`) is returned.\n * @param valueToWrap \n * @param initialValue \n * @returns \n */\nexport function asValue<V>(valueToWrap: AsyncGenerator<V> | GenFactoryNoInput<V>, initialValue?: V) {\n  let lastValue: V | undefined = initialValue;\n  let awaiting = false;\n  const outputType = (typeof valueToWrap === `function`) ? valueToWrap() : valueToWrap;\n\n  function asValue(): V | undefined {\n    if (!awaiting) {\n      awaiting = true;\n      outputType.next().then(v => {\n        lastValue = v.value;\n        awaiting = false;\n      }).catch(error => {\n        awaiting = false;\n        throw error;\n      });\n    }\n    return lastValue;\n  }\n  return asValue;\n}\n\n/**\n * Calls `callback` whenever the chain/generator produces a value.\n * \n * When using `asCallback`, call it with `await` to let generator run its course before continuing:\n * ```js\n * await asCallback(tick({ interval:1000, loops:5 }), x => {\n *  // Gets called 5 times, with 1000ms interval\n * });\n * console.log(`Hi`); // Prints after 5 seconds\n * ```\n * \n * Or if you skip the `await`, code continues and callback will still run:\n * ```js\n * asCallback(tick({ interval: 1000, loops: 5}), x => {\n *  // Gets called 5 times, with 1000ms interval\n * });\n * console.log(`Hi`); // Prints immediately\n * ```\n * @param valueToWrap \n * @param callback \n */\nexport async function asCallback<V>(valueToWrap: GenOrData<V> | GenFactoryNoInput<V>, callback: (v: V) => unknown, onDone?: () => void) {\n  const outputType = (typeof valueToWrap === `function`) ? valueToWrap() : valueToWrap;\n  for await (const value of outputType) {\n    callback(value);\n  }\n  if (onDone) onDone();\n}\n\n\n/**\n * Async function that returns the chain as an array of values\n * ```js\n * const values = await asArray(tick( { interval: 1000, loops: 5 }));\n * // After 5 seconds, values will be a set of timestamps.\n * ```\n * @param chain \n * @returns \n */\nexport async function asArray<Out>(valueToWrap: AsyncGenerator<Out> | GenFactoryNoInput<Out>): Promise<Array<Out>> {\n  const outputType = (typeof valueToWrap === `function`) ? valueToWrap() : valueToWrap;\n  return Async.toArray(outputType);\n}\n\n/**\n * Adds values to the provided array as they are produced,\n * mutating array.\n * \n * ```js\n * const data = [];\n * addToArray(data, tick({ interval: 1000, loops: 5 }));\n * // Execution continues immediately, with `data` mutated over time\n * ```\n * @param chain \n * @param array \n */\nexport async function addToArray<Out>(array: Array<Out>, valueToWrap: AsyncGenerator<Out> | GenFactoryNoInput<Out>) {\n  const outputType = (typeof valueToWrap === `function`) ? valueToWrap() : valueToWrap;\n  for await (const value of outputType) {\n    array.push(value);\n  }\n}\n\n/**\n * Input a single value to the chain, return a single result\n * @param f \n * @param input \n * @returns \n */\nexport async function single<In, Out>(f: Link<In, Out>, input: In): Promise<Out | undefined> {\n  const iterator = await f([ input ]).next();\n  return iterator.value as Out | undefined;\n}\n\n/**\n * Takes an array of values, flattening to a single one\n * using the provided `flattener` function.\n * \n * ```js\n * // Create a chain that flattens values\n * const flatten = Chains.flatten(values => Math.max(...values));\n * // Feed it a single input (an array), get a single output back:\n * const result = await Chains.single(flatten, [ 1, 2, 3]); // 3\n * ```\n * @param flattener Function to flatten array of values to a single value\n * @returns \n */\nexport function flatten<In, Out>(flattener: (v: Array<In>) => Out): Link<Array<In>, Out> {\n  async function* flatten(input: GenOrData<Array<In>>): AsyncGenerator<Out> {\n    input = resolveToGen(input);\n    for await (const value of input) {\n      yield flattener(value);\n    }\n  }\n  flatten._name = `flatten`;\n  return flatten;\n}\n\n/**\n * Transform values from one type to another. Just like a map function.\n * @param transformer \n * @returns \n */\nexport function transform<In, Out>(transformer: (v: In) => Out): Link<In, Out> {\n  async function* transform(input: GenOrData<In>): AsyncGenerator<Out> {\n    input = resolveToGen(input);\n    for await (const value of input) {\n      yield transformer(value);\n    }\n  }\n  transform._name = `transform`;\n  return transform;\n}\n\n/**\n * Merge values from several sources into one stream, interleaving values.\n * When all streams are complete it finishes.\n * \n * Alternatively:\n * - {@link mergeAsArray} emits snapshots of all the generators, as quickly as the fastest one\n * - {@link synchronise} which releases a set of results when all inputs have emitted a value\n * @param sources \n */\nexport async function* mergeFlat<Out>(...sources: Array<GenOrData<any> | GenFactoryNoInput<any>>): AsyncGenerator<Out> {\n  const sourcesInput = sources.map(source => resolveToAsyncGen(source));\n  const buffer = Queues.mutable<Out>();\n  let completed = 0;\n\n  const schedule = async (source: AsyncGenerator<any> | undefined) => {\n    if (source === undefined) {\n      completed++;\n      return;\n    }\n\n    const x = await source.next();\n    if (x.done) {\n      completed++;\n    } else {\n      buffer.enqueue(x.value as Out);\n      // eslint-disable-next-line @typescript-eslint/no-misused-promises\n      setTimeout(() => schedule(source), 1);\n    }\n  }\n\n  for (const source of sourcesInput) {\n    // eslint-disable-next-line @typescript-eslint/no-misused-promises\n    setTimeout(() => schedule(source), 1);\n  }\n\n  const loopSpeed = 10;\n  let loopFactor = 1;\n  while (completed < sourcesInput.length) {\n    const d = buffer.dequeue();\n    if (d === undefined) {\n      // Grow loop factor up to 10\n      loopFactor = Math.min(loopFactor + 1, 10);\n    } else {\n      yield d;\n      // Reset loop factor\n      loopFactor = 1;\n    }\n    await sleep(loopSpeed * loopFactor);\n  }\n}\n\n/**\n * Generate values for each source, returning results as an array.  \n * If a source finishes before another, null will be used at its position in the results.\n * Use {@link synchronise} instead to only release results when all sources have yielded a value.\n * \n * Finishes when all generators finish.\n * \n * Alternatively:\n * - {@link mergeFlat} interleaves streams as single values\n * - {@link synchronise} only return results when all sourcse have yielded a value\n * @param sources \n */\nexport async function* mergeAsArray(...sources: Array<GenOrData<any> | GenFactoryNoInput<any>>): AsyncGenerator<Array<any>> {\n  const sourcesInput = sources.map(source => resolveToGen(source));\n  let somethingProduced = true;\n  while (somethingProduced) {\n    let data = [];\n    for (let index = 0; index < sourcesInput.length; index++) {\n      // eslint-disable-next-line unicorn/no-null\n      data[ index ] = null;\n    }\n\n    somethingProduced = false;\n    // Request the next value from each source\n    for (const [ index, source ] of sourcesInput.entries()) {\n      const v = await source.next();\n      if (!v.done) {\n        data[ index ] = v.value;\n        somethingProduced = true;\n      }\n    }\n    if (somethingProduced) {\n      // Send data\n      yield data;\n      data = [];\n    }\n  }\n}\n\n/**\n * Synchronise several sources, releasing a set of results when every\n * source has produced something. Finishes as soon as _any_ source finishes.\n * \n * ie. the rate of emitting data is determined by the slowest source.\n * \n * Alternatively:\n * - {@link mergeFlat} interleaves streams as single values\n * - {@link mergeAsArray} emits snapshots of all the generators, as quickly as the fastest one\n * @param sources \n */\nexport async function* synchronise(...sources: Array<GenOrData<any> | GenFactoryNoInput<any>>): AsyncGenerator<Array<any>> {\n  const sourcesInput = sources.map(source => resolveToGen(source));\n  let somethingStopped = false;\n  while (!somethingStopped) {\n    let data = [];\n    for (let index = 0; index < sourcesInput.length; index++) {\n      // eslint-disable-next-line unicorn/no-null\n      data[ index ] = null;\n    }\n\n    somethingStopped = false;\n    // Request the next value from each source\n    for (const [ index, source ] of sourcesInput.entries()) {\n      const v = await source.next();\n      if (v.done) {\n        somethingStopped = true;\n        break;\n      } else {\n        data[ index ] = v.value;\n      }\n    }\n\n    if (somethingStopped) break;\n    yield data;\n    data = [];\n  }\n}\n\n/**\n * Take `limit` number of results from the stream, before closing\n * @param limit \n * @returns \n */\nexport function take<In>(limit: number): Link<In, In> {\n  async function* take(input: GenOrData<In>): AsyncGenerator<In> {\n    input = resolveToGen(input);\n    let yielded = 0;\n    for await (const value of input) {\n      if (++yielded > limit) break;\n      yield value;\n    }\n  }\n  take._name = `take`;\n  return take;\n}\n\nconst getName = (c: Link<any, any>): string => {\n  if (`_name` in c) {\n    return c._name as string;\n  } else {\n    return c.name;\n  }\n}\n/**\n * Returns a running tally of how many items have been\n * emitted from the input source.\n * \n * This is different than {@link total} which adds up numeric values\n * @param limit \n * @returns \n */\nexport function tally<In>(): Link<In, number> {\n  async function* tally(input: GenOrData<In>): AsyncGenerator<number> {\n    input = resolveToGen(input);\n    let count = 0;\n    for await (const _ of input) {\n      yield ++count;\n    }\n  }\n  tally._name = `tally`;\n  return tally;\n}\n\n/**\n * Returns the smallest value from the input.\n * Non-numeric data is filtered out\n * @returns \n */\nexport function min(): Link<number, number> {\n  async function* min(input: GenOrData<number>): AsyncGenerator<number> {\n    input = resolveToGen(input);\n    let min = Number.MAX_SAFE_INTEGER;\n    for await (const value of input) {\n      if (typeof value !== `number`) break;\n\n      min = Math.min(value, min);\n      yield min;\n    }\n  }\n  min._name = `min`;\n  return min;\n}\n\n/**\n * Returns the largest value from the input\n * Non-numeric data is filtered out\n * @returns \n */\nexport function max(): Link<number, number> {\n  async function* max(input: GenOrData<number>): AsyncGenerator<number> {\n    input = resolveToGen(input);\n    let max = Number.MIN_SAFE_INTEGER;\n    for await (const value of input) {\n      if (typeof value !== `number`) break;\n      max = Math.max(value, max);\n      yield max;\n    }\n  }\n  max._name = `max`;\n  return max;\n}\n\n/**\n * Returns the average from the input.\n * Non-numeric values are filtered out.\n * @returns \n */\nexport function average(): Link<number, number> {\n  async function* average(input: GenOrData<number>): AsyncGenerator<number> {\n    input = resolveToGen(input);\n    let total = 0;\n    let count = 0;\n    for await (const value of input) {\n      if (typeof value !== `number`) break;\n      count++;\n      total += value;\n      yield total / count;\n    }\n  }\n  average._name = `average`;\n  return average;\n}\n\n/**\n * Returns the total of the numeric values.\n * Non-numeric values are filtered out.\n * @returns \n */\nexport function total(): Link<number, number> {\n  async function* average(input: GenOrData<number>): AsyncGenerator<number> {\n    input = resolveToGen(input);\n    let total = 0;\n    for await (const value of input) {\n      if (typeof value !== `number`) break;\n      total += value;\n      yield total;\n    }\n  }\n  average._name = `average`;\n  return average;\n}\n\n/**\n * Chunks an input stream into `size` chunks.\n * @param size \n * @param returnRemainders If true (default) left over data that didn't make a full chunk is also returned\n * @returns \n */\nexport function chunk<In>(size: number, returnRemainders = true): Link<In, Array<In>> {\n  throwIntegerTest(size, `aboveZero`, `size`);\n  async function* chunk(input: GenOrData<In>): AsyncGenerator<Array<In>> {\n    input = resolveToGen(input);\n    let buffer: Array<In> = [];\n    for await (const value of input) {\n      buffer.push(value);\n      if (buffer.length >= size) {\n        yield buffer;\n        buffer = []\n      }\n    }\n    if (returnRemainders && buffer.length > 0) yield buffer;\n  }\n  chunk._name = `chunk`;\n  return chunk;\n}\n\n/**\n * Filters the input source, only allowing through\n * data for which `predicate` returns _true_\n * \n * {@link drop}, on the other hand excludes values for which predicate is _true_\n * @param predicate \n * @returns \n */\nexport function filter<In>(predicate: (v: In) => boolean): Link<In, In> {\n  async function* filter(input: GenOrData<In>): AsyncGenerator<In> {\n    input = resolveToGen(input);\n    for await (const value of input) {\n      if (predicate(value)) {\n        yield value;\n      }\n    }\n  }\n  filter._name = `filter`;\n  return filter;\n}\n\n/**\n * Drops all values from input stream for which `predicate` returns _true_\n * \n * {@link filter}, on the other hand includes values where the predicate is _true_\n * @param predicate \n * @returns \n */\nexport function drop<In>(predicate: (v: In) => boolean): Link<In, In> {\n  async function* drop(input: GenOrData<In>): AsyncGenerator<In> {\n    input = resolveToGen(input);\n    for await (const value of input) {\n      if (!predicate(value)) {\n        yield value;\n      }\n    }\n  }\n  drop._name = `drop`;\n  return drop;\n}\n\n/**\n * Chain functions together. First argument is the source.\n * \n * @example Process an array of strings. Transforming into\n * integers, and then filtering only even numbers.\n * ```js\n * const ch = Chains.run(\n *  [ `1`, `2`, `3`, `4`, `5`, `6`, `7`, `8`, `9`, `10` ],\n *  Chains.transform<string, number>(v => Number.parseInt(v)),\n *  Chains.filter(v => v % 2 === 0)\n *);\n * const output = await Async.toArray(ch2);\n * // [ 2, 4, 6, 8, 10 ]\n * ```\n * @param functions \n * @returns \n */\nexport async function* run<In, Out>(...functions: LinksWithSource<In, Out>): AsyncGenerator<Out> {\n  let input: Gen<In> | undefined;\n  for (const fnOrData of functions) {\n    if (typeof fnOrData === `function`) {\n      input = fnOrData(input ?? []);\n    } else {\n      input = resolveToGen(fnOrData);\n    }\n  }\n  if (input === undefined) return;\n  for await (const v of input) {\n    yield v as Out;\n  }\n}\n\n/**\n * Prepare a chain, allowing you to provide a source at execution time.\n * ```js\n * const chain = Chains.prepare(\n *  Chains.transform<string,number>( v => number.parseInt(v) ),\n *  Chains.filter<number>(v => v % 2 === 0)\n * );\n * \n * // Run it with provided source\n * for await (const v of chain([`1`, `2`, `3`])) {\n * \n * }\n * ```\n * @param functions \n * @returns \n */\nexport function prepare<In, Out>(...functions: Links<In, Out>) {\n  const r = (source: GenOrData<In> | GenFactoryNoInput<Out>) => {\n    return run(source, ...functions);\n  }\n  return r;\n}\n","type WithEvents = {\n  addEventListener(type: string, callbackfn: any): void;\n  removeEventListener(type: string, callbackfn: any): void;\n}\n\n//export { eachInterval } from './flow/Interval.js';\n\nexport const isAsyncIterable = (v: any): v is AsyncIterable<any> =>\n  Symbol.asyncIterator in new Object(v);\n\nexport const isIterable = (v: any): v is Iterable<any> =>\n  Symbol.iterator in new Object(v);\n\nexport const eventsToIterable = <V>(\n  eventSource: WithEvents,\n  eventType: string\n): AsyncIterator<any> => {\n  const pullQueue: Array<any> = [];\n  const pushQueue: Array<any> = [];\n  let done = false;\n  const pushValue = (args: any) => {\n    if (pullQueue.length > 0) {\n      //eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      const resolver = pullQueue.shift();\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-call\n      resolver(...args);\n    } else {\n      pushQueue.push(args);\n    }\n  };\n\n  const pullValue = (): Promise<V> =>\n    new Promise<V>((resolve) => {\n      if (pushQueue.length > 0) {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        const arguments_ = pushQueue.shift();\n        // @ts-expect-error\n        resolve(...arguments_);\n      } else {\n        pullQueue.push(resolve);\n      }\n    });\n\n  const handler = (...arguments_: any) => {\n    pushValue(arguments_);\n  };\n\n  eventSource.addEventListener(eventType, handler);\n\n  const r: AsyncIterator<V> = {\n    next: async (): Promise<IteratorResult<V>> => {\n      if (done) return { done: true, value: undefined };\n      return {\n        done: false,\n        value: await pullValue(),\n      };\n    },\n    //eslint-disable-next-line @typescript-eslint/require-await\n    return: async (): Promise<IteratorResult<V>> => {\n      done = true;\n      eventSource.removeEventListener(eventType, handler);\n      return { done: true, value: undefined };\n    },\n    //eslint-disable-next-line @typescript-eslint/require-await\n    throw: async (error: any): Promise<IteratorResult<V>> => {\n      done = true;\n      return {\n        done: true,\n        value: Promise.reject(error),\n      };\n    },\n  };\n  return r;\n};\n","export * as Directed from './DirectedGraph.js';\nexport * as Undirected from './UndirectedGraph.js';","/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport { immutable as immutableMap, type IMapImmutable } from \"../../collections/map/Map.js\"\nimport { Table } from \"../Table.js\"\n\n\nexport type Vertex = Readonly<{\n  id: string\n}>\n\nexport type Edge = Readonly<{\n  a: string,\n  b: string,\n  weight?: number\n}>\n\nexport type Graph = Readonly<{\n  edges: ReadonlyArray<Edge>,\n  vertices: IMapImmutable<string, Vertex>\n}>\n\nexport type ConnectOptions = Readonly<{\n  a: string\n  b: string | Array<string>\n  weight?: number\n}>\n\nexport const createVertex = (id: string): Vertex => {\n  return {\n    id\n  }\n}\n\nexport const updateGraphVertex = (graph: Graph, vertex: Vertex): Graph => {\n  const gr = {\n    ...graph,\n    vertices: graph.vertices.set(vertex.id, vertex)\n  }\n  return gr;\n}\n\nexport const getOrCreate = (graph: Graph, id: string): Readonly<{ graph: Graph, vertex: Vertex }> => {\n  const v = graph.vertices.get(id);\n  if (v !== undefined) return { graph, vertex: v };\n\n  const vv = createVertex(id);\n  const gg = updateGraphVertex(graph, vv);\n  return { graph: gg, vertex: vv };\n}\n\nfunction resolveVertex(graph: Graph, idOrVertex: string | Vertex): Vertex {\n  const v = typeof idOrVertex === `string` ? graph.vertices.get(idOrVertex) : idOrVertex;\n  if (v === undefined) throw new Error(`Id not found ${ idOrVertex as string }`);\n  return v;\n}\n\nexport const hasConnection = (graph: Graph, a: string | Vertex, b: string | Vertex): boolean => {\n  const edge = getConnection(graph, a, b);\n  return edge !== undefined;\n}\n\nexport const getConnection = (graph: Graph, a: string | Vertex, b: string | Vertex): Edge | undefined => {\n  const aa = resolveVertex(graph, a);\n  const bb = resolveVertex(graph, b);\n  for (const edge of graph.edges) {\n    if (edge.a == aa.id && edge.b === bb.id) return edge;\n    if (edge.a == bb.id && edge.b === aa.id) return edge;\n  }\n  return;\n}\n\n/**\n * Connect A <-> B\n * @param graph \n * @param a \n * @param b \n * @param weight \n * @returns \n */\nexport function connectTo(graph: Graph, a: string, b: string, weight?: number): { graph: Graph, edge: Edge } {\n  const aResult = getOrCreate(graph, a);\n  graph = aResult.graph;\n  const bResult = getOrCreate(graph, b);\n  graph = bResult.graph;\n\n  let edge = getConnection(graph, a, b);\n  if (edge !== undefined) return { graph, edge };\n  edge = {\n    a,\n    b,\n    weight\n  }\n\n  const graphChanged: Graph = {\n    ...graph,\n    edges: [ ...graph.edges, edge ]\n  }\n  return { graph: graphChanged, edge }\n}\n\nexport function connect(graph: Graph, options: ConnectOptions): Graph {\n  const { a, weight, b } = options;\n  const destinations = Array.isArray(b) ? b : [ b ];\n\n  for (const destination of destinations) {\n    const result = connectTo(graph, a, destination, weight);\n    graph = result.graph;\n  }\n\n  return graph;\n}\n\nexport const graph = (...initialConnections: Array<ConnectOptions>): Graph => {\n  let g: Graph = {\n    vertices: immutableMap(),\n    edges: []\n  }\n  for (const ic of initialConnections) {\n    g = connect(g, ic);\n  }\n  return g;\n}\n\nexport function toAdjacencyMatrix(graph: Graph): Table<boolean> {\n  const v = [ ...graph.vertices.values() ];\n\n  const table = new Table<boolean>();\n  table.labelColumns(...v.map(vv => vv.id));\n  table.labelRows(...v.map(vv => vv.id));\n\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of, unicorn/prevent-abbreviations\n  for (let i = 0; i < v.length; i++) {\n    table.setRow(i, v.length, false);\n\n    const ii = v[ i ];\n    // eslint-disable-next-line unicorn/prevent-abbreviations\n    for (const [ j, jj ] of v.entries()) {\n      const connected = hasConnection(graph, ii, jj);\n      if (connected) {\n        table.set(i, j, true);\n      }\n    }\n  }\n  return table;\n}\n\n/**\n * Return a string representation of the graph for debug inspection\n * @param graph \n * @returns \n */\nexport const dumpGraph = (graph: Graph): string => {\n  const lines = debugGraphToArray(graph);\n  return lines.join(`\\n`);\n}\n\n/**\n * Return an array of a debug-print of every vertex.\n * @param graph \n * @returns \n */\nconst debugGraphToArray = (graph: Graph): Array<string> => {\n  const r: Array<string> = [];\n\n  r.push(`Vertices: ${ [ ...graph.vertices.values() ].map(v => v.id).join(`, `) }`);\n  // eslint-disable-next-line unicorn/no-array-push-push\n  r.push(`Edges:`);\n  for (const edge of graph.edges) {\n    r.push(stringForEdge(edge));\n  }\n  return r;\n}\n\nconst stringForEdge = (edge: Edge) => {\n  const weight = edge.weight ? ` (${ edge.weight })` : ``;\n  return `${ edge.a } <-> ${ edge.b }${ weight }`\n}\n\n/**\n * Iterate over all the vertices connectd to `context` vertex\n * @param graph Graph\n * @param context id or Vertex\n * @returns \n */\nexport function* adjacentVertices(graph: Graph, context: Vertex | string | undefined) {\n  if (context === undefined) return;\n  const vertex = typeof context === `string` ? graph.vertices.get(context) : context;\n  if (vertex === undefined) throw new Error(`Vertex not found ${ JSON.stringify(context) }`);\n\n  for (const edge of graph.edges) {\n    if (edge.a === context) yield resolveVertex(graph, edge.b);\n    else if (edge.b === context) yield resolveVertex(graph, edge.a);\n  }\n}\n\nexport function* edgesForVertex(graph: Graph, context: Vertex | string | undefined) {\n  if (context === undefined) return;\n  const vertex = typeof context === `string` ? graph.vertices.get(context) : context;\n  if (vertex === undefined) throw new Error(`Vertex not found ${ JSON.stringify(context) }`);\n\n  for (const edge of graph.edges) {\n    if (edge.a === context) yield edge;\n    else if (edge.b === context) yield edge;\n  }\n}","/**\n * Returns the similarity of `a` and `b` to each other,\n * where higher similarity should be a higher number.\n * @param a\n * @param b\n */\nexport type Similarity<V> = (a: V, b: V) => number;\n\ntype Scored = {\n  readonly score: number;\n};\n\nconst orderScore = (a: Scored, b: Scored) => {\n  if (a.score > b.score) return -1;\n  else if (a.score < b.score) return 1;\n  return 0;\n};\n\n/**\n * Options for alignmnent\n */\nexport type AlignOpts = {\n  /**\n   * If the similarity score is above this threshold,\n   * consider them the same\n   */\n  readonly matchThreshold?: number;\n  /**\n   * If true, additional console messages are printed during\n   * execution.\n   */\n  readonly debug?: boolean;\n};\n\n/**\n * Some data with an id property.\n */\nexport type DataWithId<V> = V & {\n  readonly id: string;\n};\n\n/**\n * Attempts to align prior data with new data, based on a provided similarity function.\n *\n * See also `alignById` for a version which encloses parameters.\n *\n * ```js\n * // Compare data based on x,y distance\n * const fn = (a, b) => {\n *  return 1-Points.distance(a, b);\n * }\n * const lastData = [\n *  { id:`1`, x:100, y:200 }\n *  ...\n * ]\n * const newData = [\n *  { id:`2`, x:101, y:200 }\n * ]\n * const aligned = Correlate.align(fn, lastdata, newData, opts);\n *\n * // Result:\n * [\n *  { id:`1`, x:101, y:200 }\n * ]\n * ```\n * @param similarityFn\n * @param lastData\n * @param newData\n * @param opts\n * @returns\n */\n//eslint-disable-next-line functional/immutable-data\nexport const align = <V>(\n  similarityFn: Similarity<V>,\n  lastData: readonly DataWithId<V>[] | undefined,\n  newData: readonly DataWithId<V>[],\n  opts: AlignOpts = {}\n): readonly DataWithId<V>[] => {\n  const matchThreshold = opts.matchThreshold ?? 0;\n  const debug = opts.debug ?? false;\n  const results = new Map();\n  const newThings: DataWithId<V>[] = [];\n\n  const lastMap = new Map();\n  lastData?.forEach((d, index) => {\n    if (d === undefined) {\n      throw new Error(`'lastData' contains undefined (index: ${index})`);\n    }\n    lastMap.set(d.id, d);\n  });\n\n  //eslint-disable-next-line functional/no-let\n  for (let i = 0; i < newData.length; i++) {\n    const newD = newData[i];\n\n    if (!lastData || lastData.length === 0) {\n      // No last data to compare to\n      if (debug) console.debug(`Correlate.align() new id: ${newD.id}`);\n\n      //eslint-disable-next-line functional/immutable-data\n      newThings.push(newD);\n      continue;\n    }\n\n    // Which of the old data does the new data match up to best?\n    const scoredLastValues = Array.from(lastMap.values()).map((last) => ({\n      id: last.id,\n      score: last === null ? -1 : similarityFn(last, newD),\n      last,\n    }));\n\n    if (scoredLastValues.length === 0) {\n      if (debug) {\n        console.debug(`Correlate.align() no valid last values id: ${newD.id}`);\n      }\n      //eslint-disable-next-line functional/immutable-data\n      newThings.push(newD);\n      continue;\n    }\n    //eslint-disable-next-line functional/immutable-data\n    scoredLastValues.sort(orderScore);\n\n    // Top-ranked match is pretty low, must be something new\n    const top = scoredLastValues[0];\n    if (top.score < matchThreshold) {\n      if (debug) {\n        console.debug(\n          `Correlate.align() new item does not reach threshold. Top score: ${top.score} id: ${newD.id}`\n        );\n      }\n      //eslint-disable-next-line functional/immutable-data\n      newThings.push(newD);\n      continue;\n    }\n\n    // TODO: If there are close options to pick, need a pluggable\n    // function to determine which is the winner.\n\n    //    console.log(`updating prior ${top.score}. top: ${top.id} newD: ${newD.id}`);\n\n    // The new item is considered the same as top ranked\n    if (debug && top.id !== newD.id) {\n      console.log(\n        `Correlate.align() Remapped ${newD.id} -> ${top.id} (score: ${top.score})`\n      );\n    }\n    //eslint-disable-next-line functional/immutable-data\n    results.set(top.id, { ...newD, id: top.id });\n\n    // Remove that old one from the list\n    //eslint-disable-next-line functional/immutable-data\n    lastMap.delete(top.id);\n  }\n\n  //eslint-disable-next-line functional/immutable-data\n  newThings.forEach((t) => results.set(t.id, t));\n  return Array.from(results.values());\n};\n\n/**\n * Returns a function that attempts to align a series of data by its id.\n * See also {@link align} for a version with no internal storage.\n *\n * ```js\n * // Compare data based on x,y distance\n * const fn = (a, b) => {\n *  return 1-Points.distance(a, b);\n * }\n * const aligner = Correlate.alignById(fn, opts);\n *\n * const lastData = [\n *  { id:`1`, x:100, y:200 }\n *  ...\n * ]\n * const aligned = aligner(lastData);\n *\n * ```\n * @param fn\n * @param opts\n * @returns\n */\nexport const alignById = <V>(fn: Similarity<V>, opts: AlignOpts = {}) => {\n  //eslint-disable-next-line functional/no-let\n  let lastData: readonly DataWithId<V>[] = [];\n\n  //eslint-disable-next-line functional/prefer-immutable-types\n  const compute = (newData: DataWithId<V>[]) => {\n    lastData = align(fn, lastData, newData, opts);\n    return [...lastData];\n  };\n  return compute;\n};\n","import { SimpleEventEmitter } from '../Events.js';\nimport * as Debug from '../debug/index.js';\n/**\n * Policy for when the pool is fully used\n */\nexport type FullPolicy = `error` | `evictOldestUser`;\n\n/**\n * Pool options\n */\nexport type Opts<V> = {\n  /**\n   * Maximum number of resources for this pool\n   */\n  readonly capacity?: number;\n  /**\n   * If above 0, users will be removed if there is no activity after this interval.\n   * Activity is marked whenever `use` us called with that user key.\n   * Default: disabled\n   */\n  readonly userExpireAfterMs?: number;\n  /**\n   * If above 0, resources with no users will be automatically removed after this interval.\n   * Default: disabled\n   */\n  readonly resourcesWithoutUserExpireAfterMs?: number;\n  /**\n   * Maximum number of users per resource. Defaults to 1\n   */\n  readonly capacityPerResource?: number;\n  /**\n   * What to do if pool is full and a new resource allocation is requested.\n   * Default is `error`, throwing an error when pool is full.\n   */\n  readonly fullPolicy?: FullPolicy;\n  /**\n   * If true, additional logging will trace activity of pool.\n   * Default: false\n   */\n  readonly debug?: boolean;\n  /**\n   * If specified, this function will generate new resources as needed.\n   */\n  readonly generate?: () => V;\n  /**\n   * If specified, this function will be called when a resource is disposed\n   */\n  readonly free?: (v: V) => void;\n};\n\n/**\n * Function that initialises a pool item\n */\n//export type InitPoolItem_ = <V>(id:string)=>V;\n\n/**\n * State of pool\n */\nexport type PoolState = `idle` | `active` | `disposed`;\n\nexport type PoolUserEventMap<V> = {\n  readonly disposed: { readonly data: V; readonly reason: string };\n  readonly released: { readonly data: V; readonly reason: string };\n};\n\n/**\n * A use of a pool resource\n *\n * Has two events, _disposed_ and _released_.\n */\nexport class PoolUser<V> extends SimpleEventEmitter<PoolUserEventMap<V>> {\n  private _lastUpdate: number;\n  private _pool: Pool<V>;\n  private _state: PoolState;\n  private _userExpireAfterMs: number;\n\n  /**\n   * Constructor\n   * @param key User key\n   * @param resource Resource being used\n   */\n  //eslint-disable-next-line functional/prefer-immutable-types\n  constructor(readonly key: string, readonly resource: Resource<V>) {\n    super();\n    this._lastUpdate = performance.now();\n    this._pool = resource.pool;\n    this._userExpireAfterMs = this._pool.userExpireAfterMs;\n    this._state = `idle`;\n    this._pool.log.log(`PoolUser ctor key: ${ this.key }`);\n  }\n\n  /**\n   * Returns a human readable debug string\n   * @returns\n   */\n  toString() {\n    if (this.isDisposed) return `PoolUser. State: disposed`;\n\n    return `PoolUser. State: ${ this._state } Elapsed: ${ performance.now() - this._lastUpdate } Data: ${ JSON.stringify(this.resource.data) }`;\n  }\n\n  /**\n   * Resets countdown for instance expiry.\n   * Throws an error if instance is disposed.\n   */\n  keepAlive() {\n    if (this._state === `disposed`) throw new Error(`PoolItem disposed`);\n    this._lastUpdate = performance.now();\n  }\n\n  /**\n   * @internal\n   * @param reason\n   * @returns\n   */\n  _dispose(reason: string) {\n    if (this._state === `disposed`) return;\n    const resource = this.resource;\n    const data = resource.data;\n    this._state = `disposed`;\n    resource._release(this);\n    this._pool.log.log(`PoolUser dispose key: ${ this.key } reason: ${ reason }`);\n    this.fireEvent(`disposed`, { data, reason });\n    super.clearEventListeners();\n  }\n\n  /**\n   * Release this instance\n   * @param reason\n   */\n  release(reason: string) {\n    if (this.isDisposed) throw new Error(`User disposed`);\n    const resource = this.resource;\n    const data = resource.data;\n    this._pool.log.log(`PoolUser release key: ${ this.key } reason: ${ reason }`);\n    this.fireEvent(`released`, { data, reason });\n    this._dispose(`release-${ reason }`);\n  }\n\n  // #region Properties\n  get data(): V {\n    if (this.isDisposed) throw new Error(`User disposed`);\n    return this.resource.data;\n  }\n\n  /**\n   * Returns true if this instance has expired.\n   * Expiry counts if elapsed time is greater than `userExpireAfterMs`\n   */\n  get isExpired() {\n    if (this._userExpireAfterMs > 0) {\n      return performance.now() > this._lastUpdate + this._userExpireAfterMs;\n    }\n    return false;\n  }\n\n  /**\n   * Returns elapsed time since last 'update'\n   */\n  get elapsed() {\n    return performance.now() - this._lastUpdate;\n  }\n\n  /**\n   * Returns true if instance is disposed\n   */\n  get isDisposed() {\n    return this._state === `disposed`;\n  }\n\n  /**\n   * Returns true if instance is neither disposed nor expired\n   */\n  get isValid() {\n    if (this.isDisposed || this.isExpired) return false;\n    if (this.resource.isDisposed) return false;\n    return true;\n  }\n  // #endregion\n}\n\n/**\n * A resource allocated in the Pool\n */\nexport class Resource<V> {\n  #state: PoolState;\n  #data: V;\n  #users: Array<PoolUser<V>>;\n  readonly #capacityPerResource;\n  readonly #resourcesWithoutUserExpireAfterMs;\n  #lastUsersChange: number;\n\n  /**\n   * Constructor.\n   * @param pool Pool\n   * @param data Data\n   */\n  constructor(readonly pool: Pool<V>, data: V) {\n    if (data === undefined) throw new Error(`Parameter 'data' is undefined`);\n    if (pool === undefined) throw new Error(`Parameter 'pool' is undefined`);\n\n    this.#data = data;\n    this.#lastUsersChange = 0;\n    this.#resourcesWithoutUserExpireAfterMs =\n      pool.resourcesWithoutUserExpireAfterMs;\n    this.#capacityPerResource = pool.capacityPerResource;\n    this.#users = [];\n    this.#state = `idle`;\n  }\n\n  /**\n   * Gets data associated with resource.\n   * Throws an error if disposed\n   */\n  get data() {\n    if (this.#state === `disposed`) throw new Error(`Resource disposed`);\n    return this.#data;\n  }\n\n  /**\n   * Changes the data associated with this resource.\n   * Throws an error if disposed or `data` is undefined.\n   * @param data\n   */\n  updateData(data: V) {\n    if (this.#state === `disposed`) throw new Error(`Resource disposed`);\n    if (data === undefined) throw new Error(`Parameter 'data' is undefined`);\n    this.#data = data;\n  }\n\n  /**\n   * Returns a human-readable debug string for resource\n   * @returns\n   */\n  toString() {\n    return `Resource (expired: ${ this.isExpiredFromUsers } users: ${ this.#users.length }, state: ${ this.#state }) data: ${ JSON.stringify(this.data) }`;\n  }\n\n  /**\n   * Assigns a user to this resource.\n   * @internal\n   * @param user\n   */\n  _assign(user: PoolUser<V>) {\n    const existing = this.#users.find((u) => u === user || u.key === user.key);\n    if (existing) throw new Error(`User instance already assigned to resource`);\n    this.#users.push(user);\n    this.#lastUsersChange = performance.now();\n  }\n\n  /**\n   * Releases a user from this resource\n   * @internal\n   * @param user\n   */\n  _release(user: PoolUser<V>) {\n    this.#users = this.#users.filter((u) => u !== user);\n    this.pool._release(user);\n    this.#lastUsersChange = performance.now();\n  }\n\n  /**\n   * Returns true if resource can have additional users allocated\n   */\n  get hasUserCapacity() {\n    return this.usersCount < this.#capacityPerResource;\n  }\n\n  /**\n   * Returns number of uses of the resource\n   */\n  get usersCount() {\n    return this.#users.length;\n  }\n\n  /**\n   * Returns true if automatic expiry is enabled, and that interval\n   * has elapsed since the users list has changed for this resource\n   */\n  get isExpiredFromUsers() {\n    if (this.#resourcesWithoutUserExpireAfterMs <= 0) return false;\n    if (this.#users.length > 0) return false;\n    return (\n      performance.now() >\n      this.#resourcesWithoutUserExpireAfterMs + this.#lastUsersChange\n    );\n  }\n\n  /**\n   * Returns true if instance is disposed\n   */\n  get isDisposed() {\n    return this.#state === `disposed`;\n  }\n\n  /**\n   * Disposes the resource.\n   * If it is already disposed, it does nothing.\n   * @param reason\n   * @returns\n   */\n  dispose(reason: string) {\n    if (this.#state === `disposed`) return;\n    const data = this.#data;\n    this.#state = `disposed`;\n    this.pool.log.log(`Resource disposed (${ reason })`);\n    for (const u of this.#users) {\n      u._dispose(`resource-${ reason }`);\n    }\n    this.#users = [];\n    this.#lastUsersChange = performance.now();\n    this.pool._releaseResource(this, reason);\n\n    if (this.pool.freeResource) this.pool.freeResource(data);\n  }\n}\n\n/**\n * Resource pool\n */\nexport class Pool<V> {\n  private _resources: Array<Resource<V>>;\n  private _users: Map<string, PoolUser<V>>;\n\n  readonly capacity: number;\n  readonly userExpireAfterMs: number;\n  readonly resourcesWithoutUserExpireAfterMs: number;\n\n  readonly capacityPerResource: number;\n  readonly fullPolicy: FullPolicy;\n  private generateResource?: () => V;\n  readonly freeResource?: (v: V) => void;\n\n  readonly log: Debug.LogSet;\n\n  /**\n   * Constructor.\n   *\n   * By default, no capacity limit, one user per resource\n   * @param opts Pool options\n   */\n  constructor(opts: Opts<V> = {}) {\n    this.capacity = opts.capacity ?? -1;\n    this.fullPolicy = opts.fullPolicy ?? `error`;\n    this.capacityPerResource = opts.capacityPerResource ?? 1;\n    this.userExpireAfterMs = opts.userExpireAfterMs ?? -1;\n    this.resourcesWithoutUserExpireAfterMs =\n      opts.resourcesWithoutUserExpireAfterMs ?? -1;\n\n    this.generateResource = opts.generate;\n    this.freeResource = opts.free;\n\n    this._users = new Map();\n    this._resources = [];\n\n    this.log = Debug.logSet(`Pool`, opts.debug ?? false);\n\n    // If we have a time-based expiry, set an interval to\n    // automatically do the housekeeping\n    const timer = Math.max(\n      this.userExpireAfterMs,\n      this.resourcesWithoutUserExpireAfterMs\n    );\n    if (timer > 0) {\n      setInterval(() => {\n        this.maintain();\n      }, timer * 1.1);\n    }\n  }\n\n  /**\n   * Returns a debug string of Pool state\n   * @returns\n   */\n  dumpToString() {\n    //eslint-disable-next-line functional/no-let\n    let r = `Pool\n    capacity: ${ this.capacity } userExpireAfterMs: ${ this.userExpireAfterMs } capacityPerResource: ${ this.capacityPerResource }\n    resources count: ${ this._resources.length }`;\n\n    const resource = this._resources.map((r) => r.toString()).join(`\\r\\n\\t`);\n    r += `\\r\\nResources:\\r\\n\\t` + resource;\n\n    r += `\\r\\nUsers: \\r\\n`;\n    for (const [ k, v ] of this._users.entries()) {\n      r += `\\tk: ${ k } v: ${ v.toString() }\\r\\n`;\n    }\n    return r;\n  }\n\n  /**\n   * Sorts users by longest elapsed time since update\n   * @returns\n   */\n  getUsersByLongestElapsed() {\n    return [ ...this._users.values() ].sort((a, b) => {\n      const aa = a.elapsed;\n      const bb = b.elapsed;\n      if (aa === bb) return 0;\n      if (aa < bb) return 1;\n      return -1;\n    });\n  }\n\n  /**\n   * Returns resources sorted with least used first\n   * @returns\n   */\n  getResourcesSortedByUse() {\n    return [ ...this._resources ].sort((a, b) => {\n      if (a.usersCount === b.usersCount) return 0;\n      if (a.usersCount < b.usersCount) return -1;\n      return 1;\n    });\n  }\n\n  /**\n   * Adds a resource to the pool.\n   * Throws an error if the capacity limit is reached.\n   * @param resource\n   * @returns\n   */\n  addResource(resource: V) {\n    if (resource === undefined) {\n      throw new Error(`Cannot add undefined resource`);\n    }\n    if (resource === null) throw new Error(`Cannot add null resource`);\n\n    if (this.capacity > 0 && this._resources.length === this.capacity) {\n      throw new Error(\n        `Capacity limit (${ this.capacity }) reached. Cannot add more.`\n      );\n    }\n\n    this.log.log(`Adding resource: ${ JSON.stringify(resource) }`);\n    const pi = new Resource<V>(this, resource);\n    this._resources.push(pi);\n    return pi;\n  }\n\n  /**\n   * Performs maintenance, removing disposed/expired resources & users.\n   * This is called automatically when using a resource.\n   */\n  maintain() {\n    //eslint-disable-next-line functional/no-let\n    let changed = false;\n\n    // Find all disposed resources\n    const nuke: Array<Resource<V>> = [];\n    for (const p of this._resources) {\n      if (p.isDisposed) {\n        this.log.log(`Maintain, disposed resource: ${ JSON.stringify(p.data) }`);\n        nuke.push(p);\n      } else if (p.isExpiredFromUsers) {\n        this.log.log(`Maintain, expired resource: ${ JSON.stringify(p.data) }`);\n        nuke.push(p);\n      }\n    }\n\n    // Remove them\n    if (nuke.length > 0) {\n      for (const resource of nuke) {\n        resource.dispose(`diposed/expired`);\n      }\n      changed = true;\n    }\n\n    // Find 'users' to clean up\n    const userKeysToRemove: Array<string> = [];\n    for (const [ key, user ] of this._users.entries()) {\n      if (!user.isValid) {\n        this.log.log(\n          `Maintain. Invalid user: ${ user.key } (Disposed: ${ user.isDisposed } Expired: ${ user.isExpired } Resource disposed: ${ user.resource.isDisposed })`\n        );\n\n        userKeysToRemove.push(key);\n        user._dispose(`invalid`);\n      }\n    }\n\n    for (const userKey of userKeysToRemove) {\n      this._users.delete(userKey);\n      changed = true;\n    }\n\n    if (changed) {\n      this.log.log(\n        `End: resource len: ${ this._resources.length } users: ${ this.usersLength }`\n      );\n    }\n  }\n\n  /**\n   * Iterate over resources in the pool.\n   * To iterate over the data associated with each resource, use\n   * `values`.\n   */\n  *resources() {\n    const resource = [ ...this._resources ];\n    for (const r of resource) {\n      yield r;\n    }\n  }\n\n  /**\n   * Iterate over resource values in the pool.\n   * to iterate over the resources, use `resources`.\n   *\n   * Note that values may be returned even though there is no\n   * active user.\n   */\n  *values() {\n    const resource = [ ...this._resources ];\n    for (const r of resource) {\n      yield r.data;\n    }\n  }\n\n  /**\n   * Unassociate a key with a pool item\n   * @param userKey\n   */\n  release(userKey: string, reason?: string): void {\n    const pi = this._users.get(userKey);\n    if (!pi) return;\n    pi.release(reason ?? `Pool.release`);\n  }\n\n  /**\n   * @internal\n   * @param user\n   */\n  //eslint-disable-next-line functional/prefer-immutable-types\n  _release(user: PoolUser<V>) {\n    this._users.delete(user.key);\n  }\n\n  /**\n   * @internal\n   * @param resource\n   * @param _\n   */\n  //eslint-disable-next-line functional/prefer-immutable-types\n  _releaseResource(resource: Resource<V>, _: string) {\n    this._resources = this._resources.filter((v) => v !== resource);\n  }\n\n  /**\n   * Returns true if `v` has an associted resource in the pool\n   * @param resource\n   * @returns\n   */\n  hasResource(resource: V): boolean {\n    const found = this._resources.find((v) => v.data === resource);\n    return found !== undefined;\n  }\n\n  /**\n   * Returns true if a given `userKey` is in use.\n   * @param userKey\n   * @returns\n   */\n  hasUser(userKey: string): boolean {\n    return this._users.has(userKey);\n  }\n\n  /**\n   * @internal\n   * @param key\n   * @param resource\n   * @returns\n   */\n  //eslint-disable-next-line functional/prefer-immutable-types\n  private _assign(key: string, resource: Resource<V>) {\n    const u = new PoolUser<V>(key, resource);\n    this._users.set(key, u);\n    resource._assign(u);\n    return u;\n  }\n\n  /**\n   * @internal\n   * @param userKey\n   * @returns\n   */\n  private _findUser(userKey: string): PoolUser<V> | undefined {\n    // Sort items by number of users per pool item\n    const sorted = this.getResourcesSortedByUse();\n    //eslint-disable-next-line functional/no-let\n    // for (let i=0;i<sorted.length;i++) {\n    //   console.log(i +`. users: ` + sorted[i].usersCount);\n    // }\n    if (sorted.length > 0 && sorted[ 0 ].hasUserCapacity) {\n      // No problem, resource has capacity\n      //this.log.log(`resource has capacity: ${ sorted[ 0 ].data }`);\n      const u = this._assign(userKey, sorted[ 0 ]);\n      return u;\n    }\n\n    // If resource count is below capacity, can we generate more?\n    if (\n      this.generateResource &&\n      (this.capacity < 0 || this._resources.length < this.capacity)\n    ) {\n      this.log.log(\n        `capacity: ${ this.capacity } resources: ${ this._resources.length }`\n      );\n      const resourceGenerated = this.addResource(this.generateResource());\n      const u = this._assign(userKey, resourceGenerated);\n      return u;\n    }\n  }\n\n  /**\n   * Return the number of users\n   */\n  get usersLength() {\n    return [ ...this._users.values() ].length;\n  }\n\n  /**\n   * 'Uses' a resource, returning the value\n   * @param userKey\n   * @returns\n   */\n  useValue(userKey: string): V {\n    const resource = this.use(userKey);\n    return resource.resource.data;\n  }\n\n  /**\n   * Gets a pool item based on a user key.\n   * The same key should return the same pool item,\n   * for as long as it still exists.\n   * @param userKey\n   * @returns\n   */\n  use(userKey: string): PoolUser<V> {\n    const pi = this._users.get(userKey);\n    if (pi) {\n      pi.keepAlive();\n      return pi;\n    }\n\n    this.maintain();\n\n    const match = this._findUser(userKey);\n    if (match) return match;\n\n    // Throw an error if all items are being used\n    if (this.fullPolicy === `error`) {\n      console.log(this.dumpToString());\n      throw new Error(\n        `Pool is fully used (fullPolicy: ${ this.fullPolicy }, capacity: ${ this.capacity })`\n      );\n    }\n    // Evict oldest user\n    if (this.fullPolicy === `evictOldestUser`) {\n      const users = this.getUsersByLongestElapsed();\n      if (users.length > 0) {\n        this.release(users[ 0 ].key, `evictedOldestUser`);\n\n        const match2 = this._findUser(userKey);\n        if (match2) return match2;\n      }\n    }\n\n    // Evict newest user\n\n    // Evict from random pool item\n    throw new Error(`Pool is fully used (${ this.fullPolicy })`);\n  }\n}\n\n/**\n * Creates an instance of a Pool\n * @param opts\n * @returns\n */\nexport const create = <V>(opts: Opts<V> = {}): Pool<V> => new Pool<V>(opts);\n","import { Points, Paths, Rects } from './index.js';\n\nexport type CompoundPath = Paths.Path & {\n  readonly segments:readonly Paths.Path[]\n  readonly kind:`compound`\n};\n\n/**\n * Returns a new compoundpath, replacing a path at a given index\n *\n * @param {CompoundPath} compoundPath Existing compoundpath\n * @param {number} index Index to replace at\n * @param {Paths.Path} path Path to substitute in\n * @returns {CompoundPath} New compoundpath\n */\nexport const setSegment = (compoundPath:CompoundPath, index:number, path:Paths.Path):CompoundPath => {\n  const existing = [...compoundPath.segments];\n  //eslint-disable-next-line functional/prefer-readonly-type,functional/immutable-data\n  existing[index] = path;\n  return fromPaths(...existing);\n};\n\n/**\n * Computes x,y point at a relative position along compoundpath\n *\n * @param {Paths.Path[]} paths Combined paths (assumes contiguous)\n * @param {number} t Position (given as a percentage from 0 to 1)\n * @param {boolean} [useWidth] If true, widths are used for calulcating. If false, lengths are used\n * @param {Dimensions} [dimensions] Precalculated dimensions of paths, will be computed if omitted\n * @returns\n */\nexport const interpolate = (paths:readonly Paths.Path[], t:number, useWidth?:boolean, dimensions?:Dimensions) => {\n  if (dimensions === undefined) {\n    dimensions = computeDimensions(paths);\n  }\n\n  // Expected value to land on\n  const expected = t * (useWidth ? dimensions.totalWidth : dimensions.totalLength);\n  //eslint-disable-next-line functional/no-let\n  let soFar = 0;\n\n  // Use widths or lengths?\n  const l = useWidth ? dimensions.widths : dimensions.lengths;\n  //eslint-disable-next-line functional/no-let\n  for (let i = 0; i < l.length; i++) {\n    if (soFar + l[i] >= expected) {\n      const relative = expected - soFar;\n      //eslint-disable-next-line functional/no-let\n      let amt = relative / l[i];\n      //eslint-disable-next-line functional/no-let\n      if (amt > 1) amt = 1;\n      return paths[i].interpolate(amt);\n    } else soFar += l[i];\n  }\n  return { x: 0, y: 0 };\n};\n\nexport type Dimensions = {\n  /**\n   * Width of each path (based on bounding box)\n   *\n   * @type {number[]}\n   */\n  readonly widths:readonly number[],\n  /**\n   * Length of each path\n   *\n   * @type {number[]}\n   */\n  readonly lengths:readonly number[],\n\n  /**\n   * Total length of all paths\n   *\n   * @type {number}\n   */\n  readonly totalLength:number,\n  /**\n   * Total width of all paths\n   *\n   * @type {number}\n   */\n  readonly totalWidth:number\n}\n/**\n * Computes the widths and lengths of all paths, adding them up as well\n *\n * @param {Paths.Path[]} paths\n * @returns {Dimensions}\n */\nexport const computeDimensions = (paths:readonly Paths.Path[]):Dimensions => {\n  const widths = paths.map(l => l.bbox().width);\n  const lengths = paths.map(l => l.length());\n  //eslint-disable-next-line functional/no-let\n  let totalLength = 0;\n  //eslint-disable-next-line functional/no-let\n  let totalWidth = 0;\n  //eslint-disable-next-line functional/no-let\n  for (let i = 0; i < lengths.length; i++) totalLength += lengths[i];\n  //eslint-disable-next-line functional/no-let\n  for (let i = 0; i < widths.length; i++) totalWidth += widths[i];\n\n  return { totalLength, totalWidth, widths, lengths };\n};\n\n/**\n * Computes the bounding box that encloses entire compoundpath\n *\n * @param {Paths.Path[]} paths\n * \n * @returns {Rects.Rect}\n */\nexport const bbox = (paths:readonly Paths.Path[]):Rects.RectPositioned => {\n  const boxes = paths.map(p => p.bbox());\n  const corners = boxes.map(b => Rects.corners(b)).flat();\n\n  return Points.bbox(...corners);\n};\n\n/**\n * Produce a human-friendly representation of paths\n *\n * @param {Paths.Path[]} paths\n * @returns {string}\n */\nexport const toString = (paths:readonly Paths.Path[]):string => paths.map(p => p.toString()).join(`, `);\n\n/**\n * Throws an error if paths are not connected together, in order\n *\n * @param {Paths.Path[]} paths\n */\nexport const guardContinuous = (paths:readonly Paths.Path[]) => {\n  //eslint-disable-next-line functional/no-let\n  let lastPos = Paths.getEnd(paths[0]);\n  //eslint-disable-next-line functional/no-let\n  for (let i = 1; i < paths.length; i++) {\n    const start = Paths.getStart(paths[i]);\n    if (!Points.isEqual(start, lastPos)) throw new Error(`Path index ` + i + ` does not start at prior path end. Start: ` + start.x + `,` + start.y + ` expected: ` + lastPos.x + `,` + lastPos.y + ``);\n    lastPos = Paths.getEnd(paths[i]);\n  }\n};\n\nexport const toSvgString = (paths:readonly Paths.Path[]):readonly string[] => paths.flatMap(p => p.toSvgString());\n\n/**\n * Create a compoundpath from an array of paths.\n * All this does is verify they are connected, and precomputes dimensions\n *\n * @param {...Paths.Path[]} paths\n * @returns {CompoundPath}\n */\nexport const fromPaths = (...paths:readonly Paths.Path[]):CompoundPath => {\n  guardContinuous(paths); // Throws an error if paths are not connected\n  const dims = computeDimensions(paths);\n\n  return Object.freeze({\n    segments: paths,\n    length: () => dims.totalLength,\n    nearest:(_:Points.Point) => { throw new Error(`not implemented`); },\n    interpolate: (t:number, useWidth = false) => interpolate(paths, t, useWidth, dims),\n    bbox: () => bbox(paths),\n    toString: () => toString(paths),\n    toSvgString: () => toSvgString(paths),\n    kind: `compound`\n  });\n};\n","import { Polar } from './index.js';\nimport * as Lines from './Line.js';\nimport * as Points from './Point.js';\n\n//eslint-disable-next-line @typescript-eslint/naming-convention\nconst EmptyCartesian = Object.freeze({ x: 0, y: 0 });\n\nconst piPi = Math.PI * 2;\nconst pi = Math.PI;\n\n// const Q1 = Math.PI / 2;\n// const Q2 = Math.PI;\n// const Q3 = Q1 + Q2;\n// const Q4 = Math.PI * 2;\n\nexport type Vector = Points.Point | Polar.Coord;\n\nexport const fromRadians = (radians: number) => {\n  return Object.freeze({\n    x: Math.cos(radians),\n    y: Math.sin(radians)\n  });\n}\n\nexport const toRadians = (point: Points.Point) => {\n  return Math.atan2(point.y, point.x);\n}\n/**\n * Create a vector from a point\n *\n * If `unipolar` normalisation is used, direction will be fixed to 0..2π\n * if `bipolar` normalisation is used, direction will be fixed to -π...π\n * @param pt Point\n * @param angleNormalisation Technique to normalise angle\n * @param origin Origin to calculate vector from or 0,0 if left empty\n * @returns\n */\nexport const fromPointPolar = (\n  pt: Points.Point,\n  angleNormalisation: `` | `unipolar` | `bipolar` = ``,\n  origin: Points.Point = EmptyCartesian\n): Polar.Coord => {\n  pt = Points.subtract(pt, origin);\n\n  //eslint-disable-next-line functional/no-let\n  let dir = Math.atan2(pt.y, pt.x);\n  if (angleNormalisation === `unipolar` && dir < 0) dir += piPi;\n  else if (angleNormalisation === `bipolar`) {\n    if (dir > pi) dir -= piPi;\n    else if (dir <= -pi) dir += piPi;\n  }\n\n  return Object.freeze({\n    distance: Points.distance(pt),\n    angleRadian: dir,\n  });\n};\n\n/**\n * Returns a Cartesian-coordiante vector from a line a -> b\n * @param line\n * @returns\n */\nexport const fromLineCartesian = (line: Lines.Line): Points.Point =>\n  Points.subtract(line.b, line.a);\n\n/**\n * Returns a polar-coordinate vector from a line a -> b\n * @param line\n * @returns\n */\nexport const fromLinePolar = (line: Lines.Line): Polar.Coord => {\n  Lines.guard(line, `line`);\n  const pt = Points.subtract(line.b, line.a);\n  return fromPointPolar(pt);\n};\n\nconst isPolar = (v: Vector): v is Polar.Coord => {\n  if (Polar.isCoord(v)) return true;\n  return false;\n};\n\nconst isCartesian = (v: Vector): v is Points.Point => {\n  if (Points.isPoint(v)) return true;\n  return false;\n};\n\n/**\n * Returns the normalised vector (aka unit vector). This is where\n * direction is kept, but magnitude set to 1. This then just\n * suggests direction.\n * @param v\n * @returns\n */\nexport const normalise = (v: Vector): Vector => {\n  if (isPolar(v)) {\n    return Polar.normalise(v);\n  } else if (isCartesian(v)) {\n    return Points.normalise(v);\n  }\n  throw new Error(`Expected polar/cartesian vector. Got: ${ v }`);\n};\n\nexport const quadrantOffsetAngle = (p: Points.Point): number => {\n  if (p.x >= 0 && p.y >= 0) return 0; // Q1\n  if (p.x < 0 && p.y >= 0) return pi; // Q2\n  if (p.x < 0 && p.y < 0) return pi; // Q3\n  return piPi; // Q4\n};\n\n/**\n * Converts a vector to a polar coordinate. If the provided\n * value is already Polar, it is returned.\n * @param v\n * @param origin\n * @returns Polar vector\n */\nexport const toPolar = (v: Vector, origin = Points.Empty): Polar.Coord => {\n  if (isPolar(v)) {\n    return v;\n  } else if (isCartesian(v)) {\n    return Polar.fromCartesian(v, origin);\n  }\n  throw new Error(`Expected polar/cartesian vector. Got: ${ v }`);\n};\n\n/**\n * Converts a Vector to a Cartesian coordinate. If the provided\n * value is already Cartesian, it is returned.\n * @param v\n * @returns Cartestian vector\n */\nexport const toCartesian = (v: Vector): Points.Point => {\n  if (isPolar(v)) {\n    return Polar.toPoint(v);\n  } else if (isCartesian(v)) {\n    return v;\n  }\n  throw new Error(`Expected polar/cartesian vector. Got: ${ v }`);\n};\n\n/**\n * Return a human-friendly representation of vector\n * @param v\n * @param digits\n * @returns\n */\nexport const toString = (v: Vector, digits?: number) => {\n  if (isPolar(v)) {\n    return Polar.toString(v, digits);\n  } else if (isCartesian(v)) {\n    return Points.toString(v, digits);\n  }\n  throw new Error(`Expected polar/cartesian vector. Got: ${ v }`);\n};\n\n/**\n * Calculate dot product of a vector\n * @param a\n * @param b\n * @returns\n */\nexport const dotProduct = (a: Vector, b: Vector) => {\n  if (isPolar(a) && isPolar(b)) {\n    return Polar.dotProduct(a, b);\n  } else if (isCartesian(a) && isCartesian(b)) {\n    return Points.dotProduct(a, b);\n  }\n  throw new Error(`Expected two polar/Cartesian vectors.`);\n};\n\n/**\n * Clamps the magnitude of a vector\n * @param v Vector to clamp\n * @param max Maximum magnitude\n * @param min Minium magnitude\n * @returns\n */\nexport const clampMagnitude = (v: Vector, max = 1, min = 0) => {\n  if (isPolar(v)) {\n    return Polar.clampMagnitude(v, max, min);\n  } else if (isCartesian(v)) {\n    return Points.clampMagnitude(v, max, min);\n  }\n  throw new Error(`Expected either polar or Cartesian vector`);\n};\n\n/**\n * Returns `a + b`.\n *\n * Vector is returned in the same type as `a`.\n * @param a\n * @param b\n * @returns\n */\nexport const sum = (a: Vector, b: Vector) => {\n  const polar = isPolar(a);\n  a = toCartesian(a);\n  b = toCartesian(b);\n  const c = Points.sum(a, b);\n  return polar ? toPolar(c) : c;\n};\n\n/**\n * Returns `a - b`.\n *\n * Vector is returned in the same type as `a`\n * @param a\n * @param b\n */\nexport const subtract = (a: Vector, b: Vector) => {\n  const polar = isPolar(a);\n  a = toCartesian(a);\n  b = toCartesian(b);\n  const c = Points.subtract(a, b);\n  return polar ? toPolar(c) : c;\n};\n\n/**\n * Returns `a * b`.\n *\n * Vector is returned in the same type `a`.\n * @param a\n * @param b\n */\nexport const multiply = (a: Vector, b: Vector) => {\n  const polar = isPolar(a);\n  a = toCartesian(a);\n  b = toCartesian(b);\n  const c = Points.multiply(a, b);\n  return polar ? toPolar(c) : c;\n};\n\n/**\n * Returns `a / b`.\n *\n * Vector is returned in the same type `a`.\n * @param a\n * @param b\n */\nexport const divide = (a: Vector, b: Vector) => {\n  const polar = isPolar(a);\n  a = toCartesian(a);\n  b = toCartesian(b);\n  const c = Points.divide(a, b);\n  return polar ? toPolar(c) : c;\n};\n","import * as Lines from './Line.js';\nimport * as Points from './Point.js';\nimport { type CirclePositioned } from './Circle.js';\nimport { Arrays } from '../collections/index.js';\nimport { type Path } from './Path.js';\n\nexport type Waypoint = CirclePositioned;\n\nexport type Opts = {\n  readonly maxDistanceFromLine?: number;\n  readonly enforceOrder?: boolean;\n};\n\nexport const fromPoints = (\n  waypoints: readonly Points.Point[],\n  opts: Opts = {}\n) => {\n  const lines = Lines.joinPointsToLines(...waypoints);\n  return init(\n    lines.map((l) => Lines.toPath(l)),\n    opts\n  );\n};\n\nexport const init = (paths: readonly Path[], opts: Opts = {}) => {\n  //const enforceOrder = opts.enforceOrder ?? true;\n  const maxDistanceFromLine = opts.maxDistanceFromLine ?? 0.1;\n\n  const checkUnordered = (pt: Points.Point) => {\n    const results = paths.map((p, index) => {\n      const nearest = p.nearest(pt);\n      const distance = Points.distance(pt, nearest);\n      return { path: p, index, nearest, distance };\n    });\n\n    const filtered = results.filter((v) => v.distance <= maxDistanceFromLine);\n    const sorted = Arrays.sortByNumericProperty(filtered, `distance`);\n\n    return sorted;\n  };\n\n  // const checkUnordered = (p:Points.Point) => {\n  //   // Calculate progress of pointer between all the waypoint lines\n  //   const progresses = lines.map((line, index) => (\n  //     {\n  //       index,\n  //       score: Points.progressBetween(p, line.a, line.b)\n  //     }));\n\n  //   // Sort by closest\n  //   const sorted = Arrays.sortByNumericProperty(progresses, `score`);\n\n  // };\n  return checkUnordered;\n};\n","import * as Points from './Point.js';\n\nexport type Sphere = Points.Point3d & {\n  readonly radius: number;\n};\n","export * as CirclePacking from './CirclePacking.js';","import { sortByNumericProperty } from \"../collections/Arrays.js\";\nimport * as Circles from \"./Circle.js\";\nimport * as Shapes from \"./Shape.js\";\nimport * as Points from './Point.js';\nimport type { RandomSource } from \"../Random.js\";\n\nexport type RandomOpts = {\n  readonly attempts?: number\n  readonly randomSource?: RandomSource\n}\n/**\n * Naive randomised circle packing.\n * [Algorithm by Taylor Hobbs](https://tylerxhobbs.com/essays/2016/a-randomized-approach-to-cicle-packing)\n */\nexport const random = (circles: ReadonlyArray<Circles.Circle>, container: Shapes.ShapePositioned, opts: RandomOpts = {}) => {\n  if (!Array.isArray(circles)) throw new Error(`Parameter 'circles' is not an array`);\n  const attempts = opts.attempts ?? 2000;\n\n  const sorted = sortByNumericProperty(circles, `radius`);\n  const positionedCircles: Array<Circles.CirclePositioned> = [];\n\n  const willHit = (b: Points.Point, radius: number) => positionedCircles.some(v => Circles.isIntersecting(v, b, radius));\n\n  while (sorted.length > 0) {\n    //eslint-disable-next-line functional/immutable-data\n    const circle = sorted.pop();\n    if (!circle) break;\n\n    const randomPointOpts = { ...opts, margin: { x: circle.radius, y: circle.radius } };\n\n    //eslint-disable-next-line functional/no-let\n    for (let index = 0; index < attempts; index++) {\n      const position = Shapes.randomPoint(container, randomPointOpts);\n      if (!willHit(position, circle.radius)) {\n        //eslint-disable-next-line functional/immutable-data\n        positionedCircles.push(Object.freeze({ ...circle, ...position }));\n        break;\n      }\n    }\n  }\n\n  return positionedCircles;\n};","import { type Point, isPoint } from './Point.js';\nimport { type Rect, isRect, placeholder as PlaceholderRect } from './Rect.js';\n\n/**\n * A scale function that takes an input value to scale.\n * Input can be in the form of `{ x, y }` or two number parameters.\n *\n * ```js\n * scale(10, 20);\n * scale({ x:10, y:20 });\n * ```\n *\n * Output range can be specified as a `{ width, height }` or two number parameters.\n * If omitted, the default range\n * is used.\n *\n * ```js\n * // Scale 10,20 with range w:800 h:600\n * scale(10, 20, 800, 600);\n * scale({x:10, y:20}, 800, 600);\n * scale({x:10, y:20}, {width: 800, height: 600});\n * ```\n */\nexport type ScaleFn = (\n  a: number | Point,\n  b?: number | Rect,\n  c?: number | Rect,\n  d?: number\n) => Point;\n\n/**\n * A scaler than can convert to a from an output range\n */\nexport type Scaler = {\n  /**\n   * Relative to absolute coordinates\n   */\n  readonly abs: ScaleFn;\n  /**\n   * Absolute to relative coordintes\n   */\n  readonly rel: ScaleFn;\n};\n\n/**\n * Returns a set of scaler functions, to convert to and from ranges.\n *\n * ```js\n * const scaler = Scaler.scaler(`both`, window.innerWidth, window.innerHeight);\n * // Assuming screen of 800x400...\n * scaler.abs(400,200);          // Yields { x:0.5, y:0.5 }\n * scaler.abs({ x:400, y:200 }); // Yields { x:0.5, y:0.5 }\n *\n * scaler.rel(0.5, 0.5);         // Yields: { x:400, y:200 }\n * scaler.rel({ x:0.5, y:0.5 }); // Yields: { x:400, y:200 }\n * ```\n *\n * If no default range is provided, it must be given each time the scale function is used.\n *\n * ```js\n * const scaler = Scaler.scaler(`both`);\n *\n * scaler.abs(400, 200, 800, 400);\n * scaler.abs(400, 200, { width: 800, height: 400 });\n * scaler.abs({ x:400, y: 200}, { width: 800, height: 400 });\n * scaler.abs({ x:400, y: 200}, 800, 400);\n * // All are the same, yielding { x:0.5, y:0.5 }\n *\n * scaler.abs(400, 200); // Throws an exception because there is no scale\n * ```\n * @param scaleBy Dimension to scale by\n * @param defaultRect Default range\n * @returns\n */\nexport const scaler = (\n  scaleBy: `both` | `min` | `max` | `width` | `height` = `both`,\n  defaultRect?: Rect\n): Scaler => {\n  const defaultBounds = defaultRect ?? PlaceholderRect;\n\n  //eslint-disable-next-line functional/no-let\n  let sw = 1;\n  //eslint-disable-next-line functional/no-let\n  let sh = 1;\n  //eslint-disable-next-line functional/no-let\n  let s = { x: 1, y: 1 };\n\n  const computeScale = () => {\n    switch (scaleBy) {\n      case `height`:\n        return { x: sh, y: sh };\n      case `width`:\n        return { x: sw, y: sw };\n      case `min`:\n        return { x: Math.min(sw, sh), y: Math.min(sw, sh) };\n      case `max`:\n        return { x: Math.max(sw, sh), y: Math.max(sw, sh) };\n      default:\n        return { x: sw, y: sh };\n    }\n  };\n\n  const normalise = (\n    a: number | Point,\n    b?: number | Rect,\n    c?: number | Rect,\n    d?: number\n  ): [x: number, y: number, w: number, h: number] => {\n    //eslint-disable-next-line functional/no-let\n    let inX = Number.NaN;\n    //eslint-disable-next-line functional/no-let\n    let inY = Number.NaN;\n    //eslint-disable-next-line functional/no-let\n    let outW = defaultBounds.width;\n    //eslint-disable-next-line functional/no-let\n    let outH = defaultBounds.height;\n\n    if (typeof a === `number`) {\n      inX = a;\n      if (typeof b === `number`) {\n        inY = b;\n        if (c === undefined) return [inX, inY, outW, outH];\n        if (isRect(c)) {\n          outW = c.width;\n          outH = c.height;\n        } else if (typeof c === `number`) {\n          outW = c;\n          if (typeof d === `number`) {\n            outH = d;\n          } else {\n            throw new Error(`Missing final height value`);\n          }\n        } else throw new Error(`Missing valid output range`);\n      } else if (isRect(b)) {\n        outW = b.width;\n        outH = b.height;\n      } else {\n        throw new Error(\n          `Expected input y or output Rect to follow first number parameter`\n        );\n      }\n    } else if (isPoint(a)) {\n      inX = a.x;\n      inY = a.y;\n      if (b === undefined) return [inX, inY, outW, outH];\n      if (isRect(b)) {\n        outW = b.width;\n        outH = b.height;\n      } else if (typeof b === `number`) {\n        outW = b;\n        if (typeof c === `number`) {\n          outH = c;\n        } else {\n          throw new Error(\n            `Expected height as third parameter after Point and output width`\n          );\n        }\n      } else {\n        throw new Error(\n          `Expected Rect or width as second parameter when first parameter is a Point`\n        );\n      }\n    } else {\n      throw new Error(`Expected input Point or x value as first parameter`);\n    }\n    return [inX, inY, outW, outH];\n  };\n\n  const scaleAbs = (\n    a: number | Point,\n    b?: number | Rect,\n    c?: number | Rect,\n    d?: number\n  ): Point => {\n    const n = normalise(a, b, c, d);\n    return scaleNormalised(true, ...n);\n  };\n\n  const scaleRel = (\n    a: number | Point,\n    b?: number | Rect,\n    c?: number | Rect,\n    d?: number\n  ): Point => {\n    const n = normalise(a, b, c, d);\n    return scaleNormalised(false, ...n);\n  };\n\n  const scaleNormalised = (\n    abs: boolean,\n    x: number,\n    y: number,\n    w: number,\n    h: number\n  ): Point => {\n    if (Number.isNaN(w)) throw new Error(`Output width range missing`);\n    if (Number.isNaN(h)) throw new Error(`Output height range missing`);\n\n    // If output dimensions has changed since last, create a new scale\n    if (w !== sw || h !== sh) {\n      sw = w;\n      sh = h;\n      s = computeScale();\n    }\n\n    if (abs) {\n      return {\n        x: x * s.x,\n        y: y * s.y,\n      };\n    } else {\n      return {\n        x: x / s.x,\n        y: y / s.y,\n      };\n    }\n  };\n\n  return {\n    rel: scaleRel,\n    abs: scaleAbs,\n  };\n};\n","import {type Rgb} from '../visual/Colour.js';\nimport {ImageDataGrid} from '../visual/index.js';\nimport * as Grids from './Grid.js';\n\nexport type Kernel = readonly (readonly number[])[];\nexport type CellWithValue<V> = readonly [cell: Grids.Cell, value: V | undefined];\nexport type ScalarAndValue<V> = readonly [scalar: number, v: V | undefined];\nexport type KernelCompute = <V>(offset: Grids.Cell, value: V) => V;\nexport type KernelReduce<V> = (values: readonly ScalarAndValue<V>[]) => V | undefined;\n\n/**\n * Multiply every element of kernel by the same `scalar` value.\n * Returns new result, input is unmodified\n * @param kernel \n * @param scalar \n * @returns \n */\nexport const multiply = (kernel: Kernel, scalar: number): Kernel => {\n  const rows = kernel.length;\n  const cols = kernel[0].length;\n  const copy: number[][] = [];\n  //eslint-disable-next-line functional/no-let\n  for (let row = 0; row < rows; row++) {\n    //eslint-disable-next-line functional/immutable-data\n    copy[row] = [];\n    //eslint-disable-next-line functional/no-let\n    for (let col = 0; col < cols; col++) {\n      //eslint-disable-next-line functional/immutable-data\n      copy[row][col] = kernel[row][col] * scalar;\n    }\n  }\n  return copy;\n};\n\n\nexport function convolveCell<V>(c: Grids.Cell, kernel: Kernel2dArray, source: Grids.Grid, access: Grids.CellAccessor<V>, reduce: KernelReduce<V>): V | undefined {\n  const valuesAtKernelPos: ScalarAndValue<V>[] = kernel.map(o => {\n    const pos = Grids.offset(source, c, o[0], `stop`); // `stop` avoids fringing at extents of image\n    if (!pos) return [o[1], undefined];\n    return [o[1], access(pos, `undefined`)];\n  });\n  return reduce(valuesAtKernelPos);\n}\n\n/**\n * Performs kernel-based convolution over `image`.\n * @param kernel \n * @param image \n */\nexport function* convolveImage(kernel: Kernel, image: ImageData) {\n  const grid = {rows: image.width, cols: image.height};\n  const imageDataAsGrid = ImageDataGrid.accessor(image);\n\n  yield* convolve(kernel, grid, imageDataAsGrid, Grids.cells(grid), rgbReducer);\n}\n\nexport function* convolve<V>(kernel: Kernel, source: Grids.Grid, access: Grids.CellAccessor<V>, visitor: Grids.VisitGenerator, reduce: KernelReduce<V>, origin?: Grids.Cell): IterableIterator<CellWithValue<V>> {\n\n  //const wrap:Grids.BoundsLogic = `undefined`;\n  // Use middle, eg 3x3 = 1,1\n  if (!origin) {\n    const kernelRows = kernel.length;\n    const kernelCols = kernel[0].length;\n    origin = {x: Math.floor(kernelRows / 2), y: Math.floor(kernelCols / 2)};\n  }\n\n  const asArray = kernel2dToArray(kernel, origin);\n  for (const c of visitor) {\n    const v = convolveCell<V>(c, asArray, source, access, reduce);\n    yield [c, v];\n  }\n}\n\nexport type Kernel2dArray = ReadonlyArray<readonly [cell: Grids.Cell, value: number]>;\n\n/**\n * For a given kernel, returns an array of offsets. These\n * consist of a cell offset (eg `{x:-1,y:-1}`) and the value at that kernel position.\n * @param kernel \n * @param origin \n * @returns \n */\nexport const kernel2dToArray = (kernel: Kernel, origin?: Grids.Cell): Kernel2dArray => {\n  const offsets: Kernel2dArray = [];\n  const rows = kernel.length;\n  const cols = kernel[0].length;\n  if (!origin) origin = {x: Math.floor(rows / 2), y: Math.floor(cols / 2)};\n\n  //eslint-disable-next-line functional/no-let\n  for (let xx = 0; xx < rows; xx++) {\n    //eslint-disable-next-line functional/no-let\n    for (let yy = 0; yy < cols; yy++) {\n      //eslint-disable-next-line functional/immutable-data\n      // @ts-ignore\n      offsets.push([{x: xx - origin.x, y: yy - origin.y}, kernel[xx][yy]]);\n    }\n  }\n  return offsets;\n};\n\nexport const rgbReducer: KernelReduce<Rgb> = (values: readonly ScalarAndValue<Rgb>[]) => {\n  //eslint-disable-next-line functional/no-let\n  let r = 0;\n  //eslint-disable-next-line functional/no-let\n  let g = 0;\n  //eslint-disable-next-line functional/no-let\n  let b = 0;\n  //eslint-disable-next-line functional/no-let\n  const opacity = 0;\n  //eslint-disable-next-line functional/no-let\n  for (let i = 0; i < values.length; i++) {\n    const rgb = values[i][1];\n    const scale = values[i][0];\n    if (rgb === undefined) continue;\n    if (rgb.opacity === 0) continue;\n    if (scale === 0) continue;\n    r += (rgb.r * scale);\n    g += (rgb.g * scale);\n    b += (rgb.b * scale);\n    //opacity += ((rgb.opacity ?? 1) * scale);\n  }\n\n  const result = {\n    r: r,\n    g: g,\n    b: b,\n    opacity: 255\n  };\n  return result;\n};\nexport const identityKernel = [\n  [0, 0, 0],\n  [0, 1, 0],\n  [0, 0, 0]\n];\n\n\nexport const edgeDetectionKernel = [\n  [0, -1, 0],\n  [-1, 4, -1],\n  [0, -1, 0]\n];\n\nexport const sharpenKernel = [\n  [0, -1, 0],\n  [-1, 5, -1],\n  [0, -1, 0]\n];\n\nexport const boxBlurKernel = multiply([\n  [1, 1, 1],\n  [1, 1, 1],\n  [1, 1, 1]\n], 1 / 9);\n\nexport const gaussianBlur3Kernel = multiply([\n  [1, 2, 1],\n  [2, 4, 2],\n  [1, 2, 1]\n], 1 / 16);\n\nexport const gaussianBlur5Kernel = multiply([\n  [1, 4, 6, 4, 1],\n  [4, 16, 24, 16, 4],\n  [6, 24, 36, 24, 6],\n  [4, 16, 24, 16, 4],\n  [1, 4, 6, 4, 1],\n], 1 / 256);\n\nexport const unsharpMasking5Kernel = multiply([\n  [1, 4, 6, 4, 1],\n  [4, 16, 24, 16, 4],\n  [6, 24, -476, 24, 6],\n  [4, 16, 24, 16, 4],\n  [1, 4, 6, 4, 1],\n], -1 / 256);","import { type Sphere } from './Sphere.js';\nimport * as Points from './Point.js';\nimport {\n  type Circle,\n  type CirclePositioned,\n  toPositioned as circleToPositioned,\n} from './Circle.js';\nimport { scale } from '../data/Scale.js';\nimport { linearSpace } from '../Numbers.js';\n\nconst cos = Math.cos;\nconst sin = Math.sin;\nconst asin = Math.asin;\nconst sqrt = Math.sqrt;\nconst pow = Math.pow;\nconst pi = Math.PI;\nconst piPi = Math.PI * 2;\nconst goldenAngle = pi * (3 - sqrt(5));\nconst goldenSection = (1 + sqrt(5)) / 2;\n\n/**\n * Options for a Vogel spiral\n */\nexport type VogelSpiralOpts = {\n  /**\n   * Upper limit of points to produce.\n   * By default, 5000.\n   */\n  readonly maxPoints?: number;\n  /**\n   * Density value (0..1) which determines spacing of points.\n   * This is useful because it scales with whatever circle radius is given\n   * Use this parameter OR the `spacing` parameter.\n   */\n  readonly density?: number;\n  /**\n   * Spacing between points.\n   * Use this option OR the density value.\n   */\n  readonly spacing?: number;\n  /**\n   * Rotation offset to apply, in radians. 0 by default\n   */\n  readonly rotation?: number;\n};\n\n/**\n * Generates points on a Vogel spiral - a sunflower-like arrangement of points.\n *\n * @example With no arguments, assumes a unit circle\n * ```js\n * for (const pt of circleVogelSpiral()) {\n *  // Generate points on a unit circle, with 95% density\n * }\n * ```\n *\n *\n * @example Specifying a circle and options\n * ```js\n * const circle = { radius: 100, x: 100, y: 100 };\n * const opts = {\n *  maxPoints: 50,\n *  density: 0.99\n * };\n * for (const pt of circleVogelSpiral(circle, opts)) {\n *  // Do something with point...\n * }\n * ```\n *\n * @example Array format\n * ```js\n * const ptsArray = [...circleVogelSpiral(circle, opts)];\n * ```\n * @param circle\n * @param opts\n */\nexport function* circleVogelSpiral(\n  circle?: Circle,\n  opts: VogelSpiralOpts = {}\n): IterableIterator<Points.Point> {\n  const maxPoints = opts.maxPoints ?? 5000;\n  const density = opts.density ?? 0.95;\n  const rotationOffset = opts.rotation ?? 0;\n\n  const c = circleToPositioned(circle ?? { radius: 1, x: 0, y: 0 });\n  const max = c.radius;\n  //eslint-disable-next-line functional/no-let\n  let spacing = c.radius * scale(density, 0, 1, 0.3, 0.01);\n  if (opts.spacing) spacing = opts.spacing;\n\n  //eslint-disable-next-line functional/no-let\n  let radius = 0;\n  //eslint-disable-next-line functional/no-let\n  let count = 0;\n  //eslint-disable-next-line functional/no-let\n  let angle = 0;\n  while (count < maxPoints && radius < max) {\n    radius = spacing * count ** 0.5;\n    angle = rotationOffset + (count * 2 * pi) / goldenSection;\n    yield Object.freeze({\n      x: c.x + radius * cos(angle),\n      y: c.y + radius * sin(angle),\n    });\n    count++;\n  }\n}\n\nexport type CircleRingsOpts = {\n  readonly rings?: number;\n  /**\n   * Rotation offset, in radians\n   */\n  readonly rotation?: number;\n};\n/**\n * Generates points spaced out on the given number of rings.\n *\n * Get points as array\n * ```js\n * const circle = { radius: 5, x: 100, y: 100 };\n * const opts = { rings: 5 };\n * const points = [...circleRings(circle, rings)];\n * ```\n *\n * Or iterate over them\n * ```js\n * for (const point of circleRings(circle, opts)) {\n * }\n * ```\n * Source: http://www.holoborodko.com/pavel/2015/07/23/generating-equidistant-points-on-unit-disk/#more-3453\n * @param circle\n */\nexport function* circleRings(\n  circle?: Circle | CirclePositioned,\n  opts: CircleRingsOpts = {}\n): IterableIterator<Points.Point> {\n  const rings = opts.rings ?? 5;\n  const c = circleToPositioned(circle ?? { radius: 1, x: 0, y: 0 });\n  const ringR = 1 / rings;\n  const rotationOffset = opts.rotation ?? 0;\n\n  //eslint-disable-next-line functional/no-let\n  let ringCount = 1;\n\n  // Origin\n  yield Object.freeze({ x: c.x, y: c.y });\n\n  //eslint-disable-next-line functional/no-let\n  for (let r = ringR; r <= 1; r += ringR) {\n    const n = Math.round(pi / asin(1 / (2 * ringCount)));\n    for (const theta of linearSpace(0, piPi, n + 1)) {\n      yield Object.freeze({\n        x: c.x + r * cos(theta + rotationOffset) * c.radius,\n        y: c.y + r * sin(theta + rotationOffset) * c.radius,\n      });\n    }\n    ringCount++;\n  }\n}\n/**\n * Fibonacci sphere algorithm. Generates points\n * distributed on a sphere.\n *\n * @example Generate points of a unit sphere\n * ```js\n * for (const pt of sphereFibonacci(100)) {\n *  // pt.x, pt.y, pt.z\n * }\n * ```\n *\n * @example Generate points into an array\n * ```js\n * const sphere = { radius: 10, x: 10, y: 200 }\n * const pts = [...sphereFibonacci(100, 0, sphere)];\n * ```\n *\n * Source: https://codepen.io/elchininet/pen/vXeRyL\n *\n * @param samples\n * @returns\n */\nexport function* sphereFibonacci(\n  samples: number = 100,\n  rotationRadians: number = 0,\n  sphere?: Sphere\n): IterableIterator<Points.Point3d> {\n  const offset = 2 / samples;\n  const s = sphere ?? { x: 0, y: 0, z: 0, radius: 1 };\n\n  //eslint-disable-next-line functional/no-let\n  for (let i = 0; i < samples; i++) {\n    const y = i * offset - 1 + offset / 2;\n    const r = sqrt(1 - pow(y, 2));\n    const a = ((i + 1) % samples) * goldenAngle + rotationRadians;\n    const x = cos(a) * r;\n    const z = sin(a) * r;\n    //eslint-disable-next-line functional/immutable-data\n    yield Object.freeze({\n      x: s.x + x * s.radius,\n      y: s.y + y * s.radius,\n      z: s.z + z * s.radius,\n    });\n  }\n}\n","/**\n * Acknowledgements: much of the work here is an adapation from Daniel Shiffman's excellent _The Nature of Code_ website.\n */\nimport { Points, Polar } from '../geometry/index.js';\nimport { type Point } from '../geometry/Point.js';\nimport { clamp } from '../data/Clamp.js';\nimport { interpolateAngle } from '../data/Interpolate.js';\nimport { type Rect, getEdgeX, getEdgeY } from '../geometry/Rect.js';\n\n/**\n * Logic for applying mass\n */\nexport type MassApplication = `dampen` | `multiply` | `ignored`;\n\n/**\n * Basic properties of a thing that can be\n * affected by forces\n */\nexport type ForceAffected = {\n  /**\n   * Position. Probably best to use relative coordinates\n   */\n  readonly position?: Point;\n  /**\n   * Velocity vector.\n   * Probably don't want to assign this yourself, but rather have it computed based on acceleration and applied forces\n   */\n  readonly velocity?: Point;\n  /**\n   * Acceleration vector. Most applied forces will alter the acceleration, culminating in a new velocity being set and the\n   * acceleraton value zeroed\n   */\n  readonly acceleration?: Point;\n  /**\n   * Mass. The unit is undefined, again best to think of this being on a 0..1 scale. Mass is particularly important\n   * for the attraction/repulsion force, but other forces can incorporate mass too.\n   */\n  readonly mass?: number;\n\n  readonly angularAcceleration?: number;\n\n  readonly angularVelocity?: number;\n\n  readonly angle?: number;\n};\n\n/**\n * A function that updates values of a thing.\n *\n * These can be created using the xxxForce functions, eg {@link attractionForce}, {@link accelerationForce}, {@link magnitudeForce}, {@link velocityForce}\n */\nexport type ForceFn = (t: ForceAffected) => ForceAffected;\n\n/**\n * A vector to apply to acceleration or a force function\n */\nexport type ForceKind = Points.Point | ForceFn | null;\n\n/**\n * Throws an error if `t` is not of the `ForceAffected` shape.\n * @param t\n * @param name\n */\nexport const guard = (t: ForceAffected, name: string = `t`) => {\n  if (t === undefined) {\n    throw new Error(`Parameter ${name} is undefined. Expected ForceAffected`);\n  }\n  if (t === null) {\n    throw new Error(`Parameter ${name} is null. Expected ForceAffected`);\n  }\n  if (typeof t !== `object`) {\n    throw new Error(\n      `Parameter ${name} is type ${typeof t}. Expected object of shape ForceAffected`\n    );\n  }\n};\n\n/**\n * `constrainBounce` yields a function that affects `t`'s position and velocity such that it\n * bounces within bounds.\n *\n * ```js\n * // Setup bounce with area constraints\n * // Reduce velocity by 10% with each impact\n * const b = constrainBounce({ width:200, height:500 }, 0.9);\n *\n * // Thing\n * const t = {\n *  position: { x: 50,  y: 50 },\n *  velocity: { x: 0.3, y: 0.01 }\n * };\n *\n * // `b` returns an altereted version of `t`, with the\n * // bounce logic applied.\n * const bounced = b(t);\n * ```\n *\n * `dampen` parameter allows velocity to be dampened with each bounce. A value\n * of 0.9 for example reduces velocity by 10%. A value of 1.1 will increase velocity by\n * 10% with each bounce.\n * @param bounds Constraints of area\n * @params dampen How much to dampen velocity by. Defaults to 1 meaning there is no damping.\n * @returns A function that can perform bounce logic\n */\nexport const constrainBounce = (\n  bounds: Rect = { width: 1, height: 1 },\n  dampen = 1\n) => {\n  const minX = getEdgeX(bounds, `left`);\n  const maxX = getEdgeX(bounds, `right`);\n  const minY = getEdgeY(bounds, `top`);\n  const maxY = getEdgeY(bounds, `bottom`);\n\n  return (t: ForceAffected): ForceAffected => {\n    const position = computePositionFromVelocity(\n      t.position ?? Points.Empty,\n      t.velocity ?? Points.Empty\n    );\n    //eslint-disable-next-line functional/no-let\n    let velocity = t.velocity ?? Points.Empty;\n    //eslint-disable-next-line functional/no-let\n    let { x, y } = position;\n\n    if (x > maxX) {\n      x = maxX;\n      velocity = Points.invert(Points.multiply(velocity, dampen), `x`);\n    } else if (x < minX) {\n      x = minX;\n      velocity = Points.invert(Points.multiply(velocity, dampen), `x`);\n    }\n\n    if (y > maxY) {\n      y = maxY;\n      velocity = Points.multiply(Points.invert(velocity, `y`), dampen);\n    } else if (position.y < minY) {\n      y = minY;\n      velocity = Points.invert(Points.multiply(velocity, dampen), `y`);\n    }\n\n    return Object.freeze({\n      ...t,\n      position: { x, y },\n      velocity,\n    });\n  };\n};\n\n/**\n * For a given set of attractors, returns a function that a sets acceleration of attractee.\n * Keep note though that this bakes-in the values of the attractor, it won't reflect changes to their state. For dynamic\n * attractors, it might be easier to use `computeAttractionForce`.\n *\n * @example Force\n * ```js\n * const f = Forces.attractionForce(sun, gravity);\n * earth = Forces.apply(earth, f);\n * ```\n *\n * @example Everything mutually attracted\n * ```js\n * // Create a force with all things as attractors.\n * const f = Forces.attractionForce(things, gravity);\n * // Apply force to all things.\n * // The function returned by attractionForce will automatically ignore self-attraction\n * things = things.map(a => Forces.apply(a, f));\n * ```\n * @param attractors\n * @param gravity\n * @param distanceRange\n * @returns\n */\nexport const attractionForce =\n  (\n    attractors: readonly ForceAffected[],\n    gravity: number,\n    distanceRange: { readonly min?: number; readonly max?: number } = {}\n  ) =>\n  (attractee: ForceAffected): ForceAffected => {\n    //eslint-disable-next-line functional/no-let\n    let accel = attractee.acceleration ?? Points.Empty;\n    attractors.forEach((a) => {\n      if (a === attractee) return;\n\n      const f = computeAttractionForce(a, attractee, gravity, distanceRange);\n      accel = Points.sum(accel, f);\n    });\n    return {\n      ...attractee,\n      acceleration: accel,\n    };\n  };\n\n/**\n * Computes the attraction force between two things.\n * Value for `gravity` will depend on what range is used for `mass`. It's probably a good idea\n * to keep mass to mean something relative - ie 1 is 'full' mass, and adjust the `gravity`\n * value until it behaves as you like. Keeping mass in 0..1 range makes it easier to apply to\n * visual properties later.\n *\n * @example Attractee and attractor, gravity 0.005\n * ```js\n * const attractor = { position: { x:0.5, y:0.5 }, mass: 1 };\n * const attractee = { position: Points.random(), mass: 0.01 };\n * attractee = Forces.apply(attractee, Forces.computeAttractionForce(attractor, attractee, 0.005));\n * ```\n *\n * @example Many attractees for one attractor, gravity 0.005\n * ```js\n * attractor =  { position: { x:0.5, y:0.5 }, mass: 1 };\n * attractees = attractees.map(a => Forces.apply(a, Forces.computeAttractionForce(attractor, a, 0.005)));\n * ```\n *\n * @example Everything mutually attracted\n * ```js\n * // Create a force with all things as attractors.\n * const f = Forces.attractionForce(things, gravity);\n * // Apply force to all things.\n * // The function returned by attractionForce will automatically ignore self-attraction\n * things = things.map(a => Forces.apply(a, f));\n * ```\n *\n * `attractor` thing attracting (eg, earth)\n * `attractee` thing being attracted (eg. satellite)\n *\n *\n * `gravity` will have to be tweaked to taste.\n * `distanceRange` clamps the computed distance. This affects how tightly the particles will orbit and can also determine speed. By default it is 0.001-0.7\n * @param attractor Attractor (eg earth)\n * @param attractee Attractee (eg satellite)\n * @param gravity Gravity constant\n * @param distanceRange Min/max that distance is clamped to.\n * @returns\n */\nexport const computeAttractionForce = (\n  attractor: ForceAffected,\n  attractee: ForceAffected,\n  gravity: number,\n  distanceRange: { readonly min?: number; readonly max?: number } = {}\n): Points.Point => {\n  if (attractor.position === undefined) {\n    throw new Error(`attractor.position not set`);\n  }\n  if (attractee.position === undefined) {\n    throw new Error(`attractee.position not set`);\n  }\n\n  const distRangeMin = distanceRange.min ?? 0.01;\n  const distRangeMax = distanceRange.max ?? 0.7;\n\n  // Vector between objects\n  const f = Points.normalise(\n    Points.subtract(attractor.position, attractee.position)\n  );\n\n  // Distance\n  const d = clamp(Points.distance(f), distRangeMin, distRangeMax);\n\n  // Multiply vector by gravity, scaled by mass of things and distance\n  return Points.multiply(\n    f,\n    (gravity * (attractor.mass ?? 1) * (attractee.mass ?? 1)) / (d * d)\n  );\n};\n\nexport type TargetOpts = {\n  /**\n   * Acceleration scaling. Defaults to 0.001\n   */\n  readonly diminishBy?: number;\n  /**\n   * If distance is less than this range, don't move.\n   * If undefined (default), will try to get an exact position\n   */\n  readonly range?: Points.Point;\n};\n/**\n * A force that moves a thing toward `targetPos`.\n *\n * ```js\n * const t = Forces.apply(t, Forces.targetForce(targetPos));\n * ```\n * @param targetPos\n * @param diminishBy Scales acceleration. Defaults to 0.001.\n * @returns\n */\nexport const targetForce = (targetPos: Points.Point, opts: TargetOpts = {}) => {\n  const fn = (t: ForceAffected): ForceAffected => {\n    const accel = computeAccelerationToTarget(\n      targetPos,\n      t.position ?? { x: 0.5, y: 0.5 },\n      opts\n    );\n    return {\n      ...t,\n      acceleration: Points.sum(t.acceleration ?? Points.Empty, accel),\n    };\n  };\n  return fn;\n};\n\n/**\n * Returns `pt` with x and y set to `setpoint` if either's absolute value is below `v`\n * @param pt\n * @param v\n * @returns\n */\n// const roundTo = (pt: Point, v: number, setpoint: number): Point => {\n//   const x = Math.abs(pt.x);\n//   const y = Math.abs(pt.y);\n\n//   if (x < v && y < v) return { x: setpoint, y: setpoint };\n//   if (x < v) return { x: setpoint, y: pt.y };\n//   if (y < v) return { x: pt.x, y: setpoint };\n//   return pt;\n// };\n\n/**\n * Apply a series of force functions or forces to `t`. Null/undefined entries are skipped silently.\n * It also updates the velocity and position of the returned version of `t`.\n *\n * ```js\n * // Wind adds acceleration. Force is dampened by mass\n * const wind = Forces.accelerationForce({ x: 0.00001, y: 0 }, `dampen`);\n *\n * // Gravity adds acceleration. Force is magnified by mass\n * const gravity = Forces.accelerationForce({ x: 0, y: 0.0001 }, `multiply`);\n *\n * // Friction is calculated based on velocity. Force is magnified by mass\n * const friction = Forces.velocityForce(0.00001, `multiply`);\n *\n *  // Flip movement velocity if we hit a wall. And dampen it by 10%\n * const bouncer = Forces.constrainBounce({ width: 1, height: 1 }, 0.9);\n *\n * let t = {\n *  position: Points.random(),\n *  mass: 0.1\n * };\n *\n * // Apply list of forces, returning a new version of the thing\n * t = Forces.apply(t,\n *   gravity,\n *   wind,\n *   friction,\n *   bouncer\n * );\n * ```\n */\nexport const apply = (\n  t: ForceAffected,\n  ...accelForces: readonly ForceKind[]\n): ForceAffected => {\n  if (t === undefined) throw new Error(`t parameter is undefined`);\n\n  accelForces.forEach((f) => {\n    if (f === null || f === undefined) return;\n    if (typeof f === `function`) {\n      t = f(t);\n    } else {\n      t = {\n        ...t,\n        acceleration: Points.sum(t.acceleration ?? Points.Empty, f),\n      };\n    }\n  });\n\n  // Integate velocity from acceleration\n  const velo = computeVelocity(\n    t.acceleration ?? Points.Empty,\n    t.velocity ?? Points.Empty\n  );\n\n  // Compute position\n  const pos = computePositionFromVelocity(t.position ?? Points.Empty, velo);\n\n  const ff: ForceAffected = {\n    ...t,\n    position: pos,\n    velocity: velo,\n    // Clear accel, because it has been integrated into velocity\n    acceleration: Points.Empty,\n  };\n  return ff;\n};\n\n/**\n * Apples `vector` to acceleration, scaling according to mass, based on the `mass` option.\n * It returns a function which can later be applied to a thing.\n *\n * ```js\n * import { Forces } from \"https://unpkg.com/ixfx/dist/modulation.js\"\n * // Acceleration vector of (0.1, 0), ie moving straight on horizontal axis\n * const f = Forces.accelerationForce({ x:0.1, y:0 }, `dampen`);\n *\n * // Thing to move\n * let t = { position: ..., acceleration: ... }\n *\n * // Apply force\n * t = f(t);\n * ```\n * @param vector\n * @returns Force function\n */\nexport const accelerationForce =\n  (vector: Points.Point, mass: MassApplication = `ignored`): ForceFn =>\n  (t: ForceAffected) =>\n    Object.freeze({\n      ...t,\n      acceleration: massApplyAccel(vector, t, mass), //Points.sum(t.acceleration ?? Points.Empty, op(t.mass ?? 1))\n    });\n\n/**\n * Returns an acceleration vector with mass either dampening or multiplying it.\n * The passed-in `thing` is not modified.\n *\n * ```js\n * // Initial acceleration vector\n * const accel = { x: 0.1, y: 0};\n *\n * // Thing being moved\n * const thing = { mass: 0.5, position: ..., acceleration: ... }\n *\n * // New acceleration vector, affected by mass of `thing`\n * const accelWithMass = massApplyAccel(accel, thing, `dampen`);\n * ```\n * Mass of thing can be factored in, according to `mass` setting. Use `dampen`\n * to reduce acceleration with greater mass of thing. Use `multiply` to increase\n * the effect of acceleration with a greater mass of thing. `ignored` means\n * mass is not taken into account.\n *\n * If `t` has no mass, the `mass` setting is ignored.\n *\n * This function is used internally by the predefined forces.\n *\n * @param vector Vector force\n * @param thing Thing being affected\n * @param mass How to factor in mass of thing (default ignored)\n * @returns Acceleration vector\n */\nconst massApplyAccel = (\n  vector: Points.Point,\n  thing: ForceAffected,\n  mass: MassApplication = `ignored`\n) => {\n  //eslint-disable-next-line functional/no-let\n  let op;\n  if (mass === `dampen`) {\n    op = (mass: number) => Points.divide(vector, mass, mass);\n  } else if (mass === `multiply`) {\n    op = (mass: number) => Points.multiply(vector, mass, mass);\n  } else if (mass === `ignored`) {\n    op = (_mass: number) => vector;\n  } else {\n    throw new Error(\n      `Unknown 'mass' parameter '${mass}. Expected 'dampen', 'multiply' or 'ignored'`\n    );\n  }\n  return Points.sum(thing.acceleration ?? Points.Empty, op(thing.mass ?? 1));\n  // if (t.mass) {\n  //   if (dampen) return Points.sum(t.acceleration ?? Points.Empty, Points.divide(v, t.mass ?? 1));\n  //   else return Points.sum(t.acceleration ?? Points.Empty, Points.multiply(v, t.mass ?? 1));\n  // }\n  // return v;\n};\n\n/**\n * A force based on the square of the thing's velocity.\n * It's like {@link velocityForce}, but here the velocity has a bigger impact.\n *\n * ```js\n * const thing = {\n *  position: { x: 0.5, y:0.5 },\n *  velocity: { x: 0.001, y:0 }\n * };\n * const drag = magnitudeForce(0.1);\n *\n * // Apply drag force to thing, returning result\n * const t = Forces.apply(thing, drag);\n * ```\n * @param force Force value\n * @param mass How to factor in mass\n * @returns Function that computes force\n */\nexport const magnitudeForce =\n  (force: number, mass: MassApplication = `ignored`): ForceFn =>\n  (t: ForceAffected): ForceAffected => {\n    if (t.velocity === undefined) return t;\n\n    const mag = Points.distance(Points.normalise(t.velocity));\n    const magSq = force * mag * mag;\n    const vv = Points.multiply(Points.invert(t.velocity), magSq);\n    return Object.freeze({\n      ...t,\n      acceleration: massApplyAccel(vv, t, mass),\n    });\n  };\n\n/**\n * Null force does nothing\n * @returns A force that does nothing\n */\nexport const nullForce = (t: ForceAffected): ForceAffected => t;\n\n/**\n * Force calculated from velocity of object. Reads velocity and influences acceleration.\n *\n * ```js\n * let t = { position: Points.random(), mass: 0.1 };\n * const friction = velocityForce(0.1, `dampen`);\n *\n * // Apply force, updating position and velocity\n * t = Forces.apply(t, friction);\n * ```\n * @param force Force\n * @param mass How to factor in mass\n * @returns Function that computes force\n */\nexport const velocityForce = (\n  force: number,\n  mass: MassApplication\n): ForceFn => {\n  // Invert velocity and then multiply by force\n  const pipeline = Points.pipeline(\n    // Points.normalise,\n    Points.invert,\n    (v: Point) => Points.multiply(v, force)\n  );\n\n  return (t: ForceAffected): ForceAffected => {\n    if (t.velocity === undefined) return t;\n\n    // Apply pipeline\n    const v = pipeline(t.velocity);\n    return Object.freeze({\n      ...t,\n      acceleration: massApplyAccel(v, t, mass),\n    });\n  };\n};\n\n/**\n * Sets angle, angularVelocity and angularAcceleration based on\n *  angularAcceleration, angularVelocity, angle\n * @returns\n */\nexport const angularForce = () => (t: ForceAffected) => {\n  const acc = t.angularAcceleration ?? 0;\n  const vel = t.angularVelocity ?? 0;\n  const angle = t.angle ?? 0;\n\n  const v = vel + acc;\n  const a = angle + v;\n\n  return Object.freeze({\n    ...t,\n    angle: a,\n    angularVelocity: v,\n    angularAcceleration: 0,\n  });\n};\n\n// export const positionFromAngleForce = () => (t:ForceAffected) => {\n//   return Object.freeze({\n//     ...t,\n//     position: computePositionFromAngle()\n//   });\n// };\n\n/**\n * Yields a force function that applies the thing's acceleration.x to its angular acceleration.\n * @param scaling Use this to scale the accel.x value. Defaults to 20 (ie accel.x*20). Adjust if rotation is too much or too little\n * @returns\n */\nexport const angleFromAccelerationForce =\n  (scaling: number = 20) =>\n  (t: ForceAffected) => {\n    const accel = t.acceleration ?? Points.Empty;\n    return Object.freeze({\n      ...t,\n      angularAcceleration: accel.x * scaling,\n    });\n  };\n\n/**\n * Yields a force function that applies the thing's velocity to its angular acceleration.\n * This will mean it points in the direction of travel.\n * @param interpolateAmt If provided, the angle will be interpolated toward by this amount. Defaults to 1, no interpolation\n * @returns\n */\nexport const angleFromVelocityForce =\n  (interpolateAmt: number = 1) =>\n  (t: ForceAffected) => {\n    const a = Points.angle(t.velocity ?? Points.Empty);\n    return Object.freeze({\n      ...t,\n      angle:\n        interpolateAmt < 1\n          ? interpolateAngle(interpolateAmt, t.angle ?? 0, a)\n          : a,\n    });\n  };\n\n/**\n * Spring force\n *\n *  * ```js\n * // End of spring that moves\n * let thing = {\n *   position: { x: 1, y: 0.5 },\n *   mass: 0.1\n * };\n *\n * // Anchored other end of spring\n * const pinnedAt = {x: 0.5, y: 0.5};\n *\n * // Create force: length of 0.4\n * const springForce = Forces.springForce(pinnedAt, 0.4);\n *\n * continuously(() => {\n *  // Apply force\n *  thing = Forces.apply(thing, springForce);\n * }).start();\n * ```\n * [Read more](https://www.joshwcomeau.com/animation/a-friendly-introduction-to-spring-physics/)\n *\n * @param pinnedAt Anchored end of the spring\n * @param restingLength Length of spring-at-rest (default: 0.5)\n * @param k Spring stiffness (default: 0.0002)\n * @param damping Damping factor to apply, so spring slows over time. (default: 0.995)\n * @returns\n */\nexport const springForce =\n  (\n    pinnedAt: Points.Point,\n    restingLength: number = 0.5,\n    k = 0.0002,\n    damping = 0.999\n  ) =>\n  (t: ForceAffected): ForceAffected => {\n    const dir = Points.subtract(t.position ?? Points.Empty, pinnedAt);\n    const mag = Points.distance(dir);\n    const stretch = Math.abs(restingLength - mag);\n\n    const f = Points.pipelineApply(dir, Points.normalise, (p) =>\n      Points.multiply(p, -k * stretch)\n    );\n\n    const accel = massApplyAccel(f, t, `dampen`);\n    const velo = computeVelocity(\n      accel ?? Points.Empty,\n      t.velocity ?? Points.Empty\n    );\n    const veloDamped = Points.multiply(velo, damping, damping);\n    return {\n      ...t,\n      velocity: veloDamped,\n      acceleration: Points.Empty,\n    };\n  };\n\n/**\n * Pendulum force options\n */\nexport type PendulumOpts = {\n  /**\n   * Length of 'string' thing is hanging from. If\n   * undefined, the current length between thing and\n   * pinnedAt is used.\n   */\n  readonly length?: number;\n  /**\n   * Max speed of swing. Slower speed can reach equilibrium faster, since it\n   * might not swing past resting point.\n   * Default 0.001.\n   */\n  readonly speed?: number;\n  /**\n   * Damping, how much to reduce velocity. Default 0.995 (ie 0.5% loss)\n   */\n  readonly damping?: number;\n};\n/**\n * The pendulum force swings something back and forth.\n *\n * ```js\n * // Swinger\n * let thing = {\n *   position: { x: 1, y: 0.5 },\n *   mass: 0.1\n * };\n *\n * // Position thing swings from (middle of screen)\n * const pinnedAt = {x: 0.5, y: 0.5};\n *\n * // Create force: length of 0.4\n * const pendulumForce = Forces.pendulumForce(pinnedAt, { length: 0.4 });\n *\n * continuously(() => {\n *  // Apply force\n *  // Returns a new thing with recalculated angularVelocity, angle and position.\n *  thing = Forces.apply(thing, pendulumForce);\n * }).start();\n * ```\n *\n * [Read more](https://natureofcode.com/book/chapter-3-oscillation/)\n *\n * @param pinnedAt Location to swing from (x:0.5, y:0.5 default)\n * @param opts Options\n * @returns\n */\nexport const pendulumForce =\n  (pinnedAt: Points.Point = { x: 0.5, y: 0 }, opts: PendulumOpts = {}) =>\n  (t: ForceAffected): ForceAffected => {\n    const length =\n      opts.length ?? Points.distance(pinnedAt, t.position ?? Points.Empty);\n    const speed = opts.speed ?? 0.001;\n    const damping = opts.damping ?? 0.995;\n\n    //eslint-disable-next-line functional/no-let\n    let angle = t.angle;\n    if (angle === undefined) {\n      if (t.position) {\n        angle = Points.angle(pinnedAt, t.position) - Math.PI / 2;\n      } else {\n        angle = 0; // Position wherever\n      }\n    }\n    const accel = ((-1 * speed) / length) * Math.sin(angle);\n    const v = (t.angularVelocity ?? 0) + accel;\n    angle += v;\n\n    return Object.freeze({\n      angularVelocity: v * damping,\n      angle,\n      position: computePositionFromAngle(length, angle + Math.PI / 2, pinnedAt),\n    });\n  };\n\n/**\n * Compute velocity based on acceleration and current velocity\n * @param acceleration Acceleration\n * @param velocity Velocity\n * @param velocityMax If specified, velocity will be capped at this value\n * @returns\n */\nexport const computeVelocity = (\n  acceleration: Points.Point,\n  velocity: Points.Point,\n  velocityMax?: number\n): Points.Point => {\n  const p = Points.sum(velocity, acceleration);\n  if (velocityMax !== undefined) return Points.clampMagnitude(p, velocityMax);\n  else return p;\n};\n\n/**\n * Returns the acceleration to get from `currentPos` to `targetPos`.\n *\n * @example Barebones usage:\n * ```js\n * const accel = Forces.computeAccelerationToTarget(targetPos, currentPos);\n * const vel = Forces.computeVelocity(accel, currentVelocity);\n *\n * // New position:\n * const pos = Points.sum(currentPos, vel);\n * ```\n *\n * @example Implementation:\n * ```js\n * const direction = Points.subtract(targetPos, currentPos);\n * const accel = Points.multiply(direction, diminishBy);\n * ```\n * @param currentPos Current position\n * @param targetPos Target position\n * @param opts Options\n * @returns\n */\nexport const computeAccelerationToTarget = (\n  targetPos: Points.Point,\n  currentPos: Points.Point,\n  opts: TargetOpts = {}\n) => {\n  const diminishBy = opts.diminishBy ?? 0.001;\n\n  // Compare to current position of thing to get vector direction\n  const direction = Points.subtract(targetPos, currentPos);\n\n  if (opts.range) {\n    // If direction is less than range, return { x: 0, y: 0}\n    if (Points.compare(Points.abs(direction), opts.range) === -2) {\n      return Points.Empty;\n    }\n  }\n\n  // Diminish vector to make a meaningful acceleration\n  return Points.multiply(direction, diminishBy);\n};\n\n/**\n * Compute a new position based on existing position and velocity vector\n * @param position Position Current position\n * @param velocity Velocity vector\n * @returns Point\n */\nexport const computePositionFromVelocity = (\n  position: Points.Point,\n  velocity: Points.Point\n): Points.Point => Points.sum(position, velocity);\n\n/**\n * Compute a position based on distance and angle from origin\n * @param distance Distance from origin\n * @param angleRadians Angle, in radians from origin\n * @param origin Origin point\n * @returns Point\n */\nexport const computePositionFromAngle = (\n  distance: number,\n  angleRadians: number,\n  origin: Points.Point\n) => Polar.toCartesian(distance, angleRadians, origin);\n\nconst _angularForce = angularForce();\nconst _angleFromAccelerationForce = angleFromAccelerationForce();\n\n/**\n * A force that orients things according to direction of travel.\n *\n * Under the hood, it applies:\n * * angularForce,\n * * angleFromAccelerationForce, and\n * * angleFromVelocityForce\n * @param interpolationAmt\n * @returns\n */\nexport const orientationForce = (interpolationAmt = 0.5): ForceFn => {\n  const angleFromVel = angleFromVelocityForce(interpolationAmt);\n\n  return (t: ForceAffected) => {\n    t = _angularForce(t);\n    t = _angleFromAccelerationForce(t);\n    t = angleFromVel(t);\n    return t;\n  };\n};\n","import * as Timers from '../flow/Timer.js';\n\nconst piPi = Math.PI * 2;\n\nexport type SpringOpts = {\n  /**\n   * Default: 1\n   */\n  readonly mass?: number; // = 1.0\n  /**\n   * Default: 10\n   */\n  readonly damping?: number; // = 10.0\n  /**\n   * Default: 100\n   */\n  readonly stiffness?: number; // = 100.0\n  /**\n   * Default: false\n   */\n  readonly soft?: boolean; // = false\n\n  /**\n   * Default: 0.1\n   */\n  readonly velocity?: number;\n\n  /**\n   * How many iterations to wait for spring settling (default: 10)\n   */\n  readonly countdown?: number;\n};\n\nconst springRaw = (opts: SpringOpts = {}, from = 0, to = 1) => {\n  /** MIT License github.com/pushkine/ */\n  const mass = opts.mass ?? 1;\n  const stiffness = opts.stiffness ?? 100;\n  const soft = opts.soft ?? false;\n  const damping = opts.damping ?? 10;\n  const velocity = opts.velocity ?? 0.1;\n  const delta = to - from;\n  if (soft || 1 <= damping / (2 * Math.sqrt(stiffness * mass))) {\n    const angularFrequency = -Math.sqrt(stiffness / mass);\n    const leftover = -angularFrequency * delta - velocity;\n    return (t: number) =>\n      to - (delta + t * leftover) * Math.E ** (t * angularFrequency);\n  } else {\n    const dampingFrequency = Math.sqrt(4 * mass * stiffness - damping ** 2);\n    const leftover =\n      (damping * delta - 2 * mass * velocity) / dampingFrequency;\n    const dfm = (0.5 * dampingFrequency) / mass;\n    const dm = -(0.5 * damping) / mass;\n    return (t: number) =>\n      to -\n      (Math.cos(t * dfm) * delta + Math.sin(t * dfm) * leftover) *\n      Math.E ** (t * dm);\n  }\n};\n\n/**\n * Spring-style oscillation\n *\n * ```js\n * import { Oscillators } from \"https://unpkg.com/ixfx/dist/modulation.js\"\n * const spring = Oscillators.spring();\n *\n * continuously(() => {\n *  const v = spring.next().value;\n *  // Yields values 0...1\n *  //  undefined is yielded when spring is estimated to have stopped\n * });\n * ```\n *\n * Parameters to the spring can be provided.\n * ```js\n * const spring = Oscillators.spring({\n *  mass: 5,\n *  damping: 10\n *  stiffness: 100\n * });\n * ```\n * @param opts Options for spring\n * @param timerOrFreq Timer to use, or frequency\n */\n//eslint-disable-next-line func-style\nexport function* spring(\n  opts: SpringOpts = {},\n  timerOrFreq?: Timers.Timer | number | undefined\n) {\n  if (timerOrFreq === undefined) timerOrFreq = Timers.msElapsedTimer();\n  else if (typeof timerOrFreq === `number`) {\n    timerOrFreq = Timers.frequencyTimer(timerOrFreq);\n  }\n\n  const fn = springRaw(opts, 0, 1);\n\n  // Give it some iterations to settle\n  //eslint-disable-next-line functional/no-let\n  let doneCountdown = opts.countdown ?? 10;\n\n  while (doneCountdown > 0) {\n    const s = fn(timerOrFreq.elapsed / 1000);\n    yield s;\n    if (s === 1) {\n      doneCountdown--;\n    } else {\n      doneCountdown = 100;\n    }\n  }\n}\n\n/**\n * Sine oscillator.\n *\n * ```js\n * import { Oscillators } from \"https://unpkg.com/ixfx/dist/modulation.js\"\n * import { frequencyTimer } from \"https://unpkg.com/ixfx/dist//flow.js\";\n * // Setup\n * const osc = Oscillators.sine(frequencyTimer(10));\n * const osc = Oscillators.sine(0.1);\n *\n * // Call whenever a value is needed\n * const v = osc.next().value;\n * ```\n *\n * @example Saw/tri pinch\n * ```js\n * const v = Math.pow(osc.value, 2);\n * ```\n *\n * @example Saw/tri bulge\n * ```js\n * const v = Math.pow(osc.value, 0.5);\n * ```\n *\n */\n//eslint-disable-next-line func-style\nexport function* sine(timerOrFreq: Timers.Timer | number) {\n  if (timerOrFreq === undefined) throw new TypeError(`Parameter 'timerOrFreq' is undefined`);\n  if (typeof timerOrFreq === `number`) {\n    timerOrFreq = Timers.frequencyTimer(timerOrFreq);\n  }\n\n  while (true) {\n    // Rather than -1 to 1, we want 0 to 1\n    yield (Math.sin(timerOrFreq.elapsed * piPi) + 1) / 2;\n  }\n}\n\n/**\n * Bipolar sine (-1 to 1)\n * @param timerOrFreq\n */\n//eslint-disable-next-line func-style\nexport function* sineBipolar(timerOrFreq: Timers.Timer | number) {\n  if (timerOrFreq === undefined) throw new TypeError(`Parameter 'timerOrFreq' is undefined`);\n\n  if (typeof timerOrFreq === `number`) {\n    timerOrFreq = Timers.frequencyTimer(timerOrFreq);\n  }\n  while (true) {\n    yield Math.sin(timerOrFreq.elapsed * piPi);\n  }\n}\n\n/**\n * Triangle oscillator\n *\n * ```js\n * // Setup\n * const osc = triangle(Timers.frequencyTimer(0.1));\n * const osc = triangle(0.1);\n *\n * // Call whenver a value is needed\n * const v = osc.next().value;\n * ```\n */\n//eslint-disable-next-line func-style\nexport function* triangle(timerOrFreq: Timers.Timer | number) {\n  if (typeof timerOrFreq === `number`) {\n    timerOrFreq = Timers.frequencyTimer(timerOrFreq);\n  }\n  while (true) {\n    // elapsed is repeatedly 0->1\n    //eslint-disable-next-line functional/no-let\n    let v = timerOrFreq.elapsed;\n    // /2 = 0->0.5\n    if (v < 0.5) {\n      // Upward\n      v *= 2;\n    } else {\n      // Downward\n      v = 2 - v * 2;\n    }\n    yield v;\n  }\n}\n\n/**\n * Saw oscillator\n *\n * ```js\n * import { Oscillators } from \"https://unpkg.com/ixfx/dist/modulation.js\"\n * import { frequencyTimer } from \"https://unpkg.com/ixfx/dist//flow.js\";\n * // Setup\n * const osc = Oscillators.saw(Timers.frequencyTimer(0.1));\n *\n * // Or\n * const osc = Oscillators.saw(0.1);\n *\n * // Call whenever a value is needed\n * const v = osc.next().value;\n * ```\n */\n//eslint-disable-next-line func-style\nexport function* saw(timerOrFreq: Timers.Timer | number) {\n  if (timerOrFreq === undefined) throw new TypeError(`Parameter 'timerOrFreq' is undefined`);\n\n  if (typeof timerOrFreq === `number`) {\n    timerOrFreq = Timers.frequencyTimer(timerOrFreq);\n  }\n  while (true) {\n    yield timerOrFreq.elapsed;\n  }\n}\n\n/**\n * Square oscillator\n *\n * ```js\n * import { Oscillators } from \"https://unpkg.com/ixfx/dist/modulation.js\"\n *\n * // Setup\n * const osc = Oscillators.square(Timers.frequencyTimer(0.1));\n * const osc = Oscillators.square(0.1);\n *\n * // Call whenever a value is needed\n * osc.next().value;\n * ```\n */\n//eslint-disable-next-line func-style\nexport function* square(timerOrFreq: Timers.Timer | number) {\n  if (typeof timerOrFreq === `number`) {\n    timerOrFreq = Timers.frequencyTimer(timerOrFreq);\n  }\n  while (true) {\n    yield timerOrFreq.elapsed < 0.5 ? 0 : 1;\n  }\n}\n","/**\n * Returns a proportion of `amount` depending on elapsed time.\n * ```js\n * const x = perSecond(0.1);\n * x();\n * ```\n * \n * The faster `x()` is called, the smaller the chunks of `amount` are returned.\n * \n * @example Usage example\n * ```js\n * const settings = Object.freeze({\n *  ageMod: perSecond(0.1);\n* });\n * \n * let state = Object.freeze({\n *  age: 1\n * });\n * \n * // Update\n * setInterval(() => {\n *  let { age } = state;\n *  // Add 0.1 per second, regardless of \n *  // loop speed\n *  age += settings.ageMod(); \n *  state = {\n *    ...state,\n *    age: clamp(age)\n *  }\n * });\n * ```\n * @param amount\n * @returns \n */\nexport const perSecond = (amount: number) => {\n  const perMilli = amount / 1000;\n  let called = performance.now();\n\n  return () => {\n    const elapsed = performance.now() - called;\n    called = performance.now();\n    return perMilli * elapsed;\n  }\n}","import {\n  type RandomSource,\n  floatSource as randomFloatFunction,\n  float as randomFloat,\n  defaultRandom,\n} from '../Random.js';\nimport { clamp } from '../data/Clamp.js';\nimport { throwNumberTest } from '../Guards.js';\n\nexport type JitterOpts = {\n  readonly relative?: number;\n  readonly absolute?: number;\n  readonly clamped?: boolean;\n  readonly source?: RandomSource;\n};\n\nexport type Jitterer = (value: number) => number;\n\n/**\n * Returns a {@link Jitterer} that works with absolute values.\n * \n * ```js\n * // Jitter by -10 to 10\n * const j = jitterAbsolute({ absolute: 10 });\n * j(100); // Produces range of 90-110\n * ```\n * \n * When `clamped` is true, return value is clamped to 0...value\n * ```js\n * const j = jitterAbsolute({ absolute: 10, clamped: true })\n * j(100); // Produces range of 90-100\n * ```\n * @param opts \n * @returns \n */\nexport const jitterAbsolute = (opts: JitterOpts): Jitterer => {\n  const { relative, absolute } = opts;\n  const clamped = opts.clamped ?? false;\n  const source = opts.source ?? defaultRandom;\n  if (absolute !== undefined) {\n    return (value: number) => {\n      const abs = (source() * absolute * 2) - absolute;\n      const valueNew = value + abs;\n      if (clamped) return clamp(valueNew, 0, value);\n      return valueNew;\n    }\n  }\n  if (relative !== undefined) {\n    return (value: number) => {\n      const rel = value * relative;\n      const abs = (source() * rel * 2) - rel;\n      const valueNew = value + abs;\n      if (clamped) return clamp(valueNew, 0, value);\n      return valueNew;\n    }\n  }\n  throw new Error(`Either absolute or relative fields expected`);\n}\n\n/**\n * Jitters `value` by the absolute `jitter` amount. Returns a function.\n *\n * All values should be on a 0..1 scale, and the return value is by default clamped to 0..1.\n * Pass `clamped:false` as an option to allow for arbitary ranges.\n *\n * `jitter` returns a function that calculates jitter. If you only need a one-off\n * jitter, you can immediately execute the returned function:\n * ```js\n * import { jitter } from 'https://unpkg.com/ixfx/dist/modulation.js';\n * // Compute 10% jitter of input 0.5\n * const value = jitter({ relative: 0.1 })(0.5);\n * ```\n *\n * However, if the returned jitter function is to be used again,\n * assign it to a variable:\n * ```js\n * import { jitter } from 'https://unpkg.com/ixfx/dist/modulation.js';\n * const myJitter = jitter({ absolute: 0.5 });\n *\n * // Jitter an input value 1.0\n * const value = myJitter(1);\n * ```\n *\n * A custom source for random numbers can be provided. Eg, use a weighted\n * random number generator:\n *\n * ```js\n * import { weighted } from 'https://unpkg.com/ixfx/dist/random.js';\n * jitter({ relative: 0.1, source: weighted });\n * ```\n *\n * Options\n * * clamped: If false, `value`s out of percentage range can be used and return value may be beyond percentage range. True by default\n * * random: Random source (default is Math.random)\n * @param opts Options\n * @returns Function that performs jitter\n */\nexport const jitter = (opts: JitterOpts = {}): Jitterer => {\n  const clamped = opts.clamped ?? true;\n  //eslint-disable-next-line functional/no-let\n  let r = (_: number) => 0;\n  if (opts.absolute !== undefined) {\n    throwNumberTest(\n      opts.absolute,\n      clamped ? `percentage` : `bipolar`,\n      `opts.absolute`\n    );\n    const absRand = randomFloatFunction({\n      min: -opts.absolute,\n      max: opts.absolute,\n      source: opts.source,\n    });\n    r = (v: number) => v + absRand();\n  } else if (opts.relative === undefined) {\n    throw new TypeError(`Either absolute or relative jitter amount is required.`);\n  } else {\n    throwNumberTest(\n      opts.relative,\n      clamped ? `percentage` : `bipolar`,\n      `opts.relative`\n    );\n    r = (v: number) =>\n      v +\n      randomFloat({\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        min: -opts.relative! * v,\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        max: opts.relative! * v,\n        source: opts.source,\n      });\n  }\n\n  const compute = (value: number) => {\n    throwNumberTest(value, clamped ? `percentage` : `bipolar`, `value`);\n    //eslint-disable-next-line functional/no-let\n    let v = r(value);\n    if (clamped) v = clamp(v);\n    return v;\n    // let v:number;\n    // if (typeof amtRel !== 'undefined') {\n    //   const jitterAmt = value * amtRel;\n    //   const j = jitterAmt * 2 * rand();\n    //   v = value - jitterAmt + j;\n    // } else if (typeof amtAbs !== 'undefined') {\n    //   const r = randomFloat({})\n    //   const j = (amtAbs * 2 * rand()) - amtAbs;\n    //   v = value - amtAbs + j;\n    // } else {\n    //   throw new Error(`Either absolute or relative jitter amount is required.`);\n    // }\n    // if (clamped) return clamp(v);\n    // return v;\n  };\n  return compute;\n};\n","import { throwIntegerTest, integerTest } from '../Guards.js';\nimport { type HasCompletion } from './index.js';\nimport { intervalToMs, type Interval } from './IntervalType.js';\nexport type TimeoutSyncCallback = (\n  elapsedMs?: number,\n  ...args: ReadonlyArray<unknown>\n) => void;\nexport type TimeoutAsyncCallback = (\n  elapsedMs?: number,\n  ...args: ReadonlyArray<unknown>\n) => Promise<void>;\n\n/**\n * A resettable timeout, returned by {@link timeout}\n */\nexport type Timeout = HasCompletion & {\n  start(altTimeoutMs?: number, args?: ReadonlyArray<unknown>): void;\n  cancel(): void;\n  get isDone(): boolean;\n};\n\n/**\n * Returns a {@link Timeout} that can be triggered, cancelled and reset. Use {@link continuously} for interval-\n * based loops.\n *\n * Once `start()` is called, `callback` will be scheduled to execute after `timeoutMs`.\n * If `start()` is called again, the waiting period will be reset to `timeoutMs`.\n *\n * @example Essential functionality\n * ```js\n * const fn = () => {\n *  console.log(`Executed`);\n * };\n * const t = timeout(fn, 60*1000);\n * t.start();   // After 1 minute `fn` will run, printing to the console\n * ```\n *\n * @example Control execution functionality\n * ```\n * t.cancel();  // Cancel it from running\n * t.start();   // Schedule again after 1 minute\n * t.start(30*1000); // Cancel that, and now scheduled after 30s\n * t.isDone;    // True if a scheduled event is pending\n * ```\n *\n * Callback function receives any additional parameters passed in from start.\n * This can be useful for passing through event data:\n *\n * @example\n * ```js\n * const t = timeout( (elapsedMs, ...args) => {\n *  // args contains event data\n * }, 1000);\n * el.addEventListener(`click`, t.start);\n * ```\n *\n * Asynchronous callbacks can be used as well:\n * ```js\n * timeout(async () => {...}, 100);\n * ```\n *\n * If you don't expect to need to control the timeout, consider using {@link delay},\n * which can run a given function after a specified delay.\n * @param callback\n * @param timeoutMs\n * @returns {@link Timeout}\n */\nexport const timeout = (\n  callback: TimeoutSyncCallback | TimeoutAsyncCallback,\n  interval: Interval\n): Timeout => {\n  if (callback === undefined) {\n    throw new Error(`callback parameter is undefined`);\n  }\n  const intervalMs = intervalToMs(interval);\n  throwIntegerTest(intervalMs, `aboveZero`, `interval`);\n\n  //eslint-disable-next-line functional/no-let\n  let timer = 0;\n  //eslint-disable-next-line functional/no-let\n  let startedAt = 0;\n  const start = async (\n    altInterval: Interval = interval,\n    args: Array<unknown>\n  ): Promise<void> => {\n    const p = new Promise<void>((resolve, reject) => {\n      startedAt = performance.now();\n      const altTimeoutMs = intervalToMs(altInterval);\n      const it = integerTest(altTimeoutMs, `aboveZero`, `altTimeoutMs`);\n      if (!it[ 0 ]) {\n        reject(it[ 1 ]);\n        return;\n      }\n      if (timer !== 0) cancel();\n      timer = window.setTimeout(async () => {\n        await callback(performance.now() - startedAt, ...args);\n        timer = 0;\n        resolve();\n      }, altTimeoutMs);\n    });\n    return p;\n  };\n\n  const cancel = () => {\n    if (timer === 0) return;\n    startedAt = 0;\n    window.clearTimeout(timer);\n  };\n\n  return {\n    start,\n    cancel,\n    get isDone() {\n      return timer !== 0;\n    },\n  };\n};\n","export type UpdateFailPolicy = `fast` | `slow` | `backoff`;\n/**\n * Calls the async `fn` to generate a value if there is no prior value or\n * `intervalMs` has elapsed since value was last generated.\n * @example\n * ```js\n * const f = updateOutdated(async () => {\n *  const r = await fetch(`blah`);\n *  return await r.json();\n * }, 60*1000);\n *\n * // Result will be JSON from fetch. If fetch happened already in the\n * // last 60s, return cached result. Otherwise it will fetch data\n * const result = await f();\n * ```\n *\n * Callback `fn` is passed how many milliseconds have elapsed since last update. It's\n * minimum value will be `intervalMs`.\n *\n * ```js\n * const f = updateOutdated(async elapsedMs => {\n *  // Do something with elapsedMs?\n * }, 60*1000;\n * ```\n *\n * There are different policies for what to happen if `fn` fails. `slow` is the default.\n * * `fast`: Invocation will happen immediately on next attempt\n * * `slow`: Next invocation will wait `intervalMs` as if it was successful\n * * `backoff`: Attempts will get slower and slower until next success. Interval is multipled by 1.2 each time.\n *\n * @param fn Async function to call. Must return a value.\n * @param intervalMs Maximum age of cached result\n * @param updateFail `slow` by default\n * @returns Value\n */\nexport const updateOutdated = <V>(\n  fn: (elapsedMs?: number) => Promise<V>,\n  intervalMs: number,\n  updateFail: UpdateFailPolicy = `slow`\n): (() => Promise<V>) => {\n  //eslint-disable-next-line functional/no-let\n  let lastRun = 0;\n  //eslint-disable-next-line functional/no-let\n  let lastValue: V | undefined;\n  //eslint-disable-next-line functional/no-let\n  let intervalMsCurrent = intervalMs;\n\n  //eslint-disable-next-line no-async-promise-executor\n  return () =>\n    new Promise(async (resolve, reject) => {\n      const elapsed = performance.now() - lastRun;\n      if (lastValue === undefined || elapsed > intervalMsCurrent) {\n        try {\n          lastRun = performance.now();\n          lastValue = await fn(elapsed);\n          intervalMsCurrent = intervalMs;\n        } catch (ex) {\n          if (updateFail === `fast`) {\n            lastValue = undefined;\n            lastRun = 0;\n          } else if (updateFail === `backoff`) {\n            intervalMsCurrent = Math.floor(intervalMsCurrent * 1.2);\n          }\n          reject(ex);\n          return;\n        }\n      }\n      resolve(lastValue);\n    });\n};\n","import { throwIntegerTest } from '../Guards.js';\nimport { intervalToMs, type Interval } from './IntervalType.js';\nimport type { HasCompletion } from './Types.js';\n/**\n * Runs a function continuously, returned by {@link Continuously}\n */\nexport type Continuously = HasCompletion & {\n  /**\n   * Starts loop. If already running, does nothing\n   */\n  start(): void;\n\n  /**\n   * (Re-)starts the loop. If an existing iteration has been\n   * scheduled, this is cancelled and started again.\n   *\n   * This can be useful when adjusting the interval\n   */\n  reset(): void;\n  /**\n   * How many milliseconds since start() was last called\n   */\n  get elapsedMs(): number;\n  /**\n   * How many iterations of the loop since start() was last called\n   */\n  get ticks(): number;\n  /**\n   * Returns true if the loop is not running (for some reason or another)\n   */\n  get isDone(): boolean;\n  /**\n   * If disposed, the continuously instance won't be re-startable\n   */\n  get isDisposed(): boolean;\n  /**\n   * Stops loop. It can be restarted using .start()\n   */\n  cancel(): void;\n  /**\n   * Set interval. Change will take effect on next loop. For it to kick\n   * in earlier, call .reset() after changing the value.\n   */\n  set interval(interval: Interval);\n  get interval(): Interval;\n};\n\nexport type ContinuouslySyncCallback = (\n  ticks?: number,\n  elapsedMs?: number\n) => boolean | void;\nexport type ContinuouslyAsyncCallback = (\n  ticks?: number,\n  elapsedMs?: number\n) => Promise<boolean | void>;\n\nconst raf =\n  typeof window !== `undefined`\n    ? (cb: () => void) => window.requestAnimationFrame(cb)\n    : (cb: () => void) => window.setTimeout(cb, 1);\n\nexport type OnStartCalled = `continue` | `cancel` | `reset` | `dispose`;\n\n//eslint-disable-next-line functional/no-mixed-types\nexport type ContinuouslyOpts = {\n  readonly fireBeforeWait?: boolean;\n  /**\n   * Called whenever .start() is invoked.\n   * If this function returns:\n   *  - `continue`: the loop starts if it hasn't started yet, or continues if already started\n   *  - `cancel`: loop stops, but can be re-started if .start() is called again\n   *  - `dispose`: loop stops and will throw an error if .start() is attempted to be called\n   *  - `reset`: loop resets (ie. existing scheduled task is cancelled)\n   *\n   */\n  readonly onStartCalled?: (\n    ticks?: number,\n    elapsedMs?: number\n  ) => OnStartCalled;\n};\n\n/**\n * Returns a {@link Continuously} that continuously at `intervalMs`, executing `callback`.\n * By default, first the sleep period happens and then the callback happens.\n * Use {@link Timeout} for a single event.\n *\n * If callback returns _false_, loop exits.\n *\n * Call `start` to begin/reset loop. `cancel` stops loop.\n *\n * @example Animation loop\n * ```js\n * const draw = () => {\n *  // Draw on canvas\n * }\n *\n * // Run draw() synchronised with monitor refresh rate via `window.requestAnimationFrame`\n * continuously(draw).start();\n * ```\n *\n * @example With delay\n * ```js\n * const fn = () => {\n *  console.log(`1 minute`);\n * }\n * const c = continuously(fn, 60*1000);\n * c.start(); // Runs `fn` every minute\n * ```\n *\n * @example Control a 'continuously'\n * ```js\n * c.cancel();   // Stop the loop, cancelling any up-coming calls to `fn`\n * c.elapsedMs;  // How many milliseconds have elapsed since start\n * c.ticks;      // How many iterations of loop since start\n * c.intervalMs; // Get/set speed of loop. Change kicks-in at next loop.\n *               // Use .start() to reset to new interval immediately\n * ```\n *\n * Asynchronous callback functions are supported too:\n * ```js\n * continuously(async () => { ..});\n * ```\n *\n * The `callback` function can receive a few arguments:\n * ```js\n * continuously( (ticks, elapsedMs) => {\n *  // ticks: how many times loop has run\n *  // elapsedMs:  how long since last loop\n * }).start();\n * ```\n *\n * If the callback explicitly returns _false_, the loop will be cancelled\n * ```js\n * continuously(ticks => {\n *  // Stop after 100 iterations\n *  if (ticks > 100) return false;\n * }).start();\n * ```\n *\n * You can intercept the logic for calls to `start()` with `onStartCalled`. It can determine\n * whether the `start()` proceeds, if the loop is cancelled, or the whole thing disposed,\n * so it can't run any longer.\n * ```js\n * continuously(callback, intervalMs, {\n *  onStartCalled:(ticks, elapsedMs) => {\n *    if (elapsedMs > 1000) return `cancel`;\n *  }\n * }).start();\n * ```\n *\n * To run `callback` *before* the sleep happens, set `fireBeforeWait`:\n * ```js\n * continuously(callback, intervalMs, { fireBeforeWait: true });\n * ```\n * @param callback Function to run. If it returns false, loop exits.\n * @param opts Additional options\n * @param intervalMs\n * @returns\n */\nexport const continuously = (\n  callback: ContinuouslyAsyncCallback | ContinuouslySyncCallback,\n  interval?: Interval,\n  opts: ContinuouslyOpts = {}\n): Continuously => {\n  //eslint-disable-next-line functional/no-let\n  let intervalMs = intervalToMs(interval, 0);\n  throwIntegerTest(intervalMs, `positive`, `interval`);\n\n  const fireBeforeWait = opts.fireBeforeWait ?? false;\n  const onStartCalled = opts.onStartCalled;\n\n  //eslint-disable-next-line functional/no-let\n  let disposed = false;\n  //eslint-disable-next-line functional/no-let\n  let running = false;\n  //eslint-disable-next-line functional/no-let\n  let ticks = 0;\n  //eslint-disable-next-line functional/no-let\n  let startedAt = performance.now();\n  //eslint-disable-next-line functional/no-let\n  let intervalUsed = interval ?? 0;\n  //eslint-disable-next-line functional/no-let\n  let currentTimer = 0;\n\n  const schedule =\n    intervalMs === 0\n      ? raf\n      : (cb: () => void) => window.setTimeout(cb, intervalMs);\n  const deschedule =\n    intervalMs === 0\n      ? (_: number) => {\n        /** no-op */\n      }\n      : (timer: number) => window.clearTimeout(timer);\n\n  const cancel = () => {\n    if (!running) return;\n    running = false;\n    ticks = 0;\n    if (currentTimer !== 0) deschedule(currentTimer);\n    currentTimer = 0;\n  };\n\n  const loop = async () => {\n    if (!running) return;\n    const valOrPromise = callback(ticks++, performance.now() - startedAt);\n    //eslint-disable-next-line functional/no-let\n    let val;\n    if (typeof valOrPromise === `object`) {\n      val = await valOrPromise;\n    } else {\n      val = valOrPromise;\n    }\n    if (val !== undefined && !val) {\n      cancel();\n      return;\n    }\n    currentTimer = schedule(loop);\n  };\n\n  const start = () => {\n    if (disposed) throw new Error(`Disposed`);\n\n    if (onStartCalled !== undefined) {\n      // Function governs whether to allow .start() to go ahead\n      const doWhat = onStartCalled(ticks, performance.now() - startedAt);\n      if (doWhat === `cancel`) {\n        cancel();\n        return;\n      } else if (doWhat === `reset`) {\n        reset();\n        return;\n      } else if (doWhat === `dispose`) {\n        disposed = true;\n        cancel();\n        return;\n      }\n    }\n\n    if (!running) {\n      // Start running\n      startedAt = performance.now();\n      running = true;\n      if (fireBeforeWait) {\n        loop(); // Exec first, then wait\n      } else {\n        currentTimer = schedule(loop); // Wait first, then exec\n      }\n    }\n  };\n\n  const reset = () => {\n    if (disposed) throw new Error(`Disposed`);\n\n    // Cancel scheduled iteration\n    if (running) {\n      cancel();\n    }\n    start();\n  };\n\n  return {\n    start,\n    reset,\n    cancel,\n    get interval() {\n      return intervalUsed;\n    },\n    set interval(interval: Interval) {\n      const ms = intervalToMs(interval, 0);\n      throwIntegerTest(ms, `positive`, `interval`);\n      intervalMs = ms;\n      intervalUsed = interval;\n    },\n    get isDone() {\n      return !running;\n    },\n    get isDisposed() {\n      return disposed;\n    },\n    get ticks() {\n      return ticks;\n    },\n    get elapsedMs() {\n      return performance.now() - startedAt;\n    },\n  };\n};\n","import {\n  timeout,\n  type TimeoutSyncCallback,\n  type TimeoutAsyncCallback,\n} from './Timeout.js';\n\n/**\n * Returns a debounce function which acts to filter calls to a given function `fn`.\n *\n * Eg, Let's create a debounced wrapped for a function:\n * ```js\n * const fn = () => console.log('Hello');\n * const debouncedFn = debounce(fn, 1000);\n * ```\n *\n * Now we can call `debouncedFn()` as often as we like, but it will only execute\n * `fn()` after 1 second has elapsed since the last invocation. It essentially filters\n * many calls to fewer calls. Each time `debounceFn()` is called, the timeout is\n * reset, so potentially `fn` could never be called if the rate of `debounceFn` being called\n * is faster than the provided timeout.\n *\n * Remember that to benefit from `debounce`, you must call the debounced wrapper, not the original function.\n *\n * ```js\n * // Create\n * const d = debounce(fn, 1000);\n *\n * // Don't do this if we want to benefit from the debounce\n * fn();\n *\n * // Use the debounced wrapper\n * d(); // Only calls fn after 1000s\n * ```\n *\n * A practical use for this is handling high-frequency streams of data, where we don't really\n * care about processing every event, only last event after a period. Debouncing is commonly\n * used on microcontrollers to prevent button presses being counted twice.\n *\n * @example Handle most recent pointermove event after 1000ms\n * ```js\n * // Set up debounced handler\n * const moveDebounced = debounce((elapsedMs, evt) => {\n *    // Handle event\n * }, 500);\n *\n * // Wire up event\n * el.addEventListener(`pointermove`, moveDebounced);\n * ```\n *\n * Arguments can be passed to the debounced function:\n *\n * ```js\n * const fn = (x) => console.log(x);\n * const d = debounce(fn, 1000);\n * d(10);\n * ```\n *\n * If the provided function is asynchronous, it's possible to await the debounced\n * version as well. If the invocation was filtered, it returns instantly.\n *\n * ```js\n * const d = debounce(fn, 1000);\n * await d();\n * ```\n * @param callback Function to filter access to\n * @param timeoutMs Minimum time between invocations\n * @returns Debounce function\n */\nexport const debounce = (\n  callback: TimeoutSyncCallback | TimeoutAsyncCallback,\n  timeoutMs: number\n): DebouncedFunction => {\n  const t = timeout(callback, timeoutMs);\n  //eslint-disable-next-line functional/prefer-immutable-types\n  return (...args: unknown[]) => t.start(undefined, args);\n};\n\n/**\n * Debounced function\n */\nexport type DebouncedFunction = (...args: readonly unknown[]) => void;\n","/***\n * Throttles a function. Callback only allowed to run after minimum of `intervalMinMs`.\n *\n * @example Only handle move event every 500ms\n * ```js\n * const moveThrottled = throttle( (elapsedMs, args) => {\n *  // Handle ar\n * }, 500);\n * el.addEventListener(`pointermove`, moveThrottled)\n * ```\n *\n * Note that `throttle` does not schedule invocations, but rather acts as a filter that\n * sometimes allows follow-through to `callback`, sometimes not. There is an expectation then\n * that the return function from `throttle` is repeatedly called, such as the case for handling\n * a stream of data/events.\n *\n * @example Manual trigger\n * ```js\n * // Set up once\n * const t = throttle( (elapsedMs, args) => { ... }, 5000);\n *\n * // Later, trigger throttle. Sometimes the callback will run,\n * // with data passed in to args[0]\n * t(data);\n * ```\n */\nexport const throttle = (\n  callback: (\n    elapsedMs: number,\n    ...args: readonly unknown[]\n  ) => void | Promise<unknown>,\n  intervalMinMs: number\n) => {\n  //eslint-disable-next-line functional/no-let\n  let trigger = 0;\n  //eslint-disable-next-line functional/prefer-immutable-types\n  return async (...args: unknown[]) => {\n    const elapsed = performance.now() - trigger;\n    if (elapsed >= intervalMinMs) {\n      const r = callback(elapsed, ...args);\n      if (typeof r === `object`) await r;\n      trigger = performance.now();\n    }\n  };\n};\n","import { throwIntegerTest } from '../Guards.js';\n\n/**\n * Returns true for every _n_th call, eg 2 for every second call.\n *\n * If `nth` is 1, returns true for everything. 0 will be false for everything.\n *\n * Usage:\n * ```js\n * const tenth = everyNth(10);\n * window.addEventListener(`pointermove`, evt => {\n *  if (!tenth(evt)) return; // Filter out\n *  // Continue processing, it is the 10th thing.\n *\n * });\n * ```\n *\n * Alternative:\n * ```js\n * window.addEventListener(`pointermove`, everyNth(10, evt => {\n *  // Do something with tenth item...\n * });\n * ```\n * @param nth Every nth item\n * @param callback\n * @returns Function which in turn returns true if nth call has been hit, false otherwise\n */\nexport const everyNth = (\n  nth: number,\n  callback?: (...args: readonly unknown[]) => void\n) => {\n  throwIntegerTest(nth, `positive`, `nth`);\n\n  //eslint-disable-next-line functional/no-let\n  let counter = 0;\n  //eslint-disable-next-line functional/prefer-immutable-types\n  return (...args: unknown[]): boolean => {\n    if (++counter === nth) {\n      counter = 0;\n      if (callback) callback(...args);\n      return true;\n    }\n    return false;\n  };\n};\n","/**\n * Runs a function once\n *\n * ```js\n * const init = runOnce(() => {\n *  // do some initialisation\n * });\n *\n * init(); // Runs once\n * init(); // no-op\n * ```\n * @param onRun\n * @returns\n */\nexport const runOnce = (onRun: () => boolean): (() => boolean) => {\n  //eslint-disable-next-line functional/no-let\n  let run = false;\n  //eslint-disable-next-line functional/no-let\n  let success = false;\n  return () => {\n    if (run) return success;\n    run = true;\n    success = onRun();\n    return success;\n  };\n};\n","import { QueueMutable } from '../collections/queue/QueueMutable.js';\n\ntype Task = () => void;\n\nexport type TaskQueueOpts = {\n  /**\n   * How long to wait before starting the queue 'thread'\n   * when something is added.\n   *\n   * Default: 500ms\n   */\n  readonly startDelayMs?: number;\n\n  /**\n   * Once running, sleeping period between each item\n   * being processed.\n   *\n   * Default: 100ms\n   */\n  readonly intervalMs?: number;\n};\n\n/**\n * Simple task queue. Each task is awaited and run\n * in turn.\n *\n * @example Usage\n * ```js\n * const q = new TaskQueue();\n * q.add(async () => {\n *  // Takes one second to run\n *  await sleep(1000);\n * });\n * ```\n */\nexport class TaskQueue {\n  static instance = new TaskQueue();\n  //eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private _timer: any = 0;\n  private _queue;\n  private readonly _startDelayMs;\n  private readonly _intervalMs;\n\n  private constructor(opts: TaskQueueOpts = {}) {\n    this._startDelayMs = opts.startDelayMs ?? 500;\n    this._intervalMs = opts.intervalMs ?? 100;\n    this._queue = new QueueMutable<Task>();\n  }\n\n  /**\n   * Adds a task. This triggers processing loop if not already started.\n   *\n   * ```js\n   * queue.add(async () => {\n   *  await sleep(1000);\n   * });\n   * ```\n   * @param task Task to run\n   */\n  add(task: () => void) {\n    this._queue.enqueue(task);\n    if (this._timer === 0) this.schedule(this._startDelayMs);\n  }\n\n  private schedule(intervalMs: number) {\n    // If the queue is empty, allow loop to stop\n    if (this._queue.length === 0) {\n      //eslint-disable-next-line functional/immutable-data\n      this._timer = 0;\n      return;\n    }\n\n    if (this._timer !== 0) {\n      // Seems to be running\n      return;\n    }\n\n    // Start the processing loop\n    //eslint-disable-next-line functional/immutable-data\n    this._timer = setTimeout(() => {\n      this.processQueue();\n    }, intervalMs);\n  }\n\n  private async processQueue() {\n    const task = this._queue.dequeue();\n\n    //eslint-disable-next-line functional/immutable-data\n    this._timer = 0;\n    if (task !== undefined) {\n      try {\n        await task();\n        //eslint-disable-next-line functional/immutable-data\n        this._timer = 0;\n        this.schedule(this._intervalMs);\n      } catch (ex) {\n        console.error(ex);\n      }\n    }\n  }\n}\n","import { slice } from '../IterableSync.js';\nimport { filterBetween } from './Arrays.js';\n\nexport type MinMaxAvgTotal = {\n  /**\n   * Smallest value in array\n   */\n  readonly min: number;\n  /**\n   * Total of all items\n   */\n  readonly total: number;\n  /**\n   * Largest value in array\n   */\n  readonly max: number;\n  /**\n   * Average value in array\n   */\n  readonly avg: number;\n};\n\nexport type MinMaxAvgOpts = {\n  /**\n   * Start index, inclusive\n   */\n  readonly startIndex?: number;\n  /**\n   * End index, exclusive\n   */\n  readonly endIndex?: number;\n};\n/**\n * Returns the min, max, avg and total of the array or iterable.\n * Any values that are invalid are silently skipped over.\n *\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/collections.js';\n *\n * const v = [10, 2, 4.2, 99];\n * const mma = Arrays.minMaxAvg(v);\n * Yields: { min: 2, max: 99, total: 115.2, avg: 28.8 }\n * ```\n *\n * Use {@link average}, {@link max}, {@link min} or {@link total} if you only need one of these.\n *\n * A start and end range can be provided if the calculation should be restricted to a part\n * of the input array. By default the whole array is used.\n *\n * It's also possible to use an iterable as input.\n * ```js\n * Arrays.minMaxAvg(count(5,1)); // Averages 1,2,3,4,5\n * ```\n * @param data\n * @param opts Allows restriction of range that is examined\n * @returns `{min, max, avg, total}`\n */\nexport const minMaxAvg = (\n  //eslint-disable-next-line functional/prefer-readonly-type\n  data: readonly number[] | number[] | Iterable<number>,\n  opts: MinMaxAvgOpts = {}\n): MinMaxAvgTotal => {\n  if (data === undefined) throw new Error(`'data' is undefined`);\n  if (!Array.isArray(data)) {\n    if (`next` in data) {\n      if (opts.startIndex || opts.endIndex) {\n        data = slice(data, opts.startIndex, opts.endIndex);\n      }\n      //eslint-disable-next-line functional/no-let\n      let total = 0;\n      //eslint-disable-next-line functional/no-let\n      let min = Number.MAX_SAFE_INTEGER;\n      //eslint-disable-next-line functional/no-let\n      let max = Number.MIN_SAFE_INTEGER;\n      //eslint-disable-next-line functional/no-let\n      let samples = 0;\n      for (const v of data) {\n        if (typeof v !== `number`) {\n          throw new Error(`Generator should yield numbers. Got: ${typeof v}`);\n        }\n        total += v;\n        samples++;\n        min = Math.min(min, v);\n        max = Math.max(max, v);\n      }\n      return {\n        avg: total / samples,\n        total,\n        max,\n        min,\n      };\n    } else {\n      throw new Error(`'data' parameter is neither array or iterable`);\n    }\n  }\n\n  if (data.length === 0) {\n    return {\n      total: 0,\n      min: 0,\n      max: 0,\n      avg: 0,\n    };\n  }\n  const startIndex = opts.startIndex ?? 0;\n  const endIndex = opts.endIndex ?? data.length;\n\n  const validNumbers = filterBetween<number>(\n    data,\n    (d) => typeof d === `number` && !Number.isNaN(d),\n    startIndex,\n    endIndex\n  );\n  const total = validNumbers.reduce((acc, v) => acc + v, 0);\n  return {\n    total: total,\n    max: Math.max(...validNumbers),\n    min: Math.min(...validNumbers),\n    avg: total / validNumbers.length,\n  };\n};\n","import { zip } from './Arrays.js';\nimport { type EasingFn as EasingFunction } from '../modulation/Easing.js';\nexport {\n  minMaxAvg,\n  type MinMaxAvgOpts,\n  type MinMaxAvgTotal,\n} from './MinMaxAvg.js';\n\n/**\n * Computes an average of an array with a set of weights applied.\n *\n * Weights can be provided as an array, expected to be on 0..1 scale, with indexes\n * matched up to input data. Ie. data at index 2 will be weighed by index 2 in the weightings array.\n *\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/collections.js';\n * // All items weighted evenly\n * Arrays.averageWeighted([1,2,3], [1,1,1]); // 2\n *\n * // First item has full weight, second half, third quarter\n * Arrays.averageWeighted([1,2,3], [1, 0.5, 0.25]); // 1.57\n *\n * // With reversed weighting of [0.25,0.5,1] value is 2.42\n * ```\n *\n * A function can alternatively be provided to compute the weighting based on array index, via {@link weight}.\n *\n * ```js\n * Arrays.averageWeighted[1,2,3], Easings.gaussian()); // 2.0\n * ```\n *\n * This is the same as:\n *\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/collections.js';\n * import { Easings } from 'https://unpkg.com/ixfx/dist/modulation.js';\n *\n * const data = [1,2,3];\n * const w = Arrays.weight(data, Easings.gaussian());\n * const avg = Arrays.averageWeighted(data, w); // 2.0\n * ```\n * @param data Data to average\n * @param weightings Array of weightings that match up to data array, or an easing function\n */\nexport const averageWeighted = (\n  data: Array<number> | ReadonlyArray<number>,\n  weightings: Array<number> | ReadonlyArray<number> | EasingFunction\n): number => {\n  if (typeof weightings === `function`) weightings = weight(data, weightings);\n\n  const ww = zip(data, weightings);\n  // eslint-disable-next-line unicorn/no-array-reduce\n  const [ totalV, totalW ] = ww.reduce(\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    (accumulator, v: Array<number>) => [ accumulator[ 0 ] + v[ 0 ] * v[ 1 ], accumulator[ 1 ] + v[ 1 ] ],\n    [ 0, 0 ]\n  );\n  return totalV / totalW;\n};\n\n/**\n * Applies a function `fn` to the elements of an array, weighting them based on their relative position.\n *\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/collections.js';\n *\n * // Six items\n * Arrays.weight([1,1,1,1,1,1], Easings.gaussian());\n *\n * // Yields:\n * // [0.02, 0.244, 0.85, 0.85, 0.244, 0.02]\n * ```\n *\n * `fn` is expected to map (0..1) => (0..1), such as an {@link Modulation.Easings.EasingFn}. The input to the\n * `fn` is the relative position of an element. Thus the first element will be 0, the middle 0.5 and so on.\n * The output of `fn` is then multiplied by the original value.\n *\n * In the below example (which is also the default if `fn` is not specified), the relative position is\n * how values are weighted:\n *\n * ```js\n * Arrays.weight([1,1,1,1,1,1], (relativePos) => relativePos);\n * // Yields:\n * // [0, 0.2, 0.4, 0.6, 0.8, 1]\n * ```\n *\n * Non-numbers in `data` will be silently ignored (this filtering happens first, so relative index values are sane still).\n *\n * @param data Array of numbers\n * @param fn Returns a weighting based on the given relative position. If unspecified, `(x) => x` is used.\n */\nexport const weight = (\n  data: Array<number> | ReadonlyArray<number>,\n  fn?: (relativePos: number) => number\n): Array<number> => {\n  const f = fn ?? ((x: number) => x);\n  return validNumbers(data).map(\n    (v: number, index: number) => v * f(index / (validNumbers.length - 1))\n  );\n};\n\n/**\n * Returns an array of all valid numbers from `data`\n *\n * @param data\n * @returns\n */\nexport const validNumbers = (data: ReadonlyArray<number>) =>\n  data.filter((d) => typeof d === `number` && !Number.isNaN(d));\n\n/**\n * Returns the dot product of two arbitrary-sized arrays. Assumed they are of the same length.\n * @param a\n * @param b\n * @returns\n */\nexport const dotProduct = (\n  values: ReadonlyArray<ReadonlyArray<number>>\n): number => {\n  //eslint-disable-next-line functional/no-let\n  let r = 0;\n  const length = values[ 0 ].length;\n\n  //eslint-disable-next-line functional/no-let\n  for (let index = 0; index < length; index++) {\n    //eslint-disable-next-line functional/no-let\n    let t = 0;\n    //eslint-disable-next-line functional/no-let\n    for (const [ p, value ] of values.entries()) {\n      if (p === 0) t = value[ index ];\n      else {\n        t *= value[ index ];\n      }\n    }\n    r += t;\n  }\n  return r;\n};\n\n/**\n * Calculates the average of all numbers in an array.\n * Array items which aren't a valid number are ignored and do not factor into averaging.\n *\n * Use {@link minMaxAvg} if you want min, max and total as well.\n *\n * @example\n * ```\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/collections.js';\n *\n * // Average of a list\n * const avg = Arrays.average([1, 1.4, 0.9, 0.1]);\n *\n * // Average of a variable\n * let data = [100,200];\n * Arrays.average(data);\n * ```\n *\n * See also: [Numbers.average](Numbers.average.html) which takes a list of parameters\n * @param data Data to average.\n * @returns Average of array\n */\nexport const average = (data: ReadonlyArray<number>): number => {\n  // ✔ UNIT TESTED\n  if (data === undefined) throw new Error(`data parameter is undefined`);\n  const valid = validNumbers(data);\n  const total = valid.reduce((accumulator, v) => accumulator + v, 0);\n  return total / valid.length;\n};\n\n/**\n * Returns the minimum number out of `data`.\n * Undefined and non-numbers are silently ignored.\n *\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/collections.js';\n * Arrays.min([10, 20, 0]); // Yields 0\n * ```\n * @param data\n * @returns Minimum number\n */\nexport const min = (data: ReadonlyArray<number>): number =>\n  Math.min(...validNumbers(data));\n\n/**\n * Returns the index of the largest value.\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/collections.js';\n * const v = [ 10, 40, 5 ];\n * Arrays.maxIndex(v); // Yields 1\n * ```\n * @param data Array of numbers\n * @returns Index of largest value\n */\nexport const maxIndex = (data: ReadonlyArray<number>): number =>\n  // eslint-disable-next-line unicorn/no-array-reduce\n  data.reduce(\n    (bestIndex, value, index, array) =>\n      value > array[ bestIndex ] ? index : bestIndex,\n    0\n  );\n\n/**\n * Returns the index of the smallest value.\n *\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/collections.js';\n * const v = [ 10, 40, 5 ];\n * Arrays.minIndex(v); // Yields 2\n * ```\n * @param data Array of numbers\n * @returns Index of smallest value\n */\nexport const minIndex = (...data: ReadonlyArray<number>): number =>\n  // eslint-disable-next-line unicorn/no-array-reduce\n  data.reduce(\n    (bestIndex, value, index, array) =>\n      value < array[ bestIndex ] ? index : bestIndex,\n    0\n  );\n\n/**\n * Returns the maximum number out of `data`.\n * Undefined and non-numbers are silently ignored.\n *\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/collections.js';\n * Arrays.max(100, 200, 50); // 200\n * ```\n * @param data List of numbers\n * @returns Maximum number\n */\nexport const max = (data: ReadonlyArray<number>): number =>\n  Math.max(...validNumbers(data));\n\n/**\n * Returns the total of `data`.\n * Undefined and non-numbers are silently ignored.\n *\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/collections.js';\n * Arrays.total([1, 2, 3]); // 6\n * ```\n * @param data Array of numbers\n * @returns Total\n */\nexport const total = (data: ReadonlyArray<number>): number =>\n  // eslint-disable-next-line unicorn/no-array-reduce\n  data.reduce((previous, current) => {\n    if (typeof current !== `number`) return previous;\n    if (Number.isNaN(current)) return previous;\n    if (Number.isFinite(current)) return previous;\n    return previous + current;\n  }, 0);\n\n/**\n * Returns the maximum out of `data` without pre-filtering for speed.\n *\n * For most uses, {@link max} should suffice.\n *\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/collections.js';\n * Arrays.maxFast([ 10, 0, 4 ]); // 10\n * ```\n * @param data\n * @returns Maximum\n */\n//eslint-disable-next-line functional/prefer-immutable-types\nexport const maxFast = (data: ReadonlyArray<number> | Float32Array): number => {\n  //eslint-disable-next-line functional/no-let\n  let m = Number.MIN_SAFE_INTEGER;\n  //eslint-disable-next-line functional/no-let\n  for (const datum of data) {\n    m = Math.max(m, datum);\n  }\n  return m;\n};\n\n/**\n * Returns the total of `data` without pre-filtering for speed.\n *\n * For most uses, {@link total} should suffice.\n *\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/collections.js';\n * Arrays.totalFast([ 10, 0, 4 ]); // 14\n * ```\n * @param data\n * @returns Maximum\n */\n//eslint-disable-next-line functional/prefer-immutable-types\nexport const totalFast = (data: ReadonlyArray<number> | Float32Array): number => {\n  //eslint-disable-next-line functional/no-let\n  let m = 0;\n  //eslint-disable-next-line functional/no-let\n  for (const datum of data) {\n    m += datum;\n  }\n  return m;\n};\n\n/**\n * Returns the maximum out of `data` without pre-filtering for speed.\n *\n * For most uses, {@link max} should suffice.\n *\n * ```js\n * import { Arrays } from 'https://unpkg.com/ixfx/dist/collections.js';\n * Arrays.minFast([ 10, 0, 100 ]); // 0\n * ```\n * @param data\n * @returns Maximum\n */\n//eslint-disable-next-line functional/prefer-immutable-types\nexport const minFast = (data: ReadonlyArray<number> | Float32Array): number => {\n  //eslint-disable-next-line functional/no-let\n  let m = Number.MIN_SAFE_INTEGER;\n  //eslint-disable-next-line functional/no-let\n  for (const datum of data) {\n    m = Math.min(m, datum);\n  }\n  return m;\n};\n"],"mappings":"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","names":["__spreadArray","to","from","B","S","apply","identity","flip","t","pipe","first","self","__spreadArray","to","from","some","self","A","first","S","first","bind","from","self","map","self","equals","first","E","contramap","empty","compare","first","contramap","equals","min","max","clamp","between","first","min","max","first","S","last","_","__spreadArray","to","from","init","E","a","first","concat","rotate","range","start","y","group","groupBy","sort","zip","bs","abs","next","extend","map","_","reduce","b","S","last","min","max","filter","__spreadArray","to","from","tail","init","E","a","first","concat","rotate","range","start","y","group","groupBy","sort","zip","bs","abs","next","extend","map","_","S","filter","first","left","right","map","C","guard","__spreadArray","to","from","N","isEmpty","as","last","init","sort","zip","bs","rotate","E","input","first","second","intersection","ys","zero","map","filter","_","extend","reduce","b","S","e","toArray","every","some","isEmpty","init","sort","zip","bs","rotate","E","input","first","second","intersection","ys","zero","map","_","filter","extend","some","first","slice","start","isEmpty","module","document","S","object","key","isFunction","toString","length","c","source","exports","pos","codePointAt","max","min","fromCodePoint","line","parse","text","peek","token","zero","string","start","buffer","count","push","pop","stringify","stack","value","i","list","JSON5","afterMatch","gaussian","chunks","dotProduct","flatten","max","mergeByKey","min","remove","total","unique","zip","offset","map","isEqual","set","t","tick","min","max","t","debounce","forEach","throttle","toString","average","averageWeighted","filter","max","min","total","t","TrackerBase","t","TrackerBase","last","min","max","length","t","total","done","start","bbox","distanceCenter","fromDegrees","guard","interpolate","isEqual","isPositioned","length","point","toPath","toSvg","Placeholder","abs","apply","bbox","centroid","clamp","clampMagnitude","distance","divide","dotProduct","fromNumbers","getPointParameter","interpolate","invert","isEmpty","isEqual","isNaN","isPlaceholder","multiply","multiplyScalar","normalise","normaliseByRect","quantiseEvery","random","reduce","rotate","round","sum","toArray","toString","withinRange","wrap","Empty","divide","guard","interpolate","isEmpty","length","multiply","rotate","subtract","toString","t","length","mutable","peek","isEmpty","isFull","peek","isEmpty","isFull","mutable","filter","find","generator","filter","find","max","min","start","length","guard","point","angle","guard","max","min","distance","angle","from","angleRadian","arrow","Direction","path","d","t","t","path","max","min","max","min","mutable","isEmpty","isFull","peek","immutable","mutable","immutable","priority","max","min","immutable","mutable","time","key","existing","map","immutable","mutable","data","asArray","set","map","t","t","t","Empty","isEmpty","line","guard","multiply","point","divide","subtract","height","length","sum","interpolate","dot","t","distance","toString","array","start","rotate","TrackerBase","piPi","min","max","minMaxAvg","reverseOrd","minMaxAvg","init","init","run","t","unique","first","chunk","chunk","log","t","count","toString","config","line","event","rx","AudioAnalyser","freq","height","offset","hue","button","rect","AudioAnalyser","freq","stream","done","t","config","line","config","done","event","area","center","clamp","distanceFromExterior","fromNumbers","guard","isEmpty","isEqual","isIntersecting","isPlaceholder","isPositioned","multiply","multiplyScalar","normaliseByRect","randomPoint","subtract","sum","toArray","bbox","center","interpolate","isEqual","isIntersecting","isNaN","length","nearest","randomPoint","toPath","piPi","circle","angleRadian","guard","center","interpolate","t","length","bbox","isNaN","isIntersecting","isEqual","centroid","intersection","randomPoint","offset","nearest","toPath","point","line","isEmpty","rect","isPlaceholder","isPositioned","el","fromNumbers","height","toArray","isEqual","subtract","sum","guard","distanceFromExterior","guardPositioned","center","clamp","normaliseByRect","multiply","multiplyScalar","area","isIntersecting","randomPoint","done","stream","t","start","startWithVideoEl","capture","c","el","start","interval","start","distance","timeout","interval","start","offset","Empty","Placeholder","apply","area","bbox","corners","edges","fromFlatArray","fromPoints","guard","intersectsPoint","isEmpty","isEqual","isPlaceholder","lengths","perimeter","rotate","toFlatArray","area","fromCenter","perimeter","t","fromCenter","perimeter","area","area","circumcircle","height","incircle","perimeter","t","height","perimeter","area","circumcircle","incircle","area","circumcircle","fromA","fromB","fromC","fromCenter","height","incircle","medians","perimeter","t","height","perimeter","area","circumcircle","incircle","medians","fromCenter","fromA","fromB","fromC","piPi","Empty","Placeholder","isEmpty","t","isPlaceholder","apply","guard","isEqual","corners","edges","lengths","distance","total","reduce","perimeter","area","angles","fromPoints","triangle","rotate","length","angleRadian","toFlatArray","fromFlatArray","fromNumbers","bbox","getPointParameter","gamma","intersectsPoint","toPath","t","t2","sum","dot","point","bbox","bbox2","intersections","start","min","max","line","reduce","a","b","c","d","v1","q","t1","arc","bbox","offset","abs","min","max","cos","sin","acos","sqrt","pi","point","t","abs","S","B","E","A","last","angle","C","t1","t2","pi","sqrt","acos","d","start","ls","le","segments","tlen","alen","line","min","max","intersections","arc","done","cos","sin","path","start","toPath","cubic","cubic2","t","quadraticBezier","quadratic","interpolate","scale","opacity","min","max","opacity","t","opacity","opacity","t1","t2","t3","t","t","t","color","rgb","start","opacity","t","t","t","t","t","t","t","i","t","hsl","hue","start","opacity","t","lab","start","opacity","t","hcl","hue","start","opacity","t","cubehelix","hue","start","opacity","t","interpolate","t","i","hue","rgb","interpolate","from","to","lab","scale","d","b","generator","t","to","from","generator","v","Subscription","empty","timeout","Subscriber","next","ConsumerObserver","SafeSubscriber","Observable","observable","next","init","OperatorSubscriber","err","Action","delay","timeout","AsyncAction","delay","Scheduler","delay","AsyncScheduler","done","fromIterable","array","delay","repeat","map","project","map","project","project","map","add","remove","getPointParameter","el","multiply","height","scaler","rect","getContext","object","JSON5","draw","arc","apply","push","pop","path","point","quadratic","t","corners","text","rect","line","applyOpts","clear","makeHelper","applyOpts","circle","line","applyOpts","circle","line","el","text","center","height","clear","applyOpts","height","makeHelper","text","line","circle","center","height","isPlaceholder","byId","context","clamp","event","import_json5","JSON5","field","isArray","path","start","field","o","isArray","plot","v","height","sample","text","event","paths","create","create","el","from","to","isEqual","toArray","isEqual","grid","toArray","start","cells","cardinal","t","visitor","array","wrap","rows","grid","init","clamp","immutable","random","scale","scaleClamped","immutable","clamp","scale","scaleClamped","random","el","init","height","ctx","width","clamp","add","piPi","min","max","range","add","height","plot","canvasSize","getContext","defaultErrorHandler","el","line","log","interval","timestamp","clear","event","el","clear","map","fromList","fromObject","import_json5","JSON5","fromList","remove","data","t","rows","fromObject","fromObject","el","start","opts","TrackerBase","last","asPoints","event","distance","Placeholder","start","hue","el","tracker","event","el2","defaultErrorHandler","event","offset","event","afterMatch","t","count","freq","average","count","clear","add","smoothingFactor","toArray","once","wrap","length","distance","edges","lengths","object","graph","vertices","line","distance","edges","context","from","to","t","weight","stringForEdge","start","path","immutable","set","event","interval","run","process","lazy","remove","add","path","isEmpty","context","start","field","t","generator","toArray","done","rx","average","delay","filter","flatten","fromEvent","max","mergeAsArray","min","prepare","run","synchronise","transform","isAsyncIterable","isAsyncIterable","delay","transform","flatten","filter","min","max","average","debounce","duration","elapsed","fromFunction","fromEvent","asPromise","asValue","array","iterator","mergeAsArray","synchronise","take","tally","count","total","chunk","drop","run","functions","prepare","adjacentVertices","connect","connectTo","createVertex","dumpGraph","getOrCreate","graph","toAdjacencyMatrix","updateGraphVertex","createVertex","updateGraphVertex","graph","getOrCreate","resolveVertex","connectTo","weight","connect","immutable","toAdjacencyMatrix","dumpGraph","debugGraphToArray","adjacentVertices","context","last","t","create","r","pi","create","piPi","getPointParameter","dotProduct","Placeholder","isEmpty","isPlaceholder","isNaN","min","distance","abs","centroid","sum","bbox","toArray","toString","isEqual","withinRange","interpolate","fromNumbers","apply","pipeline","reduce","multiply","multiplyScalar","divide","quantiseEvery","angle","rotate","length","normalise","round","normaliseByRect","random","wrap","invert","clampMagnitude","max","clamp","start","count","from","to","isPositioned","piPi","fromDegrees","arc","point","angleRadian","guard","interpolate","toPath","bbox","length","toSvg","toSvgFull","start","distanceCenter","isEqual","bbox","interpolate","toString","toSvgString","path","interpolate","paths","t","lengths","bbox","corners","toString","start","toSvgString","clampMagnitude","divide","dotProduct","multiply","normalise","subtract","sum","toCartesian","toString","EmptyCartesian","piPi","pi","radians","point","distance","line","guard","normalise","toCartesian","toString","dotProduct","clampMagnitude","max","min","sum","subtract","multiply","divide","fromPoints","init","fromPoints","init","paths","nearest","distance","random","random","isIntersecting","circle","scaler","scaler","normalise","abs","multiply","multiply","rows","reduce","grid","visitor","asArray","opacity","rgb","scale","cos","sin","sqrt","pow","pi","piPi","circle","max","count","angle","offset","point","path","event","max","toPath","apply","guard","guard","t","apply","mass","pipeline","angle","length","distance","triangle","piPi","from","to","t","triangle","abs","average","averageWeighted","object","apply","min","max","total","filter","every","start","v","start","duration","t","toString","interval","interval","start","interval","start","reset","debounce","t","throttle","run","forEach","iterator","reduce","sqrt","pow","cos","pi","sin","create","tick","duration","t","t2","t3","sqrt","pi","t","pow","cos","sin","total","min","max","validNumbers","zip","dotProduct","length","t","total","min","array","max","array","flatten","zip","lengths","length","add","t","randomSource","total","remove","map","chunks","mergeByKey","filter","unique","max","min","total","gaussian","randomSource","start","between","length","chunks","afterMatch","text"]}